"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[15645],{596638:(e,t,l)=>{l.d(t,{Z:()=>s});var a=l(260229),n=l(667294),i=l(592770);const s=function(e){var t=(0,a.CR)((0,n.useState)(e),2),l=t[0],s=t[1];return[l,(0,n.useCallback)((function(e){s((function(t){var l=(0,i.mf)(e)?e(t):e;return l?(0,a.pi)((0,a.pi)({},t),l):t}))}),[])]}},615645:(e,t,l)=>{l.r(t),l.d(t,{default:()=>w});var a=l(667294),n=l(432787),i=l(519650),s=l(931097),o=l(3006),r=l(751995),d=l(431069),u=l(596638),c=l(730381),p=l.n(c),Z=l(126272),m=l(504914),h=l(973935),g=l(838703);const v="AhCUDOpfSjVuNYfYkK4o",b="ALLbQCbypB438hJ3Hkmf";var I=l(211965);const _=e=>{var t,l;const{open:n,onClose:i,id:s}=e,[o,r]=(0,a.useState)(!1),[u,c]=(0,a.useState)({});return(0,a.useEffect)((()=>{n&&(async()=>{r(!0);try{const{json:e,response:t}=await d.Z.get({endpoint:`/api/v1/record/${s}`});200===(null==t?void 0:t.status)&&c(null==e?void 0:e.result),r(!1)}catch{(0,h.unstable_batchedUpdates)((()=>{r(!1),c({})}))}})()}),[n]),(0,I.tZ)(Z.Z,{title:"\u65e5\u5fd7\u8be6\u60c5",placement:"right",width:"40%",onClose:i,visible:n,className:b},o&&(0,I.tZ)(g.Z,null),(0,I.tZ)(m.Z,{column:1,title:""},(0,I.tZ)(m.Z.Item,{label:"\u89d2\u8272\u540d\u79f0"},(null==u?void 0:u.role_name)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u5e94\u7528\u540d\u79f0"},(null==u?void 0:u.app_name)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u8bf7\u6c42RUL"},(null==u?void 0:u.request_path)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u8bf7\u6c42\u65f6\u95f4"},null!=u&&u.request_time?p()(u.request_time).format("YYYY-MM-DD HH:mm:ss"):"-"),(0,I.tZ)(m.Z.Item,{label:"htpp\u72b6\u6001\u7f16\u7801"},(null==u?void 0:u.status_code)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u8bf7\u6c42\u4efb\u52a1\u7684\u7ed3\u679c"},(e=>{let t="-";return"success"===e&&(t=(0,I.tZ)("span",{style:{color:"green"}},"\u6210\u529f")),"fall"===e&&(t=(0,I.tZ)("span",{style:{color:"red"}},"\u5931\u8d25")),t})(null==u?void 0:u.status)),(0,I.tZ)(m.Z.Item,{label:"\u9519\u8bef\u539f\u56e0"},(null==u?void 0:u.error_message)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u540e\u7aef\u5f02\u5e38"},(null==u?void 0:u.exception)||"-"),(0,I.tZ)(m.Z.Item,{label:"IP\u5730\u5740"},(null==u?void 0:u.ip)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u8bf7\u6c42\u53c2\u6570"},(null==u?void 0:u.request_params)||"-"),(0,I.tZ)(m.Z.Item,{label:"API\u54cd\u5e94\u7684response\u5185\u5bb9"},(null==u?void 0:u.response_return_data)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u8bf7\u6c42\u5927\u5c0f\uff08\u5b57\u8282\uff09"},(null==u?void 0:u.request_size)||0,"\uff08\u5b57\u8282\uff09"),(0,I.tZ)(m.Z.Item,{label:"\u8fd4\u56de\u5927\u5c0f\uff08\u5b57\u8282\uff09"},(null==u?void 0:u.response_size)||0,"\uff08\u5b57\u8282\uff09"),(0,I.tZ)(m.Z.Item,{label:"\u8bbf\u95ee\u540e\u7aef\u8d44\u6e90\u8017\u65f6\u603b\u548c"},(null==u?void 0:u.service_latency)||0),(0,I.tZ)(m.Z.Item,{label:"\u521b\u5efa\u4eba"},(null==u||null==(t=u.created_by)?void 0:t.username)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u521b\u5efa\u65f6\u95f4"},null!=u&&u.created_on?p()(u.created_on).format("YYYY-MM-DD HH:mm:ss"):"-"),(0,I.tZ)(m.Z.Item,{label:"\u66f4\u65b0\u4eba"},(null==u||null==(l=u.changed_by)?void 0:l.username)||"-"),(0,I.tZ)(m.Z.Item,{label:"\u66f4\u65b0\u65f6\u95f4"},null!=u&&u.changed_on?p()(u.changed_on).format("YYYY-MM-DD HH:mm:ss"):"-")))},{Search:y}=n.Z,f=(0,r.iK)((({onSearch:e})=>(0,I.tZ)(i.Z,{align:"center",style:{marginBottom:20}},(0,I.tZ)(y,{placeholder:"\u8bf7\u8f93\u5165",allowClear:!0,enterButton:"\u641c\u7d22",onSearch:e}))))``,Y=(0,r.iK)((({children:e,iStyle:t})=>(0,I.tZ)("div",{className:v,style:t?{paddingBottom:0}:{}},e)))``,w=()=>{const[e,t]=(0,u.Z)({data:[],loading:!1,open:!1,searchValue:"",detailId:"",pagination:{current:1,pageSize:20,total:0}});(0,a.useEffect)((()=>{(async()=>{t({loading:!0});const l=!!e.searchValue&&{filters:[{col:"error_message",opr:"record_all_text",value:e.searchValue}]},a=JSON.stringify({...l,page_size:e.pagination.pageSize,page:e.pagination.current-1}),{json:n,response:i}=await d.Z.get({endpoint:`/api/v1/record?q=${a}`});if(200===(null==i?void 0:i.status)){const l=(null==n?void 0:n.result)||[];t({data:null!=l&&l.length?l.map(((t,l)=>({...t,key:l+1+(e.pagination.current-1)*e.pagination.pageSize}))):[],pagination:{...e.pagination,total:null==n?void 0:n.count}})}t({loading:!1})})()}),[JSON.stringify(e.pagination),e.searchValue]);const l={rowKey:"id",bordered:!1,size:"middle",columns:(e=>e.slice().map((e=>null!=e&&e.render?e:{...e,render:(t,l)=>{var a,n;return null!=(a=l[null!=(n=null==e?void 0:e.dataIndex)?n:e.key])?a:"-"}})))([{title:"\u5e8f\u53f7",dataIndex:"key",width:80},{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"role_name",width:100,ellipsis:!0},{title:"\u5e94\u7528\u540d\u79f0",dataIndex:"app_name",width:120,ellipsis:!0},{title:"\u8bf7\u6c42URL",dataIndex:"request_path",width:300,ellipsis:!0,render:(e,{request_path:t})=>t?(0,I.tZ)(s.Z,{title:t},(0,I.tZ)("span",null,t)):"-"},{title:"\u65e5\u5fd7\u521b\u5efa\u65f6\u95f4",dataIndex:"created_on",width:160,render:(e,{created_on:t})=>t?p()(t).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"http\u72b6\u6001\u7f16\u7801",dataIndex:"status_code",width:120},{title:"\u8bf7\u6c42\u4efb\u52a1\u7684\u7ed3\u679c",dataIndex:"status",width:120,render:(e,{status:t})=>{let l="-";return"success"===t&&(l=(0,I.tZ)("span",{style:{color:"green"}},"\u6210\u529f")),"fall"===t&&(l=(0,I.tZ)("span",{style:{color:"red"}},"\u5931\u8d25")),l}},{title:"\u9519\u8bef\u539f\u56e0",dataIndex:"error_message",width:250,ellipsis:!0},{title:"\u64cd\u4f5c",key:"operation",width:80,render:(e,l)=>[(0,I.tZ)("a",{onClick:()=>{t({open:!0,detailId:l.id})},key:"button-view-detail"},"\u8be6\u60c5")]}]),dataSource:e.data,loading:e.loading,pagination:e.pagination,scroll:{y:"calc(100vh - 270px)"},onChange:e=>{t({pagination:e})}},n=(0,a.useCallback)((e=>t({searchValue:e})),[e.searchValue]);return(0,I.tZ)(a.Fragment,null,(0,I.tZ)(_,{id:e.detailId,open:e.open,onClose:(0,a.useCallback)((()=>t({open:!1})),[])}),(0,I.tZ)(Y,{iStyle:!!e.data.length},(0,I.tZ)(f,{onSearch:n}),(0,I.tZ)(o.Z,l)))}}}]);