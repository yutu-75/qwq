"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[93986],{778214:(e,t,a)=>{a.d(t,{Z:()=>Q});var s=a(667294),n=a(874981),r=a(432787),o=a(497880),i=a(734041),d=a(3006),l=a(164561),u=a(748086),h=a(71577),c=a(722122),p=a(190484),m=a(428481),y=a(850344),b=a(294184),T=a.n(b),Z=a(898423),g=a(65632),v=a(221687),f=a(796159),k=i.Z.Option;function S(e){return e&&e.type&&(e.type.isSelectOption||e.type.isSelectOptGroup)}var x=function(e,t){var a,n=e.prefixCls,r=e.className,o=e.children,d=e.dataSource,l=(0,y.Z)(o);if(1===l.length&&(0,f.l$)(l[0])&&!S(l[0])){var u=(0,m.Z)(l,1);a=u[0]}var h,b=a?function(){return a}:void 0;return h=l.length&&S(l[0])?o:d?d.map((function(e){if((0,f.l$)(e))return e;switch((0,p.Z)(e)){case"string":return s.createElement(k,{key:e,value:e},e);case"object":var t=e.value;return s.createElement(k,{key:t,value:t},e.text);default:throw new Error("AutoComplete[dataSource] only supports type `string[] | Object[]`.")}})):[],s.useEffect((function(){(0,v.Z)(!("dataSource"in e),"AutoComplete","`dataSource` is deprecated, please use `options` instead."),(0,v.Z)(!a||!("size"in e),"AutoComplete","You need to control style self instead of setting `size` when using customize input.")}),[]),s.createElement(g.C,null,(function(a){var o=(0,a.getPrefixCls)("select",n);return s.createElement(i.Z,(0,c.Z)({ref:t},(0,Z.Z)(e,["dataSource"]),{prefixCls:o,className:T()("".concat(o,"-auto-complete"),r),mode:i.Z.SECRET_COMBOBOX_MODE_DO_NOT_USE},{getInputElement:b}),h)}))},w=s.forwardRef(x);w.Option=k;const F=w;var q=a(747933),P=a(339144),C=a(519650),N=a(560331),_=a(814277),j=a(126272),D=a(431069),A=a(455867),I=a(693315),O=a(756363),R=a(619702),E=a(412556),J=a(288752),V=a(280842),K=a(807500),$=a(432615),L=a(252655),B=a(211965);const{Search:H}=r.Z,{Step:U}=o.Z,{Option:M}=i.Z,{Column:G}=d.Z,{Item:z}=l.Z;class W extends s.Component{constructor(e){super(e),this.dataconversion=(e,t)=>{let a=1,s=[];if("{}"===JSON.stringify(e))"data"==t||"params"==t?s.push([{key:{type:"Text",content:""},value:"",desc:""}]):"dynamicToken"==t?s.push([{key:"",value:{api_table_id:"",name:""}}]):s.push([{name:"",value:""}]);else if(a++,"headers"==t)for(const t in e)s.push([{key:a,name:t,value:e[t]}]);else if("params"==t)for(const t in e)s.push([{key:{type:"Text",content:t},id:a,value:e[t],desc:""}]);else if("dynamicToken"==t)s.push([{...e}]);else for(const t in e)s.push([{key:{type:"Text",content:t},id:a,value:e[t],desc:""}]);return s},this.verification=async()=>{const{apiDatasetForm:e}=this.state,t=[...e.dataTables],a=this.formRef.current.getFieldValue();let s=0;const n=this;!function e(){if(s>t.length-1)return;const r={name:a.showName,configuration:t[s].configuration,data_path:t[s].data_path,status:t[s].status};D.Z.post({endpoint:"/api/v2/datasource/api/preview/?limit=100",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then((a=>{200==a.json.meta.code||201==a.json.meta.code?t[s].status=1:t[s].status=0,n.setState({ataTables:[...n.state.apiDatasetForm.dataTables,t]},(()=>{s++,e()}))})).catch((a=>{t[s].status=0,n.setState({ataTables:[...n.state.apiDatasetForm.dataTables,t]},(()=>{s++,e()}))}))}()},this.handleApiOk=()=>{this.formRef.current.resetFields(),this.emptyapidmodeldata()},this.handleApicel=()=>{this.formRef.current.resetFields(),this.emptyapidmodeldata()},this.emptyapidmodeldata=()=>{this.setState({requestheaders:[[{key:1,name:"",value:""}]],requestbody:[[{key:{type:"Text",content:""},id:1,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:1,value:"",desc:""}]],addTableForm:{...this.state.addTableForm,id:"",name:"",status:0,method:"GET",url:"",headers:[{key:"",value:""}],bodyType:"0",body:[{key:{type:"Text",content:""},value:"",desc:""}],bodyStr:"",authType:(0,A.t)("Authentication method"),authValue:{username:"",password:""},isJsonPath:(0,A.t)("Please select"),jsonpath:"",disabled:!1,requestheaders:[[{key:1,name:"",value:""}]],requestbody:[[{key:{type:"Text",content:""},id:1,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:1,value:"",desc:""}]]},current:0,isApiModalOpen:!1,openDrawer:!1})},this.cancel=()=>{this.formRef.current.resetFields(),this.props.apiDivnone(),this.emptyapidmodeldata()},this.save=()=>{let{apidatasource:e,apiDatasetForm:t,addTableForm:a,pathtype:s,current:n,tokenApi:r}=this.state;const{requestheaders:o,requestbody:i,queryParameter:d,requestdynamicToken:l}=this.state.addTableForm;if(1==n)if(this.setState({nextLoading:!0}),s){const n={name:this.state.addTableForm.name,configuration:e.configuration,data_path:s};D.Z.post({endpoint:"/api/v2/datasource/api/preview/?limit=100",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((n=>{if(200==n.json.meta.code||201==n.json.meta.code){if(u.ZP.success(n.json.meta.message),""==t.dataTables[0].id)t.dataTables[0].id=a.name,t.dataTables[0].name=a.name,t.dataTables[0].status=a.status,t.dataTables[0].method=a.method,t.dataTables[0].url=a.url,t.dataTables[0].headers=a.headers,t.dataTables[0].bodyType=a.bodyType,t.dataTables[0].body=a.body,t.dataTables[0].bodyStr=a.bodyStr,t.dataTables[0].authType=a.authType,t.dataTables[0].authValue=a.authValue,t.dataTables[0].isJsonPath=a.isJsonPath,t.dataTables[0].jsonpath=a.jsonpath,t.dataTables[0].disabled=a.disabled,t.dataTables[0].configuration=e.configuration,t.dataTables[0].data_path=s,t.dataTables[0].requestheaders=a.requestheaders,t.dataTables[0].requestbody=a.requestbody,t.dataTables[0].queryParameter=a.queryParameter,t.dataTables[0].status=1;else if(t.dataTables.map((t=>{t.id==a.id&&(t.id=a.id,t.name=a.name,t.status=a.status,t.method=a.method,t.url=a.url,t.headers=a.headers,t.bodyType=a.bodyType,t.body=a.body,t.bodyStr=a.bodyStr,t.authType=a.authType,t.authValue=a.authValue,t.isJsonPath=a.isJsonPath,t.jsonpath=a.jsonpath,t.disabled=a.disabled,t.configuration=e.configuration,t.data_path=s,t.requestheaders=a.requestheaders,t.requestbody=a.requestbody,t.queryParameter=a.queryParameter,t.status=1)})),""==a.id){const n={id:a.name,name:a.name,method:a.method,url:a.url,headers:a.headers,bodyType:a.bodyType,body:a.body,bodyStr:a.bodyStr,authType:a.authType,authValue:a.authValue,isJsonPath:a.isJsonPath,jsonpath:a.jsonpath,disabled:a.disabled,configuration:e.configuration,data_path:s,requestheaders:a.requestheaders,requestbody:a.requestbody,queryParameter:a.queryParameter,status:1};t.dataTables.push(n)}a={id:"",name:"",status:0,method:"GET",url:"",headers:[{key:"",value:""}],bodyType:"0",body:[{key:{type:"Text",content:""},value:"",desc:""}],bodyStr:"",authType:(0,A.t)("Authentication method"),authValue:{username:"",password:""},isJsonPath:(0,A.t)("Please select"),jsonpath:"",disabled:!1,requestheaders:[[{key:1,name:"",value:""}]],requestbody:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]]};const r={};let o=[];o=t.dataTables.reduce((function(e,t){return!r[t.id]&&(r[t.id]=e.push(t)),e}),[]),t.dataTables=o,this.setState({isSave:!0,ataTables:[...this.state.apiDatasetForm.dataTables,t.dataTables],addTableForm:a},(()=>{this.setState({addTableForm:a})})),this.handerApiDeawercel()}else u.ZP.error(n.json.meta.message)})).finally((()=>{this.setState({nextLoading:!1})}))}else this.setState({nextLoading:!1});else this.onFinish(this.oneContentRef).then((e=>{this.setState({nextLoading:!0});let t={},s={},n={};o.flat().filter((e=>{const t={};t[e.name]=e.value,e.name&&e.value&&(s={...s,...t})})),d.flat().filter((e=>{var t,a;const s={};s[null==(t=e.key)?void 0:t.content]=e.value,null!=(a=e.key)&&a.content&&e.value&&(n={...n,...s})}));let l={};if("POST"===a.method)if("2"===a.bodyType)try{l=a.bodyStr?JSON.parse(a.bodyStr):{}}catch{return this.setState({nextLoading:!1}),u.ZP.error((0,A.t)("The input data format is abnormal"))}else if(Number(a.bodyType)>2)try{t=a.bodyStr?JSON.parse(a.bodyStr):{}}catch{return this.setState({nextLoading:!1}),u.ZP.error((0,A.t)("The input data format is abnormal"))}else i.flat().filter((e=>{const a={};a[e.key.content]=e.value,e.key.content&&e.value&&(t={...t,...a})}));let h={};if("Basic Auth"==a.authType){if(""==a.authValue.username||""==a.authValue.password)return this.setState({nextLoading:!1}),u.ZP.error((0,A.t)("Please enter a username or password!"));h={username:a.authValue.username,password:a.authValue.password}}const c={url:e.url,method:e.method,headers:s,data:t,json:l,params:n,auth:h,token_api:r};this.TestAPIdatasourcedata(c)}))},this.onFinish=e=>new Promise(((t,a)=>{const s=e.current.validateFields();s?t(s):a(s)})),this.addCard=()=>{this.onFinish(this.formRef).then((e=>{this.setState({openDrawer:!0,Databaseres:e})}))},this.handerApiDeawercel=()=>{this.setState({twoContentData:[],fieldColdata:[],current:0,openDrawer:!1,pathtype:null})},this.clickCard=e=>{let{addTableForm:t}=this.state;t={id:e.id,name:e.name,status:e.status,method:e.configuration.method,url:e.configuration.url,headers:e.configuration.headers,bodyType:e.bodyType,body:e.configuration.json,bodyStr:e.bodyStr,authType:e.authType,authValue:e.authValue,isJsonPath:e.isJsonPath,jsonpath:e.jsonpath,disabled:e.disabled,configuration:e.configuration,data_path:e.data_path,requestheaders:e.requestheaders,dynamicToken:e.configuration.token_api,requestdynamicToken:[[e.dynamicToken]],requestbody:e.requestbody,queryParameter:e.queryParameter,activeTabKey:e.activeTabKey,username:e.configuration.auth.username,password:e.configuration.auth.username},this.setState({addTableForm:t,openDrawer:!0,pathtype:e.data_path,selectedRowKeys:Object.keys(e.data_path.columns)})},this.copy=(e,t)=>{const{apiDatasetForm:a}=this.state,s=JSON.parse(JSON.stringify(e)),n={name:`${a.dataTables[0].name}copy_${a.dataTables.length}`,id:s.id+a.dataTables.length+s.name,status:s.status,method:s.configuration.method,url:s.configuration.url,headers:s.headers,bodyType:s.bodyType,body:s.configuration.json,bodyStr:s.bodyStr,authType:s.authType,authValue:s.authValue,isJsonPath:s.isJsonPath,jsonpath:s.jsonpath,disabled:s.disabled,configuration:s.configuration,data_path:s.data_path,requestheaders:s.requestheaders,requestbody:s.requestbody,queryParameter:s.queryParameter,activeTabKey:s.activeTabKey,username:s.configuration.auth.username,password:s.configuration.auth.username};a.dataTables.push(n),this.setState({dataTables:[...this.state.apiDatasetForm.dataTables,a.dataTables]})},this.del=e=>{let{apiDatasetForm:t,addTableForm:a}=this.state;t.dataTables.splice(e,1),a={id:"",name:"",status:0,method:"GET",url:"",headers:[{key:"",value:""}],bodyType:"0",body:[{key:{type:"Text",content:""},value:"",desc:""}],bodyStr:"",authType:(0,A.t)("Authentication method"),authValue:{username:"",password:""},isJsonPath:(0,A.t)("Please select"),jsonpath:"",disabled:!1,requestheaders:[[{key:1,name:"",value:""}]],requestbody:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],username:"",password:""},0==t.dataTables.length?(t.dataTables[0]={id:1,name:"",status:0,method:"",url:"",headers:[{key:"",value:""}],bodyType:"0",body:{},authType:"",authValue:{username:"",password:""},isJsonPath:!1,jsonpath:"",apiDataTree:[]},this.setState({dataTables:t.dataTables[0],isSave:!1,addTableForm:a})):this.setState({dataTables:[...this.state.apiDatasetForm.dataTables,t.dataTables],addTableForm:a})},this.onTabChange=e=>{"dynamicToken"==e&&this.getTokenTables(),this.setState({activeTabKey:e})},this.getTokenTables=()=>{D.Z.get({endpoint:encodeURI("/api/v2/datasource/api/token_tables/list/")}).then((e=>{200!=e.json.meta.code&&201!=e.json.meta.code||this.setState({tokenTables:e.json.meta.data||[]})}))},this.radioChange=e=>{this.setState({addTableForm:{...this.state.addTableForm,bodyType:e.target.value}})},this.bodyKeyChange=(e,t,a)=>{const{requestbody:s}=this.state.addTableForm;"object"===typeof e&&Array.isArray(t)?s[a][0].key.content=event.target.value:"string"===typeof t?s[a][0].key.type=t:s[a][0][e]=event.target.value,this.setState({addTableForm:{...this.state.addTableForm,requestbody:[...s]}})},this.queryChange=(e,t,a)=>{const{queryParameter:s}=this.state.addTableForm;"object"===typeof e&&Array.isArray(t)?s[a][0].key.content=event.target.value:"string"===typeof t?s[a][0].key.type=t:s[a][0][e]=event.target.value,this.setState({addTableForm:{...this.state.addTableForm,queryParameter:[...s]}})},this.authChange=e=>{this.setState({addTableForm:{...this.state.addTableForm,authType:e}})},this.jsonPathChange=e=>{this.setState({addTableForm:{...this.state.addTableForm,isJsonPath:e}}),"deny"==e?this.setState({addTableForm:{...this.state.addTableForm,disabled:!0,isJsonPath:e}}):this.setState({addTableForm:{...this.state.addTableForm,disabled:!1,isJsonPath:e}})},this.searchApiData=()=>{},this.up=(e,t)=>{const{requestheaders:a,requestbody:s,queryParameter:n,dynamicToken:r}=this.state.addTableForm,o="header"==e?a:"dynamicToken"==e?r:"body"==e?s:n;if(0!==t&&1!==o.length){const a=o[t];o[t]=o[t-1],o[t-1]=a,"header"==e?this.setState({addTableForm:{...this.state.addTableForm,requestheaders:[...o]}}):"dynamicToken"==e?this.setState({addTableForm:{...this.state.addTableForm,dynamicToken:[...o]}}):"body"==e?this.setState({addTableForm:{...this.state.addTableForm,requestbody:[...o]}}):this.setState({addTableForm:{...this.state.addTableForm,queryParameter:[...o]}})}},this.down=(e,t)=>{const{requestheaders:a,requestbody:s,queryParameter:n,dynamicToken:r}=this.state.addTableForm,o="header"==e?a:"dynamicToken"==e?r:"body"==e?s:n;if(t!==o.length-1&&1!==o.length){const a=o[t];o[t]=o[t+1],o[t+1]=a,"header"==e?this.setState({addTableForm:{...this.state.addTableForm,requestheaders:[...o]}}):"dynamicToken"==e?this.setState({addTableForm:{...this.state.addTableForm,dynamicToken:[...o]}}):"body"==e?this.setState({addTableForm:{...this.state.addTableForm,requestbody:[...o]}}):this.setState({addTableForm:{...this.state.addTableForm,queryParameter:[...o]}})}},this.delrequestHeader=(e,t)=>{const{requestheaders:a,requestbody:s,queryParameter:n,dynamicToken:r}=this.state.addTableForm;if("header"==e){const e=a.filter(((e,a)=>a!==t));this.setState({addTableForm:{...this.state.addTableForm,requestheaders:[...e]}})}else if("body"==e){const e=s.filter(((e,a)=>a!==t));this.setState({addTableForm:{...this.state.addTableForm,requestbody:[...e]}})}else if("dynamicToken"==e){const e=r.filter(((e,a)=>a!==t));this.setState({addTableForm:{...this.state.addTableForm,dynamicToken:[...e]}})}else{const e=n.filter(((e,a)=>a!==t));this.setState({addTableForm:{...this.state.addTableForm,queryParameter:[...e]}})}},this.LostBlur=(e,t,a)=>{const{requestheaders:s,requestbody:n,queryParameter:r,requestdynamicToken:o}=this.state.addTableForm;let i=3;"body"==e&&0==n.filter((e=>!e[0].key.content)).length&&(i++,n.push([{key:{type:"Text",content:""},id:i,value:"",desc:""}]),this.setState({addTableForm:{...this.state.addTableForm,requestbody:[...n]}})),"query"==e&&0==r.filter((e=>{var t;return!(null!=(t=e[0].key)&&t.content)})).length&&(i++,r.push([{key:{type:"Text",content:""},id:i,value:"",desc:""}]),this.setState({addTableForm:{...this.state.addTableForm,queryParameter:[...r]}})),t[0][e]&&0==s.filter((e=>!e[0].name&&!e[0].value)).length&&(i++,s.push([{key:i,name:"",value:""}]),this.setState({addTableForm:{...this.state.addTableForm,requestheaders:[...s]}})),"dynamicToken"==e&&t[0].name&&0==o.filter((e=>!e[0].name&&!e[0].value)).length&&(i++,o.push([{key:"",value:{api_table_id:"",name:""}}]),this.setState({addTableForm:{...this.state.addTableForm,requestdynamicToken:[...o]}}))},this.reauestChang=(e,t,a,s)=>{const{requestheaders:n,requestdynamicToken:r}=this.state.addTableForm;"dynamicToken"==e?(s?t[0].key=s:t[0].value=event.target.value,t[0][e]=event.target.value,r[a]=t,this.setState({addTableForm:{...this.state.addTableForm,requestdynamicToken:[...r]}})):(t[0][e]=event.target.value,n[a]=t,this.setState({addTableForm:{...this.state.addTableForm,requestheaders:[...n]}}))},this.reauestChang_token=(e,t,a,s)=>{const{requestheaders:n,requestdynamicToken:r}=this.state.addTableForm;t[0][e]="value"==e?{api_table_id:s.split("&")[0],name:s.split("&")[1]}:event.target.value,r[a]=t,this.setState({addTableForm:{...this.state.addTableForm,requestdynamicToken:[...r]}})},this.datarecursion=e=>{const t=(e,a=[],s="",n=!0,o="")=>{if(Array.isArray(e)&&n&&e.length>0&&(e=e[0],n=!1,o=s?s.substring(0,s.length-1):s),"object"==typeof(i=e)&&"[object object]"==Object.prototype.toString.call(i).toLowerCase()&&!i.length)for(let i in e){const d=Object.prototype.toString.call(e[i]).split("object ")[1].split("]")[0];let l={key:s+i,name:i,value:i,column:s+i,dataType:d,recordPath:o,Field_renaming:(0,B.tZ)(r.Z,{defaultValue:i,onChange:()=>{l.value=event.target.value,this.state.selectedRows&&this.getdatapath(this.state.selectedRows)}}),field_type:(0,B.tZ)(r.Z,{style:{textAlign:"center"},disabled:!0,defaultValue:d}),data:e[i]};e[i]instanceof Object&&(l.children=[],t(e[i],l.children,`${s}${i}.`,n,o)),a.push(l)}var i;return a};return t(e)},this.handerUsername=e=>{this.setState({addTableForm:{...this.state.addTableForm,authValue:{...this.state.addTableForm.authValue,username:e.target.value}}})},this.handerPassword=e=>{this.setState({addTableForm:{...this.state.addTableForm,authValue:{...this.state.addTableForm.authValue,password:e.target.value}}})},this.TestAPIdatasourcedata=e=>{const{table_group_id:t}=this.state;D.Z.post({endpoint:"/api/v2/datasource/api/test/",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((a=>{if(200==a.json.meta.code||201==a.json.meta.code){const s={configuration:e,d_type:"api",desc:this.state.Databaseres.desc,group_id:t,name:this.state.Databaseres.showName};this.setState({current:this.state.current+1,twoContentData:this.datarecursion(a.json.meta.data),apidatasource:s}),this.getviewdata()}else u.ZP.error(a.json.meta.message)})).finally((()=>{this.setState({nextLoading:!1})}))},this.tableName=e=>{this.setState({addTableForm:{...this.state.addTableForm,name:e.target.value}})},this.SavaAPIDatasheetData=()=>{const e=this.formRef.current.getFieldValue(),t=[];let a={};this.state.apiDatasetForm.dataTables.map((e=>{let s=e.bodyType;a={configuration:e.configuration,data_path:e.data_path,name:e.name,status:e.status,extra:s},t.push(a)}));const s={d_type:this.state.apiDatasetForm.type,desc:e.desc,group_id:this.props.table_groupID,name:e.showName,tables:t};D.Z.post({endpoint:"/api/v2/datasource/api/",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(u.ZP.success(e.json.meta.message),this.props.DealList(),this.cancel(),this.handerApiDeawercel()):u.ZP.error(e.json.meta.message)})).finally((()=>{this.setState({nextLoading:!1})}))},this.ModifyAPIdatasourcedata=e=>{const t=this.formRef.current.getFieldValue(),a=[];let s={};this.state.apiDatasetForm.dataTables.map((e=>{let t=e.bodyType;s={configuration:e.configuration,data_path:e.data_path,name:e.name,status:e.status,extra:t},a.push(s)}));const n={desc:t.desc,name:t.showName,tables:a,d_type:this.state.apiDatasetForm.type};D.Z.put({endpoint:`/api/v2/datasource/api/${this.props.DataSetID}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(u.ZP.success(e.json.meta.message),this.props.DealList(),this.cancel(),this.handerApiDeawercel()):u.ZP.error(e.json.meta.message)})).finally((()=>{this.setState({nextLoading:!1})}))},this.next=()=>{const{requestheaders:e,requestbody:t,apidatasource:a,apiDatasetForm:s}=this.state;if(!this.state.apiDatasetForm.dataTables[0].url)return u.ZP.error((0,A.t)("Please add API data source first"));this.setState({nextLoading:!0}),this.props.DataSetID?this.ModifyAPIdatasourcedata():this.SavaAPIDatasheetData()},this.back=()=>{this.setState({current:this.state.current-1,fieldColdata:[],fieldCol:[]})},this.requestFor=e=>{this.setState({addTableForm:{...this.state.addTableForm,method:e}}),"GET"===e&&"requestor"===this.state.activeTabKey&&this.setState({activeTabKey:"requestHeader"})},this.tabelcolumns=e=>{const t=[];return e.forEach((e=>{if(!e.children){const a={};a.title=e.name,a.dataIndex=e.name,t.length>0?!t.some((e=>e.dataIndex==a.dataIndex))&&t.push(a):t.push(a)}})),t},this.tabeldata=e=>{const t=[];return e.forEach((e=>{let a=0,s=!1;const n={};e.children||Array.isArray(e.data)||(n[e.name]=e.data,n.key=e.key,t.length>0?t.forEach((t=>{for(const n in t)n==e.name&&(a++,s=!0)})):t.push(n),s?t.length==a?t.push(n):t[a][e.name]=e.data:t[0][e.name]=e.data)})),t.slice(0,5)},this.getSelectedRowKeys=(e,t,a)=>{let s=[],n=!0;const r=(e,t)=>(e.forEach((e=>{n=!0,t.forEach((t=>{t.key===e.key&&(n=!1)})),n&&!e.children&&t.push(e)})),t);return a&&(t.children?s=r(t.children,[]):s.push(t)),s=r(e,s),s},this.getdatapath=e=>{const t={record_path:[],meta:[],columns:{}};if(e.forEach((e=>{"Array"!==e.dataType?"Object"!==e.dataType&&(t.columns[e.key]=e.name):0===t.record_path.length&&(t.record_path=e.key.split("."))})),t.record_path.length>0){const e=t.record_path.join(".");Object.keys(t.columns).forEach((a=>{0!==a.indexOf(e)&&t.meta.push(a.split("."))}))}this.setState({pathtype:t})},this.getviewdata=()=>{let{apidatasource:e,apiDatasetForm:t,addTableForm:a,pathtype:s,current:n}=this.state;if(!s)return;const{requestheaders:r,requestbody:o,queryParameter:i}=this.state.addTableForm,d={name:this.state.addTableForm.name,configuration:e.configuration,data_path:s};D.Z.post({endpoint:"/api/v2/datasource/api/preview/?limit=100",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){u.ZP.success(e.json.meta.message);let t=e.json.meta.data,a=[];for(const e in t[0]){const t={title:e,dataIndex:e,key:e,id:e,ellipsis:!0};a.push(t)}this.setState({fieldCol:a,fieldColdata:t})}else u.ZP.error(e.json.meta.message)}))},this.state={tokenTables:[],openDrawer:!1,current:0,nextLoading:!1,activeTabKey:"requestHeader",tokenApi:{key:"",value:{api_table_id:"",name:""}},d_type:"token_api",apiDatasetForm:{showName:"",type:"api",desc:"",id:"",dataTables:[{id:"",name:"",status:0,method:"",url:"",headers:[{key:"",value:""}],dynamicToken:[{key:"",value:{api_table_id:"",name:""}}],bodyType:"0",body:{},authType:"",authValue:{username:"",password:""},isJsonPath:!1,jsonpath:"",apiDataTree:[]}]},requestheaders:[[{key:1,name:"",value:""}]],requestbody:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],addTableForm:{id:"",name:"",status:0,method:"GET",url:"",headers:[{key:"",value:""}],bodyType:"0",body:[{key:{type:"Text",content:""},value:"",desc:""}],bodyStr:"",authType:(0,A.t)("Authentication method"),authValue:{username:"",password:""},isJsonPath:(0,A.t)("Please select"),jsonpath:"",disabled:!1,requestheaders:[[{key:1,name:"",value:""}]],requestdynamicToken:[[{key:"",value:{api_table_id:"",name:""}}]],dynamicToken:[[{key:"",value:{api_table_id:"",name:""}}]],requestbody:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]],queryParameter:[[{key:{type:"Text",content:""},id:2,value:"",desc:""}]]},fieldCol:[],fieldColdata:[],twoContentData:[],Databaseres:{showName:"",desc:""},Menuloading:!1,Selectedmenu:"",selectedRowKeys:[],table_group_id:this.props.table_group_id},this.formRef=s.createRef(),this.oneContentRef=s.createRef()}componentDidMount(){!this.props.isApiadd&&this.props.DataSetID&&D.Z.get({endpoint:encodeURI(`/api/v2/datasource/api/${this.props.DataSetID}/`)}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){var t,a,s;this.setState({table_group_id:e.json.meta.data.group_id});const n=e.json.meta.data,r=[];let o={};e.json.meta.data.tables.map((e=>{const t=JSON.parse(e.configuration);JSON.parse(e.data_path);let a={};t.auth&&(a=t.auth);const s=function(e,t){let a={};a="2"==t?e.json:e.data;let s="";for(const e in a)Object.hasOwnProperty.call(a,e)&&(s+=`${s?",":""}"${e}":"${a[e]}"`);return s?`{${s}}`:"{}"}(t,e.extra);o={id:e.id,name:e.name,status:e.status,method:t.method,url:t.url,headers:t.headers,dynamicToken:t.token_api,bodyType:e.extra,body:e.body,bodyStr:s,authType:e.authType||"Authentication method",authValue:e.authValue,isJsonPath:e.isJsonPath,jsonpath:e.jsonpath,disabled:e.disabled,configuration:JSON.parse(e.configuration),data_path:JSON.parse(e.data_path),username:a.username?auth.username:"",password:a.username?auth.password:"",requestheaders:this.dataconversion(t.headers,"headers"),requestbody:this.dataconversion(t.data,"data"),requestdynamicToken:this.dataconversion(t.token_api,"dynamicToken"),queryParameter:this.dataconversion(t.params,"params"),activeTabKey:"PSOT"==t.method?this.state.activeTabKey:"requestHeader"},r.push(o)}));const i=null!=(t=null==(a=JSON.parse(null!=(s=e.json.meta.data.tables[0].configuration)?s:"{}"))?void 0:a.token_api)?t:{key:"",value:{api_table_id:"",name:""}};this.setState({apiDatasetForm:{...this.state.apiDatasetForm,showName:n.name,desc:n.desc,id:n.id,dataTables:r,type:n.d_type},isApiModalOpen:!0,isSave:!0,tokenApi:i}),this.formRef.current.setFieldsValue({showName:n.name,desc:n.desc,type:n.d_type})}else u.ZP.error(e.json.meta.message)}))}render(){var e,t;const{apiDatasetForm:a,openDrawer:u,current:c,addTableForm:p,activeTabKey:m,fieldCol:y,fieldColdata:b,twoContentData:T,nextLoading:Z,Menuloading:g,selectedRowKeys:v,tokenTables:f}=this.state,{requestheaders:k,requestbody:S,queryParameter:x}=p,{isApiadd:w}=this.props,D=(a.type,e=>(0,B.tZ)("div",{key:`kvTab_${e}`},S&&S.map(((e,t)=>(0,B.tZ)(d.Z,{key:t,rowKey:"id",className:"table",pagination:!1,dataSource:S[t],showHeader:!1},(0,B.tZ)(G,{render:()=>(0,B.tZ)(s.Fragment,null,(0,B.tZ)(I.default,{onClick:()=>this.up("body",t)}),(0,B.tZ)(O.default,{onClick:()=>this.down("body",t)}))}),(0,B.tZ)(G,{dataIndex:"key",render:a=>(0,B.tZ)(r.Z,{addonBefore:(0,B.tZ)(i.Z,{onChange:e=>this.bodyKeyChange(a,e,t),value:a.type},(0,B.tZ)(M,{value:"Text"},"Text")),style:{width:"170px"},placeholder:(0,A.t)("key"),value:a.content,onChange:s=>this.bodyKeyChange(a,e,t),onBlur:()=>this.LostBlur("body",e,t)})}),(0,B.tZ)(G,{dataIndex:"value",render:a=>(0,B.tZ)(r.Z,{style:{width:"170px"},placeholder:(0,A.t)("value"),value:a,onChange:a=>this.bodyKeyChange("value",e,t)})}),(0,B.tZ)(G,{render:()=>(0,B.tZ)(h.Z,{type:"text",icon:(0,B.tZ)(R.default,null),onClick:()=>this.delrequestHeader("body",t),disabled:t===S.length-1})})))))),W=e=>(0,B.tZ)("div",null,(0,B.tZ)(n.default,{key:`aceEditor_${e}`,width:"500px",height:"450px",value:p.bodyStr,onChange:e=>{this.setState({addTableForm:{...this.state.addTableForm,bodyStr:e}})}})),Q={0:D(1),1:D(2),2:W(2),3:W(3),4:W(4)},X={requestHeader:(0,B.tZ)("div",null,k&&k.map(((e,t)=>(0,B.tZ)(d.Z,{key:t,rowKey:"key",className:"table",pagination:!1,dataSource:k[t],showHeader:!1},(0,B.tZ)(G,{width:60,render:()=>(0,B.tZ)(s.Fragment,null,(0,B.tZ)(I.default,{onClick:()=>this.up("header",t)}),(0,B.tZ)(O.default,{onClick:()=>this.down("header",t)}))}),(0,B.tZ)(G,{dataIndex:"name",render:a=>(0,B.tZ)(F,{style:{width:"160px"},placeholder:(0,A.t)("key"),value:a,onBlur:()=>this.LostBlur("name",e,t),onChange:()=>this.reauestChang("name",e,t)})}),(0,B.tZ)(G,{dataIndex:"value",render:a=>(0,B.tZ)(r.Z,{style:{width:"160px"},placeholder:(0,A.t)("value"),value:a,onBlur:()=>this.LostBlur("value",e,t),onChange:()=>this.reauestChang("value",e,t)})}),(0,B.tZ)(G,{render:()=>(0,B.tZ)(h.Z,{type:"text",icon:(0,B.tZ)(R.default,null),onClick:()=>this.delrequestHeader("header",t),disabled:t===k.length-1})}))))),queryParameter:(0,B.tZ)("div",null,x&&x.map(((e,t)=>(0,B.tZ)(d.Z,{key:t,rowKey:"id",className:"table",pagination:!1,dataSource:x[t],showHeader:!1},(0,B.tZ)(G,{render:()=>(0,B.tZ)(s.Fragment,null,(0,B.tZ)(I.default,{onClick:()=>this.up("query",t)}),(0,B.tZ)(O.default,{onClick:()=>this.down("query",t)}))}),(0,B.tZ)(G,{dataIndex:"key",render:a=>(0,B.tZ)(r.Z,{addonBefore:(0,B.tZ)(i.Z,{onChange:e=>this.queryChange(a,e,t),value:null==a?void 0:a.type},(0,B.tZ)(M,{value:"Text"},"Text")),style:{width:"170px"},placeholder:(0,A.t)("key"),value:null==a?void 0:a.content,onChange:s=>this.queryChange(a,e,t),onBlur:()=>this.LostBlur("query",e,t)})}),(0,B.tZ)(G,{dataIndex:"value",render:a=>(0,B.tZ)(r.Z,{style:{width:"170px"},placeholder:(0,A.t)("value"),value:a,onChange:a=>this.queryChange("value",e,t)})}),(0,B.tZ)(G,{render:()=>(0,B.tZ)(h.Z,{type:"text",icon:(0,B.tZ)(R.default,null),onClick:()=>this.delrequestHeader("query",t),disabled:t===x.length-1})}))))),requestor:(0,B.tZ)("div",null,(0,B.tZ)(q.ZP.Group,{onChange:this.radioChange,value:p.bodyType},(0,B.tZ)(q.ZP,{value:"0"},"form-data"),(0,B.tZ)(q.ZP,{value:"1"},"x-www-form-urlencoded"),(0,B.tZ)(q.ZP,{value:"2"},"json"),(0,B.tZ)(q.ZP,{value:"3"},"xml"),(0,B.tZ)(q.ZP,{value:"4"},"row")),Q[p.bodyType]),authenticationConfiguration:(0,B.tZ)("div",null,(0,B.tZ)("div",null,(0,A.t)("Authentication method")),(0,B.tZ)(i.Z,{style:{marginTop:"10px"},onChange:this.authChange,value:p.authType},(0,B.tZ)(M,{value:"No Auth"},"No Auth"),(0,B.tZ)(M,{value:"Basic Auth"},"Basic Auth")),"Basic Auth"==p.authType?(0,B.tZ)("div",null,(0,B.tZ)(l.Z,{style:{marginTop:"20px"},layout:"inline"},(0,B.tZ)(z,{label:(0,A.t)("Username"),name:"username"},(0,B.tZ)(r.Z,{value:null==(e=p.authValue)?void 0:e.username,onChange:this.handerUsername})),(0,B.tZ)(z,{label:(0,A.t)("Password"),name:"password"},(0,B.tZ)(r.Z.Password,{value:null==(t=p.authValue)?void 0:t.password,onChange:this.handerPassword})))):""),dynamicToken:(0,B.tZ)("div",null,(0,B.tZ)("div",{style:{display:"flex",justifyContent:"space-around"}},(0,B.tZ)(r.Z,{style:{width:"160px"},placeholder:(0,A.t)("key"),onChange:e=>this.setState({tokenApi:{...this.state.tokenApi,key:e.currentTarget.value}}),value:this.state.tokenApi.key}),(0,B.tZ)(i.Z,{value:this.state.tokenApi.value.name,showSearch:!0,onChange:e=>this.setState({tokenApi:{...this.state.tokenApi,value:{api_table_id:e.split("&")[0],name:e.split("&")[1]}}}),style:{width:160},placeholder:(0,A.t)("Search to Select"),optionFilterProp:"children",filterOption:(e,t)=>{var a;return(null!=(a=null==t?void 0:t.label)?a:"").includes(e)},filterSort:(e,t)=>{var a,s;return(null!=(a=null==e?void 0:e.label)?a:"").toLowerCase().localeCompare((null!=(s=null==t?void 0:t.label)?s:"").toLowerCase())},options:f.map((e=>({label:e.name,value:e.api_table_id+"&"+e.name})))})))},Y=[{key:"requestHeader",tab:(0,A.t)("Request header")},{key:"queryParameter",tab:(0,A.t)("Query parameter")},{key:"requestor",tab:(0,A.t)("Requestor")},{key:"authenticationConfiguration",tab:(0,A.t)("Authentication Configuration")},{key:"dynamicToken",tab:(0,A.t)("Dynamic Token")}],ee=[{title:(0,A.t)("Parsing Fields"),dataIndex:"name",key:"name"},{title:(0,A.t)("Field renaming"),dataIndex:"Field_renaming",key:"Field_renaming",width:"33%"},{title:(0,A.t)("Field Type"),dataIndex:"field_type",key:"field_type",width:"23%"}],te={checkStrictly:!1,selectedRowKeys:v,onSelect:(e,t,a,s)=>{this.tabelcolumns(a),this.tabeldata(a);const n=this.getSelectedRowKeys(a,e,t);this.getdatapath(a),this.setState({selectedRows:n,selectedRowKeys:n.map((e=>e.key))})},onSelectAll:(e,t,a)=>{this.tabelcolumns(t),this.tabeldata(t);let s=null;t.length>0?t.map((a=>{s=this.getSelectedRowKeys(t,a,e)})):s=this.getSelectedRowKeys(t,{},e),this.getdatapath(t),this.setState({selectedRows:s,selectedRowKeys:s.map((e=>e.key))})},renderCell:(e,t,a,s)=>t.type&&t.children||t.type>1?null:s,onChange:(e,t,a)=>{this.setState({selectedRowKeys:e})}},ae=(0,B.tZ)("div",null,(0,B.tZ)("div",{className:"box1"},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("Basic information"))),(0,B.tZ)(l.Z,{className:"form",layout:"vertical",validateTrigger:"onBlur",initialValues:p,ref:this.oneContentRef},(0,B.tZ)(z,{label:(0,A.t)("name"),name:"name",style:{marginTop:"10px"},rules:[{required:!0,message:()=>(0,A.t)("Please enter a name")}]},(0,B.tZ)(r.Z,{onChange:e=>{this.tableName(e)},placeholder:(0,A.t)("Please enter a name")})),(0,B.tZ)(z,{label:(0,A.t)("ask"),style:{marginTop:"10px"}},(0,B.tZ)(r.Z.Group,{compact:!0},(0,B.tZ)(z,{name:"method"},(0,B.tZ)(i.Z,{onChange:e=>this.requestFor(e)},(0,B.tZ)(M,{value:"GET"},"GET"),(0,B.tZ)(M,{value:"POST"},"POST"))),(0,B.tZ)(z,{rules:[{required:!0,message:()=>(0,A.t)("Please enter the URL address")}],name:"url"},(0,B.tZ)(r.Z,{value:"url",onChange:e=>this.setState({addTableForm:{...p,url:e.target.value}}),style:{width:"383px"},placeholder:(0,A.t)("Please enter the complete address")})))),(0,B.tZ)("div",{className:"box1"},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("Request parameters"))),(0,B.tZ)(P.Z,{style:{width:"100%",marginTop:"10px"},tabList:"POST"===p.method?Y:Y.filter((e=>"requestor"!==e.key)),activeTabKey:m,onTabChange:e=>{this.onTabChange(e)}},X[m])),(0,B.tZ)("div",{style:{display:"none"}},(0,B.tZ)("div",{className:"text"},(0,A.t)("Is JsonPath specified")),(0,B.tZ)(H,{style:{marginTop:"10px"},addonBefore:(0,B.tZ)(i.Z,{onChange:this.jsonPathChange,value:p.isJsonPath},(0,B.tZ)(M,{value:"correct"},(0,A.t)("correct")),(0,B.tZ)(M,{value:"deny"},(0,A.t)("deny"))),placeholder:(0,A.t)("Please enter JsonPath"),allowClear:!0,onSearch:this.searchApiData,enterButton:(0,A.t)("View API data structure"),disabled:p.disabled})),(0,B.tZ)("div",{style:{display:"none"}},(0,B.tZ)("div",{className:"box1"},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("data structure"))),(0,B.tZ)(P.Z,{style:{marginTop:"15px"}},(0,B.tZ)(d.Z,{className:"table",pagination:!1,dataSource:p.apiDataTree,expandable:{expandedRowRender:e=>(0,B.tZ)("p",{style:{margin:0}},e.description),rowExpandable:e=>"Not Expandable"!==e.name},size:"small"},(0,B.tZ)(G,{dataIndex:"name",title:(0,A.t)("Parsing Fields")}))))),se=(0,B.tZ)("div",null,(0,B.tZ)("div",{className:"box1"},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("data structure"))),(0,B.tZ)(P.Z,{style:{marginTop:"15px"}},(0,B.tZ)(d.Z,{rowSelection:{...te},columns:ee,dataSource:T,pagination:!1,expandable:{expandIcon:({expanded:e,onExpand:t,record:a})=>a.children?e?(0,B.tZ)(E.default,{style:{marginRight:"10px"},onClick:e=>t(a,e)}):(0,B.tZ)(J.default,{style:{marginRight:"10px"},onClick:e=>t(a,e)}):null}})),(0,B.tZ)("div",{className:"box1",style:{position:"relative",marginBottom:"20px"}},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("Data Preview")),(0,B.tZ)("div",{style:{position:"absolute",right:"0px",fontSize:"14px",cursor:"pointer",color:"#5D9CEC"}},(0,B.tZ)(V.default,{onClick:this.getviewdata}))),(0,B.tZ)(d.Z,{rowKey:"key",columns:y,dataSource:b,pagination:!1,scroll:{x:!0},style:{padding:"0"}})),ne=[{title:(0,A.t)("Connect API"),key:"1",content:(0,B.tZ)("div",null,ae)},{title:(0,A.t)("Extract data"),key:"2",content:(0,B.tZ)("div",null,se)}];return(0,B.tZ)("div",null,(0,B.tZ)("div",{className:"apiassemblydiv"},(0,B.tZ)("div",{className:"topbtn"},(0,B.tZ)("div",null,(0,B.tZ)(C.Z,null,(0,B.tZ)(K.default,{onClick:()=>this.cancel()}),(0,B.tZ)("span",null,w?(0,A.t)("New API Database"):(0,A.t)("Edit API Database")))),(0,B.tZ)("div",null,(0,B.tZ)(C.Z,null,(0,B.tZ)(h.Z,{onClick:()=>this.cancel()},(0,A.t)("Cancel")),(0,B.tZ)(h.Z,{onClick:this.verification},(0,A.t)("verification")),(0,B.tZ)(h.Z,{type:"primary",onClick:this.next},(0,A.t)("preserve"))))),(0,B.tZ)("div",{className:"box"},(0,B.tZ)("div",{className:"title"},(0,B.tZ)("div",{className:"left"},(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("div",{className:"title-text"},(0,A.t)("essential information")))),(0,B.tZ)(l.Z,{className:"form",layout:"vertical",initialValues:a,validateTrigger:"onBlur",ref:this.formRef},(0,B.tZ)(z,{name:"showName",label:(0,A.t)("Display Name"),rules:[{required:!0,message:()=>(0,A.t)("Please enter a name")}]},(0,B.tZ)(r.Z,null)),(0,B.tZ)(z,{name:"type",label:(0,A.t)("type"),rules:[{required:!0}]},(0,B.tZ)(i.Z,{options:[{value:"token_api",label:"TOKEN API"},{value:"api",label:"API"}],onSelect:e=>this.setState({apiDatasetForm:{...this.state.apiDatasetForm,type:e}},(()=>{this.formRef.current.setFieldsValue({type:e})}))})),(0,B.tZ)(z,{name:"desc",label:(0,A.t)("describe")},(0,B.tZ)(r.Z.TextArea,{showCount:!0,maxLength:50}))),(0,B.tZ)("div",{className:"title"},(0,B.tZ)("div",{className:"left",style:{display:"flex",height:"16px",justifyContent:"space-between",alignItems:"center",width:"100%",marginTop:"20px"}},(0,B.tZ)("div",null,(0,B.tZ)("span",{className:"span"}),(0,B.tZ)("span",null,(0,A.t)("Data Table"))),(0,B.tZ)("div",null,(0,B.tZ)(h.Z,{type:"primary",onClick:this.addCard},(0,B.tZ)($.default,null),(0,A.t)("Add"))))),(0,B.tZ)("div",{className:"cardheghit"},a.dataTables.length>0&&""!=a.dataTables[0].url?a.dataTables.map(((e,t)=>{var a,s;return(0,B.tZ)(P.Z,{className:"card",key:e.id},(0,B.tZ)("div",{className:"oneLine"},(0,B.tZ)("div",{className:"left",style:{display:"flex",alignItems:"center"}},(0,B.tZ)("span",{className:"span"},e.name),1==e.status?(0,B.tZ)(N.Z,{color:"green"},(0,A.t)("effective")):(0,B.tZ)(N.Z,{color:"red"},(0,A.t)("invalid"))),(0,B.tZ)("div",{className:"right"},(0,B.tZ)(L.default,{className:"copy",onClick:()=>this.copy(e,t)}),(0,B.tZ)(R.default,{onClick:()=>this.del(t)}))),(0,B.tZ)("div",{className:"twoLine",style:{cursor:"pointer"},onClick:()=>this.clickCard(e)},(0,B.tZ)("div",{className:"left"},(0,B.tZ)("div",null,(0,A.t)("Request Method")),(0,B.tZ)("div",null,null==e||null==(a=e.configuration)?void 0:a.method)),(0,B.tZ)("div",{className:"right"},(0,B.tZ)("div",null,"URL"),(0,B.tZ)("div",null,null==e||null==(s=e.configuration)?void 0:s.url))))})):(0,B.tZ)(_.Z,{style:{width:"100%"},image:_.Z.PRESENTED_IMAGE_SIMPLE}))),u&&(0,B.tZ)(j.Z,{visible:u,className:"drawer",title:(0,A.t)("data sheet"),placement:"right",width:830,onClose:()=>{this.handerApiDeawercel(),this.emptyapidmodeldata()},footerStyle:{textAlign:"right"},footer:[(0,B.tZ)(C.Z,{key:c},(0,B.tZ)(h.Z,{onClick:()=>{this.handerApiDeawercel(),this.emptyapidmodeldata()}},(0,A.t)("Cancel")),1==c?(0,B.tZ)(h.Z,{onClick:this.back},(0,A.t)("Back")):"",(0,B.tZ)(h.Z,{type:"primary",onClick:this.save,loading:Z,disabled:1==c&&0==v.length},1==c?(0,A.t)("preserve"):(0,A.t)("next step")))]},a.dataTables[0].method?null:(0,B.tZ)(o.Z,{className:"steps",current:c,size:"small",labelPlacement:"vertical"},ne.map((e=>(0,B.tZ)(U,{key:e.title,title:e.title})))),(0,B.tZ)("div",{className:"steps-content"},ne[c].content))))}}const Q=W},727989:(e,t,a)=>{a.d(t,{Z:()=>v});var s=a(150361),n=a.n(s),r=a(667294),o=a(748086),i=a(970553),d=a(751995),l=a(431069),u=a(455867),h=a(268084),c=a(835932),p=a(774069),m=a(49937),y=a(34858),b=a(762921),T=a(211965);const Z=d.iK.div`
  display: block;
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,g=d.iK.div`
  padding-bottom: ${({theme:e})=>2*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;

  & > div {
    margin: ${({theme:e})=>e.gridUnit}px 0;
  }

  &.extra-container {
    padding-top: 8px;
  }

  .confirm-overwrite {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }

  .input-container {
    display: flex;
    align-items: center;

    label {
      display: flex;
      margin-right: ${({theme:e})=>2*e.gridUnit}px;
    }

    i {
      margin: 0 ${({theme:e})=>e.gridUnit}px;
    }
  }

  input,
  textarea {
    flex: 1 1 auto;
  }

  textarea {
    height: 160px;
    resize: none;
  }

  input::placeholder,
  textarea::placeholder {
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }

  textarea,
  input[type='text'],
  input[type='number'] {
    padding: ${({theme:e})=>1.5*e.gridUnit}px
      ${({theme:e})=>2*e.gridUnit}px;
    border-style: none;
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-radius: ${({theme:e})=>e.gridUnit}px;

    &[name='name'] {
      flex: 0 1 auto;
      width: 40%;
    }

    &[name='sqlalchemy_uri'] {
      margin-right: ${({theme:e})=>3*e.gridUnit}px;
    }
  }
`,v=({resourceName:e,resourceLabel:t,passwordsNeededMessage:a,confirmOverwriteMessage:s,onModelImport:d,show:v,onHide:f,passwordFields:k=[],setPasswordFields:S=(()=>{}),DealList:x})=>{const[w,F]=(0,r.useState)(!0),[q,P]=(0,r.useState)(!1),[C,N]=(0,r.useState)({}),[_,j]=(0,r.useState)(!1),[D,A]=(0,r.useState)(!1),[I,O]=(0,r.useState)([]),[R,E]=(0,r.useState)(!1),[J,V]=(0,r.useState)(),[K,$]=(0,r.useState)([]),[L,B]=(0,r.useState)(null),[H,U]=(0,r.useState)([]),[M,G]=(0,r.useState)(null),[z,W]=(0,r.useState)([]),[Q,X]=(0,r.useState)(null),[Y,ee]=(0,r.useState)([]),[te,ae]=(0,r.useState)(null),se=()=>{O([]),S([]),N({}),j(!1),A(!1),E(!1),V(""),B(null),G(null),X(null),ae(null)};(0,r.useEffect)((()=>{v&&!q&&(ne("datasource"),"dataset"==e&&ne("dataset"),"chart"==e&&(ne("dataset"),ne("chart")),"dashboard"==e&&(ne("dataset"),ne("chart"),ne("dashboard")))}),[v]);const ne=e=>{l.Z.get({endpoint:`/api/v2/${e}/group/`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){const a=re(n()(t.json.meta.data),"");"dataset"==e&&$(a),"datasource"==e&&U(a),"chart"==e&&W(a),"dashboard"==e&&ee(a),P(!0)}else P(!1),o.ZP.error(t.json.meta.message)}))},re=(e,t)=>{const a=[];return e.forEach((e=>{const s={title:e.name,allname:`${t?t+"-":""}${e.name}`,key:e.group_id,value:e.group_id,disabled:e.perm<4,children:re(e.children,e.name)};(!s.disabled||s.children.length>0)&&a.push(s)})),a},{state:{alreadyExists:oe,passwordsNeeded:ie},importResource:de}=(0,y.PW)(e,t,(e=>{V(e)}));(0,r.useEffect)((()=>{S(ie),ie.length>0&&E(!1)}),[ie,S]),(0,r.useEffect)((()=>{j(oe.length>0),oe.length>0&&E(!1)}),[oe,j]);const le=e=>{var t,a;const s=null!=(t=null==(a=e.currentTarget)?void 0:a.value)?t:"";A(s.toUpperCase()===(0,u.t)("OVERWRITE"))};w&&v&&F(!1);return(0,T.tZ)(p.Z,{name:"model",className:"import-model-modal",disablePrimaryButton:0===I.length||_&&!D||R,onHandledPrimaryAction:()=>{var t;if(!((null==(t=I[0])?void 0:t.originFileObj)instanceof File))return;let a=L,s=M,n=Q,r=te;return s&&("dataset"!=e||a)&&("chart"!=e||n||a)&&("dashboard"!=e||n||r||a)?(E(!0),de(I[0].originFileObj,C,D,a,s,n,r).then((e=>!!e&&(o.ZP.success((0,u.t)("success")),se(),d(),null==x||x(),!1))),!1):o.ZP.error((0,u.t)("Select Group"))},onHide:()=>{F(!0),f(),se()},primaryButtonName:_?(0,u.t)("Overwrite"):(0,u.t)("Import"),primaryButtonType:_?"danger":"primary",width:"750px",show:v,title:(0,T.tZ)("h4",null,(0,u.t)("Import %s",t))},(0,T.tZ)(g,null,(0,T.tZ)("div",null,("chart"==e||"dashboard"==e||"dataset"==e)&&(0,T.tZ)("div",{style:{marginBottom:"20px"}},(0,T.tZ)("span",null,(0,T.tZ)("span",{style:{color:"red"}},"*"),(0,u.t)("dataset"),"\uff1a"),(0,T.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:L,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,u.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{B(e)},treeData:K,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,T.tZ)(h.default,null)})),(0,T.tZ)("div",{style:{marginBottom:"20px"}},(0,T.tZ)("span",null,(0,T.tZ)("span",{style:{color:"red"}},"*"),(0,u.t)("database"),"\uff1a"),(0,T.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:M,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,u.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{G(e)},treeData:H,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,T.tZ)(h.default,null)})),("chart"==e||"dashboard"==e)&&(0,T.tZ)("div",{style:{marginBottom:"20px"}},(0,T.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,T.tZ)("span",{style:{color:"red"}},"*"),(0,u.t)("chart"),"\uff1a"),(0,T.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:Q,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,u.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{X(e)},treeData:z,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,T.tZ)(h.default,null)})),"dashboard"==e&&(0,T.tZ)("div",{style:{marginBottom:"20px"}},(0,T.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,T.tZ)("span",{style:{color:"red"}},"*"),(0,u.t)("dashboard"),"\uff1a"),(0,T.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:te,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,u.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{ae(e)},treeData:Y,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,T.tZ)(h.default,null)})),(0,T.tZ)(m.gq,{name:"modelFile",id:"modelFile","data-test":"model-file-input",accept:".yaml,.json,.yml,.zip",fileList:I,onChange:e=>{O([{...e.file,status:"done"}])},onRemove:e=>(O(I.filter((t=>t.uid!==e.uid))),!1),customRequest:()=>{},disabled:R},(0,T.tZ)(c.Z,{loading:R},(0,u.t)("Select file"))))),J&&(0,T.tZ)(b.Z,{errorMessage:J,showDbInstallInstructions:k.length>0}),0===k.length?null:(0,T.tZ)(r.Fragment,null,(0,T.tZ)("h5",null,(0,u.t)("Database passwords")),(0,T.tZ)(Z,null,a),k.map((e=>(0,T.tZ)(g,{key:`password-for-${e}`},(0,T.tZ)("div",{className:"control-label"},e,(0,T.tZ)("span",{className:"required"},"*")),(0,T.tZ)("input",{name:`password-${e}`,autoComplete:`password-${e}`,type:"password",value:C[e],onChange:t=>N({...C,[e]:t.target.value})}))))),_?(0,T.tZ)(r.Fragment,null,(0,T.tZ)(g,null,(0,T.tZ)("div",{className:"confirm-overwrite"},s),(0,T.tZ)("div",{className:"control-label"},(0,u.t)('Type "%s" to confirm',(0,u.t)("OVERWRITE"))),(0,T.tZ)("input",{"data-test":"overwrite-modal-input",id:"overwrite",type:"text",onChange:le}))):null)}}}]);