"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[28594],{133576:(e,t,a)=>{a.d(t,{Z:()=>f});var l=a(667294),n=a(981945),o=a(814277),i=a(828216),s=a(542170),u=a(973935),r=a(226618),d=a(211965);const c={minWidth:"60px",width:"100%",height:"30px",lineHeight:"15px",textAlign:"center",fontSize:"12px",background:"#f0f2f5",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},v=(e,t)=>{const{data:a,options:v,multiSelect:f,onSelectionChange:m=(()=>{}),filterState:h,id:p}=e,g=(0,i.v9)((e=>e.dashboardState.mobileFilterStatus)),b=(0,i.v9)((e=>e.dashboardState.drawerStatus)),[S,Z]=(0,l.useState)(h.value?h.value:[]),[w,y]=(0,l.useState)(h.value?h.value:[]),[C,k]=(0,l.useState)(null);(0,l.useEffect)((()=>{b&&h.value&&(0,u.unstable_batchedUpdates)((()=>{Z(h.value?h.value:[]),y(h.value?h.value:[])}))}),[b]),(0,l.useImperativeHandle)(t,(()=>({viewValus:e=>{Z(e)},viewIndex:e=>{y(e)}})),[]);const F=(e,t)=>{if(f)if(S.includes(e)){const a=S.filter((t=>t!==e)),l=w.filter((e=>e!==t));Z(a),y(l),m(a,l)}else{const a=[...S,e],l=[...w,t];Z(a),y(l),m(a,l)}else S.includes(e)?(Z([]),y(""),m([],"")):(Z([e]),y(t),m([e],t))},M=()=>{a.onOpen(),m(S,w,true)};let x=null;const E=e=>t=>{t.preventDefault(),x=setTimeout((()=>{k(e)}),500)},N=()=>{k(null),clearTimeout(x)};return(0,l.useEffect)((()=>{if(h.label){const e=v.find((e=>e.label===h.label));e&&!1===f&&y(e.label)}else y([])}),[h.label]),(0,s.Z)((()=>{!g.confirm&&g.reset&&(Z([]),y([]))}),[JSON.stringify(g)]),(0,d.tZ)(l.Fragment,null,v.length>0?(0,d.tZ)(n.rj,{columns:3,gap:8},v.length>8?(0,d.tZ)(l.Fragment,null,v.slice(0,8).map((e=>(0,d.tZ)(n.rj.Item,{key:`${p}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value},(0,d.tZ)(n.zx,{shape:"rounded",style:{...c,background:S.includes(e.value)?r.Fu:"#f0f2f5",color:S.includes(e.value)?r.zP:"#000000"},onClick:()=>F(e.value,e.label),onTouchStart:E(e.value),onTouchEnd:N,onMouseDown:E(e.value),onMouseUp:N},e.label))))),(0,d.tZ)(n.rj.Item,{span:1},(0,d.tZ)(n.zx,{shape:"rounded",onClick:M,style:{...c}},"\u5c55\u5f00"))):v.map((e=>(0,d.tZ)(n.rj.Item,{key:`${p}-${e.value}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value,onVisibleChange:e=>{e||k(null)}},(0,d.tZ)(n.zx,{shape:"rounded",style:{...c,background:S.includes(e.value)?r.Fu:r.hR,color:S.includes(e.value)?r.zP:r.k2},onClick:()=>F(e.value,e.label),onTouchStart:E(e.value),onTouchEnd:N,onMouseDown:E(e.value),onMouseUp:N},e.label?e.label:e.value)))))):(0,d.tZ)(o.Z,{description:"\u6682\u65e0\u6570\u636e"}))},f=(0,l.forwardRef)(v)},828594:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var l=a(667294),n=a(355786),o=a(310581),i=a(662720),s=a(455867),u=a(616355),r=a(714670),d=a.n(r),c=a(828216),v=a(23279),f=a.n(v),m=a(890057),h=a(49937),p=a(427600),g=a(985633),b=a(52004),S=a(174448),Z=a(356080),w=a(618446),y=a.n(w),C=a(981945),k=a(771230),F=a(515746),M=a(609676),x=a(747933),E=a(814277),N=a(867e3),O=a(708509),I=a(555453),T=a(401498),A=a(246789),_=a(133576),D=a(542170),L=a(211965);const R=e=>{var t;return(null==e||null==(t=e.value)?void 0:t.length)>0?e.value:[]},$=e=>{const{onClose:t=(()=>{}),onOpen:a=(()=>{}),visible:n,data:o,options:i,id:s,name:u,onConfirm:r=(()=>{}),multiSelect:d,filterState:v}=e,f=(0,c.v9)((e=>e.dashboardState.mobileFilterType)),m=(0,c.v9)((e=>e.dashboardState.mobileFilterStatus)),h=(0,c.v9)((e=>e.dashboardState.drawerStatus)),p=((0,c.v9)((e=>{var t;return(null==(t=e.dashboardState)?void 0:t.emulateRatio)||{width:350,height:680}})),(0,c.v9)((e=>e.dashboardState.viewType||"rowAndColumn"))),[g,b]=(0,l.useState)(""),[S,Z]=(0,l.useState)(!1),[w,$]=(0,l.useState)(i),[j,J]=((0,c.v9)((e=>e.dashboardState.editMode)),(0,l.useState)((()=>R(v)))),[B,z]=(0,l.useState)((()=>R(v))),[P,H]=(0,l.useState)(v.label||""),[G,K]=(0,l.useState)(!1),V=()=>{b(""),$(i),t()},U=(0,l.useRef)(),W=(e,t)=>{const{viewValus:a,viewIndex:l}=U.current;a(e),l(t)};(0,l.useEffect)((()=>{n&&!1===G&&(J(R(v)),H(v.label||""))}),[n]);(0,l.useEffect)((()=>{Z(j.length===i.length)}),[j,i]);const q=()=>{J([]),z([]),H(""),b(""),$(i)};return(0,l.useEffect)((()=>{if(m.confirm&&!m.reset){const e=(null==v?void 0:v.value)||[],t=!y()(B,e);Array.isArray(B)&&t&&((null==B?void 0:B.length)>0?r(B):r([]))}!m.confirm&&m.reset&&r([])}),[null==m?void 0:m.confirm,null==m?void 0:m.reset,B]),(0,D.Z)((()=>{"grid"===p&&(m.confirm&&!m.reset&&r(B),!m.confirm&&m.reset&&r([]))}),[JSON.stringify(m),B]),(0,L.tZ)(l.Fragment,null,(0,L.tZ)(N.Z,{id:s,name:u,onClick:a,type:f,multiSelect:d,defaultActiveKey:[s]},(0,L.tZ)(_.Z,{id:s,ref:U,data:e,options:i,multiSelect:d,onSelectionChange:(e,t,a)=>{J(t),H(t),z(e),K(a)},filterState:v})),(0,L.tZ)(O.Z,{visible:n,onMaskClick:()=>{G?(V(),W(B,j)):V()}},(0,L.tZ)(I.Z,null,(0,L.tZ)(T.Z,{text:u}),(0,L.tZ)("div",{className:"inputType"},(0,L.tZ)(C.II,{value:g,onChange:e=>{const t=e.trim();b(t);const a=i.filter((e=>{for(let a in e)if("string"===typeof e[a]||"number"===typeof e[a]){if(String(e[a]).toLowerCase().includes(t))return!0}return!1}));$(a)},placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u641c\u7d22",style:{"--text-align":"center"}})),(0,L.tZ)("div",{className:"warp"},d?(0,L.tZ)(k.Z,{className:"borderBottom"},(0,L.tZ)(F.Z,{className:"margins",span:20},"\u5168\u9009"),(0,L.tZ)(F.Z,{span:4,className:"margins"},(0,L.tZ)(M.Z,{onChange:()=>{S?(J([]),z([])):(J(i.map((e=>e.label))),z(i.map((e=>(null==e?void 0:e.value)||(null==e?void 0:e.label))))),Z(!S)},checked:S}))):null,w.length>0?w.map(((e,t)=>(0,L.tZ)(k.Z,{className:"borderBottom",key:e.label+"_"+e.value},(0,L.tZ)(F.Z,{className:"margins",span:20},e.label),(0,L.tZ)(F.Z,{span:4,className:"margins"},d?(0,L.tZ)(M.Z,{onChange:t=>((e,t)=>{e.target.checked?(J([...j,t.value]),z([...B,t.value])):(J(j.filter((e=>e!==t.value))),z(B.filter((e=>e!==t.value))))})(t,e),checked:j.includes(e.value)}):(0,L.tZ)(x.ZP.Group,{onChange:t=>((e,t)=>{H(e.target.value),z(t.value)})(t,e),value:P,key:e.label},(0,L.tZ)(x.ZP,{value:e.label})))))):(0,L.tZ)(E.Z,{description:"\u6682\u65e0\u6570\u636e"})),(0,L.tZ)(A.Z,{onRest:()=>{G?(q(),W("","")):(r([]),q())},onConfirm:()=>{0===h?G?(r(B),V(),W(B,j)):(r(B),V()):(W(B,j),t())}}))))};function j(e,t){switch(t.type){case"ownState":return e.ownState={...e.ownState,...t.ownState},e;case"filterState":return e.extraFormData=t.extraFormData,e.__cache=t.__cache,e.filterState={...e.filterState,...t.filterState},e;default:return e}}function J(e){const{coltypeMap:t,data:a,filterState:r,formData:v,height:w,isRefreshing:y,width:C,setDataMask:k,setHoveredFilter:F,unsetHoveredFilter:M,setFocusedFilter:x,unsetFocusedFilter:E,setFilterActive:N,appSection:O,showOverflow:I,parentRef:T,inputRef:A,filterBarOrientation:_}=e,{enableEmptyFilter:D,multiSelect:R,showSearch:J,inverseSelection:B,defaultToFirstItem:z,searchAllOptions:P}=v,H=(0,l.useMemo)((()=>(0,n.Z)(v.groupby).map(o.Z)),[v.groupby]),[G]=H,[K]=(0,l.useState)(t),V=(0,c.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_type})),[U,W]=(0,m.C)(j,{extraFormData:{},filterState:r}),q=t[G],Q=(0,l.useMemo)((()=>(0,Z.EG)({timeFormatter:i.Z})),[]),X=(0,l.useCallback)((e=>{const t=D&&!B&&!(null!=e&&e.length),a=B&&null!=e&&e.length?(0,s.t)(" (excluded)"):"";W({type:"filterState",__cache:r,extraFormData:(0,Z.vb)(G,e,t,B),filterState:{...r,label:null!=e&&e.length?`${(e||[]).map((e=>Q(e,q))).join(", ")}${a}`:void 0,value:O===u.Tr.FILTER_CONFIG_MODAL&&z?void 0:e}})}),[O,G,q,z,W,D,B,JSON.stringify(r),Q]),Y=e=>{var t;if("filter-global-change-outter"===(null==e||null==(t=e.data)?void 0:t.type)){e.data.item.fid===v.ftId&&X(null)}};(0,l.useEffect)((()=>(window.addEventListener("message",Y),()=>{window.removeEventListener("message",Y)})),[]),(0,l.useEffect)((()=>{X(r.value)}),[JSON.stringify(r.value)]);const ee=O===u.Tr.FILTER_CONFIG_MODAL&&z,te=(0,l.useCallback)(f()((e=>{W({type:"ownState",ownState:{coltypeMap:K,search:e}})}),p.M$),[]),ae=(0,l.useCallback)((e=>{P&&te(e)}),[te,P]),le=(0,l.useCallback)((()=>{P&&W({type:"ownState",ownState:{coltypeMap:K,search:null}})}),[W,K,P]),ne=(0,l.useCallback)((()=>{le(),E()}),[le,E]),oe=(0,l.useCallback)((e=>{const t=null===e?[null]:(0,n.Z)(e);0===t.length?X(null):X(t)}),[X]);(0,l.useEffect)((()=>{if(z&&void 0===r.value){const e=a[0]?H.map((e=>a[0][e])):null;void 0!==(null==e?void 0:e[0])&&X(e)}else X(ee?null:r.value)}),[G,ee,z,D,B,X,a,H,JSON.stringify(r)]),(0,l.useEffect)((()=>{k(U)}),[JSON.stringify(U)]);const ie=0===a.length?(0,s.t)("No data"):(0,s.tn)("%s option","%s options",a.length,a.length),se=(0,l.useMemo)((()=>{if(r.validateMessage)return(0,L.tZ)(S.Am,{status:r.validateStatus},r.validateMessage)}),[r.validateMessage,r.validateStatus]),ue=(0,l.useMemo)((()=>{const e=[];return a.forEach((t=>{const[a]=H.map((e=>t[e]));e.push({label:Q(a,q),value:a})})),e}),[a,q,H,Q]);(0,l.useEffect)((()=>{ue.length>0&&v.defaultToFirstItem&&X([ue[0].value])}),[ue]);const re=(0,l.useCallback)(((e,t)=>{const a=(0,g.mj)("label");return v.sortAscending?a(e,t):a(t,e)}),[v.sortAscending]);let de=I?()=>(null==T?void 0:T.current)||document.body:e=>(null==e?void 0:e.parentNode)||document.body;const ce=d().generate();"grid"===V&&(de=()=>document.body);const[ve,fe]=(0,l.useState)(!1);return(0,c.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode}))===b.kB.MOBILE?(0,L.tZ)($,{id:null==v?void 0:v.ftId,name:null==v?void 0:v.ftName,data:e,visible:ve,onClose:()=>fe(!1),onOpen:()=>fe(!0),options:ue,filterState:r,multiSelect:R,onConfirm:e=>{oe(e),fe(!1)}}):(0,L.tZ)(S.un,{height:w,width:C},(0,L.tZ)(S.jp,{validateStatus:r.validateStatus,extra:se},(0,L.tZ)("div",{id:ce}),(0,L.tZ)(h.Ph,{allowClear:!0,allowNewOptions:!0,value:r.value||[],disabled:ee,getPopupContainer:de,showSearch:J,mode:R?"multiple":"single",placeholder:ie,onSearch:ae,onSelect:le,onBlur:ne,onFocus:x,onMouseEnter:F,onMouseLeave:M,onChange:oe,ref:A,loading:y,oneLine:_===b.Bp.HORIZONTAL,invertSelection:B,options:ue,sortComparator:re,onDropdownVisibleChange:N})))}},174448:(e,t,a)=>{a.d(t,{Am:()=>s,jp:()=>i,un:()=>o});var l=a(751995),n=a(804591);const o=l.iK.div`
  min-height: ${({height:e})=>e}px;
  width: ${({width:e})=>e}px;
`,i=(0,l.iK)(n.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,s=l.iK.div`
  color: ${({theme:e,status:t="error"})=>{var a;return null==(a=e.colors[t])?void 0:a.base}};
`}}]);