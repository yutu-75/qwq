(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[85656],{875443:(e,t,a)=>{"use strict";a.d(t,{Z:()=>S});var n=a(722122),s=a(428481),o=a(667294),l=a(294184),i=a.n(l),r=a(668855),d=a(915105),c=a(931097),u=a(71577),p=a(832413),m=a(342051),h=a(885636),Z=a(65632),g=a(381643),v=a(796159),f=void 0,y=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a},b=o.forwardRef((function(e,t){var a=o.useState(e.visible),l=(0,s.Z)(a,2),r=l[0],b=l[1];o.useEffect((function(){"visible"in e&&b(e.visible)}),[e.visible]),o.useEffect((function(){"defaultVisible"in e&&b(e.defaultVisible)}),[e.defaultVisible]);var S=function(t,a){"visible"in e||b(t),e.onVisibleChange&&e.onVisibleChange(t,a)},x=function(t){S(!1,t),e.onConfirm&&e.onConfirm.call(f,t)},w=function(t){S(!1,t),e.onCancel&&e.onCancel.call(f,t)},C=o.useContext(Z.E_).getPrefixCls,k=e.prefixCls,_=e.placement,P=e.children,j=e.overlayClassName,D=y(e,["prefixCls","placement","children","overlayClassName"]),N=C("popover",k),E=C("popconfirm",k),I=i()(E,j),T=o.createElement(m.Z,{componentName:"Popconfirm",defaultLocale:h.Z.Popconfirm},(function(t){return function(t,a){var s=e.okButtonProps,l=e.cancelButtonProps,i=e.title,r=e.cancelText,d=e.okText,c=e.okType,m=e.icon;return o.createElement("div",{className:"".concat(t,"-inner-content")},o.createElement("div",{className:"".concat(t,"-message")},m,o.createElement("div",{className:"".concat(t,"-message-title")},(0,g.Z)(i))),o.createElement("div",{className:"".concat(t,"-buttons")},o.createElement(u.Z,(0,n.Z)({onClick:w,size:"small"},l),r||a.cancelText),o.createElement(u.Z,(0,n.Z)({onClick:x},(0,p.n)(c),{size:"small"},s),d||a.okText)))}(N,t)}));return o.createElement(c.Z,(0,n.Z)({},D,{prefixCls:N,placement:_,onVisibleChange:function(t){e.disabled||S(t)},visible:r,overlay:T,overlayClassName:I,ref:t}),(0,v.Tm)(P,{onKeyDown:function(e){var t,a;o.isValidElement(P)&&(null===(a=null===P||void 0===P?void 0:(t=P.props).onKeyDown)||void 0===a||a.call(t,e)),function(e){e.keyCode===d.Z.ESC&&r&&S(!1,e)}(e)}}))}));b.defaultProps={transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary",icon:o.createElement(r.Z,null),disabled:!1};const S=b},187185:(e,t,a)=>{var n=a(345652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?n(e,void 0,t):[]}},727989:(e,t,a)=>{"use strict";a.d(t,{Z:()=>b});var n=a(150361),s=a.n(n),o=a(667294),l=a(748086),i=a(970553),r=a(751995),d=a(431069),c=a(455867),u=a(268084),p=a(835932),m=a(774069),h=a(49937),Z=a(34858),g=a(762921),v=a(211965);const f=r.iK.div`
  display: block;
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,y=r.iK.div`
  padding-bottom: ${({theme:e})=>2*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;

  & > div {
    margin: ${({theme:e})=>e.gridUnit}px 0;
  }

  &.extra-container {
    padding-top: 8px;
  }

  .confirm-overwrite {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }

  .input-container {
    display: flex;
    align-items: center;

    label {
      display: flex;
      margin-right: ${({theme:e})=>2*e.gridUnit}px;
    }

    i {
      margin: 0 ${({theme:e})=>e.gridUnit}px;
    }
  }

  input,
  textarea {
    flex: 1 1 auto;
  }

  textarea {
    height: 160px;
    resize: none;
  }

  input::placeholder,
  textarea::placeholder {
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }

  textarea,
  input[type='text'],
  input[type='number'] {
    padding: ${({theme:e})=>1.5*e.gridUnit}px
      ${({theme:e})=>2*e.gridUnit}px;
    border-style: none;
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-radius: ${({theme:e})=>e.gridUnit}px;

    &[name='name'] {
      flex: 0 1 auto;
      width: 40%;
    }

    &[name='sqlalchemy_uri'] {
      margin-right: ${({theme:e})=>3*e.gridUnit}px;
    }
  }
`,b=({resourceName:e,resourceLabel:t,passwordsNeededMessage:a,confirmOverwriteMessage:n,onModelImport:r,show:b,onHide:S,passwordFields:x=[],setPasswordFields:w=(()=>{}),DealList:C})=>{const[k,_]=(0,o.useState)(!0),[P,j]=(0,o.useState)(!1),[D,N]=(0,o.useState)({}),[E,I]=(0,o.useState)(!1),[T,O]=(0,o.useState)(!1),[M,A]=(0,o.useState)([]),[$,H]=(0,o.useState)(!1),[R,L]=(0,o.useState)(),[z,K]=(0,o.useState)([]),[F,V]=(0,o.useState)(null),[B,Y]=(0,o.useState)([]),[U,J]=(0,o.useState)(null),[q,W]=(0,o.useState)([]),[G,X]=(0,o.useState)(null),[Q,ee]=(0,o.useState)([]),[te,ae]=(0,o.useState)(null),ne=()=>{A([]),w([]),N({}),I(!1),O(!1),H(!1),L(""),V(null),J(null),X(null),ae(null)};(0,o.useEffect)((()=>{b&&!P&&(se("datasource"),"dataset"==e&&se("dataset"),"chart"==e&&(se("dataset"),se("chart")),"dashboard"==e&&(se("dataset"),se("chart"),se("dashboard")))}),[b]);const se=e=>{d.Z.get({endpoint:`/api/v2/${e}/group/`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){const a=oe(s()(t.json.meta.data),"");"dataset"==e&&K(a),"datasource"==e&&Y(a),"chart"==e&&W(a),"dashboard"==e&&ee(a),j(!0)}else j(!1),l.ZP.error(t.json.meta.message)}))},oe=(e,t)=>{const a=[];return e.forEach((e=>{const n={title:e.name,allname:`${t?t+"-":""}${e.name}`,key:e.group_id,value:e.group_id,disabled:e.perm<4,children:oe(e.children,e.name)};(!n.disabled||n.children.length>0)&&a.push(n)})),a},{state:{alreadyExists:le,passwordsNeeded:ie},importResource:re}=(0,Z.PW)(e,t,(e=>{L(e)}));(0,o.useEffect)((()=>{w(ie),ie.length>0&&H(!1)}),[ie,w]),(0,o.useEffect)((()=>{I(le.length>0),le.length>0&&H(!1)}),[le,I]);const de=e=>{var t,a;const n=null!=(t=null==(a=e.currentTarget)?void 0:a.value)?t:"";O(n.toUpperCase()===(0,c.t)("OVERWRITE"))};k&&b&&_(!1);return(0,v.tZ)(m.Z,{name:"model",className:"import-model-modal",disablePrimaryButton:0===M.length||E&&!T||$,onHandledPrimaryAction:()=>{var t;if(!((null==(t=M[0])?void 0:t.originFileObj)instanceof File))return;let a=F,n=U,s=G,o=te;return n&&("dataset"!=e||a)&&("chart"!=e||s||a)&&("dashboard"!=e||s||o||a)?(H(!0),re(M[0].originFileObj,D,T,a,n,s,o).then((e=>!!e&&(l.ZP.success((0,c.t)("success")),ne(),r(),null==C||C(),!1))),!1):l.ZP.error((0,c.t)("Select Group"))},onHide:()=>{_(!0),S(),ne()},primaryButtonName:E?(0,c.t)("Overwrite"):(0,c.t)("Import"),primaryButtonType:E?"danger":"primary",width:"750px",show:b,title:(0,v.tZ)("h4",null,(0,c.t)("Import %s",t))},(0,v.tZ)(y,null,(0,v.tZ)("div",null,("chart"==e||"dashboard"==e||"dataset"==e)&&(0,v.tZ)("div",{style:{marginBottom:"20px"}},(0,v.tZ)("span",null,(0,v.tZ)("span",{style:{color:"red"}},"*"),(0,c.t)("dataset"),"\uff1a"),(0,v.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:F,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,c.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{V(e)},treeData:z,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,v.tZ)(u.default,null)})),(0,v.tZ)("div",{style:{marginBottom:"20px"}},(0,v.tZ)("span",null,(0,v.tZ)("span",{style:{color:"red"}},"*"),(0,c.t)("database"),"\uff1a"),(0,v.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:U,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,c.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{J(e)},treeData:B,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,v.tZ)(u.default,null)})),("chart"==e||"dashboard"==e)&&(0,v.tZ)("div",{style:{marginBottom:"20px"}},(0,v.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,v.tZ)("span",{style:{color:"red"}},"*"),(0,c.t)("chart"),"\uff1a"),(0,v.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:G,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,c.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{X(e)},treeData:q,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,v.tZ)(u.default,null)})),"dashboard"==e&&(0,v.tZ)("div",{style:{marginBottom:"20px"}},(0,v.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,v.tZ)("span",{style:{color:"red"}},"*"),(0,c.t)("dashboard"),"\uff1a"),(0,v.tZ)(i.Z,{showSearch:!0,style:{width:"300px"},value:te,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,c.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{ae(e)},treeData:Q,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,v.tZ)(u.default,null)})),(0,v.tZ)(h.gq,{name:"modelFile",id:"modelFile","data-test":"model-file-input",accept:".yaml,.json,.yml,.zip",fileList:M,onChange:e=>{A([{...e.file,status:"done"}])},onRemove:e=>(A(M.filter((t=>t.uid!==e.uid))),!1),customRequest:()=>{},disabled:$},(0,v.tZ)(p.Z,{loading:$},(0,c.t)("Select file"))))),R&&(0,v.tZ)(g.Z,{errorMessage:R,showDbInstallInstructions:x.length>0}),0===x.length?null:(0,v.tZ)(o.Fragment,null,(0,v.tZ)("h5",null,(0,c.t)("Database passwords")),(0,v.tZ)(f,null,a),x.map((e=>(0,v.tZ)(y,{key:`password-for-${e}`},(0,v.tZ)("div",{className:"control-label"},e,(0,v.tZ)("span",{className:"required"},"*")),(0,v.tZ)("input",{name:`password-${e}`,autoComplete:`password-${e}`,type:"password",value:D[e],onChange:t=>N({...D,[e]:t.target.value})}))))),E?(0,v.tZ)(o.Fragment,null,(0,v.tZ)(y,null,(0,v.tZ)("div",{className:"confirm-overwrite"},n),(0,v.tZ)("div",{className:"control-label"},(0,c.t)('Type "%s" to confirm',(0,c.t)("OVERWRITE"))),(0,v.tZ)("input",{"data-test":"overwrite-modal-input",id:"overwrite",type:"text",onChange:de}))):null)}},870695:(e,t,a)=>{"use strict";a.d(t,{i5:()=>o});var n=a(130845),s=a(205558);(0,n.Z)(((e,t,a)=>!!a&&Object.values(a).some((a=>a.some((([a,n])=>a===e&&n===t))))));const o=e=>(0,s.A)(e)&&Object.keys(e.roles||{}).some((e=>"admin"===e.toLowerCase()))},159746:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ht});var n=a(205872),s=a.n(n),o=a(667294),l=a(828216),i=a(211965),r=a(929119),d=a(115926),c=a.n(d),u=a(997183),p=a(748086),m=a(931097),h=a(722122),Z=a(28991),g=a(896156),v=a(306610),f=a(5991),y=a(110379),b=a(460446),S=a(34203),x=a(294184),w=a.n(x),C=a(915105);var k=function(e){(0,y.Z)(a,e);var t=(0,b.Z)(a);function a(){var e;return(0,v.Z)(this,a),(e=t.apply(this,arguments)).onHover=function(t){var a=e.props;(0,a.onHover)(t,a.index)},e.onClick=function(t){var a=e.props;(0,a.onClick)(t,a.index)},e.onKeyDown=function(t){var a=e.props,n=a.onClick,s=a.index;13===t.keyCode&&n(t,s)},e}return(0,f.Z)(a,[{key:"getClassName",value:function(){var e=this.props,t=e.prefixCls,a=e.index,n=e.value,s=e.allowHalf,o=e.focused,l=a+1,i=t;return 0===n&&0===a&&o?i+=" ".concat(t,"-focused"):s&&n+.5>=l&&n<l?(i+=" ".concat(t,"-half ").concat(t,"-active"),o&&(i+=" ".concat(t,"-focused"))):(i+=" ".concat(t,l<=n?"-full":"-zero"),l===n&&o&&(i+=" ".concat(t,"-focused"))),i}},{key:"render",value:function(){var e=this.onHover,t=this.onClick,a=this.onKeyDown,n=this.props,s=n.disabled,l=n.prefixCls,i=n.character,r=n.characterRender,d=n.index,c=n.count,u=n.value,p="function"===typeof i?i(this.props):i,m=o.createElement("li",{className:this.getClassName()},o.createElement("div",{onClick:s?null:t,onKeyDown:s?null:a,onMouseMove:s?null:e,role:"radio","aria-checked":u>d?"true":"false","aria-posinset":d+1,"aria-setsize":c,tabIndex:s?-1:0},o.createElement("div",{className:"".concat(l,"-first")},p),o.createElement("div",{className:"".concat(l,"-second")},p)));return r&&(m=r(m,this.props)),m}}]),a}(o.Component);function _(){}var P=function(e){(0,y.Z)(a,e);var t=(0,b.Z)(a);function a(e){var n;(0,v.Z)(this,a),(n=t.call(this,e)).onHover=function(e,t){var a=n.props.onHoverChange,s=n.getStarValue(t,e.pageX);s!==n.state.cleanedValue&&n.setState({hoverValue:s,cleanedValue:null}),a(s)},n.onMouseLeave=function(){var e=n.props.onHoverChange;n.setState({hoverValue:void 0,cleanedValue:null}),e(void 0)},n.onClick=function(e,t){var a=n.props.allowClear,s=n.state.value,o=n.getStarValue(t,e.pageX),l=!1;a&&(l=o===s),n.onMouseLeave(),n.changeValue(l?0:o),n.setState({cleanedValue:l?o:null})},n.onFocus=function(){var e=n.props.onFocus;n.setState({focused:!0}),e&&e()},n.onBlur=function(){var e=n.props.onBlur;n.setState({focused:!1}),e&&e()},n.onKeyDown=function(e){var t=e.keyCode,a=n.props,s=a.count,o=a.allowHalf,l=a.onKeyDown,i="rtl"===a.direction,r=n.state.value;t===C.Z.RIGHT&&r<s&&!i?(r+=o?.5:1,n.changeValue(r),e.preventDefault()):t===C.Z.LEFT&&r>0&&!i||t===C.Z.RIGHT&&r>0&&i?(r-=o?.5:1,n.changeValue(r),e.preventDefault()):t===C.Z.LEFT&&r<s&&i&&(r+=o?.5:1,n.changeValue(r),e.preventDefault()),l&&l(e)},n.saveRef=function(e){return function(t){n.stars[e]=t}},n.saveRate=function(e){n.rate=e};var s=e.value;return void 0===s&&(s=e.defaultValue),n.stars={},n.state={value:s,focused:!1,cleanedValue:null},n}return(0,f.Z)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.autoFocus,a=e.disabled;t&&!a&&this.focus()}},{key:"getStarDOM",value:function(e){return(0,S.Z)(this.stars[e])}},{key:"getStarValue",value:function(e,t){var a,n,s,o,l=this.props,i=l.allowHalf,r="rtl"===l.direction,d=e+1;if(i){var c=this.getStarDOM(e),u=(n=function(e){var t,a,n=e.ownerDocument,s=n.body,o=n&&n.documentElement,l=e.getBoundingClientRect();return t=l.left,a=l.top,{left:t-=o.clientLeft||s.clientLeft||0,top:a-=o.clientTop||s.clientTop||0}}(a=c),s=a.ownerDocument,o=s.defaultView||s.parentWindow,n.left+=function(e){var t=e.pageXOffset,a="scrollLeft";if("number"!==typeof t){var n=e.document;"number"!==typeof(t=n.documentElement[a])&&(t=n.body[a])}return t}(o),n.left),p=c.clientWidth;(r&&t-u>p/2||!r&&t-u<p/2)&&(d-=.5)}return d}},{key:"focus",value:function(){this.props.disabled||this.rate.focus()}},{key:"blur",value:function(){this.props.disabled||this.rate.blur()}},{key:"changeValue",value:function(e){var t=this.props.onChange;"value"in this.props||this.setState({value:e}),t(e)}},{key:"render",value:function(){for(var e=this.props,t=e.count,a=e.allowHalf,n=e.style,s=e.prefixCls,l=e.disabled,i=e.className,r=e.character,d=e.characterRender,c=e.tabIndex,u=e.direction,p=this.state,m=p.value,h=p.hoverValue,Z=p.focused,v=[],f=l?"".concat(s,"-disabled"):"",y=0;y<t;y+=1)v.push(o.createElement(k,{ref:this.saveRef(y),index:y,count:t,disabled:l,prefixCls:"".concat(s,"-star"),allowHalf:a,value:void 0===h?m:h,onClick:this.onClick,onHover:this.onHover,key:y,character:r,characterRender:d,focused:Z}));var b=w()(s,f,i,(0,g.Z)({},"".concat(s,"-rtl"),"rtl"===u));return o.createElement("ul",{className:b,style:n,onMouseLeave:l?null:this.onMouseLeave,tabIndex:l?-1:c,onFocus:l?null:this.onFocus,onBlur:l?null:this.onBlur,onKeyDown:l?null:this.onKeyDown,ref:this.saveRate,role:"radiogroup"},v)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return"value"in e&&void 0!==e.value?(0,Z.Z)((0,Z.Z)({},t),{},{value:e.value}):t}}]),a}(o.Component);P.defaultProps={defaultValue:0,count:5,allowHalf:!1,allowClear:!0,style:{},prefixCls:"rc-rate",onChange:_,character:"\u2605",onHoverChange:_,tabIndex:0,direction:"ltr"};const j=P;const D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};var N=a(406445),E=function(e,t){return o.createElement(N.Z,(0,Z.Z)((0,Z.Z)({},e),{},{ref:t,icon:D}))};E.displayName="StarFilled";const I=o.forwardRef(E);var T=a(65632),O=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a},M=o.forwardRef((function(e,t){var a=e.prefixCls,n=e.tooltips,s=O(e,["prefixCls","tooltips"]),l=o.useContext(T.E_),i=l.getPrefixCls,r=l.direction,d=i("rate",a);return o.createElement(j,(0,h.Z)({ref:t,characterRender:function(e,t){var a=t.index;return n?o.createElement(m.Z,{title:n[a]},e):e}},s,{prefixCls:d,direction:r}))}));M.displayName="Rate",M.defaultProps={character:o.createElement(I,null)};const A=M;var $=a(948205),H=a(3006),R=a(734041),L=a(751995),z=a(455867),K=a(431069),F=a(958452),V=a(827167),B=a(652924),Y=a(280842),U=a(667496),J=a(440768),q=a(34858),W=a(683862),G=a(419259),X=a(190551),Q=a(217198),ee=a(232228),te=a(418782),ae=a(838703),ne=a(620755),se=a(414114),oe=a(358593),le=a(731293),ie=a(222545),re=a(679789),de=a(608272),ce=a(727989),ue=a(591877),pe=a(593185),me=a(486057),he=a(870695),Ze=a(774069),ge=a(517982);const ve=L.iK.div`
  padding-bottom: 340px;
  width: 65%;
`,fe=(0,se.ZP)((({addDangerToast:e,addSuccessToast:t,onDatasetAdd:a,table_group_id:n,onHide:s,show:l})=>{const[r,d]=(0,o.useState)(),[c,u]=(0,o.useState)(""),[m,h]=(0,o.useState)(""),[Z,g]=(0,o.useState)(!0),{state:{loading:v}}=(0,q.LE)("dataset",(0,z.t)("dataset"),e);(0,o.useEffect)((()=>{g(void 0===r||""===m)}),[m,r]);const f=()=>{u(""),h(""),d(void 0),g(!0),s()};return(0,i.tZ)(Ze.Z,{disablePrimaryButton:Z,primaryButtonLoading:v,onHandledPrimaryAction:()=>{if(void 0===r)return;const e={database:r.id,...c?{schema:c}:{},table_name:m,table_group_id:n};return K.Z.post({endpoint:"/api/v2/dataset/",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>{e&&(200==e.json.meta.code||201==e.json.meta.code?(a&&(p.ZP.success(e.json.meta.message),a({data:e,...e})),f()):p.ZP.error(e.json.meta.message))}))},onHide:f,primaryButtonName:(0,z.t)("Add"),show:l,title:(0,z.t)("Add dataset")},(0,i.tZ)(ve,null,(0,i.tZ)(ge.ZP,{clearable:!1,formMode:!0,database:r,schema:c,tableValue:m,onDbChange:e=>{d(e)},onSchemaChange:e=>{u(e)},onTableSelectChange:e=>{h(e)},handleError:e})))}));var ye=a(454076),be=(a(714670),a(432787)),Se=a(164561),xe=a(99210),we=a(855241),Ce=a(339144),ke=a(911382),_e=a(757016),Pe=a(970553),je=a(519650),De=a(71577),Ne=a(701474),Ee=a(268084),Ie=a(540790),Te=a(432615),Oe=a(370583),Me=a(732194),Ae=a(619702),$e=a(67701),He=a(477017),Re=a(704851),Le=a(192167),ze=a(844760),Ke=a(7737),Fe=(a(309679),a(807500)),Ve=a(753141),Be=a(940287),Ye=a(747933);const{Search:Ue}=be.Z,Je=e=>{const[t,a]=(0,o.useState)(!0),[n,s]=(0,o.useState)(!0),[l,r]=(0,o.useState)(null),[d,c]=(0,o.useState)([]),[u,m]=(0,o.useState)([]),[h,Z]=(0,o.useState)(null),[g,v]=(0,o.useState)(!1),[f,y]=(0,o.useState)(""),[b,S]=(0,o.useState)([]),[x,w]=(0,o.useState)([]),[C,k]=(0,o.useState)([]),[_,P]=(0,o.useState)(""),[j,D]=(0,o.useState)(null),[N,E]=(0,o.useState)(!1);(0,o.useEffect)((()=>{a(e.isApiadd),r(e.table_groupID)}),[e.isApiadd]),(0,o.useEffect)((()=>{I()}),[]);const I=()=>{K.Z.get({endpoint:encodeURI("/api/v2/datasource/api/list/")}).then((e=>{200!=e.json.meta.code&&201!=e.json.meta.code||(e.json.meta.data.map((e=>{e.value=e.id,e.label=e.name})),S(e.json.meta.data))}))},T=e=>{s(e)},O=(e,t)=>{let a=[];return e&&e.length>0&&e.map((e=>{const n=O(e.children,t);return-1!==e.name.indexOf(t)?a.push(e):n&&n.length&&(e.children=n,a.push(e)),!1})),a},M=()=>{e.apiDivnone(),P(""),Z(null),v(!1),y(""),S([]),w([]),k([]),D(null),m([]),c([]),r(null),a(!0),s(!0)};return(0,i.tZ)("div",{className:"contentglapi"},(0,i.tZ)("div",{className:"topbtn"},(0,i.tZ)("div",null,(0,i.tZ)(je.Z,null,(0,i.tZ)(Fe.default,{onClick:()=>M()}),(0,i.tZ)("span",null,t?(0,z.t)("New API Dataset"):(0,z.t)("Edit API Dataset")))),(0,i.tZ)("div",null,(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{type:"primary",onClick:()=>v(!0)},(0,z.t)("Save"))))),(0,i.tZ)("div",{className:"contentdiv"},(0,i.tZ)("div",{className:"leftdiv",style:{display:n?"block":"none"}},(0,i.tZ)("div",null,(0,i.tZ)(je.Z,{direction:"vertical"},(0,i.tZ)("p",{className:"spantext"},(0,z.t)("Datasource")),(0,i.tZ)(R.Z,{style:{width:200},onChange:e=>{Z(e),K.Z.get({endpoint:encodeURI(`/api/v2/datasource/api/${e}/tables/`)}).then((e=>{200!=e.json.meta.code&&201!=e.json.meta.code||(w(e.json.meta.data),k(e.json.meta.data))}))},placeholder:(0,z.t)("Please select a data source"),options:b,value:h}),(0,i.tZ)("p",{style:{marginTop:"20px"},className:"spantext"},(0,z.t)("Data Table")),(0,i.tZ)(be.Z,{onChange:e=>{const t=e.target.value;if(P(t),w(C),t){let e=O(C,t);w(e)}else w(C)},value:_,placeholder:(0,z.t)("Search by Table Name")}),(0,i.tZ)(Ye.ZP.Group,{name:"radiogroup",value:j},x&&x.length>0&&x.map((e=>(0,i.tZ)("p",{style:{marginTop:"10px"},key:e.id},(0,i.tZ)(Ye.ZP,{onChange:()=>(e=>{D(e.id),K.Z.get({endpoint:encodeURI(`/api/v2/dataset/api/${e.id}/preview/?limit=1000`)}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=e.json.meta.data,a=[];for(const e in t[0]){const t={title:e,dataIndex:e,key:e,id:e,width:120,ellipsis:!0};a.push(t)}c(t),m(a)}else p.ZP.error(e.json.meta.message)}))})(e),value:e.id},e.name.length>10?e.name.substr(0,10)+"...":e.name)))))),n&&(0,i.tZ)(Ve.default,{onClick:()=>T(!1),className:"noneicon"})),(0,i.tZ)("div",{className:"uploaddiv"})),!n&&(0,i.tZ)(Be.default,{onClick:()=>T(!0),className:"bockicon"}),(0,i.tZ)("div",{className:"rightdiv"},u.length>0&&d.length>0?(0,i.tZ)(H.Z,{columns:u,dataSource:d,style:{marginTop:"20px",width:"calc(100vw - 260px)"},pagination:!1,rowKey:e=>e.id,scroll:{x:"calc(100vw - 280px)",y:"calc(100vh - 240px)"}}):(0,i.tZ)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"90vh"}},(0,i.tZ)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,i.tZ)("img",{style:{width:"90px"},src:"/static/assets/images/excelnodata.png",alt:""}),(0,i.tZ)("div",{style:{fontSize:"16px",color:"#BBBDBF",marginTop:"20px"}},(0,z.t)("Please select a data source")))))),(0,i.tZ)(_e.Z,{title:(0,z.t)("Dataset name"),width:"450px",visible:g,onCancel:()=>{v(!1),y("")},maskClosable:!1,footer:[(0,i.tZ)("div",{key:"id"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:()=>{v(!1),y("")}},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{loading:N,onClick:()=>(()=>{if(!f)return p.ZP.error((0,z.t)("Please enter a dataset name"));E(!0);let t={api_table_id:j,custom_name:f,datasource_id:h,table_group_id:l,type_classify:3};K.Z.post({endpoint:"/api/v2/dataset/api/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?(M(),e.DealList(),p.ZP.success(t.json.meta.message),E(!1)):(p.ZP.error(t.json.meta.message),E(!1))})).catch((()=>{E(!1)}))})(),type:"primary"},(0,z.t)("Confirm"))))]},(0,i.tZ)("div",null,(0,i.tZ)(be.Z,{onChange:e=>{y(e.target.value)},value:f,placeholder:(0,z.t)("Please enter a dataset name")}))))},{Search:qe}=be.Z,We=Se.Z.Item;let Ge=[],Xe=null;const Qe={adddev_menu:(0,z.t)("New Directory"),adddev_name:(0,z.t)("Directory Name"),name:"",is_dir:"",id:"",pid:"",label:"Add",Shift_menu:"",table_group_id:""};var et={...Qe};const tt=(0,z.t)('The passwords for the databases below are needed in order to import them together with the dashboards. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),at=(0,z.t)("You are importing one or more dashboards that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?");let nt=null;class st extends o.Component{constructor(e){super(e),this.apiDivnone=()=>{this.setState({apiDiv:"none",isApiadd:!1,DataSetID:null,table_groupID:null})},this.getPerm=()=>{K.Z.get({endpoint:"/api/v2/menu/dataset/perm"}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?this.setState({btnperm:e.json.meta.data.perm}):p.ZP.error(e.json.meta.message)}))},this.DealList=()=>{const{selectvalue:e,valuename:t}=this.state;return K.Z.get({endpoint:"/api/v2/dataset/group/"+(t?`?${e}=${t}`:"")}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){e.json.meta.data.forEach((e=>{var t,a;e.icon=(0,i.tZ)(Ee.default,null),e.title=e.name,e.key=e.group_id,e.is_dir=0,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.menu_key=`${e.group_id}`,e.pmenu_img="/static/assets/images/superset-menu-children.png",e.list=[],(null==(t=e.children)?void 0:t.length)>0&&(this.forEach_children(e.children),this.forEach_list(e.children,0,e.list,e.group_id)),(null==(a=e.datasets)?void 0:a.length)>0&&this.forEach_list(e.datasets,1,e.list,e.group_id)}));let t=[];Ge=e.json.meta.data,Ge.map((e=>{t.push(e.key_name)})),Xe=Ge,this.setState({Search_Data:e.json.meta.data,isMenuOpen:!0,rootSubmenuKeys:t})}else p.ZP.error(e.json.meta.message)})).finally((()=>{this.setState({Menuloading:!1})}))},this.menuAdd=(e,t,a,n)=>{if(e.stopPropagation(),0==n)et={...Qe,adddev_menu:(0,z.t)("New Directory"),adddev_name:(0,z.t)("Directory Name"),pid:t,is_dir:n,id:t,name:"",label:"Add"},this.setState({isModalOpen:!0});else if(1==n)et.table_group_id=t,this.setState({datasetAddModalOpen:!0});else if(2==n){const e=(0,U.VU)("/superset/sqllab/"),t="";window.location.href=`${t}${e}`}else 4==n?this.setState({apiDiv:"block",isApiadd:!0,table_groupID:t}):5==n?window.location.href=(0,U.VU)(`/tablemodelview/union/?type=add&datasetId=${t}&unionId=null`):6==n&&(window.location.href=(0,U.VU)(`/tablemodelview/file/?type=add&datasetId=${t}&ExcelId=null`))},this.delete_Popconfirm=e=>{e.stopPropagation()},this.menuEdit=(e,t,a,n,s,o)=>{if(e.stopPropagation(),0==n)et={...Qe,id:t,is_dir:s,Shift_menu:(0,z.t)("take")+o+(0,z.t)("Move to"),name:o,pid:a},this.getControlledMenu(s),this.setState({isModalOpenShift:!0});else if(1==n)et={...Qe,...0==s?{adddev_menu:(0,z.t)("Edit Catalog"),adddev_name:(0,z.t)("Directory Name")}:{adddev_menu:(0,z.t)("Edit Dataset"),adddev_name:(0,z.t)("Dataset name")},is_dir:s,id:t,pid:a,name:o,label:"Edit"},this.setState({isModalOpen:!0});else{if(2==n)return 0==s?K.Z.delete({endpoint:encodeURI(`/api/v2/dataset/group/${t}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList()):p.ZP.error(e.json.meta.message)})):(this.setState({delloading:!0}),K.Z.delete({endpoint:encodeURI(`/api/v2/dataset/${t}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.props.handleRemoveId()):p.ZP.error(e.json.meta.message)})));3==n?window.location.href=(0,U.VU)(`/tablemodelview/file/?type=edit&datasetId=${t}&ExcelId=null`):4==n?window.location.href=(0,U.VU)(`/tablemodelview/union/?type=edit&datasetId=${t}&unionId=null`):5==n&&(window.location.href=(0,U.VU)(`/explore/?datasource_type=table&datasource_id=${t}`))}},this.handleChange=e=>{const t=e.target,a="checkbox"===t.type?t.checked:t.value;"name"==t.name&&(et.name=a),this.setState({})},this.handleClick=e=>{if(nt)clearTimeout(nt),nt=null,nt=setTimeout((()=>{let{selectedKeys:t}=this.state;if(e.key!=t){if(this.setState({selectedKeys:e.key}),1==e.item.props.basicInfo.key_name.split("&&")[1]){const t=[],a=e.item.props.basicInfo.key_name.split("&&")[4],n=e.item.props.basicInfo.key_name.split("&&")[5],s=e.item.props.basicInfo.key_name.split("&&")[6],o=[],{handleChangeMenu:l}=this.props;l(t,o,a,n,s,e.item.props.basicInfo.key_name.split("&&")[2])}nt=null}}),1e3);else{let{selectedKeys:t}=this.state;if(e.key==t)return;if(this.setState({selectedKeys:e.key}),sessionStorage.setItem("key",e.key),sessionStorage.setItem("keyPath",JSON.stringify(e.keyPath.slice(1))),sessionStorage.setItem("chart_basicInfo",JSON.stringify(e.item.props.basicInfo)),1==e.item.props.basicInfo.key_name.split("&&")[1]){const t=[],a=e.item.props.basicInfo.key_name.split("&&"),n=a[4],s=1*a[5],o=a[6],l=[],{handleChangeMenu:i}=this.props;i(t,l,n,s,o,a[2]),this.props.setBasicInfo(e.item.props.basicInfo||{})}nt=setTimeout((()=>{nt=null}),1e3)}},this.handleBlockGet=()=>{const{name:e,pid:t,id:a,is_dir:n,label:s}=et;if(!e)return p.ZP.error((0,z.t)("Please enter a name"));if(0==n){if("Add"==s){const a={name:e,pid:t};return K.Z.post({endpoint:"/api/v2/dataset/group/",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}if("Edit"==s){const n={name:e,pid:t};return K.Z.put({endpoint:`/api/v2/dataset/group/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}}else{if("Add"==s){const t={custom_name:e,table_group_id:a};return K.Z.post({endpoint:"/api/v2/dataset/",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}if("Edit"==s){const n={new_title:e,target_id:t};return K.Z.request({method:"PATCH",endpoint:`/api/v2/dataset/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}}},this.onExpand=e=>{this.setState({expandedKeys:e})},this.onSelect=(e,t)=>{var a=et.id,n=et.is_dir,s=et.name;et={...Qe,id:a,pid:t.node.group_id,is_dir:n,name:s},this.setState({checkedKeys:e})},this.selectonChange=(e,t,a)=>{const n=et.id,s=et.is_dir,o=et.name;et={...et,id:n,pid:e,is_dir:s,name:o},this.setState({checkedvalue:t[0]})},this.handleBlockShift=()=>{const{name:e,pid:t,id:a,is_dir:n}=et;if(0==n){const n={name:e,pid:t};return K.Z.put({endpoint:`/api/v2/dataset/group/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,treeData:[],expandedKeys:[],checkedKeys:[],checkedvalue:null}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}{const n={new_title:e,target_id:t};return K.Z.request({method:"PATCH",endpoint:`/api/v2/dataset/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(p.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,expandedKeys:[],checkedKeys:[],checkedvalue:null}),et={...Qe}):p.ZP.error(e.json.meta.message)}))}},this.openDashboardImportModal=()=>{this.setState({importingDashboard:!0})},this.closeDashboardImportModal=()=>{this.setState({importingDashboard:!1})},this.handleDashboardImport=()=>{this.setState({importingDashboard:!1})},this.Exportwrap=(e,t,a,n,s,o)=>{let l=[];l.push(t),(0,ee.Z)("dataset",l,(()=>{this.setState({preparingExport:!1})})),this.setState({preparingExport:!0})},this.setPasswordFields=e=>{this.setState({passwordFields:e})},this.renderSubMenu=({is_dir:e,list:t,group_id:a,pid:n,icon:s,name:o,pmenu_img:l,key_name:r,perm:d,url:c,menu_key:u})=>(0,i.tZ)(xe.Z.SubMenu,{key:u,title:(0,i.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginLeft:"2px"}},(0,i.tZ)("span",{style:{display:"flex",alignItems:"center",width:"75%"}},-1===this.state.openKeys.indexOf(`${a}`)?(0,i.tZ)(Ee.default,null):(0,i.tZ)(Ie.default,null),(0,i.tZ)("span",{title:o,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},o)),(0,i.tZ)("span",{style:{display:"black",width:"25%"}},d>=4&&(0,i.tZ)("div",{className:"superset-menu-Popover"},0==e&&(0,i.tZ)(we.Z,{overlayClassName:"popovercss",content:(0,i.tZ)("div",null,(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,0)},(0,i.tZ)(Ee.default,null),(0,i.tZ)("span",null," ",(0,z.t)("New Directory"))),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,1)},(0,i.tZ)(le.Z.DatasetSqlicon,{iconColor:"#5D9CEC",style:{fontSize:"16px",verticalAlign:"middle"}}),(0,i.tZ)("span",null,(0,z.t)("New Database Dataset"))),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,2)},(0,i.tZ)(le.Z.DatasetSqllicon,{iconColor:"#FF8800",style:{fontSize:"16px",verticalAlign:"middle"}}),(0,i.tZ)("span",null,(0,z.t)("New SQL Dataset"))),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,4)},(0,i.tZ)(le.Z.DatabaseApi,{iconColor:"#04B49C",style:{fontSize:"16px",verticalAlign:"middle"}}),(0,i.tZ)("span",null,(0,z.t)("New API Dataset"))),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,5)},(0,i.tZ)(le.Z.DatasetUnionicon,{iconColor:"#d136d1",style:{fontSize:"16px",verticalAlign:"middle"}}),(0,i.tZ)("span",null,(0,z.t)("New Associated\xa0Dataset"))),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,6)},(0,i.tZ)(le.Z.DatasetExcleicon,{iconColor:"#34c724",style:{fontSize:"16px",verticalAlign:"middle"}}),(0,i.tZ)("span",null,(0,z.t)("New Excel/CSV/JSON Dataset")))),zIndex:998,trigger:"hover"},(0,i.tZ)(Te.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})),(0,i.tZ)(we.Z,{overlayClassName:"popovercss",content:(0,i.tZ)("div",null,(0,i.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,n,0,e,o)},(0,i.tZ)(Oe.default,{style:{marginRight:"5px"}}),(0,z.t)("Move")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,n,1,e,o)},(0,i.tZ)(Me.default,{style:{marginRight:"5px"}}),(0,z.t)("Rename")),1==e&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,n,3,e,o,c)},(0,z.t)("Edit")),1==e&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:t=>this.Exportwrap(t,a,n,3,e,o,c)},(0,z.t)("Export")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:t=>{let s={e:t,group_id:a,pid:n,num2:2,is_dir:e};this.setState({delmodel:!0,delobj:s})}},(0,i.tZ)(Ae.default,{style:{marginRight:"5px"}}),(0,z.t)("Delete"))),zIndex:998,trigger:"hover"},(0,i.tZ)($e.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})))))},t&&t.map((e=>e.children?this.renderSubMenu(e):this.renderMenuItem(e)))),this.renderMenuItem=({is_dir:e,group_id:t,pid:a,icon:n,name:s,pmenu_img:o,key_name:l,perm:r,url:d,type_classify:c,mark:u,created_on:p,created_by_fk:m,changed_on:h,changed_by_fk:Z,menu_key:g})=>{const{dataset:v}=this.state;if(this.state.setBasicInfo&&g===sessionStorage.getItem("key")){const e={key_name:l,created_on:p,created_by:null==m?void 0:m.cn_name,changed_on:h,changed_by:null==Z?void 0:Z.cn_name};sessionStorage.setItem("chart_basicInfo",JSON.stringify(e)),this.setState({setBasicInfo:!1});const t=[],a=l.split("&&")[4],n=l.split("&&")[5],s=l.split("&&")[6],o=[],i=l.split("&&")[2];this.props.handleChangeMenu&&this.props.handleChangeMenu(t,o,a,n,s,i),this.props.setBasicInfo(e||{})}return(0,i.tZ)(xe.Z.Item,{key:g,basicInfo:{key_name:l,created_on:p,created_by:null==m?void 0:m.cn_name,changed_on:h,changed_by:null==Z?void 0:Z.cn_name}},(0,i.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},(0,i.tZ)("span",{style:{display:"flex",alignItems:"center",width:"72%"}},(0,i.tZ)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:s},0==c?(0,i.tZ)(le.Z.DatasetSqlicon,{iconColor:"#5D9CEC",style:{fontSize:"16px",verticalAlign:"middle"}}):1==c?(0,i.tZ)(le.Z.DatasetSqllicon,{iconColor:"#FF8800",style:{fontSize:"16px",verticalAlign:"middle"}}):2==c?(0,i.tZ)(le.Z.DatasetExcleicon,{iconColor:"#34c724",style:{fontSize:"16px",verticalAlign:"middle"}}):3==c?(0,i.tZ)(le.Z.DatasetUnionicon,{iconColor:"#d136d1",style:{fontSize:"16px",verticalAlign:"middle"}}):4==c?(0,i.tZ)(le.Z.DatabaseApi,{iconColor:"#04B49C",style:{fontSize:"16px",verticalAlign:"middle"}}):"",(e=>{var t;const a=e.indexOf(this.state.valuename),n=e.substr(0,a),s=e.substr(a+((null==(t=this.state.valuename)?void 0:t.length)||0));return a>-1?(0,i.tZ)("span",null,n,(0,i.tZ)("span",{style:{color:"#ff5500"}},this.state.valuename),s):(0,i.tZ)("span",null,e)})(s))),(0,i.tZ)("span",{style:{width:"8%"}},!1!==u&&(0,i.tZ)(A,{count:1,disabled:!0})),(0,i.tZ)("span",{style:{display:"black",width:"20%"}},r>=4&&(0,i.tZ)("div",{className:"superset-menu-Popover"},0==e&&(0,i.tZ)(we.Z,{overlayClassName:"popovercss",content:(0,i.tZ)("div",null,(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,0)},(0,z.t)("New Directory")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,1)},(0,z.t)("New Database Dataset")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,2)},(0,z.t)("New SQL Dataset")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,4)},(0,z.t)("New API Dataset"))),zIndex:998,trigger:"hover"},(0,i.tZ)("img",{src:(0,U.VU)("/static/assets/images/superset-menu-add.png"),alt:(0,z.t)("New Group")})),(0,i.tZ)(we.Z,{overlayClassName:"popovercss",content:(0,i.tZ)("div",null,(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,0,e,s)},(0,i.tZ)(Oe.default,{style:{marginRight:"5px"}}),(0,z.t)("Move")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,1,e,s)},(0,i.tZ)(Me.default,{style:{marginRight:"5px"}}),(0,z.t)("Rename")),1==e&&2==c&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,3,e,s,d)},(0,i.tZ)(F.default,{style:{marginRight:"5px"}}),(0,z.t)("Replace/Add")),1==e&&3==c&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,4,e,s,d)},(0,i.tZ)(F.default,{style:{marginRight:"5px"}}),(0,z.t)("Edit")),1==e&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.Exportwrap(n,t,a,3,e,s,d)},(0,i.tZ)(He.default,{style:{marginRight:"5px"}}),(0,z.t)("Export")),1==e&&(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,5,e,s,d)},(0,i.tZ)(le.Z.ChartPcicon,{style:{marginRight:"3px",fontSize:"16px",verticalAlign:"middle"}}),(0,z.t)("New Chart")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:n=>{let s={e:n,group_id:t,pid:a,num2:2,is_dir:e};this.setState({delmodel:!0,delobj:s}),this.beforedel(t)}},(0,i.tZ)(Ae.default,{style:{marginRight:"5px"}}),(0,z.t)("Delete"))),zIndex:998,trigger:"hover"},(0,i.tZ)($e.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}}))))))},this.onSearch=e=>{let{selectvalue:t}=this.state,a=e;if(this.setState({isMenuOpen:!1,valuename:e}),a&&"allvalue"==t){Ge=this.resdatasource(this.state.Search_Data,a),this.setState({isMenuOpen:!0})}else K.Z.get({endpoint:"/api/v2/dataset/group/"+(a?`?${t}=${a}`:""),headers:{"Content-Type":"application/json"}}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){t.json.meta.data.forEach((e=>{var t,a;e.icon=(0,i.tZ)(Ee.default,null),e.title=e.name,e.key=e.group_id,e.is_dir=0,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.menu_key=e.group_id+"&&"+e.name,e.pmenu_img="/static/assets/images/superset-menu-children.png",e.list=[],(null==(t=e.children)?void 0:t.length)>0&&(this.forEach_children(e.children),this.forEach_list(e.children,0,e.list,e.group_id)),(null==(a=e.datasets)?void 0:a.length)>0&&this.forEach_list(e.datasets,1,e.list,e.group_id)})),Ge=t.json.meta.data;let a=[];Ge.map((e=>{a.push(e.key_name)}));const n=[],s=e=>{e.length&&e.forEach((e=>{0===e.is_dir&&n.push(e.menu_key),e.list&&e.list.length&&s(e.children)}))};e.trim()&&s(t.json.meta.data),this.setState({Search_Data:t.json.meta.data,openKeys:n,isMenuOpen:!0,rootSubmenuKeys:a})}else p.ZP.error(t.json.meta.message)}))},this.resdatasource=(e,t)=>{let a=[],n=function(e,t){e.map((e=>{const s=n(e.list,t);return-1!==e.name.toLowerCase().indexOf(t.toLowerCase())?a.push(e):s&&s.length&&(e.list=s,a.push(e)),!1}))};return n(e,t),a},this.onOpenChange=e=>{let{openKeys:t,rootSubmenuKeys:a}=this.state;const n=e.find((e=>-1===t.indexOf(e)));-1===a.indexOf(n)?this.setState({openKeys:e}):this.setState({openKeys:n?[n]:[]})},this.handleApiOk=()=>{this.setState({okloding:!0}),K.Z.post({endpoint:"/api/v2/dataset/api/",body:JSON.stringify(this.state.datasetdata),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(this.DealList(),p.ZP.success(e.json.meta.message),this.setState({isApiModalOpen:!1,datasetdata:{datasource_id:null,table_group_id:null,custom_name:""}})):p.ZP.error(e.json.meta.message)})).finally((()=>{this.setState({okloding:!1})}))},this.handleApicel=()=>{this.setState({isApiModalOpen:!1,datasetdata:{datasource_id:null,table_group_id:null,custom_name:""}})},this.getdatasource=()=>{K.Z.get({endpoint:"/api/v2/datasource/api/list/"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){const t=e.json.meta.data.map((e=>({label:e.name,value:e.id})));this.setState({datasourceoptions:t})}else p.ZP.error(e.json.meta.message)}))},this.onselectChange=e=>{this.setState({datasetdata:{...this.state.datasetdata,datasource_id:e}})},this.beforedel=e=>{K.Z.get({endpoint:`/api/v2/dataset/${e}/charts/`,headers:{"Content-Type":"application/json"}}).then((e=>{200!=e.json.meta.code&&201!=e.json.meta.code||this.setState({deldata:e.json.meta.data})}))},this.selevtchange=e=>{this.setState({selectvalue:e},(()=>{this.onSearch(this.state.valuename)}))};const t=sessionStorage.getItem("chart_basicInfo");if(t){const e=JSON.parse(t),a=[],n=e.key_name.split("&&"),s=n[4],o=1*n[5],l=n[6],i=[],{handleChangeMenu:r}=this.props;r(a,i,s,o,l,n[2]),this.props.setBasicInfo(e||{})}this.state={isMenuOpen:!1,isModalOpen:!1,isModalOpenShift:!1,popoverShow:!1,treeData:[],Search_Data:[],expandedKeys:[],autoExpandParent:!0,checkedKeys:[],datasetAddModalOpen:!1,datasetCurrentlyEditing:void 0,isApiModalOpen:!1,datasourceoptions:[],datasetdata:{datasource_id:null,table_group_id:null,custom_name:""},Menuloading:!1,okloding:!1,dataset:[(0,U.VU)("/static/assets/images/databasedataset.png"),(0,U.VU)("/static/assets/images/sqldataset.png"),(0,U.VU)("/static/assets/images/Exceldataset.png"),(0,U.VU)("/static/assets/images/associatedatasets.png"),(0,U.VU)("/static/assets/images/apidataset.png")],importingDashboard:!1,addSuccessToast:(0,z.t)("Chart dataset"),addDangerToast:e.addDangerToast,passwordFields:"",preparingExport:!1,openKeys:sessionStorage.getItem("keyPath")?JSON.parse(sessionStorage.getItem("keyPath")):[],delmodel:!1,delloading:!1,delbtndisable:!1,delobj:{},deldata:[],checkedvalue:null,rootSubmenuKeys:[],apiDiv:"none",isApiadd:!1,DataSetID:null,table_groupID:null,selectedKeys:sessionStorage.getItem("key")||"",valuename:null,btnperm:0,selectvalue:"name",setBasicInfo:!0}}componentDidMount(){this.getPerm(),this.DealList(),this.getdatasource()}componentDidUpdate(e){this.props.markId!==e.markId&&this.DealList()}getControlledMenu(e){K.Z.get({endpoint:"api/v2/dataset/group/"}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){const a=this.forEach_Controlled(t.json.meta.data),n=[];1!=e&&n.push({id:"0",title:(0,z.t)("Move to Root Directory"),name:(0,z.t)("Move to Root Directory"),pid:"0",children:[],value:"0",is_dir:"0",group_id:"0",key:"0",icon:(0,i.tZ)(Ee.default,null)}),n.push(...a),this.setState({treeData:n})}}))}forEach_children(e){e.forEach((e=>{e.title=e.name,e.key=e.group_id,e.children.length>0&&this.forEach_children(e.children)}))}forEach_Controlled(e=[]){const t=[];return e.forEach((e=>{const a={title:e.name,key:e.group_id,disabled:e.perm<4,children:this.forEach_Controlled(e.children)};(!a.disabled||a.children.length>0)&&t.push(a)})),t}forEach_list(e,t,a,n){e.forEach((e=>{e.is_dir=t,1==t?(e.name=e.dataset_name,e.group_id=e.dataset_id,e.key_name=e.database_id+"&&"+e.is_dir+"&&"+e.dataset_name+"&&"+e.schema+"&&"+e.dataset_id+"&&"+e.perm+"&&"+e.type_classify,e.menu_key=`${e.group_id}`,e.pid=n,e.pmenu_img="/static/assets/images/superset-menu-dashboards.png"):(e.icon=(0,i.tZ)(Ee.default,null),e.pmenu_img="/static/assets/images/superset-menu-children.png",e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.menu_key=`${e.group_id}`),e.list=[],e.children&&(e.children.length>0&&this.forEach_list(e.children,0,e.list,e.group_id),e.datasets.length>0&&this.forEach_list(e.datasets,1,e.list,e.group_id)),a.push(e)}))}render(){const{isModalOpen:e,isModalOpenShift:t,treeData:a,expandedKeys:n,checkedKeys:s,datasetAddModalOpen:l,isMenuOpen:r,datasetCurrentlyEditing:d,isApiModalOpen:c,datasourceoptions:p,datasetdata:h,okloding:Z,Menuloading:g,addDangerToast:v,addSuccessToast:f,importingDashboard:y,preparingExport:b,passwordFields:S,openKeys:x,delmodel:w,delloading:C,delbtndisable:k,deldata:_,delobj:P,checkedvalue:j,apiDiv:D,isApiadd:N,DataSetID:E,table_groupID:I,selectedKeys:T,valuename:O,btnperm:M,selectvalue:A}=this.state,{collapsed:$,sonwidth:H,markId:L}=this.props;let K=[{label:(0,z.t)("Group"),value:"group_name"},{label:(0,z.t)("Resource"),value:"name"},{label:(0,z.t)("Creator"),value:"creator"},{label:(0,z.t)("types of"),value:"type_"}];const F=(0,i.tZ)(R.Z,{value:A,onChange:this.selevtchange,options:K}),V=[{label:(0,z.t)("Database Dataset"),value:"0"},{label:(0,z.t)("SQL Dataset"),value:"1"},{label:(0,z.t)("Excel Dataset"),value:"2"},{label:(0,z.t)("Associated\xa0Dataset"),value:"3"},{label:(0,z.t)("API Dataset"),value:"4"}],B=(0,ye.w)();return(0,i.tZ)(o.Fragment,null,(0,i.tZ)(u.Z,null,(0,i.tZ)("div",{className:"lefttitle",style:{width:H+"px"}},(0,i.tZ)(Ce.Z,{style:{width:"100%"}},(0,i.tZ)("span",{style:{fontSize:"15px",overflow:"hidden",whiteSpace:"nowrap",marginLeft:"-4px"}},(0,z.t)("Dataset")),(0,i.tZ)("div",{className:"superset-menu-Popover-Card",style:{top:"12px",display:$?"none":"block"}},g?(0,i.tZ)(Re.default,null):(0,i.tZ)(m.Z,{title:(0,z.t)("Refresh")},(0,i.tZ)(Le.default,{onClick:()=>{this.setState({Menuloading:!0,valuename:null,selectvalue:"name"}),this.DealList()},style:{marginRight:"10px"}})),(0,i.tZ)(we.Z,{overlayClassName:"popovercss",placement:"bottomRight",content:(0,i.tZ)("div",null,(0,i.tZ)("p",{className:"Popover-curPo",onClick:()=>this.openDashboardImportModal()},(0,i.tZ)(ze.default,{style:{marginRight:"5px"}}),(0,z.t)("Import")),(0,i.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,0,0,0)},(0,i.tZ)(Ee.default,{style:{marginRight:"5px"}}),(0,z.t)("New Group"))),trigger:"hover"},M>1&&(0,i.tZ)(Te.default,null)))),(0,i.tZ)("div",{style:{padding:"0px 35px 0 0px",display:$?"none":"block"}},"type_"!=A?(0,i.tZ)(be.Z,{style:{width:"100%",background:B?"#ffffff":"#253E5E",opacity:"1",marginLeft:"20px",border:"none",height:"36px",display:"flex",alignItems:"center"},className:"inputcss",prefix:(0,i.tZ)(Ke.default,{style:{width:"30px",color:B?"#000":"rgb(89 ,109 ,135)"}}),placeholder:(0,z.t)("Search"),onChange:e=>this.onSearch(e.target.value),value:O,addonAfter:F}):(0,i.tZ)("span",{className:"searchSelect"},(0,i.tZ)(R.Z,{allowClear:!0,style:{width:"135px"},onChange:e=>this.onSearch(e),options:V,value:O,placeholder:(0,z.t)("Search"),showSearch:!0,optionFilterProp:"label"}),(0,i.tZ)(R.Z,{style:{width:"70px"},value:A,onChange:this.selevtchange,options:K})))),(0,i.tZ)(ke.Z,{spinning:g},(0,i.tZ)(xe.Z,{selectedKeys:T,visible:r,onClick:this.handleClick,mode:"inline",theme:"dark",openKeys:x,onOpenChange:this.onOpenChange,className:B?"":"maxHeight800",style:{maxHeight:"calc(100vh - 180px)",overflowY:"auto"}},Ge.map((e=>e.children||e.list&&e.list.length>0?this.renderSubMenu(e):this.renderMenuItem(e))))),(0,i.tZ)(_e.Z,{title:et.adddev_menu,visible:e,destroyOnClose:!0,onCancel:()=>this.setState({isModalOpen:!1}),onOk:this.handleBlockGet,okText:(0,z.t)("Confirm"),cancelText:(0,z.t)("Cancel"),maskClosable:!1},(0,i.tZ)(Se.Z,{name:"DataSet",labelCol:{span:4},wrapperCol:{span:20},preserve:!1},(0,i.tZ)(We,{label:et.adddev_name,name:"name",rules:[{required:!0,message:()=>(0,z.t)("Please enter a name")}]},(0,i.tZ)(be.Z,{type:"text",name:"name",allowClear:!0,value:et.name,defaultValue:et.name,placeholder:(0,z.t)("Please enter"),onChange:this.handleChange})))),(0,i.tZ)(_e.Z,{title:et.Shift_menu,visible:t,destroyOnClose:!0,forceRender:!0,onCancel:()=>this.setState({isModalOpenShift:!1}),onOk:this.handleBlockShift,okText:(0,z.t)("Confirm"),cancelText:(0,z.t)("Cancel")},(0,i.tZ)(Pe.Z,{showSearch:!0,style:{width:"100%"},value:j,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,z.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:this.selectonChange,treeData:a,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,i.tZ)(Ee.default,null)})),(0,i.tZ)(fe,{show:l,onHide:()=>this.setState({datasetAddModalOpen:!1}),onDatasetAdd:this.DealList,table_group_id:et.table_group_id}),d&&(0,i.tZ)(DatasourceModal,{datasource:d,onDatasourceSave:refreshData,onHide:closeDatasetEditModal,show:!0}),c&&(0,i.tZ)(_e.Z,{title:(0,z.t)("New API Dataset"),visible:c,width:700,onOk:this.handleApiOk,onCancel:this.handleApicel,okText:(0,z.t)("Confirm"),cancelText:(0,z.t)("Cancel"),confirmLoading:Z,okButtonProps:{disabled:!(h.datasource_id&&h.table_group_id&&h.custom_name)}},(0,i.tZ)(Se.Z,{style:{width:"100%"},labelCol:{span:24},initialValues:h},(0,i.tZ)(We,{name:"datasource_id",label:(0,z.t)("API Datasource"),rules:[{required:!0,message:()=>(0,z.t)("Please select a datasource")}]},(0,i.tZ)(R.Z,{showSearch:!0,optionFilterProp:"children",style:{width:"100%"},onChange:this.onselectChange,filterOption:(e,t)=>{var a;return(null!=(a=null==t?void 0:t.label)?a:"").toLowerCase().includes(e.toLowerCase())},options:p})),(0,i.tZ)(We,{name:"custom_name",label:(0,z.t)("data sheet"),rules:[{required:!0,message:()=>(0,z.t)("Dataset name")}]},(0,i.tZ)(be.Z,{onChange:e=>{this.setState({datasetdata:{...this.state.datasetdata,custom_name:e.target.value}})}})))),(0,i.tZ)(ce.Z,{resourceName:"dataset",resourceLabel:(0,z.t)("dataset"),passwordsNeededMessage:tt,confirmOverwriteMessage:at,addDangerToast:v,addSuccessToast:f,onModelImport:this.handleDashboardImport,show:y,onHide:this.closeDashboardImportModal,passwordFields:S,setPasswordFields:this.setPasswordFields,DealList:this.DealList}),(0,i.tZ)(_e.Z,{title:(0,z.t)("Delete"),width:"40%",visible:w,onCancel:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})},footer:[(0,i.tZ)("div",{key:"id"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})}},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:C,onClick:()=>{this.menuEdit(P.e,P.group_id,P.pid,P.num2,P.is_dir,P.database_id,P.d_type).then((()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})}))}},(0,z.t)("Confirm"))))]},(0,i.tZ)("div",null,0==_.length?(0,i.tZ)("span",null,(0,z.t)("Confirm to delete?")):(0,i.tZ)("div",null,(0,i.tZ)(Ne.Z,{message:(0,z.t)("Please delete the following Chart first"),type:"warning",showIcon:!0}),(0,i.tZ)("div",{className:"srcolldel",style:{width:"100%",maxHeight:"700px",overflowX:"hidden",overflowY:"auto"}},_.map((e=>(0,i.tZ)("div",{key:e.id,style:{fontSize:"14px",marginTop:"10px",textIndent:"2em"}},e.title)))))))),"block"==D?(0,i.tZ)("div",{style:{display:"block"},className:"apiAssembly"},(0,i.tZ)(Je,{apiDivnone:this.apiDivnone,isApiadd:N,DataSetID:E,table_groupID:I,DealList:this.DealList})):null)}}const ot=st;var lt=a(652389),it=a(875443),rt=a(149531),dt=a(126272),ct=a(359314),ut=a(730381),pt=a.n(ut),mt=a(618446),ht=a.n(mt),Zt=a(187185),gt=a.n(Zt);let vt,ft="",yt=0,bt=!0,St=1;const xt=(e,t,a=[],n=1,s=25)=>{vt&&(clearTimeout(vt),vt=null),ft=e.value;vt=setTimeout((()=>{K.Z.get({endpoint:`/api/v2/user/?username=${e.value}&page_index=${n}&page_size=${s}`}).then((s=>{if(ft===e.value&&s.json.meta.data.list.length>0){const e=s.json.meta.data.list.map((e=>({value:e.id,text:e.cn_name?e.cn_name:""}))),o=gt()([...a,...e],ht());t(o),St=n}bt=!0}))}),300)},wt=e=>{const[t,a]=(0,o.useState)(e.defineOptions||[]);(0,o.useEffect)((()=>{xt({value:""},a)}),[]);return(0,i.tZ)(R.Z,{mode:"multiple",allowClear:!0,showSearch:!0,optionFilterProp:"label",value:e.uservalue,placeholder:e.placeholder,style:e.style,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:e=>{if(e){xt({value:e},a)}else a([])},onChange:t=>{e.getvalue(t)},notFoundContent:null,onPopupScroll:e=>{const{scrollTop:n,clientHeight:s,scrollHeight:o}=e.currentTarget;if(n-yt>0){if(n+s>o-2&&bt){bt=!1,xt({value:ft},a,t,St+1)}}yt=n},options:(t||[]).map((e=>({value:e.value,label:e.text})))})},{TextArea:Ct}=be.Z,kt=e=>{const[t,a]=(0,o.useState)(0),[n,s]=(0,o.useState)(1),[l,r]=(0,o.useState)(10),[d,c]=(0,o.useState)([]),[u,m]=(0,o.useState)(!1),[h,Z]=(0,o.useState)(!1),[g,v]=(0,o.useState)(""),[f,y]=(0,o.useState)(""),[b,S]=(0,o.useState)(1),[x,w]=(0,o.useState)([]),[C,k]=(0,o.useState)([]),[_,P]=(0,o.useState)([]),[j,D]=(0,o.useState)([]),[N,E]=(0,o.useState)([]),[I,T]=(0,o.useState)([]),[O,M]=(0,o.useState)(""),[A,L]=(0,o.useState)(!1),[F,V]=(0,o.useState)("1"),[B,Y]=(0,o.useState)(null),[U,J]=(0,o.useState)(!0),[q,W]=(0,o.useState)([]),{isEdit:G}=e,X=(e,t)=>{y("add"==e?(0,z.t)("Add row permissions"):(0,z.t)("Edit Line Permissions")),t&&(Y(t),K.Z.get({endpoint:`/api/v2/dataset/rls/${t}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){J(1==e.json.meta.data.status),M(e.json.meta.data.clause);let t=[],a=[],n=[],s=[];e.json.meta.data.depts.map((e=>{t.push(e.id)})),e.json.meta.data.roles.map((e=>{a.push(e.id)})),e.json.meta.data.users.map((e=>{n.push(e.id)})),W((e.json.meta.data.users||[]).map((e=>({value:e.id,text:e.cn_name||""})))),e.json.meta.data.white_list.map((e=>{s.push(e.id)})),k(t),D(a),E(n),T(s)}else p.ZP.error(e.json.meta.message)}))),Z(!0)},Q=e=>{Z(!1),k([]),D([]),E([]),T([]),M(""),V("1"),Y(null)},ee=[{title:(0,z.t)("clause"),dataIndex:"clause",key:"clause"},{title:(0,z.t)("user"),dataIndex:"username",width:150,render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.users)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.cn_name))))}},{title:(0,z.t)("Role"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.roles)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.name))))}},{title:(0,z.t)("Organization"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.depts)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.name))))}},{title:(0,z.t)("White List"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.white_list)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.cn_name))))}},{title:(0,z.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,i.tZ)("span",null,G&&(0,i.tZ)(je.Z,null,(0,i.tZ)("span",{className:"btncolor",onClick:()=>X("edit",t.id)},(0,z.t)("Edit")),(0,i.tZ)(it.Z,{title:(0,z.t)("Confirm to delete?"),onConfirm:()=>{return e=t.id,void K.Z.delete({endpoint:`/api/v2/dataset/rls/${e}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?te():p.ZP.error(e.json.meta.message)}));var e},okText:(0,z.t)("Confirm"),cancelText:(0,z.t)("Cancel")},(0,i.tZ)("span",{className:"btncolor"},(0,z.t)("Delete")))))}];function te(){m(!0),K.Z.get({endpoint:`/api/v2/dataset/rls/${e.datasetid}/list/?page=${n}&limit=${l}`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(c(e.json.meta.data.result),a(e.json.meta.data.total_page),m(!1)):(p.ZP.error(e.json.meta.message),m(!1))})).catch((()=>{m(!1)}))}(0,o.useEffect)((()=>{v(e.datasetid),e.datasetid&&te()}),[n,l,e.datasetid]);(0,o.useEffect)((()=>{var e;ae("dept"),e="role",K.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=[];e.json.meta.data.list.map((e=>{let a={value:e.id,label:e.name};t.push(a)})),P(t)}else p.ZP.error(e.json.meta.message)}))}),[]);const ae=e=>{K.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=ne(e.json.meta.data);w(t)}else p.ZP.error(e.json.meta.message)}))},ne=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.value=e.dept_id,a.pid=e.pid,a.children=e.children?ne(e.children):[],t.push(a),!1})),t};return(0,i.tZ)("div",null,G&&(0,i.tZ)("div",{className:"topbox"},(0,i.tZ)(De.Z,{type:"primary",onClick:()=>{X("add")},icon:(0,i.tZ)(Te.default,null)},(0,z.t)("Add"))),(0,i.tZ)("div",{className:"contenttalbe"},(0,i.tZ)(H.Z,{rowKey:e=>e.id,columns:ee,dataSource:d,pagination:!1,loading:u,scroll:{y:600}}),(0,i.tZ)("div",{className:"paginationseat"},t>0&&(0,i.tZ)(rt.Z,{onChange:(e,t)=>{s(e),r(t)},total:t}))),(0,i.tZ)(dt.Z,{title:f,width:736,onClose:Q,visible:h,footer:(0,i.tZ)("div",{className:"footbtn"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:Q},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:A,onClick:()=>{if(!O)return p.ZP.error((0,z.t)("Please enter the rule"));if(!C.length&&!j.length&&!N.length)return p.ZP.error((0,z.t)("Please select at least one type object"));let t={clause:O,dept_ids:C,role_ids:j,user_ids:N,white_list:I,status:U?1:0};B||(t.dataset_id=e.datasetid),L(!0),B?K.Z.put({endpoint:`/api/v2/dataset/rls/${B}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(te(),Q(),L(!1),p.ZP.success((0,z.t)("Successfully saved"))):(p.ZP.error(e.json.meta.message),L(!1))})).catch((()=>{L(!1)})):K.Z.post({endpoint:"/api/v2/dataset/rls/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(te(),Q(),L(!1)):(p.ZP.error(e.json.meta.message),L(!1))})).catch((()=>{L(!1)}))}},(0,z.t)("Confirm"))))},(0,i.tZ)("div",null,(0,i.tZ)("div",{className:"drawerflag"},(0,i.tZ)("div",{className:"firstdiv"},(0,i.tZ)(je.Z,null,(0,i.tZ)("span",null,(0,z.t)("Row permission rules")))),(0,i.tZ)("div",null,(0,i.tZ)(je.Z,null,(0,i.tZ)(ct.Z,{checked:U,onChange:e=>{J(e)}}),(0,i.tZ)("span",null,(0,z.t)("Enable row permissions"))))),(0,i.tZ)("div",{style:{margin:"20px 0 10px 0"}},(0,i.tZ)("span",null,(0,z.t)("types of"),":")),(0,i.tZ)($.Z,{onChange:e=>{V(e)},activeKey:F},(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Organization"),key:"1"},(0,i.tZ)(Pe.Z,{showSearch:!0,style:{width:"100%"},value:C,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,z.t)("Please select an organization"),allowClear:!0,multiple:!0,onChange:e=>{k(e)},treeData:x,treeNodeFilterProp:"title"})),(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Role"),key:"2"},(0,i.tZ)(R.Z,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:(0,z.t)("Please select an Role"),onChange:e=>{D(e)},options:_,value:j,showSearch:!0,optionFilterProp:"label"})),(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("user"),key:"3"},(0,i.tZ)(wt,{placeholder:(0,z.t)("Please select an user"),style:{width:"100%"},defineOptions:q,uservalue:N,getvalue:e=>{E(e)}}))),(0,i.tZ)("div",{style:{marginTop:"30px"}},(0,i.tZ)("span",null,(0,z.t)("Set Rules"),":")),(0,i.tZ)("div",{style:{margin:"10px 0"}},(0,i.tZ)(Ct,{rows:4,onChange:e=>{M(e.target.value)},placeholder:(0,z.t)("Please enter the rule"),value:O})),(0,i.tZ)("div",{style:{marginTop:"10px",fontWeight:"bold",fontSize:"16px"}},(0,i.tZ)("span",null,(0,z.t)("White List"))),(0,i.tZ)("div",{style:{margin:"5px 0",fontSize:"12px"}},(0,z.t)("The above permission rules are not effective for whitelist users")),(0,i.tZ)("div",null,(0,i.tZ)(wt,{placeholder:(0,z.t)("Please select an white list"),style:{width:"100%"},getvalue:e=>{T(e)}})))))},{TextArea:_t}=be.Z,Pt=e=>{const[t,a]=(0,o.useState)(0),[n,s]=(0,o.useState)(1),[l,r]=(0,o.useState)(10),[d,c]=(0,o.useState)([]),[u,m]=(0,o.useState)(""),[h,Z]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1),[f,y]=(0,o.useState)(""),[b,S]=(0,o.useState)(""),[x,w]=(0,o.useState)(1),[C,k]=(0,o.useState)([]),[_,P]=(0,o.useState)([]),[j,D]=(0,o.useState)([]),[N,E]=(0,o.useState)([]),[I,T]=(0,o.useState)([]),[O,M]=(0,o.useState)([]),[A,L]=(0,o.useState)(""),[F,V]=(0,o.useState)(!1),[B,Y]=(0,o.useState)("1"),[U,J]=(0,o.useState)(null),[q,W]=(0,o.useState)(!0),[G,X]=(0,o.useState)([]),{isEdit:Q}=e,ee=e=>{v(!1),P([]),E([]),T([]),X([]),M([]),Y("1"),J(null)},te=[{title:(0,z.t)("Column Name"),dataIndex:"column_name",key:"column_name"},{title:(0,z.t)("Field Type"),dataIndex:"type",key:"type"},{title:(0,z.t)("Verbose Name"),dataIndex:"verbose_name",key:"verbose_name"},{title:(0,z.t)("Username"),dataIndex:"username",width:150,render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.users)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.cn_name))))}},{title:(0,z.t)("Role"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.roles)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.name))))}},{title:(0,z.t)("Organization"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.depts)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.name))))}},{title:(0,z.t)("White List"),dataIndex:"",key:"2",render:(e,t)=>{var a;return(0,i.tZ)("span",null,null==(a=t.white_list)?void 0:a.map(((e,t)=>(0,i.tZ)("span",{key:e.id},t?",":"",e.cn_name))))}},{title:(0,z.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,i.tZ)("span",null,Q&&(0,i.tZ)(je.Z,null,(0,i.tZ)("span",{className:"btncolor",onClick:()=>{return e="edit",a=t.id,S("add"==e?(0,z.t)("Add column permissions"):(0,z.t)("Edit column permissions")),a&&(J(a),K.Z.get({endpoint:`/api/v2/dataset/cls/${a}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){W(1==e.json.meta.data.cls_status);let t=[],a=[],n=[],s=[];e.json.meta.data.depts.map((e=>{t.push(e.id)})),e.json.meta.data.roles.map((e=>{a.push(e.id)})),X((e.json.meta.data.users||[]).map((e=>({value:e.id,text:e.cn_name||""})))),e.json.meta.data.users.map((e=>{n.push(e.id)})),e.json.meta.data.white_list.map((e=>{s.push(e.id)})),P(t),E(a),T(n),M(s)}else p.ZP.error(e.json.meta.message)}))),void v(!0);var e,a}},(0,z.t)("Edit"))))}];function ae(){Z(!0),K.Z.get({endpoint:`/api/v2/dataset/cls/${e.datasetid}/list/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(c(e.json.meta.data),Z(!1)):(p.ZP.error(e.json.meta.message),Z(!1))})).catch((()=>{Z(!1)}))}(0,o.useEffect)((()=>{y(e.datasetid),e.datasetid&&ae()}),[n,l,e.datasetid]);(0,o.useEffect)((()=>{var e;ne("dept"),e="role",K.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=[];e.json.meta.data.list.map((e=>{let a={value:e.id,label:e.name};t.push(a)})),D(t)}else p.ZP.error(e.json.meta.message)}))}),[]);const ne=e=>{K.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=se(e.json.meta.data);k(t)}else p.ZP.error(e.json.meta.message)}))},se=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.value=e.dept_id,a.pid=e.pid,a.children=e.children?se(e.children):[],t.push(a),!1})),t};const oe=(0,o.useMemo)((()=>d.filter((e=>e.column_name.toLowerCase().includes(u.toLowerCase())))),[d,u]);return(0,i.tZ)("div",null,(0,i.tZ)("div",null,(0,i.tZ)(be.Z,{placeholder:(0,z.t)("Search by original name"),onChange:e=>m(e.target.value),style:{marginBottom:"10px"}})),(0,i.tZ)("div",{className:"contenttalbe"},(0,i.tZ)(H.Z,{rowKey:e=>e.column_name,columns:te,dataSource:oe,pagination:!1,loading:h,scroll:{y:600}}),(0,i.tZ)("div",{className:"paginationseat"},t>0&&(0,i.tZ)(rt.Z,{onChange:(e,t)=>{s(e),r(t)},total:t}))),(0,i.tZ)(dt.Z,{title:b,width:736,onClose:ee,visible:g,footer:(0,i.tZ)("div",{className:"footbtn"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:ee},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:F,onClick:()=>{if(!_.length&&!N.length&&!I.length)return p.ZP.error((0,z.t)("Please select at least one type object"));let t={dept_ids:_,role_ids:N,user_ids:I,white_list:O,cls_status:q?1:0};U||(t.dataset_id=e.datasetid),V(!0),U?K.Z.put({endpoint:`/api/v2/dataset/cls/${U}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(ae(),ee(),V(!1)):(p.ZP.error(e.json.meta.message),V(!1))})).catch((()=>{V(!1)})):K.Z.post({endpoint:"/api/v2/dataset/cls/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(ae(),ee(),V(!1),p.ZP.success((0,z.t)("Successfully saved"))):(p.ZP.error(e.json.meta.message),V(!1))})).catch((()=>{V(!1)}))}},(0,z.t)("Confirm"))))},(0,i.tZ)("div",null,(0,i.tZ)("div",{className:"drawerflag"},(0,i.tZ)("div",{className:"firstdiv"},(0,i.tZ)(je.Z,null,(0,i.tZ)("span",null,(0,z.t)("Column permission rules")))),(0,i.tZ)("div",null,(0,i.tZ)(je.Z,null,(0,i.tZ)(ct.Z,{checked:q,onChange:e=>{W(e)}}),(0,i.tZ)("span",null,(0,z.t)("Enable column permissions"))))),(0,i.tZ)("div",{style:{margin:"20px 0 10px 0"}},(0,i.tZ)("span",null,(0,z.t)("types of"),":")),(0,i.tZ)($.Z,{onChange:e=>{Y(e)},activeKey:B},(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Organization"),key:"1"},(0,i.tZ)(Pe.Z,{style:{width:"100%"},value:_,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,z.t)("Please select an organization"),allowClear:!0,multiple:!0,onChange:e=>{P(e)},treeData:C,showSearch:!0,treeNodeFilterProp:"title"})),(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Role"),key:"2"},(0,i.tZ)(R.Z,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:(0,z.t)("Please select an Role"),onChange:e=>{E(e)},options:j,value:N,showSearch:!0,optionFilterProp:"label"})),(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("user"),key:"3"},(0,i.tZ)(wt,{placeholder:(0,z.t)("Please select an user"),style:{width:"100%"},defineOptions:G,uservalue:I,getvalue:e=>{T(e)}}))),(0,i.tZ)("div",{style:{marginTop:"10px",fontWeight:"bold",fontSize:"16px"}},(0,i.tZ)("span",null,(0,z.t)("White List"))),(0,i.tZ)("div",{style:{margin:"5px 0",fontSize:"12px"}},(0,z.t)("The above permission rules are not effective for whitelist users")),(0,i.tZ)("div",null,(0,i.tZ)(wt,{placeholder:(0,z.t)("Please select an white list"),style:{width:"100%"},getvalue:e=>{M(e)}})))))},{TextArea:jt}=be.Z,Dt=e=>{const[t,a]=(0,o.useState)([]),[n,s]=(0,o.useState)(!1),[l,r]=(0,o.useState)(!1),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[h,Z]=(0,o.useState)(!1),[g,v]=(0,o.useState)(null),[f,y]=(0,o.useState)(""),[b,S]=(0,o.useState)(""),[x,w]=(0,o.useState)(""),[C,k]=(0,o.useState)(!0),[_,P]=(0,o.useState)("1"),[j,D]=(0,o.useState)([]),N=e=>{r(!1),v(null),y(""),S(""),P("1")},E=[{title:(0,z.t)("Column Name"),dataIndex:"column_name",key:"column_name",width:100},{title:(0,z.t)("Field Type"),dataIndex:"type",key:"type",width:100},{title:(0,z.t)("Verbose Name"),dataIndex:"verbose_name",key:"verbose_name",ellipsis:!0,width:80},{title:(0,z.t)("Regular Expression"),dataIndex:"pattern",key:"pattern",ellipsis:!0,width:120},{title:(0,z.t)("Replace Text"),dataIndex:"repl",key:"repl",ellipsis:!0,width:100},{title:(0,z.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,i.tZ)("span",null,(0,i.tZ)(je.Z,null,(0,i.tZ)("span",{className:"btncolor",onClick:()=>{return e=t.id,m((0,z.t)("Edit Data masking")),e&&(v(e),K.Z.get({endpoint:`/api/v2/data/masking/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){k(1==e.json.meta.data.mask_status);let t=e.json.meta.data.extra?JSON.parse(e.json.meta.data.extra):{};t.checkNum&&1==t.checkNum?(w(t.defid),y(""),S(""),P("1")):(w(""),y(e.json.meta.data.pattern),S(e.json.meta.data.repl),P("2"))}else p.ZP.error(e.json.meta.message)}))),void r(!0);var e}},(0,z.t)("Edit"))))}];function I(){s(!0),K.Z.get({endpoint:`/api/v2/data/masking/dataset/${e.datasetid}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(a(e.json.meta.data),s(!1)):(p.ZP.error(e.json.meta.message),s(!1))})).catch((()=>{s(!1)}))}(0,o.useEffect)((()=>{c(e.datasetid),e.datasetid&&(I(),K.Z.get({endpoint:"/api/v2/data/masking/reg/"}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(e.json.meta.data.map((e=>{e.label=e.name,e.value=e.id})),D(e.json.meta.data)):p.ZP.error(e.json.meta.message)})))}),[e.datasetid]);return(0,i.tZ)("div",null,(0,i.tZ)("div",{className:"contenttalbe"},(0,i.tZ)(H.Z,{rowKey:e=>e.column_name,columns:E,dataSource:t,pagination:!1,loading:n,scroll:{x:!0,y:"calc(100vh - 300px)"}})),(0,i.tZ)(dt.Z,{title:u,width:736,onClose:N,visible:l,footer:(0,i.tZ)("div",{className:"footbtn"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:N},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:h,onClick:()=>{let e={mask_status:C?1:0},t={defid:x,checkNum:_};if(1==_?(j.map((t=>{x==t.id&&(e.pattern=t.pattern,e.repl=t.repl)})),x||(e.pattern="",e.repl=""),t.pattern=e.pattern?e.pattern:"",t.repl=e.repl?e.repl:"",e.extra=JSON.stringify(t)):(e.pattern=f,e.repl=b,e.extra=""),2==_){if(!e.pattern)return p.ZP.error((0,z.t)("Please fill in the regular expression"));if(!e.repl)return p.ZP.error((0,z.t)("Please fill in the replacement text"))}Z(!0),g&&K.Z.put({endpoint:`/api/v2/data/masking/${g}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(I(),N(),Z(!1)):(p.ZP.error(e.json.meta.message),Z(!1))})).catch((()=>{Z(!1)}))}},(0,z.t)("Confirm"))))},(0,i.tZ)("div",null,(0,i.tZ)("div",{className:"drawerflag"},(0,i.tZ)("div",{className:"firstdiv"},(0,i.tZ)(je.Z,null,(0,i.tZ)("span",null,(0,z.t)("Data masking rules")))),(0,i.tZ)("div",null,(0,i.tZ)(je.Z,null,(0,i.tZ)(ct.Z,{onChange:e=>{k(e)},checked:C}),(0,i.tZ)("span",null,(0,z.t)("Enable desensitization rules"))))),(0,i.tZ)("div",{style:{margin:"20px 0 10px 0"}},(0,i.tZ)("p",null,(0,z.t)("Regular Expression"),":"),(0,i.tZ)($.Z,{onChange:e=>{P(e)},activeKey:_},(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Default rule"),key:"1"},(0,i.tZ)(R.Z,{allowClear:!0,style:{width:"100%"},placeholder:(0,z.t)("Please select the default rule"),onChange:e=>{w(e)},options:j,value:x})),(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("custom"),key:"2"},(0,i.tZ)(be.Z,{placeholder:(0,z.t)("Please enter a regular expression"),value:f,onChange:e=>{y(e.target.value)}})))),1!=_?(0,i.tZ)("div",{style:{margin:"20px 0 10px 0"}},(0,i.tZ)("p",null,(0,z.t)("Replace Text"),":"),(0,i.tZ)(be.Z,{placeholder:(0,z.t)("Please enter replacement text"),value:b,onChange:e=>{S(e.target.value)}})):null)))};var Nt=a(624225),Et=a(662276);const{TextArea:It}=be.Z,Tt=e=>{const[t,a]=(0,o.useState)([]),[n,s]=(0,o.useState)(!1),[l,r]=(0,o.useState)(!1),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[h,Z]=(0,o.useState)(!1),[g,v]=(0,o.useState)(null),[f,y]=(0,o.useState)("APPEND"),[b,S]=(0,o.useState)(0),[x,w]=(0,o.useState)(1),[C,k]=(0,o.useState)(""),[_,P]=(0,o.useState)(1),[j,D]=(0,o.useState)("hour"),[N,E]=(0,o.useState)(null),[I,T]=(0,o.useState)(null),[O,M]=(0,o.useState)(""),[A,$]=(0,o.useState)(""),[L,F]=(0,o.useState)(!1),[V,B]=(0,o.useState)(!1),[U,J]=(0,o.useState)(""),[q,W]=(0,o.useState)(!1),[G,X]=(0,o.useState)(!1),[Q,ee]=(0,o.useState)(!1),[te,ae]=(0,o.useState)([]),[ne,se]=(0,o.useState)(""),oe=(e,t)=>{if(se(e),"add"==e)m((0,z.t)("add task"));else if("view"==e){v(t.id);let e=JSON.parse(t.extra_data);m((0,z.t)("View Tasks")),y(e.wayvalue),S(t.rate),k(e.cronvalue),S(e.frevalue),w(e.endtimevalue),P(e.numvalue),D(e.handlevalue),E(e.starttiem),T(e.endtiem),M(t.name)}else{v(t.id);let e=JSON.parse(t.extra_data);m((0,z.t)("View Tasks")),y(e.wayvalue),S(t.rate),k(e.cronvalue),S(e.frevalue),w(e.endtimevalue),P(e.numvalue),D(e.handlevalue),E(e.starttiem),T(e.endtiem),M(t.name)}r(!0)},le=e=>{r(!1),se(""),y("APPEND"),S(0),w(1),k(""),P(1),D("hour"),E(null),T(null),M(""),v(null)},ie=[{title:(0,z.t)("TASK"),dataIndex:"name",key:"name"},{title:(0,z.t)("execution Efficiency"),dataIndex:"username",width:150,render:(e,t)=>(0,i.tZ)("span",null,0==t.rate?(0,z.t)("Execute immediately"):1==t.rate?(0,z.t)("Expression settings"):(0,z.t)("Simple repetition"))},{title:(0,z.t)("Last Execution Result"),dataIndex:"last_exec_status",key:"2"},{title:(0,z.t)("Last Execution Time"),dataIndex:"",key:"2",render:(e,t)=>(0,i.tZ)("span",null,t.last_exec_time?pt().utc(t.last_exec_time).format("YYYY-MM-DD HH:mm:ss"):"")},{title:(0,z.t)("Status"),dataIndex:"",key:"2",render:(e,t)=>(0,i.tZ)("span",null,1==t.status?(0,z.t)("Waiting for execution"):(0,z.t)("Execution ends"))},{title:(0,z.t)("Actions"),key:"operation",width:300,render:(e,t)=>(0,i.tZ)("span",null,(0,i.tZ)(je.Z,null,(0,i.tZ)("span",{className:"btncolor",onClick:()=>oe("view",t)},(0,z.t)("view")),(0,i.tZ)("span",{className:"btncolor",onClick:()=>oe("edit",t)},(0,z.t)("Edit")),(0,i.tZ)("span",{className:"btncolor",onClick:()=>{W(!0),J(t.id)}},(0,z.t)("Execute immediately")),(0,i.tZ)("span",{className:"btncolor",onClick:()=>{de(t.id)}},(0,z.t)("Execution log")),(0,i.tZ)("span",{className:"btncolor",onClick:()=>{F(!0),$(t.id)}},(0,z.t)("Delete"))))}];function re(){s(!0),K.Z.get({endpoint:`/api/v2/dataset/api/task/${e.datasetid}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(a(e.json.meta.data),s(!1)):(p.ZP.error(e.json.meta.message),s(!1))})).catch((()=>{s(!1)}))}(0,o.useEffect)((()=>{c(e.datasetid),e.datasetid&&re()}),[e.datasetid]);const de=e=>{s(!0),K.Z.get({endpoint:`/api/v2/dataset/api/task/${e}/log/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(ae(e.json.meta.data.result),ee(!0),s(!1)):(p.ZP.error(e.json.meta.message),s(!1))})).catch((()=>{s(!1)}))},ce=[{title:(0,z.t)("TASK"),dataIndex:"task_name",key:"task_name"},{title:(0,z.t)("Starting time"),dataIndex:"",render:(e,t)=>(0,i.tZ)("span",null,t.start_time?pt().utc(t.start_time).format("YYYY-MM-DD HH:mm:ss"):"")},{title:(0,z.t)("End Time"),dataIndex:"",render:(e,t)=>(0,i.tZ)("span",null,t.end_time?pt().utc(t.end_time).format("YYYY-MM-DD HH:mm:ss"):"")},{title:(0,z.t)("Results of the"),dataIndex:"",render:(e,t)=>(0,i.tZ)("span",null,1==t.status?(0,z.t)("Success"):(0,z.t)("Failed"))}];return(0,i.tZ)("div",null,(0,i.tZ)("div",{className:"topbox"},(0,i.tZ)(De.Z,{type:"primary",onClick:()=>{oe("add")},icon:(0,i.tZ)(Te.default,null)},(0,z.t)("add task")),(0,i.tZ)("div",{style:{position:"absolute",top:"39px",right:"42px",fontSize:"14px",cursor:"pointer",color:"#5D9CEC"}},(0,i.tZ)(Y.default,{onClick:re}))),(0,i.tZ)("div",{className:"contenttalbe"},(0,i.tZ)(H.Z,{rowKey:e=>e.id,columns:ie,dataSource:t,pagination:!1,loading:n,scroll:{y:600}})),(0,i.tZ)(dt.Z,{title:u,width:736,onClose:le,visible:l,footer:(0,i.tZ)("div",{className:"footbtn"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:le},(0,z.t)("Cancel")),!g&&(0,i.tZ)(De.Z,{type:"primary",loading:h,onClick:()=>{if(!O)return p.ZP.error((0,z.t)("Please enter a task name"));if(1==b&&!C)return p.ZP.error((0,z.t)("Please enter a cron expression"));if(0!=b&&!N)return p.ZP.error((0,z.t)("Please select a start time"));if(2==x&&!I)return p.ZP.error((0,z.t)("Please select the end time"));let t={endtiem:I||"",starttiem:N||"",frevalue:b,numvalue:_,handlevalue:j,endtimevalue:x,cronvalue:1==b?C:"",wayvalue:f},a={cron:1==b?C:2==b?"minute"==j?`* 0/${_} * * *`:"minute"==j?`* * 0/${_} * *`:`* * * 1/${_} *`:"",end_time:1==x?0:new Date(I).getTime(),extra_data:JSON.stringify(t),rate:b,start_time:0==b?0:new Date(N).getTime(),update_type:f,name:O};Z(!0),K.Z.post({endpoint:`/api/v2/dataset/api/${e.datasetid}/task`,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(re(),le(),Z(!1),p.ZP.success(e.json.meta.message)):(p.ZP.error(e.json.meta.message),Z(!1))})).catch((()=>{Z(!1)}))}},(0,z.t)("Confirm")),g&&"edit"===ne&&(0,i.tZ)(De.Z,{type:"primary",loading:h,onClick:()=>{if(!O)return p.ZP.error((0,z.t)("Please enter a task name"));if(1==b&&!C)return p.ZP.error((0,z.t)("Please enter a cron expression"));if(0!=b&&!N)return p.ZP.error((0,z.t)("Please select a start time"));if(2==x&&!I)return p.ZP.error((0,z.t)("Please select the end time"));let e={endtiem:I||"",starttiem:N||"",frevalue:b,numvalue:_,handlevalue:j,endtimevalue:x,cronvalue:1==b?C:"",wayvalue:f},t={cron:1==b?C:2==b?"minute"==j?`* 0/${_} * * *`:"minute"==j?`* * 0/${_} * *`:`* * * 1/${_} *`:"",end_time:1==x?0:new Date(I).getTime(),extra_data:JSON.stringify(e),rate:b,start_time:0==b?0:new Date(N).getTime(),update_type:f,name:O};Z(!0),K.Z.put({endpoint:`/api/v2/dataset/api/task/${g}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(re(),le(),Z(!1),p.ZP.success(e.json.meta.message)):(p.ZP.error(e.json.meta.message),Z(!1))})).catch((()=>{Z(!1)}))}},(0,z.t)("Confirm"))))},(0,i.tZ)("div",null,(0,i.tZ)("div",null,(0,i.tZ)("p",null,(0,z.t)("TASK")),(0,i.tZ)(be.Z,{value:O,onChange:e=>{M(e.target.value)},placeholder:(0,z.t)("Please enter a task name"),disabled:"view"===ne})),(0,i.tZ)("div",null,(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("Update method")),(0,i.tZ)(Ye.ZP.Group,{disabled:"view"===ne,onChange:e=>{y(e.target.value)},value:f},(0,i.tZ)(Ye.ZP,{value:"REPLACE"},(0,z.t)("Full update")),(0,i.tZ)(Ye.ZP,{value:"APPEND"},(0,z.t)("Incremental updates")))),(0,i.tZ)("div",null,(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("execution Efficiency")),(0,i.tZ)(Ye.ZP.Group,{disabled:"view"===ne,onChange:e=>{S(e.target.value)},value:b},(0,i.tZ)(Ye.ZP,{value:0},(0,z.t)("Execute immediately")),(0,i.tZ)(Ye.ZP,{value:1},(0,z.t)("Expression settings")),(0,i.tZ)(Ye.ZP,{value:2},(0,z.t)("Simple repetition")))),(0,i.tZ)("div",null,1==b||2==b?(0,i.tZ)("div",null,1==b?(0,i.tZ)("div",null," ",(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("cron expressions")),(0,i.tZ)(be.Z,{value:C,onChange:e=>{k(e.target.value)},placeholder:(0,z.t)("Please enter a cron expression"),disabled:"view"===ne})):2==b?(0,i.tZ)("div",null," ",(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("execution Efficiency")),(0,i.tZ)(je.Z,null,(0,i.tZ)("span",null,(0,z.t)("Every")),(0,i.tZ)(Nt.Z,{min:"minute"==j||"hour"==j?0:1,max:"minute"==j?59:"hour"==j?24:31,value:_,onChange:e=>{P(e)},disabled:"view"===ne}),(0,i.tZ)(R.Z,{onChange:e=>{D(e)},value:j,options:[{value:"minute",label:(0,z.t)("minute")},{value:"hour",label:(0,z.t)("hour")},{value:"day",label:(0,z.t)("day")}],disabled:"view"===ne}),(0,i.tZ)("span",null,(0,z.t)("Execute once")))):"",(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("time-on")),(0,i.tZ)(Et.M,{value:N?pt()(N,"YYYY-MM-DD HH:mm:ss"):"",showTime:!0,onChange:(e,t)=>{E(t)},onOk:e=>{},format:"YYYY-MM-DD HH:mm:ss",disabled:"view"===ne}),(0,i.tZ)("p",{style:{marginTop:"15px"}},(0,z.t)("End Time")),(0,i.tZ)(Ye.ZP.Group,{disabled:"view"===ne,onChange:e=>{w(e.target.value)},value:x},(0,i.tZ)(Ye.ZP,{value:1},(0,z.t)("unlimited")),(0,i.tZ)(Ye.ZP,{value:2},(0,z.t)("Set End Time"))),2==x&&(0,i.tZ)("div",{style:{marginTop:"15px"}},(0,i.tZ)(Et.M,{showTime:!0,onChange:(e,t)=>{T(t)},onOk:e=>{},value:I?pt()(I,"YYYY-MM-DD HH:mm:ss"):"",format:"YYYY-MM-DD HH:mm:ss",disabled:"view"===ne}))):null))),(0,i.tZ)(_e.Z,{title:(0,z.t)("Delete"),width:"20%",visible:L,onCancel:()=>{F(!1),B(!1)},footer:[(0,i.tZ)("div",{key:"id"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:()=>{F(!1),B(!1)}},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:V,onClick:()=>{return e=A,void K.Z.delete({endpoint:`/api/v2/dataset/api/task/${e}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(re(),F(!1),B(!1),p.ZP.success(e.json.meta.message)):p.ZP.error(e.json.meta.message)}));var e}},(0,z.t)("Confirm"))))]},(0,i.tZ)("div",{style:{marginTop:"20px"}},(0,i.tZ)("span",null,(0,z.t)("Confirm to delete?")))),(0,i.tZ)(_e.Z,{title:(0,z.t)("prompt"),width:"50%",visible:q,onCancel:()=>{W(!1),X(!1)},footer:[(0,i.tZ)("div",{key:"id"},(0,i.tZ)(je.Z,null,(0,i.tZ)(De.Z,{onClick:()=>{W(!1),X(!1)}},(0,z.t)("Cancel")),(0,i.tZ)(De.Z,{type:"primary",loading:G,onClick:()=>{return e=U,s(!0),void K.Z.post({endpoint:`/api/v2/dataset/api/task/${e}/`,headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(re(),s(!1),W(!1),p.ZP.success(e.json.meta.message)):(p.ZP.error(e.json.meta.message),s(!1))})).catch((()=>{s(!1)}));var e}},(0,z.t)("Confirm"))))]},(0,i.tZ)("div",null,(0,i.tZ)(Ne.Z,{message:(0,z.t)("Manually trigger execution?"),type:"warning",showIcon:!0}))),(0,i.tZ)(dt.Z,{title:(0,z.t)("Execution record"),width:736,onClose:()=>{ee(!1)},visible:Q,footer:[]},(0,i.tZ)(H.Z,{rowKey:e=>e.id,columns:ce,dataSource:te})))},{Sider:Ot,Content:Mt}=u.Z,At=L.iK.div`
  align-items: center;
  display: flex;

  svg {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,$t=L.iK.div`
  color: ${({theme:e})=>e.colors.grayscale.base};

  .disabled {
    svg,
    i {
      &:hover {
        path {
          fill: ${({theme:e})=>e.colors.grayscale.light1};
        }
      }
    }
    color: ${({theme:e})=>e.colors.grayscale.light1};
    .ant-menu-item:hover {
      color: ${({theme:e})=>e.colors.grayscale.light1};
      cursor: default;
    }
    &::after {
      color: ${({theme:e})=>e.colors.grayscale.light1};
    }
  }
`;const Ht=(0,se.ZP)((({addDangerToast:e,addSuccessToast:t,user:a})=>{const{state:{loading:n,resourceCount:d,resourceCollection:u,bulkSelectEnabled:h},hasPerm:Z,refreshData:g}=(0,q.Yi)("dataset",(0,z.t)("dataset"),e),v=document.getElementById("app"),{common:{menu_data:f}}=JSON.parse((null==v?void 0:v.getAttribute("data-bootstrap"))||"{}"),y={row:0,col:0};f.menu.map((e=>{"Dataset"==e.name&&e.children&&e.children.map((e=>{"Row Level Security"==e.name&&(y.row=e.perm),"Col Level Security"==e.name&&(y.col=e.perm)}))}));const[b,S]=(0,o.useState)(!1),[x,w]=(0,o.useState)(!1),[C,k]=(0,o.useState)(null),[_,P]=(0,o.useState)(null),[j,D]=(0,o.useState)(!1),[N,E]=(0,o.useState)([]),[I,T]=(0,o.useState)(!1),[O,M]=(0,o.useState)(10),[se,Ze]=(0,o.useState)(1),[ge,ve]=(0,o.useState)(100),[be,Se]=(0,o.useState)({dataTable:[],columns:[]}),xe=((0,L.Fg)(),Z("can_write")),we=Z("can_write"),Ce=Z("can_write"),ke=Z("can_export")&&(0,ue.cr)(pe.T.VERSIONED_EXPORT),[_e,Pe]=(lt.dY,(0,o.useState)("240")),[je,De]=(0,o.useState)("240"),[Ne,Ee]=(0,o.useState)(sessionStorage.getItem("sqldatabaseid")),[Ie,Te]=(0,o.useState)("1"),[Oe,Me]=(0,o.useState)(!1),[Ae,$e]=(0,o.useState)([]),[He,Re]=(0,o.useState)(0),[Le,ze]=(0,o.useState)(-1),[Ke,Fe]=(0,o.useState)(!1),[Ve,Be]=(0,o.useState)(""),[Ye,Ue]=(0,o.useState)({}),[Je,qe]=(0,o.useState)(0),[We,Ge]=(0,o.useState)(""),Xe=(0,l.v9)((e=>e.user.userId)),Qe=(0,o.useCallback)((({id:t})=>{K.Z.get({endpoint:`/api/v1/dataset/${t}`}).then((({json:e={}})=>{const t=e.result.columns.map((e=>{const{certification:{details:t="",certified_by:a=""}={}}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:t||"",certified_by:a||"",is_certified:t||a}}));e.result.columns=[...t],P(e.result)})).catch((()=>{e((0,z.t)("An error occurred while fetching dataset related data"))}))}),[e]),et=e=>{const t=e.map((({id:e})=>e));(0,ee.Z)("dataset",t,(()=>{T(!1)})),T(!0)},tt=((0,o.useMemo)((()=>[{Cell:({row:{original:{kind:e}}})=>"physical"===e?(0,i.tZ)(oe.u,{id:"physical-dataset-tooltip",title:(0,z.t)("Physical dataset")},(0,i.tZ)(le.Z.DatasetPhysical,null)):(0,i.tZ)(oe.u,{id:"virtual-dataset-tooltip",title:(0,z.t)("Virtual dataset")},(0,i.tZ)(le.Z.DatasetVirtual,null)),accessor:"kind_icon",disableSortBy:!0,size:"xs",id:"id"},{Cell:({row:{original:{extra:e,table_name:t,description:a,explore_url:n}}})=>{const s=(0,i.tZ)("a",{href:n},t);try{const t=JSON.parse(e);return(0,i.tZ)(At,null,(null==t?void 0:t.certification)&&(0,i.tZ)(re.Z,{certifiedBy:t.certification.certified_by,details:t.certification.details,size:"l"}),(null==t?void 0:t.warning_markdown)&&(0,i.tZ)(me.Z,{warningMarkdown:t.warning_markdown,size:"l"}),s,a&&(0,i.tZ)(de.Z,{tooltip:a,viewBox:"0 -1 24 24"}))}catch{return s}},Header:(0,z.t)("Name"),accessor:"table_name"},{Cell:({row:{original:{kind:e}}})=>{var t;return(null==(t=e[0])?void 0:t.toUpperCase())+e.slice(1)},Header:(0,z.t)("Type"),accessor:"kind",disableSortBy:!0,size:"md"},{Header:(0,z.t)("Database"),accessor:"database.database_name",size:"lg"},{Header:(0,z.t)("Schema"),accessor:"schema",size:"lg"},{Cell:({row:{original:{changed_on_delta_humanized:e}}})=>(0,i.tZ)("span",{className:"no-wrap"},e),Header:(0,z.t)("Modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:({row:{original:{changed_by_name:e}}})=>e,Header:(0,z.t)("Modified by"),accessor:"changed_by.first_name",size:"xl"},{accessor:"database",disableSortBy:!0,hidden:!0},{Cell:({row:{original:{owners:e=[]}}})=>(0,i.tZ)(ie.Z,{users:e}),Header:(0,z.t)("Owners"),id:"owners",disableSortBy:!0,size:"lg"},{accessor:"sql",hidden:!0,disableSortBy:!0},{Cell:({row:{original:e}})=>{const t=e.owners.map((e=>e.id)).includes(a.userId)||(0,he.i5)(a);return xe||we||ke?(0,i.tZ)($t,{className:"actions"},we&&(0,i.tZ)(oe.u,{id:"delete-action-tooltip",title:(0,z.t)("Delete"),placement:"bottom"},(0,i.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return t=e,K.Z.get({endpoint:`/api/v1/dataset/${t.id}/related_objects`}).then((({json:e={}})=>{k({...t,chart_count:e.charts.count,dashboard_count:e.dashboards.count})})).catch((0,J.v$)((e=>(0,z.t)("An error occurred while fetching dataset related data: %s",e))));var t}},(0,i.tZ)(le.Z.Trash,null))),ke&&(0,i.tZ)(oe.u,{id:"export-action-tooltip",title:(0,z.t)("Export"),placement:"bottom"},(0,i.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>et([e])},(0,i.tZ)(le.Z.Share,null))),xe&&(0,i.tZ)(oe.u,{id:"edit-action-tooltip",title:t?(0,z.t)("Edit"):(0,z.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access."),placement:"bottomRight"},(0,i.tZ)("span",{role:"button",tabIndex:0,className:t?"action-button":"disabled",onClick:t?()=>Qe(e):void 0},(0,i.tZ)(le.Z.EditAlt,null)))):null},Header:(0,z.t)("Actions"),id:"actions",hidden:!xe&&!we,disableSortBy:!0}]),[xe,we,ke,Qe]),(0,o.useMemo)((()=>[{Header:(0,z.t)("Owner"),id:"owners",input:"select",operator:te.p.relationManyMany,unfilteredLabel:"All",fetchSelects:(0,J.tm)("dataset","owners",(0,J.v$)((e=>(0,z.t)("An error occurred while fetching dataset owner values: %s",e))),a),paginate:!0},{Header:(0,z.t)("Database"),id:"database",input:"select",operator:te.p.relationOneMany,unfilteredLabel:"All",fetchSelects:(0,J.tm)("dataset","database",(0,J.v$)((e=>(0,z.t)("An error occurred while fetching datasets: %s",e)))),paginate:!0},{Header:(0,z.t)("Schema"),id:"schema",input:"select",operator:te.p.equals,unfilteredLabel:"All",fetchSelects:(0,J.wk)("dataset","schema",(0,J.v$)((e=>(0,z.t)("An error occurred while fetching schema values: %s",e)))),paginate:!0},{Header:(0,z.t)("Type"),id:"sql",input:"select",operator:te.p.datasetIsNullOrEmpty,unfilteredLabel:"All",selects:[{label:"Virtual",value:!1},{label:"Physical",value:!0}]},{Header:(0,z.t)("Certified"),id:"id",urlDisplay:"certified",input:"select",operator:te.p.datasetIsCertified,unfilteredLabel:(0,z.t)("Any"),selects:[{label:(0,z.t)("Yes"),value:!0},{label:(0,z.t)("No"),value:!1}]},{Header:(0,z.t)("Search"),id:"table_name",input:"search",operator:te.p.contains}]),[]),{activeChild:"Datasets",name:Ve,basicInfo:Ye}),at=(0,o.useMemo)((()=>{const e=[];return Ne&&He>=4&&[0,1,2,3,4].includes(Le)&&e.push({name:(0,i.tZ)(o.Fragment,null,(0,i.tZ)(F.default,null)," ",(0,z.t)("Edit")),onClick:()=>st(Ne),buttonStyle:"primary"}),e}),[Ne,He,Le]);Ce&&(0,ue.cr)(pe.T.VERSIONED_EXPORT),tt.buttons=at;const nt=(0,o.useCallback)(((e,t,a,n,s,o)=>{a!==Ne&&function(e,t){Se({columns:e,dataTable:t||[]}),setTimeout((()=>{w(!0),Me(!1)}),100)}(e,t),a&&$e(t),w(!1),a&&Ee(a),Me(!0),a&&Re(n),a&&ze(Number(s)),a&&Be(o),Me(!1)}),[Ne]);function st(e){K.Z.get({endpoint:"/api/v1/dataset/"+e}).then((({json:e={}})=>{const t=e.result.columns.map((e=>{const{certification:{details:t="",certified_by:a=""}={}}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:t||"",certified_by:a||"",is_certified:t||a}}));e.result.columns=[...t],P(e.result)})).catch((()=>{p.ZP.error((0,z.t)("An error occurred while fetching dataset related data"))}))}(0,o.useEffect)((()=>{Te("1");let e=sessionStorage.getItem("sqldatabaseid");Ne&&rt(),e&&sessionStorage.removeItem("sqldatabaseid")}),[Ne]);const it=e=>{Te(e)};const rt=(0,o.useCallback)(((e=100)=>{Me(!0);const t=[];return K.Z.get({endpoint:`/api/v2/dataset/${Ne}/?limit=${e}&force_cached=true`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){var a,n;Ge(e.json.meta.data.mark_id),!1===e.json.meta.data.mark_id?qe(0):qe(1),null==(a=e.json.meta)||null==(n=a.data)||n.table_info.forEach(((e,a)=>{var n;n=null!=e.verbose_name&&""!=e.verbose_name&&""!=e.verbose_name&&void 0!=e.verbose_name?e.verbose_name:e.column_name;const s=(n.match(/[a-z]/g)||[]).length;const o=function(e){var t;return(null==(t=e.match(/\d/g))?void 0:t.length)||0}(n);var l={title:n,dataIndex:e.column_name,key:e.column_name,align:"left",ellipsis:!0,width:16*(n.length-s-o)+10*s+6*o+32,render:(t,a)=>{const n=a[e.column_name],s=typeof n,o=!!("string"==s||"number"==s&&/^\d{10}$|^\d{13}$/.test(n))&&function(e){const t=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})(T|\/)(\d{1,2}):(\d{1,2}):(\d{1,2})$/;let a=!1;if("number"==typeof e){const t=new Date(e.length>10?e:1e3*e);a=!Number.isNaN(t.getTime())}else a=t.test(e);return a}(n);return o?function(e){const t=new Date(e);return`${t.getFullYear()}-${t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1}-${t.getDate()<10?"0"+t.getDate():t.getDate()} ${t.getHours()+8<10?"0"+(t.getHours()+8):t.getHours()+8}:${t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}:${t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds()}`}(n):n}};t.push(l)}));const s=[];e.json.meta.data.data.forEach(((e,t)=>{s.push(e)})),Me(!1),nt(t,s,"",He,Le,Ve),M(10),Ze(1)}else p.ZP.error(e.json.meta.message),Ge("1"),qe(0),Me(!1)})).catch((()=>{Me(!1)}))}),[Ne]),dt=()=>{Fe(!Ke),Pe(Ke?"240":"0"),De(Ke?"240":"0")};(0,o.useEffect)((()=>{let e=sessionStorage.getItem("sqldatabaseid");return e&&Ee(e),()=>{-1==window.location.pathname.indexOf("/tablemodelview/list/")&&(sessionStorage.removeItem("sqldatabaseid"),Ee(""))}}),[window.location.pathname]);const ct=e=>{M(e.pageSize),Ze(e.current)},ut=e=>{ve(e),rt(e)},pt=(0,ye.w)();return(0,i.tZ)(W.Rh,null,pt&&(0,i.tZ)(i.xB,{styles:i.iv`
            // 头部
            .ant-layout-sider-children .ant-card-body {
              padding: 10px;
              border: 0;
              color: #000 !important;
            }
            // 整体背景
            .ant-layout-sider-children,
            .ant-menu.ant-menu-dark,
            .ant-input-search,
            .ant-layout-sider-children .ant-card,
            .ant-layout-sider-children .ant-layout {
              background: #ffffff !important;
            }
            // 搜索框
            .inputcss .ant-input-affix-wrapper {
              background-color: #fff !important;
              border: none;
              color: #000 !important;
              height: 36px;
            }
            .inputcss .ant-input-group-addon {
              background-color: #fff !important;
              border: none;
              color: #000 !important;
            }
            .ant-input-affix-wrapper-focused {
              box-shadow: 0 0 0 2px rgb(0 0 0 / 5%) !important;
            }
            .ant-layout-sider-children .ant-input-group .ant-input,
            .ant-layout-sider-children .ant-input-search-button {
              border: 0px solid #eee !important;
              border-radius: 1px !important;
              color: #000 !important;
            }
            .inputcss .ant-select {
              color: #000 !important;
            }

            .inputcss input {
              background: #fff !important;
              color: #000 !important;
            }

            .leftMenuSider .lefttitle {
              background: #fff !important;
            }
            .inputcss .ant-select-arrow {
              color: #000 !important;
            }

            // 列表相关
            .ant-menu.ant-menu-dark,
            .ant-menu-dark .ant-menu-item,
            .ant-menu-submenu,
            .ant-layout-sider-children .ant-input-search-button svg {
              color: #000 !important;
            }

            .ant-menu-submenu-active,
            .ant-menu-item-active {
              color: #000 !important;
              background: #e7e7e7 !important;
            }

            .maxHeight800 .ant-menu-submenu-active,
            .maxHeight800 .ant-menu-item-active {
              color: #000 !important;
              background: #e7e7e7 !important;
            }

            .ant-menu.ant-menu-dark,
            .ant-menu-dark .ant-menu-sub,
            .ant-menu.ant-menu-dark .ant-menu-sub {
              color: #000 !important;
              background: #fff !important;
            }
            .ant-menu-dark.ant-menu-dark:not(.ant-menu-horizontal)
              .ant-menu-item-selected {
              background-color: #e7e7e7 !important;
            }

            .ant-menu-submenu-title:hover {
              color: #000 !important;
            }

            .foldbtn {
              border-left: 20px solid #1523351a !important;
            }
          `}),(0,i.tZ)(r.e,{style:{position:"relative",left:0,zIndex:9,background:pt?"#ffffff":"#1c2f47",borderRight:(pt?0:1)+"px solid #777777",height:"calc(100vh - 50px)"},enable:{right:!0},size:{width:_e+"px"},onResize:(e,t,a,n)=>((e,t,a,n)=>{let s=je-0+(n.width-0);Pe(s)})(0,0,0,n),onResizeStart:e=>{},onResizeStop:(e,t,a,n)=>{let s=je-0+(n.width-0);De(s),(_e<=130&&!Ke||_e>130&&Ke)&&dt()},maxWidth:"550px",minWidth:Ke?"0px":"85px"},(0,i.tZ)(Ot,{className:"leftMenuSider",collapsible:!0,collapsed:Ke,trigger:null},(0,i.tZ)(ot,{sonwidth:_e,collapsed:Ke,handleChangeMenu:nt,handleChangeMenu_Edit:st,handleRemoveId:function(){Ee("")},markId:We,setBasicInfo:Ue})),(0,i.tZ)("span",{onClick:()=>dt(),className:"foldbtn"},Ke?(0,i.tZ)(V.default,{className:"foldbtnsvg"}):(0,i.tZ)(B.default,{className:"foldbtnsvg"}))),(0,i.tZ)(Mt,{className:"Contenttyle"},Ne&&(0,i.tZ)("div",{style:{display:"flex"}},(0,i.tZ)(ne.Z,s()({},tt,{showBasicInfo:!0})),(0,i.tZ)("div",{style:{height:"47px",background:"#ffffff",lineHeight:"47px",flexGrow:1}},(0,i.tZ)(m.Z,{title:1===Je?(0,z.t)("Cancel frequently used tags"):(0,z.t)("Common tags"),placement:"bottom"},(0,i.tZ)("span",null,(0,i.tZ)(A,{count:1,onChange:e=>{qe(e);const t=1===e,a={mark_user_id:Xe,table_id:parseInt(Ne),is_mark:t};if(1===e)"1"!==We?K.Z.post({endpoint:"/api/v1/dataset_mark/",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{e.json.id&&(p.ZP.success("\u6807\u8bb0\u6210\u529f"),rt(100))})):(p.ZP.error("\u6570\u636e\u9519\u8bef"),qe(0));else{const e={is_mark:t};K.Z.delete({endpoint:`/api/v1/dataset_mark/${We}`,body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>{"OK"===e.json.message&&(p.ZP.success("\u53d6\u6d88\u6210\u529f"),rt(100))}))}},value:Je}))))),(0,i.tZ)(fe,{show:b,onHide:()=>S(!1),onDatasetAdd:g}),C&&(0,i.tZ)(Q.Z,{description:(0,z.t)("The dataset %s is linked to %s charts that appear on %s dashboards. Are you sure you want to continue? Deleting the dataset will break those objects.",C.table_name,C.chart_count,C.dashboard_count),onConfirm:()=>{C&&(({id:a,table_name:n})=>{K.Z.delete({endpoint:`/api/v1/dataset/${a}`}).then((()=>{g(),k(null),t((0,z.t)("Deleted: %s",n))}),(0,J.v$)((t=>e((0,z.t)("There was an issue deleting %s: %s",n,t)))))})(C)},onHide:()=>{k(null)},open:!0,title:(0,z.t)("Delete Dataset?")}),_&&(0,i.tZ)(X.W,{datasource:_,onDatasourceSave:g,onHide:()=>{P(null)},show:!0}),(0,i.tZ)(G.Z,{title:(0,z.t)("Please confirm"),description:(0,z.t)("Are you sure you want to delete the selected datasets?"),onConfirm:a=>{K.Z.delete({endpoint:`/api/v1/dataset/?q=${c().encode(a.map((({id:e})=>e)))}`}).then((({json:e={}})=>{g(),t(e.message)}),(0,J.v$)((t=>e((0,z.t)("There was an issue deleting the selected datasets: %s",t)))))}},(e=>{const t=[];return we&&t.push({key:"delete",name:(0,z.t)("Delete"),onSelect:e,type:"danger"}),ke&&t.push({key:"export",name:(0,z.t)("Export"),type:"primary",onSelect:et}),(0,i.tZ)("div",null,Ne?(0,i.tZ)("div",{style:{padding:"20px",background:"#fff",position:"relative",maxHeight:"calc(100vh - 120px)",overflowY:"auto"}},(0,i.tZ)($.Z,{onChange:it,activeKey:Ie},(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Data Preview"),key:"1"},(0,i.tZ)(H.Z,{columns:be.columns,dataSource:be.dataTable,bordered:!0,rowKey:e=>e.key,scroll:{x:!0,y:(be.dataTable||[]).length>(window.innerHeight-400)/55?window.innerHeight-400+"px":void 0},show:x,loading:Oe,className:"datasettable",onChange:ct,pagination:{pageSize:O,current:se,showSizeChanger:!1}}),(0,i.tZ)("div",{style:{width:"100%",textAlign:"right"}},be.dataTable.length>0&&(0,i.tZ)("div",{style:{marginRight:"17px"}},(0,i.tZ)("span",{style:{marginRight:"5px"}},(0,z.t)("Select the amount of data to display"),":"),(0,i.tZ)(R.Z,{value:ge,style:{width:120},onChange:ut,options:[{value:"10",label:"10"},{value:"100",label:"100"},{value:"1000",label:"1000"},{value:"10000",label:"10000"},{value:"100000",label:"100000"}]}))),1==Ie&&(0,i.tZ)("div",{style:{position:"absolute",top:"39px",right:"42px",fontSize:"14px",cursor:"pointer",color:"#5D9CEC"}},(0,i.tZ)(Y.default,{onClick:rt}))),y.row&&He&&He>=6&&(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Row Level Security"),key:"2"},(0,i.tZ)(kt,{datasetid:Ne,isEdit:y.row>=4&&He>=6})),y.row&&He&&He>=6&&(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Columns Level Security"),key:"3"},(0,i.tZ)(Pt,{datasetid:Ne,isEdit:y.col>=4&&He>=6})),He&&He>=6&&(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Data Masking"),key:"4"},(0,i.tZ)(Dt,{datasetid:Ne})),He&&He>=4&&4==Le&&(0,i.tZ)($.Z.TabPane,{tab:(0,z.t)("Database Sync"),key:"5"},(0,i.tZ)(Tt,{datasetid:Ne})))):(0,i.tZ)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"90vh"}},(0,i.tZ)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,i.tZ)("img",{style:{width:"90px"},src:(0,U.VU)("/static/assets/images/emptyicon.png"),alt:""}),(0,i.tZ)("div",{style:{fontSize:"16px",color:"#BBBDBF",marginTop:"20px"}},(0,z.t)("Please select a dataset on the left")))))})),(0,i.tZ)(ce.Z,{resourceName:"dataset",resourceLabel:(0,z.t)("dataset"),passwordsNeededMessage:lt.iX,confirmOverwriteMessage:lt.mI,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{D(!1),g(),t((0,z.t)("Dataset imported"))},show:j,onHide:()=>{D(!1)},passwordFields:N,setPasswordFields:E}),I&&(0,i.tZ)(ae.Z,null)))}))}}]);