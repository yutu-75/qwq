(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[11795],{282833:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var s=i(568924),l=i(643048);const r=new s.FilterXSS({whiteList:{...(0,s.getDefaultWhiteList)(),span:["style","class","title"],div:["style","class"],a:["style","class","href","title","target"],img:["style","class","src","alt","title","width","height"],video:["autoplay","controls","loop","preload","src","height","width","muted"]},stripIgnoreTag:!0,css:!1});function n(t,e){return void 0===e||null===e||e instanceof l.Z&&null===e.input?[!1,""]:t?[!1,t(e)]:"string"===typeof e?/<[^>]+>/.test(e)?[!0,r.process(e)]:[!1,e]:[!1,e.toString()]}},643048:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});const s=/T(\d{2}:){2}\d{2}$/;class l extends Date{constructor(t,{formatter:e=String,forceUTC:i=!0}={}){let l=t;i&&"string"===typeof l&&s.test(l)&&(l=`${l}Z`),super(l),this.formatter=void 0,this.input=void 0,this.input=t,this.formatter=e,this.toString=()=>this.formatter===String?String(this.input):this.formatter?this.formatter(this):Date.toString.call(this)}}},200651:(t,e,i)=>{"use strict";i.r(e),i.d(e,{CREATE_NEW_SLICE:()=>_,FETCH_DATASOURCES_STARTED:()=>u,FETCH_DATASOURCES_SUCCEEDED:()=>g,FETCH_DATASOURCE_SUCCEEDED:()=>c,FETCH_FAVE_STAR:()=>v,POST_DATASOURCE_STARTED:()=>a,SAVE_FAVE_STAR:()=>y,SET_EXPLORE_CONTROLS:()=>k,SET_FIELD_VALUE:()=>E,SET_FORCE_QUERY:()=>N,SET_FORM_DATA:()=>T,SET_SAVE_ACTION:()=>O,SLICE_UPDATED:()=>z,TOGGLE_FAVE_STAR:()=>m,UPDATE_CHART_TITLE:()=>D,UPDATE_FORM_DATA_BY_DATASOURCE:()=>o,createNewSlice:()=>I,exploreActions:()=>H,fetchDatasourceSucceeded:()=>d,fetchDatasourcesStarted:()=>f,fetchDatasourcesSucceeded:()=>p,fetchFaveStar:()=>b,saveFaveStar:()=>x,setControlValue:()=>C,setExploreControls:()=>S,setForceQuery:()=>M,setFormData:()=>$,setSaveAction:()=>R,sliceUpdated:()=>F,toggleFaveStar:()=>w,updateChartTitle:()=>A,updateFormDataByDatasource:()=>h});var s=i(431069),l=i(455867),r=i(672570);const n="/superset/favstar/slice",o="UPDATE_FORM_DATA_BY_DATASOURCE";function h(t,e){return{type:o,prevDatasource:t,newDatasource:e}}const a="POST_DATASOURCE_STARTED",c="FETCH_DATASOURCE_SUCCEEDED";function d(){return{type:c}}const u="FETCH_DATASOURCES_STARTED";function f(){return{type:u}}const g="FETCH_DATASOURCES_SUCCEEDED";function p(){return{type:g}}const m="TOGGLE_FAVE_STAR";function w(t){return{type:m,isStarred:t}}const v="FETCH_FAVE_STAR";function b(t){return function(e){s.Z.get({endpoint:`${n}/${t}/count/`}).then((({json:t})=>{t.count>0&&e(w(!0))}))}}const y="SAVE_FAVE_STAR";function x(t,e){return function(i){const o=e?"unselect":"select";s.Z.get({endpoint:`${n}/${t}/${o}/`}).then((()=>i(w(!e)))).catch((()=>{i((0,r.Gb)((0,l.t)("An error occurred while starring this chart")))}))}}const E="SET_FIELD_VALUE";function C(t,e,i){return{type:E,controlName:t,value:e,validationErrors:i}}const k="UPDATE_EXPLORE_CONTROLS";function S(t){return{type:k,formData:t}}const T="UPDATE_FORM_DATA";function $(t){return{type:T,formData:t}}const D="UPDATE_CHART_TITLE";function A(t){return{type:D,sliceName:t}}const O="SET_SAVE_ACTION";function R(t){return{type:O,saveAction:t}}const _="CREATE_NEW_SLICE";function I(t,e,i,s,l){return{type:_,can_add:t,can_download:e,can_overwrite:i,slice:s,form_data:l}}const z="SLICE_UPDATED";function F(t){return{type:z,slice:t}}const N="SET_FORCE_QUERY";function M(t){return{type:N,force:t}}const H={...r.s2,fetchDatasourcesStarted:f,fetchDatasourcesSucceeded:p,toggleFaveStar:w,fetchFaveStar:b,saveFaveStar:x,setControlValue:C,setExploreControls:S,updateChartTitle:A,createNewSlice:I,sliceUpdated:F,setForceQuery:M}},311795:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>zs});var s=i(667294),l=i(828216),r=i(751995);class n{constructor(t,e=""){"string"===typeof t?(this.el=document.createElement(t),this.el.className=e):this.el=t,this.data={}}data(t,e){return void 0!==e?(this.data[t]=e,this):this.data[t]}on(t,e){const[i,...s]=t.split(".");let l=i;return"mousewheel"===l&&/Firefox/i.test(window.navigator.userAgent)&&(l="DOMMouseScroll"),this.el.addEventListener(l,(t=>{e(t);for(let e=0;e<s.length;e+=1){const i=s[e];if("left"===i&&0!==t.button)return;if("right"===i&&2!==t.button)return;"stop"===i&&t.stopPropagation()}})),this}offset(t){if(void 0!==t)return Object.keys(t).forEach((e=>{this.css(e,`${t[e]}px`)})),this;const{offsetTop:e,offsetLeft:i,offsetHeight:s,offsetWidth:l}=this.el;return{top:e,left:i,height:s,width:l}}scroll(t){const{el:e}=this;return void 0!==t&&(void 0!==t.left&&(e.scrollLeft=t.left),void 0!==t.top&&(e.scrollTop=t.top)),{left:e.scrollLeft,top:e.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new n(this.el.parentNode)}children(...t){return 0===arguments.length?this.el.childNodes:(t.forEach((t=>this.child(t))),this)}removeChild(t){this.el.removeChild(t)}child(t){let e=t;return"string"===typeof t?e=document.createTextNode(t):t instanceof n&&(e=t.el),this.el.appendChild(e),this}contains(t){return this.el.contains(t)}className(t){return void 0!==t?(this.el.className=t,this):this.el.className}addClass(t){return this.el.classList.add(t),this}hasClass(t){return this.el.classList.contains(t)}removeClass(t){return this.el.classList.remove(t),this}toggle(t="active"){return this.toggleClass(t)}toggleClass(t){return this.el.classList.toggle(t)}active(t=!0,e="active"){return t?this.addClass(e):this.removeClass(e),this}checked(t=!0){return this.active(t,"checked"),this}disabled(t=!0){return t?this.addClass("disabled"):this.removeClass("disabled"),this}attr(t,e){if(void 0!==e)this.el.setAttribute(t,e);else{if("string"===typeof t)return this.el.getAttribute(t);Object.keys(t).forEach((e=>{this.el.setAttribute(e,t[e])}))}return this}removeAttr(t){return this.el.removeAttribute(t),this}html(t){return void 0!==t?(this.el.innerHTML=t,this):this.el.innerHTML}val(t){return void 0!==t?(this.el.value=t,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...t){return t.forEach((t=>this.el.style.removeProperty(t))),this}css(t,e){return void 0===e&&"string"!==typeof t?(Object.keys(t).forEach((e=>{this.el.style[e]=t[e]})),this):void 0!==e?(this.el.style[t]=e,this):this.el.style[t]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const o=(t,e="")=>new n(t,e),h=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function a(t){let e="",i=t;for(;i>=h.length;)i/=h.length,i-=1,e+=h[parseInt(i,10)%h.length];const s=t%h.length;return e+=h[s],e}function c(t){let e=0;for(let i=0;i<t.length-1;i+=1){const s=t.charCodeAt(i)-65,l=t.length-1-i;e+=h.length**l+h.length*s}return e+=t.charCodeAt(t.length-1)-65,e}function d(t){let e="",i="";for(let s=0;s<t.length;s+=1)t.charAt(s)>="0"&&t.charAt(s)<="9"?i+=t.charAt(s):e+=t.charAt(s);return[c(e),parseInt(i,10)-1]}function u(t,e){return`${a(t)}${e+1}`}function f(t,e,i,s=(()=>!0)){if(0===e&&0===i)return t;const[l,r]=d(t);return s(l,r)?u(l+e,r+i):t}class g{constructor(t,e,i,s,l=0,r=0){this.sri=t,this.sci=e,this.eri=i,this.eci=s,this.w=l,this.h=r}set(t,e,i,s){this.sri=t,this.sci=e,this.eri=i,this.eci=s}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...t){let[e,i]=[0,0];1===t.length?[i,e]=d(t[0]):2===t.length&&([e,i]=t);const{sri:s,sci:l,eri:r,eci:n}=this;return s<=e&&e<=r&&l<=i&&i<=n}each(t,e=(()=>!0)){const{sri:i,sci:s,eri:l,eci:r}=this;for(let n=i;n<=l;n+=1)if(e(n))for(let e=s;e<=r;e+=1)t(n,e)}contains(t){return this.sri<=t.sri&&this.sci<=t.sci&&this.eri>=t.eri&&this.eci>=t.eci}within(t){return this.sri>=t.sri&&this.sci>=t.sci&&this.eri<=t.eri&&this.eci<=t.eci}disjoint(t){return this.sri>t.eri||this.sci>t.eci||t.sri>this.eri||t.sci>this.eci}intersects(t){return this.sri<=t.eri&&this.sci<=t.eci&&t.sri<=this.eri&&t.sci<=this.eci}union(t){const{sri:e,sci:i,eri:s,eci:l}=this;return new g(t.sri<e?t.sri:e,t.sci<i?t.sci:i,t.eri>s?t.eri:s,t.eci>l?t.eci:l)}difference(t){const e=[],i=(t,i,s,l)=>{e.push(new g(t,i,s,l))},{sri:s,sci:l,eri:r,eci:n}=this,o=t.sri-s,h=t.sci-l,a=r-t.eri,c=n-t.eci;return o>0?(i(s,l,t.sri-1,n),a>0?(i(t.eri+1,l,r,n),h>0&&i(t.sri,l,t.eri,t.sci-1),c>0&&i(t.sri,t.eci+1,t.eri,n)):(h>0&&i(t.sri,l,r,t.sci-1),c>0&&i(t.sri,t.eci+1,r,n))):a>0&&(i(t.eri+1,l,r,n),h>0&&i(s,l,t.eri,t.sci-1),c>0&&i(s,t.eci+1,t.eri,n)),h>0?(i(s,l,r,t.sci-1),c>0?(i(s,t.eri+1,r,n),o>0&&i(s,t.sci,t.sri-1,t.eci),a>0&&i(t.sri+1,t.sci,r,t.eci)):(o>0&&i(s,t.sci,t.sri-1,n),a>0&&i(t.sri+1,t.sci,r,n))):c>0&&(i(r,t.eci+1,r,n),o>0&&i(s,l,t.sri-1,t.eci),a>0&&i(t.eri+1,l,r,t.eci)),e}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:t,sci:e,eri:i,eci:s}=this;let l=u(e,t);return this.multiple()&&(l=`${l}:${u(s,i)}`),l}clone(){const{sri:t,sci:e,eri:i,eci:s,w:l,h:r}=this;return new g(t,e,i,s,l,r)}equals(t){return this.eri===t.eri&&this.eci===t.eci&&this.sri===t.sri&&this.sci===t.sci}static valueOf(t){const e=t.split(":"),[i,s]=d(e[0]);let[l,r]=[s,i];return e.length>1&&([r,l]=d(e[1])),new g(s,i,l,r)}}class p{constructor(){this.range=new g(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(t,e){this.ri=t,this.ci=e}size(){return this.range.size()}}class m{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}class w{constructor(){this.undoItems=[],this.redoItems=[]}add(t){this.undoItems.push(JSON.stringify(t)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(t,e){const{undoItems:i,redoItems:s}=this;this.canUndo()&&(s.push(JSON.stringify(t)),e(JSON.parse(i.pop())))}redo(t,e){const{undoItems:i,redoItems:s}=this;this.canRedo()&&(i.push(JSON.stringify(t)),e(JSON.parse(s.pop())))}}class v{constructor(){this.range=null,this.state="clear"}copy(t){return this.range=t,this.state="copy",this}cut(t){return this.range=t,this.state="cut",this}isCopy(){return"copy"===this.state}isCut(){return"cut"===this.state}isClear(){return"clear"===this.state}clear(){this.range=null,this.state="clear"}}class b{constructor(t,e,i){this.ci=t,this.operator=e,this.value=i}set(t,e){this.operator=t,this.value=e}includes(t){const{operator:e,value:i}=this;return"all"===e||"in"===e&&i.includes(t)}vlength(){const{operator:t,value:e}=this;return"in"===t?e.length:0}getData(){const{ci:t,operator:e,value:i}=this;return{ci:t,operator:e,value:i}}}class y{constructor(t,e){this.ci=t,this.order=e}asc(){return"asc"===this.order}desc(){return"desc"===this.order}}class x{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:t,filters:e,sort:i}){null!=t&&(this.ref=t,this.filters=e.map((t=>new b(t.ci,t.operator,t.value))),i&&(this.sort=new y(i.ci,i.order)))}getData(){if(this.active()){const{ref:t,filters:e,sort:i}=this;return{ref:t,filters:e.map((t=>t.getData())),sort:i}}return{}}addFilter(t,e,i){const s=this.getFilter(t);null==s?this.filters.push(new b(t,e,i)):s.set(e,i)}setSort(t,e){this.sort=e?new y(t,e):null}includes(t,e){return!!this.active()&&this.hrange().includes(t,e)}getSort(t){const{sort:e}=this;return e&&e.ci===t?e:null}getFilter(t){const{filters:e}=this;for(let i=0;i<e.length;i+=1)if(e[i].ci===t)return e[i];return null}filteredRows(t){const e=new Set,i=new Set;if(this.active()){const{sri:s,eri:l}=this.range(),{filters:r}=this;for(let n=s+1;n<=l;n+=1)for(let s=0;s<r.length;s+=1){const l=r[s],o=t(n,l.ci),h=o?o.text:"";if(!l.includes(h)){e.add(n);break}i.add(n)}}return{rset:e,fset:i}}items(t,e){const i={};if(this.active()){const{sri:s,eri:l}=this.range();for(let r=s+1;r<=l;r+=1){const s=e(r,t);if(null===s||/^\s*$/.test(s.text))i[""]=(i[""]||0)+1;else{const t=s.text,e=(i[t]||0)+1;i[t]=e}}}return i}range(){return g.valueOf(this.ref)}hrange(){const t=this.range();return t.eri=t.sri,t}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return null!==this.ref}}class E{constructor(t=[]){this._=t}forEach(t){this._.forEach(t)}deleteWithin(t){this._=this._.filter((e=>!e.within(t)))}getFirstIncludes(t,e){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(t,e))return s}return null}filterIntersects(t){return new E(this._.filter((e=>e.intersects(t))))}intersects(t){for(let e=0;e<this._.length;e+=1){if(this._[e].intersects(t))return!0}return!1}union(t){let e=t;return this._.forEach((t=>{t.intersects(e)&&(e=t.union(e))})),e}add(t){this.deleteWithin(t),this._.push(t)}shift(t,e,i,s){this._.forEach((l=>{const{sri:r,sci:n,eri:o,eci:h}=l,a=l;"row"===t?r>=e?(a.sri+=i,a.eri+=i):r<e&&e<=o&&(a.eri+=i,s(r,n,i,0)):"column"===t&&(n>=e?(a.sci+=i,a.eci+=i):n<e&&e<=h&&(a.eci+=i,s(r,n,0,i)))}))}move(t,e,i){this._.forEach((s=>{const l=s;l.within(t)&&(l.eri+=e,l.sri+=e,l.sci+=i,l.eci+=i)}))}setData(t){return this._=t.map((t=>g.valueOf(t))),this}getData(){return this._.map((t=>t.toString()))}}const C=(t={},...e)=>(e.forEach((e=>{Object.keys(e).forEach((i=>{const s=e[i];"string"===typeof s||"number"===typeof s||"boolean"===typeof s?t[i]=s:"function"!==typeof s&&!Array.isArray(s)&&s instanceof Object?(t[i]=t[i]||{},C(t[i],s)):t[i]=s}))})),t);function k(t){const e=`${t}`;let i=0,s=!1;for(let t=0;t<e.length;t+=1)!0===s&&(i+=1),"."===e.charAt(t)&&(s=!0);return i}function S(t,e,i){if(Number.isNaN(e)||Number.isNaN(i))return e+t+i;const s=k(e),l=k(i),r=Number(e),n=Number(i);let o=0;if("-"===t)o=r-n;else if("+"===t)o=r+n;else if("*"===t)o=r*n;else if("/"===t)return o=r/n,k(o)>5?o.toFixed(2):o;return o.toFixed(Math.max(s,l))}const T={cloneDeep:function(t){return JSON.parse(JSON.stringify(t))},merge:(...t)=>C({},...t),equals:function t(e,i){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!1;for(let l=0;l<s.length;l+=1){const r=s[l],n=e[r],o=i[r];if(void 0===o)return!1;if("string"===typeof n||"number"===typeof n||"boolean"===typeof n){if(n!==o)return!1}else if(Array.isArray(n)){if(n.length!==o.length)return!1;for(let e=0;e<n.length;e+=1)if(!t(n[e],o[e]))return!1}else if("function"!==typeof n&&!Array.isArray(n)&&n instanceof Object&&!t(n,o))return!1}return!0},arrayEquals:function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==e[i])return!1;return!0},sum:(t,e=(t=>t))=>{let i=0,s=0;return Object.keys(t).forEach((l=>{i+=e(t[l],l),s+=1})),[i,s]},rangeEach:function(t,e,i){for(let s=t;s<e;s+=1)i(s)},rangeSum:function(t,e,i){let s=0;for(let l=t;l<e;l+=1)s+=i(l);return s},rangeReduceIf:function(t,e,i,s,l,r){let n=i,o=s,h=t;for(;h<e&&!(n>l);h+=1)o=r(h),n+=o;return[h,n-o,o]},deleteProperty:function(t,e){const i=t[`${e}`];return delete t[`${e}`],i},numberCalc:S};class ${constructor({len:t,height:e}){this._={},this.len=t,this.height=e}getHeight(t){if(this.isHide(t))return 0;const e=this.get(t);return e&&e.height?e.height:this.height}setHeight(t,e){this.getOrNew(t).height=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this.get(t);return e&&e.hide}setHide(t,e){const i=this.getOrNew(t);!0===e?i.hide=!0:delete i.hide}setStyle(t,e){this.getOrNew(t).style=e}sumHeight(t,e,i){return T.rangeSum(t,e,(t=>i&&i.has(t)?0:this.getHeight(t)))}totalHeight(){return this.sumHeight(0,this.len)}get(t){return this._[t]}getOrNew(t){return this._[t]=this._[t]||{cells:{}},this._[t]}getCell(t,e){const i=this.get(t);return void 0!==i&&void 0!==i.cells&&void 0!==i.cells[e]?i.cells[e]:null}getCellMerge(t,e){const i=this.getCell(t,e);return i&&i.merge?i.merge:[0,0]}getCellOrNew(t,e){const i=this.getOrNew(t);return i.cells[e]=i.cells[e]||{},i.cells[e]}setCell(t,e,i,s="all"){const l=this.getOrNew(t);"all"===s?l.cells[e]=i:"text"===s?(l.cells[e]=l.cells[e]||{},l.cells[e].text=i.text):"format"===s&&(l.cells[e]=l.cells[e]||{},l.cells[e].style=i.style,i.merge&&(l.cells[e].merge=i.merge))}setCellText(t,e,i){const s=this.getCellOrNew(t,e);!1!==s.editable&&(s.text=i)}copyPaste(t,e,i,s=!1,l=(()=>{})){const{sri:r,sci:n,eri:o,eci:h}=t,a=e.sri,c=e.sci,d=e.eri,u=e.eci,[g,p]=t.size(),[m,w]=e.size();let v=!0,b=0;(d<r||u<n)&&(v=!1,b=d<r?m:w);for(let t=r;t<=o;t+=1)if(this._[t])for(let e=n;e<=h;e+=1)if(this._[t].cells&&this._[t].cells[e])for(let m=a;m<=d;m+=g)for(let w=c;w<=u;w+=p){const y=m+(t-r),x=w+(e-n),E=T.cloneDeep(this._[t].cells[e]);if(s&&E&&E.text&&E.text.length>0){const{text:t}=E;let e=w-c+(m-a)+2;if(v||(e-=b+1),"="===t[0])E.text=t.replace(/[a-zA-Z]{1,3}\d+/g,(t=>{let[i,s]=[0,0];return r===a?i=e-1:s=e-1,/^\d+$/.test(t)?t:f(t,i,s)}));else if(g<=1&&p>1&&(a>o||d<r)||p<=1&&g>1&&(c>h||u<n)||g<=1&&p<=1){const i=/[\\.\d]+$/.exec(t);if(null!==i){const s=Number(i[0])+e-1;E.text=t.substring(0,i.index)+s}}}this.setCell(y,x,E,i),l(y,x,E)}}cutPaste(t,e){const i={};this.each((s=>{this.eachCells(s,(l=>{let r=parseInt(s,10),n=parseInt(l,10);t.includes(s,l)&&(r=e.sri+(r-t.sri),n=e.sci+(n-t.sci)),i[r]=i[r]||{cells:{}},i[r].cells[n]=this._[s].cells[l]}))})),this._=i}paste(t,e){if(t.length<=0)return;const{sri:i,sci:s}=e;t.forEach(((t,e)=>{const l=i+e;t.forEach(((t,e)=>{const i=s+e;this.setCellText(l,i,t)}))}))}insert(t,e=1){const i={};this.each(((s,l)=>{let r=parseInt(s,10);r>=t&&(r+=e,this.eachCells(s,((i,s)=>{s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,(i=>f(i,0,e,((e,i)=>i>=t)))))}))),i[r]=l})),this._=i,this.len+=e}delete(t,e){const i=e-t+1,s={};this.each(((l,r)=>{const n=parseInt(l,10);n<t?s[n]=r:l>e&&(s[n-i]=r,this.eachCells(l,((t,s)=>{s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,(t=>f(t,0,-i,((t,i)=>i>e)))))})))})),this._=s,this.len-=i}insertColumn(t,e=1){this.each(((i,s)=>{const l={};this.eachCells(i,((i,s)=>{let r=parseInt(i,10);r>=t&&(r+=e,s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,(i=>f(i,e,0,(e=>e>=t)))))),l[r]=s})),s.cells=l}))}deleteColumn(t,e){const i=e-t+1;this.each(((s,l)=>{const r={};this.eachCells(s,((s,l)=>{const n=parseInt(s,10);n<t?r[n]=l:n>e&&(r[n-i]=l,l.text&&"="===l.text[0]&&(l.text=l.text.replace(/[a-zA-Z]{1,3}\d+/g,(t=>f(t,-i,0,(t=>t>e))))))})),l.cells=r}))}deleteCells(t,e="all"){t.each(((t,i)=>{this.deleteCell(t,i,e)}))}deleteCell(t,e,i="all"){const s=this.get(t);if(null!==s){const l=this.getCell(t,e);null!==l&&!1!==l.editable&&("all"===i?delete s.cells[e]:"text"===i?(l.text&&delete l.text,l.value&&delete l.value):"format"===i?(void 0!==l.style&&delete l.style,l.merge&&delete l.merge):"merge"===i&&l.merge&&delete l.merge)}}maxCell(){const t=Object.keys(this._),e=t[t.length-1],i=this._[e];if(i){const{cells:t}=i,s=Object.keys(t),l=s[s.length-1];return[parseInt(e,10),parseInt(l,10)]}return[0,0]}each(t){Object.entries(this._).forEach((([e,i])=>{t(e,i)}))}eachCells(t,e){this._[t]&&this._[t].cells&&Object.entries(this._[t].cells).forEach((([t,i])=>{e(t,i)}))}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}}class D{constructor({len:t,width:e,indexWidth:i,minWidth:s}){this._={},this.len=t,this.width=e,this.indexWidth=i,this.minWidth=s}setData(t){t.len&&(this.len=t.len,delete t.len),this._=t}getData(){const{len:t}=this;return Object.assign({len:t},this._)}getWidth(t){if(this.isHide(t))return 0;const e=this._[t];return e&&e.width?e.width:this.width}getOrNew(t){return this._[t]=this._[t]||{},this._[t]}setWidth(t,e){this.getOrNew(t).width=e}unhide(t){let e=t;for(;e>0&&(e-=1,this.isHide(e));)this.setHide(e,!1)}isHide(t){const e=this._[t];return e&&e.hide}setHide(t,e){const i=this.getOrNew(t);!0===e?i.hide=!0:delete i.hide}setStyle(t,e){this.getOrNew(t).style=e}sumWidth(t,e){return T.rangeSum(t,e,(t=>this.getWidth(t)))}totalWidth(){return this.sumWidth(0,this.len)}}let A=["en"];const O={en:{toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}}};function R(t,e){if(e)for(const i of A){if(!e[i])break;let s=e[i];const l=t.match(/(?:\\.|[^.])+/g);for(let t=0;t<l.length;t+=1){const e=s[l[t]];if(!e)break;if(t===l.length-1)return e;s=e}}}function _(t){let e=R(t,O);return!e&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(e=R(t,window.x_spreadsheet.$messages)),e||""}function I(t){return()=>_(t)}function z(t,e,i=!1){i?A=[t]:A.unshift(t),e&&(O[t]=e)}const F={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function N(t,e,...i){let s="";return t||(s=_(`validation.${e}`,...i)),[t,s]}class M{constructor(t,e,i,s){this.required=e,this.value=i,this.type=t,this.operator=s,this.message=""}parseValue(t){const{type:e}=this;return"date"===e?new Date(t):"number"===e?Number(t):t}equals(t){let e=this.type===t.type&&this.required===t.required&&this.operator===t.operator;return e&&(e=Array.isArray(this.value)?T.arrayEquals(this.value,t.value):this.value===t.value),e}values(){return this.value.split(",")}validate(t){const{required:e,operator:i,value:s,type:l}=this;if(e&&/^\s*$/.test(t))return N(!1,"required");if(/^\s*$/.test(t))return[!0];if(F[l]&&!F[l].test(t))return N(!1,"notMatch");if("list"===l)return N(this.values().includes(t),"notIn");if(i){const e=this.parseValue(t);if("be"===i){const[t,i]=s;return N(e>=this.parseValue(t)&&e<=this.parseValue(i),"between",t,i)}if("nbe"===i){const[t,i]=s;return N(e<this.parseValue(t)||e>this.parseValue(i),"notBetween",t,i)}if("eq"===i)return N(e===this.parseValue(s),"equal",s);if("neq"===i)return N(e!==this.parseValue(s),"notEqual",s);if("lt"===i)return N(e<this.parseValue(s),"lessThan",s);if("lte"===i)return N(e<=this.parseValue(s),"lessThanEqual",s);if("gt"===i)return N(e>this.parseValue(s),"greaterThan",s);if("gte"===i)return N(e>=this.parseValue(s),"greaterThanEqual",s)}return[!0]}}class H{constructor(t,e,i){this.refs=e,this.mode=t,this.validator=i}includes(t,e){const{refs:i}=this;for(let s=0;s<i.length;s+=1){if(g.valueOf(i[s]).includes(t,e))return!0}return!1}addRef(t){this.remove(g.valueOf(t)),this.refs.push(t)}remove(t){const e=[];this.refs.forEach((i=>{const s=g.valueOf(i);if(s.intersects(t)){s.difference(t).forEach((t=>e.push(t.toString())))}else e.push(i)})),this.refs=e}getData(){const{refs:t,mode:e,validator:i}=this,{type:s,required:l,operator:r,value:n}=i;return{refs:t,mode:e,type:s,required:l,operator:r,value:n}}static valueOf({refs:t,mode:e,type:i,required:s,operator:l,value:r}){return new H(e,t,new M(i,s,r,l))}}class V{constructor(){this._=[],this.errors=new Map}getError(t,e){return this.errors.get(`${t}_${e}`)}validate(t,e,i){const s=this.get(t,e),l=`${t}_${e}`,{errors:r}=this;if(null!==s){const[t,e]=s.validator.validate(i);t?r.delete(l):r.set(l,e)}else r.delete(l);return!0}add(t,e,{type:i,required:s,value:l,operator:r}){const n=new M(i,s,l,r),o=this.getByValidator(n);null!==o?o.addRef(e):this._.push(new H(t,[e],n))}getByValidator(t){for(let e=0;e<this._.length;e+=1){const i=this._[e];if(i.validator.equals(t))return i}return null}get(t,e){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(t,e))return s}return null}remove(t){this.each((e=>{e.remove(t)}))}each(t){this._.forEach((e=>t(e)))}getData(){return this._.filter((t=>t.refs.length>0)).map((t=>t.getData()))}setData(t){this._=t.map((t=>H.valueOf(t)))}}const W={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},P=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function L(t,e,i=(()=>{})){const{merges:s}=this,l=e.clone(),[r,n]=t.size(),[o,h]=e.size();return r>o&&(l.eri=e.sri+r-1),n>h&&(l.eci=e.sci+n-1),!s.intersects(l)||(i(_("error.pasteForMergedCell")),!1)}function B(t,e,i,s=!1){const{rows:l,merges:r}=this;"all"!==i&&"format"!==i||(l.deleteCells(e,i),r.deleteWithin(e)),l.copyPaste(t,e,i,s,((t,e,i)=>{if(i&&i.merge){const[s,l]=i.merge;if(s<=0&&l<=0)return;r.add(new g(t,e,t+s,e+l))}}))}function q(t,e){const{clipboard:i,rows:s,merges:l}=this;s.cutPaste(t,e),l.move(t,e.sri-t.sri,e.sci-t.sci),i.clear()}function U(t,e,i){const{styles:s,rows:l}=this,r=l.getCellOrNew(t,e);let n={};void 0!==r.style&&(n=T.cloneDeep(s[r.style])),n=T.merge(n,{border:i}),r.style=this.addStyle(n)}function j({mode:t,style:e,color:i}){const{styles:s,selector:l,rows:r}=this,{sri:n,sci:o,eri:h,eci:a}=l.range,c=!this.isSignleSelected();if(c||"inside"!==t&&"horizontal"!==t&&"vertical"!==t)if("outside"!==t||c){if("none"===t)l.range.each(((t,e)=>{const i=r.getCell(t,e);if(i&&void 0!==i.style){const t=T.cloneDeep(s[i.style]);delete t.border,i.style=this.addStyle(t)}}));else if("all"===t||"inside"===t||"outside"===t||"horizontal"===t||"vertical"===t){const s=[];for(let l=n;l<=h;l+=1)for(let d=o;d<=a;d+=1){const u=[];for(let t=0;t<s.length;t+=1){const[e,i,r,n]=s[t];if(l===e+r+1&&u.push(t),e<=l&&l<=e+r&&d===i){d+=n+1;break}}if(u.forEach((t=>s.splice(t,1))),d>a)break;const f=r.getCell(l,d);let[g,p]=[0,0];f&&f.merge&&([g,p]=f.merge,s.push([l,d,g,p]));const m=g>0&&l+g===h,w=p>0&&d+p===a;let v={};"all"===t?v={bottom:[e,i],top:[e,i],left:[e,i],right:[e,i]}:"inside"===t?(!w&&d<a&&(v.right=[e,i]),!m&&l<h&&(v.bottom=[e,i])):"horizontal"===t?!m&&l<h&&(v.bottom=[e,i]):"vertical"===t?!w&&d<a&&(v.right=[e,i]):"outside"===t&&c&&(n===l&&(v.top=[e,i]),(m||h===l)&&(v.bottom=[e,i]),o===d&&(v.left=[e,i]),(w||a===d)&&(v.right=[e,i])),Object.keys(v).length>0&&U.call(this,l,d,v),d+=p}}else if("top"===t||"bottom"===t)for(let s=o;s<=a;s+=1)"top"===t&&(U.call(this,n,s,{top:[e,i]}),s+=r.getCellMerge(n,s)[1]),"bottom"===t&&(U.call(this,h,s,{bottom:[e,i]}),s+=r.getCellMerge(h,s)[1]);else if("left"===t||"right"===t)for(let s=n;s<=h;s+=1)"left"===t&&(U.call(this,s,o,{left:[e,i]}),s+=r.getCellMerge(s,o)[0]),"right"===t&&(U.call(this,s,a,{right:[e,i]}),s+=r.getCellMerge(s,a)[0])}else U.call(this,n,o,{top:[e,i],bottom:[e,i],left:[e,i],right:[e,i]})}function Y(t,e){const{rows:i}=this,s=this.freezeTotalHeight();let l=i.height;s+i.height<t&&(l-=e);const r=this.exceptRowSet;let n=0,o=l,{height:h}=i;for(;n<i.len&&!(o>t);n+=1)r.has(n)||(h=i.getHeight(n),o+=h);return o-=h,o<=0?{ri:-1,top:0,height:h}:{ri:n-1,top:o,height:h}}function Z(t,e){const{cols:i}=this,s=this.freezeTotalWidth();let l=i.indexWidth;s+i.indexWidth<t&&(l-=e);const[r,n,o]=T.rangeReduceIf(0,i.len,l,i.indexWidth,t,(t=>i.getWidth(t)));return n<=0?{ci:-1,left:0,width:i.indexWidth}:{ci:r-1,left:n,width:o}}class X{constructor(t,e){this.settings=T.merge(W,e||{}),this.name=t||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new E,this.rows=new $(this.settings.row),this.cols=new D(this.settings.col),this.validations=new V,this.hyperlinks={},this.comments={},this.selector=new p,this.scroll=new m,this.history=new w,this.clipboard=new v,this.autoFilter=new x,this.change=()=>{},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(t,e,i){this.changeData((()=>{this.validations.add(t,e,i)}))}removeValidation(){const{range:t}=this.selector;this.changeData((()=>{this.validations.remove(t)}))}getSelectedValidator(){const{ri:t,ci:e}=this.selector,i=this.validations.get(t,e);return i?i.validator:null}getSelectedValidation(){const{ri:t,ci:e,range:i}=this.selector,s=this.validations.get(t,e),l={ref:i.toString()};return null!==s&&(l.mode=s.mode,l.validator=s.validator),l}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),(t=>{this.setData(t)}))}redo(){this.history.redo(this.getData(),(t=>{this.setData(t)}))}copy(){this.clipboard.copy(this.selector.range)}copyToSystemClipboard(){if(void 0===navigator.clipboard)return;let t="";const e=this.rows.getData();for(let i=this.selector.range.sri;i<=this.selector.range.eri;i+=1){if(P(e,i)){for(let s=this.selector.range.sci;s<=this.selector.range.eci;s+=1)if(s>this.selector.range.sci&&(t+="\t"),P(e[i].cells,s)){const l=String(e[i].cells[s].text);-1===l.indexOf("\n")&&-1===l.indexOf("\t")&&-1===l.indexOf('"')?t+=l:t+=`"${l}"`}}else for(let e=this.selector.range.sci;e<=this.selector.range.eci;e+=1)t+="\t";t+="\n"}navigator.clipboard.writeText(t).then((()=>{}),(t=>{}))}cut(){this.clipboard.cut(this.selector.range)}paste(t="all",e=(()=>{})){const{clipboard:i,selector:s}=this;return!i.isClear()&&(!!L.call(this,i.range,s.range,e)&&(this.changeData((()=>{i.isCopy()?B.call(this,i.range,s.range,t):i.isCut()&&q.call(this,i.range,s.range)})),!0))}pasteFromText(t){const e=t.split("\r\n").map((t=>t.replace(/"/g,"").split("\t")));e.length>0&&(e.length-=1);const{rows:i,selector:s}=this;this.changeData((()=>{i.paste(e,s.range)}))}autofill(t,e,i=(()=>{})){const s=this.selector.range;return!!L.call(this,s,t,i)&&(this.changeData((()=>{B.call(this,s,t,e,!0)})),!0)}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(t,e){const{selector:i,rows:s,cols:l,merges:r}=this;let{sri:n,sci:o,eri:h,eci:a}=i.range;const c=i.ri,d=i.ci;let[u,f]=[t,e];return t<0&&(u=s.len-1),e<0&&(f=l.len-1),[n,h]=u>c?[c,u]:[u,c],[o,a]=f>d?[d,f]:[f,d],i.range=r.union(new g(n,o,h,a)),i.range=r.union(i.range),i.range}calSelectedRangeByStart(t,e){const{selector:i,rows:s,cols:l,merges:r}=this;let n=r.getFirstIncludes(t,e);return null===n&&(n=new g(t,e,t,e),-1===t&&(n.sri=0,n.eri=s.len-1),-1===e&&(n.sci=0,n.eci=l.len-1)),i.range=n,n}setSelectedCellAttr(t,e){this.changeData((()=>{const{selector:i,styles:s,rows:l}=this;if("merge"===t)e?this.merge():this.unmerge();else if("border"===t)j.call(this,e);else if("formula"===t){const{ri:t,ci:s,range:r}=i;if(i.multiple()){const[s,n]=i.size(),{sri:o,sci:h,eri:a,eci:c}=r;if(s>1)for(let t=h;t<=c;t+=1){l.getCellOrNew(a+1,t).text=`=${e}(${u(t,o)}:${u(t,a)})`}else if(n>1){l.getCellOrNew(t,c+1).text=`=${e}(${u(h,t)}:${u(c,t)})`}}else{l.getCellOrNew(t,s).text=`=${e}()`}}else i.range.each(((i,r)=>{const n=l.getCellOrNew(i,r);let o={};if(void 0!==n.style&&(o=T.cloneDeep(s[n.style])),"format"===t)o.format=e,n.style=this.addStyle(o);else if("font-bold"===t||"font-italic"===t||"font-name"===t||"font-size"===t){const i={};i[t.split("-")[1]]=e,o.font=Object.assign(o.font||{},i),n.style=this.addStyle(o)}else"strike"===t||"textwrap"===t||"underline"===t||"align"===t||"valign"===t||"color"===t||"bgcolor"===t?(o[t]=e,n.style=this.addStyle(o)):n[t]=e}))}))}setSelectedCellText(t,e="input"){const{autoFilter:i,selector:s,rows:l}=this,{ri:r,ci:n}=s;let o=r;this.unsortedRowMap.has(r)&&(o=this.unsortedRowMap.get(r));const h=l.getCell(o,n),a=h?h.text:"";if(this.setCellText(o,n,t,e),i.active()){const e=i.getFilter(n);if(e){const i=e.value.findIndex((t=>t===a));i>=0&&e.value.splice(i,1,t)}}}getSelectedCell(){const{ri:t,ci:e}=this.selector;let i=t;return this.unsortedRowMap.has(t)&&(i=this.unsortedRowMap.get(t)),this.rows.getCell(i,e)}xyInSelectedRect(t,e){const{left:i,top:s,width:l,height:r}=this.getSelectedRect(),n=t-this.cols.indexWidth,o=e-this.rows.height;return n>i&&n<i+l&&o>s&&o<s+r}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:t}=this;return t.isClear()?{left:-100,top:-100}:this.getRect(t.range)}getRect(t){const{scroll:e,rows:i,cols:s,exceptRowSet:l}=this,{sri:r,sci:n,eri:o,eci:h}=t;if(r<0&&n<0)return{left:0,l:0,top:0,t:0,scroll:e};const a=s.sumWidth(0,n),c=i.sumHeight(0,r,l),d=i.sumHeight(r,o+1,l),u=s.sumWidth(n,h+1);let f=a-e.x,g=c-e.y;const p=this.freezeTotalHeight(),m=this.freezeTotalWidth();return m>0&&m>a&&(f=a),p>0&&p>c&&(g=c),{l:a,t:c,left:f,top:g,height:d,width:u,scroll:e}}getCellRectByXY(t,e){const{scroll:i,merges:s,rows:l,cols:r}=this;let{ri:n,top:o,height:h}=Y.call(this,e,i.y),{ci:a,left:c,width:d}=Z.call(this,t,i.x);if(-1===a&&(d=r.totalWidth()),-1===n&&(h=l.totalHeight()),n>=0||a>=0){const t=s.getFirstIncludes(n,a);t&&(n=t.sri,a=t.sci,({left:c,top:o,width:d,height:h}=this.cellRect(n,a)))}return{ri:n,ci:a,left:c,top:o,width:d,height:h}}isSignleSelected(){const{sri:t,sci:e,eri:i,eci:s}=this.selector.range,l=this.getCell(t,e);if(l&&l.merge){const[r,n]=l.merge;if(t+r===i&&e+n===s)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:t,sci:e,eri:i,eci:s}=this.selector.range,l=this.getCell(t,e);if(l&&l.merge){const[r,n]=l.merge;if(t+r===i&&e+n===s)return!0}return!1}merge(){const{selector:t,rows:e}=this;if(this.isSignleSelected())return;const[i,s]=t.size();if(i>1||s>1){const{sri:l,sci:r}=t.range;this.changeData((()=>{const n=e.getCellOrNew(l,r);n.merge=[i-1,s-1],this.merges.add(t.range),this.rows.deleteCells(t.range),this.rows.setCell(l,r,n)}))}}unmerge(){const{selector:t}=this;if(!this.isSignleSelected())return;const{sri:e,sci:i}=t.range;this.changeData((()=>{this.rows.deleteCell(e,i,"merge"),this.merges.deleteWithin(t.range)}))}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:t,selector:e}=this;this.changeData((()=>{t.active()?(t.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):t.ref=e.range.toString()}))}setAutoFilter(t,e,i,s){const{autoFilter:l}=this;l.addFilter(t,i,s),l.setSort(t,e),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:t,rows:e}=this;if(!t.active())return;const{sort:i}=t,{rset:s,fset:l}=t.filteredRows(((t,i)=>e.getCell(t,i))),r=Array.from(l),n=Array.from(l);i&&r.sort(((t,e)=>"asc"===i.order?t-e:"desc"===i.order?e-t:0)),this.exceptRowSet=s,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,r.forEach(((t,e)=>{this.sortedRowMap.set(n[e],t),this.unsortedRowMap.set(t,n[e])}))}deleteCell(t="all"){const{selector:e}=this;this.changeData((()=>{this.rows.deleteCells(e.range,t),"all"!==t&&"format"!==t||this.merges.deleteWithin(e.range)}))}insert(t,e=1){this.changeData((()=>{const{sri:i,sci:s}=this.selector.range,{rows:l,merges:r,cols:n}=this;let o=i;"row"===t?l.insert(i,e):"column"===t&&(l.insertColumn(s,e),o=s,n.len+=1),r.shift(t,o,e,((t,e,i,s)=>{const r=l.getCell(t,e);r.merge[0]+=i,r.merge[1]+=s}))}))}delete(t){this.changeData((()=>{const{rows:e,merges:i,selector:s,cols:l}=this,{range:r}=s,{sri:n,sci:o,eri:h,eci:a}=s.range,[c,d]=s.range.size();let u=n,f=c;"row"===t?e.delete(n,h):"column"===t&&(e.deleteColumn(o,a),u=r.sci,f=d,l.len-=1),i.shift(t,u,-f,((t,i,s,l)=>{const r=e.getCell(t,i);r.merge[0]+=s,r.merge[1]+=l,0===r.merge[0]&&0===r.merge[1]&&delete r.merge}))}))}scrollx(t,e){const{scroll:i,freeze:s,cols:l}=this,[,r]=s,[n,o,h]=T.rangeReduceIf(r,l.len,0,0,t,(t=>l.getWidth(t)));let a=o;t>0&&(a+=h),i.x!==a&&(i.ci=t>0?n:0,i.x=a,e())}scrolly(t,e){const{scroll:i,freeze:s,rows:l}=this,[r]=s,[n,o,h]=T.rangeReduceIf(r,l.len,0,0,t,(t=>l.getHeight(t)));let a=o;t>0&&(a+=h),i.y!==a&&(i.ri=t>0?n:0,i.y=a,e())}cellRect(t,e){const{rows:i,cols:s}=this,l=s.sumWidth(0,e),r=i.sumHeight(0,t),n=i.getCell(t,e);let o=s.getWidth(e),h=i.getHeight(t);if(null!==n&&n.merge){const[l,r]=n.merge;if(l>0)for(let e=1;e<=l;e+=1)h+=i.getHeight(t+e);if(r>0)for(let t=1;t<=r;t+=1)o+=s.getWidth(e+t)}return{left:l,top:r,width:o,height:h,cell:n}}getCell(t,e){return this.rows.getCell(t,e)}getCellTextOrDefault(t,e){const i=this.getCell(t,e);return i&&i.text?i.text:""}getCellStyle(t,e){const i=this.getCell(t,e);return i&&void 0!==i.style?this.styles[i.style]:null}getCellStyleOrDefault(t,e){const{styles:i,rows:s}=this,l=s.getCell(t,e),r=l&&void 0!==l.style?i[l.style]:{};return T.merge(this.defaultStyle(),r)}getSelectedCellStyle(){const{ri:t,ci:e}=this.selector;return this.getCellStyleOrDefault(t,e)}setCellText(t,e,i,s){const{rows:l,history:r,validations:n}=this;"finished"===s?(l.setCellText(t,e,""),r.add(this.getData()),l.setCellText(t,e,i)):(l.setCellText(t,e,i),this.change(this.getData())),n.validate(t,e,i)}freezeIsActive(){const[t,e]=this.freeze;return t>0||e>0}setFreeze(t,e){this.changeData((()=>{this.freeze=[t,e]}))}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(t,e){this.changeData((()=>{this.rows.setHeight(t,e)}))}setColWidth(t,e){this.changeData((()=>{this.cols.setWidth(t,e)}))}viewHeight(){const{view:t,showToolbar:e,showBottomBar:i}=this.settings;let s=t.height();return i&&(s-=41),e&&(s-=41),s}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[t,e]=this.freeze;return new g(0,0,t-1,e-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:t,cols:e}=this,[i,s]=t.maxCell(),l=t.sumHeight(0,i+1),r=e.sumWidth(0,s+1);return new g(0,0,i,s,r,l)}exceptRowTotalHeight(t,e){const{exceptRowSet:i,rows:s}=this,l=Array.from(i);let r=0;return l.forEach((i=>{if(i<t||i>e){const t=s.getHeight(i);r+=t}})),r}viewRange(){const{scroll:t,rows:e,cols:i,freeze:s,exceptRowSet:l}=this;let{ri:r,ci:n}=t;r<=0&&([r]=s),n<=0&&([,n]=s);let[o,h]=[0,0],[a,c]=[e.len,i.len];for(let t=r;t<e.len&&(l.has(t)||(h+=e.getHeight(t),a=t),!(h>this.viewHeight()));t+=1);for(let t=n;t<i.len&&(o+=i.getWidth(t),c=t,!(o>this.viewWidth()));t+=1);return new g(r,n,a,c,o,h)}eachMergesInView(t,e){this.merges.filterIntersects(t).forEach((t=>e(t)))}hideRowsOrCols(){const{rows:t,cols:e,selector:i}=this,[s,l]=i.size(),{sri:r,sci:n,eri:o,eci:h}=i.range;if(s===t.len)for(let t=n;t<=h;t+=1)e.setHide(t,!0);else if(l===e.len)for(let e=r;e<=o;e+=1)t.setHide(e,!0)}unhideRowsOrCols(t,e){this[`${t}s`].unhide(e)}rowEach(t,e,i){let s=0;const{rows:l}=this,r=this.exceptRowSet,n=[...r];let o=0;for(let e=0;e<n.length;e+=1)n[e]<t&&(o+=1);for(let n=t+o;n<=e+o;n+=1)if(r.has(n))o+=1;else{const t=l.getHeight(n);if(t>0&&(i(n,s,t),s+=t,s>this.viewHeight()))break}}colEach(t,e,i){let s=0;const{cols:l}=this;for(let r=t;r<=e;r+=1){const t=l.getWidth(r);if(t>0&&(i(r,s,t),s+=t,s>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(t){const{styles:e}=this;for(let i=0;i<e.length;i+=1){const s=e[i];if(T.equals(s,t))return i}return e.push(t),e.length-1}changeData(t){this.history.add(this.getData()),t(),this.change(this.getData())}setData(t){return Object.keys(t).forEach((e=>{if("merges"===e||"rows"===e||"cols"===e||"validations"===e)this[e].setData(t[e]);else if("freeze"===e){const[i,s]=d(t[e]);this.freeze=[s,i]}else"autofilter"===e?this.autoFilter.setData(t[e]):void 0!==t[e]&&(this[e]=t[e])})),this}getData(){const{name:t,freeze:e,styles:i,merges:s,rows:l,cols:r,validations:n,autoFilter:o}=this;return{name:t,freeze:u(e[1],e[0]),styles:i,merges:s.getData(),rows:l.getData(),cols:r.getData(),validations:n.getData(),autofilter:o.getData()}}}function K(t,e,i){t.addEventListener(e,i)}function J(t,e,i){t.removeEventListener(e,i)}function G(t){t.xclickoutside&&(J(window.document.body,"click",t.xclickoutside),delete t.xclickoutside)}function Q(t,e){t.xclickoutside=i=>{2===i.detail||t.contains(i.target)||(e?e(t):(t.hide(),G(t)))},K(window.document.body,"click",t.xclickoutside)}function tt(t,e,i){K(t,"mousemove",e);t.xEvtUp=s=>{J(t,"mousemove",e),J(t,"mouseup",t.xEvtUp),i(s)},K(t,"mouseup",t.xEvtUp)}function et(t,e,i,s){let l="";Math.abs(t)>Math.abs(e)?(l=t>0?"right":"left",s(l,t,i)):(l=e>0?"down":"up",s(l,e,i))}const it="x-spreadsheet";window.devicePixelRatio;class st{constructor(t=!1,e){this.moving=!1,this.vertical=t,this.el=o("div",`${it}-resizer ${t?"vertical":"horizontal"}`).children(this.unhideHoverEl=o("div",`${it}-resizer-hover`).on("dblclick.stop",(t=>this.mousedblclickHandler(t))).css("position","absolute").hide(),this.hoverEl=o("div",`${it}-resizer-hover`).on("mousedown.stop",(t=>this.mousedownHandler(t))),this.lineEl=o("div",`${it}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=e,this.unhideFn=()=>{}}showUnhide(t){this.unhideIndex=t,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(t,e){const{moving:i,vertical:s,hoverEl:l,lineEl:r,el:n,unhideHoverEl:o}=this;if(i)return;this.cRect=t;const{left:h,top:a,width:c,height:d}=t;n.offset({left:s?h+c-5:h,top:s?a:a+d-5}).show(),l.offset({width:s?5:c,height:s?d:5}),r.offset({width:s?0:e.width,height:s?e.height:0}),o.offset({left:s?5-c:h,top:s?a:5-d,width:s?5:c,height:s?d:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(t){let e=t;const{el:i,lineEl:s,cRect:l,vertical:r,minDistance:n}=this;let o=r?l.width:l.height;s.show(),tt(window,(t=>{this.moving=!0,null!==e&&1===t.buttons&&(r?(o+=t.movementX,o>n&&i.css("left",`${l.left+o}px`)):(o+=t.movementY,o>n&&i.css("top",`${l.top+o}px`)),e=t)}),(()=>{e=null,s.hide(),this.moving=!1,this.hide(),this.finishedFn&&(o<n&&(o=n),this.finishedFn(l,o))}))}}class lt{constructor(t){this.vertical=t,this.moveFn=null,this.el=o("div",`${it}-scrollbar ${t?"vertical":"horizontal"}`).child(this.contentEl=o("div","")).on("mousemove.stop",(()=>{})).on("scroll.stop",(t=>{const{scrollTop:e,scrollLeft:i}=t.target;this.moveFn&&this.moveFn(this.vertical?e:i,t)}))}move(t){return this.el.scroll(t),this}scroll(){return this.el.scroll()}set(t,e){const i=t-1;if(e>i){const t=this.vertical?"height":"width";this.el.css(t,i-15+"px").show(),this.contentEl.css(this.vertical?"width":"height","1px").css(t,`${e}px`)}else this.el.hide();return this}}let rt=10;class nt{constructor(t=!1){this.useHideInput=t,this.inputChange=()=>{},this.cornerEl=o("div",`${it}-selector-corner`),this.areaEl=o("div",`${it}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=o("div",`${it}-selector-clipboard`).hide(),this.autofillEl=o("div",`${it}-selector-autofill`).hide(),this.el=o("div",`${it}-selector`).css("z-index",`${rt}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),t&&(this.hideInput=o("input","").on("compositionend",(t=>{this.inputChange(t.target.value)})),this.el.child(this.hideInputDiv=o("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=o("div","hide-input").child(this.hideInput))),rt+=1}setOffset(t){return this.el.offset(t).show(),this}hide(){return this.el.hide(),this}setAreaOffset(t){const{left:e,top:i,width:s,height:l}=t,r={width:s-3+.8,height:l-3+.8,left:e-.8,top:i-.8};this.areaEl.offset(r).show(),this.useHideInput&&(this.hideInputDiv.offset(r),this.hideInput.val("").focus())}setClipboardOffset(t){const{left:e,top:i,width:s,height:l}=t;this.clipboardEl.offset({left:e,top:i,width:s-5,height:l-5})}showAutofill(t){const{left:e,top:i,width:s,height:l}=t;this.autofillEl.offset({width:s-3,height:l-3,left:e,top:i}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function ot(t){const{data:e}=this,{left:i,top:s,width:l,height:r,scroll:n,l:o,t:h}=t,a=e.freezeTotalWidth(),c=e.freezeTotalHeight();let d=i-a;a>o&&(d-=n.x);let u=s-c;return c>h&&(u-=n.y),{left:d,top:u,width:l,height:r}}function ht(t){const{data:e}=this,{left:i,width:s,height:l,l:r,t:n,scroll:o}=t,h=e.freezeTotalWidth();let a=i-h;return h>r&&(a-=o.x),{left:a,top:n,width:s,height:l}}function at(t){const{data:e}=this,{top:i,width:s,height:l,l:r,t:n,scroll:o}=t,h=e.freezeTotalHeight();let a=i-h;return h>n&&(a-=o.y),{left:r,top:a,width:s,height:l}}function ct(t){const{br:e}=this;e.setAreaOffset(ot.call(this,t))}function dt(t){const{tl:e}=this;e.setAreaOffset(t)}function ut(t){const{t:e}=this;e.setAreaOffset(ht.call(this,t))}function ft(t){const{l:e}=this;e.setAreaOffset(at.call(this,t))}function gt(t){const{l:e}=this;e.setClipboardOffset(at.call(this,t))}function pt(t){const{br:e}=this;e.setClipboardOffset(ot.call(this,t))}function mt(t){const{tl:e}=this;e.setClipboardOffset(t)}function wt(t){const{t:e}=this;e.setClipboardOffset(ht.call(this,t))}function vt(t){ct.call(this,t),dt.call(this,t),ut.call(this,t),ft.call(this,t)}function bt(t){pt.call(this,t),mt.call(this,t),wt.call(this,t),gt.call(this,t)}class yt{constructor(t){this.inputChange=()=>{},this.data=t,this.br=new nt(!0),this.t=new nt,this.l=new nt,this.tl=new nt,this.br.inputChange=t=>{this.inputChange(t)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=o("div",`${it}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,rt+=1}resetData(t){this.data=t,this.range=t.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:t,tl:e,t:i,l:s,br:l}=this,r=t.freezeTotalHeight(),n=t.freezeTotalWidth();r>0||n>0?(e.setOffset({width:n,height:r}),i.setOffset({left:n,height:r}),s.setOffset({top:r,width:n}),l.setOffset({left:n,top:r})):(e.hide(),i.hide(),s.hide(),l.setOffset({left:0,top:0}))}resetAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();vt.call(this,t),bt.call(this,e),this.resetOffset()}resetBRTAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();ct.call(this,t),ut.call(this,t),pt.call(this,e),wt.call(this,e),this.resetOffset()}resetBRLAreaOffset(){const t=this.data.getSelectedRect(),e=this.data.getClipboardRect();ct.call(this,t),ft.call(this,t),pt.call(this,e),gt.call(this,e),this.resetOffset()}set(t,e,i=!0){const{data:s}=this,l=s.calSelectedRangeByStart(t,e),{sri:r,sci:n}=l;if(i){let[i,l]=[t,e];t<0&&(i=0),e<0&&(l=0),s.selector.setIndexes(i,l),this.indexes=[i,l]}this.moveIndexes=[r,n],this.range=l,this.resetAreaOffset(),this.el.show()}setEnd(t,e,i=!0){const{data:s,lastri:l,lastci:r}=this;if(i){if(t===l&&e===r)return;this.lastri=t,this.lastci=e}this.range=s.calSelectedRangeByEnd(t,e),vt.call(this,this.data.getSelectedRect())}reset(){const{eri:t,eci:e}=this.data.selector.range;this.setEnd(t,e)}showAutofill(t,e){if(-1===t&&-1===e)return;const{sri:i,sci:s,eri:l,eci:r}=this.range,[n,o]=[t,e],h=i-t,a=l-t,c=r-e;if(s-e>0)this.arange=new g(i,o,l,s-1);else if(h>0)this.arange=new g(n,s,i-1,r);else if(c<0)this.arange=new g(i,r+1,l,o);else{if(!(a<0))return void(this.arange=null);this.arange=new g(l+1,s,n,r)}if(null!==this.arange){const t=this.data.getRect(this.arange);t.width+=2,t.height+=2;const{br:e,l:i,t:s,tl:l}=this;e.showAutofill(ot.call(this,t)),i.showAutofill(at.call(this,t)),s.showAutofill(ht.call(this,t)),l.showAutofill(t)}}hideAutofill(){["br","l","t","tl"].forEach((t=>{this[t].hideAutofill()}))}showClipboard(){const t=this.data.getClipboardRect();bt.call(this,t),["br","l","t","tl"].forEach((t=>{this[t].showClipboard()}))}hideClipboard(){["br","l","t","tl"].forEach((t=>{this[t].hideClipboard()}))}}function xt(t){t.preventDefault(),t.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1),e[this.itemIndex].toggle())}function Et(t){t.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0),e[this.itemIndex].toggle())}function Ct(t){t.preventDefault();const{filterItems:e}=this;e.length<=0||(t.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),e[this.itemIndex].el.click(),this.hide())}function kt(t){const{keyCode:e}=t;switch(t.ctrlKey&&t.stopPropagation(),e){case 37:case 39:default:t.stopPropagation();break;case 38:xt.call(this,t);break;case 40:Et.call(this,t);break;case 13:case 9:Ct.call(this,t)}}class St{constructor(t,e,i="200px"){this.filterItems=[],this.items=t,this.el=o("div",`${it}-suggest`).css("width",i).hide(),this.itemClick=e,this.itemIndex=-1}setOffset(t){this.el.cssRemoveKeys("top","bottom").offset(t)}hide(){const{el:t}=this;this.filterItems=[],this.itemIndex=-1,t.hide(),G(this.el.parent())}setItems(t){this.items=t}search(t){let{items:e}=this;if(/^\s*$/.test(t)||(e=e.filter((e=>(e.key||e).startsWith(t.toUpperCase())))),e=e.map((t=>{let{title:e}=t;e?"function"===typeof e&&(e=e()):e=t;const i=o("div",`${it}-item`).child(e).on("click.stop",(()=>{this.itemClick(t),this.hide()}));return t.label&&i.child(o("div","label").html(t.label)),i})),this.filterItems=e,e.length<=0)return;const{el:i}=this;i.html("").children(...e).show(),Q(i.parent(),(()=>{this.hide()}))}bindInputEvents(t){t.on("keydown",(t=>kt.call(this,t)))}}class Tt extends n{constructor(t){super("div",`${it}-icon`),this.iconNameEl=o("div",`${it}-icon-img ${t}`),this.child(this.iconNameEl)}setName(t){this.iconNameEl.className(`${it}-icon-img ${t}`)}}function $t(t,e){t.setMonth(t.getMonth()+e)}function Dt(t,e){const i=new Date(t);return i.setDate(e-t.getDay()+1),i}class At{constructor(t){this.value=t,this.cvalue=new Date(t),this.headerLeftEl=o("div","calendar-header-left"),this.bodyEl=o("tbody",""),this.buildAll(),this.el=o("div","x-spreadsheet-calendar").children(o("div","calendar-header").children(this.headerLeftEl,o("div","calendar-header-right").children(o("a","calendar-prev").on("click.stop",(()=>this.prev())).child(new Tt("chevron-left")),o("a","calendar-next").on("click.stop",(()=>this.next())).child(new Tt("chevron-right")))),o("table","calendar-body").children(o("thead","").child(o("tr","").children(..._("calendar.weeks").map((t=>o("th","cell").child(t))))),this.bodyEl)),this.selectChange=()=>{}}setValue(t){this.value=t,this.cvalue=new Date(t),this.buildAll()}prev(){const{value:t}=this;$t(t,-1),this.buildAll()}next(){const{value:t}=this;$t(t,1),this.buildAll()}buildAll(){this.buildHeaderLeft(),this.buildBody()}buildHeaderLeft(){const{value:t}=this;this.headerLeftEl.html(`${_("calendar.months")[t.getMonth()]} ${t.getFullYear()}`)}buildBody(){const{value:t,cvalue:e,bodyEl:i}=this,s=function(t,e,i){const s=new Date(t,e,1,23,59,59),l=[[],[],[],[],[],[]];for(let t=0;t<6;t+=1)for(let r=0;r<7;r+=1){const n=Dt(s,7*t+r),o=n.getMonth()!==e,h=n.getMonth()===i.getMonth()&&n.getDate()===i.getDate();l[t][r]={d:n,disabled:o,active:h}}return l}(t.getFullYear(),t.getMonth(),e).map((t=>{const e=t.map((t=>{let e="cell";return t.disabled&&(e+=" disabled"),t.active&&(e+=" active"),o("td","").child(o("div",e).on("click.stop",(()=>{this.selectChange(t.d)})).child(t.d.getDate().toString()))}));return o("tr","").children(...e)}));i.html("").children(...s)}}class Ot{constructor(){this.calendar=new At(new Date),this.el=o("div",`${it}-datepicker`).child(this.calendar.el).hide()}setValue(t){const{calendar:e}=this;return"string"===typeof t?/^\d{4}-\d{1,2}-\d{1,2}$/.test(t)&&e.setValue(new Date(t.replace(new RegExp("-","g"),"/"))):t instanceof Date&&e.setValue(t),this}change(t){this.calendar.selectChange=e=>{t(e),this.hide()}}show(){this.el.show()}hide(){this.el.hide()}}function Rt(){const{inputText:t}=this;if(!/^\s*$/.test(t)){const{textlineEl:e,textEl:i,areaOffset:s}=this,l=t.split("\n"),r=Math.max(...l.map((t=>t.length))),n=e.offset().width/t.length,o=(r+1)*n+5,h=this.viewFn().width-s.left-n;let a=l.length;if(o>s.width){let t=o;o>h&&(t=h,a+=parseInt(o/h,10),a+=o%h>0?1:0),i.css("width",`${t}px`)}a*=this.rowHeight,a>s.height&&i.css("height",`${a}px`)}}function _t({target:t},e){const{value:i,selectionEnd:s}=t,l=`${i.slice(0,s)}${e}${i.slice(s)}`;t.value=l,t.setSelectionRange(s+1,s+1),this.inputText=l,this.textlineEl.html(l),Rt.call(this)}function It(t){const{keyCode:e,altKey:i}=t;13!==e&&9!==e&&t.stopPropagation(),13===e&&i&&(_t.call(this,t,"\n"),t.stopPropagation()),13!==e||i||t.preventDefault()}function zt(t){const e=t.target.value,{suggest:i,textlineEl:s,validator:l}=this,{cell:r}=this;if(null!==r)if("editable"in r&&!0===r.editable||void 0===r.editable){if(this.inputText=e,l)"list"===l.type?i.search(e):i.hide();else{const t=e.lastIndexOf("=");-1!==t?i.search(e.substring(t+1)):i.hide()}s.html(e),Rt.call(this),this.change("input",e)}else t.target.value=r.text;else{if(this.inputText=e,l)"list"===l.type?i.search(e):i.hide();else{const t=e.lastIndexOf("=");-1!==t?i.search(e.substring(t+1)):i.hide()}s.html(e),Rt.call(this),this.change("input",e)}}function Ft(t){const{el:e}=this.textEl;setTimeout((()=>{e.focus(),e.setSelectionRange(t,t)}),0)}function Nt(t,e){const{textEl:i,textlineEl:s}=this;i.el.blur(),i.val(t),s.html(t),Ft.call(this,e)}function Mt(t){const{inputText:e,validator:i}=this;let s=0;if(i&&"list"===i.type)this.inputText=t,s=this.inputText.length;else{const i=e.lastIndexOf("="),l=e.substring(0,i+1);let r=e.substring(i+1);r=-1!==r.indexOf(")")?r.substring(r.indexOf(")")):"",this.inputText=`${l+t.key}(`,s=this.inputText.length,this.inputText+=`)${r}`}Nt.call(this,this.inputText,s)}function Ht(){this.suggest.setItems(this.formulas)}class Vt{constructor(t,e,i){this.viewFn=e,this.rowHeight=i,this.formulas=t,this.suggest=new St(t,(t=>{Mt.call(this,t)})),this.datepicker=new Ot,this.datepicker.change((t=>{this.setText(function(t){let e=t.getMonth()+1,i=t.getDate();return e<10&&(e=`0${e}`),i<10&&(i=`0${i}`),`${t.getFullYear()}-${e}-${i}`}(t)),this.clear()})),this.areaEl=o("div",`${it}-editor-area`).children(this.textEl=o("textarea","").on("input",(t=>zt.call(this,t))).on("paste.stop",(()=>{})).on("keydown",(t=>It.call(this,t))),this.textlineEl=o("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",(()=>{})).on("mousedown.stop",(()=>{})),this.el=o("div",`${it}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=()=>{}}setFreezeLengths(t,e){this.freeze.w=t,this.freeze.h=e}clear(){""!==this.inputText&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),Ht.call(this),this.datepicker.hide()}setOffset(t,e="top"){const{textEl:i,areaEl:s,suggest:l,freeze:r,el:n}=this;if(t){this.areaOffset=t;const{left:o,top:h,width:a,height:c,l:d,t:u}=t,f={left:0,top:0};r.w>d&&r.h>u||(r.w<d&&r.h<u?(f.left=r.w,f.top=r.h):r.w>d?f.top=r.h:r.h>u&&(f.left=r.w)),n.offset(f),s.offset({left:o-f.left-.8,top:h-f.top-.8}),i.offset({width:a-9+.8,height:c-3+.8});const g={left:0};g[e]=c,l.setOffset(g),l.hide()}}setCell(t,e){const{el:i,datepicker:s,suggest:l}=this;i.show(),this.cell=t;const r=t&&t.text||"";if(this.setText(r),this.validator=e,e){const{type:t}=e;"date"===t&&(s.show(),/^\s*$/.test(r)||s.setValue(r)),"list"===t&&(l.setItems(e.values()),l.search(""))}}setText(t){this.inputText=t,Nt.call(this,t,t.length),Rt.call(this)}}class Wt extends n{constructor(t,e=""){super("div",`${it}-button ${e}`),this.child(_(`button.${t}`))}}function Pt(){return window.devicePixelRatio||1}function Lt(){return Pt()-.5}function Bt(t){return parseInt(t*Pt(),10)}function qt(t){const e=Bt(t);return e>0?e-.5:.5}class Ut{constructor(t,e,i,s,l=0){this.x=t,this.y=e,this.width=i,this.height=s,this.padding=l,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:t,bottom:e,left:i,right:s}){t&&(this.borderTop=t),s&&(this.borderRight=s),e&&(this.borderBottom=e),i&&(this.borderLeft=i)}innerWidth(){return this.width-2*this.padding-2}innerHeight(){return this.height-2*this.padding-2}textx(t){const{width:e,padding:i}=this;let{x:s}=this;return"left"===t?s+=i:"center"===t?s+=e/2:"right"===t&&(s+=e-i),s}texty(t,e){const{height:i,padding:s}=this;let{y:l}=this;return"top"===t?l+=s:"middle"===t?l+=i/2-e/2:"bottom"===t&&(l+=i-s-e),l}topxys(){const{x:t,y:e,width:i}=this;return[[t,e],[t+i,e]]}rightxys(){const{x:t,y:e,width:i,height:s}=this;return[[t+i,e],[t+i,e+s]]}bottomxys(){const{x:t,y:e,width:i,height:s}=this;return[[t,e+s],[t+i,e+s]]}leftxys(){const{x:t,y:e,height:i}=this;return[[t,e],[t,e+i]]}}function jt(t,e,i,s,l,r,n){const o={x:0,y:0};"underline"===t?o.y="bottom"===l?0:"top"===l?-(r+2):-r/2:"strike"===t&&("bottom"===l?o.y=r/2:"top"===l&&(o.y=-(r/2+2))),"center"===s?o.x=n/2:"right"===s&&(o.x=n),this.line([e-o.x,i-o.y],[e-o.x+n,i-o.y])}class Yt{constructor(t,e,i){this.el=t,this.ctx=t.getContext("2d"),this.resize(e,i),this.ctx.scale(Pt(),Pt())}resize(t,e){this.el.style.width=`${t}px`,this.el.style.height=`${e}px`,this.el.width=Bt(t),this.el.height=Bt(e)}clear(){const{width:t,height:e}=this.el;return this.ctx.clearRect(0,0,t,e),this}attr(t){return Object.assign(this.ctx,t),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(t,e){return this.ctx.translate(Bt(t),Bt(e)),this}scale(t,e){return this.ctx.scale(t,e),this}clearRect(t,e,i,s){return this.ctx.clearRect(t,e,i,s),this}fillRect(t,e,i,s){return this.ctx.fillRect(Bt(t)-.5,Bt(e)-.5,Bt(i),Bt(s)),this}fillText(t,e,i){return this.ctx.fillText(t,Bt(e),Bt(i)),this}text(t,e,i={},s=!0){const{ctx:l}=this,{align:r,valign:n,font:o,color:h,strike:a,underline:c}=i,d=e.textx(r);l.save(),l.beginPath(),this.attr({textAlign:r,textBaseline:n,font:`${o.italic?"italic":""} ${o.bold?"bold":""} ${Bt(o.size)}px ${o.name}`,fillStyle:h,strokeStyle:h});const u=`${t}`.split("\n"),f=e.innerWidth(),g=[];u.forEach((t=>{const e=l.measureText(t).width;if(s&&e>Bt(f)){let e={w:0,len:0,start:0};for(let i=0;i<t.length;i+=1)e.w>=Bt(f)&&(g.push(t.substr(e.start,e.len)),e={w:0,len:0,start:i}),e.len+=1,e.w+=l.measureText(t[i]).width+1;e.len>0&&g.push(t.substr(e.start,e.len))}else g.push(t)}));const p=(g.length-1)*(o.size+2);let m=e.texty(n,p);return g.forEach((t=>{const e=l.measureText(t).width;this.fillText(t,d,m),a&&jt.call(this,"strike",d,m,r,n,o.size,e),c&&jt.call(this,"underline",d,m,r,n,o.size,e),m+=o.size+2})),l.restore(),this}border(t,e){const{ctx:i}=this;return i.lineWidth=Lt,i.strokeStyle=e,"medium"===t?i.lineWidth=Bt(2)-.5:"thick"===t?i.lineWidth=Bt(3):"dashed"===t?i.setLineDash([Bt(3),Bt(2)]):"dotted"===t?i.setLineDash([Bt(1),Bt(1)]):"double"===t&&i.setLineDash([Bt(2),0]),this}line(...t){const{ctx:e}=this;if(t.length>1){e.beginPath();const[i,s]=t[0];e.moveTo(qt(i),qt(s));for(let i=1;i<t.length;i+=1){const[s,l]=t[i];e.lineTo(qt(s),qt(l))}e.stroke()}return this}strokeBorders(t){const{ctx:e}=this;e.save();const{borderTop:i,borderRight:s,borderBottom:l,borderLeft:r}=t;i&&(this.border(...i),this.line(...t.topxys())),s&&(this.border(...s),this.line(...t.rightxys())),l&&(this.border(...l),this.line(...t.bottomxys())),r&&(this.border(...r),this.line(...t.leftxys())),e.restore()}dropdown(t){const{ctx:e}=this,{x:i,y:s,width:l,height:r}=t,n=i+l-15,o=s+r-15;e.save(),e.beginPath(),e.moveTo(Bt(n),Bt(o)),e.lineTo(Bt(n+8),Bt(o)),e.lineTo(Bt(n+4),Bt(o+6)),e.closePath(),e.fillStyle="rgba(0, 0, 0, .45)",e.fill(),e.restore()}error(t){const{ctx:e}=this,{x:i,y:s,width:l}=t,r=i+l-1;e.save(),e.beginPath(),e.moveTo(Bt(r-8),Bt(s-1)),e.lineTo(Bt(r),Bt(s-1)),e.lineTo(Bt(r),Bt(s+8)),e.closePath(),e.fillStyle="rgba(255, 0, 0, .65)",e.fill(),e.restore()}frozen(t){const{ctx:e}=this,{x:i,y:s,width:l}=t,r=i+l-1;e.save(),e.beginPath(),e.moveTo(Bt(r-8),Bt(s-1)),e.lineTo(Bt(r),Bt(s-1)),e.lineTo(Bt(r),Bt(s+8)),e.closePath(),e.fillStyle="rgba(0, 255, 0, .85)",e.fill(),e.restore()}rect(t,e){const{ctx:i}=this,{x:s,y:l,width:r,height:n,bgcolor:o}=t;i.save(),i.beginPath(),i.fillStyle=o||"#fff",i.rect(qt(s+1),qt(l+1),Bt(r-2),Bt(n-2)),i.clip(),i.fill(),e(),i.restore()}}const Zt=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],Xt=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];const Kt=(t,e)=>{const[i]=t;let s=t;if('"'===i)return t.substring(1);let l=1;if("-"===i&&(s=t.substring(1),l=-1),s[0]>="0"&&s[0]<="9")return l*Number(s);const[r,n]=d(s);return l*e(r,n)},Jt=(t,e,i,s=[])=>{if("="===t[0]){const l=(t=>{const e=[],i=[];let s=[],l=0,r="",n=1,o="";for(let h=0;h<t.length;h+=1){const a=t.charAt(h);if(" "!==a){if(a>="a"&&a<="z")s.push(a.toUpperCase());else if(a>="0"&&a<="9"||a>="A"&&a<="Z"||"."===a)s.push(a);else if('"'===a){for(h+=1;'"'!==t.charAt(h);)s.push(t.charAt(h)),h+=1;i.push(`"${s.join("")}`),s=[]}else if("-"===a&&/[+\-*/,(]/.test(o))s.push(a);else{if("("!==a&&s.length>0&&i.push(s.join("")),")"===a){let t=e.pop();if(2===l)try{const[e,s]=d(i.pop()),[l,r]=d(i.pop());let n=0;for(let t=l;t<=e;t+=1)for(let e=r;e<=s;e+=1)i.push(u(t,e)),n+=1;i.push([t,n])}catch(t){}else if(1===l||3===l)3===l&&i.push(r),i.push([t,n]),n=1;else for(;"("!==t&&(i.push(t),!(e.length<=0));)t=e.pop();l=0}else if("="===a||">"===a||"<"===a){const e=t.charAt(h+1);r=a,"="!==e&&"-"!==e||(r+=e,h+=1),l=3}else if(":"===a)l=2;else if(","===a)3===l&&i.push(r),l=1,n+=1;else if("("===a&&s.length>0)e.push(s.join(""));else{if(e.length>0&&("+"===a||"-"===a)){let t=e[e.length-1];if("("!==t&&i.push(e.pop()),"*"===t||"/"===t)for(;e.length>0&&(t=e[e.length-1],"("!==t);)i.push(e.pop())}else if(e.length>0){const t=e[e.length-1];"*"!==t&&"/"!==t||i.push(e.pop())}e.push(a)}s=[]}o=a}}for(s.length>0&&i.push(s.join(""));e.length>0;)i.push(e.pop());return i})(t.substring(1));return l.length<=0?t:((t,e,i,s)=>{const l=[];for(let r=0;r<t.length;r+=1){const n=t[r],o=n[0];if("+"===n){const t=l.pop();l.push(S("+",l.pop(),t))}else if("-"===n)if(1===l.length){const t=l.pop();l.push(S("*",t,-1))}else{const t=l.pop();l.push(S("-",l.pop(),t))}else if("*"===n)l.push(S("*",l.pop(),l.pop()));else if("/"===n){const t=l.pop();l.push(S("/",l.pop(),t))}else if("="===o||">"===o||"<"===o){let t=l.pop();Number.isNaN(t)||(t=Number(t));let e=l.pop();Number.isNaN(e)||(e=Number(e));let i=!1;"="===o?i=e===t:">"===n?i=e>t:">="===n?i=e>=t:"<"===n?i=e<t:"<="===n&&(i=e<=t),l.push(i)}else if(Array.isArray(n)){const[t,i]=n,s=[];for(let t=0;t<i;t+=1)s.push(l.pop());l.push(e[t].render(s.reverse()))}else{if(s.includes(n))return 0;(o>="a"&&o<="z"||o>="A"&&o<="Z")&&s.push(n),l.push(Kt(n,i)),s.pop()}}return l[0]})(l,e,((t,l)=>Jt(i(t,l),e,i,s)),s)}return t},Gt={render:Jt},Qt=[{key:"SUM",title:I("formula.sum"),render:t=>t.reduce(((t,e)=>S("+",t,e)),0)},{key:"AVERAGE",title:I("formula.average"),render:t=>t.reduce(((t,e)=>Number(t)+Number(e)),0)/t.length},{key:"MAX",title:I("formula.max"),render:t=>Math.max(...t.map((t=>Number(t))))},{key:"MIN",title:I("formula.min"),render:t=>Math.min(...t.map((t=>Number(t))))},{key:"IF",title:I("formula._if"),render:([t,e,i])=>t?e:i},{key:"AND",title:I("formula.and"),render:t=>t.every((t=>t))},{key:"OR",title:I("formula.or"),render:t=>t.some((t=>t))},{key:"CONCAT",title:I("formula.concat"),render:t=>t.join("")}],te=Qt,ee={};Qt.forEach((t=>{ee[t.key]=t}));const ie=t=>t,se=t=>{if(/^(-?\d*.?\d*)$/.test(t)){const e=Number(t).toFixed(2).toString(),[i,...s]=e.split("\\.");return[i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...s]}return t},le=[{key:"normal",title:I("format.normal"),type:"string",render:ie},{key:"text",title:I("format.text"),type:"string",render:ie},{key:"number",title:I("format.number"),type:"number",label:"1,000.12",render:se},{key:"percent",title:I("format.percent"),type:"number",label:"10.12%",render:t=>`${t}%`},{key:"rmb",title:I("format.rmb"),type:"number",label:"\uffe510.00",render:t=>`\uffe5${se(t)}`},{key:"usd",title:I("format.usd"),type:"number",label:"$10.00",render:t=>`$${se(t)}`},{key:"eur",title:I("format.eur"),type:"number",label:"\u20ac10.00",render:t=>`\u20ac${se(t)}`},{key:"date",title:I("format.date"),type:"date",label:"26/09/2008",render:ie},{key:"time",title:I("format.time"),type:"date",label:"15:59:00",render:ie},{key:"datetime",title:I("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:ie},{key:"duration",title:I("format.duration"),type:"date",label:"24:01:00",render:ie}],re={};le.forEach((t=>{re[t.key]=t}));const ne=5,oe={fillStyle:"#f4f5f8"},he={fillStyle:"#fff",lineWidth:Lt,strokeStyle:"#e6e6e6"};function ae(t,e,i,s=0){const{left:l,top:r,width:n,height:o}=t.cellRect(e,i);return new Ut(l,r+s,n,o,ne)}function ce(t,e,i,s,l=0){const{sortedRowMap:r,rows:n,cols:o}=e;if(n.isHide(i)||o.isHide(s))return;let h=i;r.has(i)&&(h=r.get(i));const a=e.getCell(h,s);if(null===a)return;let c=!1;"editable"in a&&!1===a.editable&&(c=!0);const d=e.getCellStyleOrDefault(h,s),u=ae(e,i,s,l);u.bgcolor=d.bgcolor,void 0!==d.border&&(u.setBorders(d.border),t.strokeBorders(u)),t.rect(u,(()=>{let l="";l=e.settings.evalPaused?a.text||"":Gt.render(a.text||"",ee,((t,i)=>e.getCellTextOrDefault(i,t))),d.format&&(l=re[d.format].render(l));const r=Object.assign({},d.font);r.size=function(t){for(let e=0;e<Xt.length;e+=1){const i=Xt[e];if(i.pt===t)return i.px}return t}(r.size),t.text(l,u,{align:d.align,valign:d.valign,font:r,color:d.color,strike:d.strike,underline:d.underline},d.textwrap);e.validations.getError(i,s)&&t.error(u),c&&t.frozen(u)}))}function de(t){const{data:e,draw:i}=this;if(t){const{autoFilter:s}=e;if(!s.active())return;const l=s.hrange();t.intersects(l)&&l.each(((t,s)=>{const l=ae(e,t,s);i.dropdown(l)}))}}function ue(t,e,i,s,l){const{draw:r,data:n}=this;r.save(),r.translate(e,i).translate(s,l);const{exceptRowSet:o}=n,h=n.exceptRowTotalHeight(t.sri,t.eri);r.save(),r.translate(0,-h),t.each(((t,e)=>{ce(r,n,t,e)}),(t=>(t=>{const e=o.has(t);if(e){const e=n.rows.getHeight(t);r.translate(0,-e)}return!e})(t))),r.restore();const a=new Set;r.save(),r.translate(0,-h),n.eachMergesInView(t,(({sri:t,sci:e,eri:i})=>{if(o.has(t)){if(!a.has(t)){a.add(t);const e=n.rows.sumHeight(t,i+1);r.translate(0,-e)}}else ce(r,n,t,e)})),r.restore(),de.call(this,t),r.restore()}function fe(t,e,i,s){const{draw:l}=this;l.save(),l.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(t,e,i,s),l.restore()}function ge(t,e,i,s,l,r){const{draw:n,data:o}=this,h=e.h,c=e.w,d=r+s,u=l+i;n.save(),n.attr(oe),"all"!==t&&"left"!==t||n.fillRect(0,d,i,h),"all"!==t&&"top"!==t||n.fillRect(u,0,c,s);const{sri:f,sci:g,eri:p,eci:m}=o.selector.range;n.attr({textAlign:"center",textBaseline:"middle",font:`500 ${Bt(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:Lt(),strokeStyle:"#e6e6e6"}),"all"!==t&&"left"!==t||(o.rowEach(e.sri,e.eri,((t,e,s)=>{const l=d+e,r=t;n.line([0,l],[i,l]),f<=r&&r<p+1&&fe.call(this,0,l,i,s),n.fillText(r+1,i/2,l+s/2),t>0&&o.rows.isHide(t-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([5,l+5],[i-5,l+5]),n.restore())})),n.line([0,h+d],[i,h+d]),n.line([i,d],[i,h+d])),"all"!==t&&"top"!==t||(o.colEach(e.sci,e.eci,((t,e,i)=>{const l=u+e,r=t;n.line([l,0],[l,s]),g<=r&&r<m+1&&fe.call(this,l,0,i,s),n.fillText(a(r),l+i/2,s/2),t>0&&o.cols.isHide(t-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([l+5,5],[l+5,s-5]),n.restore())})),n.line([c+u,0],[c+u,s]),n.line([0,s],[c+u,s])),n.restore()}function pe(t,e){const{draw:i}=this;i.save(),i.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,t,e),i.restore()}function me({sri:t,sci:e,eri:i,eci:s,w:l,h:r},n,o,h,a){const{draw:c,data:d}=this,{settings:u}=d;c.save(),c.attr(he).translate(n+h,o+a),u.showGrid?(d.rowEach(t,i,((e,s,r)=>{e!==t&&c.line([0,s],[l,s]),e===i&&c.line([0,s+r],[l,s+r])})),d.colEach(e,s,((t,i,l)=>{t!==e&&c.line([i,0],[i,r]),t===s&&c.line([i+l,0],[i+l,r])})),c.restore()):c.restore()}function we(t,e,i,s){const{draw:l,data:r}=this,n=r.viewWidth()-t,o=r.viewHeight()-e;l.save().translate(t,e).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),l.line([0,s],[n,s]),l.line([i,0],[i,o]),l.restore()}const ve=class{constructor(t,e){this.el=t,this.draw=new Yt(t,e.viewWidth(),e.viewHeight()),this.data=e}resetData(t){this.data=t,this.render()}render(){const{data:t}=this,{rows:e,cols:i}=t,s=i.indexWidth,l=e.height;this.draw.resize(t.viewWidth(),t.viewHeight()),this.clear();const r=t.viewRange(),n=t.freezeTotalWidth(),o=t.freezeTotalHeight(),{x:h,y:a}=t.scroll;me.call(this,r,s,l,n,o),ue.call(this,r,s,l,-h,-a),ge.call(this,"all",r,s,l,n,o),pe.call(this,s,l);const[c,d]=t.freeze;if(c>0||d>0){if(c>0){const t=r.clone();t.sri=0,t.eri=c-1,t.h=o,me.call(this,t,s,l,n,0),ue.call(this,t,s,l,-h,0),ge.call(this,"top",t,s,l,n,0)}if(d>0){const t=r.clone();t.sci=0,t.eci=d-1,t.w=n,me.call(this,t,s,l,0,o),ge.call(this,"left",t,s,l,0,o),ue.call(this,t,s,l,0,-a)}const e=t.freezeViewRange();me.call(this,e,s,l,0,0),ge.call(this,"all",e,s,l,0,0),ue.call(this,e,s,l,0,0),we.call(this,s,l,n,o)}}clear(){this.draw.clear()}},be=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],ye=["landscape","portrait"];function xe(t){return parseInt(96*t,10)}function Ee(t){"cancel"===t?this.el.hide():this.toPrint()}function Ce(t){const{paper:e}=this,{value:i}=t.target,s=be[i];e.w=xe(s[1]),e.h=xe(s[2]),this.preview()}function ke(t){const{paper:e}=this,{value:i}=t.target,s=ye[i];e.orientation=s,this.preview()}class Se{constructor(t){this.paper={w:xe(be[0][1]),h:xe(be[0][2]),padding:50,orientation:ye[0],get width(){return"landscape"===this.orientation?this.h:this.w},get height(){return"landscape"===this.orientation?this.w:this.h}},this.data=t,this.el=o("div",`${it}-print`).children(o("div",`${it}-print-bar`).children(o("div","-title").child("Print settings"),o("div","-right").children(o("div",`${it}-buttons`).children(new Wt("cancel").on("click",Ee.bind(this,"cancel")),new Wt("next","primary").on("click",Ee.bind(this,"next"))))),o("div",`${it}-print-content`).children(this.contentEl=o("div","-content"),o("div","-sider").child(o("form","").children(o("fieldset","").children(o("label","").child(`${_("print.size")}`),o("select","").children(...be.map(((t,e)=>o("option","").attr("value",e).child(`${t[0]} ( ${t[1]}''x${t[2]}'' )`)))).on("change",Ce.bind(this))),o("fieldset","").children(o("label","").child(`${_("print.orientation")}`),o("select","").children(...ye.map(((t,e)=>o("option","").attr("value",e).child(`${_("print.orientations")[e]}`)))).on("change",ke.bind(this))))))).hide()}resetData(t){this.data=t}preview(){const{data:t,paper:e}=this,{width:i,height:s,padding:l}=e,r=i-2*l,n=s-2*l,h=t.contentRange(),a=parseInt(h.h/n,10)+1,c=r/h.w;let d=l;const u=l;c>1&&(d+=(r-h.w)/2);let f=0,g=0;this.contentEl.html(""),this.canvases=[];const p={sri:0,sci:0,eri:0,eci:0};for(let e=0;e<a;e+=1){let e=0,l=0;const r=o("div",`${it}-canvas-card`),a=o("canvas",`${it}-canvas`);this.canvases.push(a.el);const m=new Yt(a.el,i,s);for(m.save(),m.translate(d,u),c<1&&m.scale(c,c);f<=h.eri;f+=1){const i=t.rows.getHeight(f);if(e+=i,!(e<n)){l=-(e-i);break}for(let e=0;e<=h.eci;e+=1)ce(m,t,f,e,g),p.eci=e}p.eri=f,m.restore(),m.save(),m.translate(d,u),c<1&&m.scale(c,c);const w=g;t.eachMergesInView(p,(({sri:e,sci:i})=>{ce(m,t,e,i,w)})),m.restore(),p.sri=p.eri,p.sci=p.eci,g+=l,this.contentEl.child(o("div",`${it}-canvas-card-wraper`).child(r.child(a)))}this.el.show()}toPrint(){this.el.hide();const{paper:t}=this,e=o("iframe","").hide(),{el:i}=e;window.document.body.appendChild(i);const{contentWindow:s}=i,l=s.document,r=document.createElement("style");r.innerHTML=`\n      @page { size: ${t.width}px ${t.height}px; };\n      canvas {\n        page-break-before: auto;        \n        page-break-after: always;\n        image-rendering: pixelated;\n      };\n    `,l.head.appendChild(r),this.canvases.forEach((t=>{const e=t.cloneNode(!1);e.getContext("2d").drawImage(t,0,0),l.body.appendChild(e)})),s.print()}}const Te=[{key:"copy",title:I("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:I("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:I("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:I("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:I("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:I("contextmenu.insertRow")},{key:"insert-column",title:I("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:I("contextmenu.deleteRow")},{key:"delete-column",title:I("contextmenu.deleteColumn")},{key:"delete-cell-text",title:I("contextmenu.deleteCellText")},{key:"hide",title:I("contextmenu.hide")},{key:"divider"},{key:"validation",title:I("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:I("contextmenu.cellprintable")},{key:"cell-non-printable",title:I("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:I("contextmenu.celleditable")},{key:"cell-non-editable",title:I("contextmenu.cellnoneditable")}];function $e(t){return"divider"===t.key?o("div",`${it}-item divider`):o("div",`${it}-item`).on("click",(()=>{this.itemClick(t.key),this.hide()})).children(t.title(),o("div","label").child(t.label||""))}function De(){return Te.map((t=>$e.call(this,t)))}class Ae{constructor(t,e=!1){this.menuItems=De.call(this),this.el=o("div",`${it}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=t,this.itemClick=()=>{},this.isHide=e,this.setMode("range")}setMode(t){const e=this.menuItems[12];"row-col"===t?e.show():e.hide()}hide(){const{el:t}=this;t.hide(),G(t)}setPosition(t,e){if(this.isHide)return;const{el:i}=this,{width:s}=i.show().offset(),l=this.viewFn(),r=l.height/2;let n=t;l.width-t<=s&&(n-=s),i.css("left",`${n}px`),e>r?i.css("bottom",l.height-e+"px").css("max-height",`${e}px`).css("top","auto"):i.css("top",`${e}px`).css("max-height",l.height-e+"px").css("bottom","auto"),Q(i)}}class Oe{constructor(t,e,i){this.tip=_(`toolbar.${t.replace(/-[a-z]/g,(t=>t[1].toUpperCase()))}`),e&&(this.tip+=` (${e})`),this.tag=t,this.shortcut=e,this.value=i,this.el=this.element(),this.change=()=>{}}element(){const{tip:t}=this;return o("div",`${it}-toolbar-btn`).on("mouseenter",(e=>{!function(t,e){if(e.classList.contains("active"))return;const{left:i,top:s,width:l,height:r}=e.getBoundingClientRect(),n=o("div",`${it}-tooltip`).html(t).show();document.body.appendChild(n.el);const h=n.box();n.css("left",i+l/2-h.width/2+"px").css("top",`${s+r+2}px`),K(e,"mouseleave",(()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)})),K(e,"click",(()=>{document.body.contains(n.el)&&document.body.removeChild(n.el)}))}(t,e.target)})).attr("data-tooltip",t)}setState(){}}class Re extends Oe{dropdown(){}getValue(t){return t}element(){const{tag:t}=this;return this.dd=this.dropdown(),this.dd.change=e=>this.change(t,this.getValue(e)),super.element().child(this.dd)}setState(t){t&&(this.value=t,this.dd.setTitle(t))}}class _e extends n{constructor(t,e,i,s,...l){super("div",`${it}-dropdown ${s}`),this.title=t,this.change=()=>{},this.headerClick=()=>{},"string"===typeof t?this.title=o("div",`${it}-dropdown-title`).child(t):i&&this.title.addClass("arrow-left"),this.contentEl=o("div",`${it}-dropdown-content`).css("width",e).hide(),this.setContentChildren(...l),this.headerEl=o("div",`${it}-dropdown-header`),this.headerEl.on("click",(()=>{"block"!==this.contentEl.css("display")?this.show():this.hide()})).children(this.title,i?o("div",`${it}-icon arrow-right`).child(o("div",`${it}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...t){this.contentEl.html(""),t.length>0&&this.contentEl.children(...t)}setTitle(t){this.title.html(t),this.hide()}show(){const{contentEl:t}=this;t.show(),this.parent().active(),Q(this.parent(),(()=>{this.hide()}))}hide(){this.parent().active(!1),this.contentEl.hide(),G(this.parent())}}class Ie extends _e{constructor(t,e){super(new Tt(`align-${e}`),"auto",!0,"bottom-left",...t.map((t=>{return(e=`align-${t}`,o("div",`${it}-item`).child(new Tt(e))).on("click",(()=>{this.setTitle(t),this.change(t)}));var e})))}setTitle(t){this.title.setName(`align-${t}`),this.hide()}}class ze extends Re{constructor(t){super("align","",t)}dropdown(){const{value:t}=this;return new Ie(["left","center","right"],t)}}class Fe extends Re{constructor(t){super("valign","",t)}dropdown(){const{value:t}=this;return new Ie(["top","middle","bottom"],t)}}class Ne extends Oe{element(){const{tag:t}=this;return super.element().child(new Tt(t)).on("click",(()=>this.click()))}click(){this.change(this.tag,this.toggle())}setState(t){this.el.active(t)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}class Me extends Ne{constructor(){super("autofilter")}setState(){}}class He extends Ne{constructor(){super("font-bold","Ctrl+B")}}class Ve extends Ne{constructor(){super("font-italic","Ctrl+I")}}class We extends Ne{constructor(){super("strike","Ctrl+U")}}class Pe extends Ne{constructor(){super("underline","Ctrl+U")}}const Le=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],Be=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],qe=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function Ue(t){return o("td","").child(o("div",`${it}-color-palette-cell`).on("click.stop",(()=>this.change(t))).css("background-color",t))}class je{constructor(){this.el=o("div",`${it}-color-palette`),this.change=()=>{};const t=o("table","").children(o("tbody","").children(o("tr",`${it}-theme-color-placeholders`).children(...Le.map((t=>Ue.call(this,t)))),...Be.map((t=>o("tr",`${it}-theme-colors`).children(...t.map((t=>Ue.call(this,t)))))),o("tr",`${it}-standard-colors`).children(...qe.map((t=>Ue.call(this,t))))));this.el.child(t)}}class Ye extends _e{constructor(t,e){const i=new Tt(t).css("height","16px").css("border-bottom",`3px solid ${e}`),s=new je;s.change=t=>{this.setTitle(t),this.change(t)},super(i,"auto",!1,"bottom-left",s.el)}setTitle(t){this.title.css("border-color",t),this.hide()}}const Ze=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class Xe extends _e{constructor(t){const e=new Tt("line-type");let i=0;const s=Ze.map(((e,l)=>o("div",`${it}-item state ${t===e[0]?"checked":""}`).on("click",(()=>{s[i].toggle("checked"),s[l].toggle("checked"),i=l,this.hide(),this.change(e)})).child(o("div",`${it}-line-type`).html(e[1]))));super(e,"auto",!1,"bottom-left",...s)}}function Ke(...t){return o("table","").child(o("tbody","").children(...t))}function Je(t){return o("td","").child(o("div",`${it}-border-palette-cell`).child(new Tt(`border-${t}`)).on("click",(()=>{this.mode=t;const{mode:e,style:i,color:s}=this;this.change({mode:e,style:i,color:s})})))}class Ge{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=()=>{},this.ddColor=new Ye("line-color",this.color),this.ddColor.change=t=>{this.color=t},this.ddType=new Xe(this.style),this.ddType.change=([t])=>{this.style=t},this.el=o("div",`${it}-border-palette`);const t=Ke(o("tr","").children(o("td",`${it}-border-palette-left`).child(Ke(o("tr","").children(...["all","inside","horizontal","vertical","outside"].map((t=>Je.call(this,t)))),o("tr","").children(...["left","top","right","bottom","none"].map((t=>Je.call(this,t)))))),o("td",`${it}-border-palette-right`).children(o("div",`${it}-toolbar-btn`).child(this.ddColor.el),o("div",`${it}-toolbar-btn`).child(this.ddType.el))));this.el.child(t)}}class Qe extends _e{constructor(){const t=new Tt("border-all"),e=new Ge;e.change=t=>{this.change(t),this.hide()},super(t,"auto",!1,"bottom-left",e.el)}}class ti extends Re{constructor(){super("border")}dropdown(){return new Qe}}class ei extends Oe{element(){return super.element().child(new Tt(this.tag)).on("click",(()=>this.change(this.tag)))}setState(t){this.el.disabled(t)}}class ii extends ei{constructor(){super("clearformat")}}class si extends Ne{constructor(){super("paintformat")}setState(){}}class li extends Re{constructor(t){super("color",void 0,t)}dropdown(){const{tag:t,value:e}=this;return new Ye(t,e)}}class ri extends Re{constructor(t){super("bgcolor",void 0,t)}dropdown(){const{tag:t,value:e}=this;return new Ye(t,e)}}class ni extends _e{constructor(){super("10","60px",!0,"bottom-left",...Xt.map((t=>o("div",`${it}-item`).on("click",(()=>{this.setTitle(`${t.pt}`),this.change(t)})).child(`${t.pt}`))))}}class oi extends Re{constructor(){super("font-size")}getValue(t){return t.pt}dropdown(){return new ni}}class hi extends _e{constructor(){const t=Zt.map((t=>o("div",`${it}-item`).on("click",(()=>{this.setTitle(t.title),this.change(t)})).child(t.title)));super(Zt[0].title,"160px",!0,"bottom-left",...t)}}class ai extends Re{constructor(){super("font-name")}getValue(t){return t.key}dropdown(){return new hi}}class ci extends _e{constructor(){let t=le.slice(0);t.splice(2,0,{key:"divider"}),t.splice(8,0,{key:"divider"}),t=t.map((t=>{const e=o("div",`${it}-item`);return"divider"===t.key?e.addClass("divider"):(e.child(t.title()).on("click",(()=>{this.setTitle(t.title()),this.change(t)})),t.label&&e.child(o("div","label").html(t.label))),e})),super("Normal","220px",!0,"bottom-left",...t)}setTitle(t){for(let e=0;e<le.length;e+=1)le[e].key===t&&this.title.html(le[e].title());this.hide()}}class di extends Re{constructor(){super("format")}getValue(t){return t.key}dropdown(){return new ci}}class ui extends _e{constructor(){const t=Qt.map((t=>o("div",`${it}-item`).on("click",(()=>{this.hide(),this.change(t)})).child(t.key)));super(new Tt("formula"),"180px",!0,"bottom-left",...t)}}class fi extends Re{constructor(){super("formula")}getValue(t){return t.key}dropdown(){return new ui}}class gi extends Ne{constructor(){super("freeze")}}class pi extends Ne{constructor(){super("merge")}setState(t,e){this.el.active(t).disabled(e)}}class mi extends ei{constructor(){super("redo","Ctrl+Y")}}class wi extends ei{constructor(){super("undo","Ctrl+Z")}}class vi extends ei{constructor(){super("print","Ctrl+P")}}class bi extends Ne{constructor(){super("textwrap")}}class yi extends _e{constructor(){const t=new Tt("ellipsis"),e=o("div",`${it}-toolbar-more`);super(t,"auto",!1,"bottom-right",e),this.moreBtns=e,this.contentEl.css("max-width","420px")}}class xi extends Re{constructor(){super("more"),this.el.hide()}dropdown(){return new yi}show(){this.el.show()}hide(){this.el.hide()}}function Ei(){return o("div",`${it}-toolbar-divider`)}function Ci(){this.btns2=[],this.items.forEach((t=>{if(Array.isArray(t))t.forEach((({el:t})=>{const e=t.box(),{marginLeft:i,marginRight:s}=t.computedStyle();this.btns2.push([t,e.width+parseInt(i,10)+parseInt(s,10)])}));else{const e=t.box(),{marginLeft:i,marginRight:s}=t.computedStyle();this.btns2.push([t,e.width+parseInt(i,10)+parseInt(s,10)])}}))}function ki(){const{el:t,btns:e,moreEl:i,btns2:s}=this,{moreBtns:l,contentEl:r}=i.dd;t.css("width",this.widthFn()-60+"px");const n=t.box();let o=160,h=12;const a=[],c=[];s.forEach((([t,e],i)=>{o+=e,i===s.length-1||o<n.width?a.push(t):(h+=e,c.push(t))})),e.html("").children(...a),l.html("").children(...c),r.css("width",`${h}px`),c.length>0?i.show():i.hide()}class Si{constructor(t,e,i=!1){this.data=t,this.change=()=>{},this.widthFn=e,this.isHide=i;const s=t.defaultStyle();this.items=[[this.undoEl=new wi,this.redoEl=new mi,new vi,this.paintformatEl=new si,this.clearformatEl=new ii],Ei(),[this.formatEl=new di],Ei(),[this.fontEl=new ai,this.fontSizeEl=new oi],Ei(),[this.boldEl=new He,this.italicEl=new Ve,this.underlineEl=new Pe,this.strikeEl=new We,this.textColorEl=new li(s.color)],Ei(),[this.fillColorEl=new ri(s.bgcolor),this.borderEl=new ti,this.mergeEl=new pi],Ei(),[this.alignEl=new ze(s.align),this.valignEl=new Fe(s.valign),this.textwrapEl=new bi],Ei(),[this.freezeEl=new gi,this.autofilterEl=new Me,this.formulaEl=new fi,this.moreEl=new xi]],this.el=o("div",`${it}-toolbar`),this.btns=o("div",`${it}-toolbar-btns`),this.items.forEach((t=>{Array.isArray(t)?t.forEach((t=>{this.btns.child(t.el),t.change=(...t)=>{this.change(...t)}})):this.btns.child(t.el)})),this.el.child(this.btns),i?this.el.hide():(this.reset(),setTimeout((()=>{Ci.call(this),ki.call(this)}),0),K(window,"resize",(()=>{ki.call(this)})))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(t){this[`${t}El`].click()}resetData(t){this.data=t,this.reset()}reset(){if(this.isHide)return;const{data:t}=this,e=t.getSelectedCellStyle();this.undoEl.setState(!t.canUndo()),this.redoEl.setState(!t.canRedo()),this.mergeEl.setState(t.canUnmerge(),!t.selector.multiple()),this.autofilterEl.setState(!t.canAutofilter());const{font:i,format:s}=e;this.formatEl.setState(s),this.fontEl.setState(i.name),this.fontSizeEl.setState(i.size),this.boldEl.setState(i.bold),this.italicEl.setState(i.italic),this.underlineEl.setState(e.underline),this.strikeEl.setState(e.strike),this.textColorEl.setState(e.color),this.fillColorEl.setState(e.bgcolor),this.alignEl.setState(e.align),this.valignEl.setState(e.valign),this.textwrapEl.setState(e.textwrap),this.freezeEl.setState(t.freezeIsActive())}}class Ti{constructor(t,e,i="600px"){this.title=t,this.el=o("div",`${it}-modal`).css("width",i).children(o("div",`${it}-modal-header`).children(new Tt("close").on("click.stop",(()=>this.hide())),this.title),o("div",`${it}-modal-content`).children(...e)).hide()}show(){this.dimmer=o("div",`${it}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:t,height:e}=this.el.show().box(),{clientHeight:i,clientWidth:s}=document.documentElement;this.el.offset({left:(s-t)/2,top:(i-e)/3}),window.xkeydownEsc=t=>{27===t.keyCode&&this.hide()},K(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),J(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}class $i{constructor(t,e){this.vchange=()=>{},this.el=o("div",`${it}-form-input`),this.input=o("input","").css("width",t).on("input",(t=>this.vchange(t))).attr("placeholder",e),this.el.child(this.input)}focus(){setTimeout((()=>{this.input.el.focus()}),10)}hint(t){this.input.attr("placeholder",t)}val(t){return this.input.val(t)}}class Di{constructor(t,e,i,s=(t=>t),l=(()=>{})){this.key=t,this.getTitle=s,this.vchange=()=>{},this.el=o("div",`${it}-form-select`),this.suggest=new St(e.map((t=>({key:t,title:this.getTitle(t)}))),(t=>{this.itemClick(t.key),l(t.key),this.vchange(t.key)}),i,this.el),this.el.children(this.itemEl=o("div","input-text").html(this.getTitle(t)),this.suggest.el).on("click",(()=>this.show()))}show(){this.suggest.search("")}itemClick(t){this.key=t,this.itemEl.html(this.getTitle(t))}val(t){return void 0!==t?(this.key=t,this.itemEl.html(this.getTitle(t)),this):this.key}}const Ai={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};class Oi{constructor(t,e,i,s){this.label="",this.rule=e,i&&(this.label=o("label","label").css("width",`${s}px`).html(i)),this.tip=o("div","tip").child("tip").hide(),this.input=t,this.input.vchange=()=>this.validate(),this.el=o("div",`${it}-form-field`).children(this.label,t.el,this.tip)}isShow(){return"none"!==this.el.css("display")}show(){this.el.show()}hide(){return this.el.hide(),this}val(t){return this.input.val(t)}hint(t){this.input.hint(t)}validate(){const{input:t,rule:e,tip:i,el:s}=this,l=t.val();if(e.required&&/^\s*$/.test(l))return i.html(_("validation.required")),s.addClass("error"),!1;if(e.type||e.pattern){if(!(e.pattern||Ai[e.type]).test(l))return i.html(_("validation.notMatch")),s.addClass("error"),!1}return s.removeClass("error"),!0}}class Ri extends Ti{constructor(){const t=new Oi(new Di("cell",["cell"],"100%",(t=>_(`dataValidation.modeType.${t}`))),{required:!0},`${_("dataValidation.range")}:`,100),e=new Oi(new $i("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),i=new Oi(new Di("list",["list","number","date","phone","email"],"100%",(t=>_(`dataValidation.type.${t}`)),(t=>this.criteriaSelected(t))),{required:!0},`${_("dataValidation.criteria")}:`,100),s=new Oi(new Di("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",(t=>_(`dataValidation.operator.${t}`)),(t=>this.criteriaOperatorSelected(t))),{required:!0}).hide(),l=new Oi(new $i("70px","10"),{required:!0}).hide(),r=new Oi(new $i("70px","100"),{required:!0,type:"number"}).hide(),n=new Oi(new $i("120px","a,b,c"),{required:!0}),h=new Oi(new $i("70px","10"),{required:!0,type:"number"}).hide();super(_("contextmenu.validation"),[o("div",`${it}-form-fields`).children(t.el,e.el),o("div",`${it}-form-fields`).children(i.el,s.el,l.el,r.el,h.el,n.el),o("div",`${it}-buttons`).children(new Wt("cancel").on("click",(()=>this.btnClick("cancel"))),new Wt("remove").on("click",(()=>this.btnClick("remove"))),new Wt("save","primary").on("click",(()=>this.btnClick("save"))))]),this.mf=t,this.rf=e,this.cf=i,this.of=s,this.minvf=l,this.maxvf=r,this.vf=h,this.svf=n,this.change=()=>{}}showVf(t){const e="date"===t?"2018-11-12":"10",{vf:i}=this;i.input.hint(e),i.show()}criteriaSelected(t){const{of:e,minvf:i,maxvf:s,vf:l,svf:r}=this;"date"===t||"number"===t?(e.show(),i.rule.type=t,s.rule.type=t,"date"===t?(i.hint("2018-11-12"),s.hint("2019-11-12")):(i.hint("10"),s.hint("100")),i.show(),s.show(),l.hide(),r.hide()):("list"===t?r.show():r.hide(),l.hide(),e.hide(),i.hide(),s.hide())}criteriaOperatorSelected(t){if(!t)return;const{minvf:e,maxvf:i,vf:s}=this;if("be"===t||"nbe"===t)e.show(),i.show(),s.hide();else{const t=this.cf.val();s.rule.type=t,"date"===t?s.hint("2018-11-12"):s.hint("10"),s.show(),e.hide(),i.hide()}}btnClick(t){if("cancel"===t)this.hide();else if("remove"===t)this.change("remove"),this.hide();else if("save"===t){const t=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let e=0;e<t.length;e+=1){const i=this[t[e]];if(i.isShow()&&!i.validate())return}const e=this.mf.val(),i=this.rf.val(),s=this.cf.val(),l=this.of.val();let r=this.svf.val();"number"!==s&&"date"!==s||(r="be"===l||"nbe"===l?[this.minvf.val(),this.maxvf.val()]:this.vf.val()),this.change("save",e,i,{type:s,operator:l,required:!1,value:r}),this.hide()}}setValue(t){if(t){const{mf:e,rf:i,cf:s,of:l,svf:r,vf:n,minvf:o,maxvf:h}=this,{mode:a,ref:c,validator:d}=t,{type:u,operator:f,value:g}=d||{type:"list"};e.val(a||"cell"),i.val(c),s.val(u),l.val(f),Array.isArray(g)?(o.val(g[0]),h.val(g[1])):(r.val(g||""),n.val(g||"")),this.criteriaSelected(u),this.criteriaOperatorSelected(f)}this.show()}}function _i(t){return o("div",`${it}-item ${t}`)}function Ii(t){return _i("state").child(_(`sort.${t}`)).on("click.stop",(()=>this.itemClick(t)))}function zi(t){const{filterbEl:e,filterValues:i}=this;e.html("");Object.keys(t).forEach(((s,l)=>{const r=t[s],n=i.includes(s)?"checked":"";e.child(o("div",`${it}-item state ${n}`).on("click.stop",(()=>this.filterClick(l,s))).children(""===s?_("filter.empty"):s,o("div","label").html(`(${r})`)))}))}function Fi(){const{filterhEl:t,filterValues:e,values:i}=this;t.html(`${e.length} / ${i.length}`),t.checked(e.length===i.length)}class Ni{constructor(){this.filterbEl=o("div",`${it}-body`),this.filterhEl=o("div",`${it}-header state`).on("click.stop",(()=>this.filterClick(0,"all"))),this.el=o("div",`${it}-sort-filter`).children(this.sortAscEl=Ii.call(this,"asc"),this.sortDescEl=Ii.call(this,"desc"),_i("divider"),o("div",`${it}-filter`).children(this.filterhEl,this.filterbEl),o("div",`${it}-buttons`).children(new Wt("cancel").on("click",(()=>this.btnClick("cancel"))),new Wt("ok","primary").on("click",(()=>this.btnClick("ok"))))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(t){if("ok"===t){const{ci:t,sort:e,filterValues:i}=this;this.ok&&this.ok(t,e,"in",i)}this.hide()}itemClick(t){this.sort=t;const{sortAscEl:e,sortDescEl:i}=this;e.checked("asc"===t),i.checked("desc"===t)}filterClick(t,e){const{filterbEl:i,filterValues:s,values:l}=this,r=i.children();if("all"===e)r.length===s.length?(this.filterValues=[],r.forEach((t=>o(t).checked(!1)))):(this.filterValues=Array.from(l),r.forEach((t=>o(t).checked(!0))));else{o(r[t]).toggle("checked")?s.push(e):s.splice(s.findIndex((t=>t===e)),1)}Fi.call(this)}set(t,e,i,s){this.ci=t;const{sortAscEl:l,sortDescEl:r}=this;null!==s?(this.sort=s.order,l.checked(s.asc()),r.checked(s.desc())):(this.sortDesc=null,l.checked(!1),r.checked(!1)),this.values=Object.keys(e),this.filterValues=i?Array.from(i.value):Object.keys(e),zi.call(this,e,i),Fi.call(this)}setOffset(t){this.el.offset(t).show();let e=1;Q(this.el,(()=>{e<=0&&this.hide(),e-=1}))}show(){this.el.show()}hide(){this.el.hide(),G(this.el)}}function Mi(t,e){const i=o("div",`${it}-toast`),s=o("div",`${it}-dimmer active`);i.children(o("div",`${it}-toast-header`).children(new Tt("close").on("click.stop",(()=>(document.body.removeChild(i.el),void document.body.removeChild(s.el)))),t),o("div",`${it}-toast-content`).html(e)),document.body.appendChild(i.el),document.body.appendChild(s.el);const{width:l,height:r}=i.box(),{clientHeight:n,clientWidth:h}=document.documentElement;i.offset({left:(h-l)/2,top:(n-r)/3})}function Hi(t,e){let i;return(...s)=>{const l=this,r=s;i||(i=setTimeout((()=>{i=null,t.apply(l,r)}),e))}}function Vi(){const{data:t,verticalScrollbar:e,horizontalScrollbar:i}=this,{l:s,t:l,left:r,top:n,width:o,height:h}=t.getSelectedRect(),a=this.getTableOffset();if(Math.abs(r)+o>a.width)i.move({left:s+o-a.width});else{const e=t.freezeTotalWidth();r<e&&i.move({left:s-1-e})}if(Math.abs(n)+h>a.height)e.move({top:l+h-a.height-1});else{const i=t.freezeTotalHeight();n<i&&e.move({top:l-1-i})}}function Wi(t,e,i,s=!0,l=!1){if(-1===e&&-1===i)return;const{table:r,selector:n,toolbar:o,data:h,contextMenu:a}=this;a.setMode(-1===e||-1===i?"row-col":"range");const c=h.getCell(e,i);t?(n.setEnd(e,i,l),this.trigger("cells-selected",c,n.range)):(n.set(e,i,s),this.trigger("cell-selected",c,e,i)),o.reset(),r.render()}function Pi(t,e){const{selector:i,data:s}=this,{rows:l,cols:r}=s;let[n,o]=i.indexes;const{eri:h,eci:a}=i.range;t&&([n,o]=i.moveIndexes),"left"===e?o>0&&(o-=1):"right"===e?(a!==o&&(o=a),o<r.len-1&&(o+=1)):"up"===e?n>0&&(n-=1):"down"===e?(h!==n&&(n=h),n<l.len-1&&(n+=1)):"row-first"===e?o=0:"row-last"===e?o=r.len-1:"col-first"===e?n=0:"col-last"===e&&(n=l.len-1),t&&(i.moveIndexes=[n,o]),Wi.call(this,t,n,o),Vi.call(this)}function Li(t){if(0!==t.buttons)return;if(t.target.className===`${it}-resizer-hover`)return;const{offsetX:e,offsetY:i}=t,{rowResizer:s,colResizer:l,tableEl:r,data:n}=this,{rows:o,cols:h}=n;if(e>h.indexWidth&&i>o.height)return s.hide(),void l.hide();const a=r.box(),c=n.getCellRectByXY(t.offsetX,t.offsetY);c.ri>=0&&-1===c.ci?(c.width=h.indexWidth,s.show(c,{width:a.width}),o.isHide(c.ri-1)?s.showUnhide(c.ri):s.hideUnhide()):s.hide(),-1===c.ri&&c.ci>=0?(c.height=o.height,l.show(c,{height:a.height}),h.isHide(c.ci-1)?l.showUnhide(c.ci):l.hideUnhide()):l.hide()}function Bi(t){const{verticalScrollbar:e,horizontalScrollbar:i,data:s}=this,{top:l}=e.scroll(),{left:r}=i.scroll(),{rows:n,cols:o}=s,{deltaY:h,deltaX:a}=t,c=(t,e)=>{let i=t,s=0;do{s=e(i),i+=1}while(s<=0);return s},d=t=>{if(t>0){const t=s.scroll.ri+1;if(t<n.len){const i=c(t,(t=>n.getHeight(t)));e.move({top:l+i-1})}}else{const t=s.scroll.ri-1;if(t>=0){const i=c(t,(t=>n.getHeight(t)));e.move({top:0===t?0:l-i})}}},u=Math.abs(h),f=Math.abs(a),g=Math.max(u,f);/Firefox/i.test(window.navigator.userAgent)&&Hi(d(t.detail),50),g===f&&Hi((t=>{if(t>0){const t=s.scroll.ci+1;if(t<o.len){const e=c(t,(t=>o.getWidth(t)));i.move({left:r+e-1})}}else{const t=s.scroll.ci-1;if(t>=0){const e=c(t,(t=>o.getWidth(t)));i.move({left:0===t?0:r-e})}}})(a),50),g===u&&Hi(d(h),50)}function qi(t,e){const{verticalScrollbar:i,horizontalScrollbar:s}=this,{top:l}=i.scroll(),{left:r}=s.scroll();"left"===t||"right"===t?s.move({left:r-e}):"up"!==t&&"down"!==t||i.move({top:l-e})}function Ui(){const{data:t,verticalScrollbar:e}=this,{height:i}=this.getTableOffset(),s=t.exceptRowTotalHeight(0,-1);e.set(i,t.rows.totalHeight()-s)}function ji(){const{data:t,horizontalScrollbar:e}=this,{width:i}=this.getTableOffset();t&&e.set(i,t.cols.totalWidth())}function Yi(){const{selector:t,data:e,editor:i}=this,[s,l]=e.freeze;if(s>0||l>0){const t=e.freezeTotalWidth(),s=e.freezeTotalHeight();i.setFreezeLengths(t,s)}t.resetAreaOffset()}function Zi(){const{tableEl:t,overlayerEl:e,overlayerCEl:i,table:s,toolbar:l,selector:r,el:n}=this,o=this.getTableOffset(),h=this.getRect();t.attr(h),e.offset(h),i.offset(o),n.css("width",`${h.width}px`),Ui.call(this),ji.call(this),Yi.call(this),s.render(),l.reset(),r.reset()}function Xi(){const{data:t,selector:e}=this;t.clearClipboard(),e.hideClipboard()}function Ki(){const{data:t,selector:e}=this;t.copy(),t.copyToSystemClipboard(),e.showClipboard()}function Ji(){const{data:t,selector:e}=this;t.cut(),e.showClipboard()}function Gi(t,e){const{data:i}=this;if("read"!==i.settings.mode)if(i.paste(t,(t=>Mi("Tip",t))))Zi.call(this);else if(e){const t=e.clipboardData.getData("text/plain");this.data.pasteFromText(t),Zi.call(this)}}function Qi(){this.data.hideRowsOrCols(),Zi.call(this)}function ts(t,e){this.data.unhideRowsOrCols(t,e),Zi.call(this)}function es(){const{data:t}=this;t.autofilter(),Zi.call(this)}function is(){const{toolbar:t}=this;t.paintformatActive()&&(Gi.call(this,"format"),Xi.call(this),t.paintformatToggle())}function ss(t){const{selector:e,data:i,table:s,sortFilter:l}=this,{offsetX:r,offsetY:n}=t,o=t.target.className===`${it}-selector-corner`,h=i.getCellRectByXY(r,n),{left:a,top:c,width:d,height:u}=h;let{ri:f,ci:g}=h;const{autoFilter:p}=i;if(p.includes(f,g)&&a+d-20<r&&c+u-20<n){const t=p.items(g,((t,e)=>i.rows.getCell(t,e)));return l.hide(),l.set(g,t,p.getFilter(g),p.getSort(g)),void l.setOffset({left:a,top:c+u+2})}t.shiftKey||(o?e.showAutofill(f,g):Wi.call(this,!1,f,g),tt(window,(t=>{({ri:f,ci:g}=i.getCellRectByXY(t.offsetX,t.offsetY)),o?e.showAutofill(f,g):1!==t.buttons||t.shiftKey||Wi.call(this,!0,f,g,!0,!0)}),(()=>{o&&e.arange&&"read"!==i.settings.mode&&i.autofill(e.arange,"all",(t=>Mi("Tip",t)))&&s.render(),e.hideAutofill(),is.call(this)}))),o||1!==t.buttons||t.shiftKey&&Wi.call(this,!0,f,g)}function ls(){const{editor:t,data:e}=this,i=e.getSelectedRect(),s=this.getTableOffset();let l="top";i.top>s.height/2&&(l="bottom"),t.setOffset(i,l)}function rs(){const{editor:t,data:e}=this;"read"!==e.settings.mode&&(ls.call(this),t.setCell(e.getSelectedCell(),e.getSelectedValidator()),Xi.call(this))}function ns(t){const{data:e,table:i,selector:s}=this;e.scrolly(t,(()=>{s.resetBRLAreaOffset(),ls.call(this),i.render()}))}function os(t){const{data:e,table:i,selector:s}=this;e.scrollx(t,(()=>{s.resetBRTAreaOffset(),ls.call(this),i.render()}))}function hs(t,e){const{ri:i}=t,{table:s,selector:l,data:r}=this;r.rows.setHeight(i,e),s.render(),l.resetAreaOffset(),Ui.call(this),ls.call(this)}function as(t,e){const{ci:i}=t,{table:s,selector:l,data:r}=this;r.cols.setWidth(i,e),s.render(),l.resetAreaOffset(),ji.call(this),ls.call(this)}function cs(t,e="finished"){const{data:i,table:s}=this;if("read"===i.settings.mode)return;i.setSelectedCellText(t,e);const{ri:l,ci:r}=i.selector;"finished"===e?s.render():this.trigger("cell-edited",t,l,r)}function ds(t){const{data:e}=this;"read"!==e.settings.mode&&("insert-row"===t?e.insert("row"):"delete-row"===t?e.delete("row"):"insert-column"===t?e.insert("column"):"delete-column"===t?e.delete("column"):"delete-cell"===t?e.deleteCell():"delete-cell-format"===t?e.deleteCell("format"):"delete-cell-text"===t?e.deleteCell("text"):"cell-printable"===t?e.setSelectedCellAttr("printable",!0):"cell-non-printable"===t?e.setSelectedCellAttr("printable",!1):"cell-editable"===t?e.setSelectedCellAttr("editable",!0):"cell-non-editable"===t&&e.setSelectedCellAttr("editable",!1),Xi.call(this),Zi.call(this))}function us(t,e){const{data:i}=this;if("undo"===t)this.undo();else if("redo"===t)this.redo();else if("print"===t)this.print.preview();else if("paintformat"===t)!0===e?Ki.call(this):Xi.call(this);else if("clearformat"===t)ds.call(this,"delete-cell-format");else if("link"===t);else if("chart"===t);else if("autofilter"===t)es.call(this);else if("freeze"===t)if(e){const{ri:t,ci:e}=i.selector;this.freeze(t,e)}else this.freeze(0,0);else i.setSelectedCellAttr(t,e),"formula"!==t||i.selector.multiple()||rs.call(this),Zi.call(this)}function fs(t,e,i,s){this.data.setAutoFilter(t,e,i,s),Zi.call(this)}function gs(){const{selector:t,overlayerEl:e,rowResizer:i,colResizer:s,verticalScrollbar:l,horizontalScrollbar:r,editor:n,contextMenu:o,toolbar:h,modalValidation:a,sortFilter:c}=this;e.on("mousemove",(t=>{Li.call(this,t)})).on("mousedown",(t=>{n.clear(),o.hide(),2===t.buttons?(this.data.xyInSelectedRect(t.offsetX,t.offsetY)||ss.call(this,t),o.setPosition(t.offsetX,t.offsetY),t.stopPropagation()):2===t.detail?rs.call(this):ss.call(this,t)})).on("mousewheel.stop",(t=>{Bi.call(this,t)})).on("mouseout",(t=>{const{offsetX:e,offsetY:l}=t;l<=0&&s.hide(),e<=0&&i.hide()})),t.inputChange=t=>{cs.call(this,t,"input"),rs.call(this)},function(t,{move:e,end:i}){let s=0,l=0;K(t,"touchstart",(t=>{const{pageX:e,pageY:i}=t.touches[0];s=e,l=i})),K(t,"touchmove",(t=>{if(!e)return;const{pageX:i,pageY:r}=t.changedTouches[0],n=i-s,o=r-l;(Math.abs(n)>10||Math.abs(o)>10)&&(et(n,o,t,e),s=i,l=r),t.preventDefault()})),K(t,"touchend",(t=>{if(!i)return;const{pageX:e,pageY:r}=t.changedTouches[0];et(e-s,r-l,t,i)}))}(e.el,{move:(t,e)=>{qi.call(this,t,e)}}),h.change=(t,e)=>us.call(this,t,e),c.ok=(t,e,i,s)=>fs.call(this,t,e,i,s),i.finishedFn=(t,e)=>{hs.call(this,t,e)},s.finishedFn=(t,e)=>{as.call(this,t,e)},i.unhideFn=t=>{ts.call(this,"row",t)},s.unhideFn=t=>{ts.call(this,"col",t)},l.moveFn=(t,e)=>{ns.call(this,t,e)},r.moveFn=(t,e)=>{os.call(this,t,e)},n.change=(t,e)=>{cs.call(this,e,t)},a.change=(t,...e)=>{"save"===t?this.data.addValidation(...e):this.data.removeValidation()},o.itemClick=t=>{"validation"===t?a.setValue(this.data.getSelectedValidation()):"copy"===t?Ki.call(this):"cut"===t?Ji.call(this):"paste"===t?Gi.call(this,"all"):"paste-value"===t?Gi.call(this,"text"):"paste-format"===t?Gi.call(this,"format"):"hide"===t?Qi.call(this):ds.call(this,t)},K(window,"resize",(()=>{this.reload()})),K(window,"click",(t=>{this.focusing=e.contains(t.target)})),K(window,"paste",(t=>{this.focusing&&(Gi.call(this,"all",t),t.preventDefault())})),K(window,"keydown",(t=>{if(!this.focusing)return;const e=t.keyCode||t.which,{key:i,ctrlKey:s,shiftKey:l,metaKey:r}=t;if(s||r)switch(e){case 90:this.undo(),t.preventDefault();break;case 89:this.redo(),t.preventDefault();break;case 67:Ki.call(this),t.preventDefault();break;case 88:Ji.call(this),t.preventDefault();break;case 85:h.trigger("underline"),t.preventDefault();break;case 86:default:break;case 37:Pi.call(this,l,"row-first"),t.preventDefault();break;case 38:Pi.call(this,l,"col-first"),t.preventDefault();break;case 39:Pi.call(this,l,"row-last"),t.preventDefault();break;case 40:Pi.call(this,l,"col-last"),t.preventDefault();break;case 32:Wi.call(this,!1,-1,this.data.selector.ci,!1),t.preventDefault();break;case 66:h.trigger("bold");break;case 73:h.trigger("italic")}else{switch(e){case 32:l&&Wi.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:o.hide(),Xi.call(this);break;case 37:Pi.call(this,l,"left"),t.preventDefault();break;case 38:Pi.call(this,l,"up"),t.preventDefault();break;case 39:Pi.call(this,l,"right"),t.preventDefault();break;case 40:Pi.call(this,l,"down"),t.preventDefault();break;case 9:n.clear(),Pi.call(this,!1,l?"left":"right"),t.preventDefault();break;case 13:n.clear(),Pi.call(this,!1,l?"up":"down"),t.preventDefault();break;case 8:ds.call(this,"delete-cell-text"),t.preventDefault()}"Delete"===i?(ds.call(this,"delete-cell-text"),t.preventDefault()):e>=65&&e<=90||e>=48&&e<=57||e>=96&&e<=105||"="===t.key?(cs.call(this,t.key,"input"),rs.call(this)):113===e&&rs.call(this)}}))}class ps{constructor(t,e){this.eventMap=function(){const t=new Map;function e(e,i){return t.has(e)&&(()=>{const s=t.get(e);return Array.isArray(s)&&s.push(i)||!1})()||t.set(e,[].concat(i))}function i(e,i){return t.has(e)&&(()=>{const s=t.get(e),l=s.indexOf(i);return l>=0&&s.splice(l,1)&&0===t.get(e).length&&t.delete(e)})()}return{get current(){return t},on:e,once:function(t,s){const l=(...e)=>{s.call(null,...e),i(t,l)};return e(t,l)},fire:function(e,i){return t.has(e)&&(()=>{const s=t.get(e);for(const t of s)t.call(null,...i)})()},removeListener:i,removeAllListeners:function(){t.clear()}}}();const{view:i,showToolbar:s,showContextmenu:l}=e.settings;this.el=o("div",`${it}-sheet`),this.toolbar=new Si(e,i.width,!s),this.print=new Se(e),t.children(this.toolbar.el,this.el,this.print.el),this.data=e,this.tableEl=o("canvas",`${it}-table`),this.rowResizer=new st(!1,e.rows.height),this.colResizer=new st(!0,e.cols.minWidth),this.verticalScrollbar=new lt(!0),this.horizontalScrollbar=new lt(!1),this.editor=new Vt(te,(()=>this.getTableOffset()),e.rows.height),this.modalValidation=new Ri,this.contextMenu=new Ae((()=>this.getRect()),!l),this.selector=new yt(e),this.overlayerCEl=o("div",`${it}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=o("div",`${it}-overlayer`).child(this.overlayerCEl),this.sortFilter=new Ni,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new ve(this.tableEl.el,e),gs.call(this),Zi.call(this),Wi.call(this,!1,0,0)}on(t,e){return this.eventMap.on(t,e),this}trigger(t,...e){const{eventMap:i}=this;i.fire(t,e)}resetData(t){this.editor.clear(),this.data=t,Ui.call(this),ji.call(this),this.toolbar.resetData(t),this.print.resetData(t),this.selector.resetData(t),this.table.resetData(t)}loadData(t){return this.data.setData(t),Zi.call(this),this}freeze(t,e){const{data:i}=this;return i.setFreeze(t,e),Zi.call(this),this}undo(){this.data.undo(),Zi.call(this)}redo(){this.data.redo(),Zi.call(this)}reload(){return Zi.call(this),this}getRect(){const{data:t}=this;return{width:t.viewWidth(),height:t.viewHeight()}}getTableOffset(){const{rows:t,cols:e}=this.data,{width:i,height:s}=this.getRect();return{width:i-e.indexWidth,height:s-t.height,left:e.indexWidth,top:t.height}}}class ms extends _e{constructor(t){super(new Tt("ellipsis"),"auto",!1,"top-left"),this.contentClick=t}reset(t){const e=t.map(((t,e)=>o("div",`${it}-item`).css("width","150px").css("font-weight","normal").on("click",(()=>{this.contentClick(e),this.hide()})).child(t)));this.setContentChildren(...e)}setTitle(){}}const ws=[{key:"delete",title:I("contextmenu.deleteSheet")}];function vs(t){return o("div",`${it}-item`).child(t.title()).on("click",(()=>{this.itemClick(t.key),this.hide()}))}function bs(){return ws.map((t=>vs.call(this,t)))}class ys{constructor(){this.el=o("div",`${it}-contextmenu`).css("width","160px").children(...bs.call(this)).hide(),this.itemClick=()=>{}}hide(){const{el:t}=this;t.hide(),G(t)}setOffset(t){const{el:e}=this;e.offset(t),e.show(),Q(e)}}class xs{constructor(t=(()=>{}),e=(()=>{}),i=(()=>{}),s=(()=>{})){this.swapFunc=e,this.updateFunc=s,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new ms((t=>{this.clickSwap2(this.items[t])})),this.contextMenu=new ys,this.contextMenu.itemClick=i,this.el=o("div",`${it}-bottombar`).children(this.contextMenu.el,this.menuEl=o("ul",`${it}-menu`).child(o("li","").children(new Tt("add").on("click",(()=>{t()})),o("span","").child(this.moreEl))))}addItem(t,e){this.dataNames.push(t);const i=o("li",e?"active":"").child(t);i.on("click",(()=>{this.clickSwap2(i)})).on("contextmenu",(t=>{const{offsetLeft:e,offsetHeight:s}=t.target;this.contextMenu.setOffset({left:e,bottom:s+1}),this.deleteEl=i})).on("dblclick",(()=>{const t=i.html(),e=new $i("auto","");e.val(t),e.input.on("blur",(({target:e})=>{const{value:i}=e,s=this.dataNames.findIndex((e=>e===t));this.renameItem(s,i)})),i.html("").child(e.el),e.focus()})),e&&this.clickSwap(i),this.items.push(i),this.menuEl.child(i),this.moreEl.reset(this.dataNames)}renameItem(t,e){this.dataNames.splice(t,1,e),this.moreEl.reset(this.dataNames),this.items[t].html("").child(e),this.updateFunc(t,e)}clear(){this.items.forEach((t=>{this.menuEl.removeChild(t.el)})),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:t,deleteEl:e}=this;if(this.items.length>1){const i=this.items.findIndex((t=>t===e));if(this.items.splice(i,1),this.dataNames.splice(i,1),this.menuEl.removeChild(e.el),this.moreEl.reset(this.dataNames),t===e){const[t]=this.items;return this.activeEl=t,this.activeEl.toggle(),[i,0]}return[i,-1]}return[-1]}clickSwap2(t){const e=this.items.findIndex((e=>e===t));this.clickSwap(t),this.activeEl.toggle(),this.swapFunc(e)}clickSwap(t){null!==this.activeEl&&this.activeEl.toggle(),this.activeEl=t}}class Es{constructor(t,e={}){let i=t;this.options={showBottomBar:!0,...e},this.sheetIndex=1,this.datas=[],"string"===typeof t&&(i=document.querySelector(t)),this.bottombar=this.options.showBottomBar?new xs((()=>{const t=this.addSheet();this.sheet.resetData(t)}),(t=>{const e=this.datas[t];this.sheet.resetData(e)}),(()=>{this.deleteSheet()}),((t,e)=>{this.datas[t].name=e})):null,this.data=this.addSheet();const s=o("div",`${it}`).on("contextmenu",(t=>t.preventDefault()));i.appendChild(s.el),this.sheet=new ps(s,this.data),null!==this.bottombar&&s.child(this.bottombar.el)}addSheet(t,e=!0){const i=t||`sheet${this.sheetIndex}`,s=new X(i,this.options);return s.change=(...t)=>{this.sheet.trigger("change",...t)},this.datas.push(s),null!==this.bottombar&&this.bottombar.addItem(i,e),this.sheetIndex+=1,s}deleteSheet(){if(null===this.bottombar)return;const[t,e]=this.bottombar.deleteItem();t>=0&&(this.datas.splice(t,1),e>=0&&this.sheet.resetData(this.datas[e]))}loadData(t){const e=Array.isArray(t)?t:[t];if(null!==this.bottombar&&this.bottombar.clear(),this.datas=[],e.length>0)for(let t=0;t<e.length;t+=1){const i=e[t],s=this.addSheet(i.name,0===t);s.setData(i),0===t&&this.sheet.resetData(s)}return this}getData(){return this.datas.map((t=>t.getData()))}cellText(t,e,i,s=0){return this.datas[s].setCellText(t,e,i,"finished"),this}cell(t,e,i=0){return this.datas[i].getCell(t,e)}cellStyle(t,e,i=0){return this.datas[i].getCellStyle(t,e)}reRender(){return this.sheet.table.render(),this}on(t,e){return this.sheet.on(t,e),this}validate(){const{validations:t}=this.data;return t.errors.size<=0}change(t){return this.sheet.on("change",t),this}static locale(t,e){z(t,e)}}const Cs=(t,e={})=>new Es(t,e);window&&(window.x_spreadsheet=Cs,window.x_spreadsheet.locale=(t,e)=>z(t,e));const ks=Es;i(219242);var Ss=i(200651),Ts=i(88889),$s=i(767190),Ds=i(282833);var As=i(211965);ks.locale("zh-cn");const Os=r.iK.div`
  ${({theme:t,width:e,height:i})=>`\n  width: ${e}px;\n  height: ${i}px;\n  overflow: hidden;\n`}
`;function Rs(t){return"[object Object]"===Object.prototype.toString.call(t)}function _s(t){return"number"==typeof t}const Is=function(t){return t.charCodeAt(0)-64};function zs(t){const{height:e,width:i,data:r,columns:n,excelSpreadsheet:o,columnColorFormatters:h}=t,a=(0,s.useRef)(null),[c,d]=(0,s.useState)(null),[u,f]=(0,s.useState)(0),[g,p]=(0,s.useState)(0),[m,w]=(0,s.useState)(0),[v,b]=(0,s.useState)(!0),[y,x]=(0,s.useState)(0),E=(0,l.I0)(),{rows:C={},merges:k=[],dataEndPosition:S=0}=o,T=Array.isArray(h)&&h.length>0,$=(D=9,Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789").sort((()=>.5-Math.random())).slice(0,D).join(""));var D;const[A,O]=(0,s.useState)(0),R=(0,l.v9)((t=>t.dashboardState.editMode)),_=(0,s.useMemo)((()=>window.location.href.indexOf("/explore/?")>-1?(b(!1),"edit"):"read"),[window.location]),I=(0,s.useCallback)(((t,e)=>{const{isNumeric:i,config:s={}}=t;return{columnWidth:Number.isNaN(Number(s.columnWidth))?s.columnWidth:Number(s.columnWidth),style:{align:s.horizontalAlign?s.horizontalAlign:i?"right":"left"},Cell:e=>{const[i,s]=function(t,e){const{dataType:i,formatter:s,config:l={}}=t,r=i===Ts.Z.NUMERIC,n=void 0===l.d3SmallNumberFormat?s:(0,$s.JB)(l.d3SmallNumberFormat);return(0,Ds.Z)(r&&"number"===typeof e&&Math.abs(e)<1?n:s,e)}(t,e);return i?null:s},key:t.key}}),[]),z=(0,s.useMemo)((()=>[...n.map(I)].filter(Boolean)),[n,I]),F=function(t,e){var i;return!(!t||0==t.length)&&(null==(i=t[0])?void 0:i.getColorFromValue(e))},N=function(t){const e={};t.styles=function(t,e){const i={};return t.forEach(((t,s)=>{(t.isCustomizeConfig||Object.values(e).some((t=>!!Rs(t)&&Object.values(t.cells).some((t=>!!Rs(t)&&t.style==s)))))&&(i[s]=t)})),i}(t.styles,t.rows);for(let i in t.rows)t.rows[i].type&&"data"===t.rows[i].type||"len"===i||(e[i]=t.rows[i]),"data"===t.rows[i].type&&(t.dataEndPosition=Number(i));t.rows={...e},E((0,Ss.setControlValue)("excel_spreadsheet",t))};(0,s.useEffect)((()=>{const t=[],e=[],i=[],s=[],l=[];for(let i in C){var r;"tableHeader"===(null==(r=C[i])?void 0:r.type)&&f(Number(i)),t.push(Number(i)+1),e.push(C[i])}v?(k.forEach((t=>{const e=t.split(":");i.push(...e.map((t=>Number(t.substr(1,4))))),s.push(...e.map((t=>Is(t.substr(0,1)))))})),p(Math.max(...t,...i,S+1)),e.forEach((t=>{const e=Object.keys((null==t?void 0:t.cells)||{});l.push(Math.max(...e.map((t=>Number(t)+1))))})),w(Math.max(...l,...s))):(p(100),w(26))}),[o,v]),(0,s.useEffect)((()=>{i&&e&&x(y+1)}),[i,e]),(0,s.useEffect)((()=>{if(a&&i&&e){const t=new ks(`#excelMain-${$}`,{mode:_,showToolbar:!v,showContextmenu:!v,showBottomBar:!1,view:{height:()=>e+(v?16:0),width:()=>i+(v?59:0)},row:{len:100},col:{len:26}});t.change(N),d(t);const s=document.getElementById(`excelMain-${$}`),l=document.getElementById("gridDash")||document.getElementById("dashboardScroll");s&&l&&v&&(s.addEventListener("mouseenter",(function(){const t=l.scrollTop,e=l.scrollLeft;l.onscroll=i=>{l.scrollTo(e,t)}})),s.addEventListener("mouseleave",(function(){l.onscroll=null})))}}),[a,y]),(0,s.useEffect)((()=>{if(c&&g&&m){const t={};for(let e in C){const i=S?u+r.length-S:0;Number(e)<u?t[e]=C[e]:t[Number(e)+i]=C[e]}const e=function(t,e,i,s){const l={},r={},n=Object.values(C).filter((t=>"tableHeader"===t.type)),o=n.length>0?n[0].cells:{};i.map(((t,e)=>{const i=Object.values(o).filter((e=>t.label===e.column)),s=i.length>0?i[0].text:"";r[e]={text:s||t.label,style:e,column:t.label}})),l[u]={cells:r,type:"tableHeader"};for(let r=0;r<t.length;r+=1){let n={};Object.keys(t[r]).map(((l,o)=>{const h=null==s?void 0:s.findIndex((t=>t.column===l)),a=_s(h)&&s?[s[h||0]]:void 0,c=F(a,t[r][l]);n[o]={text:e[o].Cell(t[r][l]),editable:v,style:c&&_s(h)?i.length+h:o}})),l[u+r+1]={cells:n,id:t[r].id,type:"data"}}return l}(r,z,n,h),i=function(t,e){const i={};return Object.values(e).map(((e,s)=>{i[s]={...t[s].style,isCustomizeConfig:!0}})),T&&h.forEach(((s,l)=>{const r=t.filter((t=>t.key===s.column));r.length>0&&(i[e.length+l]={...r[0].style,...s.style,isCustomizeConfig:!0})})),i}(z,n);o.styles=function(t,e){if(t&&Rs(t)){Object.keys(e).forEach((i=>{t[i]=e[i]}));const i=Math.max(...Object.keys(t).map((t=>Number(t)))),s=[];for(let e=0;e<i+1;e++)Object.prototype.hasOwnProperty.call(t,e)?s.push(t[e]):s.push({});return s}return Array.isArray(t)?t:Object.values(e)}(o.styles,i);const s={...o,rows:{...t,...e,len:g},cols:{...null==o?void 0:o.cols,len:m}};c.loadData([s]),!v&&N(s),O((t=>t+1))}}),[c,r,n,z,g,m]),(0,s.useEffect)((()=>{const t=document.getElementById("gridDash")||document.getElementById("dashboardScroll");t&&!R&&v&&c&&A>0&&(t.scrollTo(0,0),O(0))}),[c,A]);const M={height:`${e+(v?24:0)}px`,width:`${i+(v?59:0)}px`,marginLeft:v?"-59px":0,marginTop:v?"-24px":0};return(0,As.tZ)(Os,{height:e,width:i},(0,As.tZ)("div",{ref:a,key:`excelMain${y}`,id:`excelMain-${$}`,style:M}))}},219242:()=>{!function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}({3:function(t,e,i){"use strict";i.r(e);const s={toolbar:{undo:"\u64a4\u9500",redo:"\u6062\u590d",print:"\u6253\u5370",paintformat:"\u683c\u5f0f\u5237",clearformat:"\u6e05\u9664\u683c\u5f0f",format:"\u6570\u636e\u683c\u5f0f",fontName:"\u5b57\u4f53",fontSize:"\u5b57\u53f7",fontBold:"\u52a0\u7c97",fontItalic:"\u503e\u659c",underline:"\u4e0b\u5212\u7ebf",strike:"\u5220\u9664\u7ebf",color:"\u5b57\u4f53\u989c\u8272",bgcolor:"\u586b\u5145\u989c\u8272",border:"\u8fb9\u6846",merge:"\u5408\u5e76\u5355\u5143\u683c",align:"\u6c34\u5e73\u5bf9\u9f50",valign:"\u5782\u76f4\u5bf9\u9f50",textwrap:"\u81ea\u52a8\u6362\u884c",freeze:"\u51bb\u7ed3",autofilter:"\u81ea\u52a8\u7b5b\u9009",formula:"\u51fd\u6570",more:"\u66f4\u591a"},contextmenu:{copy:"\u590d\u5236",cut:"\u526a\u5207",paste:"\u7c98\u8d34",pasteValue:"\u7c98\u8d34\u6570\u636e",pasteFormat:"\u7c98\u8d34\u683c\u5f0f",hide:"\u9690\u85cf",insertRow:"\u63d2\u5165\u884c",insertColumn:"\u63d2\u5165\u5217",deleteSheet:"\u5220\u9664",deleteRow:"\u5220\u9664\u884c",deleteColumn:"\u5220\u9664\u5217",deleteCell:"\u5220\u9664",deleteCellText:"\u5220\u9664\u6570\u636e",validation:"\u6570\u636e\u9a8c\u8bc1",cellprintable:"\u53ef\u6253\u5370",cellnonprintable:"\u4e0d\u53ef\u6253\u5370",celleditable:"\u53ef\u7f16\u8f91",cellnoneditable:"\u4e0d\u53ef\u7f16\u8f91"},print:{size:"\u7eb8\u5f20\u5927\u5c0f",orientation:"\u65b9\u5411",orientations:["\u6a2a\u5411","\u7eb5\u5411"]},format:{normal:"\u6b63\u5e38",text:"\u6587\u672c",number:"\u6570\u503c",percent:"\u767e\u5206\u6bd4",rmb:"\u4eba\u6c11\u5e01",usd:"\u7f8e\u5143",eur:"\u6b27\u5143",date:"\u77ed\u65e5\u671f",time:"\u65f6\u95f4",datetime:"\u957f\u65e5\u671f",duration:"\u6301\u7eed\u65f6\u95f4"},formula:{sum:"\u6c42\u548c",average:"\u6c42\u5e73\u5747\u503c",max:"\u6c42\u6700\u5927\u503c",min:"\u6c42\u6700\u5c0f\u503c",concat:"\u5b57\u7b26\u62fc\u63a5",_if:"\u6761\u4ef6\u5224\u65ad",and:"\u548c",or:"\u6216"},validation:{required:"\u6b64\u503c\u5fc5\u586b",notMatch:"\u6b64\u503c\u4e0d\u5339\u914d\u9a8c\u8bc1\u89c4\u5219",between:"\u6b64\u503c\u5e94\u5728 {} \u548c {} \u4e4b\u95f4",notBetween:"\u6b64\u503c\u4e0d\u5e94\u5728 {} \u548c {} \u4e4b\u95f4",notIn:"\u6b64\u503c\u4e0d\u5728\u5217\u8868\u4e2d",equal:"\u6b64\u503c\u5e94\u8be5\u7b49\u4e8e {}",notEqual:"\u6b64\u503c\u4e0d\u5e94\u8be5\u7b49\u4e8e {}",lessThan:"\u6b64\u503c\u5e94\u8be5\u5c0f\u4e8e {}",lessThanEqual:"\u6b64\u503c\u5e94\u8be5\u5c0f\u4e8e\u7b49\u4e8e {}",greaterThan:"\u6b64\u503c\u5e94\u8be5\u5927\u4e8e {}",greaterThanEqual:"\u6b64\u503c\u5e94\u8be5\u5927\u4e8e\u7b49\u4e8e {}"},error:{pasteForMergedCell:"\u65e0\u6cd5\u5bf9\u5408\u5e76\u7684\u5355\u5143\u683c\u6267\u884c\u6b64\u64cd\u4f5c"},calendar:{weeks:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],months:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"]},button:{next:"\u4e0b\u4e00\u6b65",cancel:"\u53d6\u6d88",remove:"\u5220\u9664",save:"\u4fdd\u5b58",ok:"\u786e\u8ba4"},sort:{desc:"\u964d\u5e8f",asc:"\u5347\u5e8f"},filter:{empty:"\u7a7a\u767d"},dataValidation:{mode:"\u6a21\u5f0f",range:"\u5355\u5143\u533a\u95f4",criteria:"\u6761\u4ef6",modeType:{cell:"\u5355\u5143\u683c",column:"\u5217\u6a21\u5f0f",row:"\u884c\u6a21\u5f0f"},type:{list:"\u5217\u8868",number:"\u6570\u5b57",date:"\u65e5\u671f",phone:"\u624b\u673a\u53f7",email:"\u7535\u5b50\u90ae\u4ef6"},operator:{be:"\u5728\u533a\u95f4",nbe:"\u4e0d\u5728\u533a\u95f4",lt:"\u5c0f\u4e8e",lte:"\u5c0f\u4e8e\u7b49\u4e8e",gt:"\u5927\u4e8e",gte:"\u5927\u4e8e\u7b49\u4e8e",eq:"\u7b49\u4e8e",neq:"\u4e0d\u7b49\u4e8e"}}};window&&window.x_spreadsheet&&(window.x_spreadsheet.$messages=window.x_spreadsheet.$messages||{},window.x_spreadsheet.$messages["zh-cn"]=s),e.default=s}})}}]);