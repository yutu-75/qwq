"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[82140],{935500:(e,t,a)=>{a.r(t),a.d(t,{ADD_CHART:()=>ve,ANNOTATION_QUERY_FAILED:()=>X,ANNOTATION_QUERY_STARTED:()=>Q,ANNOTATION_QUERY_SUCCESS:()=>Y,CHART_FILTER:()=>H,CHART_RENDERING_FAILED:()=>$,CHART_RENDERING_SUCCEEDED:()=>V,CHART_UPDATE_FAILED:()=>F,CHART_UPDATE_STARTED:()=>O,CHART_UPDATE_STOPPED:()=>L,CHART_UPDATE_SUCCEEDED:()=>M,DYNAMIC_PLUGIN_CONTROLS_READY:()=>te,POST_CHART_FORM_DATA:()=>Ce,REMOVE_CHART:()=>G,REMOVE_CHART_FILTER:()=>j,RENDER_TRIGGERED:()=>de,SET_FORM_DATA_META:()=>R,TRIGGER_QUERY:()=>ce,UPDATE_CHART_CHANGED_INFO:()=>ne,UPDATE_CHART_ID:()=>ge,UPDATE_QUERY_FORM_DATA:()=>he,addChart:()=>ye,annotationQueryFailed:()=>ee,annotationQueryStarted:()=>J,annotationQuerySuccess:()=>K,chartFilter:()=>z,chartRenderingFailed:()=>U,chartRenderingSucceeded:()=>q,chartUpdateFailed:()=>P,chartUpdateStarted:()=>N,chartUpdateStopped:()=>k,chartUpdateSucceeded:()=>I,dynamicPluginControlsReady:()=>ae,exploreJSON:()=>be,getChartDataRequest:()=>le,getDatasourceSamples:()=>Se,getSavedChart:()=>_e,postChartFormData:()=>Ee,redirectSQLLab:()=>Te,refreshChart:()=>Ze,removeChart:()=>W,removeChartFilter:()=>B,renderTriggered:()=>pe,runAnnotationQuery:()=>se,setFormDataMeta:()=>D,triggerQuery:()=>ue,updateChartChangedInfo:()=>oe,updateChartId:()=>fe,updateQueryFormData:()=>me});var n=a(150361),o=a.n(n),r=a(730381),i=a.n(r),l=a(281928),s=a(431069),c=a(472813),u=a(455867),d=a(237731),p=a(635854),h=a(591877),m=a(593185),g=a(112515),f=a(10945),v=a(672570),y=a(797381),b=a(203741),_=a(998286),C=a(309679),E=a(986374),T=a(174599),Z=a(677997),S=a(427600),x=a(667496),w=a(269856),A=a(753506);a(569175);const R="SET_FORM_DATA_META";function D(e,t){return{type:R,meta:e,key:t}}const O="CHART_UPDATE_STARTED";function N(e,t,a){return{type:O,queryController:e,latestQueryFormData:t,key:a}}const M="CHART_UPDATE_SUCCEEDED";function I(e,t){return{type:M,queriesResponse:e,key:t}}const L="CHART_UPDATE_STOPPED";function k(e){return{type:L,key:e}}const F="CHART_UPDATE_FAILED";function P(e,t){return{type:F,queriesResponse:e,key:t}}const $="CHART_RENDERING_FAILED";function U(e,t,a){return{type:$,error:e,key:t,stackTrace:a}}const V="CHART_RENDERING_SUCCEEDED";function q(e){return{type:V,key:e}}const H="CHART_FILTER";function z(e,t,a){return{type:H,filters:e,groupbys:t,key:a}}const j="REMOVE_CHART_FILTER";function B(e){return{type:j,key:e}}const G="REMOVE_CHART";function W(e){return{type:G,key:e}}const Y="ANNOTATION_QUERY_SUCCESS";function K(e,t,a){return{type:Y,annotation:e,queryResponse:t,key:a}}const Q="ANNOTATION_QUERY_STARTED";function J(e,t,a){return{type:Q,annotation:e,queryController:t,key:a}}const X="ANNOTATION_QUERY_FAILED";function ee(e,t,a){return{type:X,annotation:e,queryResponse:t,key:a}}const te="DYNAMIC_PLUGIN_CONTROLS_READY",ae=()=>(e,t)=>{const a=t(),n=(0,p.R3)(a.explore,a.explore.form_data);e({type:te,key:n.slice_id.value,controlsState:n})},ne="UPDATE_CHART_CHANGED_INFO",oe=(e,t)=>({type:ne,changedInfo:e,key:t}),re=async(e,t,a,n,o="POST",r={},i)=>{if("dist_bar"===e.viz_type){const t=(null==e?void 0:e.adhoc_filters)||[];if(Object.keys(i).length){var c;const a=((null==i||null==(c=i.drilldown)?void 0:c.filters)||[]).map((e=>{var t;const a=(null==e||null==(t=e.val)?void 0:t[0])||"";return{expressionType:"SIMPLE",subject:null==e?void 0:e.col,operator:"==",operatorId:"EQUALS",comparator:a,dropdown:[{value:a,label:a}],clause:"WHERE",sqlExpression:null,isExtra:!1,isNew:!1,datasourceWarning:!1,filterOptionName:"filter_3yloww7hgrf_2yhpy2gxhq9"}}));e.adhoc_filters=[...t,...a]}}const u=(0,g.pd)({resultFormat:t,resultType:a}),d=E._&&(null==r?void 0:r.dashboard_id),p=(0,g.H6)({formData:e,endpointType:u,force:n,allowDomainSharding:d,method:o,requestParams:r.dashboard_id?{dashboard_id:r.dashboard_id}:{}}),f=e.drillDown?{groupby:[l.Z.getColumn(i.drilldown,e.groupby)]}:{},v={...r,url:p,postPayload:{form_data:{...e,...f}},parseMethod:"json-bigint"};return((0,h.cr)(m.T.CLIENT_CACHE)?s.Z.get:s.Z.post)(v).then((({json:e,response:t})=>({response:t,json:{result:[e]}})))},ie=async(e,t,a,n,r,i,l,u,d,p,h)=>{const m=(0,g.u)({formData:e,resultType:a,resultFormat:t,force:n,setDataMask:i,ownState:l});if("big_number"===m.form_data.viz_type){const t=o()((null==m?void 0:m.queries)||[]);t.forEach((t=>{const a=(null==t?void 0:t.metrics)||[],n=[];a.forEach((t=>{null!=e&&e.show_yoy_cal&&n.push({calc_type:"yoy",calc_attr:1===(null==e?void 0:e.yoy_type_choose)?"rate":"value",column:{column_name:t.label}}),null!=e&&e.show_qoq_cal&&n.push({calc_type:"qoq",calc_attr:1===(null==e?void 0:e.qoq_type_choose)?"rate":"value",column:{column_name:t.label}})})),n.length?t.calc=n:delete t.calc})),m.queries=t,m.force=!0}if("echarts_timeseries_bar"===m.form_data.viz_type||"mixed_timeseries"===m.form_data.viz_type||"echarts_timeseries_line"===m.form_data.viz_type){const t=o()((null==m?void 0:m.queries)||[]),a=()=>{const t=((null==p?void 0:p.time_grain_sqla)||{}).value||(null==e?void 0:e.time_grain_sqla);if(t&&!S.Vg.includes(t))return!1;const a=null==p?void 0:p.x_axis,n=(null==a?void 0:a.value)||(null==e?void 0:e.x_axis);return!!((0,c.GA)(n)||0===Object.getOwnPropertyNames(p).length&&null!=e&&e.x_axis)||!!(0,c.s9)(n)&&!(null==(o=(null!=(r=null==a?void 0:a.options)?r:[]).find((e=>(null==e?void 0:e.column_name)===n)))||!o.is_dttm);var o,r};t.forEach((t=>{const n=((null==t?void 0:t.metrics)||[]).filter((e=>e.indicatorType)).map((t=>{let a="ratio";t.indicatorType&&e.time_grain_sqla&&(a=t.indicatorType);let n="";return w.zu.includes(t.indicatorDateFormat)?n="rate":w.xN.includes(t.indicatorDateFormat)&&(n="value"),{calc_type:a,calc_attr:n,column:{column_name:t.label}}}));if(n.length)if(a())t.calc=n;else{const e=n.filter((e=>"ratio"===e.calc_type));t.calc=e}else delete t.calc})),m.queries=t}if("pivot_table_v2"===m.form_data.viz_type){if(null!=l&&l.opFilter){const e=(null==l?void 0:l.columnsFilter)||[];m.form_data.groupbyRows=e}if(null!=l&&l.chooseCrossValueList&&m.form_data.enableCrossVariable){if(null!=l&&l.chooseCrossValueList){const e=(l.chooseCrossValueList||[]).map((e=>e.value))||[],t=l.statisticalDimension||{};m.form_data.groupbyColumns=e,m.form_data.groupbyRows=[null==t?void 0:t.third_cate_name]}const e=l.statisticalIndicators||[],t=o()((null==m?void 0:m.queries)||[]);t.forEach((t=>{const a=(null==t?void 0:t.metrics)||[];if(e.includes("total_proportion")){const e=a.map((e=>({calc_type:"ratio",column:{column_name:e.label||e}})));t.calc=e}e.includes("total_count")||(t.metrics=[])})),m.queries=t,e.includes("total_count")||(m.form_data.metrics=[]),m.force=!0}if(m.form_data.ratioTotals){const e=o()((null==m?void 0:m.queries)||[]);e.forEach((e=>{const t=((null==e?void 0:e.metrics)||[]).map((e=>({calc_type:"ratio",column:{column_name:e.label||e}})));e.calc=t})),m.queries=e,m.force=!0}}if(Array.isArray(e.filter_object)&&e.filter_object.length>0&&Array.isArray(e.filter_price)&&e.filter_price.length>0){const t=o()((null==m?void 0:m.queries)||[]),a=o()((null==m?void 0:m.form_data)||{});t.forEach((t=>{const a=(null==t?void 0:t.filters)||[],n={col:e.filter_object[0],op:"IN",val:e.filter_price};t.filters=[...a,n]}));const n=e.filter_price[0];a.adhoc_filters.push({clause:"WHERE",comparator:e.filter_price,datasourceWarning:!1,dropdown:[{value:n,label:n}],expressionType:"SIMPLE",filterOptionName:"filter_h5tmiosgcgd_7085v9b16qu",isExtra:!1,isNew:!1,operator:"IN",operatorId:"IN",sqlExpression:null,subject:e.filter_object[0]}),m.queries=t,m.form_data=a,m.force=!0}if("scatter_clustering"===m.form_data.viz_type){const e=o()((null==m?void 0:m.form_data)||{}),{xRow:t,yRow:a,xCrossRow:n,yCrossRow:r,indicatorName:i,indicatorMarkers:l}=e;let s=[t,a,n,r,i];Array.isArray(l)||"string"===typeof l&&s.push(l),e.cols=s;const c=o()((null==m?void 0:m.queries)||[]);c.forEach((e=>{e.groupby=s})),m.queries=c,m.form_data=e,m.force=!0}if(["table","pivot_table_v2"].includes(m.form_data.viz_type)&&m.queries.forEach((t=>{const a=t.filters?t.filters.filter((e=>"SHOW COL"==e.op)):-1;if(a.length>0){var n;const o=e.datasource.split("__")[0],r=(null==(n=h.filter((e=>`${null==e?void 0:e.id}`===o)))?void 0:n[0])||{},i=null==r?void 0:r.columns.map((e=>e.column_name)),l=[];a.forEach((e=>{const a=t.filters.findIndex((e=>"SHOW COL"==e.op));a>-1&&t.filters.splice(a,1);const n=i.filter((t=>e.val.includes(t)));l.push(n)}));const s=Array.from(new Set(l.flat()));s.length>0&&("pivot_table_v2"==m.form_data.viz_type?(m.form_data.groupbyColumns=s,t.columns=[...s]):(m.form_data.groupby=s,t.columns=s))}})),"echarts_timeseries_bar"===m.form_data.viz_type||"echarts_timeseries_line"===m.form_data.viz_type){var f;const e=o()((null==m?void 0:m.queries)||[]),t=o()((null==m?void 0:m.form_data)||{});if(null!=t&&null!=(f=t.adhoc_Sort)&&f.length){let a="CASE ";for(let e=0;e<(null==t||null==(v=t.adhoc_Sort)?void 0:v.length);e++){var v;a+=` WHEN "${t.x_axis}"='${t.adhoc_Sort[e]}' then ${e+1} `}a+=`else ${t.adhoc_Sort.length+1} end`;const n={aggregate:null,column:null,datasourceWarning:!1,expressionType:"SQL",hasCustomLabel:!1,indicatorDateFormat:null,indicatorType:null,label:a,optionName:`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`,sqlExpression:a};e.forEach((e=>{null==e||e.orderby,null==e||e.series_limit_metric;const t=[n,!1],a=n;e.orderby[0]=t,e.series_limit_metric=a,e.post_processing[0].options.is_sort=!1})),Object.assign(t,{timeseries_limit_metric:n}),m.queries=e,delete t.adhoc_Sort,m.form_data=t,m.force=!1}}!function(e,t){if("correlation_analysis"===e.form_data.viz_type){const t=o()((null==e?void 0:e.form_data)||{}),{rowDimension:a,columnDimensionAndcorrelation:n,correlationValue:r}=t,i=[a,n,r];t.cols=i;const l=o()((null==e?void 0:e.queries)||[]);l.forEach((e=>{e.groupby=i})),e.queries=l,e.form_data=t,e.force=!0}if(["echarts_timeseries_line","echarts_timeseries_bar","pie"].includes(e.form_data.viz_type)){var a,n;const r=o()((null==e?void 0:e.form_data)||{});null!=e&&null!=(a=e.form_data)&&a.displayWeights&&null!=e&&null!=(n=e.form_data)&&n.weightsColumns?r.viewWeight=(null==t?void 0:t.viewWeight)||!1:r.viewWeight=!1,e.form_data=r,e.force=!0}var r,i,l;if(["echarts_timeseries_line","echarts_area","echarts_timeseries_bar","echarts_timeseries_scatter","echarts_timeseries","echarts_timeseries_smooth","echarts_timeseries_step"].includes(e.form_data.viz_type))if("2"===`${null==e||null==(r=e.form_data)?void 0:r.forecastTodoMethod}`&&null!=e&&null!=(i=e.form_data)&&i.forecastDisplayExternal&&null!=e&&null!=(l=e.form_data)&&l.forecastPeriodExternal){var s;const t=o()((null==e?void 0:e.queries)||[]),a=null==e||null==(s=e.form_data)?void 0:s.forecastPeriodExternal;c=a,!Number.isNaN(parseFloat(c))&&Number.isFinite(c)&&(t.forEach((e=>{const t=(null==e?void 0:e.calc)||[];t.push({calc_type:"forecast",calc_attr:a}),e.calc=t})),e.queries=t,e.force=!0)}else e.force=!0;var c;if("lastest_world_map"===e.form_data.viz_type){const t=o()((null==e?void 0:e.form_data)||{}),{provinceColumn:a,cityColumn:n,regionColumn:r,townshipColumn:i}=t,l=[];if(null!=a&&a.length&&(l.push(a),null!=n&&n.length&&(l.push(n),null!=r&&r.length&&(l.push(r),null!=i&&i.length&&l.push(i)))),l.length){t.cols=l;const a=o()((null==e?void 0:e.queries)||[]);a.forEach((e=>{e.groupby=l})),e.queries=a,e.form_data=t,e.force=!0}}if((0,A.Z)(e.form_data.viz_type)){const a=o()((null==e?void 0:e.form_data)||{}),{enableChartDrilldown:n,drilldownColumns:r=[]}=a;let i=(null==a?void 0:a.groupby)||[];"sunburst_v2"===e.form_data.viz_type&&(i=(null==a?void 0:a.columns)||[]);const l=(null==a?void 0:a.x_axis)||"",s=[...i,...r];l&&s.unshift(l);const{listValueFilter:c=[]}=t,u=s[c.length-1],d=s[c.length];if(n&&c.length&&u&&d){const t=c.map(((e,t)=>({col:s[t],op:"==",val:e}))),n=o()((null==e?void 0:e.queries)||[]);n.forEach((a=>{var n;const r=(null==a?void 0:a.filters)||[];a.filters=[...r,...t];const i=null==a||null==(n=a.columns)?void 0:n[0];if(i&&"object"===typeof i){const e={...i,label:d,sqlExpression:d};a.columns[0]=e}if(a.post_processing){var l,s;const e=o()(a.post_processing||[]);null!=e&&null!=(l=e[0])&&null!=(s=l.options)&&s.index&&(e[0].options.index=[d]),a.post_processing=e}"funnel"!==e.form_data.viz_type&&"treemap_v2"!==e.form_data.viz_type&&"sunburst_v2"!==e.form_data.viz_type&&"pie"!==e.form_data.viz_type||(a.columns=[d])})),e.queries=n;const r=o()((null==a?void 0:a.adhoc_filters)||[]);c.forEach(((e,t)=>{const a={expressionType:"SIMPLE",subject:s[t],operator:"==",operatorId:"EQUALS",comparator:e,dropdown:[{value:e,label:e}],clause:"WHERE",sqlExpression:null,isExtra:!1,isNew:!1,datasourceWarning:!1,filterOptionName:"filter_3yloww7hgrf_2yhpy2gxhq9"};r.push(a)})),a.x_axis=d,a.adhoc_filters=r,a.adhoc_Sort=[],"funnel"!==e.form_data.viz_type&&"treemap_v2"!==e.form_data.viz_type&&"sunburst_v2"!==e.form_data.viz_type&&"pie"!==e.form_data.viz_type||(a.groupby=[d],delete a.x_axis),e.form_data=a}}}(m,l);const{slice_id:y}=e,{dashboard_id:b}=r,_={};void 0!==y&&(_.form_data=`{"slice_id":${y}}`),void 0!==b&&(_.dashboard_id=b),!1!==n&&(_.force=n),m.force&&(_.force=!0);const C=E._&&(null==r?void 0:r.dashboard_id),T=(0,g.kN)({path:"/api/v1/chart/data",qs:_,allowDomainSharding:C}).toString(),Z={...r,url:T,headers:{"Content-Type":"application/json"},body:JSON.stringify(m),parseMethod:"json-bigint"};return s.Z.post(Z)};async function le({formData:e,setDataMask:t=(()=>{}),resultFormat:a="json",resultType:n="full",force:o=!1,method:r="POST",requestParams:i={},ownState:l={},charts:s,key:c,controls:u={},datasetScopeInfo:d=[]}){let p={...i};return E._&&(p={...p,mode:"cors",credentials:"include"}),(0,g.kP)(e)?re(e,a,n,o,r,p,l,s):ie(e,a,n,o,p,t,l,s,c,u,d)}function se({annotation:e,timeout:t=60,formData:a=null,key:n,isDashboardRequest:o=!1,force:r=!1}){return function(i,l){var c;const u=n||Object.keys(l().charts)[0],d={...a||l().charts[u].latestQueryFormData};if(!(0,f.m7)(e.sourceType))return Promise.resolve();const p=d.time_grain_sqla||d.granularity;d.time_grain_sqla=p,d.granularity=p;const h=Object.keys(e.overrides);(h.includes("since")||h.includes("until"))&&(e.overrides={...e.overrides,time_range:null});const m=Object.keys(e.overrides).reduce(((t,a)=>({...t,[a]:e.overrides[a]||d[a]})),{});if(!o&&d){const e=d.extra_filters&&d.extra_filters.length>0;m.extra_filters=e?d.extra_filters:void 0}const v=(0,g.xW)(e.value,r),y=new AbortController,{signal:b}=y;i(J(e,y,u));const C=null==d||null==(c=d.annotation_layers)?void 0:c.findIndex((t=>t.name===e.name));return C>=0&&(d.annotation_layers[C].overrides=m),s.Z.post({url:v,signal:b,timeout:1e3*t,headers:{"Content-Type":"application/json"},jsonPayload:(0,g.u)({formData:d,force:r,resultFormat:"json",resultType:"full"})}).then((({json:t})=>{var a,n,o;const r=null==t||null==(a=t.result)||null==(n=a[0])||null==(o=n.annotation_data)?void 0:o[e.name];return i(K(e,{data:r},u))})).catch((t=>(0,_.O$)(t).then((t=>{"timeout"===t.statusText?i(ee(e,{error:"Query timeout"},u)):(t.error||"").toLowerCase().includes("no data")?i(K(e,t,u)):"abort"!==t.statusText&&i(ee(e,t,u))}))))}}const ce="TRIGGER_QUERY";function ue(e=!0,t){return{type:ce,value:e,key:t}}const de="RENDER_TRIGGERED";function pe(e,t){return{type:de,value:e,key:t}}const he="UPDATE_QUERY_FORM_DATA";function me(e,t){return{type:he,value:e,key:t}}const ge="UPDATE_CHART_ID";function fe(e,t=0){return{type:ge,newId:e,key:t}}const ve="ADD_CHART";function ye(e,t){return{type:ve,chart:e,key:t}}function be(e,t=!1,a=60,n,o,r,l,s){return async(c,u)=>{var d,p,f,v;const C=b.Yd.getTimestamp(),E=new AbortController,S={signal:E.signal,timeout:1e3*a};r&&(S.dashboard_id=r);const x=null==(d=u())||null==(p=d.explore)?void 0:p.controls,w=null==(f=u())||null==(v=f.nativeFilters)?void 0:v.datasetScopeInfo,A=le({setDataMask:t=>{c((0,T.updateDataMask)(e.slice_id,t))},formData:e,resultFormat:"json",resultType:"full",force:t,method:o,requestParams:S,ownState:l,charts:s,key:n,controls:x,datasetScopeInfo:w});c(N(E,e,n));const R=A.then((({response:t,json:a})=>{if((0,h.cr)(m.T.GLOBAL_ASYNC_QUERIES)){const n="result"in a?a.result:a;switch(t.status){case 200:return Promise.resolve(n);case 202:return(0,g.kP)(e)?(0,Z.YJ)(n[0]):(0,Z.YJ)(n);default:throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`)}}return a.result})).then((a=>(a.forEach((a=>c((0,y.logEvent)(b.W9,{slice_id:n,applied_filters:a.applied_filters,is_cached:a.is_cached,force_refresh:t,row_count:a.rowcount,datasource:e.datasource,start_offset:C,ts:(new Date).getTime(),duration:b.Yd.getTimestamp()-C,has_extra_filters:e.extra_filters&&e.extra_filters.length>0,viz_type:e.viz_type,data_age:a.is_cached?i()(new Date).diff(i().utc(a.cached_dttm)):null})))),c(I(a,n))))).catch((t=>{if((0,h.cr)(m.T.GLOBAL_ASYNC_QUERIES))return c(P([t],n));const a=(t,a)=>{c((0,y.logEvent)(b.W9,{slice_id:n,has_err:!0,is_cached:a,error_details:t,datasource:e.datasource,start_offset:C,ts:(new Date).getTime(),duration:b.Yd.getTimestamp()-C}))};return"AbortError"===t.name?(a("abort"),c(k(n))):(0,_.O$)(t).then((e=>("timeout"===t.statusText?a("timeout"):a(e.error,e.is_cached),c(P([e],n)))))})),D=(0,g.kP)(e)&&e.annotation_layers||[],O=r>0;return Promise.all([R,c(ue(!1,n)),c(me(e,n)),...D.map((o=>c(se({annotation:o,timeout:a,formData:e,key:n,isDashboardRequest:O,force:t}))))])}}function _e(e,t=!1,a=60,n,o,r,i){return be(e,t,a,n,"GET",o,r,i)}const Ce="POST_CHART_FORM_DATA";function Ee(e,t=!1,a=60,n,o,r,i){return be(e,t,a,n,"POST",o,r,i)}function Te(e){return t=>{le({formData:e,resultFormat:"json",resultType:"query"}).then((({json:t})=>{const a=(0,x.VU)("/superset/sqllab/"),n={datasourceKey:e.datasource,sql:t.result[0].query};s.Z.postForm(a,{form_data:(0,C.o)(n)})})).catch((()=>t((0,v.Gb)((0,u.t)("An error occurred while loading the SQL")))))}}function Ze(e,t,a){return(n,o)=>{var r;const i=(o().charts||{})[e],l=o().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;i.latestQueryFormData&&0!==Object.keys(i.latestQueryFormData).length&&n(Ee(i.latestQueryFormData,t,l,i.id,a,null==(r=o().dataMask[i.id])?void 0:r.ownState))}}const Se=async(e,t,a,n,o,r)=>{try{const i={force:a,datasource_type:e,datasource_id:t};(0,d.Z)(o)&&(0,d.Z)(r)&&(i.per_page=o,i.page=r);return(await s.Z.post({endpoint:"/datasource/samples",jsonPayload:n,searchParams:i})).json.result}catch(e){const t=await(0,_.O$)(e);throw new Error(t.message||t.error||(0,u.t)("Sorry, an error occurred"),{cause:e})}}},957902:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(667294),o=a(45697),r=a.n(o),i=a(455867),l=a(272875),s=a(211965);const c={children:r().node.isRequired,onError:r().func,showMessage:r().bool};class u extends n.Component{constructor(e){super(e),this.state={error:null,info:null}}componentDidCatch(e,t){this.props.onError&&this.props.onError(e,t),this.setState({error:e,info:t})}render(){const{error:e,info:t}=this.state;if(e){const a=e.toString(),n=(0,s.tZ)("span",null,(0,s.tZ)("strong",null,(0,i.t)("Unexpected error")),a?`: ${a}`:"");return this.props.showMessage?(0,s.tZ)(l.Z,{subtitle:n,copyText:n,stackTrace:t?t.componentStack:null}):null}return this.props.children}}u.propTypes=c,u.defaultProps={onError:()=>{},showMessage:!0}},781395:(e,t,a)=>{function n(e,t){return e().dashboardState.sliceIds.includes(t)}a.d(t,{KJ:()=>r,M6:()=>c,P_:()=>h,cK:()=>m,fK:()=>o,ib:()=>p,ku:()=>l,l3:()=>i,l6:()=>g,oT:()=>u,oW:()=>s,yz:()=>d});const o="ADD_FILTER";function r(e,t,a){return(r,i)=>n(i,e)?r({type:o,chartId:e,component:t,form_data:a}):i().dashboardFilters}const i="REMOVE_FILTER";function l(e){return(t,a)=>n(a,e)?t({type:i,chartId:e}):a().dashboardFilters}const s="CHANGE_FILTER";function c(e,t,a,o=!1){return(r,i)=>{if(n(i,e)){const n=i().dashboardLayout.present;return r({type:s,chartId:e,newSelectedValues:t,merge:a,onlydash:o,components:n})}return i().dashboardFilters}}const u="UPDATE_DIRECT_PATH_TO_FILTER";function d(e,t){return(a,o)=>n(o,e)?a({type:u,chartId:e,path:t}):o().dashboardFilters}const p="UPDATE_LAYOUT_COMPONENTS";function h(e){return t=>{t({type:p,components:e})}}const m="UPDATE_DASHBOARD_FILTERS_SCOPE";function g(e){return t=>{t({type:m,scopes:e})}}},990605:(e,t,a)=>{a.d(t,{A7:()=>T,B6:()=>W,CB:()=>O,Dx:()=>S,G8:()=>R,Hj:()=>Z,Is:()=>x,Iz:()=>D,J0:()=>M,L1:()=>j,LM:()=>I,Mu:()=>$,Ou:()=>G,TE:()=>L,WZ:()=>E,Ww:()=>A,YA:()=>F,_p:()=>B,aZ:()=>H,az:()=>Y,bK:()=>w,eX:()=>k,g3:()=>U,iO:()=>q,nj:()=>_,qL:()=>V,v7:()=>N,x_:()=>K});var n=a(150361),o=a.n(n),r=a(21090),i=a(455867),l=a(672570),s=a(81255),c=a(52004),u=a(680621),d=a(973830),p=a(995173),h=a(948461),m=a(781395),g=a(174599),f=a(909467),v=a(974713),y=a(674547);const b=(0,a(454076).cz)(),_="UPDATE_COMPONENTS";function C(e){return(...t)=>(a,n)=>{var r,d,p,h,C,T;const Z=e(...t);if((null==Z?void 0:Z.type)===M&&"TABS"===(null==(r=Z.payload)||null==(d=r.dropResult)||null==(p=d.dragging)?void 0:p.type)&&"TAB"===(null==(h=Z.payload)||null==(C=h.dropResult)||null==(T=C.destination)?void 0:T.type))return a((0,l.Dz)((0,i.t)("Only one layer of tabs can be nested")));const{dashboardLayout:S,dashboardState:x,dataMask:w}=n();var A;if("object"===typeof Z&&Z.type===L&&null==(null==(A=Z.payload.dropResult)?void 0:A.destination)){var R;Z.payload.dropResult.destination=function(e,t){let a=e[u.PV];if(e[u._4].children[0]&&e[e[u._4].children[0]].type===s.yR){const n=e[e[u._4].children[0]].children.find((e=>t.activeTabs.some((t=>t===e))));n&&(a=e[n])}return a}(S.present,x);const e=[s.yR],t=null==(R=Z.payload.dropResult.dragging)?void 0:R.type;if("mobile"===Z.payload.dropResult.appendFrom&&!e.includes(t)){var D;const e=Z.payload.dropResult.dragging||{},{parents:t=[]}=e,n=t.find((e=>e.indexOf("ROW-")>-1)),o=S.present||{};let r=b;const i=(null==(D=o[n])?void 0:D.children)||[];let l=0;var N;if(i.forEach((e=>{var t,a;const n=(null==(t=o[e])||null==(a=t.meta)?void 0:a.width)||0;l+=n})),l>=b)((null==(N=o[n])?void 0:N.children)||[]).forEach((e=>{var t,n;const i=.5*((null==(t=o[e])||null==(n=t.meta)?void 0:n.width)||0);r-=i;const l=o[e]||{},s={[e]:{...l,meta:{...l.meta,width:i}}};a(E(s))}));else r=b-l;Z.payload.dropResult.dragging.meta.width=r}}a("function"===typeof Z?Z(a,n):Z);const{dashboardLayout:I,dashboardState:k}=n();if("object"===typeof Z&&Z.type===O&&!Z.payload.sync){if(Z.payload.id.indexOf("ROW-")>-1){var P,$;((null==S||null==(P=S.present)||null==($=P[Z.payload.id])?void 0:$.children)||[]).forEach((e=>{if(a((0,v.v7)(e,null,!0)),e.indexOf("FILTER_SELEC")>-1){var t,n,o,r;const i=null==S||null==(t=S.present)?void 0:t[e],l=null==i||null==(n=i.meta)?void 0:n.filterId,s=null==w?void 0:w[l];s&&(null==s||null==(o=s.filterState)||null==(r=o.value)?void 0:r.length)>0&&a((0,g.deleteDataMask)(l))}}))}let e=null;Z.payload.id.indexOf("TABS-")>-1&&(e=Z.payload.parentId),Z.payload.id.indexOf("TAB-")>-1&&(e=Z.payload.parentId),a((0,v.v7)(Z.payload.id,e,!1))}if("object"===typeof Z&&Z.type===_&&!Z.payload.sync){var U;let e=o()(Z.payload.nextComponents)||{};const t=e=>e.indexOf(`${s.hI}-`)>-1||e.indexOf(`${s.Nc}-`)>-1||e.indexOf(`${s.xh}-`)>-1||e.indexOf(`${s.dW}-`)>-1||e.indexOf(`${s.Mg}-`)>-1||e.indexOf(`${s.Ce}-`)>-1||e.indexOf(`${s.qu}-`)>-1||e.indexOf(`${s.t}-`)>-1,r=Object.keys(e).filter(t),{dashboardInfo:i,dashboardState:l}=n();"grid"===(null==i||null==(U=i.metadata)?void 0:U.layout_type)&&l.layoutMode!==c.kB.MOBILE&&1===Object.keys(e).length&&1===r.length&&Object.values(e).forEach((e=>{e.meta.gridLayoutConf.style.width=100,e.meta.gridLayoutConf.style.w=100,e.meta.gridLayoutConf.style.x=0,e.meta.gridLayoutConf.style.transform=`translate(0px,${e.meta.gridLayoutConf.style.y}px)`})),a((0,v.WZ)((0,y.cw)(e),!0))}if((null==Z?void 0:Z.type)===M||(null==Z?void 0:Z.type)===F){const e=(0,y.ag)(I.present,S.present),t=o()(e);var V,q;if(t)"grid"===(null==(V=n().dashboardInfo)||null==(q=V.metadata)?void 0:q.layout_type)&&(t.meta.gridLayoutConf.style.width=100,t.meta.gridLayoutConf.style.w=100,t.meta.gridLayoutConf.style.x=0,t.meta.gridLayoutConf.style.transform=`translate(0px,${t.meta.gridLayoutConf.style.y}px)`),a((0,v.eX)({dragging:t,destination:null,appendFrom:"pc"}))}const z=Z.type===_&&Z.payload&&Z.payload.nextComponents;if(Z.type!==H){if(!z){const e=I.present;a((0,m.P_)(e))}k.hasUnsavedChanges||a((0,f.if)(!0))}}}const E=C(((e,t)=>({type:_,payload:{nextComponents:e,sync:t}})));function T(e){return(t,a)=>{const{dashboardLayout:n}=a();t(E({[u.M2]:{...n.present[u.M2],meta:{text:e}}}))}}function Z({id:e,style:t}){return(a,n)=>{const{dashboardLayout:o}=n(),{present:r}=o,i=r[e],l={[e]:{...i,meta:{...i.meta,gridLayoutConf:{...i.meta.gridLayoutConf,style:{...i.meta.gridLayoutConf.style,...t}}}}};a(E(l,!0))}}function S({id:e,isFloat:t}){return(a,n)=>{const{dashboardLayout:o}=n(),{present:r}=o,i=r[e],l={[e]:{...i,meta:{...i.meta,gridLayoutConf:{style:{...i.meta.gridLayoutConf.style},isFloat:t}}}};a(E(l))}}function x({id:e,w:t,h:a}){return(n,o)=>{const{dashboardLayout:r}=o(),{present:i}=r,l=i[e];t&&(l.meta.gridLayoutConf.w=t),a&&(l.meta.gridLayoutConf.h=a);const s={[e]:{...l,meta:{...l.meta}}};n(E(s))}}const w="DASHBOARD_TITLE_CHANGED";function A(e){return{type:w,text:e}}const R="DASHBOARD_UPLOAD_URL_CHANGED";function D(e){return{type:R,data:e}}const O="DELETE_COMPONENT",N=C(((e,t,a)=>({type:O,payload:{id:e,parentId:t,sync:a}}))),M="CREATE_COMPONENT",I=C((e=>({type:M,payload:{dropResult:e}}))),L="APPEND_COMPONENT",k=C((e=>({type:L,payload:{dropResult:e}}))),F="CREATE_TOP_LEVEL_TABS",P=C((e=>({type:F,payload:{dropResult:e}}))),$="DELETE_TOP_LEVEL_TABS",U=C((()=>({type:$,payload:{}}))),V="RESIZE_COMPONENT";function q({id:e,width:t,height:a}){return(n,o)=>{const{dashboardLayout:r}=o(),{present:i}=r,l=i[e],s=t&&l.meta.width!==t,c=a&&l.meta.height!==a;if(l&&(s||c)){const o={[e]:{...l,meta:{...l.meta,width:t||l.meta.width,height:a||l.meta.height}}};n(E(o))}}}const H="MOVE_COMPONENT",z=C((e=>({type:H,payload:{dropResult:e}}))),j="HANDLE_COMPONENT_DROP";function B(e){return(t,a)=>{var n;if(e.dragging&&"float"===(null==(n=e.dragging.meta)?void 0:n.layoutType))return void t(z(e));if((0,d.Z)(e,a().dashboardLayout.present))return t((0,l.Dz)((0,i.t)("There is not enough space for this component. Try decreasing its width, or increasing the destination width.")));const{source:o,destination:r}=e,c=r&&r.id===u._4,m=o.id===u.D0,g=a().dashboardLayout.present[u._4],f=g&&g.children?g.children[0]:"";if(c)t(P(e));else if(r&&m)t(I(e));else{if(o.type===s.yR&&r.type===s.yR&&o.id===f&&r.id!==f)return t((0,l.Dz)((0,i.t)("Can not move top level tab into nested tabs")));r&&o&&(r.id!==o.id||r.index!==o.index)&&(t(z(e)),t((0,v.U)(e)))}const{dashboardFilters:y,dashboardLayout:b}=a();if(!m){const{present:e}=b,a=e[o.id]||{},n=e[r.id]||{};if((a.type===s.yR||a.type===s.Os)&&a.children&&0===a.children.length){const a=(0,p.Z)({childId:o.id,layout:e});t(N(o.id,a))}(0,h.Z)({dashboardFilters:y,source:(a.parents||[]).concat(o.id),destination:(n.parents||[]).concat(r.id)})&&t((0,l.Dz)((0,i.t)("This chart has been moved to a different filter scope.")))}return null}}function G(){return(e,t)=>{e(r.zF.undo());const{dashboardLayout:a,dashboardState:n}=t();0!==a.past.length||n.maxUndoHistoryExceeded||n.updatedColorScheme||e((0,f.if)(!1))}}function W(){return(e,t)=>{e(r.zF.clearHistory());const{dashboardLayout:a,dashboardState:n}=t();0!==a.past.length||n.maxUndoHistoryExceeded||n.updatedColorScheme||e((0,f.if)(!1))}}const Y=C(r.zF.redo),K="UPDATE_COMPONENTS_PARENTS_LIST"},909467:(e,t,a)=>{a.d(t,{BD:()=>I,P0:()=>X,bs:()=>me,sm:()=>ge,ec:()=>ye,k5:()=>ve,Ii:()=>te,Vd:()=>L,qJ:()=>ce,hD:()=>se,nV:()=>Le,J$:()=>Ze,R8:()=>at,E9:()=>Ke,Vl:()=>it,iy:()=>Ae,x4:()=>ot,Lg:()=>st,pC:()=>et,FF:()=>Be,RU:()=>xe,$f:()=>G,NW:()=>Q,mq:()=>Fe,r$:()=>Ve,Pl:()=>N,rW:()=>Y,n1:()=>He,BR:()=>De,zI:()=>Me,Iz:()=>Oe,w9:()=>ie,yV:()=>ne,PU:()=>We,ee:()=>D,mD:()=>Je,oJ:()=>_e,ek:()=>H,Z9:()=>F,H9:()=>V,Iw:()=>$e,Be:()=>j,Pi:()=>Ee,Mn:()=>pe,Lb:()=>$,Qt:()=>je,z2:()=>ee,YC:()=>fe,Yy:()=>be,Vv:()=>ae,rL:()=>Te,M8:()=>de,TN:()=>U,dr:()=>q,$_:()=>ke,uW:()=>Se,Pz:()=>Qe,IW:()=>nt,F$:()=>lt,RP:()=>Re,tu:()=>rt,$D:()=>tt,sL:()=>Ge,E2:()=>we,Mb:()=>W,$W:()=>J,GH:()=>Pe,zL:()=>qe,FU:()=>M,YA:()=>K,uN:()=>ze,rE:()=>Ie,ys:()=>Ne,Qo:()=>le,fE:()=>oe,ks:()=>Ye,if:()=>O,ky:()=>Xe,Jn:()=>Ce,WL:()=>z,oY:()=>Ue,Sn:()=>B});var n=a(21090),o=(a(115926),a(431069)),r=a(455867),i=a(355786),l=a(593185),s=a(478161),c=a(935500),u=a(937863),d=a(635854),p=a(998286),h=a(680621),m=a(852838),g=a(672570),f=a(411370);var v=a(643399),y=a(309679),b=a(591877),_=a(797381),C=a(203741),E=a(990605),T=a(641295),Z=a(550810),S=a(781395),x=a(152794),w=a(409531);const A=new Set(["json_metadata","position_json"]);function R(e,t){return t.split(".").reduce(((e,t)=>{const a=null==e?void 0:e[t];return A.has(t)&&a?JSON.parse(a):a}),e)}a(23525);const D="SET_UNSAVED_CHANGES";function O(e){return{type:D,payload:{hasUnsavedChanges:e}}}const N="SET_FULL_STATUS";function M(e){return{type:N,status:e}}const I="ADD_SLICE";const L="REMOVE_SLICE";const k="/superset/favstar/Dashboard",F="TOGGLE_FAVE_STAR";function P(e){return{type:F,isStarred:e}}function $(e){return function(t){return o.Z.get({endpoint:`${k}/${e}/count/`}).then((({json:e})=>{e.count>0&&t(P(!0))})).catch((()=>t((0,g.Gb)((0,r.t)("There was an issue fetching the favorite status of this dashboard.")))))}}function U(e,t){return function(a){const n=t?"unselect":"select";return o.Z.get({endpoint:`${k}/${e}/${n}/`}).then((()=>{a(P(!t))})).catch((()=>a((0,g.Gb)((0,r.t)("There was an issue favoriting this dashboard.")))))}}const V="TOGGLE_PUBLISHED";function q(e,t){return function(a){return o.Z.put({endpoint:`/api/v1/dashboard/${e}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({published:t})}).then((()=>{a((0,g.ws)(t?(0,r.t)("This dashboard is now published"):(0,r.t)("This dashboard is now hidden"))),a(function(e){return{type:V,isPublished:e}}(t))})).catch((()=>{a((0,g.Gb)((0,r.t)("You do not have permissions to edit this dashboard.")))}))}}const H="TOGGLE_EXPAND_SLICE";function z(e){return{type:H,sliceId:e}}const j="UPDATE_CSS";function B(e){return{type:j,css:e}}const G="SET_EDIT_MODE";function W(e){return{type:G,editMode:e}}const Y="SET_LAYOUT_MODE";function K(e){return{type:Y,layoutMode:e}}const Q="SET_EMULATE_TYPE";function J(e){return{type:Q,payload:e}}const X="ON_CHANGE";function ee(){return{type:X}}const te="ON_SAVE";function ae(e){return{type:te,lastModifiedTime:e}}const ne="SET_REFRESH_FREQUENCY";function oe(e,t=!1){return{type:ne,refreshFrequency:e,isPersistent:t}}function re(e){return t=>{t(ae(e)),t(n.zF.clearHistory())}}const ie="SET_OVERRIDE_CONFIRM";function le(e){return{type:ie,overwriteConfirmMetadata:e}}const se="SAVE_DASHBOARD_STARTED";const ce="SAVE_DASHBOARD_FINISHED";function ue(){return{type:ce}}function de(e,t,a,n="",s=(()=>{})){return(s,c)=>{var u,d,Z,D,O,N,M,I,L;s({type:E.x_}),s({type:se});const{dashboardFilters:k,dashboardLayout:F,dashboardState:P}=c(),$=F.present,U=P.dashboardConfig;Object.values(k).forEach((e=>{var t;const{chartId:a}=e,n=e.directPathToFilter.slice().pop(),o=((null==(t=$[n])?void 0:t.parents)||[]).slice();o.push(n),s((0,S.yz)(a,o))}));const V=(0,f.Z)((0,v.De)()),q=function(e){return Object.values(e).reduce(((e,{chartId:t,scopes:a})=>{const n=Object.keys(a).reduce(((e,t)=>({...e,[t]:a[t]})),{});return{...e,[t]:n}}),{})}(k),{certified_by:H,certification_details:z,css:j,dashboard_title:B,third_tags:G,owners:W,roles:Y,slug:K}=e,Q=e=>void 0!==e.id,J=null==(u=e.metadata)?void 0:u.cross_filters_enabled,X={...e,certified_by:H||"",certification_details:H&&z?z:"",css:j||"",dashboard_title:B||(0,r.t)("[ untitled dashboard ]"),third_tags:G||"",owners:(0,i.Z)(W).map((e=>Q(e)?e.id:e)),roles:(0,b.cr)(l.T.DASHBOARD_RBAC)?(0,i.Z)(Y).map((e=>Q(e)?e.id:e)):void 0,slug:K||null,metadata:{...e.metadata,color_namespace:(null==(d=e.metadata)?void 0:d.color_namespace)||void 0,color_scheme:(null==(Z=e.metadata)?void 0:Z.color_scheme)||"",color_scheme_domain:(null==(D=e.metadata)?void 0:D.color_scheme_domain)||[],expanded_slices:(null==(O=e.metadata)?void 0:O.expanded_slices)||{},label_colors:(null==(N=e.metadata)?void 0:N.label_colors)||{},shared_label_colors:(null==(M=e.metadata)?void 0:M.shared_label_colors)||{},refresh_frequency:(null==(I=e.metadata)?void 0:I.refresh_frequency)||0,timed_refresh_immune_slices:(null==(L=e.metadata)?void 0:L.timed_refresh_immune_slices)||[],cross_filters_enabled:(0,m.U)(J)}},ee=()=>{const{dashboardLayout:e,charts:t,dashboardInfo:{metadata:{chart_configuration:a={}}}}=c();return(0,m.g)(e.present,a,t)},te=async e=>{const{error:t,message:a}=await(0,p.O$)(e);let n=(0,r.t)("Sorry, an unknown error occurred");t&&(n=(0,r.t)("Sorry, there was an error saving this dashboard: %s",t)),"string"===typeof a&&"Forbidden"===a&&(n=(0,r.t)("You do not have permission to edit this dashboard")),s(ue()),s((0,g.Gb)(n))};if([h.TN,h.NT].includes(a)){let i={};(0,b.cr)(l.T.DASHBOARD_CROSS_FILTERS)&&(i=ee());const c=a===h.NT?e:{certified_by:X.certified_by,certification_details:X.certification_details,css:X.css,dashboard_title:X.dashboard_title,third_tags:X.third_tags,slug:X.slug,owners:X.owners,roles:X.roles,json_metadata:(0,y.o)({...(null==X?void 0:X.metadata)||{},default_filters:(0,y.o)(V),filter_scopes:q,chart_configuration:i}),mobile_json_metadata:(0,y.o)({...(null==X?void 0:X.mobile_metadata)||{},default_filters:(0,y.o)(V),filter_scopes:q,chart_configuration:i}),dashboard_config:(0,y.o)(U),adaptation_equipment:X.adaptation_equipment},u=()=>o.Z.put({endpoint:`/api/v1/dashboard/${t}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>(e=>{const t=e.json.result,a=e.json.last_modified_time;if("qrcode"===n)return s(ue());if(t.json_metadata){const e=JSON.parse(t.json_metadata);s((0,T.a8)({metadata:e})),e.chart_configuration&&s({type:T.t$,chartConfiguration:e.chart_configuration}),e.native_filter_configuration&&s({type:x.qe,filterConfig:e.native_filter_configuration})}return a&&s(re(a)),s(ue()),s((0,g.ws)((0,r.t)("This dashboard was saved successfully."))),s(le(void 0)),window.flushedtDealList(),e})(e))).catch((e=>te(e)));return new Promise(((e,n)=>{(0,b.cr)(l.T.CONFIRM_DASHBOARD_DIFF)&&a!==h.NT?o.Z.get({endpoint:`/api/v1/dashboard/${t}`}).then((a=>{const o=a.json.result,r=(i=o,l=c,w.yT.map((e=>({keyPath:e,...e.split(".").find((e=>A.has(e)))?{oldValue:JSON.stringify(R(i,e),null,2)||"{}",newValue:JSON.stringify(R(l,e),null,2)||"{}"}:{oldValue:R(i,e)||"",newValue:R(l,e)||""}}))).filter((({oldValue:e,newValue:t})=>e!==t)));var i,l;return r.length>0?(s(le({updatedAt:o.changed_on,updatedBy:o.changed_by_name,overwriteConfirmItems:r,dashboardId:t,data:c})),n(r)):e()})):e()})).then(u).catch((e=>{const a=(0,r.t)("Please confirm the overwrite values.");s((0,_.logEvent)(C.yw,{dashboard_id:t,items:e})),s((0,g.Gb)(a))}))}const ae={...X};ae.metadata&&delete ae.metadata;const ne={...ae,...(null==X?void 0:X.metadata)||{}};return o.Z.post({endpoint:`/superset/copy_dash/${t}/`,postPayload:{data:{...ne,default_filters:(0,y.o)(V),filter_scopes:(0,y.o)(q)}}}).then((e=>(e=>{const t=e.json.last_modified_time;if(t&&s(re(t)),(0,b.cr)(l.T.DASHBOARD_CROSS_FILTERS)){const e=ee();s((0,T.Aw)(e))}return s(ue()),s((0,g.ws)((0,r.t)("This dashboard was saved successfully."))),e})(e))).catch((e=>te(e)))}}function pe(e=[],t=!1,a=0,n){return(o,r)=>{if(!a)return void e.forEach((e=>o((0,c.refreshChart)(e,t,n))));const{metadata:i}=r().dashboardInfo,l=Math.max(a,i.stagger_time||5e3);"boolean"!==typeof i.stagger_refresh&&(i.stagger_refresh=void 0===i.stagger_refresh||"true"===i.stagger_refresh);const s=i.stagger_refresh?l/(e.length-1):0;e.forEach(((e,a)=>{setTimeout((()=>o((0,c.refreshChart)(e,t,n))),s*a)}))}}const he=(e,t,a,n,o)=>new Promise((r=>{o(pe(e,t,a,n)),r()})),me="ON_FILTERS_REFRESH";const ge="ON_FILTERS_REFRESH_SUCCESS";function fe(){return{type:ge}}const ve="ON_REFRESH_SUCCESS";const ye="ON_REFRESH";function be(e=[],t=!1,a=0,n){return o=>{o({type:ye}),he(e,t,a,n,o).then((()=>{o({type:ve}),o({type:me})}))}}const _e="SHOW_BUILDER_PANE";function Ce(){return{type:_e}}function Ee(e,t){return(a,n)=>{const{sliceEntities:o}=n(),r=o.slices[e];if(!r)return a((0,g.Dz)("Sorry, there is no chart definition associated with the chart trying to be added."));const i={...r.form_data,slice_id:r.slice_id},l={...u.u,id:e,form_data:(0,d.oN)(i)};return Promise.all([a((0,c.addChart)(l,e)),a((0,Z.QR)(i.datasource))]).then((()=>{a({type:I,slice:r}),r&&"filter_box"===r.viz_type&&a((0,S.KJ)(e,t,r.form_data))}))}}function Te(e){return(t,a)=>{const n=a().sliceEntities.slices[e];n&&"filter_box"===n.viz_type&&t((0,S.ku)(e)),t({type:L,sliceId:e}),t((0,c.removeChart)(e)),(0,s.ZP)().removeSlice(e)}}const Ze="SET_COLOR_SCHEME";function Se(e){return{type:Ze,colorScheme:e}}const xe="SET_DIRECT_PATH";function we(e){return{type:xe,path:e}}const Ae="SET_DASHBOARD_DRAWER_STATUS";function Re(e){return{type:Ae,drawerStatus:e}}const De="SET_MOBILE_FILTER_CHANGE";const Oe="SET_MOBILE_FILTER_TYPE";function Ne(e){return{type:Oe,mobileFilterType:e}}const Me="SET_MOBILE_FILTER_STATUE";function Ie(e){return{type:Me,mobileFilterStatus:e}}const Le="SET_ACTIVE_TABS";function ke(e,t){return{type:Le,tabId:e,prevTabId:t}}const Fe="SET_FOCUSED_FILTER_FIELD";function Pe(e,t){return{type:Fe,chartId:e,column:t}}const $e="UNSET_FOCUSED_FILTER_FIELD";function Ue(e,t){return{type:$e,chartId:e,column:t}}const Ve="SET_FULL_SIZE_CHART_ID";function qe(e){return{type:Ve,chartId:e}}const He="SET_MAX_UNDO_HISTORY_EXCEEDED";function ze(e=!0){return{type:He,payload:{maxUndoHistoryExceeded:e}}}function je(){return(e,t)=>{const{dashboardLayout:a}=t(),n=a.past.length;return e((0,g.Dz)((0,r.t)("You have used all %(historyLength)s undo slots and will not be able to fully undo subsequent actions. You may save your current state to reset the history.",{historyLength:n})))}}const Be="SET_DATASETS_STATUS";function Ge(e){return{type:Be,status:e}}const We="SET_SHOW_COMPONENT_PROPERTY_PANE";function Ye(e){return{type:We,componentId:e}}const Ke="SET_DASHBOARD_CONFIG";function Qe(e){return(t,a)=>{const n={};return e.componentMargin&&(n.component_margin=e.componentMargin),e.backgroundType&&(n.background_type=e.backgroundType),e.backgroundFilterType&&(n.background_filter_type=e.backgroundFilterType),e.backgroundColor&&(n.background_type="color",n.background_color=e.backgroundColor),e.backgroundFilterColor&&(n.background_filter_type="color",n.background_filter_color=e.backgroundFilterColor),e.fontFamily_Filter&&(n.fontFamily_Filter_Family=e.fontFamily_Filter),e.fontSize_Filter&&(n.fontSize_Filter_Size=e.fontSize_Filter),e.fontWeight_Filter&&(n.fontWeight_Filter_Weight=e.fontWeight_Filter),e.textColor_Filter&&(n.textColor_Filter_Color=e.textColor_Filter),e.defaultFilterConditionNumber&&(n.default_filter_condition_number=e.defaultFilterConditionNumber),e.backgroundImage&&(n.background_type="image",n.background_image=e.backgroundImage),e.backgroundFilterImage&&(n.background_filter_type="image",n.background_filter_image=e.backgroundFilterImage),e.layoutType&&(n.layout_type=e.layoutType),e.layoutMode&&(n.layout_mode=e.layoutMode),t((0,T.C1)(n)),{type:Ke,config:e}}}const Je="SET_VIEW_TYPE";function Xe(e){return{type:Je,viewType:e}}const et="SET_DASHBOARD_SHARE";function tt(e){return{type:et,dashboardShare:e}}const at="SET_DASHBOARD_COMPONENT_TARGET";function nt(e){return{type:at,target:e}}const ot="SET_DASHBOARD_FLOAT_COMPONENTS";function rt(e=[]){return{type:ot,components:e}}const it="SET_DASHBOARD_CONFIG_OLD";function lt(e={}){return{type:it,config:e}}const st="SET_DASHBOARD_RATIOX"},182140:(e,t,a)=>{a.d(t,{$:()=>z,Y:()=>j});var n=a(150361),o=a.n(n),r=a(311064),i=a(616355),l=a(937863),s=a(437927),c=a(239759),u=a(635854),d=a(643399),p=(a(212617),a(653002),a(852838)),h=a(839023),m=a(680621),g=a(81255);var f,v=a(674547),y=a(153046),b=a(156967),_=a(128428),C=a(492496),E=a(427600),T=a(23525),Z=a(269856),S=a(242190),x=a(591877),w=a(593185),A=a(870400),R=a(441609),D=a.n(R),O=a(313311),N=a.n(O),M=a(714670),I=a.n(M),L=a(10916);!function(e){e.FILTER_TIME="filter_time",e.FILTER_TIMEGRAIN="filter_timegrain",e.FILTER_TIMECOLUMN="filter_timecolumn",e.FILTER_SELECT="filter_select",e.FILTER_RANGE="filter_range"}(f||(f={}));const k=(e,t)=>D()(e)?D()(t)?[]:[t]:[e];function F(e=[],t={},a={}){const n=[],o={};e.forEach((e=>{const r=String(e.slice_id);if("filter_box"===e.form_data.viz_type){o[r]={};const l=(0,y.Z)(e.form_data);let{columns:s}=l;a[r]&&Object.keys(s).forEach((e=>{a[r][e]&&(s={...s,[e]:a[r][e]})}));const c=Object.keys(s).reduce(((e,a)=>{const n={...t[r]},{scope:o,immune:i}={...h.GI,...n[a]};return{...e,[a]:{scope:o,immune:i}}}),{}),{adhoc_filters:u=[],datasource:d="",date_filter:p=!1,filter_configs:m=[],granularity_sqla:g,show_sqla_time_column:v=!1,show_sqla_time_granularity:b=!1,time_grain_sqla:_,time_range:C}=e.form_data,E=(i=a,(e,t)=>{var a;return null!=(a=i[e])&&a[t]?i[e][t]:null});if(p){const{scope:e,immune:t}=c[Z.i2.time_range]||h.GI,a={id:`NATIVE_FILTER-${I().generate()}`,description:"time range filter",controlValues:{},name:Z.m_.time_range,filterType:f.FILTER_TIME,targets:[{}],cascadeParentIds:[],defaultDataMask:{},type:L.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};o[r][Z.i2.time_range]=a.id;const i=E(r,Z.i2.time_range)||C;if(D()(i)||(a.defaultDataMask={extraFormData:{time_range:i},filterState:{value:i}}),n.push(a),b){const{scope:e,immune:t}=c[Z.i2.time_grain_sqla]||h.GI,a={id:`NATIVE_FILTER-${I().generate()}`,controlValues:{},description:"time grain filter",name:Z.m_.time_grain_sqla,filterType:f.FILTER_TIMEGRAIN,targets:[{datasetId:parseInt(d.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:L.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};o[r][Z.i2.time_grain_sqla]=a.id;const i=E(r,Z.i2.time_grain_sqla);D()(i)||(a.defaultDataMask={extraFormData:{time_grain_sqla:i||_},filterState:{value:k(i,_)}}),n.push(a)}if(v){const{scope:e,immune:t}=c[Z.i2.granularity_sqla]||h.GI,a={id:`NATIVE_FILTER-${I().generate()}`,description:"time column filter",controlValues:{},name:Z.m_.granularity_sqla,filterType:f.FILTER_TIMECOLUMN,targets:[{datasetId:parseInt(d.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:L.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};o[r][Z.i2.granularity_sqla]=a.id;const i=E(r,Z.i2.granularity_sqla);D()(i)||(a.defaultDataMask={extraFormData:{granularity_sqla:i||g},filterState:{value:k(i,g)}}),n.push(a)}}m.forEach((e=>{const{scope:t,immune:a}=c[e.column]||h.GI,i={id:`NATIVE_FILTER-${I().generate()}`,description:"",controlValues:{enableEmptyFilter:!e[Z.ft.CLEARABLE],defaultToFirstItem:!1,inverseSelection:!1,multiSelect:e[Z.ft.MULTIPLE],sortAscending:e[Z.ft.SORT_ASCENDING]},name:e.label||e.column,filterType:f.FILTER_SELECT,targets:[{datasetId:parseInt(d.split("__")[0],10),column:{name:e.column}}],cascadeParentIds:[],defaultDataMask:{},type:L.BE.NATIVE_FILTER,scope:{rootPath:t,excluded:a},adhoc_filters:u,sortMetric:e[Z.ft.SORT_METRIC],time_range:C};o[r][e.column]=i.id;const l=E(r,e.column)||(e=>{let t=e[Z.ft.DEFAULT_VALUE];return""===t&&(t=null),t&&e[Z.ft.MULTIPLE]&&(t=e.defaultValue.split(";")),t})(e);D()(l)||(i.defaultDataMask={extraFormData:{filters:[{col:e.column,op:"IN",val:l}]},filterState:{value:l}}),n.push(i)}))}var i}));const r=(e=>{const t={},a=Object.keys(e).map((e=>parseInt(e,10)));return Object.entries(e).forEach((([e,n])=>{t[e]={},Object.entries(n).forEach((([n,o])=>{t[e][n]=(0,d.up)({filterScope:o}).filter((t=>a.includes(t)&&String(t)!==e))}))})),t})(t);return Object.entries(r).forEach((([e,t])=>{Object.entries(t).forEach((([t,a])=>{const r=o[e][t];a.forEach((e=>{Object.values(o[e]).forEach((e=>{const t=N()(n,(({id:t})=>t===e));t&&[f.FILTER_SELECT,f.FILTER_RANGE].includes(t.filterType)&&(t.cascadeParentIds=t.cascadeParentIds||[],t.cascadeParentIds.push(r))}))}))}))})),n}var P=a(641295),$=a(732873),U=a(437418),V=a(52004),q=a(489293);const H=(0,a(454076).cz)(),z="HYDRATE_DASHBOARD",j=({history:e,dashboard:t,charts:a,filterboxMigrationState:n=Z.Qi.NOOP,dataMask:f,activeTabs:R})=>(D,O)=>{var N,M,I,L,k,j;const{user:B,common:G,dashboardState:W}=O(),{metadata:Y,position_data:K,mobile_metadata:Q,mobile_position_data:J,dashboard_config:X,perm:ee=1}=t,te=(0,A.Z)("regular"),ae="true"===(0,A.Z)("reserved").edit;let ne={};try{ne=JSON.parse(X)}catch(e){}let oe={};a.forEach((e=>{e.slice_id=e.form_data.slice_id}));try{oe=(0,T.eY)(E.KD.preselectFilters)||JSON.parse(Y.default_filters)}catch(e){}null!=Y&&Y.shared_label_colors&&(0,P.fO)(Y,null==Y?void 0:Y.shared_label_colors),null!=Y&&Y.label_colors&&(0,P.fO)(Y,null==Y?void 0:Y.label_colors);const re=K&&Object.keys(K).length>0?K:(0,v.ZP)(),ie=J&&Object.keys(J).length>0?J:null,le=(0,v.Fo)(re,ie||{}),se={};Object.values(re).forEach((e=>{e.type===g.dW&&(se[e.meta.chartId]=e.id)}));const ce=function(e={}){let t=e[m._4];t=t&&t.children.length&&e[t.children[0]].type===g.yR?e[e[t.children[0]].children[0]]:e[t.children[0]];return t.id}(re),ue=re[ce];let de,pe=0;const he=(null==Y?void 0:Y.filter_scopes)||{},me={},ge={},fe={},ve=new Set,ye=new Map;a.forEach((e=>{const t=e.slice_id,a={...e.form_data,url_params:{...e.form_data.url_params,...te}};if(me[t]={...l.u,id:t,form_data:(0,u.oN)(a)},fe[t]={slice_id:t,slice_url:e.slice_url,slice_name:e.slice_name,form_data:e.form_data,viz_type:e.form_data.viz_type,datasource:e.form_data.datasource,description:e.description,description_markeddown:e.description_markeddown,owners:e.owners,modified:e.modified,changed_on:new Date(e.changed_on).getTime(),perm:e.perm},ve.add(t),!se[t]&&re[ce]){var o;(0===pe||pe+m.fw>H)&&(de=(0,_.Z)(g.Os,(ue.parents||[]).slice()),re[de.id]=de,ue.children.push(de.id),pe=0);const t=(0,_.Z)(g.dW,{chartId:e.slice_id},(de.parents||[]).slice()),a=(null!=(o=ye.get(e.slice_id))?o:0)+1;t.id=`${g.dW}-explore-${e.slice_id}-${a}`,ye.set(e.slice_id,a),re[t.id]=t,de.children.push(t.id),se[t.meta.chartId]=t.id,pe+=m.fw}if("filter_box"===e.form_data.viz_type){const a=(0,y.Z)(e.form_data);let{columns:o}=a;const{labels:r}=a;oe[t]&&Object.keys(o).forEach((e=>{oe[t][e]&&(o={...o,[e]:oe[t][e]})}));const i=Object.keys(o).reduce(((e,a)=>{const n={...he[t]},{scope:o,immune:r}={...h.GI,...n[a]};return{...e,[a]:{scope:o,immune:r}}}),{}),l=se[t],s=(re[l].parents||[]).slice();s.push(l),[Z.Qi.NOOP,Z.Qi.SNOOZED].includes(n)&&(ge[t]={...h.Mj,chartId:t,componentId:l,datasourceId:e.form_data.datasource,filterName:e.slice_name,directPathToFilter:s,columns:o,labels:r,scopes:i,isDateFilter:Object.keys(o).includes(C.TIME_RANGE)})}const r=se[t];r&&re[r]&&(re[r].meta.sliceName=e.slice_name)})),Object.values(re).some((e=>e.id!==m._4&&!e.parents))&&(0,U.Z)({currentComponent:re[m._4],layout:re}),(0,d.DU)({dashboardFilters:ge,components:re}),re[m.M2]={id:m.M2,type:g.Vl,meta:{text:t.dashboard_title}};const be={past:[],present:re,future:[]};let _e=ie||le[0]||{};Object.keys(re||{}).forEach((e=>{if(!_e[e]&&(null==e?void 0:e.indexOf("CHART-"))>-1){var t,a;const n={dragging:o()(re[e]),destination:o()(re.GRID_ID)},r=(0,q.Z)({dropResult:n,layout:re,mobile:!0});delete r.GRID_ID;const i=Object.keys(r).filter((e=>(null==e?void 0:e.indexOf("ROW-"))>-1));_e.GRID_ID||(_e.GRID_ID=o()(re.GRID_ID));const l=(null==(t=_e)||null==(a=t.GRID_ID)?void 0:a.children)||[];_e.GRID_ID.children=[...l,...i],_e={..._e,...r}}}));const Ce={...be,present:_e},Ee=(0,T.eY)(E.KD.dashboardFocusedChart);let Te;if(Ee){const t=Object.values(be.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===Ee}));Te=null==t?void 0:t.id;const a=new URLSearchParams(window.location.search);a.delete(E.KD.dashboardFocusedChart.name),e.replace({search:a.toString()})}const Ze=Te||(0,b.Z)();let Se=W.directPathToChild||[];re[Ze]&&(Se=(re[Ze].parents||[]).slice(),Se.push(Ze));let xe=(null==Y?void 0:Y.native_filter_configuration)||[];n===Z.Qi.REVIEWING&&(xe=F(a,he,oe),Y.native_filter_configuration=xe,Y.show_native_filters=!0);const we=(0,c.a)({filterConfig:xe});Y.show_native_filters=null!=(N=null==t||null==(M=t.metadata)?void 0:M.show_native_filters)?N:(0,x.cr)(w.T.DASHBOARD_NATIVE_FILTERS)&&[Z.Qi.CONVERTED,Z.Qi.REVIEWING,Z.Qi.NOOP].includes(n),(0,x.cr)(w.T.DASHBOARD_CROSS_FILTERS)&&Object.values(be.present).forEach((e=>{var t,a,n,o,l,s;const c=null==(t=e.meta)?void 0:t.chartId,u=null!=(a=null==(n=null!=(o=(0,r.Z)().get(null==(l=me[c])||null==(s=l.form_data)?void 0:s.viz_type))?o:{})?void 0:n.behaviors)?a:[];Y.chart_configuration||(Y.chart_configuration={}),u.includes(i.cg.INTERACTIVE_CHART)&&(Y.chart_configuration[c]||(Y.chart_configuration[c]={id:c,crossFilters:{scope:{rootPath:[m._4],excluded:[c]}}}),Y.chart_configuration[c].crossFilters.chartsInScope=(0,$.Q)(Y.chart_configuration[c].crossFilters.scope,me,be.present)),u.includes(i.cg.INTERACTIVE_CHART)&&!Y.chart_configuration[c]&&(Y.chart_configuration[c]={id:c,crossFilters:{scope:{rootPath:[m._4],excluded:[c]}}})}));const Ae=(null==(I=be.present[m._4])||null==(L=I.config)?void 0:L.floats)||[],Re=(null==(k=be.present[m._4])||null==(j=k.config)?void 0:j.fitConfig)||{mode:"auto"},{roles:De}=B,Oe=(sessionStorage.getItem("isperm"),ee>=4),Ne=ee>=4,Me=ee>=2,Ie=ee>=2,Le=ee>=2,ke=ee>=2,Fe=(0,p.U)(Y.cross_filters_enabled);return D({type:z,data:{sliceEntities:{...s.b,slices:fe,isLoading:!1},charts:me,dashboardInfo:{...t,metadata:Y,userId:B.userId?String(B.userId):null,dash_edit_perm:Oe,dash_save_perm:Ne,dash_share_perm:Me,superset_can_explore:Ie,superset_can_share:Le,superset_can_csv:ke,slice_can_edit:Oe,common:{flash_messages:null==G?void 0:G.flash_messages,conf:null==G?void 0:G.conf},filterBarOrientation:(0,x.cr)(w.T.HORIZONTAL_FILTER_BAR)&&Y.filter_bar_orientation||V.Bp.VERTICAL,crossFiltersEnabled:Fe},dataMask:f,dashboardFilters:ge,nativeFilters:we,dashboardState:{preselectNativeFilters:(0,T.eY)(E.KD.nativeFilters),sliceIds:Array.from(ve),directPathToChild:Se,directPathLastUpdated:Date.now(),focusedFilterField:null,expandedSlices:(null==Y?void 0:Y.expanded_slices)||{},refreshFrequency:(null==Y?void 0:Y.refresh_frequency)||0,shouldPersistRefreshFrequency:!1,css:t.css||"",colorNamespace:(null==Y?void 0:Y.color_namespace)||null,colorScheme:(null==Y?void 0:Y.color_scheme)||null,editMode:Oe&&ae,isPublished:t.published,hasUnsavedChanges:!1,dashboardIsSaving:!1,maxUndoHistoryExceeded:!1,lastModifiedTime:t.changed_on,isRefreshing:!1,isFiltersRefreshing:!1,activeTabs:R||(null==W?void 0:W.activeTabs)||[],filterboxMigrationState:n,datasetsStatus:S.ni.LOADING,dashboardConfig:ne,dashboardConfig_old:{floats:Ae,fitConfig:Re}},mobileDashboardStandby:le[1],dashboardLayout:be,mobileDashboardLayout:Ce}})}},974713:(e,t,a)=>{a.d(t,{CB:()=>A,G8:()=>x,Hj:()=>E,Is:()=>Z,Iz:()=>w,J0:()=>N,L1:()=>q,LM:()=>M,Mu:()=>k,TE:()=>D,U:()=>V,WZ:()=>_,YA:()=>I,_p:()=>H,aZ:()=>U,bK:()=>S,eX:()=>O,g3:()=>F,iO:()=>$,kh:()=>T,nj:()=>v,qL:()=>P,v7:()=>R,x_:()=>z});var n=a(21090),o=a(455867),r=a(672570),i=a(81255),l=a(680621),s=a(973830),c=a(995173),u=a(948461),d=a(781395),p=a(909467),h=a(314824),m=a(674547),g=a(990605);a(974713);const f=(0,a(454076).cz)(),v="MOBILE_UPDATE_COMPONENTS";function y(e){return(...t)=>(a,n)=>{var s,c,u,h,y,C;const E=e(...t);if((null==E?void 0:E.type)===N&&"TABS"===(null==(s=E.payload)||null==(c=s.dropResult)||null==(u=c.dragging)?void 0:u.type)&&"TAB"===(null==(h=E.payload)||null==(y=h.dropResult)||null==(C=y.destination)?void 0:C.type))return a((0,r.Dz)((0,o.t)("Only one layer of tabs can be nested")));const{mobileDashboardLayout:T,dashboardState:Z}=n();var S;if("object"===typeof E&&E.type===D&&null==(null==(S=E.payload.dropResult)?void 0:S.destination)){var x;E.payload.dropResult.destination=function(e,t){let a=e[l.PV];if(e[l._4].children[0]&&e[e[l._4].children[0]].type===i.yR){const n=e[e[l._4].children[0]].children.find((e=>t.activeTabs.some((t=>t===e))));n&&(a=e[n])}return a}(T.present,Z);const e=[i.yR],t=null==(x=E.payload.dropResult.dragging)?void 0:x.type;if("pc"===E.payload.dropResult.appendFrom&&!e.includes(t)){var w;const e=E.payload.dropResult.dragging||{},{parents:t=[]}=e,n=t.find((e=>e.indexOf("ROW-")>-1)),o=T.present||{};let r=f;const i=(null==(w=o[n])?void 0:w.children)||[];let l=0;var R;if(i.forEach((e=>{var t,a;const n=(null==(t=o[e])||null==(a=t.meta)?void 0:a.width)||0;l+=n})),l>=f-1)((null==(R=o[n])?void 0:R.children)||[]).forEach((e=>{var t,n;const i=.5*((null==(t=o[e])||null==(n=t.meta)?void 0:n.width)||0);r-=i;const l=o[e]||{},s={[e]:{...l,meta:{...l.meta,width:i}}};a(_(s))}));else r=f-l;E.payload.dropResult.dragging.meta.width=r}}"object"===typeof E&&E.type===A&&b(E.payload.id,T.present),a("function"===typeof E?E(a,n):E);const{mobileDashboardLayout:O}=n();if("object"!==typeof E||E.type!==A||E.payload.sync||a((0,g.v7)(E.payload.id,null,!0)),"object"!==typeof E||E.type!==v||E.payload.sync||a((0,g.WZ)((0,m.cw)(E.payload.nextComponents),!0)),(null==E?void 0:E.type)===N||(null==E?void 0:E.type)===I){const e=(0,m.ag)(O.present,T.present);e&&a((0,g.eX)({dragging:e,destination:null,appendFrom:"mobile"}))}const M=E.type===v&&E.payload&&E.payload.nextComponents;if(E.type!==U){if(!M){const e=O.present;a((0,d.P_)(e))}Z.hasUnsavedChanges||a((0,p.if)(!0))}}}function b(e,t){const a=[],n=null==t?void 0:t[e];if(n){(0,m.nz)(n)&&a.push({...n,children:[]});const{children:e}=n;null==e||null==e.forEach||e.forEach((e=>{a.push(...b(e,t))}))}return a}const _=y(((e,t)=>({type:v,payload:{nextComponents:e,sync:t}})));function C(e,t){var a,n,o;return{...e,meta:{...e.meta,gridLayoutConf:{...null==(a=e.meta)?void 0:a.gridLayoutConf,style:{...null==(n=e.meta)||null==(o=n.gridLayoutConf)?void 0:o.style,...t}}}}}function E({id:e,style:t}){return(a,n)=>{const{mobileDashboardLayout:o}=n(),{present:r}=o,i=r[e],l={[e]:C(i,t)};a(_(l,!0))}}function T(e){return(t,a)=>{const{mobileDashboardLayout:n}=a(),{present:o}=n,r={};for(let t=0;t<e.length;t++){const{id:a,style:n}=e[t],i=o[a];r[a]=C(i,n)}t(_(r,!0))}}function Z({id:e,w:t,h:a}){return(n,o)=>{const{mobileDashboardLayout:r}=o(),{present:i}=r,l=i[e];t&&(l.meta.gridLayoutConf.w=t),a&&(l.meta.gridLayoutConf.h=a);const s={[e]:{...l,meta:{...l.meta}}};n(_(s))}}const S="MOBILE_DASHBOARD_TITLE_CHANGED";const x="DASHBOARD_UPLOAD_URL_CHANGED";function w(e){return{type:x,data:e}}const A="MOBILE_DELETE_COMPONENT",R=y(((e,t,a)=>({type:A,payload:{id:e,parentId:t,sync:a}}))),D="MOBILE_APPEND_COMPONENT",O=y((e=>({type:D,payload:{dropResult:e}}))),N="MOBILE_CREATE_COMPONENT",M=y((e=>({type:N,payload:{dropResult:e}}))),I="MOBILE_CREATE_TOP_LEVEL_TABS",L=y((e=>({type:I,payload:{dropResult:e}}))),k="MOBILE_DELETE_TOP_LEVEL_TABS",F=y((()=>({type:k,payload:{}}))),P="MOBILE_RESIZE_COMPONENT";function $({id:e,width:t,height:a}){return(n,o)=>{const{mobileDashboardLayout:r}=o(),{present:i}=r,l=i[e],s=t&&l.meta.width!==t,c=a&&l.meta.height!==a;if(l&&(s||c)){const o={[e]:{...l,meta:{...l.meta,width:t||l.meta.width,height:a||l.meta.height}}};n(_(o))}}}const U="MOBILE_MOVE_COMPONENT",V=y((e=>({type:U,payload:{dropResult:e}}))),q="MOBILE_HANDLE_COMPONENT_DROP";function H(e){return(t,a)=>{var n;if(e.dragging&&"float"===(null==(n=e.dragging.meta)?void 0:n.layoutType))return void t(V(e));const d=(0,s.Z)(e,a().mobileDashboardLayout.present),{source:p,destination:m,dragging:f}=e;var v,y;if(d&&!f.type.includes("FILTER_")&&"grid"!==(null==(v=a().dashboardInfo)||null==(y=v.metadata)?void 0:y.layout_type))return t((0,r.Dz)((0,o.t)("There is not enough space for this component. Try decreasing its width, or increasing the destination width.")));const b=m&&m.id===l._4,_=p.id===l.D0,C=p.id===l.Nz,E=a().mobileDashboardLayout.present[l._4],T=E&&E.children?E.children[0]:"";if(b)t(L(e));else if(m&&_)t(M(e));else if(m&&C){const{mobileDashboardLayout:n}=a(),{present:o}=n,r=o[m.id]||{},i=e.dragging;t((0,h.vL)(i.id)),t(O({dragging:i,destination:r}))}else{if(p.type===i.yR&&m.type===i.yR&&p.id===T&&m.id!==T)return t((0,r.Dz)((0,o.t)("Can not move top level tab into nested tabs")));m&&p&&(m.id!==p.id||m.index!==p.index)&&(t(V(e)),t((0,g.moveComponent)(e)))}const{dashboardFilters:Z,mobileDashboardLayout:S}=a();if(!_){const{present:e}=S,a=e[p.id]||{},n=e[m.id]||{};if((a.type===i.yR||a.type===i.Os)&&a.children&&0===a.children.length){const a=(0,c.Z)({childId:p.id,layout:e});t(R(p.id,a))}(0,u.Z)({dashboardFilters:Z,source:(a.parents||[]).concat(p.id),destination:(n.parents||[]).concat(m.id)})&&t((0,r.Dz)((0,o.t)("This chart has been moved to a different filter scope.")))}return null}}y(n.zF.redo);const z="MOBILE_UPDATE_COMPONENTS_PARENTS_LIST"},68969:(e,t,a)=>{a.d(t,{D2:()=>i,Fv:()=>p,OF:()=>c,To:()=>d,_t:()=>g,cK:()=>s,lf:()=>o,t4:()=>m,uC:()=>h});var n=a(431069);a(115926),a(672570),a(998286);const o="SET_ALL_SLICES";function r(e){return{type:o,payload:{slices:e}}}const i="FETCH_ALL_SLICES_STARTED";function l(){return{type:i}}const s="FETCH_ALL_SLICES_FAILED";const c="SET_SLICE_DETAILS";function u(e,t,a,n="changed_on",o={}){const i={};return e.forEach((e=>{i[e.slice_id]={slice_id:e.slice_id,slice_url:e.url,slice_name:e.slice_name,datasource_type:e.datasource_type,changed_on:e.changed_on}})),t(r(i))}function d(e){return(t,a)=>{const{sliceEntities:n}=a();return 0===n.lastUpdated?(t(l()),u(e,t)):t(r(n.slices))}}function p(e){return t=>(t(l()),u(void 0,t,0,e))}function h(e){return(e,t)=>{e(l());const{sliceEntities:a}=t();return u(void 0,e,0,void 0,a.slices)}}function m(e){return(t,a)=>{const{sliceEntities:o}=a(),i=o.slices[e];if(i&&!i.viz_type)return function(e,t,a){return n.Z.get({endpoint:`/api/v1/explore/?slice_id=${e}`}).then((({json:n})=>{const{result:o}=n,i=t[e],l={datasource_name:o.dataset.name,datasource_id:o.dataset.id,datasource_url:o.slice.datasource_url,changed_on_humanized:o.slice.changed_on_humanized,thumbnail_url:o.slice.thumbnail_url,viz_type:o.form_data.viz_type,form_data:{...o.form_data,datasource:o.dataset.uid},dataset:o.dataset};return t[e]={...i,...l},a(r(t)),t[e]}))}(e,o.slices,t)}}function g(e,t){return(a,n)=>{const{sliceEntities:o}=n(),r=o.slices[e];return"pivot_table_v2"===r.viz_type?r.form_data.groupbyColumns=t:r.form_data.groupby=t,function(e,t){return{type:c,sliceId:e,slice:t}}(e,r)}}},555453:(e,t,a)=>{a.d(t,{Z:()=>l});a(667294);var n=a(751995),o=a(226618),r=a(211965);const i=n.iK.div`
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  padding: ${o.o3}px;
  background-color: white;
  border-radius: 10px 0 0 10px;
`,l=e=>{const{children:t}=e;return(0,r.tZ)(i,null,t)}},246789:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(667294),o=a(981945),r=a(751995),i=a(226618),l=a(211965);const s=(0,r.iK)(o.zx)`
  & {
    width: 100%;
    padding-inline: 6px;
  }
`,c=r.iK.div`
  // position: absolute;
  bottom: 16px;
  // width: calc(100% - ${2*i.o3}px);
  display: flex;
  justify-content: flex-end;
`,u=e=>{const{onCancel:t=(()=>{}),onConfirm:a=(()=>{}),onRest:o=(()=>{}),btnList:r=[]}=e;return(0,l.tZ)(c,null,r&&r.length>0?r:(0,l.tZ)(n.Fragment,null,(0,l.tZ)(s,{size:"small",onClick:o,style:{marginRight:16}},"\u91cd\u7f6e"),(0,l.tZ)(s,{size:"small",onClick:a,color:"primary"},"\u4fdd\u5b58")))}},401498:(e,t,a)=>{a.d(t,{Z:()=>l});a(667294);var n=a(751995),o=a(226618),r=a(211965);const i=n.iK.div`
  text-align: center;
  // padding: 0px 0px ${o.o3}px 0px;
  padding: 0px 0px 10px 0px;
  font-size: 18px;
  // font-weight: 700;
`,l=e=>{const{text:t=""}=e;return(0,r.tZ)(i,null,t)}},226618:(e,t,a)=>{a.d(t,{Fu:()=>r,H5:()=>n,hR:()=>l,k2:()=>s,o3:()=>o,zP:()=>i});const n="mobile-container-box",o=16,r="rgb(217 232 249)",i="rgb(7 105 255)",l="#f0f2f5",s="#000000"},839023:(e,t,a)=>{a.d(t,{GI:()=>u,Mj:()=>d,ZP:()=>h});var n=a(781395),o=a(182140),r=a(492496),i=a(680621),l=a(153046),s=a(643399),c=a(820194);const u={scope:[i._4],immune:[]},d={chartId:null,componentId:null,filterName:null,datasourceId:null,directPathToFilter:[],isDateFilter:!1,isInstantFilter:!0,columns:{},labels:{},scopes:{}},p=[n.fK,n.l3,n.oW];function h(e={},t){const a={[n.fK](){const{chartId:e,component:a,form_data:n}=t,{columns:o,labels:i}=(0,l.Z)(n),s=Object.keys(o).reduce(((e,t)=>({...e,[t]:u})),{}),c=a?(a.parents||[]).slice().concat(a.id):[];return{...d,chartId:e,componentId:a.id,datasourceId:n.datasource,filterName:a.meta.sliceName,directPathToFilter:c,columns:o,labels:i,scopes:s,isInstantFilter:!!n.instant_filtering,isDateFilter:Object.keys(o).includes(r.TIME_RANGE)}},[n.oW](e){const{newSelectedValues:a,merge:n}=t,{onlydash:o}=t;if(o){return{...e,columns:a}}const r=Object.keys(a).reduce(((e,t)=>{if(!n||!(t in e))return{...e,[t]:a[t]};if(void 0===e[t]||!Array.isArray(e[t])){let n=[];return n=Array.isArray(a[t])?[...a[t]]:a[t],{...e,[t]:n}}return{...e,[t]:[...e[t],...a[t]]}}),{...e.columns});return{...e,columns:r}},[n.oT](e){const{path:a}=t;return{...e,directPathToFilter:a}}};if(t.type===n.ib)return(0,s.DU)({dashboardFilters:e,components:t.components}),e;if(t.type===n.cK){const a=t.scopes,n=Object.entries(a).reduce(((e,t)=>{const[a,{scope:n,immune:o}]=t,{chartId:r,column:i}=(0,c._)(a),l={...e[r].scopes,[i]:{scope:n,immune:o}};return{...e,[r]:{...e[r],scopes:l}}}),e);return(0,s.DU)({dashboardFilters:n}),n}if(t.type===n.l3){const{chartId:a}=t,{[a]:n,...o}=e;return(0,s.DU)({dashboardFilters:o}),o}if(t.type===o.$)return t.data.dashboardFilters;if(t.type in a){const n={...e,[t.chartId]:a[t.type](e[t.chartId])};return p.includes(t.type)&&(0,s.DU)({dashboardFilters:n}),n}return e}},437927:(e,t,a)=>{a.d(t,{Z:()=>l,b:()=>i});var n=a(455867),o=a(68969),r=a(182140);const i={slices:{},isLoading:!0,errorMessage:null,lastUpdated:0};function l(e=i,t){const a={[r.$]:()=>({...t.data.sliceEntities}),[o.D2]:()=>({...e,isLoading:!0}),[o.lf]:()=>({...e,isLoading:!1,slices:{...e.slices,...t.payload.slices},lastUpdated:(new Date).getTime()}),[o.cK]:()=>({...e,isLoading:!1,lastUpdated:(new Date).getTime(),errorMessage:t.payload.error||(0,n.t)("Could not fetch all saved charts")}),[o.OF]:()=>({...e,slices:{...e.slices,[t.chartId]:t.slice}})};return t.type in a?a[t.type]():e}},643399:(e,t,a)=>{a.d(t,{DU:()=>E,De:()=>y,Z3:()=>b,_f:()=>_,up:()=>C});var n=a(958809),o=a.n(n),r=a(108816),i=a.n(r),l=a(283927),s=a.n(l),c=a(441609),u=a.n(c),d=a(820194),p=a(81255),h=a(839023);let m=[],g={},f={},v={};function y(){return g}function b(e){return m.includes(e)}function _(e,t){if(!(e in f)){const a=Object.entries(t||g).filter((([,{scope:t}])=>t.includes(e)));f[e]=i()(o()((([e])=>(0,d._)(e).column)),s()((([,{values:e}])=>e)))(a)}return f[e]}function C({filterScope:e}){function t(e=[],a={},n=[]){a&&(a.type===p.dW&&a.meta&&a.meta.chartId&&!n.includes(a.meta.chartId)?e.push(a.meta.chartId):a.children&&a.children.forEach((a=>t(e,v[a],n))))}const a=[],{scope:n,immune:o}=e||h.GI;return n.forEach((e=>t(a,v[e],o))),a}function E({dashboardFilters:e={},components:t={}}){m=Object.values(e).map((e=>e.chartId)),u()(t)||(v=t),f={},g=Object.values(e).reduce(((e,t)=>{const{chartId:a,columns:n,scopes:o}=t,r={};return Object.keys(n).forEach((e=>{if(Array.isArray(n[e])?n[e].length:void 0!==n[e]){const t=C({filterScope:o[e]}).filter((e=>a!==e));r[(0,d.w)({chartId:a,column:e})]={values:n[e],scope:t}}})),{...e,...r}}),{})}},973830:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(347456);function o(e,t){const a=(0,n.Z)({dropResult:e,layout:t});return"number"===typeof a&&a<0}},347456:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(680621),o=a(995173),r=a(272673),i=a(128428);function l({dropResult:e,layout:t}){const{source:a,destination:l,dragging:s}=e,c=a.id===n.D0?(0,i.Z)(s.type):t[s.id]||{};if(a.id===l.id)return c.meta.width;const{width:u,minimumWidth:d}=(0,r.Z)({component:c,components:t}),{width:p,occupiedWidth:h}=(0,r.Z)({id:l.id,components:t});let m=Number(p-h);if(Number.isNaN(m)){const{width:e,occupiedWidth:a}=(0,r.Z)({id:(0,o.Z)({childId:l.id,layout:t}),components:t});m=Number(e-a)}return 0===m&&"undefined"===typeof u?-1:Number.isNaN(m)||Number.isNaN(Number(u))||m>=u?u:m>=d?m:-1}},272673:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(995173),o=a(680621),r=a(81255);const i=(0,a(454076).cz)();function l({id:e,components:t}){const a=t[e];if(!a)return 0;let n=0;return(a.children||[]).forEach((e=>{const a=t[e]||{};n+=(a.meta||{}).width||0})),n}function s({id:e,component:t,components:a={}}){const c={width:void 0,occupiedWidth:void 0,minimumWidth:void 0},u=t||a[e];return u?(c.width=(u.meta||{}).width,c.occupiedWidth=c.width,u.type===r.Os?(c.width=s({id:(0,n.Z)({childId:u.id,layout:a}),components:a}).width||i,c.occupiedWidth=l({id:u.id,components:a}),c.minimumWidth=c.occupiedWidth||o.cx):u.type===r.BA?(c.minimumWidth=o.cx,c.occupiedWidth=0,(u.children||[]).forEach((e=>{a[e].type===r.Os&&(c.minimumWidth=Math.max(c.minimumWidth,l({id:e,components:a})))}))):u.type===r.t||u.type===r.xh||u.type===r.dW||u.type===r.qu||u.type===r.Ce||u.type===r.Mg?c.minimumWidth=o.cx:u.type!==r.hI&&u.type!==r.GV&&u.type!==r.kE||(c.minimumWidth=o.cd),c):c}},674547:(e,t,a)=>{a.d(t,{Dz:()=>u,Fo:()=>l,ZP:()=>r,ag:()=>s,cw:()=>c,nz:()=>i});var n=a(81255),o=a(680621);function r(){return{[o.Zn]:"v2",[o._4]:{type:n.U0,id:o._4,children:[o.PV]},[o.PV]:{type:n.BG,id:o.PV,children:[],parents:[o._4]}}}function i(e){return e.type!==n.Os&&e.type!==n.BA&&e.type!==n.gn}function l(e,t){const a={},r=[];for(const l in e)if(Object.hasOwnProperty.call(e,l)){const s=e[l];l===o.Zn||l===o._4||l===o.PV||l===o.M2||s.type===n.yR&&1===s.parents.length&&s.parents[0]===o._4?(a[l]={...s},l===o.PV&&(a[l]={...s,children:[]}),s.type===n.yR&&s.children.forEach((t=>{a[t]={...e[t],children:[]}}))):i(s)&&!t[s.id]&&r.push({...s,children:[]})}return[a,r]}function s(e,t){let a;for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];if(!t[n]){a={...o};break}}return a}function c(e){const t=["width","height","layoutType","pos"],a={};for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o={...e[n].meta};t.forEach((e=>{delete o[e]})),a[n]={meta:o}}return a}function u(e,t){const a={...e};for(const e in t)if(Object.hasOwnProperty.call(t,e)&&a[e]){const n=t[e];a[e].meta={...a[e].meta,...n.meta}}return a}},153046:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(269856);function o(e={}){const{date_filter:t,filter_configs:a=[],show_druid_time_granularity:o,show_sqla_time_column:r,show_sqla_time_granularity:i}=e;let l=a.reduce((({columns:e,labels:t},a)=>{let o=a[n.ft.DEFAULT_VALUE];""===o&&(o=null),o&&a[n.ft.MULTIPLE]&&(o=a.defaultValue.split(";"));return{columns:{...e,[a.column]:a.vals||o},labels:{...t,[a.column]:a.label}}}),{columns:{},labels:{}});if(t){let t={...l.columns,[n.i2.time_range]:e.time_range};const a={...l.labels,...Object.entries(n.i2).reduce(((e,[t,a])=>({...e,[a]:n.m_[t]})),{})};i&&(t={...t,[n.i2.time_grain_sqla]:e.time_grain_sqla}),r&&(t={...t,[n.i2.granularity_sqla]:e.granularity_sqla}),o&&(t={...t,[n.i2.granularity]:e.granularity}),l={...l,columns:t,labels:a}}return l}},948461:(e,t,a)=>{function n({dashboardFilters:e={},source:t=[],destination:a=[]}){const n=new Set(t),o=new Set(a);return[].concat(...Object.values(e).map((({scopes:e})=>[].concat(...Object.values(e).map((({scope:e})=>e)))))).some((e=>o.has(e)!==n.has(e)))}a.d(t,{Z:()=>n})},128428:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(714670),o=a.n(n),r=a(455867),i=a(81255),l=a(680621);const s=(0,a(454076).cz)(),c={[i.dW]:{width:l.fw,height:50},[i.BA]:{width:l.fw,background:l.HE},[i.hE]:null,[i.Nc]:{text:(0,r.t)("New header"),headerSize:l.OE,background:l.HE,fontSize:l.Kt,fontFamily:l.ut,bgColor:l.VR},[i.xh]:{width:l.fw,height:50},[i.Ce]:{width:l.fw,height:50},[i.qu]:{width:l.fw,height:50,bgColor:l.VR},[i.hI]:{width:s/5,height:50},[i.kE]:{width:s/10,height:30},[i.GV]:{width:s/10,height:30},[i.Mg]:{width:l.fw,height:50,bgColor:l.VR},[i.Os]:{background:l.HE},[i.yR]:null,[i.gn]:{text:"",defaultText:(0,r.t)("Tab title"),placeholder:(0,r.t)("Tab title")},[i.t]:{width:s,background:l.HE,fontSize:l.Kt,fontFamily:l.ut,bgColor:l.VR},[i.Q7]:{width:l.fw,height:50}};function u(e){return`${e}-${o().generate()}`}function d(e,t,a=[]){return{type:e,id:u(e),children:[],parents:a,meta:{...c[e],...t}}}},489293:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(150361),o=a.n(n),r=a(132485),i=a(591282),l=a(128428),s=(a(347456),a(81255));const c=(0,a(454076).cz)();function u({dropResult:e,layout:t,mobile:a}){const{dragging:n,destination:u}=e,d=o()(e),{dragging:p,destination:h}=d,m=p.parents||[];h.children;let g="",f="",v="",y=p.id;m.forEach((e=>{(null==e?void 0:e.indexOf("ROW-"))>-1&&(g=e),(null==e?void 0:e.indexOf("TAB-"))>-1&&(f=e),(null==e?void 0:e.indexOf("TABS-"))>-1&&(v=e)}));const b=n.type,_=u,C=_.type;let E=n;E.parents=(_.parents||[]).concat(_.id),(0,r.Z)(n)&&(E.meta={...E.meta,width:a?c:c/2});const T=(0,i.Z)({parentType:C,childType:b}),Z={[E.id]:E};if(g&&f&&"CHART"===p.type){const e={};if(T){const a=(0,l.Z)(s.Os);a.id=g;const n=t[g],o=[...(null==n?void 0:n.children)||[],y];a.children=Array.from(new Set(o)),a.parents=(_.parents||[]).concat(_.id).concat(f),e[g]=a;const r=t[f];if(r){const t=[...(null==r?void 0:r.children)||[],g];r.children=Array.from(new Set(t)),e[f]=r}return e[y]=p,e}}if(T){const e=(0,l.Z)(s.Os);e.children=[E.id],e.parents=(_.parents||[]).concat(_.id),Z[e.id]=e,E.parents=e.parents.concat(e.id),E=e}else if(b===s.yR){var S;const e=(0,l.Z)(s.gn);e.parents=(_.parents||[]).concat(_.id);const a=null==p||null==(S=p.children)?void 0:S[0];if(a&&(e.id=a),f){const a={},n=o()(t[f]),r=[...(null==n?void 0:n.children)||[],y];return n.children=Array.from(new Set(r)),a[n.id]=n,a[e.id]=e,a[y]=p,a}E.children=[e.id],Z[e.id]=e}else if(b===s.gn){const e=p,a=o()(t[v]);if(a){const t=[...(null==a?void 0:a.children)||[],y];a.children=Array.from(new Set(t)),Z[a.id]=a;const n={};return n[y]=e,n[a.id]=a,n}}const x=[..._.children];return x.splice(void 0===u.index?u.children.length:u.index,0,E.id),Z[u.id]={..._,children:x},Z}},411370:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(820194);function o(e){return Object.entries(e).reduce(((e,t)=>{const[a,{values:o}]=t,{chartId:r,column:i}=(0,n._)(a),l={...e[r],[i]:o};return{...e,[r]:l}}),{})}},591282:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(81255);const o={[n.BG]:{[n.dW]:!0,[n.BA]:!0,[n.xh]:!0,[n.Ce]:!0,[n.qu]:!0,[n.hI]:!0,[n.kE]:!0,[n.GV]:!0,[n.Mg]:!0,[n.Q7]:!0},[n.gn]:{[n.dW]:!0,[n.BA]:!0,[n.xh]:!0,[n.Ce]:!0,[n.qu]:!0,[n.hI]:!0,[n.kE]:!0,[n.GV]:!0,[n.Mg]:!0,[n.Q7]:!0}};function r({parentType:e,childType:t}){if(!e||!t)return!1;const a=o[e];return!!a&&Boolean(a[t])}},437418:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(68492);function o({currentComponent:e,layout:t={}}){if(e&&t)if(t[e.id]){const a=Array.isArray(e.parents)?e.parents.slice():[];a.push(e.id),Array.isArray(e.children)&&e.children.forEach((e=>{const r=t[e];r?(r.parents=a,o({currentComponent:r,layout:t})):n.Z.warn(`The current layout does not contain a component with the id: ${e}.  Skipping this component`)}))}else n.Z.warn(`The current layout does not contain a component with the id: ${null==e?void 0:e.id}.  Skipping this component`)}},379069:(e,t,a)=>{a.d(t,{Z:()=>m});var n=a(205872),o=a.n(n),r=a(667294),i=a(45697),l=a.n(i),s=a(751995),c=a(211965),u=a(482342),d=a(787253);const p={value:l().bool,label:l().string,onChange:l().func},h=s.iK.div`
  ${({theme:e})=>c.iv`
    .ControlHeader label {
      color: ${e.colors.grayscale.dark1};
    }
    span[role='checkbox'] {
      padding-right: ${2*e.gridUnit}px;
    }
  `}
`;class m extends r.Component{onChange(){this.props.onChange(!this.props.value)}renderCheckbox(){return(0,c.tZ)(d.ZP,{onChange:this.onChange.bind(this),checked:!!this.props.value})}render(){return this.props.label?(0,c.tZ)(h,null,(0,c.tZ)(u.Z,o()({},this.props,{leftNode:this.renderCheckbox(),onClick:this.onChange.bind(this)}))):this.renderCheckbox()}}m.propTypes=p,m.defaultProps={value:!1,onChange:()=>{}}},361890:(e,t,a)=>{a.d(t,{Z:()=>M});var n=a(667294),o=a(45697),r=a.n(o),i=a(431069),l=a(68492),s=a(455867),c=a(355786),u=a(468135),d=a(482342),p=a(717536),h=a(627130),m=a(819113),g=a(269856),f=a(940266),v=a(427478),y=a(731293),b=a(774069),_=a(96055),C=a(642753),E=a(7848),T=a(211965);function Z({adhocFilter:e,options:t,datasource:a,onFilterEdit:n,onRemoveFilter:o,partitionColumn:r,onMoveLabel:i,onDropLabel:l,index:s,sections:c,operators:u}){const{actualTimeRange:d,title:p}=(0,E.w)(e);return(0,T.tZ)(_.Z,{sections:c,operators:u,adhocFilter:e,options:t,datasource:a,onFilterEdit:n,partitionColumn:r},(0,T.tZ)(v.yz,{label:null!=d?d:e.getDefaultLabel(),tooltipTitle:null!=p?p:e.getTooltipTitle(),onRemove:o,onMoveLabel:i,onDropLabel:l,index:s,type:C.g.FilterOption,withCaret:!0,isExtra:e.isExtra}))}var S=a(328543);const x=r().oneOfType([r().shape({expressionType:r().oneOf([S.vq.SIMPLE]).isRequired,clause:r().oneOf([S.Pr.HAVING,S.Pr.WHERE]).isRequired,subject:r().string.isRequired,comparator:r().oneOfType([r().string,r().arrayOf(r().string)]).isRequired}),r().shape({expressionType:r().oneOf([S.vq.SQL]).isRequired,clause:r().oneOf([S.Pr.WHERE,S.Pr.HAVING]).isRequired,sqlExpression:r().string.isRequired})]);var w=a(372201);const{warning:A}=b.Z,R=r().oneOfType([r().string,p.Z]),D={label:r().oneOfType([r().object,r().string]),name:r().string,sections:r().arrayOf(r().string),operators:r().arrayOf(r().string),onChange:r().func,value:r().arrayOf(x),datasource:r().object,columns:r().arrayOf(w.Z),savedMetrics:r().arrayOf(h.Z),selectedMetrics:r().oneOfType([R,r().arrayOf(R)]),isLoading:r().bool,canDelete:r().func};function O(e){return e&&!(e instanceof S.ZP)&&e.expressionType}class N extends n.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>O(e)?new S.ZP(e):e));this.optionRenderer=e=>(0,T.tZ)(f.Z,{option:e}),this.valueRenderer=(e,t)=>(0,T.tZ)(Z,{key:t,index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn}),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const a=null==(t=e.database)?void 0:t.id,{datasource_name:n,schema:o,is_sqllab_view:r}=e;!r&&a&&n&&o&&i.Z.get({endpoint:`/api/v1/database/${a}/table_extra/${n}/${o}/`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}})).catch((e=>{l.Z.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>O(e)?new S.ZP(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:a}=this.state,n=null==t?void 0:t(a[e],a);"string"!==typeof n?this.removeFilter(e):A({title:(0,s.t)("Warning"),content:n})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:a}=this.state,n=[...a];[n[t],n[e]]=[n[e],n[t]],this.setState({values:n})}mapOption(e){return e instanceof S.ZP?e:e.saved_metric_name?new S.ZP({expressionType:S.vq.SQL,subject:this.getMetricExpression(e.saved_metric_name),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:S.Pr.HAVING}):e.label?new S.ZP({expressionType:S.vq.SQL,subject:new m.Z(e).translateToSql(),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:S.Pr.HAVING}):e.column_name?new S.ZP({expressionType:S.vq.SIMPLE,subject:e.column_name,operator:g.LT[g.d.EQUALS].operation,comparator:"",clause:S.Pr.WHERE,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,c.Z)(e.selectedMetrics).map((e=>e&&("string"===typeof e?{saved_metric_name:e}:new m.Z(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,T.tZ)(_.Z,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new S.ZP({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn},e)}render(){const{theme:e}=this.props;return(0,T.tZ)("div",{className:"metrics-select","data-test":"adhoc-filter-control"},(0,T.tZ)(v.gM,null,(0,T.tZ)(d.Z,this.props),this.addNewFilterPopoverTrigger((0,T.tZ)(v.IG,{"data-test":"add-filter-button"},(0,T.tZ)(y.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5})))),(0,T.tZ)(v.yj,null,this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,T.tZ)(v.SW,null,(0,T.tZ)(y.Z.PlusSmall,{iconColor:e.colors.grayscale.light1}),(0,s.t)("Add filter")))))}}N.propTypes=D,N.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const M=(0,u.b)(N)},328543:(e,t,a)=>{a.d(t,{Pr:()=>i,ZP:()=>u,vq:()=>r});var n=a(269856),o=a(112515);const r={SIMPLE:"SIMPLE",SQL:"SQL"},i={HAVING:"HAVING",WHERE:"WHERE"},l={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},s=[...n.qB].map((e=>n.LT[e].operation));function c(e,{useSimple:t}={}){if(e.expressionType===r.SIMPLE||t){const{subject:t,comparator:a}=e,r=e.operator&&e.operator===n.LT[n.d.LATEST_PARTITION].operation?l[e.operator](e):l[e.operator];return(0,o.CB)(t,r,a)}return e.expressionType===r.SQL?e.sqlExpression:""}class u{constructor(e){var t,a;(this.expressionType=e.expressionType||r.SIMPLE,this.expressionType===r.SIMPLE)?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,this.dropdown=null!=(a=null==e?void 0:e.dropdown)?a:[],[n.d.IS_TRUE,n.d.IS_FALSE].indexOf(e.operatorId)>=0&&(this.comparator=e.operatorId===n.d.IS_TRUE),[n.d.IS_NULL,n.d.IS_NOT_NULL].indexOf(e.operatorId)>=0&&(this.comparator=null),this.clause=e.clause||i.WHERE,this.sqlExpression=null):this.expressionType===r.SQL&&(this.sqlExpression="string"===typeof e.sqlExpression?e.sqlExpression:c(e,{useSimple:!0}),this.clause=e.clause,e.operator&&s.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null);this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new u({...this,isNew:!1,...e})}equals(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){const e=[n.d.IS_NOT_NULL,n.d.IS_NULL].map((e=>n.LT[e].operation)),t=[n.d.IS_TRUE,n.d.IS_FALSE].map((e=>n.LT[e].operation));if(this.expressionType===r.SIMPLE){if(e.indexOf(this.operator)>=0)return!(!this.operator||!this.subject);if(t.indexOf(this.operator)>=0)return!(!this.subject||null===this.comparator);if(this.operator&&this.subject&&this.clause)if(Array.isArray(this.comparator)){if(this.comparator.length>0)return!0}else if(null!==this.comparator)return!0}else if(this.expressionType===r.SQL)return!(!this.sqlExpression||!this.clause);return!1}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return c(this)}}},372201:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(45697),o=a.n(n);const r=o().shape({column_name:o().string.isRequired,type:o().string})},819113:(e,t,a)=>{a.d(t,{Z:()=>l,v:()=>o});var n=a(269856);const o={SIMPLE:"SIMPLE",SQL:"SQL"};function r(e){if(e.sqlExpression&&n.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),a=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&a>0)return e.sqlExpression.substring(a+1,t)}return null}function i(e){if(e.sqlExpression&&n.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class l{constructor(e){if(this.expressionType=e.expressionType||o.SIMPLE,this.expressionType===o.SIMPLE){const t=r(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||i(e),this.sqlExpression=null,this.indicatorDateFormat=e.indicatorDateFormat,this.manualsetting=[],this.indicatorType=e.indicatorType}else this.expressionType===o.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null,this.indicatorDateFormat=null,this.manualsetting=e.manualsetting||[],this.indicatorType=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){const e=this.translateToSql({useVerboseName:!0});return e.length<43?e:`${e.substring(0,40)}...`}translateToSql(e={useVerboseName:!1,transformCountDistinct:!1}){if(this.expressionType===o.SIMPLE){var t,a;const o=this.aggregate||"",r=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(a=this.column)&&a.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&o===n.YY.COUNT_DISTINCT&&/^\(.*\)$/.test(r)?`COUNT(DISTINCT ${r.slice(1,-1)})`:o+r}return this.expressionType===o.SQL?this.sqlExpression:""}duplicateWith(e){return new l({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&e.indicatorDateFormat===this.indicatorDateFormat&&e.manualsetting===this.manualsetting&&e.indicatorType===this.indicatorType&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===o.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===o.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return i(this)}inferSqlExpressionColumn(){return r(this)}}},940266:(e,t,a)=>{a.d(t,{Z:()=>u});a(667294);var n=a(45697),o=a.n(n),r=a(634087),i=a(717536),l=a(699963),s=a(211965);const c={option:o().oneOfType([r.Z,o().shape({saved_metric_name:o().string.isRequired}),i.Z]).isRequired};function u({option:e}){return e.saved_metric_name?(0,s.tZ)(l.l,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,s.tZ)(l.l,{column:e,showType:!0}):e.label?(0,s.tZ)(l.l,{column:{column_name:e.label,type:"expression"},showType:!0}):null}u.propTypes=c},717536:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(45697),o=a.n(n),r=a(269856),i=a(634087),l=a(819113);const s=o().oneOfType([o().shape({expressionType:o().oneOf([l.v.SIMPLE]).isRequired,column:i.Z.isRequired,aggregate:o().oneOf(Object.keys(r.YY)).isRequired,label:o().string.isRequired}),o().shape({expressionType:o().oneOf([l.v.SQL]).isRequired,sqlExpression:o().string.isRequired,label:o().string.isRequired})])},634087:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(45697),o=a.n(n);const r=o().shape({column_name:o().string.isRequired,type:o().string})},627130:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(45697),o=a.n(n);const r=o().shape({metric_name:o().string,verbose_name:o().string,expression:o().string})},570603:(e,t,a)=>{a.d(t,{r:()=>n});const n=[{provinceName:"\u9ed1\u9f99\u6c5f\u7701",areaName:"\u4e1c\u5317"},{provinceName:"\u5409\u6797\u7701",areaName:"\u4e1c\u5317"},{provinceName:"\u8fbd\u5b81\u7701",areaName:"\u4e1c\u5317"},{provinceName:"\u5317\u4eac\u5e02",areaName:"\u534e\u5317"},{provinceName:"\u5929\u6d25\u5e02",areaName:"\u534e\u5317"},{provinceName:"\u6cb3\u5317\u7701",areaName:"\u534e\u5317"},{provinceName:"\u5c71\u897f\u7701",areaName:"\u534e\u5317"},{provinceName:"\u5185\u8499\u53e4\u81ea\u6cbb\u533a",areaName:"\u534e\u5317"},{provinceName:"\u9655\u897f\u7701",areaName:"\u897f\u5317"},{provinceName:"\u7518\u8083\u7701",areaName:"\u897f\u5317"},{provinceName:"\u9752\u6d77\u7701",areaName:"\u897f\u5317"},{provinceName:"\u5b81\u590f\u56de\u65cf\u81ea\u6cbb\u533a",areaName:"\u897f\u5317"},{provinceName:"\u65b0\u7586\u7ef4\u543e\u5c14\u81ea\u6cbb\u533a",areaName:"\u897f\u5317"},{provinceName:"\u6cb3\u5357\u7701",areaName:"\u534e\u4e2d"},{provinceName:"\u6e56\u5317\u7701",areaName:"\u534e\u4e2d"},{provinceName:"\u6e56\u5357\u7701",areaName:"\u534e\u4e2d"},{provinceName:"\u5c71\u4e1c\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u6c5f\u82cf\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u5b89\u5fbd\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u4e0a\u6d77\u5e02",areaName:"\u534e\u4e1c"},{provinceName:"\u6d59\u6c5f\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u6c5f\u897f\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u798f\u5efa\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u53f0\u6e7e\u7701",areaName:"\u534e\u4e1c"},{provinceName:"\u91cd\u5e86\u5e02",areaName:"\u897f\u5357"},{provinceName:"\u8d35\u5dde\u7701",areaName:"\u897f\u5357"},{provinceName:"\u56db\u5ddd\u7701",areaName:"\u897f\u5357"},{provinceName:"\u4e91\u5357\u7701",areaName:"\u897f\u5357"},{provinceName:"\u897f\u85cf\u81ea\u6cbb\u533a",areaName:"\u897f\u5357"},{provinceName:"\u5e7f\u4e1c\u7701",areaName:"\u534e\u5357"},{provinceName:"\u9999\u6e2f\u7279\u522b\u884c\u653f\u533a",areaName:"\u534e\u5357"},{provinceName:"\u6fb3\u95e8\u7279\u522b\u884c\u653f\u533a",areaName:"\u534e\u5357"},{provinceName:"\u6d77\u5357\u7701",areaName:"\u534e\u5357"},{provinceName:"\u5e7f\u897f\u58ee\u65cf\u81ea\u6cbb\u533a",areaName:"\u534e\u5357"}]},182199:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(667294),o=a(45697),r=a.n(o),i=a(201111),l=a(455867),s=a(211965),c=a(281315),u=a(482342);const d={ariaLabel:r().string,autoFocus:r().bool,choices:r().array,clearable:r().bool,description:r().oneOfType([r().string,r().node]),disabled:r().bool,freeForm:r().bool,isLoading:r().bool,multi:r().bool,isMulti:r().bool,name:r().string.isRequired,onChange:r().func,onFocus:r().func,value:r().oneOfType([r().string,r().number,r().array]),default:r().oneOfType([r().string,r().number,r().array]),showHeader:r().bool,optionRenderer:r().func,valueKey:r().string,options:r().array,placeholder:r().string,filterOption:r().func,tokenSeparators:r().arrayOf(r().string),notFoundContent:r().object,label:r().string,renderTrigger:r().bool,validationErrors:r().array,rightNode:r().node,leftNode:r().node,onClick:r().func,hovered:r().bool,tooltipOnClick:r().func,warning:r().string,danger:r().string};class p extends n.PureComponent{constructor(e){super(e),this.state={options:this.getOptions(e)},this.onChange=this.onChange.bind(this),this.handleFilterOptions=this.handleFilterOptions.bind(this)}UNSAFE_componentWillReceiveProps(e){if(!(0,i.Z)(e.choices,this.props.choices)||!(0,i.Z)(e.options,this.props.options)){const t=this.getOptions(e);this.setState({options:t})}}onChange(e){const{valueKey:t}=this.props;let a=e;if(Array.isArray(e)){a=e.map((e=>void 0!==(null==e?void 0:e[t])?e[t]:e))}"object"===typeof e&&void 0!==(null==e?void 0:e[t])&&(a=e[t]),this.props.onChange(a,[])}getOptions(e){const{choices:t,optionRenderer:a,valueKey:n}=e;let o=[];return e.options?o=e.options.map((e=>({...e,value:e[n],label:e.label||e[n],customLabel:a?a(e):void 0}))):t&&(o=t.map((e=>{if(Array.isArray(e)){const[t,a]=e.length>1?e:[e[0],e[0]];return{value:t,label:a}}return Object.is(e)?{...e,value:e[n],label:e.label||e[n]}:{value:e,label:e}}))),o}handleFilterOptions(e,t){const{filterOption:a}=this.props;return a({data:t},e)}render(){const{ariaLabel:e,autoFocus:t,clearable:a,disabled:n,filterOption:o,freeForm:r,isLoading:i,isMulti:d,label:p,multi:h,name:m,placeholder:g,onFocus:f,showHeader:v,value:y,tokenSeparators:b,notFoundContent:_,description:C,renderTrigger:E,rightNode:T,leftNode:Z,validationErrors:S,onClick:x,hovered:w,tooltipOnClick:A,warning:R,danger:D}=this.props,O={name:m,label:p,description:C,renderTrigger:E,rightNode:T,leftNode:Z,validationErrors:S,onClick:x,hovered:w,tooltipOnClick:A,warning:R,danger:D},N={allowNewOptions:r,autoFocus:t,ariaLabel:e||("string"===typeof p?p:(0,l.t)("Select ...")),allowClear:a,disabled:n,filterOption:!o||"function"!==typeof o||this.handleFilterOptions,header:v&&(0,s.tZ)(u.Z,O),loading:i,mode:d||h?"multiple":"single",name:`select-${m}`,onChange:this.onChange,onFocus:f,options:this.state.options,placeholder:g,sortComparator:this.props.sortComparator,value:(()=>{const e=y||(void 0!==this.props.default?this.props.default:void 0);if(null!==e||this.state.options.find((e=>null===e.value)))return e})(),tokenSeparators:b,notFoundContent:_};return(0,s.tZ)("div",{css:e=>s.iv`
          .type-label {
            margin-right: ${2*e.gridUnit}px;
          }
          .Select__multi-value__label > span,
          .Select__option > span,
          .Select__single-value > span {
            display: flex;
            align-items: center;
          }
        `},(0,s.tZ)(c.Z,N))}}p.propTypes=d,p.defaultProps={autoFocus:!1,choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:()=>{},onFocus:()=>{},showHeader:!0,valueKey:"value"}},100665:(e,t,a)=>{a.d(t,{Z:()=>b});var n=a(667294),o=a(45697),r=a.n(o),i=a(49937),l=a(455867),s=a(737921),c=a(976697),u=a(883734),d=a(787253),p=a(482342),h=a(182199),m=a(211965);const g="latlong",f="delimited",v="geohash",y={onChange:r().func,value:r().object,animation:r().bool,choices:r().array};class b extends n.Component{constructor(e){super(e);const t=e.value||{};let a;e.choices.length>0&&(a=e.choices[0][0]),this.state={type:t.type||g,delimiter:t.delimiter||",",latCol:t.latCol||a,lonCol:t.lonCol||a,lonlatCol:t.lonlatCol||a,reverseCheckbox:t.reverseCheckbox||!1,geohashCol:t.geohashCol||a,value:null,errors:[]},this.toggleCheckbox=this.toggleCheckbox.bind(this),this.onChange=this.onChange.bind(this),this.renderReverseCheckbox=this.renderReverseCheckbox.bind(this)}componentDidMount(){this.onChange()}onChange(){const{type:e}=this.state,t={type:e},a=[],n=(0,l.t)("Invalid lat/long configuration.");e===g?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||a.push(n)):e===f?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||a.push(n)):e===v&&(t.geohashCol=this.state.geohashCol,t.reverseCheckbox=this.state.reverseCheckbox,t.geohashCol||a.push(n)),this.setState({value:t,errors:a}),this.props.onChange(t,a)}setType(e){this.setState({type:e},this.onChange)}toggleCheckbox(){this.setState((e=>({reverseCheckbox:!e.reverseCheckbox})),this.onChange)}renderLabelContent(){return this.state.errors.length>0?"N/A":this.state.type===g?`${this.state.lonCol} | ${this.state.latCol}`:this.state.type===f?`${this.state.lonlatCol}`:this.state.type===v?`${this.state.geohashCol}`:null}renderSelect(e,t){return(0,m.tZ)(h.Z,{ariaLabel:e,name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:()=>{this.setType(t)},onChange:t=>{this.setState({[e]:t},this.onChange)}})}renderReverseCheckbox(){return(0,m.tZ)("span",null,(0,l.t)("Reverse lat/long "),(0,m.tZ)(d.ZP,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox}))}renderPopoverContent(){return(0,m.tZ)("div",{style:{width:"300px"}},(0,m.tZ)(u.Z,{title:(0,l.t)("Longitude & Latitude columns"),isSelected:this.state.type===g,onSelect:this.setType.bind(this,g)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Longitude"),this.renderSelect("lonCol",g)),(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Latitude"),this.renderSelect("latCol",g)))),(0,m.tZ)(u.Z,{title:(0,l.t)("Delimited long & lat single column"),info:(0,l.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===f,onSelect:this.setType.bind(this,f)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Column"),this.renderSelect("lonlatCol",f)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))),(0,m.tZ)(u.Z,{title:(0,l.t)("Geohash"),isSelected:this.state.type===v,onSelect:this.setType.bind(this,v)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,l.t)("Column"),this.renderSelect("geohashCol",v)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))))}render(){return(0,m.tZ)("div",null,(0,m.tZ)(p.Z,this.props),(0,m.tZ)(c.ZP,{content:this.renderPopoverContent(),placement:"topLeft",trigger:"click"},(0,m.tZ)(s.Z,{className:"pointer"},this.renderLabelContent())))}}b.propTypes=y,b.defaultProps={onChange:()=>{},animation:!0,choices:[]}},542878:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(205872),o=a.n(n),r=a(667294),i=a(45697),l=a.n(i),s=a(9875),c=a(455867),u=a(468135),d=a(835932),p=a(794670),h=a(601304),m=a(482342),g=a(211965);const f={name:l().string,onChange:l().func,initialValue:l().string,height:l().number,minLines:l().number,maxLines:l().number,offerEditInModal:l().bool,language:l().oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:l().node,readOnly:l().bool,resize:l().oneOf([null,"block","both","horizontal","inline","none","vertical"]),textAreaStyles:l().object};class v extends r.Component{onControlChange(e){const{value:t}=e.target;this.props.onChange(t)}onAreaEditorChange(e){this.props.onChange(e)}renderEditor(e=!1){const t=e?40:this.props.minLines||12;if(this.props.language){const a={border:`1px solid ${this.props.theme.colors.grayscale.light1}`,minHeight:`${t}em`,width:"auto",...this.props.textAreaStyles};return this.props.resize&&(a.resize=this.props.resize),this.props.readOnly&&(a.backgroundColor="#f2f2f2"),(0,g.tZ)(p.YH,o()({mode:this.props.language,style:a,minLines:t,maxLines:e?1e3:this.props.maxLines,editorProps:{$blockScrolling:!0},defaultValue:this.props.initialValue,readOnly:this.props.readOnly,key:this.props.name},this.props,{onChange:this.onAreaEditorChange.bind(this)}))}return(0,g.tZ)(s.Kx,{placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),defaultValue:this.props.initialValue,disabled:this.props.readOnly,style:{height:this.props.height}})}renderModalBody(){return(0,g.tZ)(r.Fragment,null,(0,g.tZ)("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}render(){const e=(0,g.tZ)(m.Z,this.props);return(0,g.tZ)("div",null,e,this.renderEditor(),this.props.offerEditInModal&&(0,g.tZ)(h.Z,{modalTitle:e,triggerNode:(0,g.tZ)(d.Z,{buttonSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",(0,g.tZ)("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0),responsive:!0}))}}v.propTypes=f,v.defaultProps={onChange:()=>{},initialValue:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1,resize:null,textAreaStyles:{}};const y=(0,u.b)(v)},692252:(e,t,a)=>{a.d(t,{ai:()=>b});a(667294);var n=a(281545),o=a(45511),r=a(455867),i=a(895826),l=a(375294),s=a(112515),c=a(269856),u=a(699963),d=a(211965);const p=(0,n.Z)(),h=(0,o.Z)(),m=[["SMART_NUMBER",(0,r.t)("Adaptive formatting")],["~g",(0,r.t)("Original value")],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION",(0,r.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,r.t)("Duration in ms (100.40008 => 100ms 400\xb5s 80ns)")]],g=((0,r.t)("Adaptive formatting"),{verbose_name:"Time",column_name:"__timestamp",description:(0,r.t)("A reference to the [Time] configuration, taking granularity into account")}),f={type:"SelectControl",multi:!0,freeForm:!0,label:(0,r.t)("Dimensions"),default:[],includeTime:!1,description:(0,r.t)("One or many columns to group by. High cardinality groupings should include a series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,d.tZ)(u.l,{column:e,showType:!0}),valueKey:"column_name",filterOption:({data:e},t)=>e.column_name&&e.column_name.toLowerCase().indexOf(t.toLowerCase())>=0||e.verbose_name&&e.verbose_name.toLowerCase().indexOf(t.toLowerCase())>=0,mapStateToProps:(e,t)=>{const a={};return e.datasource&&(a.options=e.datasource.columns.filter((e=>e.groupby)),t&&t.includeTime&&a.options.push(g)),a}},v={type:"MetricsControl",multi:!0,label:(0,r.t)("Metrics"),validators:[i.Z],mapStateToProps:e=>{const{datasource:t}=e;return{columns:t?t.columns:[],savedMetrics:t?t.metrics:[],datasource:t}},description:(0,r.t)("One or many metrics to display")},y={...v,multi:!1,label:(0,r.t)("Metric"),description:(0,r.t)("Metric")};const b={metrics:v,metric:y,datasource:{type:"DatasourceControl",label:(0,r.t)("Dataset"),default:null,description:null,mapStateToProps:({datasource:e})=>({datasource:e,isEditable:!!e})},viz_type:{type:"VizTypeControl",default:"table",description:(0,r.t)("The type of visualization to display")},color_picker:{label:(0,r.t)("Fixed color"),description:(0,r.t)("Use this to define a static color for all circles"),type:"ColorPickerControl",default:{r:0,g:122,b:135,a:1},renderTrigger:!0},metric_2:{...y,label:(0,r.t)("Right axis metric"),clearable:!0,description:(0,r.t)("Choose a metric for right axis")},linear_color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Linear color scheme"),choices:()=>h.values().map((e=>[e.id,e.label])),default:h.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>h.getMap(),isLinear:!0},secondary_metric:{...y,label:(0,r.t)("Color metric"),default:null,validators:[],description:(0,r.t)("A metric to use for color")},groupby:f,columns:{...f,label:(0,r.t)("Columns"),description:(0,r.t)("One or many controls to pivot as columns")},granularity:{type:"SelectControl",freeForm:!0,label:c.m_.granularity,default:"P1D",choices:[[null,(0,r.t)("all")],["PT5S",(0,r.t)("5 seconds")],["PT30S",(0,r.t)("30 seconds")],["PT1M",(0,r.t)("1 minute")],["PT5M",(0,r.t)("5 minutes")],["PT30M",(0,r.t)("30 minutes")],["PT1H",(0,r.t)("1 hour")],["PT6H",(0,r.t)("6 hour")],["P1D",(0,r.t)("1 day")],["P7D",(0,r.t)("7 days")],["P1W",(0,r.t)("week")],["week_starting_sunday",(0,r.t)("week starting Sunday")],["week_ending_saturday",(0,r.t)("week ending Saturday")],["P1M",(0,r.t)("month")],["P3M",(0,r.t)("quarter")],["P1Y",(0,r.t)("year")]],description:(0,r.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`,`1 day` or `56 weeks`")},granularity_sqla:{type:"SelectControl",label:c.m_.granularity_sqla,description:(0,r.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),clearable:!1,optionRenderer:e=>(0,d.tZ)(u.l,{column:e,showType:!0}),valueKey:"column_name",mapStateToProps:e=>{const t={};return e.datasource&&(t.choices=e.datasource.granularity_sqla,t.default=null,e.datasource.main_dttm_col?t.default=e.datasource.main_dttm_col:t.choices&&t.choices.length>0&&(t.default=t.choices[0].column_name)),t}},time_grain_sqla:{type:"SelectControl",label:c.m_.time_grain_sqla,default:"P1D",description:(0,r.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>({choices:e.datasource?e.datasource.time_grain_sqla:null})},time_range:{type:"DateFilterControl",freeForm:!0,label:c.m_.time_range,default:(0,r.t)("No filter"),description:(0,r.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},row_limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Row limit"),validators:[l.Z],default:1e4,choices:(0,s.mG)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,r.t)("Limits the number of rows that get displayed.")},limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Series limit"),validators:[l.Z],choices:(0,s.mG)([5,10,25,50,100,500]),clearable:!0,description:(0,r.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},timeseries_limit_metric:{type:"MetricsControl",label:(0,r.t)("Sort by"),default:null,clearable:!0,description:(0,r.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>({columns:e.datasource?e.datasource.columns:[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},series:{...f,label:(0,r.t)("Dimensions"),multi:!1,default:null,description:(0,r.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},entity:{...f,label:(0,r.t)("Entity"),default:null,multi:!1,validators:[i.Z],description:(0,r.t)("This defines the element to be plotted on the chart")},x:{...y,label:(0,r.t)("X Axis"),description:(0,r.t)("Metric assigned to the [X] axis"),default:null},y:{...y,label:(0,r.t)("Y Axis"),default:null,description:(0,r.t)("Metric assigned to the [Y] axis")},size:{...y,label:(0,r.t)("Bubble size"),default:null},y_axis_format:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Y Axis Format"),renderTrigger:!0,default:"SMART_NUMBER",choices:m,description:"D3 format syntax: https://github.com/d3/d3-format",mapStateToProps:e=>{const t=e.controls&&e.controls.comparison_type&&"percentage"===e.controls.comparison_type.value;return{warning:t?(0,r.t)('When `Calculation type` is set to "Percentage change", the Y Axis Format is forced to `.1%`'):null,disabled:t}}},adhoc_filters:{type:"AdhocFilterControl",label:(0,r.t)("Filters"),default:null,description:"",mapStateToProps:e=>({columns:e.datasource?e.datasource.columns.filter((e=>e.filterable)):[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Color scheme"),default:p.getDefaultKey(),renderTrigger:!0,choices:()=>p.keys().map((e=>[e,e])),description:(0,r.t)("The color scheme for rendering chart"),schemes:()=>p.getMap()}}},635854:(e,t,a)=>{a.d(t,{R3:()=>i,oN:()=>l});var n=a(837687),o=a(410331),r=a(692252);function i(e,t){var a;const r={...t},i=r.viz_type||(null==(a=e.common)?void 0:a.conf.DEFAULT_VIZ_TYPE)||"table";!function(e){e.y_axis_zero&&(e.y_axis_bounds=[0,null])}(r);const l=(0,o.mi)(i,e.datasource.type,e,r),s=(0,n.Z)().get(i)||{};return s.onInit?s.onInit(l):l}function l(e){const t=e.datasource.split("__")[1],a=e.viz_type,n=(0,o.mi)(a,t,null,e),r=(0,o.Hu)(n),i={};return Object.keys(n).concat(Object.keys(e)).forEach((t=>{void 0===e[t]?i[t]=r[t]:i[t]=e[t]})),i}const s={...r.ai};Object.keys(r.ai).forEach((e=>{s[e].value=r.ai[e].default}));(0,o.Hu)(s)},10945:(e,t,a)=>{a.d(t,{DT:()=>i,J_:()=>r,S4:()=>c,dS:()=>s,m7:()=>u,qy:()=>l});var n=a(455867);function o(e){return Object.keys(e).reduce(((e,t)=>{const a=e;return a[t]=t,a}),{})}const r={FORMULA:{value:"FORMULA",label:(0,n.t)("Formula")},EVENT:{value:"EVENT",label:(0,n.t)("Event"),supportNativeSource:!0},INTERVAL:{value:"INTERVAL",label:(0,n.t)("Interval"),supportNativeSource:!0},TIME_SERIES:{value:"TIME_SERIES",label:(0,n.t)("Time series")}},i=o(r),l=i.FORMULA,s={NATIVE:{value:"NATIVE",label:"Superset annotation"}},c=o(s);function u(e){return!!e}},492496:(e,t,a)=>{a.r(t),a.d(t,{TIME_RANGE:()=>K,default:()=>X});var n=a(667294),o=a(45697),r=a.n(o),i=a(835932),l=a(828216),s=a(355786),c=a(5364),u=a(211965),d=a(455867),p=a(468135),h=a(561314),m=a(21089),g=a(615542),f=a(692252),v=a(269856),y=a(738597),b=a.n(y),_=a(957557),C=a.n(_),E=a(618446),T=a.n(E),Z=a(890057),S=a(751995),x=a(128759),w=a(8868),A=a(198201),R=a(72182),D=a(428368),O=a.n(D),N=a(591877),M=a(593185),I=a(838703),L=a(634275),k=a(301510),F=a(935500),P=a(677997),$=a(340892),U=a(267051);const V=S.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,q=[{data:[{}]}],H=({dataMaskSelected:e,control:t,datasource:a,rawFormData:o,onChange:r,onSearch:i,onFilterSelectionChange:l,inView:s=!0,directPathToChild:c,onFocusFilter:p,onBlurFilter:h,onFilterActive:m,mobileStatus:g=!1,hiddenDomExceptTab:f=!1})=>{var v,y;const{column:b,parent:_}=t,C=parseInt(null==o?void 0:o.datasource.split("__")[0],10),E=!!C,Z=(0,n.useMemo)((()=>(0,A.eP)(_,e)),[_,e]),[S,x]=(0,n.useState)([]),[w,R]=(0,n.useState)(""),[D,H]=(0,n.useState)({inView:!1}),[z,j]=(0,n.useState)({}),[B,G]=(0,n.useState)(s),W=(0,n.useRef)(null),[Y,K]=(0,n.useState)(E),[Q,J]=(0,n.useState)(!1),X=(0,n.useCallback)((()=>{var e;const{adhoc_filters:t=[],time_range:n="",granularity_sqla:r=""}=o;return{adhoc_filters:t,...(null==(e=(0,$.Ns)(a))||e)&&{time_range:n,...n&&"No filter"!==n&&{granularity_sqla:r}}}}),[a,o]),ee=(0,n.useCallback)((()=>{J(!1),K(!1)}),[]);(0,n.useEffect)((()=>{!B&&s&&G(!0)}),[s,B,G]),(0,n.useEffect)((()=>{var e;if(!B)return;const{defaultDataMask:a,controlValues:n,filterType:o,sortMetric:r,type:i}=t,l=(0,k.zi)({datasetId:C,groupby:b,dependencies:Z,defaultDataMask:a,controlValues:n,filterType:o,sortMetric:r,type:i,...X()}),s=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!Q&&(!O()(D,l,((e,t,a)=>"url_params"===a||void 0))||!T()(z,s))){if(H(l),j(s),!E)return;J(!0),(0,F.getChartDataRequest)({formData:l,force:!1,requestParams:{dashboardId:0},ownState:s}).then((({response:e,json:t})=>{if((0,N.cr)(M.T.GLOBAL_ASYNC_QUERIES)){const a="result"in t?t.result[0]:t;if(200===e.status)x([a]),ee();else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,P.YJ)(a).then((e=>{x(e),ee()})).catch((e=>{R(e.message||e.error||(0,d.t)("Check configuration")),ee()}))}}else x(t.result),R(""),ee()})).catch((e=>{R(e.statusText),ee()}))}}),[B,Z,C,b,ee,JSON.stringify(t),E,Q,X]),(0,n.useEffect)((()=>{var e;(null==c?void 0:c[0])===t.id&&(null==W||null==(e=W.current)||e.focus())}),[W,c,t.id]);const te=(0,n.useCallback)((e=>l(t,e)),[t,l]),ae=(0,n.useCallback)((e=>m(t,e)),[t,m]),ne=(0,n.useCallback)((()=>p(t)),[t,p]),oe=(0,n.useCallback)((()=>h(t)),[t,h]),re=(0,n.useMemo)((()=>({onChange:r,onSearch:i,setDataMask:te,setFocusedFilter:ne,unsetFocusedFilter:oe,setFilterActive:ae})),[r,i,te,ne,oe,ae]),ie=(0,n.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState}}),[null==(v=t.dataMask)?void 0:v.filterState]);return w?(0,u.tZ)(L.Z,{title:(0,d.t)("Cannot load filter"),body:w,level:"error"}):(0,u.tZ)(V,{"data-test":"layout-item-value"},Y?(0,u.tZ)(I.Z,{position:"inline-centered"}):(0,u.tZ)(U.Z,{control:t,inputRef:W,formData:D,queriesData:E?S:q,filterState:ie,ownState:null==(y=t.dataMask)?void 0:y.ownState,isRefreshing:Q,hooks:re,mobileStatus:g,hiddenDomExceptTab:f}))},z=n.memo(H),j=S.iK.div`
  ${({theme:e})=>u.iv`
    padding-bottom: ${4*e.gridUnit}px;

    label {
      color: ${e.colors.grayscale.base};
      margin-bottom: ${.5*e.gridUnit}px;
      position: relative;
    }
  `}
`,B=e=>{const{className:t,datasource:a,rawFormData:o,filtersFields:r,onChange:i,onSearch:l,onFocusFilter:s,onBlurFilter:c,onFilterActive:d,mobileStatus:p=!1,hiddenDomExceptTab:h=!1}=e,m=(0,n.useMemo)((()=>r.reduce(((e,t)=>({...e,[t.id]:{...(0,w.H)(t.id),...t.defaultDataMask}})),{})),[r]),[g,f]=(0,Z.x)(m),v=(0,n.useMemo)((()=>r.map((e=>({...e,dataMask:g[e.id]})))),[r,g]),{renderTree:y}=(0,n.useMemo)((()=>(0,A.xK)(R.xy.Local,v)),[v]),b=(0,n.useCallback)(((e,t)=>{f((a=>{a[e.id]={...(0,w.H)(e.id),...t}}))}),[f]),_=JSON.stringify(m);(0,n.useEffect)((()=>{f((()=>m))}),[_,f]);const C=(0,n.useCallback)(((e,n)=>{let r=[];return e.forEach((e=>{const{key:m,label:f,children:v,..._}=e;if((0,A.j0)(y,e,{})){let y=(0,u.tZ)(x.N,{name:`LABEL-${f}`,label:f});if(p&&(!1===h&&e.controlType===R.yP.Tab&&(y=(0,u.tZ)("span",null)),!0===h&&e.controlType!==R.yP.Tab&&(y=(0,u.tZ)("span",null))),r=r.concat((0,u.tZ)(j,{className:t,key:m},y,(0,u.tZ)(z,{dataMaskSelected:g,control:e,datasource:a,rawFormData:o,onChange:i,onSearch:l,onFilterSelectionChange:b,onFocusFilter:s,onBlurFilter:c,onFilterActive:d,mobileStatus:p,hiddenDomExceptTab:h}))),v){const e={key:m,label:f,..._};r=r.concat(C(v,n?n.concat(e):[e]))}}})),r}),[t,y,JSON.stringify(g),a,o,i,l,s,c,d,b]);return(0,u.tZ)(n.Fragment,null,C(y))},G=(e,t)=>T()(C()(e,b()(e)),C()(t,b()(t))),W=(0,n.memo)(B,G);var Y=a(454076);const K=v.i2.time_range,Q={chartId:r().number.isRequired,origSelectedValues:r().object,datasource:r().object.isRequired,instantFiltering:r().bool,filtersFields:r().arrayOf(r().shape({field:r().string,label:r().string})),filtersChoices:r().objectOf(r().arrayOf(r().shape({id:r().string|r().number,text:r().string|r().number,filter:r().string,metric:r().number}))),onChange:r().func,onFilterMenuOpen:r().func,onFilterMenuClose:r().func,showDateFilter:r().bool,showSqlaTimeGrain:r().bool,showSqlaTimeColumn:r().bool};class J extends n.PureComponent{constructor(e){super(e),this.state={selectedValues:{},hasChanged:!1},this.changeFilter=this.changeFilter.bind(this),this.onFilterMenuOpen=this.onFilterMenuOpen.bind(this),this.onFilterMenuClose=this.onFilterMenuClose.bind(this)}componentDidMount(){this.setTimeRange(this.props.rawFormData.time_range)}UNSAFE_componentWillReceiveProps(e){this.props.rawFormData.time_range!==e.rawFormData.time_range&&this.setTimeRange(e.rawFormData.time_range)}onFilterMenuOpen(e){return this.props.onFilterMenuOpen(this.props.chartId,e)}onFilterMenuClose(e){return this.props.onFilterMenuClose(this.props.chartId,e)}getControlData(e){const{selectedValues:t}=this.state,a={...f.ai[e],name:e,key:`control-${e}`,value:t[v.i2[e]],actions:{setControlValue:this.changeFilter}},n=a.mapStateToProps;return n?{...a,...n(this.props)}:a}clickApply(){const{selectedValues:e}=this.state;this.setState({hasChanged:!1},(()=>{this.props.onChange(e,!1,!0,!0,!1)}))}changeFilter(e,t,a){const n=v.i2[e]||e;let o=null;if(null!==t)if("filter_textinput"===a)o=t;else if(Array.isArray(t))o=t.map((e=>"object"===typeof e?e.value:e));else if(Object.values(v.i2).includes(n)){var r;o=null!=(r=t.value)?r:t}else if(e.includes("filter_textinput"))o=t;else{var i;o=(0,s.Z)(null!=(i=t.value)?i:t)}this.setState((e=>({selectedValues:{...e.selectedValues,[n]:o},hasChanged:!0})),(()=>{this.props.instantFiltering&&this.props.onChange({[n]:o},!1)}))}setTimeRange(e){e!==c.vM?(0,h.z1)(e||this.props.origSelectedValues[K],!1).then((({value:e})=>{this.changeFilter(K,e)})):this.changeFilter(K,c.vM)}isMobile(){const{dashboardState:e={}}=this.props,{layoutMode:t}=e;return(0,Y.Od)(t)}classRowByMode(){return this.isMobile()?"col-lg-24 col-md-24 col-xs-24 mobile-row-padding":"col-lg-3 col-md-6 col-xs-12"}renderDateFilter(){const{showDateFilter:e,dashboardState:t}=this.props,{selectedValues:a}=this.state,n=v.m_.time_range,{layoutMode:o}=t;var r;return e?(0,u.tZ)("div",{className:this.classRowByMode()},(0,u.tZ)(m.Z,{label:n,value:null!=a&&null!=(r=a[K])&&r.includes(h.UD)?a[K].split(h.UD):[],isMobile:(0,Y.Od)(o),valueFormat:h.KZ,onChange:([e,t])=>{const a=e&&t?[e,t].join(h.UD):"";this.changeFilter(K,a)}})):null}renderDatasourceFilters(){const{showSqlaTimeGrain:e,showSqlaTimeColumn:t}=this.props,a=[],n=[],o=[];return e&&n.push("time_grain_sqla"),t&&n.push("granularity_sqla"),n.length&&a.push(...n.map((e=>(0,u.tZ)(g.Z,this.getControlData(e))))),o.length&&a.push(...o.map((e=>(0,u.tZ)(g.Z,this.getControlData(e))))),a.map(((e,t)=>(0,u.tZ)("div",{className:this.classRowByMode(),key:t},e)))}renderFilters(e=!1){const{filtersFields:t,datasource:a,rawFormData:n,dashboardState:o={}}=this.props,{layoutMode:r}=o;return(0,u.tZ)(W,{className:this.classRowByMode(),datasource:a,rawFormData:n,filtersFields:t,onSearch:()=>{},onFilterActive:()=>{},mobileStatus:(0,Y.Od)(r),hiddenDomExceptTab:e,onChange:({columnValue:e},t,a)=>this.changeFilter(e,t,a),onFocusFilter:({columnValue:e})=>this.onFilterMenuOpen(e),onBlurFilter:({columnValue:e})=>this.onFilterMenuClose(e)})}render(){const{instantFiltering:e,width:t,height:a,dashboardState:o}=this.props,{zIndex:r}=this.props.theme,{layoutMode:l}=o;return(0,u.tZ)(n.Fragment,null,(0,u.tZ)(u.xB,{styles:u.iv`
            .dashboard .filter_box .slice_container > div:not(.alert) {
              padding-top: 0;
            }

            .filter_box {
              overflow: visible !important;

              &:hover {
                z-index: ${r.max};
              }
            }
            .mobile-row-padding {
              padding-left: 20px;
              padding-right: 20px;
            }
            .mobile-btn {
              width: 100%;
            }
          `}),(0,u.tZ)("div",{style:{width:t,height:a}},(0,u.tZ)("div",{className:"row",key:"filters"},(0,Y.Od)(l)&&this.renderFilters(!0),this.renderDatasourceFilters(),this.renderDateFilter(),this.renderFilters()),!e&&(0,u.tZ)(i.Z,{buttonSize:"small",buttonStyle:"primary",className:(0,Y.Od)(l)?"mobile-btn":"",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,d.t)("Apply"))))}}J.propTypes=Q,J.defaultProps={origSelectedValues:{},onChange:()=>{},onFilterMenuOpen:()=>{},onFilterMenuClose:()=>{},showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,instantFiltering:!1};const X=(0,p.b)((0,l.$j)((function(e){return{dashboardState:e.dashboardState}}))(J))},794736:(e,t,a)=>{a.d(t,{Z:()=>n});const n={tab:"PlCWj4ywjmjvZJL3bshC",span:"Yx8bDw1c4VJfpnXXrUda",smallTitle:"lV5r29N_TPTThmo4H3Ne",resetBox:"AYkXTLbIoNQPfv3hycmw"}},461819:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(121804),o=a.n(n),r=(a(667294),a(751995)),i=a(455867),l=a(51776),s=a(211965);const c=r.iK.div`
  margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
`;const u=function({certifiedBy:e,details:t,metricName:a}){const n=(0,r.Fg)();return(0,s.tZ)(l.Z,{id:`${o()(a)}-tooltip`,title:(0,s.tZ)("div",null,e&&(0,s.tZ)(c,null,(0,i.t)("Certified by %s",e)),(0,s.tZ)("div",null,t))},(0,s.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",enableBackground:"new 0 0 24 24",height:"14",viewBox:"0 0 24 24",width:"14"},(0,s.tZ)("g",null,(0,s.tZ)("path",{fill:n.colors.primary.base,d:"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z"}))))}},365634:(e,t,a)=>{a.d(t,{E:()=>p});var n=a(667294),o=a(751995),r=a(211965),i=a(51776),l=a(644582),s=a(461819),c=a(671963),u=a(660605);const d=o.iK.span`
  display: flex;
  align-items: center;
  svg {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`;function p({column:e,labelRef:t,showFormula:a=!0,showType:o=!1}){const{expression:p,column_name:h,type_generic:m}=e,g=p&&p!==h,f=g?"expression":m,[v,y]=(0,n.useState)(e.column_name);return(0,n.useLayoutEffect)((()=>{y((0,c.ZK)(e,t))}),[t,e]),(0,r.tZ)(d,null,o&&void 0!==f&&(0,r.tZ)(l.j,{type:f}),(0,r.tZ)(i.u,{id:"metric-name-tooltip",title:v},(0,r.tZ)("span",{className:"option-label column-option-label",css:e=>r.iv`
              margin-right: ${e.gridUnit}px;
            `,ref:t},(0,c.ok)(e))),a&&g&&(0,r.tZ)(u.Z,{sqlExpression:p}),e.is_certified&&(0,r.tZ)(s.Z,{metricName:e.metric_name,certifiedBy:e.certified_by,details:e.certification_details}))}},644582:(e,t,a)=>{a.d(t,{j:()=>T,Z:()=>Z});var n,o=a(667294),r=a(751995),i=a(211965),l=a(334106),s=a(455867),c=a(88889),u=a(395642);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d.apply(this,arguments)}const p=function(e){return o.createElement("svg",d({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n||(n=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z",fill:"currentColor"})))};var h;function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},m.apply(this,arguments)}const g=function(e){return o.createElement("svg",m({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),h||(h=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z",fill:"currentColor"})))};var f;function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},v.apply(this,arguments)}const y=function(e){return o.createElement("svg",v({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),f||(f=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z",fill:"currentColor"})))};var b;function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_.apply(this,arguments)}const C=function(e){return o.createElement("svg",_({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),b||(b=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z",fill:"currentColor"})))},E=r.iK.div`
  ${({theme:e})=>i.iv`
    display: flex;
    justify-content: center;
    align-items: center;
    width: ${6*e.gridUnit}px;
    height: ${6*e.gridUnit}px;
    margin-right: ${e.gridUnit}px;

    && svg {
      margin-right: 0;
      margin-left: 0;
    }
  `};
`;function T({type:e}){const t=(0,r.Fg)();let a=(0,i.tZ)(l.default,{"aria-label":(0,s.t)("unknown type icon"),style:{color:t.colors.text.label}});return""===e||"expression"===e?a=(0,i.tZ)(p,{"aria-label":(0,s.t)("function type icon"),style:{color:t.colors.primary.dark2}}):e===c.Z.STRING?a=(0,i.tZ)(y,{"aria-label":(0,s.t)("string type icon"),style:{color:t.colors.info.dark2}}):e===c.Z.NUMERIC?a=(0,i.tZ)(C,{"aria-label":(0,s.t)("numeric type icon"),style:{color:t.colors.success.base}}):e===c.Z.BOOLEAN?a=(0,i.tZ)(g,{"aria-label":(0,s.t)("boolean type icon"),style:{color:t.colors.secondary.dark2}}):e===c.Z.TEMPORAL&&(a=(0,i.tZ)(u.default,{"aria-label":(0,s.t)("temporal type icon"),style:{color:t.colors.primary.dark1}})),(0,i.tZ)(E,null,a)}const Z=T},128759:(e,t,a)=>{a.d(t,{N:()=>c,Z:()=>c});a(667294);var n=a(211965),o=a(334106),r=a(455867),i=a(146970),l=a(51776);const s=n.iv`
  &.anticon {
    font-size: unset;
    .anticon {
      line-height: unset;
      vertical-align: unset;
    }
  }
`;function c({name:e,description:t,label:a,tooltipOnClick:c,onClick:u,warning:d,danger:p,leftNode:h,rightNode:m,validationErrors:g=[],renderTrigger:f=!1,hovered:v=!1,required:y=!1}){if(!a)return null;const b=g.length>0?"text-danger":"";return(0,n.tZ)("div",{className:"ControlHeader","data-test":`${e}-header`},(0,n.tZ)("div",{className:"pull-left"},(0,n.tZ)("label",{className:"control-label",htmlFor:e,style:{textTransform:"none"}},h&&(0,n.tZ)("span",null,h),(0,n.tZ)("span",{role:"button",tabIndex:0,onClick:u,className:b,style:{cursor:u?"pointer":""}},a)," ",d&&(0,n.tZ)("span",null,(0,n.tZ)(l.u,{id:"error-tooltip",placement:"top",title:d},(0,n.tZ)("i",{className:"fa fa-exclamation-circle text-warning"}))," "),p&&(0,n.tZ)("span",null,(0,n.tZ)(l.u,{id:"error-tooltip",placement:"top",title:p},(0,n.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),g.length>0&&(0,n.tZ)("span",null,(0,n.tZ)(l.u,{id:"error-tooltip",placement:"top",title:g.join(" ")},(0,n.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),v?(0,n.tZ)("span",null,t&&(0,n.tZ)("span",null,(0,n.tZ)(l.u,{id:"description-tooltip",title:t,placement:"top"},(0,n.tZ)(o.default,{css:s,onClick:c}))," "),f&&(0,n.tZ)("span",null,(0,n.tZ)(l.u,{id:"description-tooltip",title:(0,r.t)("Changing this control takes effect instantly"),placement:"top"},(0,n.tZ)(i.default,{css:s}))," ")):null,y&&(0,n.tZ)("span",{className:"text-danger m-l-4"},(0,n.tZ)("strong",null,"*")))),m&&(0,n.tZ)("div",{className:"pull-right"},m),(0,n.tZ)("div",{className:"clearfix"}))}},251384:(e,t,a)=>{a.d(t,{m:()=>m});var n=a(667294),o=a(751995),r=a(211965),i=a(178186),l=a(409882),s=a(644582),c=a(461819),u=a(51776),d=a(671963),p=a(660605);const h=o.iK.div`
  align-items: center;
  display: flex;

  > svg {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`;function m({metric:e,labelRef:t,openInNewWindow:a=!1,showFormula:o=!0,showType:m=!1,shouldShowTooltip:g=!0,url:f=""}){const v=e.verbose_name||e.metric_name||e.label,y=f?(0,r.tZ)("a",{href:f,target:a?"_blank":"",rel:"noreferrer"},v):v,b=(0,r.tZ)("span",{className:"option-label metric-option-label",css:e=>r.iv`
          margin-right: ${e.gridUnit}px;
        `,ref:t},y),_=e.warning_markdown||e.warning_text,[C,E]=(0,n.useState)(e.metric_name);return(0,n.useLayoutEffect)((()=>{E((0,d.Lk)(e,t))}),[t,e]),(0,r.tZ)(h,{className:"metric-option"},m&&(0,r.tZ)(s.j,{type:"expression"}),g?(0,r.tZ)(u.Z,{id:"metric-name-tooltip",title:C},b):b,o&&e.expression&&(0,r.tZ)(p.Z,{sqlExpression:e.expression}),e.is_certified&&(0,r.tZ)(c.Z,{metricName:e.metric_name,certifiedBy:e.certified_by,details:e.certification_details}),_&&(0,r.tZ)(l.Z,{className:"text-warning",icon:"warning",tooltip:(0,r.tZ)(i.Z,{source:_}),label:`warn-${e.metric_name}`,iconsStyle:{marginLeft:0}}))}},660605:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(205872),o=a.n(n),r=(a(667294),a(855241)),i=a(874981),l=a(751995),s=a(348690),c=a(211965),u=a(455867);a(789899);const d=(0,l.iK)(s.default)`
  ${({theme:e})=>c.iv`
    color: ${e.colors.grayscale.base};
    font-size: ${e.typography.sizes.s}px;
    & svg {
      margin-left: ${e.gridUnit}px;
      margin-right: ${e.gridUnit}px;
    }
  `}
`,p=e=>{const t=(0,l.Fg)();return(0,c.tZ)(r.Z,o()({content:(0,c.tZ)(i.default,{mode:"sql",value:e.sqlExpression,editorProps:{$blockScrolling:!0},setOptions:{highlightActiveLine:!1,highlightGutterLine:!1},minLines:2,maxLines:6,readOnly:!0,wrapEnabled:!0,style:{border:`1px solid ${t.colors.grayscale.light2}`,background:t.colors.secondary.light5,maxWidth:100*t.gridUnit}}),placement:"bottomLeft",arrowPointAtCenter:!0,title:(0,u.t)("SQL expression")},e),(0,c.tZ)(d,null))}},671963:(e,t,a)=>{a.d(t,{Lk:()=>h,ZK:()=>p,ok:()=>d});var n=a(667294),o=a(751995),r=a(211965),i=a(455867);const l=o.iK.div`
  ${({theme:e})=>r.iv`
    display: flex;
    flex-direction: column;
    font-size: ${e.typography.sizes.s}px;
    line-height: 1.2;

    &:not(:last-of-type) {
      margin-bottom: ${2*e.gridUnit}px;
    }
  `}
`,s=o.iK.span`
  ${({theme:e})=>r.iv`
    font-weight: ${e.typography.weights.bold};
  `}
`,c=({label:e,text:t})=>(0,r.tZ)(l,null,(0,r.tZ)(s,null,e),(0,r.tZ)("span",null,t)),u=e=>{var t,a;return!!((null==e||null==(t=e.current)?void 0:t.scrollWidth)>(null==e||null==(a=e.current)?void 0:a.clientWidth))},d=e=>e.verbose_name||e.column_name,p=(e,t)=>e.column_name&&e.verbose_name||e.description||u(t)?(0,r.tZ)(n.Fragment,null,e.column_name&&(0,r.tZ)(c,{label:(0,i.t)("Column name"),text:e.column_name}),e.verbose_name&&(0,r.tZ)(c,{label:(0,i.t)("Label"),text:e.verbose_name}),e.description&&(0,r.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null,h=(e,t)=>e.verbose_name||e.description||e.label||u(t)?(0,r.tZ)(n.Fragment,null,(0,r.tZ)(c,{label:(0,i.t)("Metric name"),text:e.metric_name}),(e.label||e.verbose_name)&&(0,r.tZ)(c,{label:(0,i.t)("Label"),text:e.label||e.verbose_name}),e.description&&(0,r.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null},535622:(e,t,a)=>{a.d(t,{CV:()=>d,DS:()=>c,LU:()=>u,cm:()=>p,m_:()=>s});var n=a(455867),o=a(5364),r=a(88889),i=a(46078),l=a(920620);const s={time_range:(0,n.t)("Time Range"),granularity_sqla:(0,n.t)("Time Column"),time_grain_sqla:(0,n.t)("Time Grain"),granularity:(0,n.t)("Time Granularity")},c={[o.W3]:(0,n.t)("Time")},u={verbose_name:c[o.W3],column_name:o.W3,type_generic:r.Z.TEMPORAL,description:(0,n.t)("A reference to the [Time] configuration, taking granularity into account")},d={name:o.W3,type:i.i9.Query,is_dttm:!1},p={[l.n.aggregate]:(0,n.t)("Aggregate"),[l.n.raw]:(0,n.t)("Raw records")}},81526:(e,t,a)=>{a.d(t,{Hm:()=>n,Jr:()=>l,No:()=>i,Pf:()=>o,Ps:()=>c,YY:()=>s});var n,o,r=a(455867);!function(e){e[e.CURRENT=0]="CURRENT",e[e.TARGET=1]="TARGET"}(n||(n={})),function(e){e.DYNAMIC="Dynamic",e.FIXED="Fixed"}(o||(o={}));const i=[[o.DYNAMIC,(0,r.t)("Dynamic value")],[o.FIXED,(0,r.t)("Fixed value")]],l=o.DYNAMIC,s={AVG:"AVG",COUNT:"COUNT",COUNT_DISTINCT:"COUNT_DISTINCT",MAX:"MAX",MIN:"MIN",SUM:"SUM"},c=Object.values(s)},156496:(e,t,a)=>{a.d(t,{D:()=>d,PO:()=>u,hP:()=>m,uJ:()=>h,wb:()=>p});var n=a(205872),o=a.n(n),r=(a(667294),a(564749)),i=a(956652),l=a(62446),s=a(819113),c=a(211965);const u=e=>e.map((e=>{const t="object"===typeof e,a=t?null==e?void 0:e.key:e,n=t?(null==e?void 0:e.label)||e.value:e;if(null!=e&&e.options)return(0,c.tZ)(r.Z.OptGroup,{key:a,label:n},u(e.options));const i=t?null==e?void 0:e.value:e,{customLabel:l,...s}=e;return(0,c.tZ)(r.Z.Option,o()({},s,{key:a,label:n,value:i}),t&&null!=e&&e.customLabel?e.customLabel:n)})),d=e=>{var t;return null==e||null==(t=e.match(/\(([^)]+)\)/))?void 0:t[1]},p=e=>{var t,a;return null==e||null==(t=e.match(/^\w+/))||null==(a=t[0])?void 0:a.toLocaleUpperCase()},h=e=>{var t;return null!=(t=null==e?void 0:e.metric_name)?t:(0,i.Z)(e)},m=({savedMetrics:e,columns:t,metric:a})=>{var n,o;if(!a||a instanceof s.Z||"string"!==typeof a&&(null==a||!a.expressionType))return a;let r,i;if((0,l.AG)(a)?r=((e,t)=>e.find((e=>e.metric_name===t)))(e,a):(0,l.Ww)(a)&&(r=a),(0,l.nX)(a)){const e=t.find((e=>e.column_name===a.column.column_name));e&&(i=new s.Z({...a,column:e}))}return null!=(n=r)&&n.metric_name?r:null!=(o=i)&&o.isValid()?i:new s.Z(a)}},510162:(e,t,a)=>{a.d(t,{YY:()=>ie.YY,Ps:()=>ie.Ps,Jr:()=>ie.Jr,No:()=>ie.No,Pf:()=>ie.Pf,Hm:()=>ie.Hm,Mw:()=>W,hP:()=>K.hP,ZP:()=>fe,wb:()=>K.wb,D:()=>K.D,uJ:()=>K.uJ,PO:()=>K.PO});var n=a(211965),o=a(667294),r=a(751995),i=a(128759);function l({value:e,options:t,onChange:a,...o}){const l=e||t[0][0],s=(0,r.Fg)();return(0,n.tZ)("div",{css:(0,n.iv)({".btn svg":{position:"relative",top:"0.2em"},".btn:focus":{outline:"none"},".control-label":{color:s.colors.grayscale.base,marginBottom:s.gridUnit},".control-label + .btn-group":{marginTop:"1px"},".btn-group .btn-default":{color:s.colors.grayscale.dark1},".btn-group .btn.active":{background:s.colors.grayscale.light4,fontWeight:s.typography.weights.bold,boxShadow:"none"}},"","")},(0,n.tZ)(i.Z,o),(0,n.tZ)("div",{className:"btn-group btn-group-sm"},t.map((([e,t])=>(0,n.tZ)("button",{key:JSON.stringify(e),type:"button",className:"btn btn-default "+(e===l?"active":""),onClick:()=>{a(e)}},t)))))}var s=a(455867),c=a(855241),u=a(644582),d=a(205872),p=a.n(d),h=a(88889),m=a(23279),g=a.n(m),f=a(668122);function v({children:e}){const{gridUnit:t}=(0,r.Fg)();return(0,n.tZ)("div",{css:(0,n.iv)({display:"flex",flexWrap:"nowrap",margin:-2*t,marginBottom:t},"","")},e)}function y({onChange:e,value:t,children:a}){const i=(0,r.Fg)(),l=(0,o.useMemo)((()=>({0:e,[f.o]:g()(e,f.o)})),[e]),s=o.Children.map(a,(a=>{if("children"in a.props){const n=Array.isArray(a.props.children)?100/a.props.children.length+"%":void 0;return o.cloneElement(a,{children:o.Children.map(a.props.children,(a=>{const{name:r,width:i,debounceDelay:s=f.o,onChange:c}=a.props;return o.cloneElement(a,{width:i||n,value:null==t?void 0:t[r],debounceDelay:void 0,onChange(a){c&&c(a),s in l||(l[s]=g()(e,s)),l[s]({...t,[r]:a})}})}))})}return a}));return(0,n.tZ)("div",{css:(0,n.iv)({label:{textTransform:"uppercase",color:i.colors.text.label,fontSize:i.typography.sizes.s}},"","")},s)}var b=a(409882),_=a(231955),C=a(624225),E=a(432787),T=a(831059),Z=a(564749);const{Option:S}=Z.Z;function x({creatable:e,onSearch:t,dropdownMatchSelectWidth:a=!1,minWidth:r="100%",showSearch:i=!0,onChange:l,options:s,children:c,value:u,...d}){const[h,m]=(0,o.useState)(),g=i||e,f=g?a=>{e&&m(a),t&&t(a)}:void 0,v=null==s?void 0:s.some((([e])=>e===h)),y=null==s?void 0:s.some((([e])=>e===u)),b=g?(e,t)=>{m(""),l&&l(e,t)}:l;return(0,n.tZ)(Z.Z,p()({dropdownMatchSelectWidth:a,showSearch:g,onSearch:f,onChange:b,value:u},d,{css:(0,n.iv)({minWidth:r},"","")}),null==s?void 0:s.map((([e,t])=>(0,n.tZ)(S,{value:e},t))),c,u&&!y&&(0,n.tZ)(S,{key:u,value:u},u),h&&!v&&(0,n.tZ)(S,{key:h,value:h},h))}x.Option=S;const w={Slider:_.Z,InputNumber:C.Z,Input:E.Z,Select:x,Checkbox:T.Z,RadioButtonControl:l};function A({name:e,label:t,description:a,width:l,validators:s,required:c,onChange:u,value:d,defaultValue:h,controlType:m,...g}){const{gridUnit:f}=(0,r.Fg)(),[v,y]=(0,o.useState)(!1),[_,C]=(0,o.useState)(void 0===d?h:d),[E,T]=(0,o.useState)(),Z=e=>{const t=e&&"object"===typeof e&&"target"in e?"checkbox"===e.target.type||"radio"===e.target.type?e.target.checked:e.target.value:e,a=(null==s?void 0:s.map((e=>!(!c&&function(e){return null==e||""===e}(t))&&e(t))).filter((e=>!!e)))||[];T(a),C(t),0===a.length&&u&&u(t)},S=w[m];return(0,n.tZ)("div",{css:(0,n.iv)({margin:2*f,width:l},"",""),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1)},"Checkbox"===m?(0,n.tZ)(w.Checkbox,{checked:_,onChange:Z},t," ",v&&a&&(0,n.tZ)(b.Z,{tooltip:a})):(0,n.tZ)(o.Fragment,null,t&&(0,n.tZ)(i.Z,{name:e,label:t,description:a,validationErrors:E,hovered:v,required:c}),(0,n.tZ)(S,p()({},g,{value:_,onChange:Z}))))}var R=a(300872),D=a(261437),O=a(738798),N=a(314031),M=a(558842);const I={controlType:"Select",label:(0,s.t)("D3 format"),description:M.YD,options:M.F6,defaultValue:M.F6[0][0],creatable:!0,minWidth:"14em",debounceDelay:500},L={controlType:"Select",label:(0,s.t)("D3 format"),description:M.oq,options:M.HC,defaultValue:M.HC[0][0],creatable:!0,minWidth:"10em",debounceDelay:500},k={controlType:"Slider",label:(0,s.t)("Fraction digits"),description:(0,s.t)("Number of decimal digits to round numbers to"),min:0,step:1,max:100,defaultValue:100},F={controlType:"InputNumber",label:(0,s.t)("Min Width"),description:(0,s.t)("Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space"),width:120,placeholder:(0,s.t)("auto"),debounceDelay:400,validators:[R.Z]},P={controlType:"RadioButtonControl",label:(0,s.t)("Text align"),description:(0,s.t)("Horizontal alignment"),width:130,debounceDelay:50,defaultValue:"left",options:[["left",(0,n.tZ)(D.E,{title:(0,s.t)("Left")})],["center",(0,n.tZ)(N.X,{title:(0,s.t)("Center")})],["right",(0,n.tZ)(O.l,{title:(0,s.t)("Right")})]]},$={controlType:"Checkbox",label:(0,s.t)("Show cell bars"),description:(0,s.t)("Whether to display a bar chart background in table columns"),defaultValue:!0,debounceDelay:200},U={controlType:"Checkbox",label:(0,s.t)("Align +/-"),description:(0,s.t)("Whether to align positive and negative values in cell bar chart at 0"),defaultValue:!1,debounceDelay:200},V={controlType:"Checkbox",label:(0,s.t)("Color +/-"),description:(0,s.t)("Whether to colorize numeric values by if they are positive or negative"),defaultValue:!1,debounceDelay:200},q={controlType:"Checkbox",label:(0,s.t)("Truncate Cells"),description:(0,s.t)('Truncate long cells to the "min width" set above'),defaultValue:!1,debounceDelay:400},H={d3NumberFormat:I,d3SmallNumberFormat:{...I,label:(0,s.t)("Small number format"),description:(0,s.t)("D3 number format for numbers between -1.0 and 1.0, useful when you want to have different significant digits for small and large numbers")},d3TimeFormat:L,fractionDigits:k,columnWidth:F,truncateLongCells:q,horizontalAlign:P,showCellBars:$,alignPositiveNegative:U,colorPositiveNegative:V},z={[h.Z.STRING]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["truncateLongCells"]],[h.Z.NUMERIC]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"right"}}],["d3NumberFormat"],["d3SmallNumberFormat"],["alignPositiveNegative","colorPositiveNegative"],["showCellBars","truncateLongCells"]],[h.Z.TEMPORAL]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["d3TimeFormat"],["truncateLongCells"]],[h.Z.BOOLEAN]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["truncateLongCells"]]};function j({column:e,configFormLayout:t,onChange:a}){return(0,n.tZ)(y,{onChange:a,value:e.config},t[void 0===e.type?h.Z.STRING:e.type].map(((e,t)=>(0,n.tZ)(v,{key:t},e.map((e=>{const t="string"===typeof e?e:e.name,a="string"===typeof e?{}:"override"in e?e.override:e.config,o={...t in H?H[t]:void 0,...a};return(0,n.tZ)(A,p()({key:t,name:t},o))}))))))}const B=o.memo((function({column:e,onChange:t,configFormLayout:a}){const{colors:o,gridUnit:i}=(0,r.Fg)(),l=6*i;return(0,n.tZ)(c.Z,{title:e.name,content:()=>(0,n.tZ)(j,{column:e,onChange:t,configFormLayout:a}),trigger:"click",placement:"right"},(0,n.tZ)("div",{css:(0,n.iv)({display:"flex",alignItems:"center",cursor:"pointer",padding:`${i}px ${2*i}px`,borderBottom:`1px solid ${o.grayscale.light2}`,position:"relative",paddingRight:l,"&:last-child":{borderBottom:"none"},"&:hover":{background:o.grayscale.light4},"> .fa":{color:o.grayscale.light2},"&:hover > .fa":{color:o.grayscale.light1}},"","")},(0,n.tZ)(u.Z,{type:e.type}),e.name,(0,n.tZ)("i",{className:"fa fa-caret-right",css:(0,n.iv)({position:"absolute",right:3*i,top:3*i},"","")})))}));var G=a(535622);const W={},Y=function({queryResponse:e,appliedColumnNames:t=[],value:a,onChange:l,configFormLayout:c=z,...u}){const{colnames:d,coltypes:p}=e||{};let h=[],m=[];if(0===t.length)h=d||[],m=p||[];else{const e=new Set(t);null==d||d.forEach(((t,a)=>{e.has(t)&&(h.push(t),m.push(null==p?void 0:p[a]))}))}const g=(0,r.Fg)(),f=(0,o.useMemo)((()=>{var e;const t={};return null==(e=h)||e.forEach(((e,n)=>{var o;t[e]={name:G.DS[e]||e,type:null==(o=m)?void 0:o[n],config:(null==a?void 0:a[e])||{}}})),t}),[a,h,m]),[v,y]=(0,o.useState)(!1),b=e=>f[e]||{};if(!h||0===h.length)return null;const _=h.length>12,C=_&&!v?h.slice(0,10):h;return(0,n.tZ)(o.Fragment,null,(0,n.tZ)(i.Z,u),(0,n.tZ)("div",{css:(0,n.iv)({border:`1px solid ${g.colors.grayscale.light2}`,borderRadius:g.gridUnit},"","")},C.map((e=>(0,n.tZ)(B,{key:e,column:b(e),onChange:t=>((e,t)=>{if(l){const n=h&&a?Object.fromEntries(Object.entries(a).filter((([e])=>h.includes(e)))):{...a};l({...n,[e]:t})}})(e,t),configFormLayout:c}))),_&&(0,n.tZ)("div",{role:"button",tabIndex:-1,css:(0,n.iv)({padding:2*g.gridUnit,textAlign:"center",cursor:"pointer",textTransform:"uppercase",fontSize:g.typography.sizes.xs,color:g.colors.text.label,":hover":{backgroundColor:g.colors.grayscale.light4}},"",""),onClick:()=>y(!v)},v?(0,n.tZ)(o.Fragment,null,(0,n.tZ)("i",{className:"fa fa-angle-up"})," \xa0 ",(0,s.t)("Show less columns")):(0,n.tZ)(o.Fragment,null,(0,n.tZ)("i",{className:"fa fa-angle-down"})," \xa0",(0,s.t)("Show all columns")))))};var K=a(156496),Q=a(609332),J=a(482342),X=a(62446),ee=a(49937),te=a(9875),ae=a(49238),ne=a(747767),oe=a(699963),re=a(819113),ie=a(81526);const le=r.iK.div`
  display: flex;
  flex: auto;
  flex-direction: column;
  max-width: 100%;
  background-color: #f7f7f7;
  padding: 4px 8px;
  border-radius: 4px;
  margin-bottom: 5px;
`,se=r.iK.div`
  align-items: center;
  display: flex;
  flex: 0 0 0;
  flex-direction: row;
  flex-basis: auto;
  justify-content: space-between;
  font-size: 12px;
  line-height: 32px;
  padding: 0 12px;
  position: relative;

  &::before {
    background-color: #2bc048;
    content: '';
    display: block;
    height: 6px;
    left: 0;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 6px;
  }
`,ce=(0,r.iK)(te.Rn)`
  width: 100%;
`,ue=(e,t)=>(0,n.tZ)(oe.B,{labelRef:t,metric:e,showType:!0,showFormula:!1}),de=(e,t)=>{const a={...e};return a.metric_name&&!a.verbose_name&&(a.verbose_name=a.metric_name),(0,n.tZ)(oe.l,{labelRef:t,column:a,showType:!0,showFormula:!1})},pe=e=>{const t={column:"",aggregate:""};return(0,X.Ww)(e)?(t.column=e.metric_name,t.aggregate=(0,K.wb)(e.expression)):(0,X.nX)(e)&&(t.column=e.column&&e.column.column_name||e.inferSqlExpressionColumn(),t.aggregate=e.aggregate||e.inferSqlExpressionAggregate()),t};function he(e){var t;const{queryResponse:a,onChange:r,columns:i,savedMetrics:l,controlMetric:c,column:u}=e,d=new re.Z({}),p=(0,o.useRef)(g()(r,100)).current,h=(0,o.useRef)(null),m=(0,o.useMemo)((()=>[{label:(0,s.t)("Metrics"),key:"metrics",options:l.map((e=>({key:e.id,value:e.metric_name,label:e.verbose_name||e.metric_name,customLabel:ue(e,h)})))},{label:(0,s.t)("Columns"),key:"columns",options:i.map((e=>({key:e.id,value:e.column_name,label:e.verbose_name||e.column_name,customLabel:de(e,h)})))}]),[JSON.stringify(l),JSON.stringify(i)]),f=(0,o.useCallback)((e=>{var t,n;const o=e||(null==u||null==(t=u.config)?void 0:t.targetType)||ie.Jr;let r;const s=null==u||null==(n=u.config)?void 0:n.targetValue;if(o===ie.Pf.DYNAMIC)r=(0,K.hP)({savedMetrics:l,columns:i,metric:(0,X.Ww)(s)||(0,X.nX)(s)?s:c});else if(o===ie.Pf.FIXED){var d,p;r=("number"===typeof s?s:null==a||null==(d=a.data)||null==(p=d[0])?void 0:p[null==u?void 0:u.name])||0}return{targetType:o,targetValue:r}}),[JSON.stringify(l),JSON.stringify(i),JSON.stringify(a)]),[v,y]=(0,o.useState)(f()),b=(0,o.useCallback)((e=>{const t=l.find((t=>t.metric_name===e)),a=i.find((t=>t.column_name===e));t?y((e=>({...e,targetValue:t}))):a&&y((e=>{var t;return{...e,targetValue:d.duplicateWith({column:a,aggregate:(0,K.wb)(null==(t=e.targetValue)?void 0:t.expression)||e.targetValue.aggregate,expressionType:re.v.SIMPLE})}}))}),[JSON.stringify(l),JSON.stringify(i)]),_=(0,o.useCallback)((e=>{y((t=>({...t,targetValue:d.duplicateWith({column:t.targetValue.column,aggregate:e,expressionType:re.v.SIMPLE})})))}),[]),C=(0,o.useCallback)((()=>{p(v)}),[JSON.stringify(v)]);return(0,Q.d)(C),(0,n.tZ)(le,null,(0,n.tZ)(se,null,null==u?void 0:u.name),(0,n.tZ)(ae.l0,{labelAlign:"left",labelCol:{span:6},wrapperCol:{span:18},css:e=>n.iv`
          .ant-form-item {
            margin-bottom: 0px;
          }
        `},(0,n.tZ)(ee.X2,{gutter:12},(0,n.tZ)(ee.JX,{span:24},(0,n.tZ)(ae.xJ,{label:(0,s.t)("Target type")},(0,n.tZ)(ee.IZ,{"aria-label":(0,s.t)("Select target type"),placeholder:(0,s.t)("Select target type"),menuItemSelectedIcon:(0,n.tZ)(ne.Y1,{iconSize:"m","aria-label":"check"}),options:ie.No.map((([e,t])=>({value:e,label:t}))),value:null==v?void 0:v.targetType,onChange:e=>{y((t=>({...t,...f(e)})))}})))),(null==v?void 0:v.targetType)===ie.Pf.DYNAMIC?(0,n.tZ)(ee.X2,{gutter:12},(0,n.tZ)(ee.JX,{span:24},(0,n.tZ)(ae.xJ,{label:(0,s.t)("Target value")},(0,n.tZ)(ee.IZ,{allowClear:!0,"aria-label":(0,s.t)("Select target value"),placeholder:(0,s.t)("%s column(s)",[...l,...i].length),menuItemSelectedIcon:(0,n.tZ)(ne.Y1,{iconSize:"m","aria-label":"check"}),value:pe(null==v?void 0:v.targetValue).column,onChange:b},(0,K.PO)(m)))),(0,n.tZ)(ee.JX,{span:24},(0,n.tZ)(ae.xJ,{label:(0,s.t)("Aggregation function")},(0,n.tZ)(ee.IZ,{disabled:null==v||null==(t=v.targetValue)?void 0:t.hasOwnProperty("metric_name"),placeholder:(0,s.t)("Select aggregation function"),menuItemSelectedIcon:(0,n.tZ)(ne.Y1,{iconSize:"m","aria-label":"check"}),options:ie.Ps.map((e=>({value:e,label:e,key:e}))),value:pe(null==v?void 0:v.targetValue).aggregate,onChange:_})))):(0,n.tZ)(ee.X2,{gutter:12},(0,n.tZ)(ee.JX,{span:24},(0,n.tZ)(ae.xJ,{label:(0,s.t)("Target value")},(0,n.tZ)(ce,{value:null==v?void 0:v.targetValue,onChange:e=>{y((t=>({...t,targetValue:e})))}}))))))}const me=o.memo(he);function ge(e){var t;const{value:a,onChange:r,queryResponse:i,columns:l,savedMetrics:s,controlMetricValues:c,...u}=e,{colnames:d,coltypes:p}=i||{};let h=[],m=[];const g=c.map(K.uJ);if(0===g.length)h=d||[],m=p||[];else{const e=new Set(g);null==d||d.forEach(((t,a)=>{e.has(t)&&(h.push(t),m.push(null==p?void 0:p[a]))}))}const[f,v]=(0,o.useState)(a),y=(0,o.useMemo)((()=>{var e;const t={};return null==(e=h)||e.forEach(((e,a)=>{var n;t[e]={name:G.DS[e]||e,type:null==(n=m)?void 0:n[a],config:null==f?void 0:f[e]}})),t}),[f,h,m]),b=e=>y[e]||{},_=(0,o.useCallback)((()=>{null==r||r(f)}),[JSON.stringify(f)]);return(0,Q.d)(_),h&&0!==h.length?(0,n.tZ)(o.Fragment,null,(0,n.tZ)(J.Z,u),null==(t=h)?void 0:t.map(((e,t)=>(0,n.tZ)(me,{key:t,queryResponse:i,columns:l,savedMetrics:s,controlMetric:c[t],column:b(e),onChange:t=>((e,t)=>{const a={...h&&f?Object.fromEntries(Object.entries(f).filter((([e])=>h.includes(e)))):{...f},[e]:t};v((e=>({...e,...a})))})(e,t)})))):null}const fe={RadioButtonControl:l,ColumnConfigControl:Y,MetricCompareControl:o.memo(ge)}},353769:(e,t,a)=>{a.d(t,{$c:()=>Z,Pi:()=>w,QF:()=>f,RW:()=>v,UQ:()=>x,Z8:()=>g,aG:()=>T,db:()=>_,iQ:()=>b,iR:()=>S,lC:()=>m,pO:()=>A,ql:()=>y,sH:()=>E,x$:()=>C,xM:()=>h});var n=a(667294),o=a(455867),r=a(895826),i=a(593185),l=a(338575),s=a(535622),c=a(365634),u=a(419835),d=a(783389),p=a(211965);const h={type:"DndColumnSelect",label:(0,o.t)("Dimensions"),multi:!0,freeForm:!0,clearable:!0,default:[],includeTime:!1,description:(0,o.t)("One or many columns to group by. High cardinality groupings should include a sort by metric and series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,p.tZ)(c.E,{showType:!0,column:e}),valueRenderer:e=>(0,p.tZ)(c.E,{column:e}),valueKey:"column_name",allowAll:!0,filterOption:({data:e},t)=>{var a,n;return(null==(a=e.column_name)?void 0:a.toLowerCase().includes(t.toLowerCase()))||(null==(n=e.verbose_name)?void 0:n.toLowerCase().includes(t.toLowerCase()))||!1},promptTextCreator:e=>e,mapStateToProps(e,t){var a;const n={},{datasource:o}=e;if(null!=o&&null!=(a=o.columns[0])&&a.hasOwnProperty("groupby")){const e=o.columns.filter((e=>e.groupby));null!=t&&t.includeTime&&e.unshift(s.LU),n.options=e,n.savedMetrics=o.metrics||[]}else{const e=(null==o?void 0:o.columns)||[];null!=t&&t.includeTime&&e.unshift(s.CV),n.options=e}return n},commaChoosesOption:!1},m={...h,label:(0,o.t)("Columns"),description:(0,o.t)("One or many columns to pivot as columns")},g={...h,label:(0,o.t)("Dimension"),multi:!1,default:null,description:(0,o.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},f={...h,label:(0,o.t)("Entity"),default:null,multi:!1,validators:[r.Z],description:(0,o.t)("This defines the element to be plotted on the chart")},v={type:"DndFilterSelect",label:(0,o.t)("Filters"),default:[],description:"",mapStateToProps:({datasource:e,form_data:t})=>({columns:(0,l.It)(e)?e.columns.filter((e=>e.filterable)):(null==e?void 0:e.columns)||[],savedMetrics:(0,u.R)(e),selectedMetrics:t.metrics||(t.metric?[t.metric]:[]),datasource:e}),provideFormDataToProps:!0,...d.sy},y={type:"DndMetricSelect",multi:!0,label:(0,o.t)("Metrics"),validators:[r.Z],mapStateToProps:({datasource:e})=>({columns:(null==e?void 0:e.columns)||[],savedMetrics:(0,u.R)(e),datasource:e,datasourceType:null==e?void 0:e.type}),description:(0,o.t)("One or many metrics to display")},b={...y,multi:!1,label:(0,o.t)("Metric"),description:(0,o.t)("Metric")},_={...b,label:(0,o.t)("Right Axis Metric"),clearable:!0,description:(0,o.t)("Choose a metric for right axis")},C={type:"DndMetricSelect",label:(0,o.t)("Sort by"),default:null,description:(0,o.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:({datasource:e})=>({columns:(null==e?void 0:e.columns)||[],savedMetrics:(0,u.R)(e),datasource:e,datasourceType:null==e?void 0:e.type})},E={...b,label:(0,o.t)("Bubble Size"),description:(0,o.t)("Metric used to calculate bubble size"),default:null},T={...b,label:(0,o.t)("X Axis"),description:(0,o.t)("Metric assigned to the [X] axis"),default:null},Z={...b,label:(0,o.t)("Y Axis"),description:(0,o.t)("Metric assigned to the [Y] axis"),default:null},S={...b,label:(0,o.t)("Color Metric"),default:null,validators:[],description:(0,o.t)("A metric to use for color")},x={...g,...d.V7,label:s.m_.granularity_sqla,description:(0,o.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),default:e=>e.default,clearable:!1,canDelete:!1,ghostButtonText:(0,o.t)("Drop temporal column here"),clickEnabledGhostButtonText:(0,o.t)("Drop a temporal column here or click"),optionRenderer:e=>(0,p.tZ)(c.E,{showType:!0,column:e}),valueRenderer:e=>(0,p.tZ)(c.E,{column:e}),valueKey:"column_name"},w={...h,...d.P2};function A(e,t){return function(a){return(0,n.useMemo)((()=>(0,i.c)(i.T.ENABLE_EXPLORE_DRAG_AND_DROP)),[])?(0,p.tZ)(e,a):(0,p.tZ)(t,a)}}},783389:(e,t,a)=>{a.d(t,{P2:()=>u,V7:()=>d,sy:()=>p});var n=a(455867),o=a(895826),r=a(111146),i=a(355786),l=a(5364),s=a(945211);const c=e=>"horizontal"===(null==e?void 0:e.orientation)?{label:(0,n.t)("Y-axis"),description:(0,n.t)("Dimension to use on y-axis.")}:{label:(0,n.t)("X-axis"),description:(0,n.t)("Dimension to use on x-axis.")},u={label:e=>c(null==e?void 0:e.form_data).label,multi:!1,description:e=>c(null==e?void 0:e.form_data).description,validators:[o.Z],initialValue:(e,t)=>{var a,n;if(r.O6&&null!=t&&null!=(a=t.form_data)&&a.granularity_sqla&&(null==(n=t.form_data)||!n.x_axis)&&(null==e||!e.value))return t.form_data.granularity_sqla},default:void 0},d={mapStateToProps:({datasource:e})=>{const t=(0,s.X)(e);return{options:t.temporalColumns,default:t.defaultTemporalColumn,isTemporal:!0}}},p={initialValue:(e,t)=>{var a,n;if(!r.O6||(0,i.Z)(e.value).findIndex((e=>"TEMPORAL_RANGE"===(null==e?void 0:e.operator)))>-1)return;if(null!=t&&null!=(a=t.form_data)&&a.granularity_sqla&&null!=t&&null!=(n=t.form_data)&&n.time_range)return[...(0,i.Z)(e.value),{clause:"WHERE",subject:t.form_data.granularity_sqla,operator:"TEMPORAL_RANGE",comparator:t.form_data.time_range,expressionType:"SIMPLE"}];const o=(null==t?void 0:t.datasource)&&(0,s.X)(t.datasource).defaultTemporalColumn;var c,u;return r.O6&&o?[...(0,i.Z)(e.value),{clause:"WHERE",subject:o,operator:"TEMPORAL_RANGE",comparator:(null==t||null==(c=t.common)||null==(u=c.conf)?void 0:u.DEFAULT_TIME_FILTER)||l.vM,expressionType:"SIMPLE"}]:void 0}}},539650:(e,t,a)=>{a.d(t,{ZP:()=>q});var n=a(441609),o=a.n(n),r=a(281545),i=a(45511),l=a(455867),s=a(237731),c=a(111146),u=a(472813),d=a(5364),p=a(375294),h=a(662363),m=a(355786),g=a(806126),f=a(558842),v=a(535622),y=a(353769);const b=(0,r.Z)(),_=(0,i.Z)(),C=[5,10,25,50,100,500],E=document.getElementById("app"),{user:T}=JSON.parse((null==E?void 0:E.getAttribute("data-bootstrap"))||"{}"),Z={type:"DatasourceControl",label:(0,l.t)("Datasource"),default:null,description:null,mapStateToProps:({datasource:e,form_data:t})=>({datasource:e,form_data:t,user:T})},S={type:"VizTypeControl",label:(0,l.t)("Visualization Type"),default:"table",description:(0,l.t)("The type of visualization to display")},x={type:"ColorPickerControl",label:(0,l.t)("Fixed Color"),description:(0,l.t)("Use this to define a static color for all circles"),default:{r:0,g:122,b:135,a:1},renderTrigger:!0},w={type:"ColorSchemeControl",label:(0,l.t)("Linear Color Scheme"),choices:()=>_.values().map((e=>[e.id,e.label])),default:_.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>_.getMap(),isLinear:!0,mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},A={type:"SelectControl",freeForm:!0,label:v.m_.granularity,default:"one day",choices:[[null,(0,l.t)("all")],["PT5S",(0,l.t)("5 seconds")],["PT30S",(0,l.t)("30 seconds")],["PT1M",(0,l.t)("1 minute")],["PT5M",(0,l.t)("5 minutes")],["PT30M",(0,l.t)("30 minutes")],["PT1H",(0,l.t)("1 hour")],["PT6H",(0,l.t)("6 hour")],["P1D",(0,l.t)("1 day")],["P7D",(0,l.t)("7 days")],["P1W",(0,l.t)("week")],["week_starting_sunday",(0,l.t)("week starting Sunday")],["week_ending_saturday",(0,l.t)("week ending Saturday")],["P1M",(0,l.t)("month")],["P3M",(0,l.t)("quarter")],["P1Y",(0,l.t)("year")]],description:(0,l.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`, `1 day` or `56 weeks`")},R={type:"SelectControl",label:v.m_.time_grain_sqla,placeholder:(0,l.t)("None"),initialValue:(e,t)=>{var a,n;return(0,s.Z)(t)?null!=t&&t.metadata||"time_grain_sqla"in(null!=(a=null==t?void 0:t.form_data)?a:{})?null==t||null==(n=t.form_data)?void 0:n.time_grain_sqla:"P1D":e.value},description:(0,l.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:({datasource:e})=>({choices:(null==e?void 0:e.time_grain_sqla)||[]}),visibility:({controls:e})=>{if(!c.O6)return!0;const t=null==e?void 0:e.x_axis,a=null==t?void 0:t.value;return!!(0,u.GA)(a)||!!(0,u.s9)(a)&&!(null==(n=(null!=(o=null==t?void 0:t.options)?o:[]).find((e=>(null==e?void 0:e.column_name)===a)))||!n.is_dttm);var n,o}},D={type:"DateFilterControl",freeForm:!0,label:v.m_.time_range,default:d.vM,description:(0,l.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},O={type:"SelectControl",freeForm:!0,label:(0,l.t)("Row limit"),validators:[p.Z],default:1e4,choices:(0,g.m)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,l.t)("Limits the number of rows that get displayed.")},N={type:"CheckboxControl",label:(0,l.t)("Sort Descending"),default:!0,description:(0,l.t)("Whether to sort descending or ascending"),visibility:({controls:e})=>Boolean((null==e?void 0:e.timeseries_limit_metric.value)&&!o()(null==e?void 0:e.timeseries_limit_metric.value))},M={type:"SelectControl",freeForm:!0,label:(0,l.t)("Series limit"),placeholder:(0,l.t)("None"),validators:[p.Z],choices:(0,g.m)(C),clearable:!0,description:(0,l.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},I={type:"SelectControl",freeForm:!0,label:(0,l.t)("Series limit"),placeholder:(0,l.t)("None"),validators:[p.Z],choices:(0,g.m)(C),description:(0,l.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},L={type:"SelectControl",freeForm:!0,label:(0,l.t)("Y Axis Format"),renderTrigger:!0,default:f.Ul,choices:f.F6,description:f.YD,tokenSeparators:["\n","\t",";"],filterOption:({data:e},t)=>e.label.includes(t)||e.value.includes(t),mapStateToProps:e=>{var t,a;return{choices:(null==(t=e.controls)||null==(a=t.comparison_type)?void 0:a.value)===h.wj.Percentage?f.F6.filter((e=>e[0].includes("%"))):f.F6}}},k={type:"SelectControl",freeForm:!0,label:(0,l.t)("Time format"),renderTrigger:!0,default:f._r,choices:f.HC,description:f.oq,filterOption:({data:e},t)=>e.label.includes(t)||e.value.includes(t)},F={type:"ColorSchemeControl",label:(0,l.t)("Color Scheme"),default:b.getDefaultKey(),renderTrigger:!0,choices:()=>b.keys().map((e=>[e,e])),description:(0,l.t)("The color scheme for rendering chart"),schemes:()=>b.getMap(),mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},P={type:"PlaceNameMappingControl",label:(0,l.t)("Place Name Mapping"),renderTrigger:!0,default:null,description:(0,l.t)("Place Name Mapping")},$={type:"CheckboxControl",label:(0,l.t)("Truncate Metric"),default:!0,description:(0,l.t)("Whether to truncate metrics")},U={type:"CheckboxControl",label:(0,l.t)("Show empty columns"),default:!0,description:(0,l.t)("Show empty columns")},V={type:"HiddenControl",initialValue:(e,t)=>{var a;return Object.fromEntries((0,m.Z)(null==t||null==(a=t.datasource)?void 0:a.columns).filter((e=>e.is_dttm)).map((e=>{var t;return[null!=(t=e.column_name)?t:e.name,e.is_dttm]})))}},q={metrics:y.ql,metric:y.iQ,datasource:Z,viz_type:S,color_picker:x,metric_2:y.db,linear_color_scheme:w,secondary_metric:y.iR,groupby:y.xM,columns:y.lC,granularity:A,granularity_sqla:y.UQ,time_grain_sqla:R,time_range:D,row_limit:O,limit:M,timeseries_limit_metric:y.x$,orderby:y.x$,order_desc:N,series:y.Z8,entity:y.QF,x:y.aG,y:y.$c,size:y.sH,y_axis_format:L,x_axis_time_format:k,adhoc_filters:y.RW,color_scheme:F,place_name_mapping:P,series_columns:y.lC,series_limit:I,series_limit_metric:y.x$,legacy_order_by:y.x$,truncate_metric:$,x_axis:y.Pi,show_empty_columns:U,temporal_columns_lookup:V}},338575:(e,t,a)=>{a.d(t,{D_:()=>u,FC:()=>l,It:()=>d,JQ:()=>p,O9:()=>o,f:()=>i,pp:()=>n,vD:()=>r,xN:()=>s,zy:()=>c});const n=e=>{var t,a;return(null==e||null==(t=e.standardizedFormData)?void 0:t.controls)&&(null==e||null==(a=e.standardizedFormData)?void 0:a.memorizedFormData)&&Array.isArray(e.standardizedFormData.controls.metrics)&&Array.isArray(e.standardizedFormData.controls.columns)};var o;!function(e){e.NONE="None",e.EQUAL="=",e.NOT_EQUAL="\u2260",e.LESS_THAN="<",e.LESS_OR_EQUAL="\u2264",e.GREATER_THAN=">",e.GREATER_OR_EQUAL="\u2265",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL="\u2264 x \u2264",e.BETWEEN_OR_LEFT_EQUAL="\u2264 x <",e.BETWEEN_OR_RIGHT_EQUAL="< x \u2264",e.LIKE="LIKE",e.NOT_LIKE="NOT_LIKE"}(o||(o={}));const r=[o.BETWEEN,o.BETWEEN_OR_EQUAL,o.BETWEEN_OR_LEFT_EQUAL,o.BETWEEN_OR_RIGHT_EQUAL],i=[o.LESS_THAN,o.LESS_OR_EQUAL,o.GREATER_THAN,o.GREATER_OR_EQUAL];var l;function s(e){return!!e&&"column_name"in e}function c(e){return"column_name"in e&&"expression"in e&&!!e.expression}function u(e){return null!==e}function d(e){return!!e&&"columns"in e}function p(e){return!!e&&"results"in e&&"sql"in e}!function(e){e.NONE="None",e.UP="UP",e.DOWN="DOWN"}(l||(l={}))},558842:(e,t,a)=>{a.d(t,{F6:()=>c,HC:()=>d,Ul:()=>p,YD:()=>i,_r:()=>h,oq:()=>u,pj:()=>l,u6:()=>s});var n=a(455867),o=a(645636),r=a(778900);const i=(0,n.t)("D3 format syntax: https://github.com/d3/d3-format"),l=(0,n.t)('Only applies when "Label Type" is set to show values.'),s=(0,n.t)('Only applies when "Label Type" is not set to a percentage.'),c=[[o.Z.SMART_NUMBER,(0,n.t)("Adaptive formatting")],["~g",(0,n.t)("Original value")],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".2%",".2% (12345.432 => 1234543.20%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.1f",",.1f (12345.432 => 12,345.4)"],[",.2f",",.2f (12345.432 => 12,345.43)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION",(0,n.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,n.t)("Duration in ms (1.40008 => 1ms 400\xb5s 80ns)")]],u=(0,n.t)("D3 time format syntax: https://github.com/d3/d3-time-format"),d=[[r.Z.id,(0,n.t)("Adaptive formatting")],["%d/%m/%Y","%d/%m/%Y | 14/01/2019"],["%m/%d/%Y","%m/%d/%Y | 01/14/2019"],["%Y-%m-%d","%Y-%m-%d | 2019-01-14"],["%Y-%m-%d %H:%M:%S","%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10"],["%d-%m-%Y %H:%M:%S","%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10"],["%H:%M:%S","%H:%M:%S | 01:32:10"]],p=c[0][0],h=d[0][0]},419835:(e,t,a)=>{a.d(t,{R:()=>o});var n=a(46078);const o=e=>null!=e&&e.hasOwnProperty("metrics")?(null==e?void 0:e.metrics)||[]:n.BH},389368:(e,t,a)=>{a.d(t,{$:()=>i,q:()=>l});var n=a(667294),o=a(510162),r=a(539650);function i(e){return"string"===typeof e&&e in o.ZP?o.ZP[e]:e}function l(e,t={}){if("string"===typeof e&&e in r.ZP){const a=e;return{name:a,config:{...r.ZP[a],...t[a]}}}if(!e||"string"===typeof e||n.isValidElement(e))return e;if("name"in e&&"config"in e)return{...e,config:{...e.config,type:i(e.config.type)}};if("override"in e&&e.name in r.ZP){const{name:t,override:a}=e;return{name:t,config:{...r.ZP[t],...a}}}return null}},320002:(e,t,a)=>{a.d(t,{u:()=>r});var n=a(601875),o=a(338575);const r=(0,n.Z)(class{constructor(){this.controls=void 0,this.controls={metrics:[],columns:[]}}setStandardizedControls(e){if((0,o.pp)(e)){const{controls:t}=e.standardizedFormData;this.controls={metrics:t.metrics,columns:t.columns}}}shiftMetric(){return this.controls.metrics.shift()}shiftColumn(){return this.controls.columns.shift()}popAllMetrics(){return this.controls.metrics.splice(0,this.controls.metrics.length)}popAllColumns(){return this.controls.columns.splice(0,this.controls.columns.length)}clear(){this.controls={metrics:[],columns:[]}}})},945211:(e,t,a)=>{a.d(t,{X:()=>i,x:()=>l});var n=a(355786),o=a(237731),r=a(338575);function i(e){const t={temporalColumns:[],defaultTemporalColumn:void 0};var a,i,l;((0,r.It)(e)&&(t.temporalColumns=(0,n.Z)(e.columns).filter((e=>e.is_dttm))),(0,r.JQ)(e)&&(t.temporalColumns=(0,n.Z)(e.columns).filter((e=>e.is_dttm))),(0,r.It)(e)&&(t.defaultTemporalColumn=e.main_dttm_col),(0,o.Z)(t.defaultTemporalColumn))||(t.defaultTemporalColumn=null!=(a=null==(i=t.temporalColumns[0])?void 0:i.column_name)?a:null==(l=t.temporalColumns[0])?void 0:l.name);return t}function l(e,t){const a=i(t).temporalColumns;for(let t=0;t<a.length;t+=1)if(a[t].column_name===e)return!0;return!1}},806126:(e,t,a)=>{function n(e){return e.map((e=>Array.isArray(e)?e:[e,e.toString()]))}function o(e,t){const a=[];for(let n=e;n<=t;n+=1)a.push([n,n.toString()]);return a}a.d(t,{B:()=>o,m:()=>n})},837687:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(590537),o=a(601875);class r extends n.Z{constructor(){super({name:"ChartControlPanel"})}}const i=(0,o.Z)(r)},616355:(e,t,a)=>{var n,o,r;a.d(t,{Df:()=>r,Tr:()=>o,ZP:()=>c,cg:()=>n,eH:()=>l,t$:()=>i,we:()=>s}),function(e){e.INTERACTIVE_CHART="INTERACTIVE_CHART",e.NATIVE_FILTER="NATIVE_FILTER",e.DRILL_TO_DETAIL="DRILL_TO_DETAIL"}(n||(n={})),function(e){e.EXPLORE="EXPLORE",e.DASHBOARD="DASHBOARD",e.FILTER_BAR="FILTER_BAR",e.FILTER_CONFIG_MODAL="FILTER_CONFIG_MODAL",e.EMBEDDED="EMBEDDED"}(o||(o={})),function(e){e.DEPRECATED="DEPRECATED",e.FEATURED="FEATURED"}(r||(r={}));const i={[r.DEPRECATED]:"This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.",[r.FEATURED]:"This chart was tested and verified, so the overall experience should be stable."},l={[r.DEPRECATED]:{weight:-.1},[r.FEATURED]:{weight:.1}};var s;!function(e){e.category="category",e.value="value",e.time="time",e.log="log"}(s||(s={}));const c={}},328062:(e,t,a)=>{a.r(t),a.d(t,{DEFAULT_NAMESPACE:()=>s,default:()=>i,getColor:()=>u,getNamespace:()=>c,getScale:()=>d});var n=a(997466),o=a(281545),r=a(786041);class i{constructor(e){this.name=void 0,this.forcedItems=void 0,this.scales=void 0,this.name=e,this.scales={},this.forcedItems={}}getScale(e){var t,a;const r=null!=(t=null!=e?e:(0,o.Z)().getDefaultKey())?t:"",i=(0,o.Z)().get(r);return new n.Z(null!=(a=null==i?void 0:i.colors)?a:[],this.forcedItems)}setColor(e,t){return this.forcedItems[(0,r.Z)(e)]=t,this}resetColors(){this.forcedItems={}}}const l={},s="GLOBAL";function c(e=s){const t=l[e];if(t)return t;const a=new i(e);return l[e]=a,a}function u(e,t,a){return c(a).getScale(t).getColor(e)}function d(e,t){return c(t).getScale(e)}},997466:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(20285),o=a(454732),r=a(786041),i=a(478161),l=a(25130),s=a(593185);class c extends o.Z{constructor(e,t={}){super(((e,t)=>this.getColor(e,t))),this.originColors=void 0,this.colors=void 0,this.scale=void 0,this.parentForcedColors=void 0,this.forcedColors=void 0,this.multiple=void 0,this.originColors=e,this.colors=e,this.scale=(0,n.Z)(),this.scale.range(e),this.parentForcedColors=t,this.forcedColors={},this.multiple=0}getColor(e,t){var a,n;const o=(0,r.Z)(e),c=(0,i.ZP)();let u=(null==(a=this.parentForcedColors)?void 0:a[o])||(null==(n=this.forcedColors)?void 0:n[o])||c.getColorMap().get(o);if((0,s.c)(s.T.USE_ANALAGOUS_COLORS)){const e=Math.floor(this.domain().length/this.originColors.length);if(e>this.multiple){this.multiple=e;const t=(0,l.Gh)(this.originColors,e);this.range(this.originColors.concat(t))}}const d=this.scale(o);return u||(u=d),c.addSlice(o,u,t),u}setColor(e,t){return this.forcedColors[(0,r.Z)(e)]=t,this}getColorMap(){const e={};return this.scale.domain().forEach((t=>{e[t.toString()]=this.scale(t)})),{...e,...this.forcedColors,...this.parentForcedColors}}copy(){const e=new c(this.scale.range(),this.parentForcedColors);return e.forcedColors={...this.forcedColors},e.domain(this.domain()),e.unknown(this.unknown()),e}domain(e){return"undefined"===typeof e?this.scale.domain():(this.scale.domain(e),this)}range(e){return"undefined"===typeof e?this.scale.range():(this.colors=e,this.scale.range(e),this)}unknown(e){return"undefined"===typeof e?this.scale.unknown():(this.scale.unknown(e),this)}}const u=c},478161:(e,t,a)=>{a.d(t,{Ag:()=>n,Xs:()=>i,ZP:()=>l});var n,o=a(328062),r=a(601875);!function(e){e[e.dashboard=0]="dashboard",e[e.explore=1]="explore"}(n||(n={}));class i{constructor(){this.sliceLabelMap=void 0,this.colorMap=void 0,this.source=void 0,this.sliceLabelMap=new Map,this.colorMap=new Map,this.source=n.dashboard}updateColorMap(e,t){const a=o.getNamespace(e),n=new Map;this.colorMap.clear(),this.sliceLabelMap.forEach((e=>{const o=a.getScale(t);e.forEach((e=>{const t=o(e);n.set(e,t)}))})),this.colorMap=n}getColorMap(){return this.colorMap}addSlice(e,t,a){if(this.source!==n.dashboard||void 0===a)return;const o=this.sliceLabelMap.get(a)||[];o.includes(e)||(o.push(e),this.sliceLabelMap.set(a,o)),this.colorMap.set(e,t)}removeSlice(e){if(this.source!==n.dashboard)return;this.sliceLabelMap.delete(e);const t=new Map;this.sliceLabelMap.forEach((e=>{e.forEach((e=>{t.set(e,this.colorMap.get(e))}))})),this.colorMap=t}reset(){new Map(this.colorMap).forEach(((e,t)=>{this.colorMap.set(t,"")}))}clear(){this.sliceLabelMap.clear(),this.colorMap.clear()}}const l=(0,r.Z)(i)},786041:(e,t,a)=>{function n(e){return String(e).trim()}a.d(t,{Z:()=>n})},25130:(e,t,a)=>{a.d(t,{Gh:()=>l,Qg:()=>i,Zf:()=>s,oo:()=>u,vq:()=>d,xG:()=>c});var n=a(717621),o=a.n(n);const r=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/;function i(e,t=186){let a=0,n=0,o=0;if(e.length>7){const t=r.exec(e);if(!t)throw new Error(`Invalid color: ${e}`);a=parseInt(t[1],10),n=parseInt(t[2],10),o=parseInt(t[3],10)}else{let t=e;if(t.startsWith("#")&&(t=t.substring(1)),3===t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]].join("")),6!==t.length)throw new Error(`Invalid color: ${e}`);a=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16)}return.299*a+.587*n+.114*o>t?"#000":"#FFF"}function l(e,t){const a=[],n=e.map((e=>o()(e).analogous(t+3).slice(3)));for(;null!=(r=n[n.length-1])&&r.length;){var r;n.forEach((e=>{const t=e.shift();a.push(t.toHexString())}))}return a}function s(e,t){if(t>1||t<0)throw new Error(`The opacity should between 0 and 1, but got: ${t}`);return`${e}${`0${Math.round(255*t).toString(16).toUpperCase()}`.slice(-2)}`}function c(e){return o()(e).isValid()&&/(^#[0-9A-Fa-f]{8}$)|(^#[0-9A-Fa-f]{4}$)|(rgba\((\s*\d{1,3}\s*,){2}\s*\d{1,3}\s*(,\s*\d(\.\d{1,})?)?\))/i.test(e)}function u(e){let t="0",a="0",n="0";return 4===e.length?(t=`0x${e[1]}${e[1]}`,a=`0x${e[2]}${e[2]}`,n=`0x${e[3]}${e[3]}`):7===e.length&&(t=`0x${e[1]}${e[2]}`,a=`0x${e[3]}${e[4]}`,n=`0x${e[5]}${e[6]}`),`rgb(${+t}, ${+a}, ${+n})`}function d(e,t,a){let n=e.toString(16),o=t.toString(16),r=a.toString(16);return 1===n.length&&(n=`0${n}`),1===o.length&&(o=`0${o}`),1===r.length&&(r=`0${r}`),`#${n}${o}${r}`}},668122:(e,t,a)=>{a.d(t,{M:()=>o,o:()=>n});const n=250,o=500},581847:(e,t,a)=>{a.d(t,{YW:()=>i,mc:()=>l,vO:()=>r});const n={},o=e=>`__superset__/${e}`;async function r(e,t){const a=o(e);if(!window[a]&&!n[e]){const o=t();n[e]=o,window[a]=await o}return n[e]}async function i(e){return Promise.all(Object.entries(e).map((([e,t])=>r(e,t))))}function l(){Object.keys(n).forEach((e=>{delete window[o(e)],delete n[e]}))}},281928:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(355786);class o{static fromHierarchy(e){const t=(0,n.Z)(e);return{hierarchy:t,currentIdx:t.length>0?0:-1,filters:[]}}static drillDown(e,t){const a=e.currentIdx;return a+1>=e.hierarchy.length?{hierarchy:e.hierarchy,currentIdx:0,filters:[]}:{hierarchy:e.hierarchy,currentIdx:a+1,filters:e.filters.concat({col:e.hierarchy[a],op:"IN",val:[t]})}}static rollUp(e){const t=e.currentIdx,a=e.hierarchy.length;return{hierarchy:e.hierarchy,currentIdx:t-1<0?a-1:t-1,filters:e.filters.slice(0,-1)}}static getColumn(e,t){if(e)return e.hierarchy[e.currentIdx];const a=o.fromHierarchy(t);return a.hierarchy[a.currentIdx]}static getFilters(e,t){if(e)return e.filters;return o.fromHierarchy(t).filters}}},662363:(e,t,a)=>{var n,o;a.d(t,{ZP:()=>r,su:()=>n,wj:()=>o}),function(e){e.Mean="mean",e.Sum="sum",e.Std="std",e.Cumsum="cumsum"}(n||(n={})),function(e){e.Values="values",e.Difference="difference",e.Percentage="percentage",e.Ratio="ratio"}(o||(o={}));const r={}},10916:(e,t,a)=>{var n,o;function r(e){return e.type===n.NATIVE_FILTER}function i(e){var t,a;return r(e)&&(null==(t=e.dataMask)||null==(a=t.filterState)?void 0:a.value)}function l(e){return e.type===n.DIVIDER}a.d(t,{BE:()=>n,S0:()=>i,ZP:()=>s,gT:()=>o,kI:()=>r,nY:()=>l}),function(e){e.NATIVE_FILTER="NATIVE_FILTER",e.DIVIDER="DIVIDER"}(n||(n={})),function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(o||(o={}));const s={}},88889:(e,t,a)=>{var n;a.d(t,{C:()=>o,Z:()=>n}),function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING",e[e.TEMPORAL=2]="TEMPORAL",e[e.BOOLEAN=3]="BOOLEAN"}(n||(n={}));const o={}},662720:(e,t,a)=>{a.d(t,{Z:()=>n});const n=(0,a(611538).Z)({id:"smart_date_detailed",label:"Detailed adaptive formatter",formats:{millisecond:"%Y-%m-%d %H:%M:%S.%L",second:"%Y-%m-%d %H:%M:%S",minute:"%Y-%m-%d %H:%M",hour:"%Y-%m-%d %H:%M",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m-%d",year:"%Y"}})},201111:(e,t,a)=>{function n(e,t){return e===t||!e&&!t||!!(e&&t&&e.length===t.length&&e.every(((e,a)=>e===t[a])))}a.d(t,{Z:()=>n})},375294:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(455867);function o(e){return!(!e||!Number.isNaN(Number(e))&&parseInt(e,10)===Number(e))&&(0,n.t)("is expected to be an integer")}},799298:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(455867);function o(e){return!(!e||!Number.isNaN(Number(e)))&&(0,n.t)("is expected to be a number")}},753506:(e,t,a)=>{a.d(t,{Z:()=>o});const n=["echarts_area","echarts_timeseries_line","echarts_timeseries_scatter","funnel","treemap_v2","sunburst_v2","echarts_timeseries_bar","pie"];function o(e){return n.includes(e)}},895826:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(455867);function o(e){return!!(null===e||"undefined"===typeof e||""===e||Array.isArray(e)&&0===e.length)&&(0,n.t)("cannot be empty")}},300872:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(455867);function o(e){return!("string"===typeof e&&e.trim().length>0&&Number.isFinite(Number(e.trim()))||"number"===typeof e&&Number.isFinite(e))&&(0,n.t)("is expected to be a number")}},937863:(e,t,a)=>{a.d(t,{Z:()=>d,u:()=>u});var n=a(455867),o=a(182140),r=a(550810),i=a(410331),l=a(476445),s=a(444814),c=a(935500);const u={id:0,chartAlert:null,chartStatus:"loading",chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:{},sliceFormData:null,queryController:null,queriesResponse:null,triggerQuery:!0,lastRendered:0};function d(e={},t){const a={[c.ADD_CHART]:()=>({...u,...t.chart}),[c.CHART_UPDATE_SUCCEEDED]:e=>({...e,chartStatus:"success",chartAlert:null,queriesResponse:t.queriesResponse,chartUpdateEndTime:(0,s.zO)()}),[c.CHART_UPDATE_STARTED]:e=>({...e,chartStatus:"loading",chartStackTrace:null,chartAlert:null,chartUpdateEndTime:null,chartUpdateStartTime:(0,s.zO)(),queryController:t.queryController}),[c.CHART_UPDATE_STOPPED]:e=>({...e,chartStatus:"stopped",chartAlert:(0,n.t)("Updating chart was stopped"),chartUpdateEndTime:(0,s.zO)()}),[c.CHART_RENDERING_SUCCEEDED]:e=>({...e,chartStatus:"rendered",chartUpdateEndTime:(0,s.zO)()}),[c.CHART_RENDERING_FAILED]:e=>({...e,chartStatus:"failed",chartStackTrace:t.stackTrace,chartAlert:(0,n.t)("An error occurred while rendering the visualization: %s",t.error)}),[c.CHART_UPDATE_FAILED](e){var a,o,r,i;return{...e,chartStatus:"failed",chartAlert:t.queriesResponse?null==(a=t.queriesResponse)||null==(o=a[0])?void 0:o.error:(0,n.t)("Network error."),chartUpdateEndTime:(0,s.zO)(),queriesResponse:t.queriesResponse,chartStackTrace:t.queriesResponse?null==(r=t.queriesResponse)||null==(i=r[0])?void 0:i.stacktrace:null}},[c.DYNAMIC_PLUGIN_CONTROLS_READY]:e=>({...e,sliceFormData:(0,i.Hu)(t.controlsState)}),[c.TRIGGER_QUERY]:e=>({...e,triggerQuery:t.value,chartStatus:"loading"}),[c.RENDER_TRIGGERED]:e=>({...e,lastRendered:t.value}),[c.UPDATE_QUERY_FORM_DATA]:e=>({...e,latestQueryFormData:t.value}),[c.ANNOTATION_QUERY_STARTED](e){var a;null!=(a=e.annotationQuery)&&a[t.annotation.name]&&e.annotationQuery[t.annotation.name].abort();const n={...e.annotationQuery,[t.annotation.name]:t.queryController};return{...e,annotationQuery:n}},[c.ANNOTATION_QUERY_SUCCESS](e){const a={...e.annotationData,[t.annotation.name]:t.queryResponse.data},n={...e.annotationError};delete n[t.annotation.name];const o={...e.annotationQuery};return delete o[t.annotation.name],{...e,annotationData:a,annotationError:n,annotationQuery:o}},[c.ANNOTATION_QUERY_FAILED](e){const a={...e.annotationData};delete a[t.annotation.name];const o={...e.annotationError,[t.annotation.name]:t.queryResponse?t.queryResponse.error:(0,n.t)("Network error.")},r={...e.annotationQuery};return delete r[t.annotation.name],{...e,annotationData:a,annotationError:o,annotationQuery:r}}};if(t.type===c.REMOVE_CHART)return delete e[t.key],e;if(t.type===c.UPDATE_CHART_ID){const{newId:a,key:n}=t;return e[a]={...e[n],id:a},delete e[n],e}return t.type===o.$||t.type===l._?{...t.data.charts}:t.type===r.Rn.SET_DATASOURCES?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"failed"===t.chartStatus&&t.chartStackTrace?{...t,chartStatus:"",chartStackTrace:null,chartAlert:null}:t]))):t.type===c.CHART_FILTER?(e[t.key].filters=t.filters,e[t.key].groupbys=t.groupbys,{...e}):t.type===c.REMOVE_CHART_FILTER?(delete e[t.key].filters,delete e[t.key].groupbys,{...e}):t.type===c.SET_FORM_DATA_META?null!=(d=e[t.key])&&d.form_data?(e[t.key].form_data.meta=t.meta,e):e:t.type===c.UPDATE_CHART_CHANGED_INFO?{...e,[t.key]:{...e[t.key],changedInfo:t.changedInfo}}:t.type in a?{...e,[t.key]:a[t.type](e[t.key])}:e;var d}},569175:(e,t,a)=>{a.d(t,{$t:()=>r,xW:()=>n});a(393386);const n=32,o=32;function r(e,t){const a=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),r=n*t+o;return a-e<r?a-r:e}},513842:(e,t,a)=>{a.d(t,{dc:()=>i,lU:()=>r,zq:()=>l});a(667294);var n=a(751995),o=a(211965);const r=()=>{const e=(0,n.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z",fill:e.colors.primary.base}),(0,o.tZ)("path",{d:"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z",fill:"white"}))},i=()=>{const e=(0,n.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light1}),(0,o.tZ)("path",{d:"M14 10H4V8H14V10Z",fill:"white"}))},l=()=>{const e=(0,n.Fg)();return(0,o.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light2}),(0,o.tZ)("path",{d:"M16 2V16H2V2H16V2Z",fill:"white"}))}},787253:(e,t,a)=>{a.d(t,{lU:()=>l.lU,zq:()=>l.zq,ZP:()=>i});a(667294);var n=a(751995),o=a(211965);const r=n.iK.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function i({checked:e,onChange:t,style:a,className:n}){return(0,o.tZ)(r,{style:a,onClick:()=>{t(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox",className:n||""},e?(0,o.tZ)(l.lU,null):(0,o.tZ)(l.zq,null))}var l=a(513842)},267051:(e,t,a)=>{a.d(t,{Z:()=>U});var n=a(667294),o=a(164561),r=a(751995),i=a(616355),l=a(454076),s=a(131567),c=a(72182),u=a(205872),d=a.n(u),p=a(23279),h=a.n(p),m=a(890057),g=a(355786),f=a(310581),v=a(662720),y=a(455867),b=a(49937),_=a(985633),C=a(356080),E=a(427600),T=a(609332),Z=a(211965);const S={type:"filterState",__cache:{},extraFormData:{},filterState:{value:null,label:""}},x=(e=S,t)=>{switch(t.type){case"ownState":return e.ownState={...e.ownState,...t.ownState},e;case"filterState":return e.extraFormData=t.extraFormData,e.__cache=t.__cache,e.filterState={...e.filterState,...t.filterState},e;default:return e}};function w(e){const{appSection:t,showOverflow:a,parentRef:o,data:r,coltypeMap:l,filterState:s,formData:c,inputRef:u,isRefreshing:d,onChange:p,setDataMask:S,setFocusedFilter:w,unsetFocusedFilter:A,setFilterActive:R}=e,{enableEmptyFilter:D=!1,defaultToFirstItem:O=!1,inverseSelection:N=!1,showSearch:M=!0,sortAscending:I,multiSelect:L,searchAllOptions:k}=c||{},[F,P]=(0,m.C)(x,{extraFormData:{},filterState:s}),[$]=(0,n.useState)(l),U=(0,n.useMemo)((()=>(0,g.Z)(c.groupby).map(f.Z)),[c.groupby]),[V]=U,q=l[V],H=(0,n.useMemo)((()=>(0,C.EG)({timeFormatter:v.Z})),[]),z=(0,n.useCallback)((e=>{const a=D&&!N&&!(null!=e&&e.length),n=N&&null!=e&&e.length?(0,y.t)(" (excluded)"):"";P({type:"filterState",__cache:s,extraFormData:(0,C.vb)(V,e,a,N),filterState:{...s,label:null!=e&&e.length?`${(e||[]).map((e=>H(e,q))).join(", ")}${n}`:void 0,value:t===i.Tr.FILTER_CONFIG_MODAL&&O?void 0:e}})}),[t,V,q,O,P,D,N,JSON.stringify(s),H]);(0,n.useEffect)((()=>{var e;p(null!=(e=null==s?void 0:s.value)?e:[])}),[JSON.stringify(s.value)]);const j=(0,n.useCallback)((e=>{const t=null===e?[null]:(0,g.Z)(e);0===t.length?z(null):z(t),p(t)}),[z,p]),B=(0,n.useCallback)((()=>{S(F)}),[JSON.stringify(F)]);(0,T.d)(B);const G=0===r.length?(0,y.t)("No data"):(0,y.tn)("%s option","%s options",r.length,r.length),W=t===i.Tr.FILTER_CONFIG_MODAL&&O,Y=(0,n.useMemo)((()=>{const e=[];return r.forEach((t=>{const[a]=U.map((e=>t[e]));e.push({label:H(a,q),value:a})})),e}),[r,q,U,H]),K=(0,n.useCallback)(h()((e=>{P({type:"ownState",ownState:{coltypeMap:$,search:e}})}),E.M$),[]),Q=(0,n.useCallback)((e=>{k&&K(e)}),[K,k]),J=(0,n.useCallback)((()=>{k&&P({type:"ownState",ownState:{coltypeMap:$,search:null}})}),[P,$,k]),X=(0,n.useCallback)((()=>{J(),A()}),[J,A]),ee=(0,n.useCallback)(((e,t)=>{const a=(0,_.mj)("label");return I?a(e,t):a(t,e)}),[I]);return(0,Z.tZ)(b.Ph,{allowNewOptions:!0,allowClear:!0,value:(null==s?void 0:s.value)||[],disabled:W,getPopupContainer:a?()=>(null==o?void 0:o.current)||document.body:e=>(null==e?void 0:e.parentNode)||document.body,showSearch:M,mode:L?"multiple":"single",placeholder:G,onSearch:Q,onSelect:J,onBlur:X,onMouseEnter:w,onMouseLeave:A,onChange:j,ref:u,loading:d,maxTagCount:2,invertSelection:N,options:Y,sortComparator:ee,onDropdownVisibleChange:R})}const A=(0,n.forwardRef)(((e,t)=>{const a=n.memo(w);return(0,Z.tZ)(a,d()({},e,{forwardedRef:t}))})),R={type:"filterTextInputState",__cache:{},extraFormData:{},filterState:{value:""}},D=(e=R,t)=>{switch(t.type){case"ownState":return e.ownState={...e.ownState,...t.ownState},e;case"filterTextInputState":return e.extraFormData=t.extraFormData,e.__cache=t.__cache,e.filterState={...e.filterState,...t.filterState},e;default:return e}};const O=function(e){const{appSection:t,showOverflow:a,parentRef:o,data:r,coltypeMap:l,filterState:s,formData:c,inputRef:u,isRefreshing:d,onChange:p,setDataMask:S,setFocusedFilter:x,unsetFocusedFilter:w,setFilterActive:A}=e,{enableEmptyFilter:R=!1,defaultToFirstItem:O=!1,inverseSelection:N=!1,showSearch:M=!0,sortAscending:I,multiSelect:L,searchAllOptions:k}=c||{},[F,P]=(0,m.C)(D,{extraFormData:{},filterState:s}),[$]=(0,n.useState)(l),[U,V]=(0,n.useState)(""),q=(0,n.useMemo)((()=>(0,g.Z)(c.groupby).map(f.Z)),[c.groupby]),[H]=q,z=l[H],j=(0,n.useMemo)((()=>(0,C.EG)({timeFormatter:v.Z})),[]),B=(0,n.useCallback)((e=>{const a=R&&!N&&!(null!=e&&e.length);N&&null!=e&&e.length&&(0,y.t)(" (excluded)");P({type:"filterTextInputState",__cache:s,extraFormData:(0,C.r6)(H,e,a,N),filterState:{...s,value:t===i.Tr.FILTER_CONFIG_MODAL&&O?"":e}})}),[t,H,z,O,P,R,N,JSON.stringify(s),j]);(0,n.useEffect)((()=>{var e;p(null!=(e=null==s?void 0:s.value)?e:"")}),[JSON.stringify(s.value)]);const G=(0,n.useCallback)((e=>{var t;const a=(null==e||null==(t=e.target)?void 0:t.value)||"";B(a),p(a),V(a)}),[B,p]),W=(0,n.useCallback)((()=>{S(F)}),[JSON.stringify(F)]);(0,T.d)(W),0===r.length?(0,y.t)("No data"):(0,y.tn)("%s option","%s options",r.length,r.length),i.Tr.FILTER_CONFIG_MODAL,(0,n.useMemo)((()=>{const e=[];return r.forEach((t=>{const[a]=q.map((e=>t[e]));e.push({label:j(a,z),value:a})})),e}),[r,z,q,j]);const Y=(0,n.useCallback)(h()((e=>{P({type:"ownState",ownState:{coltypeMap:$,search:e}})}),E.M$),[]),K=((0,n.useCallback)((e=>{k&&Y(e)}),[Y,k]),(0,n.useCallback)((()=>{k&&P({type:"ownState",ownState:{coltypeMap:$,search:null}})}),[P,$,k]));return(0,n.useCallback)((()=>{K(),w()}),[K,w]),(0,n.useCallback)(((e,t)=>{const a=(0,_.mj)("label");return I?a(e,t):a(t,e)}),[I]),(0,Z.tZ)(b.oc,{placeholder:"\u8f93\u5165\u641c\u7d22\u6587\u5b57",value:U,onChange:G})};var N=a(287183);const M={type:"filterTabState",__cache:{},extraFormData:{},filterState:{value:null,label:""}},I=(e=M,t)=>{switch(t.type){case"ownState":return e.ownState={...e.ownState,...t.ownState},e;case"filterTabState":return e.extraFormData=t.extraFormData,e.__cache=t.__cache,e.filterState={...e.filterState,...t.filterState},e;default:return e}};function L(e){var t;const{appSection:a,data:o,coltypeMap:r,filterState:l,formData:s,onChange:c,setDataMask:u,unsetFocusedFilter:d}=e,{enableEmptyFilter:p=!1,defaultToFirstItem:b=!1,inverseSelection:S=!1,sortAscending:x,searchAllOptions:w}=s||{},[A,R]=(0,m.C)(I,{extraFormData:{},filterState:l}),[D]=(0,n.useState)(r),O=(0,n.useMemo)((()=>(0,g.Z)(s.groupby).map(f.Z)),[s.groupby]),[M]=O,L=r[M],k=(0,n.useMemo)((()=>(0,C.EG)({timeFormatter:v.Z})),[]),F=(0,n.useCallback)((e=>{const t=p&&!S&&!(null!=e&&e.length),n=S&&null!=e&&e.length?(0,y.t)(" (excluded)"):"";R({type:"filterTabState",__cache:l,extraFormData:(0,C.vb)(M,e,t,S),filterState:{...l,label:null!=e&&e.length?`${(e||[]).map((e=>k(e,L))).join(", ")}${n}`:void 0,value:a===i.Tr.FILTER_CONFIG_MODAL&&b?void 0:e}})}),[a,M,L,b,R,p,S,JSON.stringify(l),k]);(0,n.useEffect)((()=>{var e;c(null!=(e=null==l?void 0:l.value)?e:[])}),[JSON.stringify(l.value)]);const P=(0,n.useCallback)((e=>{const t=null===e?[null]:(0,g.Z)(e);0===t.length?F(null):F(t),c(t)}),[F,c]),$=(0,n.useCallback)((()=>{u(A)}),[JSON.stringify(A)]);(0,T.d)($);0===o.length?(0,y.t)("No data"):(0,y.tn)("%s option","%s options",o.length,o.length),i.Tr.FILTER_CONFIG_MODAL;const U=(0,n.useMemo)((()=>{const e=[];return o.forEach((t=>{const[a]=O.map((e=>t[e]));e.push({label:k(a,L),value:a})})),e}),[o,L,O,k]),V=(0,n.useCallback)(h()((e=>{R({type:"ownState",ownState:{coltypeMap:D,search:e}})}),E.M$),[]),q=((0,n.useCallback)((e=>{w&&V(e)}),[V,w]),(0,n.useCallback)((()=>{w&&R({type:"ownState",ownState:{coltypeMap:D,search:null}})}),[R,D,w]));(0,n.useCallback)((()=>{q(),d()}),[q,d]),(0,n.useCallback)(((e,t)=>{const a=(0,_.mj)("label");return x?a(e,t):a(t,e)}),[x]);return(0,Z.tZ)(N.Y.Group,{options:U,onChange:e=>{const{target:{value:t}}=e;P(t)},value:(null==l||null==(t=l.value)?void 0:t[0])||"",optionType:"button"})}const k=(0,n.forwardRef)(((e,t)=>{const a=n.memo(L);return(0,Z.tZ)(a,d()({},e,{forwardedRef:t}))})),{Item:F}=o.Z,P=(0,r.iK)((({children:e,...t})=>(0,Z.tZ)(F,t,e)))`
  margin: 0;
`;class $ extends n.PureComponent{constructor(...e){super(...e),this.renderControl=e=>{let t;const{formData:a,queriesData:n,filterState:o,inputRef:r,isRefreshing:u,hooks:d,appSection:p,mobileStatus:h=!1,hiddenDomExceptTab:m=!1}=this.props,g={...s.E,...a},{setDataMask:f=l.EI,setFocusedFilter:v=l.EI,unsetFocusedFilter:y=l.EI,setFilterActive:b=l.EI}=d,[_]=n,{colnames:C=[],coltypes:E=[],data:T=[]}=_||{},S=C.reduce(((e,t,a)=>({...e,[t]:E[a]})),{});switch(e.controlType){case c.yP.Tab:p===i.Tr.FILTER_CONFIG_MODAL||i.cg.NATIVE_FILTER===e.type&&!h?(g.multiSelect=!1,t=(0,Z.tZ)(A,{filterState:o,onChange:this.change,inputRef:r,isRefreshing:u,data:T,coltypeMap:S,queriesData:n,formData:g,setDataMask:f,setFocusedFilter:v,unsetFocusedFilter:y,setFilterActive:b})):t=h&&!m?null:(0,Z.tZ)(k,{filterState:o,onChange:this.change,isRefreshing:u,data:T,coltypeMap:S,queriesData:n,formData:g,setDataMask:f,setFocusedFilter:v,unsetFocusedFilter:y,setFilterActive:b});break;case c.yP.Select:t=(0,Z.tZ)(A,{filterState:o,onChange:this.change,inputRef:r,isRefreshing:u,data:T,coltypeMap:S,queriesData:n,formData:g,setDataMask:f,setFocusedFilter:v,unsetFocusedFilter:y,setFilterActive:b});break;case c.yP.Input:t=(0,Z.tZ)(O,{filterState:o,onChange:e=>{this.change(e,"filter_textinput")},isRefreshing:u,data:T,coltypeMap:S,queriesData:n,formData:g,setDataMask:f,setFocusedFilter:v,unsetFocusedFilter:y,setFilterActive:b})}return h&&m&&e.controlType!==c.yP.Tab&&(t=null),this.wrapFormItem(e,t)},this.wrapFormItem=(e,t)=>(0,Z.tZ)(P,{label:null},t),this.change=(e,t)=>{const{control:a,hooks:n}=this.props,{onChange:o=l.EI}=n;o(a,e,t)}}render(){const{control:e}=this.props;return(0,Z.tZ)(n.Suspense,{fallback:null},this.renderControl(e))}}$.defaultProps={};const U=$},72182:(e,t,a)=>{var n,o,r,i;a.d(t,{kl:()=>s,xy:()=>r,yP:()=>i}),function(e){e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(n||(n={})),function(e){e.Prev="prev",e.Current="current",e.Next="next"}(o||(o={})),function(e){e.Global="global",e.Local="local"}(r||(r={})),function(e){e.Select="select",e.Input="input",e.Tab="tab"}(i||(i={}));i.Select,i.Input,i.Tab;var l,s;!function(e){e.Dynamic="dynamic",e.Fixed="fixed"}(l||(l={})),function(e){e.Visible="visible",e.Hidden="hidden",e.Conditional="conditional"}(s||(s={}));i.Select},198201:(e,t,a)=>{a.d(t,{$W:()=>i,eP:()=>u,j0:()=>s,nI:()=>c,xK:()=>l});a(667294),a(714670),a(730381);var n=a(355786),o=a(301510),r=a(72182);function i(e){const t=[],a={};for(;e.length;){const n={...e[0]};if(a[n.key]=n,n.parent){if(!a[n.parent]){delete a[n.key],e.shift();continue}a[n.parent].children||(a[n.parent].children=[]),a[n.parent].children.push(n)}else t.push(n);e.shift()}return{renderTree:t,flatTree:a}}function l(e,t,a){const n=[],o={};t.forEach((e=>{o[e.key]=function(e){const{type:t,defaultValue:a}=e;return a}(e),n.push({...e})}));const{renderTree:r,flatTree:l}=i(n);return{renderTree:r,flatTree:l,defaultValues:o}}function s(e,t,a){const{visibility:n}=t;switch(n){case r.kl.Visible:return!0;case r.kl.Hidden:return!1;default:return!0}}function c(e,t){var a,n;let o=[];return(null!=(a=null==(n=t[e])?void 0:n.children)?a:[]).forEach((e=>{o=o.concat(e.key).concat(c(e.key,t))})),o}function u(e,t){let a={};return(0,n.Z)(e).forEach((e=>{const n=null==t?void 0:t[e];a=(0,o.on)(a,null==n?void 0:n.extraFormData)})),a}},190551:(e,t,a)=>{a.d(t,{Q:()=>L,W:()=>q});var n,o=a(150361),r=a.n(o),i=a(667294),l=a(748086),s=a(731293),c=a(229487),u=a(455867),d=a(751995),p=a(431069),h=a(205872),m=a.n(h),g=a(3006),f=a(211965);!function(e){e.Default="Default",e.Small="Small"}(n||(n={}));const v=d.iK.div`
  ${({scrollTable:e,theme:t})=>e&&`\n    flex: 1 1 auto;\n    margin-bottom: ${4*t.gridUnit}px;\n    overflow: auto;\n  `}

  .table-row {
    ${({theme:e,small:t})=>!t&&`height: ${11*e.gridUnit-1}px;`}

    .table-cell {
      ${({theme:e,small:t})=>t&&`\n        padding-top: ${e.gridUnit+1}px;\n        padding-bottom: ${e.gridUnit+1}px;\n        line-height: 1.45;\n      `}
    }
  }

  th[role='columnheader'] {
    z-index: 1;
    border-bottom: ${({theme:e})=>`${e.gridUnit-2}px solid ${e.colors.grayscale.light2}`};
    ${({small:e})=>e&&"padding-bottom: 0;"}
  }
`,y=({columns:e,data:t,pageSize:a,totalCount:o=t.length,loading:r=!1,withPagination:l=!0,emptyWrapperType:s=n.Default,noDataText:c,showRowCount:u=!0,serverPagination:d=!1,scrollTopOnPagination:p=!1,...h})=>{const y=(0,i.useRef)(null);return(0,f.tZ)(i.Fragment,null,(0,f.tZ)(v,m()({},h,{ref:y}),(0,f.tZ)(g.Z,{columns:e,dataSource:t,loading:r,pagination:!1,size:"small"})))},b=i.memo(y);var _=a(774069),C=a(835932),E=a(998286),T=a(838703),Z=a(9875),S=a(652389),x=a(414114),w=a(222545);const A=(0,u.t)("Warning! Changing the dataset may break the chart if the metadata does not exist."),R=(0,u.t)("Changing the dataset may break the chart if the chart relies on columns or metadata that does not exist in the target dataset"),D=(0,d.iK)(_.Z)`
  .ant-modal-body {
    display: flex;
    flex-direction: column;
  }
`,O=d.iK.div`
  .btn-container {
    display: flex;
    justify-content: flex-end;
    padding: 0px 15px;
    margin: 10px 0 0 0;
  }

  .confirm-modal-container {
    margin: 9px;
  }
`,N=d.iK.span`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.dark1};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.dark2};
  }
`,M={fontSize:"16px",verticalAlign:"middle",paddingTop:"3px"},I={0:(0,f.tZ)(s.Z.DatasetSqlicon,{iconColor:"#5D9CEC",style:M}),1:(0,f.tZ)(s.Z.DatasetSqllicon,{iconColor:"#FF8800",style:M}),2:(0,f.tZ)(s.Z.DatasetExcleicon,{iconColor:"#34c724",style:M}),3:(0,f.tZ)(s.Z.DatasetUnionicon,{iconColor:"#d136d1",style:M}),4:(0,f.tZ)(s.Z.DatabaseApi,{iconColor:"#04B49C",style:M})},L=(0,x.ZP)((({addDangerToast:e,addSuccessToast:t,onChange:a,onDatasourceSave:o,onHide:s,show:d})=>{const[h,m]=(0,i.useState)(""),[g,v]=(0,i.useState)(!1),[y,_]=(0,i.useState)(),x=(0,i.useRef)(null),[M,L]=(0,i.useState)([]),[k,F]=(0,i.useState)(),[P,$]=(0,i.useState)();(0,i.useEffect)((()=>{U()}),[h]);const U=()=>{F(!0),p.Z.get({endpoint:"/api/v2/dataset/group/"+(h?"?name="+h:"")}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){F(!1);const t=e.json.meta.data,a=V(t);L(a),$(e.json.meta.data)}else l.ZP.error(e.json.meta.message),F(!1)}))},V=(e=[])=>{const t=[];return e.forEach((e=>{let a={};Object.hasOwnProperty.call(e,"dataset_id")?(!1!==e.mark&&(e.dataset_name=(0,f.tZ)("div",{style:{display:"flex",lineHeight:"16px"}},(0,f.tZ)("div",{style:{color:"#000",width:"50px",height:"15px",borderRadius:"20px",background:"#c2bcbc",lineHeight:"16px",textAlign:"center",marginRight:"5px",fontSize:"12"}},"\u5e38\u7528"),e.dataset_name)),a=r()(e),a.id=e.dataset_id,a.title=e.dataset_name,a.key="dataset_"+e.dataset_id,a.isLeaf=!0):(a.title=e.name,a.key="group_"+e.group_id,a.isLeaf=!1,e.children.length>0?a.children=V(r()(e.children)):a.children=[],e.datasets.length>0&&(a.children.push(...V(r()(e.datasets))),delete e.datasets)),(a.isLeaf||a.children.length)&&t.push(a)})),t},q=(0,i.useCallback)((e=>{v(!0),_(e)}),[]);(0,i.useEffect)((()=>{d&&(async()=>{setTimeout((()=>{var e;return null==x||null==(e=x.current)?void 0:e.focus()}),200)})()}),[e,a,o,s,q,d]);const H=[{render:(e,t)=>(0,f.tZ)("div",{style:{display:"flex",alignItems:"center"}},Object.prototype.hasOwnProperty.call(I,t.type_classify)&&I[t.type_classify],t.isLeaf?(0,f.tZ)(N,{role:"button",tabIndex:0,"data-test":"datasource-link",onClick:()=>q({type:"table",id:t.id})},t.title):t.title),title:(0,u.t)("name"),dataIndex:"title",key:"title"},{title:(0,u.t)("Type"),dataIndex:"kind",key:"kind"},{title:(0,u.t)("Schema"),dataIndex:"schema",key:"schema"},{title:(0,u.t)("Connection"),dataIndex:"database_name",key:"database_name"},{render:(e,t)=>(0,f.tZ)("div",null,t.isLeaf?(0,f.tZ)(w.Z,{users:[t.changed_by_fk]}):""),title:(0,u.t)("Owners"),dataIndex:"changed_by_fk",key:"owners"}];return(0,f.tZ)(D,{show:d,onHide:s,responsive:!0,title:(0,u.t)("Swap dataset"),width:g?"432px":"",height:g?"auto":"540px",hideFooter:!g,footer:(0,f.tZ)(i.Fragment,null,g&&(0,f.tZ)(O,null,(0,f.tZ)("div",{className:"btn-container"},(0,f.tZ)(C.Z,{onClick:()=>{v(!1)}},(0,u.t)("Cancel")),(0,f.tZ)(C.Z,{className:"proceed-btn",buttonStyle:"primary",onClick:()=>{p.Z.get({endpoint:`/datasource/get/${null==y?void 0:y.type}/${null==y?void 0:y.id}/`}).then((({json:e})=>{o(e),a(`${null==y?void 0:y.id}__table`)})).catch((t=>{(0,E.O$)(t).then((({error:t,message:a})=>{const n=t?t.error||t.statusText||t:a;e(n)}))})),s(),t((0,u.t)("Successfully changed dataset!"))}},(0,u.t)("Proceed")))))},(0,f.tZ)(i.Fragment,null,!g&&(0,f.tZ)(i.Fragment,null,(0,f.tZ)(c.Z,{roomBelow:!0,type:"warning",css:e=>({marginBottom:4*e.gridUnit}),message:(0,f.tZ)(i.Fragment,null,(0,f.tZ)("strong",null,(0,u.t)("Warning!"))," ",R)}),(0,f.tZ)(Z.II,{ref:x,type:"text",value:h,placeholder:(0,u.t)("Search / Filter"),onChange:e=>{var t;const a=null!=(t=e.target.value)?t:"";m(a)}}),k&&(0,f.tZ)(T.Z,null),!k&&(0,f.tZ)(b,{columns:H,data:M,pageSize:S.IV,totalCount:P,className:"table-condensed",emptyWrapperType:n.Small,serverPagination:!0,isPaginationSticky:!0,scrollTable:!0})),g&&(0,f.tZ)(i.Fragment,null,A)))}));var k=a(967913),F=a(591877),P=a(593185);const $=(0,k.Z)((()=>Promise.all([a.e(7734),a.e(88767),a.e(32387),a.e(17982),a.e(86548),a.e(23180)]).then(a.bind(a,123180)))),U=(0,d.iK)(_.Z)`
  .modal-content {
    height: 900px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .modal-header {
    flex: 0 1 auto;
  }
  .modal-body {
    flex: 1 1 auto;
    overflow: auto;
  }

  .modal-footer {
    flex: 0 1 auto;
  }
`;function V(e){const t=null!=e&&e.certified_by||null!=e&&e.certification_details?{certified_by:null==e?void 0:e.certified_by,details:null==e?void 0:e.certification_details}:void 0;return JSON.stringify({certification:t,warning_markdown:null==e?void 0:e.warning_markdown})}const q=(0,x.ZP)((({addSuccessToast:e,datasource:t,onDatasourceSave:a,onHide:n,show:o,addWarningToast:r})=>{const[l,s]=(0,i.useState)(t),[d,h]=(0,i.useState)([]),[m,g]=(0,i.useState)(!1),[v,y]=(0,i.useState)(!1),[b]=(0,i.useState)(t.custom_name||""),T=(0,i.useRef)(null),[Z,S]=_.Z.useModal(),x=()=>{var t,o,r,i;const s=(null==(t=l.tableSelector)?void 0:t.schema)||(null==(o=l.databaseSelector)?void 0:o.schema)||l.schema;g(!0),p.Z.post({endpoint:"/datasource/save/",postPayload:{data:{...l,schema:s,metrics:null==l||null==(r=l.metrics)?void 0:r.map((e=>({...e,extra:V(e)}))),columns:null==l||null==(i=l.columns)?void 0:i.map((e=>({...e,extra:V(e)}))),type:l.type||l.datasource_type,owners:l.owners.map((e=>e.value||e.id))}}}).then((({json:t})=>{e((0,u.t)("The dataset has been saved")),g(!1),n(),window.history.go(0),a({...t,owners:l.owners})})).catch((e=>{g(!1),(0,E.O$)(e).then((({error:e})=>{Z.error({title:(0,u.t)("Error"),content:e||(0,u.t)("An error has occurred"),okButtonProps:{danger:!0,className:"btn-danger"}})}))}))},w=!(0,F.cr)(P.T.DISABLE_LEGACY_DATASOURCE_EDITOR);return(0,f.tZ)(U,{show:o,onHide:n,title:(0,f.tZ)("span",null,(0,u.t)("Edit Dataset "),"\u2003",(0,f.tZ)("strong",null,b)),maskClosable:!v,footer:(0,f.tZ)(i.Fragment,null,w&&(0,f.tZ)(C.Z,{buttonSize:"small",buttonStyle:"default","data-test":"datasource-modal-legacy-edit",className:"m-r-5",onClick:()=>{window.location.href=l.edit_url||l.url}},(0,u.t)("Use legacy datasource editor")),(0,f.tZ)(C.Z,{"data-test":"datasource-modal-cancel",buttonSize:"small",className:"m-r-5",onClick:n},(0,u.t)("Cancel")),(0,f.tZ)(C.Z,{buttonSize:"small",buttonStyle:"primary","data-test":"datasource-modal-save",onClick:()=>{T.current=Z.confirm({title:(0,u.t)("Confirm save"),content:(0,f.tZ)("div",null,(0,f.tZ)(c.Z,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),type:"warning",showIcon:!0,message:(0,u.t)("The dataset configuration exposed here affects all the charts using this dataset. Be mindful that changing settings here may affect other charts in undesirable ways.")}),(0,u.t)("Are you sure you want to save and apply changes?")),onOk:x,icon:null,okText:(0,u.t)("OK"),cancelText:(0,u.t)("Cancel")})},disabled:m||d.length>0||l.is_managed_externally,tooltip:l.is_managed_externally?(0,u.t)("This dataset is managed externally, and can't be edited in Superset"):""},(0,u.t)("Save"))),responsive:!0},(0,f.tZ)($,{showLoadingForImport:!0,height:500,datasource:l,onChange:(e,t)=>{s({...e,metrics:null==e?void 0:e.metrics.map((e=>({...e,is_certified:(null==e?void 0:e.certified_by)||(null==e?void 0:e.certification_details)})))}),h(t)},setIsEditing:y}),S)}))},21089:(e,t,a)=>{a.d(t,{Z:()=>le});var n=a(205872),o=a.n(n),r=a(667294),i=a(730381),l=a.n(i),s=a(294184),c=a.n(s),u=a(349484),d=a(618446),p=a.n(d),h=a(948205),m=a(164561),g=a(432787),f=a(624225),v=a(734041),y=a(71577),b=a(751995),_=a(211965),C=a(14298),E=a(455867),T=a(128759),Z=a(662276),S=a(358593),x=a(828216),w=a(981945),A=a(52004),R=a(226618);(0,b.iK)(w.zx)`
  & {
    width: 100%;
    border-radius: 30px;
    font-size: 14px;
    padding-inline: 6px;
  }
`;const D=e=>{const{onClick:t=(()=>{}),onCancel:a=(()=>{}),onSelect:n=(()=>{}),onConfirm:o=(()=>{}),visible:i,domText:s,placeholder:c="\u8bf7\u9009\u62e9",precision:u="second",format:d="YYYY-MM-DD HH:mm:ss",defaultValue:p}=e,h=(0,x.v9)((e=>e.dashboardState.editMode)),m=(0,x.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode})),g=(0,r.useMemo)((()=>(0,_.tZ)(w.Mt,{visible:i,defaultValue:p,onCancel:a,precision:u,onSelect:e=>{const t=l()(e).format(d);n(t)},onConfirm:e=>{const t=l()(e).format(d);o(t)},getContainer:()=>{const e=document.getElementById(R.H5);if(h)return e;return m===A.kB.MOBILE&&window.location.pathname.indexOf("/dashboard/list")>-1?e:document.body}})),[i,h,m]);return(0,_.tZ)("div",{style:{width:"100%",display:"flex",justifyContent:"center"}},s||(0,_.tZ)(w.zx,{onClick:t,size:"small",style:{borderRadius:"30px",background:"\u8d77\u59cb\u65f6\u95f4"===c||"\u7ec8\u6b62\u65f6\u95f4"===c?R.hR:R.Fu}},(0,_.tZ)("span",{style:{fontSize:12,color:"\u8d77\u59cb\u65f6\u95f4"===c||"\u7ec8\u6b62\u65f6\u95f4"===c?R.k2:R.zP}},c)),g)};var O=a(794736);const N=[{text:"\u4eca\u5929",value:1,num:0,unit:"d"},{text:"\u4eca\u5e74",value:2,num:0,unit:"y"},{text:"\u672c\u6708",value:3,num:0,unit:"M"},{text:"\u4e0a\u6708",value:4,num:-1,unit:"M"},{text:"30\u5929",value:5,num:30,unit:"d"},{text:"\u672c\u5468",value:6,num:0,unit:"w"},{text:"\u4e0a\u5468",value:7,num:-1,unit:"w"},{text:"1\u5468",value:8,num:1,unit:"w"}],M=e=>JSON.stringify(e.map((e=>e.split(" ")[0]))),I=(b.iK.div`
  ${()=>_.iv`
    width: 100%;
    display: flex;
    flex-wrap: nowrap;
    white-space: nowrap;
    overflow-x: auto;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */

    &::-webkit-scrollbar {
      // 隐藏滚动条
      display: none; /* Chrome, Safari, Opera */
    }
  `}
`,b.iK.div`
  ${()=>_.iv`
    display: flex;
    flex-wrap: nowrap;
    margin-left: -3px;
    margin-right: -3px;
    &:not(:first-child) {
      margin-top: 6px;
    }
    .adm-button.adm-button-mini {
      display: flex;
      flex: 1;
      padding-left: 0;
      padding-right: 0;
      justify-content: center;
      align-items: center;
      border-radius: 30px;
      // margin-left: 3px;
      // margin-right: 3px;
      margin: 2px 3px;
      font-size: 14px;
    }
  `}
`),L=b.iK.div`
  padding: 0 5px;
  display: flex;
  align-items: center;
`,k=e=>{const{onClick:t=(()=>{}),onCancel:a=(()=>{}),onConfirm:n=(()=>{}),domText:o,placeholder:i="\u8bf7\u9009\u62e9",format:s,value:c,popupStatus:u=!1,timeValRange:d}=e,[p,h]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[f,v]=(0,r.useState)(["",""]),[y,b]=(0,r.useState)(-1),C=(0,x.v9)((e=>e.dashboardState.drawerStatus)),E=(0,x.v9)((e=>e.dashboardState.editMode)),T=(0,x.v9)((e=>e.dashboardState.mobileFilterStatus)),Z=document.getElementById(R.H5),S=(0,x.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode}));let k=0,F=0,P=0;Z&&(k=Z.clientWidth,F=Z.clientHeight,P=k-2*R.o3);const $=()=>{b(-1),v(["",""]),n(["",""])};(0,r.useEffect)((()=>{if(C||u){if(c&&"No filter"!==c&&"string"===typeof c){const e=c.split(" : ").filter(Boolean).map((e=>l()(e).format(s)));v(e),b((e=>{let t=-1;return Array.isArray(e)&&e.length>1&&(t=window.sessionStorage.getItem(M(e))||-1),Number(t)})(e))}}else v(["",""]),b(-1)}),[C,u]),(0,r.useEffect)((()=>{T.confirm&&!T.reset&&n(f),!T.confirm&&T.reset&&$()}),[JSON.stringify(T)]);const U=e=>{if(e.value===y)return void $();b(e.value);const t=((e,t,a)=>{let n="",o="";return e>0?(n=l()().add(-e,t).format(a),o=l()().format(a)):0===e?(n=l()().startOf(t).format(a),o=l()().format(a)):e<0&&(n=l()().startOf(t).add(e,t).format(a),o=l()(n).add(1,t).format(a)),[n,o]})(e.num,e.unit,s);v(t),window.sessionStorage.setItem(M(t),e.value)},V=e=>e?new Date(e):new Date,q=(0,r.useMemo)((()=>(0,_.tZ)(D,{placeholder:f[0]||"\u8d77\u59cb\u65f6\u95f4",defaultValue:V(f[0]),format:s,onClick:()=>{h(!0)},visible:p,onCancel:()=>{h(!1)},precision:"second",onConfirm:e=>{if(f[1])if(e>f[1])w.FN.show({icon:"fail",content:"\u5f00\u59cb\u65f6\u95f4\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4"});else{const t=[e,f[1]];v(t),h(!1)}else v([e,""]),h(!1),w.FN.show({content:"\u8bf7\u9009\u62e9\u7ec8\u6b62\u65f6\u95f4"})}})),[f.join(","),p]),H=(0,r.useMemo)((()=>(0,_.tZ)(D,{placeholder:f[1]||"\u7ec8\u6b62\u65f6\u95f4",defaultValue:V(f[1]),format:s,onClick:()=>{g(!0)},visible:m,onCancel:()=>{g(!1)},precision:"second",onConfirm:e=>{if(f[0])if(f[0]>e)w.FN.show({icon:"fail",content:"\u5f00\u59cb\u65f6\u95f4\u5927\u4e8e\u7ed3\u675f\u65f6\u95f4"});else{const t=[f[0],e];v(t),n(t),g(!1)}else v(["",e]),g(!1),w.FN.show({content:"\u8bf7\u9009\u62e9\u5f00\u59cb\u65f6\u95f4"})}})),[f.join(","),m]),z=S===A.kB.MOBILE&&window.location.pathname.indexOf("/dashboard/list")>-1;return(0,_.tZ)("div",{style:{width:"100%",height:"calc(100% - 75px)",position:"relative"}},E||z?(0,_.tZ)(_.xB,{styles:_.iv`
            .adm-picker-popup {
              position: relative;
              .adm-mask {
                z-index: 1020; // 比mask得层级再加10
                width: ${P}px;
                height: ${F}px;
                position: absolute;
                left: ${-P}px;
              }
            }
            .adm-picker-popup .adm-popup-body {
              position: absolute;
              width: ${P}px;
              left: ${-P}px;
              z-index: 1030; // 比pop得层级再加10
            }
          `}):null,(0,_.tZ)("div",{className:`date-mobile-filter-box ${O.Z.resetBox}`},[0,N.length/2].map((e=>(0,_.tZ)(I,{key:`${e}`},N.slice(e,e+N.length/2).map((e=>(0,_.tZ)(w.zx,{size:"mini",color:y===e.value?"primary":"default",onClick:()=>U(e),style:{fontSize:12}},e.text))))))),(0,_.tZ)("div",{style:{width:"100%",display:"flex",marginTop:10}},q,(0,_.tZ)(L,null,"\u2192"),H))},F=r.memo(k);var P=a(708509),$=a(246789),U=a(401498),V=a(555453);const q=e=>{const{onCancel:t=(()=>{}),onConfirm:a=(()=>{}),visible:n,format:o,formData:i,value:l,timeValRange:s}=e,[c,u]=(0,r.useState)(["",""]);return(0,_.tZ)(P.Z,{visible:n,onMaskClick:t},(0,_.tZ)(V.Z,null,(0,_.tZ)(U.Z,{text:(null==i?void 0:i.ftName)||"\u65f6\u95f4"}),(0,_.tZ)(F,{onCancel:t,value:l,timeValRange:s,format:o,onConfirm:u,popupStatus:n}),(0,_.tZ)($.Z,{onCancel:t,onConfirm:()=>{null!=c&&c[0]&&null!=c&&c[1]||""===(null==c?void 0:c[0])&&""===(null==c?void 0:c[1])?a(c):null!=c&&c[0]?null!=c&&c[1]||w.FN.show({content:"\u8bf7\u9009\u62e9\u7ec8\u6b62\u65f6\u95f4"}):w.FN.show({content:"\u8bf7\u9009\u62e9\u5f00\u59cb\u65f6\u95f4"})},onRest:()=>{u(["",""]),a(["",""])}})))};var H,z=a(561314),j=a(867e3);!function(e){e.Year="year",e.Quarter="quarter",e.Month="month",e.Week="week",e.Date="date",e.Hour="hour",e.Minute="minute",e.Second="second"}(H||(H={}));const B={[H.Year]:"YYYY",[H.Quarter]:"YYYY-Qo",[H.Month]:"YYYY-MM",[H.Week]:"YYYY-wo",[H.Date]:"YYYY-MM-DD",[H.Hour]:"YYYY-MM-DD HH",[H.Minute]:"YYYY-MM-DD HH:mm",[H.Second]:"YYYY-MM-DD HH:mm:ss"},G=B[H.Second],W=[{label:"\u5206\u949f",value:"m",visible:e=>e.includes("m")},{label:"\u5c0f\u65f6",value:"h",visible:e=>e.includes("H")},{label:"\u5929",value:"d",visible:e=>e.includes("D")},{label:"\u5468",value:"w",visible:e=>e.includes("w")},{label:"\u6708",value:"M",visible:e=>e.includes("M")},{label:"\u5b63\u5ea6",value:"Q",visible:e=>e.includes("Q")},{label:"\u5e74",value:"y",visible:e=>e.includes("Y")}],Y={s:"\u4e00\u79d2\u5185",m:"\u4e00\u5206\u949f\u5185",h:"\u4e00\u5c0f\u65f6\u5185",d:"\u4eca\u5929",w:"\u672c\u5468",M:"\u672c\u6708",q:"\u672c\u5b63\u5ea6",y:"\u4eca\u5e74"};function K(e){return l().isMoment(e)}function Q(e,t){return"timestamp"===t?l()(Number(e)):l()(e,t||G)}function J(e,t,a="-"){if(!e)return[];return function(e,t,a){let n=e||[];return Array.isArray(n)||(n=n.split(a)),2===n.length&&n.every((e=>e&&"string"===typeof e))?n.map((e=>Q(e,t))):[]}(e,t||G,a)}const X=e=>e.hasOwnProperty("quarter")?`${e.format("YYYY")}-Q${null==e?void 0:e.quarter()}`:`${e.format("YYYY")}-Q${Math.ceil((e.month()+1)/3)}`,ee=(e,t)=>[H.Hour,H.Minute,H.Second].includes(e)?{picker:H.Date,format:B[e],showTime:{format:B[e].split(" ").pop()}}:e===H.Week?{picker:e}:e===H.Quarter?{picker:e,format:[X,X],className:"quarterPicker",dropdownClassName:"quarterPickerPanel"}:{picker:e,format:t||G},te=()=>(0,_.tZ)(_.xB,{styles:_.iv`
      .quarterPickerPanel {
        .ant-picker-cell-selected {
          .ant-picker-cell-inner {
            background: #5788ff;
          }
        }
        .ant-picker-quarter-panel {
          .ant-picker-content {
            tr {
              display: flex;
              flex-wrap: wrap;
            }
            td {
              display: flex;
              align-items: center;
              justify-content: center;
              width: 50%;
              height: 50px;
              padding: 20px;
            }
          }
          .ant-picker-cell-selected {
            &::before {
              color: #fff;
              background: #5788ff;
            }
          }
          .ant-picker-cell {
            &::before {
              right: auto;
              left: auto;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 60%;
            }
          }
          .ant-picker-cell-inner {
            display: none;
          }
          .ant-picker-cell[title$='-Q1'] {
            &::before {
              content: '第一季度';
            }
          }
          .ant-picker-cell[title$='-Q2'] {
            &::before {
              content: '第二季度';
            }
          }
          .ant-picker-cell[title$='-Q3'] {
            &::before {
              content: '第三季度';
            }
          }
          .ant-picker-cell[title$='-Q4'] {
            &::before {
              content: '第四季度';
            }
          }
        }
      }
    `}),ae={datePickerProContainer:"V1cfmYD9uIsx47qwNv9V",datePickerProDrop:"OPNcpvD_2_jOZ9Qx0BRm",popoverTabs:"BZWzQYYVarIomlNjJnCd",shortcutTipVal:"UqBXqfGrsz2Y_Qm9GgQY",shortcutList:"fVNJFOaS5FvE1MGb1x6Z",shortcutItem:"mgObabuLuvdrqE2A6gp4",shortcutItemActive:"oZSjdpGC1gGz3B0aZbJi",shortcutCustomRow:"xTNaO9xUO2c91Bj5oEAx",shortcutCustomOption:"B4eSmHd7Y3RN8HrF4OzS",customPanelBox:"uAAhZY4VI9ReXtFm5nPF",timePickerCustomPopup:"kIivXAEcKWSeVUGNx7AD",font12:"ZIeNThSQGonOpCGwr5tz",timeRangePickerWrapper:"mIlXzOhSkca76sgTxXiw",size_large:"lnwJQHW2y0ovbpoPksIT",size_middle:"_l10OCdjQTsURgq0BUEE",size_small:"UfCiMj1rJyuu3nAtIf8m",datePickerProTip:"zLLoKVCwvbqcHdelYush"},{TabPane:ne}=h.Z,oe=b.iK.div`
  ${({theme:e})=>_.iv`
    label {
      color: ${e.colors.grayscale.base};
      margin-bottom: ${.5*e.gridUnit}px;
      position: relative;
    }
  `}
`,re=(0,b.iK)(C.default)`
  ${({theme:e})=>_.iv`
    color: ${(0,u.rgba)(e.colors.grayscale.dark2,.25)};
  `}
`;class ie extends r.Component{constructor(e){super(e),this.shortcutCustomRef=void 0,this.setHovered=e=>{this.props.label&&this.setState({hovered:e})},this.transformRangeValue=(e,t)=>{const a=ie.pickerType;let[n,o]=e||[];return n=l()(l()(n).startOf(a).format(t)),o=l()(l()(o).endOf(a).format(t)),[n,o]},this.parsedValue=(e,t,a)=>{if(!e)return[];return Array.isArray(e)&&e.every(K)?e:t?J(e,t,a):e.map((e=>Q(e)))},this.formatValue=(e,t)=>{if(!Array.isArray(e)||0===e.length||e.some((e=>!e)))return[];const{valueFormat:a}=this.props,n=t||a;return e=this.transformRangeValue(e,n),n?e.map((e=>e.format(n))):e},this.getShortcutVal=e=>{const{title:t="",num:a,unit:n}=e;let o,r;return a>0?(o=l()().add(-a,n),r=l()()):0===a?(o=l()().startOf(n),r=l()()):a<0&&(o=l()().startOf(n).add(a,n),r=l()(o).add(1,n)),{title:t,start:o,end:r}},this.setShortcutTipVal=e=>{if(e){const t=B[ie.pickerType],{start:a,end:n}=this.getShortcutVal(e),o=this.formatValue([a,n],t).join(" ~ ");this.setState({shortcutTipVal:o})}else this.setState({shortcutTipVal:""})},this.handleShortcutPick=(e,t=!1)=>{const a=this.getShortcutVal(e),{start:n,end:o}=a,{title:r}=e,{onChange:i}=this.props;if(this.setState({timeVal:a,timeValShortcut:e,isShortcutCustom:t,open:!1,isPicking:!1}),i){const[e="",t=""]=this.formatValue([n,o]);i([e,t,r])}},this.toggleShortcutCustom=e=>{const{isShortcutCustom:t}=this.state;this.setState({isShortcutCustom:"boolean"===typeof e?e:!t})},this.handleShortcutCustomPick=e=>{const{num:t,unit:a}=e;let n="";if(0===t)n=Y[a];else{const{label:e}=W.find((e=>a===e.value))||{};n=`${t}${e}`}this.handleShortcutPick({num:t,unit:a,title:n},!0)},this.handleCustomInput=e=>{const{onChange:t}=this.props,[a,n]=e||[];if(this.setState({timeVal:{start:a,end:n,title:""},timeValShortcut:{},isShortcutCustom:!1}),t){const[e="",o=""]=this.formatValue([a,n]);t([e,o,""])}},this.onOpenChange=e=>{const{isPicking:t}=this.state;this.setState({open:t||e})},this.timeFieldDataCompatibility=e=>{if("string"===typeof e&&e&&null!=e&&e.includes(z.UD)){const t=null==e?void 0:e.split(z.UD);return[l()(t[0]),l()(t[1])]}return Array.isArray(e)&&2===e.length?e:[]},this.state={pickerType:e.picker,timeVal:{},timeValShortcut:{},shortcutTipVal:"",isShortcutCustom:!1,isPicking:!1,open:!1,hovered:!1,mobilePickerVisible:!1,headClick:!1},ie.pickerType=e.picker,this.shortcutCustomRef=r.createRef()}componentDidMount(){const{value:e,valueFormat:t}=this.props,[a,n]=this.parsedValue(this.timeFieldDataCompatibility(e),t);this.setState((({timeVal:e})=>({timeVal:{...e,start:a,end:n}})))}UNSAFE_componentWillReceiveProps(e){const{value:t,valueFormat:a}=this.props,{value:n}=e,[o,r]=this.parsedValue(this.timeFieldDataCompatibility(t),a),[i,l]=this.parsedValue(this.timeFieldDataCompatibility(n),a),s=(e,t)=>[e,t].every(K)?e.isSame(t):p()(e,t);s(o,i)&&s(r,l)||this.setState((({timeVal:e})=>({timeVal:{...e,start:i,end:l}}))),e.picker!==this.state.pickerType&&(this.setState({pickerType:e.picker}),ie.pickerType=e.picker)}render(){var e,t;const{label:a,itemOptions:n,className:i,size:l="middle",showShortcut:s,onChange:u,formData:d={},dashboardInfo:p,dashboardState:b}=this.props,{timeVal:{start:C,end:x},timeValShortcut:{num:w,unit:R},shortcutTipVal:D,isShortcutCustom:O,open:N,hovered:M,mobilePickerVisible:I,headClick:L}=this.state,k=null==p||null==(e=p.metadata)?void 0:e.layout_type,P=null==p||null==(t=p.metadata)?void 0:t.layout_mode,$=null==b?void 0:b.mobileFilterType,U=P===A.kB.MOBILE,V=ie.pickerType,H=B[V],z={...ee(V,H)},G=H.replace(/Y+/,"\u5e74").replace(/Qo+/,"\u5b63\u5ea6").replace(/M+/,"\u6708").replace(/wo+/,"\u5468").replace(/D+/,"\u65e5").replace(/H+/,"\u65f6").replace(/m+/,"\u5206").replace(/s+/,"\u79d2"),Y=[C,x],K=(C&&x?this.formatValue(Y,H):[G,G]).join(" ~ "),Q=e=>e.filter((e=>null==e||null==e.visible?void 0:e.visible(H))),J=Q(n),X=Q(W),{num:le,unit:se}=J[0],ce=(0,_.tZ)("div",{onMouseEnter:()=>{this.setState({isPicking:!0})},onMouseLeave:()=>{this.setState({isPicking:!1})}},(0,_.tZ)("div",{className:ae.shortcutTipVal},D||K),(0,_.tZ)("ul",{className:ae.shortcutList},J.map((e=>(0,_.tZ)("li",{role:"presentation",className:c()(ae.shortcutItem,O||e.num-w!==0||e.unit!==R?"":ae.shortcutItemActive),key:e.num+e.unit,onClick:()=>this.handleShortcutPick(e),onMouseEnter:()=>this.setShortcutTipVal(e),onMouseLeave:()=>this.setShortcutTipVal()},e.title))),(0,_.tZ)("li",{role:"presentation",className:c()(ae.shortcutItem,O?ae.shortcutItemActive:""),key:"shortcut_custom",onClick:this.toggleShortcutCustom},"\u81ea\u5b9a\u4e49")),O&&(0,_.tZ)(r.Fragment,null,(0,_.tZ)(m.Z,{key:ie.pickerType,className:ae.shortcutCustomRow,layout:"inline",initialValues:{num:le,unit:se},size:"middle",onFinish:this.handleShortcutCustomPick},(0,_.tZ)(g.Z.Group,{compact:!0,style:{width:"auto"}},(0,_.tZ)(m.Z.Item,{name:"num"},(0,_.tZ)(f.Z,{style:{width:80},min:1,className:ae.font12})),(0,_.tZ)("div",{ref:this.shortcutCustomRef,style:{position:"relative"}},(0,_.tZ)(m.Z.Item,{name:"unit"},(0,_.tZ)(v.Z,{style:{width:80},options:X,className:ae.font12,dropdownClassName:ae.shortcutCustomOption,getPopupContainer:()=>this.shortcutCustomRef.current})))),(0,_.tZ)(m.Z.Item,{style:{marginRight:0}},(0,_.tZ)(y.Z,{type:"primary",htmlType:"submit",className:ae.font12},"\u786e\u5b9a")))));return(0,_.tZ)(oe,{className:ae.datePickerProContainer,onMouseEnter:()=>this.setHovered(!0),onMouseLeave:()=>this.setHovered(!1),style:U?{width:"100%"}:{}},(0,_.tZ)(te,null),a&&(0,_.tZ)(T.N,{name:`LABEL-${a}`,label:a,description:(0,_.tZ)(r.Fragment,null,"-\u221e \u2264 col < \u221e",(0,_.tZ)("br",null),[(0,E.t)("Start date included in time range"),(0,E.t)("End date excluded from time range")].join(" , ")),hovered:M}),U?(0,_.tZ)(r.Fragment,null,(0,_.tZ)(j.Z,{id:null==d?void 0:d.ftId,name:null==d?void 0:d.ftName,onClick:()=>this.setState({mobilePickerVisible:!0,headClick:!0}),defaultActiveKey:[null==d?void 0:d.ftId],type:$},(0,_.tZ)("div",{className:"horizontal"===$?"date-mobile-filter":""},(0,_.tZ)(F,{value:this.props.value,onCancel:()=>{this.setState({mobilePickerVisible:!1,headClick:!1})},format:H,onConfirm:e=>{u([e[0],e[1],""]),this.setState({mobilePickerVisible:!1,headClick:!1})}}))),(0,_.tZ)(q,{value:this.props.value,timeValRange:Y,visible:I&&L,onCancel:()=>{this.setState({mobilePickerVisible:!1,headClick:!1})},formData:d,format:H,onConfirm:e=>{u([e[0],e[1],""]),this.setState({mobilePickerVisible:!1,headClick:!1})}})):(0,_.tZ)(S.u,{title:C&&x&&K,overlayClassName:ae.datePickerProTip},(0,_.tZ)("div",{className:ae.datePickerWrapper,onMouseOver:e=>e.stopPropagation()},(0,_.tZ)(Z.S,o()({getPopupContainer:"grid"===k?()=>document.body:e=>e.parentNode||document.body},z,{className:c()(ae.timeRangePickerWrapper,ae[`size_${l}`],i,null==z?void 0:z.className),dropdownClassName:c()(ae.datePickerProDrop,null==z?void 0:z.dropdownClassName),separator:(0,_.tZ)(re,null),allowClear:!0,open:N,value:Y,onChange:this.handleCustomInput,onOpenChange:this.onOpenChange,panelRender:e=>s?(0,_.tZ)(h.Z,{className:ae.popoverTabs,tabPosition:"left"},(0,_.tZ)(ne,{tab:"\u81ea\u5b9a\u4e49",key:"input"},e),(0,_.tZ)(ne,{tab:"\u76f8\u5bf9",key:"shortcut"},ce)):e})))))}}ie.pickerType=void 0,ie.defaultProps={picker:H.Second,value:["",""],itemOptions:[{title:"1\u5206\u949f",num:1,unit:"m",visible:e=>e.includes("m")},{title:"5\u5206\u949f",num:5,unit:"m",visible:e=>e.includes("m")},{title:"15\u5206\u949f",num:15,unit:"m",visible:e=>e.includes("m")},{title:"30\u5206\u949f",num:30,unit:"m",visible:e=>e.includes("m")},{title:"1\u5c0f\u65f6",num:1,unit:"h",visible:e=>e.includes("H")},{title:"3\u5c0f\u65f6",num:3,unit:"h",visible:e=>e.includes("H")},{title:"1\u5929",num:1,unit:"d",visible:e=>e.includes("D")},{title:"\u4eca\u5929",num:0,unit:"d",visible:e=>e.includes("D")},{title:"1\u5468",num:1,unit:"w",visible:e=>e.includes("w")},{title:"\u4e0a\u5468",num:-1,unit:"w",visible:e=>e.includes("w")},{title:"\u672c\u5468",num:0,unit:"w",visible:e=>e.includes("w")},{title:"30\u5929",num:30,unit:"d",visible:e=>e.includes("D")},{title:"\u4e0a\u6708",num:-1,unit:"M",visible:e=>e.includes("M")},{title:"\u672c\u6708",num:0,unit:"M",visible:e=>e.includes("M")},{title:"\u4eca\u5e74",num:0,unit:"y",visible:e=>e.includes("Y")}],valueFormat:"",showShortcut:!1};const le=(0,x.$j)((function({dashboardState:e,dashboardInfo:t}){return{dashboardState:e,dashboardInfo:t}}))(ie)},662276:(e,t,a)=>{a.d(t,{M:()=>g,S:()=>m});var n=a(205872),o=a.n(n),r=(a(667294),a(621537)),i=a(751995),l=a(920292),s=(a(83839),a(348221)),c=a(733887),u=a(211965);const d={...(0,l.Z)().common},p="zh"===(null==d?void 0:d.locale)?s.Z:c.Z,h=r.Z.RangePicker,m=(0,i.iK)((e=>(0,u.tZ)(h,o()({locale:p},e))))`
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,g=e=>(0,u.tZ)(r.Z,o()({locale:p},e))},514278:(e,t,a)=>{a.d(t,{EM:()=>C,Zn:()=>g,gp:()=>f});var n=a(114176),o=a.n(n),r=a(667294),i=a(311064),l=a(522102),s=a(581847),c=a(68492),u=a(591877),d=a(593185),p=a(211965);const h=(0,i.Z)(),m={loading:!0,dynamicPlugins:{},keys:[],mountedPluginMetadata:{},fetchAll:()=>{}},g=r.createContext(m),f=()=>(0,r.useContext)(g);function v(){return{keys:h.keys(),mountedPluginMetadata:o()(h.getMap(),(e=>void 0===e))}}function y(e,t){switch(t.type){case"begin":{const a={...e.dynamicPlugins};return t.keys.forEach((e=>{a[e]={key:e,error:null,mounting:!0}})),{...e,loading:t.keys.length>0,dynamicPlugins:a}}case"complete":return{...e,loading:Object.values(e.dynamicPlugins).some((e=>e.mounting&&e.key!==t.key)),dynamicPlugins:{...e.dynamicPlugins,[t.key]:{key:t.key,mounting:!1,error:t.error}}};case"changed keys":return{...e,...v()};default:return e}}const b=(0,l.Z)({method:"GET",endpoint:"/dynamic-plugins/api/read"}),_={react:()=>Promise.resolve().then(a.t.bind(a,667294,19)),lodash:()=>a.e(96486).then(a.t.bind(a,496486,23)),"react-dom":()=>Promise.resolve().then(a.t.bind(a,973935,19)),"@superset-ui/chart-controls":()=>Promise.all([a.e(48989),a.e(39644)]).then(a.bind(a,748989)),"@superset-ui/core":()=>Promise.all([a.e(22087),a.e(83529),a.e(68924),a.e(36377),a.e(88274),a.e(87049),a.e(89854)]).then(a.bind(a,25874))},C=({children:e})=>{const[t,a]=(0,r.useReducer)(y,m,(e=>({...e,...v(),fetchAll:n,loading:(0,u.cr)(d.T.DYNAMIC_PLUGINS)})));async function n(){try{await(0,s.YW)(_);const{result:e}=await b({});a({type:"begin",keys:e.map((e=>e.key))}),await Promise.all(e.map((async e=>{let t=null;try{await import(e.bundle_url)}catch(a){c.Z.error(`Failed to load plugin ${e.key} with the following error:`,a.stack),t=a}a({type:"complete",key:e.key,error:t})})))}catch(e){c.Z.error("Failed to load dynamic plugins",e.stack||e)}}return(0,r.useEffect)((()=>{(0,u.cr)(d.T.DYNAMIC_PLUGINS)&&n();const e=()=>{a({type:"changed keys"})};return h.addListener(e),()=>{h.removeListener(e)}}),[]),(0,p.tZ)(g.Provider,{value:t},e)}},634275:(e,t,a)=>{a.d(t,{Z:()=>c});a(667294);var n=a(751995),o=a(731293),r=a(211965);const i=n.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${({level:e,theme:t})=>t.colors[e].light2};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({level:e,theme:t})=>t.colors[e].base};
  color: ${({level:e,theme:t})=>t.colors[e].dark2};
  padding: ${({theme:e})=>2*e.gridUnit}px;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  width: 100%;
`,l=n.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,s=n.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`;function c({body:e,level:t="error",title:a}){const c=(0,n.Fg)().colors[t].base;return(0,r.tZ)(i,{level:t,role:"alert"},"error"===t?(0,r.tZ)(o.Z.ErrorSolid,{iconColor:c}):(0,r.tZ)(o.Z.WarningSolid,{iconColor:c}),(0,r.tZ)(l,null,(0,r.tZ)(s,null,a),(0,r.tZ)("p",null,e)))}},222545:(e,t,a)=>{a.d(t,{Z:()=>f});var n=a(667294),o=a(281545),r=a(751995),i=a(358593),l=a(49937);function s(e,t){return e?t[function(e,t){const a=[...e].map((e=>e.charCodeAt(0))),n=a.length,o=n%(t-1)+1,r=a.reduce(((e,t)=>e+t))%t;let i=a[0]%t;return[...new Array(n)].forEach((()=>{i=(o*i+r)%t})),i}(e,t.length)]:"transparent"}var c,u,d=a(211965);const p=null!=(c=null==(u=(0,o.Z)().get())?void 0:u.colors)?c:[],h=e=>`\n  width: ${6*e.gridUnit}px;\n  height: ${6*e.gridUnit}px;\n  line-height: ${6*e.gridUnit}px;\n  font-size: ${e.typography.sizes.m}px;\n`,m=(0,r.iK)(l.qE)`
  ${({theme:e})=>h(e)}
`,g=(0,r.iK)(l.qE.Group)`
  .ant-avatar {
    ${({theme:e})=>h(e)}
  }
`;function f({users:e,maxCount:t=4}){return(0,d.tZ)(g,{maxCount:t},e.map((({first_name:e,last_name:t,id:a,cn_name:o})=>{var r,l,c;const u=o?`${o}`:`${e} ${t}`,h=s(o?`${a}-${o}`:`${a}-${e}-${t}`,p);return(0,d.tZ)(i.u,{key:u,title:u,placement:"top"},(0,d.tZ)(m,{key:u,style:{backgroundColor:h,borderColor:h}},o?null==o||null==(r=o[0])?void 0:r.toLocaleUpperCase():(0,d.tZ)(n.Fragment,null,null==e||null==(l=e[0])?void 0:l.toLocaleUpperCase(),null==t||null==(c=t[0])?void 0:c.toLocaleUpperCase())))})))}},883734:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(211965),o=(a(667294),a(751995)),r=a(358593),i=a(731293);function l({title:e,isSelected:t,children:a,onSelect:l,info:s}){const c=(0,o.Fg)();return(0,n.tZ)("div",{css:(0,n.iv)({paddingBottom:2*c.gridUnit,opacity:t?1:c.opacity.mediumHeavy},"","")},(0,n.tZ)("div",{role:"button",tabIndex:0,onClick:l,css:(0,n.iv)({display:"flex",alignItems:"center",cursor:l?"pointer":"default"},"","")},(0,n.tZ)("strong",{"data-test":"popover-title"},e),s&&(0,n.tZ)(r.u,{title:s,css:(0,n.iv)({marginLeft:c.gridUnit},"","")},(0,n.tZ)(i.Z.InfoSolidSmall,{role:"img",width:14,height:14,iconColor:c.colors.grayscale.light1})),(0,n.tZ)(i.Z.Check,{role:"img",iconColor:t?c.colors.primary.base:c.colors.grayscale.base})),(0,n.tZ)("div",{css:(0,n.iv)({marginLeft:c.gridUnit,marginTop:c.gridUnit},"","")},a))}},976697:(e,t,a)=>{a.d(t,{ZP:()=>n});const n=a(855241).Z},641295:(e,t,a)=>{a.d(t,{$A:()=>u,Aw:()=>y,C1:()=>h,C6:()=>Z,Fl:()=>_,IC:()=>C,Mn:()=>T,Sr:()=>E,Xb:()=>p,a8:()=>m,fO:()=>d,gA:()=>g,nH:()=>b,qN:()=>f,t$:()=>v});var n=a(747037),o=a.n(n),r=a(328062),i=a(522102),l=a(998286),s=a(672570),c=a(909467);const u="DASHBOARD_INFO_UPDATED";function d(e,t){const a=r.getNamespace(null==e?void 0:e.color_namespace),n=o()(t)?JSON.parse(t):t;Object.keys(n).forEach((e=>{a.setColor(e,n[e])}))}const p="SET_DASHBOARD_DATA";function h(e,t){return(a,n)=>{const{dashboardState:o}=n();a({type:p,payload:{type:(o.layoutMode,"metadata"),data:e}}),a({type:c.E9,config:t})}}function m(e){const{metadata:t}=e;return r.getNamespace(null==t?void 0:t.color_namespace).resetColors(),null!=t&&t.shared_label_colors&&d(t,null==t?void 0:t.shared_label_colors),null!=t&&t.label_colors&&d(t,null==t?void 0:t.label_colors),{type:u,newInfo:e}}const g="DELETE_DASHBOARD_METADATA_NATIVE_FILTER_CONFIGURATION";function f(e){return{type:g,filterId:e}}const v="SET_CHART_CONFIG_COMPLETE",y=e=>async(t,a)=>{t({type:"SET_CHART_CONFIG_BEGIN",chartConfiguration:e});const{id:n,metadata:o}=a().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${n}`});try{const a=await r({json_metadata:JSON.stringify({...o,chart_configuration:e})});t(m({metadata:JSON.parse(a.result.json_metadata)})),t({type:v,chartConfiguration:e})}catch(a){t({type:"SET_CHART_CONFIG_FAIL",chartConfiguration:e})}},b="SET_FILTER_BAR_ORIENTATION";const _="SET_CROSS_FILTERS_ENABLED";const C="UPDATE_DASHBOARD_CHANGED_INFO";function E(e){return{type:C,changedInfo:e}}function T(e){return async(t,a)=>{const{id:n,metadata:o}=a().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${n}`});try{const a=await r({json_metadata:JSON.stringify({...o,filter_bar_orientation:e})}),n=a.result,i=a.last_modified_time;if(n.json_metadata){const e=JSON.parse(n.json_metadata);e.filter_bar_orientation&&t((u=e.filter_bar_orientation,{type:b,filterBarOrientation:u}))}i&&t((0,c.Vv)(i))}catch(e){const a=await(0,l.HR)(e,"dashboard");throw t((0,s.Gb)(a)),e}var u}}function Z(e){return async(t,a)=>{const{id:n,metadata:o}=a().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${n}`});try{const a=await r({json_metadata:JSON.stringify({...o,cross_filters_enabled:e})}),n=a.result,i=a.last_modified_time;if(n.json_metadata){t(function(e){return{type:_,crossFiltersEnabled:e}}(JSON.parse(n.json_metadata).cross_filters_enabled))}i&&t((0,c.Vv)(i))}catch(e){const a=await(0,l.HR)(e,"dashboard");throw t((0,s.Gb)(a)),e}}}},550810:(e,t,a)=>{a.d(t,{Fy:()=>r,QR:()=>l,Rn:()=>n});var n,o=a(431069);function r(e){return{type:n.SET_DATASOURCES,datasources:e}}function i(e,t){return{type:n.SET_DATASOURCE,key:t,datasource:e}}function l(e){return(t,a)=>{const{datasources:n}=a(),r=n[e];return r?t(i(r,e)):o.Z.get({endpoint:`/superset/fetch_datasource_metadata?datasourceKey=${e}`}).then((({json:a})=>t(i(a,e))))}}!function(e){e.SET_DATASOURCES="SET_DATASOURCES",e.SET_DATASOURCE="SET_DATASOURCE"}(n||(n={}))},314824:(e,t,a)=>{a.d(t,{CB:()=>o,TE:()=>n,vL:()=>r});const n="APPEND_STANDBY_COMPONENT";const o="DELETE_STANDBY_COMPONENT";function r(e){return t=>{t({type:o,payload:{id:e}})}}},152794:(e,t,a)=>{a.d(t,{$7:()=>C,$l:()=>f,DU:()=>x,RY:()=>d,T6:()=>_,TT:()=>Z,Up:()=>E,X8:()=>b,Zp:()=>s,bZ:()=>c,hf:()=>v,iv:()=>u,jE:()=>T,kN:()=>l,k_:()=>y,pi:()=>h,qN:()=>S,qe:()=>i,ql:()=>g,xQ:()=>m,xk:()=>p});var n=a(522102),o=a(174599),r=a(641295);const i="SET_FILTER_CONFIG_COMPLETE",l="SET_IN_SCOPE_STATUS_OF_FILTERS",s="SET_FILTER_SETS_COMPLETE",c="FILTER_DATASET_SCOPE_BEGIN",u=e=>(t,a)=>{t({type:c,datasetScopeInfo:e})},d=e=>async(t,a)=>{var l;t({type:"SET_FILTER_CONFIG_BEGIN",filterConfig:e});const{id:s,metadata:c}=a().dashboardInfo,u=null==(l=a().nativeFilters)?void 0:l.filters,d=(0,n.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${s}`}),p=e.map((e=>{const t=u[e.id];return t?{...t,...e}:e}));try{const e=await d({json_metadata:JSON.stringify({...c,native_filter_configuration:p})});t((0,r.a8)({metadata:JSON.parse(e.result.json_metadata)})),t({type:i,filterConfig:p}),t((0,o.setDataMaskForFilterConfigComplete)(p,u))}catch(e){t({type:"SET_FILTER_CONFIG_FAIL",filterConfig:p}),t({type:o.SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,filterConfig:p})}},p=e=>async(t,a)=>{var n;const o=null==(n=a().nativeFilters)?void 0:n.filters,i=e.map((e=>({...o[e.filterId],chartsInScope:e.chartsInScope,tabsInScope:e.tabsInScope})));t({type:l,filterConfig:i});const{metadata:s}=a().dashboardInfo,c=s.native_filter_configuration.map((e=>{const t=i.find((t=>t.id===e.id));return t?{...t,...e}:e}));s.native_filter_configuration=c,t((0,r.a8)({metadata:s}))},h=e=>async t=>{const a=(0,n.Z)({method:"GET",endpoint:`/api/v1/dashboard/${e}/filtersets`});t({type:"SET_FILTER_SETS_BEGIN"});const o=await a(null);t({type:s,filterSets:o.ids.map(((e,t)=>({...o.result[t].params,id:e,name:o.result[t].name})))})},m=e=>async(t,a)=>{const o=a().dashboardInfo.id,r=(0,n.Z)({method:"POST",endpoint:`/api/v1/dashboard/${o}/filtersets`});t({type:"CREATE_FILTER_SET_BEGIN"});const i={...e};delete i.name,await r({name:e.name,owner_type:"Dashboard",owner_id:o,json_metadata:JSON.stringify(i)}),t({type:"CREATE_FILTER_SET_COMPLETE"}),t(h(o))},g=e=>async(t,a)=>{const o=a().dashboardInfo.id,r=(0,n.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${o}/filtersets/${e.id}`});t({type:"UPDATE_FILTER_SET_BEGIN"});const i={...e};delete i.id,delete i.name,await r({name:e.name,json_metadata:JSON.stringify(i)}),t({type:"UPDATE_FILTER_SET_COMPLETE"}),t(h(o))},f=e=>async(t,a)=>{const o=a().dashboardInfo.id,r=(0,n.Z)({method:"DELETE",endpoint:`/api/v1/dashboard/${o}/filtersets/${e}`});t({type:"DELETE_FILTER_SET_BEGIN"}),await r({}),t({type:"DELETE_FILTER_SET_COMPLETE"}),t(h(o))},v="DELETE_FILTER_BYID",y=e=>(t,a)=>t({type:v,filterId:e}),b="SET_FOCUSED_NATIVE_FILTER",_="UNSET_FOCUSED_NATIVE_FILTER";function C(e){return{type:b,id:e}}function E(){return{type:_}}const T="SET_HOVERED_NATIVE_FILTER",Z="UNSET_HOVERED_NATIVE_FILTER";function S(e){return{type:T,id:e}}function x(){return{type:Z}}},867e3:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(205872),o=a.n(n),r=(a(667294),a(923313)),i=a(828216),l=a(981945),s=a(794736),c=a(211965);const u=e=>{const{fontSize_Filter_Size:t,fontWeight_Filter_Weight:a,fontFamily_Filter_Family:n,textColor_Filter_Color:u}=(0,i.v9)((e=>{var t;return null==(t=e.dashboardInfo)?void 0:t.metadata})),d={fontSize:`${t||"16"}px`,fontWeight:`${a||400}`,fontFamily:`${n||"FangSong"}`,color:`${u||"rgba(0, 0, 0, 8)"}`},{onClick:p,name:h,type:m="horizontal",id:g,children:f,activeKey:v,defaultActiveKey:y,multiSelect:b}=e;if("horizontal"===m)return(0,c.tZ)("div",{key:g,onClick:p,className:`${s.Z.tab} horizontal`},(0,c.tZ)("span",{className:s.Z.span,style:{...d}},h),(0,c.tZ)(r.Z,null));if("vertical"===m){const e=null!=v&&v.length?{activeKey:v,arrow:null,className:"simple-collapse"}:{},t=()=>{let e=null,t="";return!0===b?t="\u591a\u9009":!1===b&&(t="\u5355\u9009"),e=(0,c.tZ)("span",{className:s.Z.smallTitle},t),(0,c.tZ)("span",null,h,e)};return(0,c.tZ)(l.UO,o()({defaultActiveKey:y},e),(0,c.tZ)(l.UO.Panel,{key:g,title:t()},f))}return null}},708509:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(205872),o=a.n(n),r=(a(667294),a(981945)),i=a(211965);const l={position:"absolute",borderRadius:"10px 0 0 10px"},s={width:"100%",top:0,bottom:0,right:0,zIndex:99},c=e=>{const{visible:t,onClose:a,children:n,position:c="right",style:u,maskStyle:d,bodyStyle:p={width:"calc(100% - 60px)"}}=e;return(0,i.tZ)(r.GI,o()({closeOnMaskClick:!0},e,{position:c,visible:t,onClose:a,style:{...l,...s,...u},maskStyle:{...l,...d},bodyStyle:{...l,...p},getContainer:document.getElementById("mobile-body-container")}),n)}},340892:(e,t,a)=>{a.d(t,{NW:()=>u,Ns:()=>m,Qc:()=>c,VE:()=>p,Vd:()=>h,ZW:()=>g,aX:()=>d,o9:()=>f});var n=a(510752),o=a.n(n),r=a(667294),i=a(88889),l=a(355786);const s="filters",c={filter_time:[i.Z.TEMPORAL],filter_timegrain:[i.Z.TEMPORAL],filter_timecolumn:[i.Z.TEMPORAL],filter_select:[i.Z.BOOLEAN,i.Z.STRING,i.Z.NUMERIC,i.Z.TEMPORAL],filter_range:[i.Z.NUMERIC]},u=(e=!0)=>{const[,t]=r.useState({});return r.useCallback((()=>{e&&t({})}),[e])},d=(e,t,a)=>{const n=e.getFieldValue(s)||{};e.setFields([{name:s,value:{...n,[t]:{...n[t],...a}}}])},p=(e={})=>{var t,a;return null!=(t=null==(a=o()(e.controlPanelSections))?void 0:a.reduce(((e,{controlSetRows:t=[]})=>[...e,...o()(t)]),[]))?t:[]},h=e=>({value:e.id,label:e.table_name}),m=e=>{const t=(0,l.Z)(null==e?void 0:e.column_types);return 0===t.length||t.includes(i.Z.TEMPORAL)},g=(e,t)=>{var a;return!t.type_generic||!(e in c)||(null==(a=c[e])?void 0:a.includes(t.type_generic))},f=(e,t)=>{var a;const n=new Map;let o="",r=0;return Object.values(t).forEach((e=>{const{form_data:t}=e;if(t){const{datasource:e}=t,a=(n.get(e)||0)+1;n.set(e,a),a>r&&(r=a,o=e)}})),null==(a=e[o])?void 0:a.id}},392242:(e,t,a)=>{a.d(t,{EJ:()=>p,G$:()=>u,GA:()=>d,Ky:()=>m,QN:()=>f,W6:()=>g,rW:()=>h,uh:()=>c});var n=a(714670),o=a.n(n),r=a(8868),i=a(68492),l=a(10916),s=a(680621);const c=(e,t,a=[])=>{if(a.includes(t))return!0;const n=e.get(t);return!!n&&n.some((n=>c(e,n,[...a,t])))},u=async(e,t,a)=>{try{let t;try{t=await e.validateFields()}catch(e){var n;if(null!=e&&null!=(n=e.errorFields)&&n.length||null==e||!e.outOfDate)throw e;t=e.values}return t}catch(e){if(i.Z.warn("Filter configuration failed:",e),!e.errorFields||!e.errorFields.length)return null;const n=e.errorFields;if(!n.some((e=>e.name[1]===t))){const e=n.find((e=>"filters"===e.name[0]));if(e){a(e.name[1])}}return null}},d=(e,t,a,n,o)=>async()=>{const i=t.filter((e=>!a[e])).map((t=>{var a,n,i,c;const u=null==(a=o.filters)?void 0:a[t],{addFromModule:d}=u||{};if(!u)return e[t];if(u.type===l.BE.DIVIDER)return{id:t,type:l.BE.DIVIDER,scope:{rootPath:[s._4],excluded:[]},title:u.title,description:u.description};const p={};return u.dataset&&(p.datasetId=u.dataset.value),u.dataset&&u.column&&(p.column={name:u.column}),{id:t,addFromModule:d,adhoc_filters:u.adhoc_filters,time_range:u.time_range,controlValues:null!=(n=u.controlValues)?n:{},granularity_sqla:u.granularity_sqla,requiredFirst:Object.values(null!=(i=u.requiredFirst)?i:{}).find((e=>e)),name:u.name,filterType:u.filterType,filterselectmode:u.filterselectmode,targets:[p],scopeBindDatasetAndColumn:null==u?void 0:u.scopeBindDatasetAndColumn,defaultDataMask:null!=(c=u.defaultDataMask)?c:(0,r.H)(),cascadeParentIds:u.dependencies||[],cascadeTimeGrainFilterId:u.dependencyWithTimeGrain,timeGranularity:u.timeGranularity,scope:u.scope,sortMetric:u.sortMetric,type:u.type,description:(u.description||"").trim()}}));await n(i)},p=(e,t,a)=>n=>{const o=window.setTimeout((()=>{(a=>{e((e=>({...e,[a]:{isPending:!1}}))),t((e=>e.filter((e=>e!==a))))})(n)}),5e3);e((e=>({...e,[n]:{isPending:!0,timerId:o}}))),a(!1)},h="NATIVE_FILTER-",m="NATIVE_FILTER_DIVIDER-",g=e=>`${e===l.BE.NATIVE_FILTER?h:m}${o().generate()}`,f=e=>e.map((e=>e.id))},301510:(e,t,a)=>{a.d(t,{Q:()=>p,Rz:()=>f,X3:()=>h,on:()=>d,zi:()=>u});var n=a(5364),o=a(616355),r=a(593185),i=a(870400),l=a(591877),s=a(81255),c=a(680621);const u=({datasetId:e,dependencies:t={},groupby:a,defaultDataMask:n,controlValues:o,filterType:r,sortMetric:l,adhoc_filters:s,time_range:c,granularity_sqla:u,type:d,timeGranularity:p,scopeBindDatasetAndColumn:h})=>{var m;const g={};return e&&(g.datasource=`${e}__table`),a&&(g.groupby=[a]),l&&(g.sortMetric=l),{...o,...g,adhoc_filters:null!=s?s:[],extra_filters:[],extra_form_data:t,granularity_sqla:u,metrics:["count"],row_limit:1e3,showSearch:!0,defaultValue:null==n||null==(m=n.filterState)?void 0:m.value,time_range:c,url_params:(0,i.Z)("regular"),inView:!0,viz_type:r,type:d,timeGranularity:p,scopeBindDatasetAndColumn:h}};function d(e={},t={}){const a={};return n.Ci.forEach((n=>{const o=[...e[n]||[],...t[n]||[]];o.length&&(a[n]=o)})),n.Ay.forEach((n=>{const o=e[n];void 0!==o&&(a[n]=o);const r=t[n];void 0!==r&&(a[n]=r)})),a}function p(e,t,a,o){let r={},i={};return o.forEach((o=>{var l,s,c,u,p;const h=t[o],m=(null==h?void 0:h.scopeBindDatasetAndColumn)||[],g=m.map((e=>e.nodeTreeId)),f=(null!=(l=null==(s=a[o])||null==(c=s.extraFormData)?void 0:c.filters)?l:[]).filter((e=>{var t,a,n;return e.col!==(null==h||null==(t=h.targets)||null==(a=t[0])||null==(n=a.column)?void 0:n.name)}));if(o===`${e}`&&f.length){var v;const e=((null==(v=r)?void 0:v.filters)||[]).concat(f);r.filters=e}const y=null==(u=t[o])?void 0:u.filterselectmode;var b,_;y&&"select_tree"!==(null==(p=t[o])?void 0:p.filterType)||(r=d(r,null!=(b=null==(_=a[o])?void 0:_.extraFormData)?b:{}));if(y&&g.includes(e)){var C,E,T;const t=m.filter((t=>t.nodeTreeId===e));r=function(e={},t={},a,o){const r={};return n.Ci.forEach((n=>{const i=(t[n]||[]).map((e=>o?{...e,col:a.tableColumnChoose}:e)),l=[...e[n]||[],...i];l.length&&(r[n]=l)})),n.Ay.forEach((a=>{const n=e[a];void 0!==n&&(r[a]=n);const o=t[a];void 0!==o&&(r[a]=o)})),r}(r,null!=(C=null==(E=a[o])?void 0:E.extraFormData)?C:{},null==t?void 0:t[0],o===(null==t||null==(T=t[0])?void 0:T.scopeFilterId)),t.length&&(i=t[0])}})),{extraFormData:r,findObj:i}}function h(e){return!e.includes(o.cg.NATIVE_FILTER)||(0,l.cr)(r.T.DASHBOARD_FILTERS_EXPERIMENTAL)&&(0,l.cr)(r.T.DASHBOARD_CROSS_FILTERS)&&e.includes(o.cg.INTERACTIVE_CHART)}const m=(e,t)=>{var a;return(null==e||null==(a=e[t])?void 0:a.type)===s.gn},g=(e,t,a,n,o)=>{var r,i,l,c,u,d;(null==e||null==(r=e[a])?void 0:r.type)===s.dW&&t.includes(null==(i=e[a])||null==(l=i.meta)?void 0:l.chartId)&&n.forEach(o.add,o),0===(null==e||null==(c=e[a])||null==(u=c.children)?void 0:u.length)||m(e,a)&&o.has(a)||null==(d=e[a])||d.children.forEach((a=>g(e,t,a,m(e,a)?[...n,a]:n,o)))},f=(e,t)=>{const a=e[c._4].children[0],n=a!==c.PV,o=new Set;var r,i;n?null==(r=e[a])||null==(i=r.children)||i.forEach((a=>g(e,t,a,[a],o))):Object.values(e).filter((e=>(null==e?void 0:e.type)===s.gn)).forEach((a=>g(e,t,a.id,[a.id],o)));return o}},409531:(e,t,a)=>{a.d(t,{I6:()=>r,Ky:()=>o,UN:()=>i,XX:()=>s,a7:()=>l,tw:()=>n,yT:()=>c});const n={id:0,type:a(46078).i9.Table,uid:"_placeholder_",datasource_name:"",table_name:"",columns:[],column_types:[],metrics:[],column_format:{},verbose_map:{},main_dttm_col:"",description:""},o=53,r=260,i=80,l=46,s=374,c=["css","json_metadata.filter_scopes"]},239759:(e,t,a)=>{a.d(t,{Z:()=>i,a:()=>r});var n=a(152794),o=a(182140);function r({filterSetsConfig:e,filterConfig:t,state:a}){const n={},o={};var r;t?(t.forEach((e=>{const{id:t}=e;o[t]=e})),n.filters=o):n.filters=null!=(r=null==a?void 0:a.filters)?r:{};if(e){const t={};e.forEach((e=>{const{id:a}=e;t[a]=e})),n.filterSets=t}else{var i;n.filterSets=null!=(i=null==a?void 0:a.filterSets)?i:{}}return n.focusedFilterId=void 0,n.datasetScopeInfo=(null==a?void 0:a.datasetScopeInfo)||[],n}function i(e={filters:{},filterSets:{},datasetScopeInfo:[]},t){switch(t.type){case n.hf:let a={};const i=e.filters;return Object.keys(i).forEach((e=>{e!=t.filterId&&(a[e]=i[e])})),{...e,filters:a};case o.$:return{filters:t.data.nativeFilters.filters,filterSets:t.data.nativeFilters.filterSets};case n.qe:case n.kN:return r({filterConfig:t.filterConfig,state:e});case n.Zp:return r({filterSetsConfig:t.filterSets,state:e});case n.X8:return{...e,focusedFilterId:t.id};case n.T6:return{...e,focusedFilterId:void 0};case n.jE:return{...e,hoveredFilterId:t.id};case n.TT:return{...e,hoveredFilterId:void 0};case n.bZ:const l=(null==e?void 0:e.datasetScopeInfo)||[],s=(null==l?void 0:l.map((e=>null==e?void 0:e.id)))||[],c=null==t?void 0:t.datasetScopeInfo;if(s.includes(null==c?void 0:c.id))return e;const u=JSON.parse(JSON.stringify(l));return null==u||u.push(c),{...e,datasetScopeInfo:u};default:return e}}},132485:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(81255);function o(e){return[n.BA,n.dW,n.xh,n.t,n.Ce,n.qu,n.Mg,n.hI,n.kE,n.GV].indexOf(e.type)>-1}},81255:(e,t,a)=>{a.d(t,{BA:()=>o,BG:()=>i,Ce:()=>g,F0:()=>d,GV:()=>E,Mg:()=>y,Nc:()=>c,Os:()=>p,Q7:()=>b,U0:()=>l,Vl:()=>r,ZP:()=>T,dW:()=>n,gn:()=>m,hE:()=>s,hI:()=>_,kE:()=>C,qu:()=>v,t:()=>f,xh:()=>u,yR:()=>h});const n="CHART",o="COLUMN",r="HEADER",i="GRID",l="ROOT",s="DIVIDER",c="HEADER",u="MARKDOWN",d="NEW_COMPONENT_SOURCE",p="ROW",h="TABS",m="TAB",g="UPLOADS",f="DYNAMIC",v="RECTBOX",y="ARROW",b="WEB_COMPONENT",_="FILTER_SELECT",C="FILTER_SEARCH_BTN",E="FILTER_CLEAR_BTN",T={CHART_TYPE:n,COLUMN_TYPE:o,DASHBOARD_HEADER_TYPE:r,DASHBOARD_GRID_TYPE:i,DASHBOARD_ROOT_TYPE:l,DIVIDER_TYPE:s,HEADER_TYPE:c,MARKDOWN_TYPE:u,NEW_COMPONENT_SOURCE_TYPE:d,ROW_TYPE:p,TABS_TYPE:h,TAB_TYPE:m,DYNAMIC_TYPE:f,RECTBOX_TYPE:v,UPLOADS_TYPE:g,FILTER_SELECT:_,FILTER_SEARCH_BTN:C,FILTER_CLEAR_BTN:E,ARROW_TYPE:y,WEB_COMPONENT_TYPE:b}},852838:(e,t,a)=>{a.d(t,{U:()=>d,g:()=>p});var n=a(150361),o=a.n(n),r=a(593185),i=a(237731),l=a(311064),s=a(616355),c=a(680621),u=a(732873);const d=e=>(0,r.c)(r.T.DASHBOARD_CROSS_FILTERS)&&(void 0===e||e),p=(e,t={},a)=>{if(!(0,r.c)(r.T.DASHBOARD_CROSS_FILTERS))return;const n={};return Object.values(e).forEach((r=>{var d,p,h,m,g,f;const v=null==(d=r.meta)?void 0:d.chartId;if(!(0,i.Z)(v))return;(null!=(p=null==(h=null!=(m=(0,l.Z)().get(null==(g=a[v])||null==(f=g.form_data)?void 0:f.viz_type))?m:{})?void 0:h.behaviors)?p:[]).includes(s.cg.INTERACTIVE_CHART)&&(t[v]&&(n[v]=o()(t[v])),n[v]||(n[v]={id:v,crossFilters:{scope:{rootPath:[c._4],excluded:[v]}}}),n[v].crossFilters.chartsInScope=(0,u.Q)(n[v].crossFilters.scope,a,e))})),n}},870400:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(517563);const o=new Set(["standalone","edit"]);function r(e){const t=n.parse(window.location.search);return Object.entries(t).reduce(((t,[a,n])=>"regular"===e&&o.has(a)||"reserved"===e&&!o.has(a)?t:Array.isArray(n)?{...t,[a]:n[0]}:{...t,[a]:n}),{})}},995173:(e,t,a)=>{a.d(t,{Z:()=>o});const n={};function o(e){let t=null;if(e){const{childId:o,layout:r={}}=e;if(n[o]){var a;const e=(null==r?void 0:r[n[o]])||{};if(null!=e&&e.children&&null!=e&&null!=(a=e.children)&&null!=a.includes&&a.includes(o))return e.id}t=function(e){let t=null;if(e){const{childId:n,layout:o={}}=e;if(o){const e=Object.keys(o);for(let r=0;r<=e.length-1;r+=1){var a;const i=e[r],l=o[i]||{};if(i!==n&&null!=l&&null!=(a=l.children)&&null!=a.includes&&a.includes(n)){t=i;break}}}}return t}({childId:o,layout:r}),n[o]=t}return t}},732873:(e,t,a)=>{a.d(t,{Q:()=>o});var n=a(81255);function o(e,t,a){const o=Object.values(a);return Object.values(t).filter((t=>{var a,r;return!e.excluded.includes(t.id)&&(null==(a=o.find((e=>{var a;return(null==e?void 0:e.type)===n.dW&&(null==(a=e.meta)?void 0:a.chartId)===t.id})))||null==(r=a.parents)?void 0:r.some((t=>e.rootPath.includes(t))))})).map((e=>e.id))}},820194:(e,t,a)=>{function n({chartId:e,column:t}){return`${e}_${t}`}a.d(t,{_:()=>r,w:()=>n});const o=/^([0-9]+)_(.*)$/;function r(e){const t=o.exec(e);if(!t)throw new Error("Cannot parse invalid filter key");return{chartId:parseInt(t[1],10),column:t[2]}}},156967:(e,t,a)=>{function n(){return(window.location.hash||"#").substring(1)}a.d(t,{Z:()=>n})},653002:(e,t,a)=>{a.d(t,{Ms:()=>c,i5:()=>s,lI:()=>d,yI:()=>u});var n=a(205558);a(212617);const o="sql_lab",r="SQL Lab",i=document.getElementById("app"),{common:{menu_data:l}}=JSON.parse((null==i?void 0:i.getAttribute("data-bootstrap"))||"{}"),s=e=>(0,n.A)(e)&&Object.keys(e.roles||{}).some((e=>"admin"===e.toLowerCase())),c=(e,t)=>!0;function u(e){return s(e)||(0,n.A)(e)&&Object.keys(e.roles||{}).some((e=>e.toLowerCase()===o))}function d(e){const t=a=>{let n=!1;return a.forEach((a=>{a.name===e?n=!0:a.name===r&&a.childs&&(n=t(a.childs))})),n};return t(l.menu)}},174599:(e,t,a)=>{a.r(t),a.d(t,{CLEAR_DATA_MASK_STATE:()=>i,DELETE_DATA_MASK:()=>h,INIT_DATAMASK:()=>s,SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:()=>c,SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL:()=>u,UPDATE_DATA_MASK:()=>l,clearDataMask:()=>g,clearDataMaskState:()=>f,dataMaskActions:()=>v,deleteDataMask:()=>m,setDataMaskForFilterConfigComplete:()=>d,updateDataMask:()=>p});var n=a(591877),o=a(593185),r=a(8868);const i="CLEAR_DATA_MASK_STATE",l="UPDATE_DATA_MASK",s="INIT_DATAMASK",c="SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE",u="SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL";function d(e,t){return{type:c,filterConfig:e,filters:t}}function p(e,t){const a=(0,n.cr)(o.T.DASHBOARD_NATIVE_FILTERS)||(0,n.cr)(o.T.DASHBOARD_CROSS_FILTERS)||(0,n.cr)(o.T.DASHBOARD_DRILL_DOWN);return{type:l,filterId:e,dataMask:a?t:{}}}const h="DELETE_DATA_MASK";function m(e){return{type:h,filterId:e}}function g(e){return p(e,(0,r.H)(e))}function f(){return{type:i}}const v={updateDataMask:p}},8868:(e,t,a)=>{a.d(t,{H:()=>u,Z:()=>p});var n=a(818172),o=a(593185),r=a(392242),i=a(182140),l=a(591877),s=a(174599),c=a(599543);function u(e,t={}){let a={};return e&&(a={id:e}),{...a,extraFormData:{},filterState:{},ownState:{},...t}}function d(e,t,a,n,o){e.forEach((e=>{var a;const r=n||{};t[e.id]={...u(e.id),...e.defaultDataMask,...r[e.id]},o&&!(0,c.JB)(e.defaultDataMask,null==(a=o[e.id])?void 0:a.defaultDataMask,{ignoreUndefined:!0})&&(t[e.id]={...t[e.id],...e.defaultDataMask})})),Object.values(a).forEach((e=>{String(null==e?void 0:e.id).startsWith(r.rW)||(t[null==e?void 0:e.id]=e)}))}const p=(0,n.ZP)(((e,t)=>{var a,n,r,c;const p={};switch(t.type){case s.DELETE_DATA_MASK:let g={};return Object.keys(e).forEach((a=>{a!=t.filterId&&(g[a]=e[a])})),g;case s.CLEAR_DATA_MASK_STATE:return p;case s.UPDATE_DATA_MASK:return e[t.filterId]={...u(t.filterId),...e[t.filterId],...t.dataMask},e;case i.$:var h,m;if((0,l.cr)(o.T.DASHBOARD_CROSS_FILTERS))Object.keys(null==(h=t.data.dashboardInfo)||null==(m=h.metadata)?void 0:m.chart_configuration).forEach((e=>{p[e]={...u(e)}}));return d(null!=(a=null==(n=t.data.dashboardInfo)||null==(r=n.metadata)?void 0:r.native_filter_configuration)?a:[],p,e,t.data.dataMask),p;case s.SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:return d(null!=(c=t.filterConfig)?c:[],p,e,t.filters),p;default:return e}}),{})},476445:(e,t,a)=>{a.d(t,{_:()=>m,u:()=>g});var n,o=a(112515),r=a(635854),i=a(5364),l=a(281545),s=a(45511),c=a(355786),u=a(410331),d=a(542313),p=a(23525),h=a(427600);!function(e){e.CATEGORICAL="CATEGORICAL",e.SEQUENTIAL="SEQUENTIAL"}(n||(n={}));const m="HYDRATE_EXPLORE",g=({form_data:e,slice:t,dataset:a,metadata:g,saveAction:f=null})=>(v,y)=>{var b;const{user:_,datasources:C,charts:E,sliceEntities:T,common:Z,explore:S}=y(),x=(0,p.eY)(h.KD.sliceId),w=(0,p.eY)(h.KD.dashboardId),A=x?null==T||null==(b=T.slices)?void 0:b[x]:null,R=null!=t?t:A,D=null!=e?e:null==R?void 0:R.form_data;if(!D.viz_type){const e=(null==Z?void 0:Z.conf.DEFAULT_VIZ_TYPE)||"table";D.viz_type=(0,p.eY)(h.KD.vizType)||e}var O;D.time_range||(D.time_range=(null==Z||null==(O=Z.conf)?void 0:O.DEFAULT_TIME_FILTER)||i.vM);w&&(D.dashboardId=w);const N=a,M={form_data:D,slice:R,datasource:N},I=(0,r.R3)(M,D),L=I.color_scheme&&"color_scheme",k=I.linear_color_scheme&&"linear_color_scheme",F=e=>{const t="CATEGORICAL"===e?(0,l.Z)():(0,s.Z)(),a="CATEGORICAL"===e?L:k,n=t.defaultKey,o="CATEGORICAL"===e?"supersetColors":"superset_seq_1",r=D[a],i=!!t.get(r,!0);r&&!i&&(I[a].value=n||o)};L&&F(n.CATEGORICAL),k&&F(n.SEQUENTIAL);const P={can_add:!0,can_download:!0,can_overwrite:(0,c.Z)(null==t?void 0:t.owners).includes(null==_?void 0:_.userId),isDatasourceMetaLoading:!1,isStarred:!1,triggerRender:!1,datasource:N,controls:I,form_data:D,slice:R,controlsTransferred:S.controlsTransferred,standalone:(0,p.eY)(h.KD.standalone),force:(0,p.eY)(h.KD.force),metadata:g,saveAction:f,common:Z};Object.entries(P.controls).forEach((([e,t])=>{P.controls[e]=(0,u.RO)(t,P)}));const $=R?(0,u.Hu)(I):null,U=(0,o.Jp)(M),V={id:U,chartAlert:null,chartStatus:null,chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:(0,u.Hu)(P.controls),sliceFormData:$,queryController:null,queriesResponse:null,triggerQuery:!1,lastRendered:0};return v({type:m,data:{charts:{...E,[U]:V},datasources:{...C,[(0,d.T)(N)]:N},saveModal:{dashboards:[],saveModalAlert:null,isVisible:!1},explore:P}})}},615542:(e,t,a)=>{a.d(t,{Z:()=>Zr});var n=a(205872),o=a.n(n),r=a(618446),i=a.n(r),l=a(667294),s=a(751995),c=a(741427),u=a(957902),d=a(510162),p=a(45697),h=a.n(p),m=a(49937),g=a(828216),f=a(455867),v=a(468135),y=a(409882),b=a(967913),_=a(112515),C=a(935500),E=a(211965);function T(e){const{selectable:t,children:a,...n}=e,r=(0,s.Fg)(),i={"&.ant-list-item":{padding:`${r.gridUnit+2}px ${3*r.gridUnit}px`,":first-of-type":{borderTopLeftRadius:r.gridUnit,borderTopRightRadius:r.gridUnit},":last-of-type":{borderBottomLeftRadius:r.gridUnit,borderBottomRightRadius:r.gridUnit}}};return t&&(i["&:hover"]={cursor:"pointer",backgroundColor:r.colors.grayscale.light4}),(0,E.tZ)(m.aV.Item,o()({},n,{css:i}),a)}var Z=a(927845);const S=(0,b.Z)((()=>Promise.all([a.e(22087),a.e(25094)]).then(a.bind(a,725094))),(()=>(0,E.tZ)("div",{style:{width:450,height:368}}))),x={colorScheme:h().string.isRequired,annotationError:h().object,annotationQuery:h().object,vizType:h().string,validationErrors:h().array,name:h().string.isRequired,actions:h().object,value:h().arrayOf(h().object),onChange:h().func,refreshAnnotationData:h().func};class w extends l.PureComponent{constructor(e){super(e),this.state={popoverVisible:{},addedAnnotationIndex:null},this.addAnnotationLayer=this.addAnnotationLayer.bind(this),this.removeAnnotationLayer=this.removeAnnotationLayer.bind(this),this.handleVisibleChange=this.handleVisibleChange.bind(this)}componentDidMount(){S.preload()}UNSAFE_componentWillReceiveProps(e){const{name:t,annotationError:a,validationErrors:n,value:o}=e;Object.keys(a).length&&!n.length&&this.props.actions.setControlValue(t,o,Object.keys(a)),!Object.keys(a).length&&n.length&&this.props.actions.setControlValue(t,o,[])}addAnnotationLayer(e,t){let a=this.props.value;a.includes(e)?a=a.map((a=>a===e?t:a)):(a=[...a,t],this.setState({addedAnnotationIndex:a.length-1})),this.props.refreshAnnotationData({annotation:t,force:!0}),this.props.onChange(a)}handleVisibleChange(e,t){this.setState((a=>({popoverVisible:{...a.popoverVisible,[t]:e}})))}removeAnnotationLayer(e){const t=this.props.value.filter((t=>t!==e)),a=(0,Z.j)();a&&a.style.setProperty("overflow-y","auto","important"),this.props.onChange(t)}renderPopover(e,t,a){const n=(null==t?void 0:t.name)||"_new";return(0,E.tZ)("div",{id:`annotation-pop-${n}`,"data-test":"popover-content"},(0,E.tZ)(S,o()({},t,{error:a,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:e=>this.addAnnotationLayer(t,e),removeAnnotationLayer:()=>this.removeAnnotationLayer(t),close:()=>{this.handleVisibleChange(!1,e),this.setState({addedAnnotationIndex:null})}})))}renderInfo(e){const{annotationError:t,annotationQuery:a,theme:n}=this.props;return a[e.name]?(0,E.tZ)("i",{className:"fa fa-refresh",style:{color:n.colors.primary.base},"aria-hidden":!0}):t[e.name]?(0,E.tZ)(y.V,{label:"validation-errors",bsStyle:"danger",tooltip:t[e.name]}):e.show?"":(0,E.tZ)("span",{style:{color:n.colors.error.base}}," Hidden ")}render(){const{addedAnnotationIndex:e}=this.state,t=this.props.value[e],a=this.props.value.map(((e,t)=>(0,E.tZ)(Z.Z,{key:t,trigger:"click",title:(0,f.t)("Edit annotation layer"),css:e=>({"&:hover":{cursor:"pointer",backgroundColor:e.colors.grayscale.light4}}),content:this.renderPopover(t,e,this.props.annotationError[e.name]),visible:this.state.popoverVisible[t],onVisibleChange:e=>this.handleVisibleChange(e,t)},(0,E.tZ)(T,{selectable:!0},(0,E.tZ)("span",null,e.name),(0,E.tZ)("span",{style:{float:"right"}},this.renderInfo(e)))))),n="add";return(0,E.tZ)("div",null,(0,E.tZ)(m.aV,{bordered:!0,css:e=>({borderRadius:e.gridUnit})},a,(0,E.tZ)(Z.Z,{trigger:"click",content:this.renderPopover(n,t),title:(0,f.t)("Add annotation layer"),visible:this.state.popoverVisible[n],destroyTooltipOnHide:!0,onVisibleChange:e=>this.handleVisibleChange(e,n)},(0,E.tZ)(T,{selectable:!0},(0,E.tZ)("i",{"data-test":"add-annotation-layer-button",className:"fa fa-plus"})," ","\xa0 ",(0,f.t)("Add annotation layer")))))}}w.propTypes=x,w.defaultProps={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:()=>{}};const A=(0,v.b)(w),R=(0,g.$j)((function({charts:e,explore:t}){var a,n;const o=e[(0,_.Jp)(t)]||e[0]||{};return{colorScheme:null==(a=t.controls)||null==(n=a.color_scheme)?void 0:n.value,annotationError:o.annotationError,annotationQuery:o.annotationQuery,vizType:t.controls.viz_type.value}}),(function(e){return{refreshAnnotationData:t=>e((0,C.runAnnotationQuery)(t))}}))(A);var D=a(23279),O=a.n(D),N=a(9875),M=a(482342);const I=s.iK.div`
  display: flex;
`,L=(0,s.iK)(N.Rn)`
  flex: 1;
  margin-right: ${({theme:e})=>e.gridUnit}px;
`,k=(0,s.iK)(N.Rn)`
  flex: 1;
  margin-left: ${({theme:e})=>e.gridUnit}px;
`,F=e=>null===e||Number.isNaN(Number(e))?null:Number(e);function P({onChange:e=(()=>{}),value:t=[null,null],...a}){const[n,o]=(0,l.useState)([F(t[0]),F(t[1])]),r=t[0],i=t[1],s=(0,l.useRef)(O()(e,300)).current,c=e=>{o(e),s([void 0===e[0]?null:e[0],void 0===e[1]?null:e[1]])};(0,l.useEffect)((()=>{o([F(r),F(i)])}),[r,i]);return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,a),(0,E.tZ)(I,null,(0,E.tZ)(L,{"data-test":"min-bound",placeholder:(0,f.t)("Min"),onChange:e=>{c([F(e),n[1]])},value:null===n[0]?void 0:n[0]}),(0,E.tZ)(k,{"data-test":"max-bound",placeholder:(0,f.t)("Max"),onChange:e=>{c([n[0],F(e)])},value:null===n[1]?void 0:n[1]})))}var $=a(379069),U=a(150361),V=a.n(U),q=a(714670),H=a.n(q),z=a(731293),j=a(427478),B=a(198201);const{TreeNode:G}=m.mp,W={name:h().string.isRequired,label:h().string,description:h().string,placeholder:h().string,addTooltip:h().string,itemGenerator:h().func,keyAccessor:h().func,onChange:h().func,value:h().oneOfType([h().array]),isFloat:h().bool,isInt:h().bool,controlName:h().string.isRequired},Y={label:null,description:null,onChange:()=>{},placeholder:(0,f.t)("Empty collection"),itemGenerator:()=>{const e=H().generate();return{key:e,id:e,parent:null}},keyAccessor:e=>e.key,value:[],addTooltip:(0,f.t)("Add an item")};var K={name:"wjgf8i",styles:"display:flex;align-items:center;user-select:none;i{font-size:16px;margin-right:6px;}"},Q={name:"34igx4",styles:'border:1px solid #d9d9d9;border-radius:4px;margin-top:10px;.ant-tree-treenode{padding:0;border-bottom:1px solid #f0f0f0;&:last-child{border-bottom:none;}.ant-tree-indent{.ant-tree-indent-unit{width:20px;}}.ant-tree-switcher{width:20px;line-height:30px;}.ant-tree-node-content-wrapper{min-height:30px;line-height:30px;&[draggable="true"]{line-height:30px;}}}'},J={name:"ocuf2l",styles:"margin-bottom:-16px"};class X extends l.Component{constructor(e){super(e),this.changeParent=(e,t,a,n)=>{var o,r;const{value:i}=this.props;let l,s,c,u=i.reduce(((t,a)=>(null==a?void 0:a.key)===e?(l={...a},t):t.concat(a)),[]),d=null;for(let e=0,a=u.length;e<a;e+=1){const a=u[e];a.key===t&&(d=a,s=e),n&&a.key===n&&(c=e)}l.parent=null!=(o=null==(r=d)?void 0:r.key)?o:null,u=n?"append"===a?[...u.slice(0,c+1),l,...u.slice(c+1)]:[...u.slice(0,c),l,...u.slice(c)]:d?[...u.slice(0,s+1),l,...u.slice(s+1)]:"append"===a?[...u,l]:[l,...u],this.props.onChange(u)},this.drop=e=>{const t=e.node.key,a=e.dragNode.key,n=e.node.pos.split("-"),o=e.dropPosition-Number(n[n.length-1]);let r,i,l;if(e.dropToGap)if((e.node.children||[]).length>0&&e.node.expanded&&1===o)r=t,i="prepend";else{r=this.state.flatTree[t].parent,l=t,i=-1===o?"prepend":"append"}else r=t,i="append";this.changeParent(a,r,i,l)},this.state={renderTree:[],flatTree:{},prevList:[]},this.onAdd=this.onAdd.bind(this)}onChange(e,t){const a=this.props.value.findIndex((t=>t.key===e.key)),n=[...this.props.value];n[a]={...this.props.value[a],...t},this.props.onChange(n)}onAdd(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}removeItem(e){const{key:t}=e,a=[t].concat((0,B.nI)(t,this.state.flatTree));this.props.onChange(this.props.value.filter((e=>!a.includes(e.key))))}renderTreeNodes(e){const{label:t,controlName:a,datasource:n,form_data:r,value:i}=this.props,l=Er[a];return e.map(((e,t)=>{const{children:a}=e,s=(0,E.tZ)("div",{css:K},(0,E.tZ)(z.Z.Drag,{iconSize:"l"}),(0,E.tZ)("div",{css:e=>({flex:1,display:"flex",alignItems:"center",marginLeft:2*e.gridUnit,marginRight:2*e.gridUnit,'>span, >span[data-test="FilterBoxItemControl"]':{flex:1,display:"flex",alignItems:"center",justifyContent:"space-between"}})},(0,E.tZ)(l,o()({datasource:n,form_data:r,controls:i},e,{onChange:this.onChange.bind(this,e)}))),(0,E.tZ)(z.Z.DeleteIcon,{iconSize:"l",onClick:this.removeItem.bind(this,e)}));return a?(0,E.tZ)(G,{title:s,key:this.props.keyAccessor(e),dataRef:e},this.renderTreeNodes(e.children)):(0,E.tZ)(G,{title:s,key:this.props.keyAccessor(e),dataRef:e})}))}renderList(){const{renderTree:e}=this.state;return 0===e.length?(0,E.tZ)("div",{className:"text-muted"},this.props.placeholder):(0,E.tZ)(m.mp,{className:"draggable-tree",defaultExpandAll:!0,draggable:!0,blockNode:!0,onDrop:this.drop,css:Q},this.renderTreeNodes(e))}render(){const{theme:e}=this.props;return(0,E.tZ)("div",{"data-test":"CollectionControl",className:"CollectionControl",css:J},(0,E.tZ)(j.gM,null,(0,E.tZ)(M.Z,this.props),(0,E.tZ)(j.IG,{onClick:this.onAdd},(0,E.tZ)(z.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5}))),this.renderList())}}X.getDerivedStateFromProps=(e,t)=>{let a={};if(e.value!==t.prevList){const t=V()(e.value);a={...(0,B.$W)(t),prevList:e.value}}return a},X.propTypes=W,X.defaultProps=Y;const ee=(0,v.b)(X);var te=a(74401),ae=a(281545),ne=a(976697);const oe={onChange:h().func,value:h().object,disableAlpha:h().bool},re={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},ie=s.iK.div`
  ${({theme:e})=>`\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${e.gridUnit}px;\n      borderRadius: ${e.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}
`,le=s.iK.div`
  margin: -12px -16px;

  .sketch-picker {
    box-shadow: none !important;
  }
`,se={color:{...re,borderRadius:"2px"},checkerboard:{...re,background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'}};class ce extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(e.rgb)}renderPopover(){const e=(0,ae.Z)().get().colors.filter(((e,t)=>t<7));return(0,E.tZ)(le,{id:"filter-popover",className:"color-popover"},(0,E.tZ)(te.xS,{color:this.props.value,onChange:this.onChange,presetColors:e,disableAlpha:this.props.disableAlpha}))}render(){const e=this.props.value||{r:0,g:0,b:0,a:0},t={...se.color,background:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`,border:"1px solid #d9d9d9"};return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,this.props),(0,E.tZ)(ne.ZP,{trigger:"click",placement:"right",content:this.renderPopover()},(0,E.tZ)(ie,null,(0,E.tZ)("div",{style:se.checkerboard}),(0,E.tZ)("div",{style:t}))))}}ce.propTypes=oe,ce.defaultProps={disableAlpha:!1,onChange:()=>{}};var ue=a(676787),de=a(7737),pe=a(432787),he=a(519650),me=a(71577),ge=a(609676),fe=a(3006),ve=a(570603);const ye=e=>{const{datasource:{id:t,type:a},provinceColumn:n,metaAreaColumnlist:o,areaNameChange:r=(()=>{})}=e,i=o||ve.r,s=(0,l.useRef)(null),[c,u]=(0,l.useState)(""),[d,p]=(0,l.useState)(""),h=(e,t,a)=>{t(),u(e[0]),p(a)},m=(e,t)=>({filterDropdown:({setSelectedKeys:a,selectedKeys:n,confirm:o,clearFilters:r,close:i})=>(0,E.tZ)("div",{style:{padding:8},onKeyDown:e=>e.stopPropagation()},(0,E.tZ)(pe.Z,{ref:s,placeholder:`${(0,f.t)("Search")} ${(0,f.t)(t)}`,value:`${n[0]||""}`,onChange:e=>a(e.target.value?[e.target.value]:[]),onPressEnter:()=>h(n,o,e),style:{marginBottom:8,display:"block"}}),(0,E.tZ)(he.Z,null,(0,E.tZ)(me.Z,{type:"primary",onClick:()=>h(n,o,e),size:"small",style:{width:90}},(0,f.t)("Search")),(0,E.tZ)(me.Z,{onClick:()=>r&&(e=>{e(),u("")})(r),size:"small",style:{width:90}},(0,f.t)("Reset")))),filterIcon:e=>(0,E.tZ)(de.default,{style:{color:e?"#1890ff":void 0}}),onFilter:(t,a)=>a[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null==(e=s.current)?void 0:e.select()}),100)},render:e=>(0,E.tZ)("div",null,e)}),g=(0,l.useCallback)(O()(((e,t)=>{r(e,t)}),200),[]),v=[{title:(0,f.t)("Province/Municipality Name"),dataIndex:"provinceName",key:"provinceName",...m("provinceName","Province/Municipality Name"),render:e=>(0,E.tZ)("div",null,e)},{title:(0,f.t)("Area Name"),dataIndex:"areaName",key:"areaName",...m("areaName","Area Name"),render:(e,t)=>(0,E.tZ)("div",null,(0,E.tZ)(pe.Z,{placeholder:e,allowClear:!0,onChange:e=>{var a;const n=null==e||null==(a=e.target)?void 0:a.value,o=[];n||o.push((0,f.t)("Area Name Is Not Null"));const r=V()(i);r.forEach((e=>{e.provinceName===t.provinceName&&(e.areaName=n)})),g(r,o)}}))},{title:(0,f.t)("Area Show Position"),dataIndex:"areaPosition",key:"areaPosition",render:(e,t)=>(0,E.tZ)("div",null,(0,E.tZ)(ge.Z,{defaultChecked:t.areaPosition,onChange:e=>{var a;const n=null==e||null==(a=e.target)?void 0:a.checked,o=V()(i);o.forEach((e=>{e.provinceName===t.provinceName&&(e.areaPosition=n)})),g(o,[])}}))}];return(0,E.tZ)(fe.Z,{columns:v,dataSource:i,rowKey:"provinceName",scroll:{scrollToFirstRowOnChange:!0,y:310},pagination:!1})},be=s.iK.div`
  height: 400px;
`,_e=e=>{const{onChange:t=(()=>{})}=e,a=(0,g.v9)((e=>e)),{explore:n={}}=a,{controls:o={},datasource:r={}}=n,{provinceColumn:i={},place_name_mapping:l}=o;return(0,E.tZ)(be,null,(0,E.tZ)(E.xB,{styles:E.iv`
          .ant-table-wrapper {
            padding: 0px !important;
          }
        `}),(0,E.tZ)(M.Z,e),(0,E.tZ)("div",{style:{width:"100%",height:380}},(0,E.tZ)(ye,{datasource:r,provinceColumn:i,metaAreaColumnlist:null==l?void 0:l.value,areaNameChange:(e,a)=>{t(e,a)}})))};var Ce=a(747037),Ee=a.n(Ce),Te=a(46078),Ze=a(431069),Se=a(945211),xe=a(23525),we=a(683862),Ae=a(358593),Re=a(190551),De=a(835932),Oe=a(891178),Ne=a(486057),Me=a(427600),Ie=a(479217),Le=a(653002),ke=a(601304),Fe=a(513218),Pe=a.n(Fe),$e=a(667496);const Ue=(0,f.t)("Close"),Ve=(0,f.t)("Save as Dataset"),qe=(0,f.t)("Open in SQL Lab"),He=e=>{const t=()=>{const{datasource:t}=e;if(Pe()(t)){const{id:e,type:a,sql:n}=t;((e,t,a)=>{const n={datasourceKey:`${e}__${t}`,sql:a};Ze.Z.postForm((0,$e.VU)("/superset/sqllab/"),n)})(e,a,n)}};return(0,E.tZ)("div",null,(0,E.tZ)(De.Z,{onClick:()=>{null==e||null==e.closeModal||e.closeModal(),null==e||null==e.changeDatasource||e.changeDatasource()}},Ve),(0,E.tZ)(De.Z,{onClick:()=>t()},qe),(0,E.tZ)(De.Z,{buttonStyle:"primary",onClick:()=>{null==e||null==e.closeModal||e.closeModal()}},Ue))};var ze=a(985626),je=a(941331),Be=a(309679),Ge=a(616550),We=a(454076);const Ye={actions:h().object.isRequired,onChange:h().func,value:h().string,datasource:h().object.isRequired,form_data:h().object.isRequired,isEditable:h().bool,onDatasourceSave:h().func},Ke=s.iK.div`
  .data-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    padding: ${({theme:e})=>4*e.gridUnit}px;
    padding-right: ${({theme:e})=>2*e.gridUnit}px;
  }
  .error-alert {
    margin: ${({theme:e})=>2*e.gridUnit}px;
  }
  .ant-dropdown-trigger {
    margin-left: ${({theme:e})=>2*e.gridUnit}px;
    box-shadow: none;
    &:active {
      box-shadow: none;
    }
  }
  .btn-group .open .dropdown-toggle {
    box-shadow: none;
    &.button-default {
      background: none;
    }
  }
  i.angle {
    color: ${({theme:e})=>e.colors.primary.base};
  }
  svg.datasource-modal-trigger {
    color: ${({theme:e})=>e.colors.primary.base};
    cursor: pointer;
  }
  .title-select {
    flex: 1 1 100%;
    display: inline-block;
    background-color: ${({theme:e})=>e.colors.grayscale.light3};
    padding: ${({theme:e})=>2*e.gridUnit}px;
    border-radius: ${({theme:e})=>e.borderRadius}px;
    text-align: center;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  .datasource-svg {
    margin-right: ${({theme:e})=>2*e.gridUnit}px;
    flex: none;
  }
  span[aria-label='dataset-physical'] {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
  span[aria-label='more-vert'] {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,Qe="change_dataset",Je="Import CSV dataset",Xe="Import Excel dataset",et="view_in_sql_lab",tt="edit_dataset",at="save_as_dataset",nt={[Te.i9.Query]:(0,E.tZ)(z.Z.ConsoleSqlOutlined,{className:"datasource-svg"}),[Te.i9.Table]:(0,E.tZ)(z.Z.DatasetPhysical,{className:"datasource-svg"})};class ot extends l.PureComponent{constructor(e){super(e),this.onDatasourceSave=e=>{var t,a,n;this.props.actions.changeDatasource(e);const{temporalColumns:o,defaultTemporalColumn:r}=(0,Se.X)(e),{columns:i}=e,l=null==(t=this.props.form_data)?void 0:t.granularity_sqla,s=null==(a=i.find((({column_name:e})=>e===l)))?void 0:a.is_dttm,c=null==(n=i.find((({column_name:e})=>e===r)))?void 0:n.is_dttm;if("table"===e.type&&!s){const e=c?r:null==o?void 0:o[0];this.props.actions.setControlValue("granularity_sqla",e||null)}this.props.onDatasourceSave&&this.props.onDatasourceSave(e)},this.toggleShowDatasource=()=>{this.setState((({showDatasource:e})=>({showDatasource:!e})))},this.toggleChangeDatasourceModal=()=>{this.setState((({showChangeDatasourceModal:e})=>({showChangeDatasourceModal:!e})))},this.toggleEditDatasourceModal=()=>{this.setState((({showEditDatasourceModal:e})=>({showEditDatasourceModal:!e})))},this.toggleSaveDatasetModal=()=>{this.setState((({showSaveDatasetModal:e})=>({showSaveDatasetModal:!e})))},this.handleMenuItemClick=({key:e})=>{switch(e){case Qe:this.toggleChangeDatasourceModal();break;case tt:this.toggleEditDatasourceModal();break;case et:{const{datasource:e}=this.props,t={datasourceKey:`${e.id}__${e.type}`,sql:e.sql};Ze.Z.postForm((0,$e.VU)("/superset/sqllab/"),{form_data:(0,Be.o)(t)})}break;case at:this.toggleSaveDatasetModal();break;case Je:if((0,We.w)())return window.open(`/csvtodatabaseview/form?standalone=true&table_entry=chart&table_source=csv&redict_url=${window.parent.location.href}`);window.open("/csvtodatabaseview/form?standalone=true&table_entry=chart&table_source=csv&redict_url=/superset/chart/list/");break;case Xe:if((0,We.w)())return window.open(`/exceltodatabaseview/form?standalone=true&table_entry=chart&table_source=excel&redict_url=${window.parent.location.href}`);window.open("/exceltodatabaseview/form?standalone=true&table_entry=chart&table_source=excel&redict_url=/superset/chart/list/")}},this.state={showEditDatasourceModal:!1,showChangeDatasourceModal:!1,showSaveDatasetModal:!1}}render(){var e;const{showChangeDatasourceModal:t,showEditDatasourceModal:a,showSaveDatasetModal:n}=this.state,{datasource:o,onChange:r,theme:i}=this.props,s=!(null!=o&&o.id);let c=!1;if(s){const e=(0,xe.eY)(Me.KD.datasourceId),t=(0,xe.eY)(Me.KD.sliceId);e||t||(c=!0)}const{user:u}=this.props,d=o.current_user_perm>=4,p=(0,Le.yI)(u),h=(0,f.t)("Edit dataset"),g=(0,E.tZ)(we.v2,{onClick:this.handleMenuItemClick},this.props.isEditable&&!s&&(0,E.tZ)(we.v2.Item,{key:tt,"data-test":"edit-dataset",disabled:!d},d?h:(0,E.tZ)(Ae.u,{title:(0,f.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.")},h)),(0,E.tZ)(we.v2.Item,{key:Qe},(0,f.t)("Swap dataset")),(64===(0,We.cz)()||(0,We.w)())&&(0,E.tZ)(l.Fragment,null,(0,E.tZ)(we.v2.Item,{key:Xe},(0,f.t)("Import Excel dataset")),(0,E.tZ)(we.v2.Item,{key:Je},(0,f.t)("Import CSV dataset"))),!s&&(0,Le.lI)("SQL Editor")&&(0,E.tZ)(we.v2.Item,{key:et},(0,f.t)("View in SQL Lab"))),v=(0,E.tZ)(we.v2,{onClick:this.handleMenuItemClick},(0,E.tZ)(we.v2.Item,{key:"query_preview"},(0,E.tZ)(ke.Z,{triggerNode:(0,E.tZ)("span",{"data-test":"view-query-menu-item"},(0,f.t)("Query preview")),modalTitle:(0,f.t)("Query preview"),modalBody:(0,E.tZ)(ze.Z,{sql:(null==o?void 0:o.sql)||(null==o?void 0:o.select_star)||""}),modalFooter:(0,E.tZ)(He,{changeDatasource:this.toggleSaveDatasetModal,datasource:o}),draggable:!1,resizable:!1,responsive:!0})),p&&(0,E.tZ)(we.v2.Item,{key:et},(0,f.t)("View in SQL Lab")),(0,E.tZ)(we.v2.Item,{key:at},(0,f.t)("Save as dataset"))),{health_check_message:y}=o;let b;if(null!=o&&o.extra)if(Ee()(o.extra))try{b=JSON.parse(o.extra)}catch{}else b=o.extra;const _=s?(0,f.t)("Missing dataset"):(e=>"query"===(null==e?void 0:e.type)?null==e?void 0:e.sql:(null==e?void 0:e.name)||"")(o),C=_;return(0,E.tZ)(Ke,{"data-test":"datasource-control",className:"DatasourceControl"},(0,E.tZ)("div",{className:"data-container"},nt[null==o?void 0:o.type],((e,t)=>(null==e?void 0:e.length)>25?(0,E.tZ)(Ae.u,{title:t},(0,E.tZ)("span",{className:"title-select"},e)):(0,E.tZ)("span",{title:t,className:"title-select"},e))(_,C),y&&(0,E.tZ)(Ae.u,{title:y},(0,E.tZ)(z.Z.AlertSolid,{iconColor:i.colors.warning.base})),(null==(e=b)?void 0:e.warning_markdown)&&(0,E.tZ)(Ne.Z,{warningMarkdown:b.warning_markdown}),(0,E.tZ)(m.Gj,{overlay:o.type===Te.i9.Query?v:g,trigger:["click"],"data-test":"datasource-menu"},(0,E.tZ)(z.Z.MoreVert,{className:"datasource-modal-trigger","data-test":"datasource-menu-trigger"}))),s&&c&&(0,E.tZ)("div",{className:"error-alert"},(0,E.tZ)(Oe.Z,{level:"warning",title:(0,f.t)("Missing URL parameters"),source:"explore",subtitle:(0,E.tZ)(l.Fragment,null,(0,E.tZ)("p",null,(0,f.t)("The URL is missing the dataset_id or slice_id parameters.")))})),s&&!c&&(0,E.tZ)("div",{className:"error-alert"},(0,E.tZ)(Oe.Z,{level:"warning",title:(0,f.t)("Missing dataset"),source:"explore",subtitle:(0,E.tZ)(l.Fragment,null,(0,E.tZ)("p",null,(0,f.t)("The dataset linked to this chart may have been deleted.")),(0,E.tZ)("p",null,(0,E.tZ)(De.Z,{buttonStyle:"primary",onClick:()=>this.handleMenuItemClick({key:Qe})},(0,f.t)("Swap dataset"))))})),a&&(0,E.tZ)(Re.W,{datasource:o,show:a,onDatasourceSave:this.onDatasourceSave,onHide:this.toggleEditDatasourceModal}),t&&(0,E.tZ)(Re.Q,{onDatasourceSave:this.onDatasourceSave,onHide:this.toggleChangeDatasourceModal,show:t,onChange:r}),n&&(0,E.tZ)(je.W,{visible:n,onHide:this.toggleSaveDatasetModal,buttonTextOnSave:(0,f.t)("Save"),buttonTextOnOverwrite:(0,f.t)("Overwrite"),modalDescription:(0,f.t)("Save this query as a virtual dataset to continue exploring"),datasource:(0,Ie.z)(o),openWindow:!1,formData:this.props.form_data,issavedatasetbtn:"no"}))}}ot.propTypes=Ye,ot.defaultProps={onChange:()=>{},onDatasourceSave:null,value:null,isEditable:!0};const rt=(0,Ge.EN)((0,v.b)(ot));var it=a(101090),lt=a(737921),st=a(843700),ct=a(979684),ut=a(355786),dt=a(634087),pt=a(642753),ht=a(819113),mt=a(627130);const gt=s.iK.span`
  display: inline-block;
  padding: 2px 0;
`,ft=(0,s.iK)(N.II)`
  border-radius: ${({theme:e})=>e.borderRadius};
  height: 26px;
  padding-left: ${({theme:e})=>2.5*e.gridUnit}px;
`,vt=({title:e,isEditDisabled:t,onChange:a})=>{const[n,o]=(0,l.useState)(!1),[r,i]=(0,l.useState)(!1),s=(0,f.t)("My metric"),c=(0,l.useCallback)((()=>o(!0)),[]),u=(0,l.useCallback)((()=>o(!1)),[]),d=(0,l.useCallback)((()=>i(!0)),[]),p=(0,l.useCallback)((()=>i(!1)),[]),h=(0,l.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),p())}),[p]),m=(0,l.useCallback)((e=>{""===e.target.value&&a(e),p()}),[a,p]);return t?(0,E.tZ)("span",{"data-test":"AdhocMetricTitle"},(null==e?void 0:e.label)||s):r?(0,E.tZ)(ft,{type:"text",placeholder:null==e?void 0:e.label,value:null!=e&&e.hasCustomLabel?e.label:"",autoFocus:!0,onChange:a,onBlur:m,onKeyPress:h,"data-test":"AdhocMetricEditTitle#input"}):(0,E.tZ)(Ae.u,{placement:"top",title:(0,f.t)("Click to edit label")},(0,E.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable","data-test":"AdhocMetricEditTitle#trigger",onMouseOver:c,onMouseOut:u,onClick:d,onBlur:p,role:"button",tabIndex:0},(0,E.tZ)(gt,null,(null==e?void 0:e.label)||s),"\xa0",(0,E.tZ)("i",{className:"fa fa-pencil",style:{color:n?"black":"grey"}})))};var yt=a(563325),bt=a(237731),_t=a(171262),Ct=a(94301),Et=a(49238),Tt=a(794670),Zt=a(233313),St=a(269856),xt=a(699963),wt=a(822068);function At({displayGhostButton:e=!0,accept:t,valuesRenderer:a,...n}){const o=(0,s.Fg)(),[{isOver:r,canDrop:i},c]=(0,wt.L)({accept:t,drop:e=>{n.onDrop(e),null==n.onDropValue||n.onDropValue(e.value)},canDrop:e=>{var t;return n.canDrop(e)&&(null==(t=null==n.canDropValue?void 0:n.canDropValue(e.value))||t)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop(),type:e.getItemType()})}),u=(0,l.useMemo)((()=>a()),[a]);return(0,E.tZ)("div",{ref:c},(0,E.tZ)(j.gM,null,(0,E.tZ)(M.Z,n)),(0,E.tZ)(j.H$,{"data-test":"dnd-labels-container",canDrop:i,isOver:r},u,e&&(0,E.tZ)(j.SW,{cancelHover:!n.onClickGhostButton,onClick:n.onClickGhostButton},(0,E.tZ)(z.Z.PlusSmall,{iconColor:o.colors.grayscale.light1}),(0,f.t)(n.ghostButtonText||"Drop columns here"))))}var Rt=a(96055),Dt=a(328543),Ot=a(7848),Nt=a(727034),Mt=a(472813);const It=(0,s.iK)(y.V)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`;function Lt({children:e,index:t,clickClose:a,withCaret:n,isExtra:o,datasourceWarningMessage:r,canDelete:i=!0}){const c=(0,s.Fg)(),u=(0,l.useCallback)((e=>{e.stopPropagation(),a(t)}),[a,t]);return(0,E.tZ)(j.EQ,{"data-test":"option-label",withCaret:n},i&&(0,E.tZ)(j.gu,{role:"button","data-test":"remove-control-button",onClick:u},(0,E.tZ)(z.Z.XSmall,{iconColor:c.colors.grayscale.light1})),(0,E.tZ)(j.__,{"data-test":"control-label"},e),(!!r||o)&&(0,E.tZ)(It,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:r||(0,f.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),n&&(0,E.tZ)(j.Ne,null,(0,E.tZ)(z.Z.CaretRight,{iconColor:c.colors.grayscale.light1})))}const kt=s.iK.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;function Ft(e){const{index:t,label:a,tooltipTitle:n,column:r,type:i,onShiftOptions:s,clickClose:c,withCaret:u,isExtra:d,datasourceWarningMessage:p,canDelete:h=!0,...m}=e,g=(0,l.useRef)(null),f=(0,l.useRef)(null),[{isDragging:v},y]=(0,Nt.c)({item:{type:i,dragIndex:t},collect:e=>({isDragging:e.isDragging()})}),[,b]=(0,wt.L)({accept:i,hover:(e,a)=>{var n;if(!g.current)return;const{dragIndex:o}=e,r=t;if(o===r)return;const i=null==(n=g.current)?void 0:n.getBoundingClientRect(),l=(i.bottom-i.top)/2,c=a.getClientOffset(),u=c?c.y-i.top:0;o<r&&u<l||o>r&&u>l||(s(o,r),e.dragIndex=r)}}),_=!v&&n&&a&&n!==a||!v&&f&&f.current&&f.current.scrollWidth>f.current.clientWidth,C=()=>_?(0,E.tZ)(Ae.u,{title:n||a},(0,E.tZ)("span",null,a)):(0,E.tZ)("span",null,a),T=()=>{const e=r&&(0,Mt.GA)(r)?{verbose_name:r.label,expression:r.sqlExpression}:r;return(0,E.tZ)(xt.l,{column:e,labelRef:f,showType:!0})};return y(b(g)),(0,E.tZ)(j.a7,o()({ref:g},m),(0,E.tZ)(Lt,{index:t,clickClose:c,withCaret:u,isExtra:d,datasourceWarningMessage:p,canDelete:h},(0,E.tZ)((()=>a?(0,E.tZ)(kt,{ref:f},(0,E.tZ)(C,null)):r?(0,E.tZ)(kt,null,(0,E.tZ)(T,null)):null),null)))}function Pt({adhocFilter:e,options:t,datasource:a,onFilterEdit:n,onShiftOptions:o,onClickClose:r,partitionColumn:i,index:l,keyName:s}){const{actualTimeRange:c,title:u}=(0,Ot.w)(e);let d=null!=c?c:e.getDefaultLabel(),p=null!=u?u:e.getTooltipTitle();return"manualsetting"===s&&(d=d.replace("IN",""),p=p.replace("IN","")),(0,E.tZ)(Rt.Z,{key:l,adhocFilter:e,options:t,datasource:a,onFilterEdit:n,partitionColumn:i,keyName:s},(0,E.tZ)(Ft,{key:l,index:l,label:d,tooltipTitle:p,clickClose:r,onShiftOptions:o,type:pt.g.FilterOption,withCaret:!0,isExtra:e.isExtra,datasourceWarningMessage:e.datasourceWarning?(0,f.t)("This filter might be incompatible with current dataset"):void 0}))}function $t(e){return null==e?void 0:e.metric_name}const Ut=[pt.g.Column,pt.g.Metric,pt.g.MetricOption,pt.g.AdhocMetricOption],Vt=e=>{const{name:t,value:a=[],onChange:n=(()=>{}),datasource:r,columns:i,savedMetrics:s=[],formData:c,canDelete:u}=e,d=Array.from(null!=a?a:[]),p=e=>!(e instanceof Dt.ZP)&&(null==e?void 0:e.expressionType),[h,m]=(0,l.useState)(d.map((e=>p(e)?new Dt.ZP(e):e)));(0,l.useEffect)((()=>{m(a.map((e=>p(e)?new Dt.ZP(e):e)))}),[a]);const[g,v]=(0,l.useState)(!1),[y,b]=(0,l.useState)({}),_=void 0,C=(0,l.useMemo)((()=>{if($t(y))return new Dt.ZP({expressionType:Dt.vq.SQL,clause:Dt.Pr.HAVING,sqlExpression:null==y?void 0:y.expression});if(y instanceof ht.Z)return new Dt.ZP({expressionType:Dt.vq.SQL,clause:Dt.Pr.HAVING,sqlExpression:null==y?void 0:y.translateToSql()});const e={subject:null==y?void 0:y.column_name};e.subject&&(e.operator=St.LT[St.d.IN].operation,e.operatorId=St.d.IN);return new Dt.ZP(e)}),[y]),T=(0,l.useCallback)((e=>{n(h.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}),[n,h]),Z=((e,t)=>[...e,...[...(null==t?void 0:t.metrics)||[],null==t?void 0:t.metric].map((e=>e&&("string"===typeof e?{saved_metric_name:e}:new ht.Z(e))))].filter((e=>e)).reduce(((e,t)=>("saved_metric_name"in t&&t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):"column_name"in t&&t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof ht.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>{var a,n;return null!=(a=null==(n=e.saved_metric_name||e.column_name||e.label)?void 0:n.localeCompare(t.saved_metric_name||t.column_name||t.label||""))?a:0})))(i,c),S=(0,l.useCallback)((e=>{const t=[...h];t.splice(e,1),m(t),n(t)}),[n,h]),x=(0,l.useCallback)((e=>{"string"!==typeof(null==u?void 0:u(h[e],h))&&S(e)}),[u,S,h]),w=(0,l.useCallback)((e=>{v(e)}),[]),A=(0,l.useCallback)(((e,t)=>{const a=[...h];[a[t],a[e]]=[a[e],a[t]],m(a)}),[h]),R=(0,l.useCallback)((e=>{var t;return null==(t=s.find((t=>t.metric_name===e)))?void 0:t.expression}),[s]),D=(0,l.useCallback)((e=>{if(e instanceof Dt.ZP)return e;const t=e;return t.saved_metric_name?new Dt.ZP({expressionType:Dt.vq.SQL,subject:R(t.saved_metric_name),operator:St.LT[St.d.GREATER_THAN].operation,operatorId:St.d.GREATER_THAN,comparator:0,clause:Dt.Pr.HAVING}):t.label?new Dt.ZP({expressionType:Dt.vq.SQL,subject:new ht.Z(e).translateToSql(),operator:St.LT[St.d.GREATER_THAN].operation,operatorId:St.d.GREATER_THAN,comparator:0,clause:Dt.Pr.HAVING}):t.column_name?new Dt.ZP({expressionType:Dt.vq.SIMPLE,subject:t.column_name,operator:St.LT[St.d.EQUALS].operation,operatorId:St.d.EQUALS,comparator:"",clause:Dt.Pr.WHERE,isNew:!0}):null}),[r.type,R]),O=(0,l.useCallback)((()=>h.map(((e,a)=>(0,E.tZ)(Pt,{key:a,index:a,adhocFilter:e,options:Z,datasource:r,onFilterEdit:T,partitionColumn:_,onClickClose:x,onShiftOptions:A,keyName:t})))),[x,T,A,Z,_,r,JSON.stringify(h)]),N=(0,f.t)("Drop columns or metrics here"),M=(0,l.useCallback)((()=>{b({}),w(!0)}),[w]),I=(0,l.useCallback)((e=>{const t=D(e);if(t){const e=[...h,t];m(e),n(e)}}),[D,n,h]),L=(0,l.useCallback)((()=>{w(!1)}),[w]);return(0,E.tZ)(l.Fragment,null,(0,E.tZ)(At,o()({canDrop:!1,valuesRenderer:O,accept:Ut,ghostButtonText:N,onClickGhostButton:M},e)),(0,E.tZ)(Rt.Z,{adhocFilter:C,options:Z,datasource:r,onFilterEdit:I,partitionColumn:_,isControlledComponent:!0,visible:g,togglePopover:w,closePopover:L,requireSave:!!y,keyName:t}))},qt={onChange:h().func.isRequired,onClose:h().func.isRequired,onResize:h().func.isRequired,getCurrentTab:h().func,getCurrentLabel:h().func,adhocMetric:h().instanceOf(ht.Z).isRequired,columns:h().arrayOf(dt.Z),savedMetricsOptions:h().arrayOf(mt.Z),savedMetric:mt.Z,datasource:h().object,isNewMetric:h().bool,isLabelModified:h().bool},Ht={columns:[],getCurrentTab:We.EI,isNewMetric:!1},zt=(0,s.iK)(m.Ph)`
  .metric-option {
    & > svg {
      min-width: ${({theme:e})=>4*e.gridUnit+"px"};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,jt="SAVED";class Bt extends l.PureComponent{constructor(e){super(e),this.defaultActiveTabKey=this.getDefaultTab(),this.onSave=this.onSave.bind(this),this.onResetStateAndClose=this.onResetStateAndClose.bind(this),this.onColumnChange=this.onColumnChange.bind(this),this.onAggregateChange=this.onAggregateChange.bind(this),this.onIndicatorDateFormatChange=this.onIndicatorDateFormatChange.bind(this),this.onIndicatorTypeChange=this.onIndicatorTypeChange.bind(this),this.onSavedMetricChange=this.onSavedMetricChange.bind(this),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTabChange=this.onTabChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.refreshAceEditor=this.refreshAceEditor.bind(this),this.getDefaultTab=this.getDefaultTab.bind(this),this.state={adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric,width:St.kc,height:this.defaultActiveTabKey===ht.v.SIMPLE?St.Wq:St.H7},document.addEventListener("mouseup",this.onMouseUp)}componentDidMount(){var e,t,a;this.props.getCurrentTab(this.defaultActiveTabKey),null!=(e=this.props)&&null!=(t=e.controls)&&null!=(a=t.time_grain_sqla)&&a.value||this.setState((e=>({adhocMetric:e.adhocMetric.duplicateWith({indicatorType:null,expressionType:ht.v.SIMPLE})})))}componentDidUpdate(e,t){var a,n,o,r,i,l,s,c,u,d,p,h,m;(null==(a=t.adhocMetric)?void 0:a.sqlExpression)===(null==(n=this.state.adhocMetric)?void 0:n.sqlExpression)&&(null==(o=t.adhocMetric)?void 0:o.aggregate)===(null==(r=this.state.adhocMetric)?void 0:r.aggregate)&&(null==(i=t.adhocMetric)||null==(l=i.column)?void 0:l.column_name)===(null==(s=this.state.adhocMetric)||null==(c=s.column)?void 0:c.column_name)&&(null==(u=t.savedMetric)?void 0:u.metric_name)===(null==(d=this.state.savedMetric)?void 0:d.metric_name)||this.props.getCurrentLabel({savedMetricLabel:(null==(p=this.state.savedMetric)?void 0:p.verbose_name)||(null==(h=this.state.savedMetric)?void 0:h.metric_name),adhocMetricLabel:null==(m=this.state.adhocMetric)?void 0:m.getDefaultLabel()})}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}getDefaultTab(){const{adhocMetric:e,savedMetric:t,savedMetricsOptions:a,isNewMetric:n}=this.props;return(0,bt.Z)(e.column)||(0,bt.Z)(e.sqlExpression)?e.expressionType:(n||t.metric_name)&&Array.isArray(a)&&a.length>0?jt:e.expressionType}onSave(){var e;const{adhocMetric:t,savedMetric:a}=this.state,n=null!=a&&a.metric_name?a:t,o=null!=(e=this.props.savedMetric)&&e.metric_name?this.props.savedMetric:this.props.adhocMetric;this.props.onChange({...n},o),this.props.onClose()}onResetStateAndClose(){this.setState({adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric},this.props.onClose)}onColumnChange(e){const t=this.props.columns.find((t=>t.column_name===e));this.setState((e=>({adhocMetric:e.adhocMetric.duplicateWith({column:t,expressionType:ht.v.SIMPLE}),savedMetric:void 0})))}onAggregateChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({aggregate:e,expressionType:ht.v.SIMPLE}),savedMetric:void 0})))}onIndicatorDateFormatChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({indicatorDateFormat:e,expressionType:ht.v.SIMPLE}),savedMetric:void 0})))}onIndicatorTypeChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({indicatorType:e,expressionType:ht.v.SIMPLE,indicatorDateFormat:void 0}),savedMetric:void 0})))}onSavedMetricChange(e){const t=this.props.savedMetricsOptions.find((t=>t.metric_name===e));this.setState((e=>({savedMetric:t,adhocMetric:e.adhocMetric.duplicateWith({column:void 0,aggregate:void 0,sqlExpression:void 0,expressionType:ht.v.SIMPLE})})))}onSqlExpressionChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({sqlExpression:e,expressionType:ht.v.SQL}),savedMetric:void 0})))}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),St.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),St.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.refreshAceEditor(),this.props.getCurrentTab(e),this.setState({height:e===ht.v.SIMPLE?St.Wq:St.H7})}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}refreshAceEditor(){setTimeout((()=>{this.aceEditorRef&&this.aceEditorRef.editor.resize()}),0)}renderColumnOption(e){const t={...e};return t.metric_name&&!t.verbose_name&&(t.verbose_name=t.metric_name),(0,E.tZ)(xt.l,{column:t,showType:!0})}renderMetricOption(e){return(0,E.tZ)(xt.B,{metric:e,showType:!0})}convantListToFullpath(e){function t(e,a,n){if(a.length===e.length)return void n.push([...a]);const o=e[a.length];for(let r of o.comparator)a.includes(r)||(a.push(r),t(e,a,n),a.pop())}return function(e){const a=[];return t(e,[],a),a}(e)}render(){var e;const{adhocMetric:t,savedMetric:a,columns:n,savedMetricsOptions:r,onChange:i,onClose:s,onResize:c,datasource:u,isNewMetric:d,isLabelModified:p,controls:h,formData:g,name:v,...y}=this.props,{x_axis:b={},time_grain_sqla:_={}}=h||{},C=b.value,T=(_.choices,_.value),{adhocMetric:Z,savedMetric:S}=this.state,x=Zt.Z.concat(n.map((e=>({name:e.column_name,value:e.column_name,score:50,meta:"column"})))),w=Z.column&&Z.column.column_name||Z.inferSqlExpressionColumn(),A={ariaLabel:(0,f.t)("Select column"),placeholder:(0,f.t)("%s column(s)",n.length),value:w,onChange:this.onColumnChange,allowClear:!0,autoFocus:!w},R={ariaLabel:(0,f.t)("Select aggregate options"),placeholder:(0,f.t)("%s aggregates(s)",St.Ps.length),value:Z.aggregate||Z.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,allowClear:!0,autoFocus:!!w},D=(e=[])=>({ariaLabel:(0,f.t)("Select indicator date format options"),placeholder:(0,f.t)("%s indicator date format(s)",e.length),value:Z.indicatorDateFormat,onChange:this.onIndicatorDateFormatChange,allowClear:!0,autoFocus:!0}),O=(e=[])=>({ariaLabel:(0,f.t)("Select indicator type options"),placeholder:(0,f.t)("%s indicator type(s)",e.length),value:Z.indicatorType,onChange:this.onIndicatorTypeChange,allowClear:!0,autoFocus:!0}),N={ariaLabel:(0,f.t)("Select saved metrics"),placeholder:(0,f.t)("%s saved metric(s)",null!=(e=null==r?void 0:r.length)?e:0),value:null==S?void 0:S.metric_name,onChange:this.onSavedMetricChange,allowClear:!0,autoFocus:!0},M=Z.isValid()||(null==S?void 0:S.metric_name),I=p||d||!Z.equals(t)||!("undefined"===typeof(null==S?void 0:S.metric_name)&&"undefined"===typeof(null==a?void 0:a.metric_name))&&(null==S?void 0:S.metric_name)!==(null==a?void 0:a.metric_name);let L={};if(null!=u&&u.extra)try{L=JSON.parse(u.extra)}catch{}let k=null;const F=Z.aggregate||Z.inferSqlExpressionAggregate(),P=(e=[])=>(0,E.tZ)(Et.xJ,{label:(0,f.t)("indicator type")},(0,E.tZ)(m.Ph,o()({options:e},O(e)))),{viz_type:$}=g;if(["echarts_timeseries_bar","mixed_timeseries","echarts_timeseries_line"].includes($))if(!T&&C)["COUNT","COUNT_DISTINCT","SUM"].includes(F)&&(k=P(St.CO));else if(T&&C)if(["COUNT","COUNT_DISTINCT","SUM"].includes(F)&&Me.Vg.includes(T)){const e=P([...St.iT,...St.CO]);if("ratio"===Z.indicatorType)k=e;else{let t=[];"yoy"===Z.indicatorType?t=St.No.filter((e=>e.includes.includes(T))):"qoq"===Z.indicatorType&&(t=St.u3.filter((e=>e.includes.includes(T)))),k=(0,E.tZ)(l.Fragment,null,e,(e=>(0,E.tZ)(Et.xJ,{label:(0,f.t)("indicator date format")},(0,E.tZ)(m.Ph,o()({options:e},D(e)))))(t))}}else["COUNT","COUNT_DISTINCT","SUM"].includes(F)&&(k=P(St.CO));return(0,E.tZ)(Et.l0,o()({layout:"vertical",id:"metrics-edit-popover","data-test":"metrics-edit-popover"},y),(0,E.tZ)(_t.ZP,{id:"adhoc-metric-edit-tabs","data-test":"adhoc-metric-edit-tabs",defaultActiveKey:this.defaultActiveTabKey,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onChange:this.onTabChange,allowOverflow:!0},(0,E.tZ)(_t.ZP.TabPane,{key:jt,tab:(0,f.t)("Saved")},(0,ut.Z)(r).length>0?(0,E.tZ)(Et.xJ,{label:(0,f.t)("Saved metric")},(0,E.tZ)(zt,o()({options:(0,ut.Z)(r).map((e=>({value:e.metric_name,label:e.metric_name,customLabel:this.renderMetricOption(e),key:e.id})))},N))):u.type===Te.i9.Table?(0,E.tZ)(Ct.Tc,{image:"empty.svg",title:(0,f.t)("No saved metrics found"),description:(0,f.t)('Add metrics to dataset in "Edit datasource" modal')}):(0,E.tZ)(Ct.Tc,{image:"empty.svg",title:(0,f.t)("No saved metrics found"),description:(0,E.tZ)(l.Fragment,null,(0,E.tZ)("span",{tabIndex:0,role:"button",onClick:()=>{this.props.handleDatasetModal(!0),this.props.onClose()}},(0,f.t)("Create a dataset")),(0,f.t)(" to add metrics"))})),(0,E.tZ)(_t.ZP.TabPane,{key:ht.v.SIMPLE,tab:L.disallow_adhoc_metrics?(0,E.tZ)(Ae.u,{title:(0,f.t)("Simple ad-hoc metrics are not enabled for this dataset")},(0,f.t)("Simple")):(0,f.t)("Simple"),disabled:L.disallow_adhoc_metrics},(0,E.tZ)(Et.xJ,{label:(0,f.t)("column")},(0,E.tZ)(m.Ph,o()({options:n.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,key:e.id,customLabel:this.renderColumnOption(e)})))},A))),(0,E.tZ)(Et.xJ,{label:(0,f.t)("aggregate")},(0,E.tZ)(m.Ph,o()({options:St.Ps.map((e=>({value:e,label:e,key:e})))},R))),k),["echarts_timeseries_line","echarts_timeseries_bar","pivot_table_v2","table"].includes(null==g?void 0:g.viz_type)&&"timeseries_limit_metric"===v&&(0,E.tZ)(_t.ZP.TabPane,{key:"manual",tab:(0,f.t)("Manual configuration")},(0,E.tZ)(Vt,{name:"manualsetting",onChange:e=>{let t="";if(null!=e&&e.length){const a=this.convantListToFullpath(e);let n="CASE ";a.map(((t,a)=>{let o=[];for(let a=0;a<t.length;a++){const n=e[a],r=t[a],i=n.subject;o.push(` \`${i}\` = '${r}' `)}const r=` WHEN ${o.join(" AND ")} THEN ${a+1} \n `;n+=r})),n+=` ELSE ${a.length+1} END `,t=n}this.setState((a=>({adhocMetric:a.adhocMetric.duplicateWith({manualsetting:e,sqlExpression:t,expressionType:ht.v.SQL}),savedMetric:void 0})))},value:this.state.adhocMetric.manualsetting||[],datasource:u,columns:n,savedMetrics:[],selectedMetrics:[]})),(0,E.tZ)(_t.ZP.TabPane,{key:ht.v.SQL,tab:L.disallow_adhoc_metrics?(0,E.tZ)(Ae.u,{title:(0,f.t)("Custom SQL ad-hoc metrics are not enabled for this dataset")},(0,f.t)("Custom SQL")):(0,f.t)("Custom SQL"),"data-test":"adhoc-metric-edit-tab#custom",disabled:L.disallow_adhoc_metrics},(0,E.tZ)(Tt.iO,{"data-test":"sql-editor",showLoadingForImport:!0,ref:this.handleAceEditorRef,keywords:x,height:this.state.height-80+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:Z.sqlExpression||Z.translateToSql({transformCountDistinct:!0}),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0}))),(0,E.tZ)("div",null,(0,E.tZ)(De.Z,{buttonSize:"small",onClick:this.onResetStateAndClose,"data-test":"AdhocMetricEdit#cancel",cta:!0},(0,f.t)("Close")),(0,E.tZ)(De.Z,{disabled:!M||!I,buttonStyle:"primary",buttonSize:"small","data-test":"AdhocMetricEdit#save",onClick:this.onSave,cta:!0},(0,f.t)("Save")),(0,E.tZ)("i",{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}Bt.propTypes=qt,Bt.defaultProps=Ht;class Gt extends l.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.getCurrentTab=this.getCurrentTab.bind(this),this.getCurrentLabel=this.getCurrentLabel.bind(this),this.onChange=this.onChange.bind(this),this.handleDatasetModal=this.handleDatasetModal.bind(this),this.state={adhocMetric:e.adhocMetric,popoverVisible:!1,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1,isTitleEditDisabled:!1,showSaveDatasetModal:!1}}static getDerivedStateFromProps(e,t){return t.adhocMetric.optionName!==e.adhocMetric.optionName?{adhocMetric:e.adhocMetric,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1}:{adhocMetric:e.adhocMetric}}onLabelChange(e){var t;const{verbose_name:a,metric_name:n}=this.props.savedMetric,o=null==(t=this.props.adhocMetric)?void 0:t.getDefaultLabel(),r=e.target.value;this.setState((e=>({title:{label:r||e.currentLabel||a||n||o,hasCustomLabel:!!r},labelModified:!0})))}onPopoverResize(){this.forceUpdate()}handleDatasetModal(e){this.setState({showSaveDatasetModal:e})}closePopover(){this.togglePopover(!1),this.setState({labelModified:!1})}togglePopover(e){this.setState({popoverVisible:e})}getCurrentTab(e){this.setState({isTitleEditDisabled:e===jt})}getCurrentLabel({savedMetricLabel:e,adhocMetricLabel:t}){const a=e||t;this.setState({currentLabel:a,labelModified:!0}),!e&&this.state.title.hasCustomLabel||this.setState({title:{label:a,hasCustomLabel:!1}})}onChange(e,t){this.props.onMetricEdit({...e,...this.state.title},t)}render(){var e;const{adhocMetric:t,savedMetric:a,columns:n,savedMetricsOptions:o,datasource:r,isControlledComponent:i,controls:s,formData:c,name:u}=this.props,{verbose_name:d,metric_name:p}=a,{hasCustomLabel:h,label:m}=t,g=h?m:t.getDefaultLabel(),v=this.state.labelModified?this.state.title:{label:d||p||g,hasCustomLabel:h},{visible:y,togglePopover:b,closePopover:_}=i?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},C=(0,E.tZ)(yt.b,null,(0,E.tZ)(Bt,{name:u,adhocMetric:t,columns:n,savedMetricsOptions:o,savedMetric:a,datasource:r,handleDatasetModal:this.handleDatasetModal,onResize:this.onPopoverResize,onClose:_,onChange:this.onChange,getCurrentTab:this.getCurrentTab,getCurrentLabel:this.getCurrentLabel,isNewMetric:this.props.isNew,controls:s,formData:c,isLabelModified:this.state.labelModified&&g!==this.state.title.label})),T=(0,E.tZ)(vt,{title:v,onChange:this.onLabelChange,isEditDisabled:this.state.isTitleEditDisabled});return["echarts_timeseries_line","echarts_timeseries_bar","pivot_table_v2","table"].includes(null==(e=this.props.formData)?void 0:e.viz_type),(0,E.tZ)(l.Fragment,null,this.state.showSaveDatasetModal&&(0,E.tZ)(je.W,{visible:this.state.showSaveDatasetModal,onHide:()=>this.handleDatasetModal(!1),buttonTextOnSave:(0,f.t)("Save"),buttonTextOnOverwrite:(0,f.t)("Overwrite"),modalDescription:(0,f.t)("Save this query as a virtual dataset to continue exploring"),datasource:r}),(0,E.tZ)(Z.Z,{placement:"right",trigger:"click",content:C,defaultVisible:y,visible:y,onVisibleChange:b,title:T,destroyTooltipOnHide:!0},this.props.children))}}const Wt=(0,g.$j)((function(e){var t,a;return{controls:null==e||null==(t=e.explore)?void 0:t.controls,formData:null==e||null==(a=e.explore)?void 0:a.form_data}}))(Gt),Yt={adhocMetric:h().instanceOf(ht.Z),onMetricEdit:h().func.isRequired,onRemoveMetric:h().func,columns:h().arrayOf(dt.Z),savedMetricsOptions:h().arrayOf(mt.Z),savedMetric:mt.Z,datasource:h().object,onMoveLabel:h().func,onDropLabel:h().func,index:h().number,type:h().string,multi:h().bool,datasourceWarningMessage:h().string};class Kt extends l.PureComponent{constructor(e){super(e),this.onRemoveMetric=this.onRemoveMetric.bind(this)}onRemoveMetric(e){e.stopPropagation(),this.props.onRemoveMetric(this.props.index)}render(){const{adhocMetric:e,onMetricEdit:t,columns:a,savedMetricsOptions:n,savedMetric:o,datasource:r,onMoveLabel:i,onDropLabel:l,index:s,type:c,multi:u,name:d,datasourceWarningMessage:p}=this.props;return(0,E.tZ)(Wt,{adhocMetric:e,onMetricEdit:t,columns:a,savedMetricsOptions:n,savedMetric:o,datasource:r,name:d},(0,E.tZ)(j.yz,{savedMetric:o,adhocMetric:e,label:e.label,onRemove:this.onRemoveMetric,onMoveLabel:i,onDropLabel:l,index:s,type:null!=c?c:pt.g.AdhocMetricOption,withCaret:!0,isFunction:!0,multi:u,datasourceWarningMessage:p}))}}const Qt=Kt;Kt.propTypes=Yt;const Jt={option:h().oneOfType([h().object,h().string]).isRequired,index:h().number.isRequired,onMetricEdit:h().func,onRemoveMetric:h().func,onMoveLabel:h().func,onDropLabel:h().func,columns:h().arrayOf(dt.Z),savedMetrics:h().arrayOf(mt.Z),savedMetricsOptions:h().arrayOf(mt.Z),multi:h().bool,datasource:h().object,datasourceWarningMessage:h().string};function Xt({option:e,onMetricEdit:t,onRemoveMetric:a,columns:n,savedMetrics:o,savedMetricsOptions:r,datasource:i,onMoveLabel:l,onDropLabel:s,index:c,type:u,multi:d,name:p,datasourceWarningMessage:h}){let m;var g;if("string"===typeof e?(g=e,m=o.find((e=>e.metric_name===g))):e.metric_name&&(m=e),e instanceof ht.Z||m){var f;const o={onMetricEdit:t,onRemoveMetric:a,columns:n,name:p,savedMetricsOptions:r,datasource:i,adhocMetric:e instanceof ht.Z?e:new ht.Z({}),onMoveLabel:l,onDropLabel:s,index:c,savedMetric:null!=(f=m)?f:{},type:u,multi:d,datasourceWarningMessage:h};return(0,E.tZ)(Qt,o)}return null}Xt.propTypes=Jt;var ea=a(717536);const ta={name:h().string.isRequired,onChange:h().func,value:h().oneOfType([h().arrayOf(h().oneOfType([h().string,ea.Z])),h().oneOfType([h().string,ea.Z])]),columns:h().arrayOf(dt.Z),savedMetrics:h().arrayOf(mt.Z),isLoading:h().bool,multi:h().bool,clearable:h().bool,datasource:h().object};function aa(e,t,a){var n;return null!=(n=null==e?void 0:e.filter((e=>Array.isArray(t)?!t.includes(e.metric_name)||e.metric_name===a:e)))?n:[]}function na(e){return e&&!(e instanceof ht.Z)&&e.expressionType}function oa(e){return e?Array.isArray(e)?e.map((e=>na(e)?new ht.Z(e):e)):na(e)?[new ht.Z(e)]:[e]:[]}const ra={metric_name:"",expression:""},ia=({onChange:e,multi:t,value:a,columns:n,savedMetrics:o,datasource:r,maxValueLength:u,...d})=>{const[p,h]=(0,l.useState)(oa(a)),m=(0,s.Fg)(),g=(0,c.D)(n),v=(0,c.D)(o),y=(0,l.useCallback)((a=>{if(null===a)return void e(null);const n=(0,ut.Z)(a).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));e(t?n:n[0])}),[t,e]),b=(0,l.useCallback)((e=>{const t=[...p,e];h(t),y(t)}),[y,p]),_=(0,l.useCallback)(((e,t)=>{const a=p.map((a=>a!==t.metric_name&&"undefined"===typeof a.optionName||a.optionName!==t.optionName?a:e));h(a),y(a)}),[y,p]),C=(0,l.useCallback)((e=>{if(!Array.isArray(p))return;const t=[...p];t.splice(e,1),h(t),y(t)}),[y,p]),T=(0,l.useCallback)(((e,t)=>{const a=[...p];[a[t],a[e]]=[a[e],a[t]],h(a)}),[p]),Z=(0,l.useCallback)((()=>!t&&p.length>0),[t,p.length]),S=(0,l.useMemo)((()=>aa(o,a,null)),[a,o]),x=(0,l.useMemo)((()=>new ht.Z({})),[p]),w=(0,l.useCallback)((e=>Z()?e:(0,E.tZ)(Wt,{adhocMetric:x,onMetricEdit:b,columns:n,savedMetricsOptions:S,savedMetric:ra,datasource:r,isNew:!0},e)),[n,r,Z,x,b,S]);(0,l.useEffect)((()=>{if(a&&(!i()(g,n)||!i()(v,o))){const e=((e,t,a)=>(0,ut.Z)(e).filter((e=>"string"===typeof e||e.metric_name?null==a?void 0:a.some((t=>t.metric_name===e||t.metric_name===e.metric_name)):null==t?void 0:t.some((t=>!e.column||e.column.column_name===t.column_name)))))(a,n,o);i()(e,a)||y(e)}}),[n,y,o]),(0,l.useEffect)((()=>{h(oa(a))}),[a]);const A=(0,l.useCallback)((()=>y(p)),[y,p]),R=(0,l.useCallback)(((e,a)=>(0,E.tZ)(Xt,{key:a,index:a,option:e,onMetricEdit:_,onRemoveMetric:C,columns:n,datasource:r,savedMetrics:o,savedMetricsOptions:aa(o,p,null==p?void 0:p[a]),onMoveLabel:T,onDropLabel:A,multi:t})),[n,r,T,t,A,_,C,o,p]);return(0,E.tZ)("div",{className:"metrics-select"},(0,E.tZ)(j.gM,null,(0,E.tZ)(M.Z,d),w((0,E.tZ)(j.IG,{disabled:Z(),"data-test":"add-metric-button"},(0,E.tZ)(z.Z.PlusLarge,{iconSize:"s",iconColor:m.colors.grayscale.light5})))),(0,E.tZ)(j.yj,null,p.length>0?p.map(((e,t)=>R(e,t))):w((0,E.tZ)(j.SW,null,(0,E.tZ)(z.Z.PlusSmall,{iconColor:m.colors.grayscale.light1}),(0,f.t)("Add metric")))))};ia.propTypes=ta,ia.defaultProps={onChange:()=>{},clearable:!0,savedMetrics:[],columns:[]};const la=ia;var sa=a(883734);const ca="fix",ua="metric",da={onChange:h().func,value:h().object,isFloat:h().bool,datasource:h().object.isRequired,default:h().shape({type:h().oneOf(["fix","metric"]),value:h().oneOfType([h().string,h().number])})},pa={onChange:()=>{},default:{type:ca,value:5}};class ha extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.setType=this.setType.bind(this),this.setFixedValue=this.setFixedValue.bind(this),this.setMetric=this.setMetric.bind(this);const t=(e.value?e.value.type:e.default.type)||ca,a=(e.value?e.value.value:e.default.value)||"100";this.state={type:t,fixedValue:t===ca?a:"",metricValue:t===ua?a:null}}onChange(){this.props.onChange({type:this.state.type,value:this.state.type===ca?this.state.fixedValue:this.state.metricValue})}setType(e){this.setState({type:e},this.onChange)}setFixedValue(e){this.setState({fixedValue:e},this.onChange)}setMetric(e){this.setState({metricValue:e},this.onChange)}render(){const e=(this.props.value||this.props.default).type||ca,t=this.props.datasource?this.props.datasource.columns:null,a=this.props.datasource?this.props.datasource.metrics:null;return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,this.props),(0,E.tZ)(st.Z,{ghost:!0,css:e=>(0,E.iv)("&.ant-collapse>.ant-collapse-item.ant-collapse-no-arrow>.ant-collapse-header{border:0px;padding:0px 0px ",2*e.gridUnit,"px 0px;display:inline-block;}&.ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box{padding:0px;& .well{margin-bottom:0px;padding:",2*e.gridUnit,"px;}}","")},(0,E.tZ)(st.Z.Panel,{showArrow:!1,header:(0,E.tZ)(lt.Z,{onClick:()=>{}},this.state.type===ca&&(0,E.tZ)("span",null,this.state.fixedValue),this.state.type===ua&&(0,E.tZ)("span",null,(0,E.tZ)("span",null,(0,f.t)("metric"),": "),(0,E.tZ)("strong",null,this.state.metricValue?this.state.metricValue.label:null)))},(0,E.tZ)("div",{className:"well"},(0,E.tZ)(sa.Z,{title:(0,f.t)("Fixed"),isSelected:e===ca,onSelect:()=>{this.setType(ca)}},(0,E.tZ)(ct.Z,{isFloat:!0,onChange:this.setFixedValue,onFocus:()=>{this.setType(ca)},value:this.state.fixedValue})),(0,E.tZ)(sa.Z,{title:(0,f.t)("Based on a metric"),isSelected:e===ua,onSelect:()=>{this.setType(ua)}},(0,E.tZ)(la,{name:"metric",columns:t,savedMetrics:a,multi:!1,onFocus:()=>{this.setType(ua)},onChange:this.setMetric,value:this.state.metricValue,datasource:this.props.datasource}))))))}}ha.propTypes=da,ha.defaultProps=pa;var ma=a(414114),ga=a(998286);function fa(e){return void 0!==e.value}const va=(0,ma.ZP)((({addDangerToast:e,allowClear:t=!0,ariaLabel:a,dataEndpoint:n,multi:o=!0,mutator:r,onChange:i,placeholder:s,value:c,...u})=>{const[d,p]=(0,l.useState)([]);return(0,l.useEffect)((()=>{const t=t=>(0,ga.O$)(t).then((t=>{const{error:a}=t;e((0,f.t)("Error while fetching data: %s",a))}));Ze.Z.get({endpoint:n}).then((e=>{const t=r?r(e.json):e.json.result;p(t)})).catch(t)}),[e,n,r]),(0,E.tZ)(m.Ph,{allowClear:t,ariaLabel:a||(0,f.t)("Select ..."),value:(()=>{const e=c||(void 0!==u.default?u.default:void 0);if(null!==e||d.find((e=>null===e.value)))return e})(),header:(0,E.tZ)(M.Z,u),mode:o?"multiple":"single",onChange:e=>{let t=e;if(Array.isArray(e)){t=e.map((e=>fa(e)?e.value:e))}fa(e)&&(t=e.value),i(t)},options:d,placeholder:s})}));var ya=a(182199),ba=a(436155);var _a={name:"mlsake",styles:"margin-left:0;margin-right:0"};function Ca(e){return(0,E.tZ)(ba.Z,o()({},e,{css:_a}))}var Ea=a(100665),Ta=a(542878);const Za={label:h().string,tooltip:h().string,colType:h().string,width:h().string,height:h().string,timeLag:h().oneOfType([h().string,h().number]),timeRatio:h().string,comparisonType:h().string,showYAxis:h().bool,yAxisBounds:h().array,bounds:h().array,d3format:h().string,dateFormat:h().string,onChange:h().func},Sa={label:(0,f.t)("Time series columns"),tooltip:"",colType:"",width:"",height:"",timeLag:"",timeRatio:"",comparisonType:"",showYAxis:!1,yAxisBounds:[null,null],bounds:[null,null],d3format:"",dateFormat:""},xa=[{value:"value",label:(0,f.t)("Actual value"),key:"value"},{value:"diff",label:(0,f.t)("Difference"),key:"diff"},{value:"perc",label:(0,f.t)("Percentage"),key:"perc"},{value:"perc_change",label:(0,f.t)("Percentage change"),key:"perc_change"}],wa=[{value:"time",label:(0,f.t)("Time comparison"),key:"time"},{value:"contrib",label:(0,f.t)("Contribution"),key:"contrib"},{value:"spark",label:(0,f.t)("Sparkline"),key:"spark"},{value:"avg",label:(0,f.t)("Period average"),key:"avg"}],Aa=(0,s.iK)(m.X2)`
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
  display: flex;
  align-items: center;
`,Ra=(0,s.iK)(m.JX)`
  display: flex;
  align-items: center;
`,Da=(0,s.iK)(y.V)`
  margin-left: ${({theme:e})=>e.gridUnit}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,Oa=s.iK.div`
  margin-top: ${({theme:e})=>5*e.gridUnit}px;
  display: flex;
  justify-content: center;
`;class Na extends l.Component{constructor(e){super(e),this.onSave=this.onSave.bind(this),this.onClose=this.onClose.bind(this),this.resetState=this.resetState.bind(this),this.initialState=this.initialState.bind(this),this.onPopoverVisibleChange=this.onPopoverVisibleChange.bind(this),this.state=this.initialState()}initialState(){return{label:this.props.label,tooltip:this.props.tooltip,colType:this.props.colType,width:this.props.width,height:this.props.height,timeLag:this.props.timeLag||0,timeRatio:this.props.timeRatio,comparisonType:this.props.comparisonType,showYAxis:this.props.showYAxis,yAxisBounds:this.props.yAxisBounds,bounds:this.props.bounds,d3format:this.props.d3format,dateFormat:this.props.dateFormat,popoverVisible:!1}}resetState(){const e=this.initialState();this.setState({...e})}onSave(){this.props.onChange(this.state),this.setState({popoverVisible:!1})}onClose(){this.resetState()}onSelectChange(e,t){this.setState({[e]:t})}onTextInputChange(e,t){this.setState({[e]:t.target.value})}onCheckboxChange(e,t){this.setState({[e]:t})}onBoundsChange(e){this.setState({bounds:e})}onPopoverVisibleChange(e){e?this.setState({popoverVisible:e}):this.resetState()}onYAxisBoundsChange(e){this.setState({yAxisBounds:e})}textSummary(){return`${this.props.label}`}formRow(e,t,a,n){return(0,E.tZ)(Aa,null,(0,E.tZ)(Ra,{xs:24,md:11},e,(0,E.tZ)(Da,{placement:"top",tooltip:t,label:a})),(0,E.tZ)(m.JX,{xs:24,md:13},n))}renderPopover(){return(0,E.tZ)("div",{id:"ts-col-popo",style:{width:320}},this.formRow((0,f.t)("Label"),(0,f.t)("The column header label"),"time-lag",(0,E.tZ)(N.II,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),placeholder:(0,f.t)("Label")})),this.formRow((0,f.t)("Tooltip"),(0,f.t)("Column header tooltip"),"col-tooltip",(0,E.tZ)(N.II,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),placeholder:(0,f.t)("Tooltip")})),this.formRow((0,f.t)("Type"),(0,f.t)("Type of comparison, value difference or percentage"),"col-type",(0,E.tZ)(m.Ph,{ariaLabel:(0,f.t)("Type"),value:this.state.colType||void 0,onChange:this.onSelectChange.bind(this,"colType"),options:wa})),(0,E.tZ)("hr",null),"spark"===this.state.colType&&this.formRow((0,f.t)("Width"),(0,f.t)("Width of the sparkline"),"spark-width",(0,E.tZ)(N.II,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),placeholder:(0,f.t)("Width")})),"spark"===this.state.colType&&this.formRow((0,f.t)("Height"),(0,f.t)("Height of the sparkline"),"spark-width",(0,E.tZ)(N.II,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),placeholder:(0,f.t)("Height")})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow((0,f.t)("Time lag"),(0,f.t)("Number of periods to compare against"),"time-lag",(0,E.tZ)(N.II,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),placeholder:(0,f.t)("Time Lag")})),["spark"].indexOf(this.state.colType)>=0&&this.formRow((0,f.t)("Time ratio"),(0,f.t)("Number of periods to ratio against"),"time-ratio",(0,E.tZ)(N.II,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),placeholder:(0,f.t)("Time Ratio")})),"time"===this.state.colType&&this.formRow((0,f.t)("Type"),(0,f.t)("Type of comparison, value difference or percentage"),"comp-type",(0,E.tZ)(m.Ph,{ariaLabel:(0,f.t)("Type"),value:this.state.comparisonType||void 0,onChange:this.onSelectChange.bind(this,"comparisonType"),options:xa})),"spark"===this.state.colType&&this.formRow((0,f.t)("Show Y-axis"),(0,f.t)("Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise."),"show-y-axis-bounds",(0,E.tZ)($.Z,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow((0,f.t)("Y-axis bounds"),(0,f.t)("Manually set min/max values for the y-axis."),"y-axis-bounds",(0,E.tZ)(P,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow((0,f.t)("Color bounds"),(0,f.t)("Number bounds used for color encoding from red to blue.\n               Reverse the numbers for blue to red. To get pure red or blue,\n               you can enter either only min or max."),"bounds",(0,E.tZ)(P,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow((0,f.t)("Number format"),(0,f.t)("Optional d3 number format string"),"d3-format",(0,E.tZ)(N.II,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),placeholder:(0,f.t)("Number format string")})),"spark"===this.state.colType&&this.formRow((0,f.t)("Date format"),(0,f.t)("Optional d3 date format string"),"date-format",(0,E.tZ)(N.II,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),placeholder:(0,f.t)("Date format string")})),(0,E.tZ)(Oa,null,(0,E.tZ)(De.Z,{buttonSize:"small",onClick:this.onClose,cta:!0},(0,f.t)("Close")),(0,E.tZ)(De.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,f.t)("Save"))))}render(){return(0,E.tZ)("span",null,this.textSummary()," ",(0,E.tZ)(Z.Z,{trigger:"click",content:this.renderPopover(),title:(0,f.t)("Column Configuration"),visible:this.state.popoverVisible,onVisibleChange:this.onPopoverVisibleChange},(0,E.tZ)(y.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}Na.propTypes=Za,Na.defaultProps=Sa;var Ma=a(279512);const Ia=["longitude","latitude","zoom","bearing","pitch"],La={onChange:h().func,value:h().shape({longitude:h().number,latitude:h().number,zoom:h().number,bearing:h().number,pitch:h().number}),default:h().object,name:h().string.isRequired},ka={onChange:()=>{},default:{type:"fix",value:5},value:{longitude:6.85236157047845,latitude:31.222656842808707,zoom:1,bearing:0,pitch:0}};class Fa extends l.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e,t){this.props.onChange({...this.props.value,[e]:t})}renderTextControl(e){return(0,E.tZ)("div",{key:e},(0,E.tZ)(Et.lX,null,e),(0,E.tZ)(ct.Z,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}renderPopover(){return(0,E.tZ)("div",{id:`filter-popover-${this.props.name}`},Ia.map((e=>this.renderTextControl(e))))}renderLabel(){return this.props.value.longitude&&this.props.value.latitude?`${(0,Ma.decimal2sexagesimal)(this.props.value.longitude)} | ${(0,Ma.decimal2sexagesimal)(this.props.value.latitude)}`:"N/A"}render(){return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,this.props),(0,E.tZ)(ne.ZP,{container:document.body,trigger:"click",placement:"right",content:this.renderPopover(),title:(0,f.t)("Viewport")},(0,E.tZ)(lt.Z,{className:"pointer"},this.renderLabel())))}}Fa.propTypes=La,Fa.defaultProps=ka;var Pa=a(311064),$a=a(514278),Ua=a(774069),Va=a(920292),qa=a(13284);const Ha=[{name:"echarts_timeseries_line",icon:(0,E.tZ)(z.Z.LineChartTile,null)},{name:"echarts_timeseries_bar",icon:(0,E.tZ)(z.Z.BarChartTile,null)},{name:"echarts_area",icon:(0,E.tZ)(z.Z.AreaChartTile,null)},{name:"table",icon:(0,E.tZ)(z.Z.TableChartTile,null)},{name:"big_number_total",icon:(0,E.tZ)(z.Z.BigNumberChartTile,null)},{name:"pie",icon:(0,E.tZ)(z.Z.PieChartTile,null)}],za={iconSize:"l",css:e=>E.iv`
    padding: ${e.gridUnit}px;
    & > * {
      line-height: 0;
    }
  `},ja=({isActive:e,isRendered:t,vizMeta:a,onTileClick:n})=>{var r;const{mountedPluginMetadata:i}=(0,$a.gp)(),c=(0,l.useRef)(null),u=(0,s.Fg)(),d=2*u.transitionTiming,[p,h]=(0,l.useState)(!1),[m,g]=(0,l.useState)(!1),[v,y]=(0,l.useState)(!1),b=a.name?(null==(r=i[a.name])?void 0:r.name)||`${a.name}`:(0,f.t)("Select Viz Type"),_=(0,l.useCallback)((()=>{n(a.name),g(!0),h(!1),setTimeout((()=>{g(!1)}),1e3*d)}),[n,d,a.name]);(0,l.useEffect)((()=>{y(Boolean(!m&&(!e||c.current&&c.current.scrollWidth>c.current.clientWidth)))}),[e,m]);const C=(0,l.useMemo)((()=>e?{}:{role:"button",tabIndex:0,onClick:_}),[_,e]);let T=null;return v&&(T=t?(0,f.t)("Currently rendered: %s",b):b),(0,E.tZ)(Ae.u,{title:T,onVisibleChange:e=>h(e),visible:p&&!m,placement:"top",mouseEnterDelay:.4},(0,E.tZ)("div",o()({},C,{css:E.iv`
          display: flex;
          align-items: center;
          text-transform: uppercase;

          color: ${u.colors.grayscale.base};
          font-weight: ${u.typography.weights.bold};
          border-radius: 6px;
          white-space: nowrap;
          overflow: hidden;
          max-width: fit-content;

          ${!e&&E.iv`
            flex-shrink: 0;
            width: ${6*u.gridUnit}px;
            background-color: transparent;
            transition: none;
            &:hover svg path {
              fill: ${u.colors.primary.base};
              transition: fill ${u.transitionTiming}s ease-out;
            }
          `}

          ${e&&E.iv`
            width: 100%;
            background-color: ${u.colors.grayscale.light4};
            transition: width ${d}s ease-out,
              background-color ${d}s ease-out;
            cursor: default;
            svg path {
              fill: ${u.colors.primary.base};
            }
          `}
        `}),a.icon," ",(0,E.tZ)("span",{css:E.iv`
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            padding-right: ${u.gridUnit}px;
          `,ref:c},b)))},Ba=l.memo((({currentSelection:e,onChange:t})=>{const a=(0,g.v9)((e=>{var t,a,n;return null==(t=e.charts)||null==(a=t[(0,_.Jp)(e.explore)])||null==(n=a.latestQueryFormData)?void 0:n.viz_type})),n=(0,l.useMemo)((()=>{const t=[...Ha];return e&&Ha.every((t=>t.name!==e))&&e!==a&&t.unshift({name:e,icon:(0,E.tZ)(z.Z.MonitorOutlined,o()({},za,{"aria-label":"monitor"}))}),a&&Ha.every((e=>e.name!==a))&&t.unshift({name:a,icon:(0,E.tZ)(z.Z.CheckSquareOutlined,o()({},za,{"aria-label":"check-square"}))}),t}),[e,a]);return(0,E.tZ)("div",{css:e=>E.iv`
          display: flex;
          justify-content: space-between;
          column-gap: ${e.gridUnit}px;
        `,"data-test":"fast-viz-switcher"},n.map((n=>(0,E.tZ)(ja,{vizMeta:n,isActive:e===n.name,isRendered:a===n.name,onTileClick:t,key:n.name}))))})),Ga=(0,Va.Z)().common.conf.VIZ_TYPE_DENYLIST||[],Wa=(0,Pa.Z)();function Ya({vizType:e}){return(0,$a.gp)().loading||Wa.has(e)?null:(0,E.tZ)("div",{className:"text-danger",css:e=>E.iv`
          margin-top: ${e.gridUnit}px;
        `},(0,E.tZ)("i",{className:"fa fa-exclamation-circle text-danger"})," ",(0,E.tZ)("small",null,(0,f.t)("This visualization type is not supported.")))}const Ka=(0,s.iK)(Ua.Z)`
  .ant-modal-body {
    padding: 0;
  }
`,Qa=({value:e,onChange:t=We.EI,isModalOpenInit:a})=>{const[n,o]=(0,l.useState)(!!a),[r,i]=(0,l.useState)(0),[s,c]=(0,l.useState)(e),u=(0,l.useCallback)((()=>{o(!0)}),[]),d=(0,l.useCallback)((()=>{t(s),o(!1)}),[s,t]),p=(0,l.useCallback)((()=>{o(!1),i((e=>e+1)),c(e)}),[e]);return(0,E.tZ)(l.Fragment,null,(0,E.tZ)("div",{css:e=>E.iv`
          min-width: ${72*e.gridUnit}px;
          max-width: fit-content;
        `},(0,E.tZ)(Ba,{onChange:t,currentSelection:e}),e&&(0,E.tZ)(Ya,{vizType:e})),(0,E.tZ)("div",{css:e=>E.iv`
            display: flex;
            justify-content: flex-end;
            margin-top: ${3*e.gridUnit}px;
            color: ${e.colors.grayscale.base};
            text-decoration: underline;
          `},(0,E.tZ)("span",{role:"button",tabIndex:0,onClick:u},(0,f.t)("View all charts"))),(0,E.tZ)(Ka,{show:n,onHide:p,title:(0,f.t)("Select a visualization type"),primaryButtonName:(0,f.t)("Select"),disablePrimaryButton:!s,onHandledPrimaryAction:d,maxWidth:`${qa.UB}px`,responsive:!0},(0,E.tZ)(qa.ZP,{key:r,selectedViz:s,onChange:c,onDoubleClick:d,denyList:Ga})))};var Ja=a(361890),Xa=a(10916),en=a(616355),tn=a(599543),an=a(591877),nn=a(593185),on=a(677997);const rn={marginTop:"5px",minHeight:"30px"},ln={textAlign:"right"},sn={label:h().string.isRequired,tooltip:h().string,control:h().node.isRequired,isCheckbox:h().bool};function cn({label:e,tooltip:t,control:a,isCheckbox:n}){const o=(0,E.tZ)("span",null,e," ",t&&(0,E.tZ)(y.V,{placement:"top",label:e,tooltip:t}));return n?(0,E.tZ)(m.X2,{style:rn,gutter:16},(0,E.tZ)(m.JX,{xs:24,md:8,style:ln},a),(0,E.tZ)(m.JX,{xs:24,md:16},o)):(0,E.tZ)(m.X2,{style:rn,gutter:16},(0,E.tZ)(m.JX,{xs:24,md:8,style:ln},o),(0,E.tZ)(m.JX,{xs:24,md:16},a))}cn.propTypes=sn,cn.defaultProps={tooltip:null,isCheckbox:!1};var un=a(267051),dn=a(301510),pn=a(340892),hn=a(72182),mn=a(8868);const gn=new Set(["TINYINT","SMALLINT","INT","INTEGER","BIGINT","LONG"]),fn=new Set(["FLOAT","DOUBLE","REAL","NUMERIC","DECIMAL","MONEY"]),vn={datasource:h().object.isRequired,form_data:h().object,onChange:h().func,asc:h().bool,clearable:h().bool,multiple:h().bool,column:h().string,label:h().string,metric:h().string,searchAllOptions:h().bool,defaultValue:h().string,controlType:h().string,defaultDataMask:h().shape({extraFormData:h().object,filterState:h().object,ownState:h().object}),controlValues:h().shape({sortAscending:h().bool,defaultToFirstItem:h().bool,enableEmptyFilter:h().bool,inverseSelection:h().bool,multiSelect:h().bool,searchAllOptions:h().bool}),filterType:h().string,sortMetric:h().string,type:h().string},yn={onChange:()=>{},asc:!0,clearable:!0,multiple:!0,searchAllOptions:!1,controlType:hn.yP.Select,defaultDataMask:(0,mn.H)(),controlValues:{sortAscending:!1,defaultToFirstItem:!1,enableEmptyFilter:!1,inverseSelection:!1,multiSelect:!0,searchAllOptions:!1},filterType:"filter_select",sortMetric:"",type:Xa.BE.NATIVE_FILTER},bn={width:350};class _n extends l.Component{constructor(e){super(e);const{datasource:t,controls:a,parent:n,column:o,metric:r,asc:i,clearable:l,multiple:s,searchAllOptions:c,label:u,defaultValue:d,controlType:p,defaultDataMask:h,controlValues:m,filterType:g,sortMetric:f,type:v}=e;this.state={datasource:t,controls:a,parent:n,column:o,metric:r,label:u,asc:i,clearable:l,multiple:s,searchAllOptions:c,defaultValue:d,controlType:p,defaultDataMask:h,controlValues:m,filterType:g,sortMetric:f,type:v,formData:null,queriesData:[],isRefreshing:!1},this.onChange=this.onChange.bind(this),this.onControlChange=this.onControlChange.bind(this)}componentDidMount(){this.refreshHandler()}componentDidUpdate(e,t,a){const{column:n,parent:o,datasource:r,controls:i,adhoc_filters:l,time_range:s,granularity_sqla:c}=this.state;(null==t?void 0:t.column)===n&&(null==t?void 0:t.parent)===o&&(0,tn.JB)(null==t?void 0:t.datasource,r)&&(0,tn.E8)(null==t?void 0:t.controls,i)&&(0,tn.E8)(null==t?void 0:t.adhoc_filters,l)&&(null==t?void 0:t.time_range)===s&&(null==t?void 0:t.granularity_sqla)===c||this.refreshHandler(!0)}getPreFilter(){var e;const{datasource:t,adhoc_filters:a=[],time_range:n="",granularity_sqla:o=""}=this.state;return{adhoc_filters:a,...(null==(e=(0,pn.Ns)(t))||e)&&{time_range:n,...n&&"No filter"!==n&&{granularity_sqla:o}}}}refreshHandler(e=!1){const{column:t,parent:a,datasource:{id:n},controls:o,defaultDataMask:r,controlValues:i,filterType:l,sortMetric:s,type:c}=this.state;if(!n||!t)return;let u={};const d=(0,ut.Z)(a);d&&d.length>0&&o&&d.forEach((e=>{var t;const a=o.find((t=>t.key===e)),n=null==a||null==(t=a.defaultDataMask)?void 0:t.extraFormData;u=(0,dn.on)(u,n)}));const p=(0,dn.zi)({datasetId:n,groupby:t,dependencies:d,defaultDataMask:r,controlValues:i,filterType:l,sortMetric:s,type:c,...this.getPreFilter()});p.extra_form_data=u,this.setState({isRefreshing:!0}),(0,C.getChartDataRequest)({formData:p,force:e,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,an.cr)(nn.T.GLOBAL_ASYNC_QUERIES)){const a="result"in t?t.result[0]:t;if(200===e.status)this.setState({formData:p,queriesData:[a],isRefreshing:!1});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,on.YJ)(a).then((e=>{this.setState({formData:p,queriesData:e,isRefreshing:!1})})).catch((e=>{}))}}else this.setState({formData:p,queriesData:t.result,isRefreshing:!1})})).catch((e=>{e.json().then((e=>{this.setState({formData:null,queriesData:null,isRefreshing:!1})}))}))}onChange(){const{formData:e,queriesData:t,isRefreshing:a,datasource:n,controls:o,adhoc_filters:r=[],time_range:i="",granularity_sqla:l="",...s}=this.state,{metric:c,asc:u,multiple:d,searchAllOptions:p,controlValues:h,defaultDataMask:m}=s,g={...s,defaultDataMask:m,controlValues:{...h,sortAscending:u,multiSelect:d,searchAllOptions:p},sortMetric:c};this.props.onChange(g)}onControlChange(e,t){let a=t;const{column:n,multiple:o}=this.state;if(t&&!o&&e===St.ft.DEFAULT_VALUE){const{datasource:e}=this.props,o=e.columns.find((e=>e.column_name===n));if(o&&o.type){const e=o.type.toUpperCase();"BOOLEAN"===e?a="true"===t:gn.has(e)?a=Number.isNaN(Number(t))?null:parseInt(t,10):fn.has(e)&&(a=Number.isNaN(Number(t))?null:parseFloat(t))}}this.setState({[e]:a},this.onChange)}setType(){}textSummary(){return this.state.column||"N/A"}renderForm(){var e;return(0,E.tZ)("div",null,(0,E.tZ)(cn,{label:(0,f.t)("Column"),control:(0,E.tZ)(m.Ph,{ariaLabel:(0,f.t)("Column"),value:this.state.column,name:"column",options:this.props.datasource.columns.filter((e=>e.column_name!==this.state.column)).map((e=>({value:e.column_name,label:e.column_name}))).concat([{value:this.state.column,label:this.state.column}]),onChange:e=>{this.onControlChange("column",e),this.onControlChange("defaultDataMask",null)}})}),(0,E.tZ)(cn,{label:(0,f.t)("Label"),control:(0,E.tZ)(ct.Z,{value:this.state.label,name:"label",onChange:e=>this.onControlChange("label",e)})}),(0,E.tZ)(cn,{label:(0,f.t)("ControlType"),control:(0,E.tZ)(m.Ph,{ariaLabel:(0,f.t)("ControlType"),value:this.state.controlType,name:"controlType",options:[{value:hn.yP.Select,label:(0,f.t)(hn.yP.Select)},{value:hn.yP.Input,label:(0,f.t)(hn.yP.Input)},{value:hn.yP.Tab,label:(0,f.t)(hn.yP.Tab)}],onChange:e=>{this.onControlChange("controlType",e),this.onControlChange("defaultDataMask",null),this.onControlChange("filterType",e===hn.yP.Input?"filter_textinput":"filter_select")}})}),(0,E.tZ)(cn,{label:(0,f.t)("Default"),control:(0,E.tZ)(un.Z,{isRefreshing:this.state.isRefreshing,appSection:en.Tr.FILTER_CONFIG_MODAL,control:this.props,formData:this.state.formData,queriesData:this.props.datasource.id?this.state.queriesData:[{data:[{}]}],filterState:{...null==(e=this.props.defaultDataMask)?void 0:e.filterState},hooks:{setDataMask:e=>{this.onControlChange("defaultDataMask",e)}}})}),(0,E.tZ)(cn,{label:(0,f.t)("Sort metric"),tooltip:(0,f.t)("Metric to sort the results by"),control:(0,E.tZ)(m.Ph,{ariaLabel:(0,f.t)("Sort metric"),value:this.state.metric,name:"column",options:this.props.datasource.metrics.filter((e=>e.metric_name!==this.state.metric)).map((e=>({value:e.metric_name,label:e.metric_name}))).concat(this.state.metric?[{value:this.state.metric,label:this.state.metric}]:[]),onChange:e=>this.onControlChange("metric",e)})}),(0,E.tZ)(cn,{label:(0,f.t)("Sort ascending"),tooltip:(0,f.t)("Check for sorting ascending"),isCheckbox:!0,control:(0,E.tZ)($.Z,{value:this.state.asc,onChange:e=>this.onControlChange("asc",e)})}),(0,E.tZ)(cn,{label:(0,f.t)("Allow multiple selections"),isCheckbox:!0,tooltip:(0,f.t)("Multiple selections allowed, otherwise filter is limited to a single value"),control:(0,E.tZ)($.Z,{value:this.state.multiple,onChange:e=>this.onControlChange(St.ft.MULTIPLE,e)})}),(0,E.tZ)(cn,{label:(0,f.t)("Search all filter options"),tooltip:(0,f.t)("By default, each filter loads at most 1000 choices at the initial page load. Check this box if you have more than 1000 filter values and want to enable dynamically searching that loads filter values as users type (may add stress to your database)."),isCheckbox:!0,control:(0,E.tZ)($.Z,{value:this.state.searchAllOptions,onChange:e=>this.onControlChange(St.ft.SEARCH_ALL_OPTIONS,e)})}))}renderPopover(){return(0,E.tZ)("div",{id:"ts-col-popo",style:bn},this.renderForm())}render(){return(0,E.tZ)("span",{"data-test":"FilterBoxItemControl"},this.textSummary()," ",(0,E.tZ)(Z.Z,{trigger:"click",content:this.renderPopover(),title:(0,f.t)("Filter configuration")},(0,E.tZ)(z.Z.Edit,{iconSize:"l"})))}}_n.getDerivedStateFromProps=(e,t)=>{const{adhoc_filters:a=[],time_range:n="",granularity_sqla:o=""}=null==e?void 0:e.form_data;return(0,tn.E8)(null==t?void 0:t.adhoc_filters,a)&&(null==t?void 0:t.time_range)===n&&(null==t?void 0:t.granularity_sqla)===o?null:{adhoc_filters:a,time_range:n,granularity_sqla:o}},_n.propTypes=vn,_n.defaultProps=yn;var Cn=a(281315),En=a(294184),Tn=a.n(En),Zn=a(717621),Sn=a.n(Zn),xn=a(855241);const wn="fub18o7AG7UapFOWKjRA",An="OCKMjXVzyFB6g1vJctlE",Rn="WIgA7O7WfNEgv5Vf2wEA",Dn="iM7K8VhIUIxH4oUkQvoo",On=s.iK.div`
  margin: -12px -16px;

  .sketch-picker {
    box-shadow: none !important;
  }
`,Nn=s.iK.div`
  margin: 10px;
  text-align: right;

  > button:first-child {
    margin-right: 10px;
  }
`,Mn=["#509af2","#3acf7a","#ffa223","#d465fb","#38caf7","#b3dd07","#ffd835","#e5b4fa"],In=(e,t)=>{const{value:a,format:n,size:o,preset:r,disableAlpha:i,instantly:s,className:c,onChange:u}=e,d=Tn()({[wn]:!0,[c]:!!c,[`${wn}-sm`]:o&&"small"===o,[`${wn}-lg`]:o&&"large"===o}),p=(0,l.useMemo)((()=>Sn()(a).toHexString()),[a]),[h,m]=(0,l.useState)(!1),[g,v]=(0,l.useState)(p),y=(0,l.useCallback)((e=>{null==v||v(n?null==e?void 0:e[n]:`rgba(${e.rgb.r}, ${e.rgb.g}, ${e.rgb.b}, ${e.rgb.a})`)}),[v,n]),b=(0,l.useCallback)((e=>{(null!=e?e:s)&&(null==u||u(g))}),[g,s,u]),_=(0,l.useRef)(!1);return(0,l.useEffect)((()=>{_.current?b():_.current=!0}),[b]),(0,E.tZ)(xn.Z,{ref:t,visible:h,onVisibleChange:m,content:(0,E.tZ)(On,null,(0,E.tZ)(te.xS,{color:g,presetColors:r?Mn:[],onChangeComplete:y,disableAlpha:i}),!s&&(0,E.tZ)(Nn,null,(0,E.tZ)(me.Z,{size:"small",onClick:()=>{m(!1)}},(0,f.t)("CANCEL")),(0,E.tZ)(me.Z,{type:"primary",size:"small",onClick:()=>{m(!1),b(!0)}},(0,f.t)("OK")))),trigger:"click",placement:"right"},e.children||(0,E.tZ)("div",{className:d},(0,E.tZ)("span",{className:An},(0,E.tZ)("span",{className:Rn,style:{background:p}}),(0,E.tZ)("span",{className:Dn}))))},Ln=l.forwardRef(In);Ln.defaultProps={preset:!0,instantly:!0,disableAlpha:!1,size:"default",className:"color-picker-pro"};const kn=Ln;var Fn;!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="\u2265",e.LESS_OR_EQUAL="\u2264",e.EQUAL="=",e.NOT_EQUAL="\u2260",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL="\u2264 x \u2264",e.BETWEEN_OR_LEFT_EQUAL="\u2264 x <",e.BETWEEN_OR_RIGHT_EQUAL="< x \u2264"}(Fn||(Fn={}));const Pn=[Fn.BETWEEN,Fn.BETWEEN_OR_EQUAL,Fn.BETWEEN_OR_LEFT_EQUAL,Fn.BETWEEN_OR_RIGHT_EQUAL],$n=(0,s.iK)(N.Rn)`
  width: 100%;
`,Un=s.iK.div`
  display: flex;
  justify-content: flex-end;
`,Vn=[{value:Fn.NONE,label:(0,f.t)("None")},{value:Fn.GREATER_THAN,label:">"},{value:Fn.LESS_THAN,label:"<"},{value:Fn.GREATER_OR_EQUAL,label:"\u2265"},{value:Fn.LESS_OR_EQUAL,label:"\u2264"},{value:Fn.EQUAL,label:"="},{value:Fn.NOT_EQUAL,label:"\u2260"},{value:Fn.BETWEEN,label:"< x <"},{value:Fn.BETWEEN_OR_EQUAL,label:"\u2264 x \u2264"},{value:Fn.BETWEEN_OR_LEFT_EQUAL,label:"\u2264 x <"},{value:Fn.BETWEEN_OR_RIGHT_EQUAL,label:"< x \u2264"}],qn=(e,t)=>a=>(n,o)=>a&&o&&!e(Number(a),Number(o))?Promise.reject(new Error(t)):Promise.resolve(),Hn=qn(((e,t)=>e>t),(0,f.t)("This value should be smaller than the right target value")),zn=qn(((e,t)=>e<t),(0,f.t)("This value should be greater than the left target value")),jn=e=>e&&Pn.includes(e),Bn=e=>!e||e===Fn.NONE,Gn=[{required:!0,message:(0,f.t)("Required")}],Wn=[{required:!0,message:(0,f.t)("Required")},({getFieldValue:e})=>({validator:Hn(e("targetValueRight"))})],Yn=[{required:!0,message:(0,f.t)("Required")},({getFieldValue:e})=>({validator:zn(e("targetValueLeft"))})],Kn=["targetValueRight"],Qn=["targetValueLeft"],Jn=(e,t)=>Bn(e.operator)!==Bn(t.operator)||jn(e.operator)!==jn(t.operator),Xn=(0,E.tZ)(Et.xJ,{name:"operator",label:(0,f.t)("Operator"),rules:Gn,initialValue:Vn[0].value},(0,E.tZ)(Cn.Z,{ariaLabel:(0,f.t)("Operator"),options:Vn})),eo=({getFieldValue:e})=>Bn(e("operator"))?(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:6},Xn)):jn(e("operator"))?(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:9},(0,E.tZ)(Et.xJ,{name:"targetValueLeft",label:(0,f.t)("Left value"),rules:Wn,dependencies:Kn,validateTrigger:"onBlur",trigger:"onBlur"},(0,E.tZ)($n,null))),(0,E.tZ)(m.JX,{span:6},Xn),(0,E.tZ)(m.JX,{span:9},(0,E.tZ)(Et.xJ,{name:"targetValueRight",label:(0,f.t)("Right value"),rules:Yn,dependencies:Qn,validateTrigger:"onBlur",trigger:"onBlur"},(0,E.tZ)($n,null)))):(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:6},Xn),(0,E.tZ)(m.JX,{span:18},(0,E.tZ)(Et.xJ,{name:"targetValue",label:(0,f.t)("Target value"),rules:Gn},(0,E.tZ)($n,null)))),to=({config:e,onChange:t,columns:a=[]})=>{var n;const o=(0,s.Fg)();return(0,E.tZ)(Et.l0,{onFinish:t,initialValues:e,requiredMark:"optional",layout:"vertical"},(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"column",label:(0,f.t)("Column"),rules:Gn,initialValue:null==(n=a[0])?void 0:n.value},(0,E.tZ)(Cn.Z,{ariaLabel:(0,f.t)("Select column"),options:a}))),(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"colorScheme",label:(0,f.t)("Color scheme"),rules:Gn,initialValue:o.colors.success.light1},(0,E.tZ)(kn,{format:"hex"})))),(0,E.tZ)(Et.xJ,{noStyle:!0,shouldUpdate:Jn},eo),(0,E.tZ)(Et.xJ,null,(0,E.tZ)(Un,null,(0,E.tZ)(De.Z,{htmlType:"submit",buttonStyle:"primary"},(0,f.t)("Apply")))))},ao=({title:e,columns:t,onChange:a,config:n,children:r,...i})=>{const[s,c]=(0,l.useState)(!1),u=(0,l.useCallback)((e=>{c(!1),a(e)}),[a]);return(0,E.tZ)(ne.ZP,o()({title:e,content:(0,E.tZ)(to,{onChange:u,config:n,columns:t}),visible:s,onVisibleChange:c,trigger:["click"],overlayStyle:{width:"450px"}},i),r)},no=s.iK.div`
  ${({theme:e})=>E.iv`
    padding: ${e.gridUnit}px;
    border: solid 1px ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
  `}
`,oo=(0,s.iK)(j.EQ)`
  &,
  & > div {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
    :last-child {
      margin-bottom: 0;
    }
  }
`,ro=s.iK.button`
  ${({theme:e})=>E.iv`
    color: ${e.colors.grayscale.light1};
    height: 100%;
    width: ${6*e.gridUnit}px;
    border: none;
    border-right: solid 1px ${e.colors.grayscale.dark2}0C;
    padding: 0;
    outline: none;
    border-bottom-left-radius: 3px;
    border-top-left-radius: 3px;
  `}
`,io=({value:e,onChange:t,columnOptions:a,verboseMap:n,removeIrrelevantConditions:o,...r})=>{const i=(0,s.Fg)(),[c,u]=(0,l.useState)(null!=e?e:[]);(0,l.useEffect)((()=>{t&&t(c)}),[c,t]),(0,l.useEffect)((()=>{if(o){const e=c.filter((e=>a.some((t=>(null==t?void 0:t.value)===(null==e?void 0:e.column)))));e.length!==c.length&&o&&u(e)}}),[c,a,o]);return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,r),(0,E.tZ)(no,null,c.map(((e,t)=>(0,E.tZ)(oo,{key:t},(0,E.tZ)(ro,{onClick:()=>(e=>{u((t=>t.filter(((t,a)=>a!==e))))})(t)},(0,E.tZ)(z.Z.XSmall,{iconColor:i.colors.grayscale.light1})),(0,E.tZ)(ao,{title:(0,f.t)("Edit formatter"),config:e,columns:a,onChange:e=>((e,t)=>{const a=[...c];a.splice(t,1,e),u(a)})(e,t),destroyTooltipOnHide:!0},(0,E.tZ)(j.EQ,{withCaret:!0},(0,E.tZ)(j.__,null,(({column:e,operator:t,targetValue:a,targetValueLeft:o,targetValueRight:r})=>{var i;const l=null!=(i=e&&(null==n?void 0:n[e]))?i:e;switch(t){case Fn.NONE:return`${l}`;case Fn.BETWEEN:return`${o} ${Fn.LESS_THAN} ${l} ${Fn.LESS_THAN} ${r}`;case Fn.BETWEEN_OR_EQUAL:return`${o} ${Fn.LESS_OR_EQUAL} ${l} ${Fn.LESS_OR_EQUAL} ${r}`;case Fn.BETWEEN_OR_LEFT_EQUAL:return`${o} ${Fn.LESS_OR_EQUAL} ${l} ${Fn.LESS_THAN} ${r}`;case Fn.BETWEEN_OR_RIGHT_EQUAL:return`${o} ${Fn.LESS_THAN} ${l} ${Fn.LESS_OR_EQUAL} ${r}`;default:return`${l} ${t} ${a}`}})(e)),(0,E.tZ)(j.Ne,null,(0,E.tZ)(z.Z.CaretRight,{iconColor:i.colors.grayscale.light1}))))))),(0,E.tZ)(ao,{title:(0,f.t)("Add new formatter"),columns:a,onChange:e=>{u((t=>[...t,e]))},destroyTooltipOnHide:!0},(0,E.tZ)(j.SW,null,(0,E.tZ)(z.Z.PlusSmall,{iconColor:i.colors.grayscale.light1}),(0,f.t)("Add new color formatter")))))},lo=io;var so=a(338575),co=a(609332),uo=a(88889),po=a(25130),ho=a(644582);const mo="#FF0000",go=[{value:so.O9.NONE,label:(0,f.t)("None")},{value:so.O9.EQUAL,label:"="},{value:so.O9.NOT_EQUAL,label:"\u2260"}],fo=[...go,{value:so.O9.LESS_THAN,label:"<"},{value:so.O9.LESS_OR_EQUAL,label:"\u2264"},{value:so.O9.GREATER_THAN,label:">"},{value:so.O9.GREATER_OR_EQUAL,label:"\u2265"},{value:so.O9.BETWEEN,label:"< x <"},{value:so.O9.BETWEEN_OR_EQUAL,label:"\u2264 x \u2264"},{value:so.O9.BETWEEN_OR_LEFT_EQUAL,label:"\u2264 x <"},{value:so.O9.BETWEEN_OR_RIGHT_EQUAL,label:"< x \u2264"}],vo=[...go,{value:so.O9.LIKE,label:(0,f.t)("LIKE")},{value:so.O9.NOT_LIKE,label:(0,f.t)("NOT_LIKE")}],yo=[...go,{value:so.O9.LESS_THAN,label:"<"},{value:so.O9.LESS_OR_EQUAL,label:"\u2264"},{value:so.O9.GREATER_THAN,label:">"},{value:so.O9.GREATER_OR_EQUAL,label:"\u2265"}],bo=(0,s.iK)(N.Rn)`
  width: 100%;
`,_o=(0,s.iK)(N.II)`
  width: 100%;
`,Co=s.iK.div`
  display: flex;
  justify-content: flex-end;
`,Eo=s.iK.div`
  width: 100%;
  display: flex;
  align-items: center;

  svg {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  > span {
    display: flex;
    align-items: center;
  }

  .option-label {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    & ~ i {
      margin-left: ${({theme:e})=>e.gridUnit}px;
    }
  }

  .type-label {
    margin-right: ${({theme:e})=>3*e.gridUnit}px;
    width: ${({theme:e})=>7*e.gridUnit}px;
    display: inline-block;
    text-align: center;
    font-weight: ${({theme:e})=>e.typography.weights.bold};
  }
`,To=[{value:so.FC.NONE,label:(0,f.t)("None")},{value:so.FC.UP,label:(0,f.t)("Up")},{value:so.FC.DOWN,label:(0,f.t)("Down")}],Zo=(e,t)=>a=>(n,o)=>a&&o&&!e(Number(a),Number(o))?Promise.reject(new Error(t)):Promise.resolve(),So=Zo(((e,t)=>e>t),(0,f.t)("This value should be smaller than the right target value")),xo=Zo(((e,t)=>e<t),(0,f.t)("This value should be greater than the left target value")),wo=e=>e&&so.vD.includes(e),Ao=e=>!e||e===so.O9.NONE,Ro=e=>e&&so.f.includes(e),Do=e=>!e||e===so.FC.NONE,Oo=[{required:!0,message:(0,f.t)("Required")}],No=[{required:!0,message:(0,f.t)("Required")},({getFieldValue:e})=>({validator:So(e("targetValueRight"))})],Mo=[{required:!0,message:(0,f.t)("Required")},({getFieldValue:e})=>({validator:xo(e("targetValueLeft"))})],Io=["targetValueRight"],Lo=["targetValueLeft"],ko=(e,t)=>e.column!==t.column||Ao(e.operator)!==Ao(t.operator)||wo(e.operator)!==wo(t.operator)||Ro(e.operator)!==Ro(t.operator)||Do(e.icon)!==Do(t.icon),Fo=({name:e,label:t,rawValue:a,allowAlpha:n})=>(0,E.tZ)(Et.xJ,{name:e,label:t,rules:Oo},a?(0,E.tZ)(ce,null):(0,E.tZ)(kn,{disableAlpha:!n})),Po=e=>(0,E.tZ)(Et.xJ,{name:"operator",label:(0,f.t)("Operator"),rules:Oo},(0,E.tZ)(Cn.Z,{ariaLabel:(0,f.t)("Operator"),options:e})),$o=(e,t)=>{var a;const[n]=t.filter((t=>t.value===e)),o={[uo.Z.NUMERIC]:fo,[uo.Z.STRING]:vo,[uo.Z.TEMPORAL]:yo};return{columnOption:n,operatorOptions:null==o?void 0:o[null!=(a=null==n?void 0:n.type)?a:uo.Z.NUMERIC]}},Uo=({config:e,onChange:t,columns:a=[]})=>{const[n]=m.qz.useForm(),[o]=(0,l.useState)(!1),[r]=(0,l.useState)(!0),i=(0,l.useCallback)(((e,t)=>r&&!(0,po.xG)(e)?(0,po.Zf)(e,null!=t?t:1):e),[r]),s=(0,l.useCallback)((e=>o?Sn()(e).toRgb():e),[o]),c=(0,l.useCallback)((e=>r?Sn()(e).toHex8String():Sn()(e).toHexString()),[r]),u=(0,l.useCallback)(((e,t,a)=>t.reduce(((e,t)=>{const n=null==e?void 0:e[t];return n?{...e,[t]:a(n)}:e}),e)),[]),d=(0,l.useMemo)((()=>{var t,n;return null!=(t=null==e?void 0:e.column)?t:null==(n=a[0])?void 0:n.value}),[e,a]),p=(0,l.useMemo)((()=>{var t,n;const{operatorOptions:o}=$o(d,a);return{column:d,colorScheme:s(null!=e&&e.colorScheme?i(null==e?void 0:e.colorScheme):i("#FFFFFF",0)),textColorSchema:s(null!=e&&e.textColorSchema?i(null==e?void 0:e.textColorSchema):i(mo)),operator:null!=(t=null==e?void 0:e.operator)?t:o[0].value,targetValue:null==e?void 0:e.targetValue,targetValueLeft:null==e?void 0:e.targetValueLeft,targetValueRight:null==e?void 0:e.targetValueRight,icon:null!=(n=null==e?void 0:e.icon)?n:To[0].value,iconColorSchema:s(null!=e&&e.iconColorSchema?i(null==e?void 0:e.iconColorSchema):i(mo))}}),[e,a,d,s]),h=(0,l.useCallback)((e=>{const{operatorOptions:t}=$o(e,a);n.setFieldsValue({operator:t[0].value,targetValue:void 0})}),[n,a]),g=(0,l.useCallback)((e=>{const a=u(e,["colorScheme","textColorSchema","iconColorSchema"],c);t(a)}),[t,u]);return(0,E.tZ)(Et.l0,{form:n,onFinish:g,initialValues:p,requiredMark:"optional",layout:"vertical"},(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"column",label:(0,f.t)("Column"),rules:Oo},(0,E.tZ)(Cn.Z,{ariaLabel:(0,f.t)("Select column"),options:a.map((e=>({...e,customLabel:(0,E.tZ)(Eo,null,(0,E.tZ)(ho.j,{type:e.type}),(0,E.tZ)(Ae.u,{title:e.label},(0,E.tZ)("span",{className:"option-label column-option-label",css:e=>E.iv`
                            margin-right: ${e.gridUnit}px;
                          `},e.label)))}))),onChange:h}))),(0,E.tZ)(m.JX,{span:6},Fo({name:"colorScheme",label:(0,f.t)("Background color scheme"),rawValue:o,allowAlpha:r})),(0,E.tZ)(m.JX,{span:6},Fo({name:"textColorSchema",label:(0,f.t)("Text color scheme"),rawValue:o,allowAlpha:r}))),(0,E.tZ)(Et.xJ,{noStyle:!0,shouldUpdate:ko},(e=>(({getFieldValue:e},{columns:t,rawValue:a,allowAlpha:n})=>{const{columnOption:o,operatorOptions:r}=$o(e("column"),t);return Ao(e("operator"))?(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},Po(r))):(null==o?void 0:o.type)===uo.Z.NUMERIC?(0,E.tZ)(l.Fragment,null,wo(e("operator"))?(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:9},(0,E.tZ)(Et.xJ,{name:"targetValueLeft",label:(0,f.t)("Left value"),rules:No,dependencies:Io,validateTrigger:"onBlur",trigger:"onBlur"},(0,E.tZ)(bo,null))),(0,E.tZ)(m.JX,{span:6},Po(r)),(0,E.tZ)(m.JX,{span:9},(0,E.tZ)(Et.xJ,{name:"targetValueRight",label:(0,f.t)("Right value"),rules:Mo,dependencies:Lo,validateTrigger:"onBlur",trigger:"onBlur"},(0,E.tZ)(bo,null)))):(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},Po(r)),(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"targetValue",label:(0,f.t)("Target value"),rules:Oo},(0,E.tZ)(bo,null)))),Ro(e("operator"))&&(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"icon",label:(0,f.t)("Icon"),rules:Oo},(0,E.tZ)(Cn.Z,{ariaLabel:(0,f.t)("Icon"),options:To}))),!Do(e("icon"))&&(0,E.tZ)(m.JX,{span:6},Fo({name:"iconColorSchema",label:(0,f.t)("Icon color scheme"),rawValue:a,allowAlpha:n})))):(0,E.tZ)(m.X2,{gutter:12},(0,E.tZ)(m.JX,{span:12},Po(r)),(0,E.tZ)(m.JX,{span:12},(0,E.tZ)(Et.xJ,{name:"targetValue",label:(0,f.t)("Target value"),rules:Oo},(0,E.tZ)(_o,{allowClear:!0}))))})(e,{columns:a,rawValue:o,allowAlpha:r}))),(0,E.tZ)(Et.xJ,null,(0,E.tZ)(Co,null,(0,E.tZ)(De.Z,{htmlType:"submit",buttonStyle:"primary"},(0,f.t)("Apply")))))},Vo=({title:e,columns:t,onChange:a,config:n,children:r,...i})=>{const[s,c]=(0,l.useState)(!1),u=(0,l.useCallback)((e=>{c(!1),a(e)}),[a]);return(0,E.tZ)(ne.ZP,o()({title:e,content:(0,E.tZ)(Uo,{onChange:u,config:n,columns:t}),visible:s,onVisibleChange:c,trigger:["click"],overlayStyle:{width:"450px"}},i),r)},qo=s.iK.div`
  ${({theme:e})=>E.iv`
    padding: ${e.gridUnit}px;
    border: solid 1px ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
  `}
`,Ho=(0,s.iK)(j.EQ)`
  &,
  & > div {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
    :last-child {
      margin-bottom: 0;
    }
  }
`,zo=s.iK.button`
  ${({theme:e})=>E.iv`
    color: ${e.colors.grayscale.light1};
    height: 100%;
    width: ${6*e.gridUnit}px;
    border: none;
    border-right: solid 1px ${e.colors.grayscale.dark2}0C;
    padding: 0;
    outline: none;
    border-bottom-left-radius: 3px;
    border-top-left-radius: 3px;
  `}
`,jo=({value:e,onChange:t,columnOptions:a,verboseMap:n,...o})=>{const r=(0,s.Fg)(),[i,c]=(0,l.useState)(null!=e?e:[]);(0,l.useEffect)((()=>{t&&t(i)}),[i,t]);const u=(0,l.useCallback)((()=>{const e=i.filter((e=>a.some((t=>(null==t?void 0:t.value)===(null==e?void 0:e.column)))));e.length!==i.length&&t&&(c(e),t(e))}),[JSON.stringify(a)]);(0,co.d)(u);return(0,E.tZ)("div",null,(0,E.tZ)(M.Z,o),(0,E.tZ)(qo,null,i.map(((e,t)=>(0,E.tZ)(Ho,{key:t},(0,E.tZ)(zo,{onClick:()=>(e=>{c((t=>t.filter(((t,a)=>a!==e))))})(t)},(0,E.tZ)(z.Z.XSmall,{iconColor:r.colors.grayscale.light1})),(0,E.tZ)(Vo,{title:(0,f.t)("Edit formatter"),config:e,columns:a,onChange:e=>((e,t)=>{const a=[...i];a.splice(t,1,e),c(a)})(e,t),destroyTooltipOnHide:!0},(0,E.tZ)(j.EQ,{withCaret:!0},(0,E.tZ)(j.__,null,(({column:e,operator:t,targetValue:a,targetValueLeft:o,targetValueRight:r})=>{var i,l,s;const c=null!=(i=e&&(null==n?void 0:n[e]))?i:e,u=null!=(l=null==(s=[...new Set([...fo,...vo,...yo])].find((e=>e.value===t)))?void 0:s.label)?l:t;switch(t){case so.O9.NONE:return`${c}`;case so.O9.BETWEEN:return`${o} ${so.O9.LESS_THAN} ${c} ${so.O9.LESS_THAN} ${r}`;case so.O9.BETWEEN_OR_EQUAL:return`${o} ${so.O9.LESS_OR_EQUAL} ${c} ${so.O9.LESS_OR_EQUAL} ${r}`;case so.O9.BETWEEN_OR_LEFT_EQUAL:return`${o} ${so.O9.LESS_OR_EQUAL} ${c} ${so.O9.LESS_THAN} ${r}`;case so.O9.BETWEEN_OR_RIGHT_EQUAL:return`${o} ${so.O9.LESS_THAN} ${c} ${so.O9.LESS_OR_EQUAL} ${r}`;default:return`${c} ${u} ${a}`}})(e)),(0,E.tZ)(j.Ne,null,(0,E.tZ)(z.Z.CaretRight,{iconColor:r.colors.grayscale.light1}))))))),(0,E.tZ)(Vo,{title:(0,f.t)("Add new formatter"),columns:a,onChange:e=>{c((t=>[...t,e]))},destroyTooltipOnHide:!0},(0,E.tZ)(j.SW,null,(0,E.tZ)(z.Z.PlusSmall,{iconColor:r.colors.grayscale.light1}),(0,f.t)("Add new color formatter")))))},Bo=jo;var Go=a(441609),Wo=a.n(Go),Yo=a(353769);const Ko=e=>(0,so.xN)(e)?e.column_name:e;class Qo{constructor(e,t,a){this.values=void 0,this.options=void 0,this.multi=void 0,this.options=e,this.multi=t,this.values=(0,ut.Z)(a).map((t=>t&&(0,Mt.s9)(t)&&t in e?e[t]:(0,Mt.s9)(t)?null:t)).filter(Boolean)}add(e){(0,Mt.s9)(e)&&e in this.options?this.values.push(this.options[e]):(0,Mt.s9)(e)||this.values.push(e)}del(e){this.values.splice(e,1)}replace(e,t){this.values[e]&&(this.values[e]=(0,Mt.s9)(t)?this.options[t]:t)}swap(e,t){[this.values[e],this.values[t]]=[this.values[t],this.values[e]]}has(e){return this.values.some((t=>(0,Mt.s9)(e)?t.column_name===e||t.label===e:t.column_name===e.label||t.label===e.label))}getValues(){return this.multi?this.values.map(Ko):this.values.length>0?Ko(this.values[0]):void 0}}const Jo=(0,s.iK)(m.Ph)`
  .metric-option {
    & > svg {
      min-width: ${({theme:e})=>4*e.gridUnit+"px"};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,Xo=e=>{const{columns:t,editedColumn:a,onChange:n,onClose:o,setDatasetModal:r,setLabel:i,getCurrentTab:s,label:c,isTemporal:u,typeData:d}=e,p=(0,g.v9)((e=>e.explore.datasource.type)),h=(0,g.v9)((e=>e.explore.form_data)),v=(0,g.v9)((e=>e.explore.datasource.id)),[y,b]=(0,l.useState)([]),[_,C]=(0,l.useState)(h.adhoc_Sort||[]);(0,l.useEffect)((()=>{var e;h.adhoc_Sort&&(C(h.adhoc_Sort),null==d||null==(e=d.actions)||null==e.setControlValue||e.setControlValue("adhoc_Sort",h.adhoc_Sort))}),[h.adhoc_Sort]);const[T]=(0,l.useState)(c),[Z,S,x]=(e=>e?(0,Mt.GA)(e)?[e,void 0,void 0]:(0,so.zy)(e)?[void 0,e,void 0]:[void 0,void 0,e]:[void 0,void 0,void 0])(a),[w,A]=(0,l.useState)(Z),[R,D]=(0,l.useState)(S),[O,N]=(0,l.useState)(x),M=(0,l.useRef)(null),[I,L]=(0,l.useMemo)((()=>null==t?void 0:t.reduce(((e,t)=>(t.expression?e[0].push(t):e[1].push(t),e)),[[],[]])),[t]),k=(0,l.useCallback)((e=>{A({label:c,sqlExpression:e,expressionType:"SQL"}),N(void 0),D(void 0)}),[c]),F=(0,l.useCallback)((e=>{const t=I.find((t=>t.column_name===e));D(t),N(void 0),A(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[I,i]),P=(0,l.useCallback)((e=>{const t=L.find((t=>t.column_name===e));D(void 0),N(t),A(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||""),h.adhoc_Sort=[],C([]);const a={datasource:{id:v,type:p},queries:[{extras:{having:"",where:""},metrics:[],columns:[e],orderby:[[e,!0]],order_desc:!0}],force:!1,result_format:"json",result_type:"full"};Ze.Z.post({endpoint:"api/v1/chart/data",jsonPayload:a}).then((e=>{var t,a,n;const o=null!=(t=e.json.result)&&t.length&&null!=(a=null==(n=e.json.result[0])?void 0:n.data)?a:[],r=(o.length?Array.from(o,(e=>Object.values(e)[0])):[]).map((e=>({value:e,label:(0,We.lo)(e)})));b(r)})).catch((()=>{b([])}))}),[i,L]),$=Z?"sqlExpression":x||0===I.length?"simple":"saved";(0,l.useEffect)((()=>{s($)}),[$,s]);const U=(0,l.useCallback)((()=>{w&&w.label!==c&&(w.label=c);const e=w||R||O;e&&(n(e),o())}),[w,c,n,o,R,O]),V=(0,l.useCallback)((()=>{D(S),N(x),A(Z),o()}),[Z,S,x,o]),q=(0,l.useCallback)((e=>{var t;s(e),null==(t=M.current)||t.editor.focus()}),[s]),H=(0,l.useCallback)((()=>{var e;null==(e=M.current)||e.editor.resize()}),[]),z=()=>{r&&r(!0),o()},j=w||R||O,B=T!==c||(null==R?void 0:R.column_name)!==(null==S?void 0:S.column_name)||(null==O?void 0:O.column_name)!==(null==x?void 0:x.column_name)||(null==w?void 0:w.sqlExpression)!==(null==Z?void 0:Z.sqlExpression),G=(0,f.t)("Saved expressions"),W=(0,f.t)("Column");return(0,E.tZ)(Et.l0,{layout:"vertical",id:"metrics-edit-popover"},(0,E.tZ)(_t.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:$,onChange:q,className:"adhoc-metric-edit-tabs",allowOverflow:!0,css:E.iv`
          height: ${St.H7}px;
          width: ${St.vK}px;
        `},(0,E.tZ)(_t.ZP.TabPane,{key:"saved",tab:(0,f.t)("Saved")},I.length>0?(0,E.tZ)(Et.xJ,{label:G},(0,E.tZ)(Jo,{ariaLabel:G,value:null==R?void 0:R.column_name,onChange:F,allowClear:!0,autoFocus:!R,placeholder:(0,f.t)("%s column(s)",I.length),options:I.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,E.tZ)(xt.l,{column:e,showType:!0}),key:e.column_name})))})):p===Te.i9.Table?(0,E.tZ)(Ct.Tc,{image:"empty.svg",title:u?(0,f.t)("No temporal columns found"):(0,f.t)("No saved expressions found"),description:u?(0,f.t)('Add calculated temporal columns to dataset in "Edit datasource" modal'):(0,f.t)('Add calculated columns to dataset in "Edit datasource" modal')}):(0,E.tZ)(Ct.Tc,{image:"empty.svg",title:u?(0,f.t)("No temporal columns found"):(0,f.t)("No saved expressions found"),description:u?(0,E.tZ)(l.Fragment,null,(0,E.tZ)("span",{role:"button",tabIndex:0,onClick:z},(0,f.t)("Create a dataset"))," ",(0,f.t)(" to mark a column as a time column")):(0,E.tZ)(l.Fragment,null,(0,E.tZ)("span",{role:"button",tabIndex:0,onClick:z},(0,f.t)("Create a dataset"))," ",(0,f.t)(" to add calculated columns"))})),(0,E.tZ)(_t.ZP.TabPane,{key:"simple",tab:(0,f.t)("Simple")},u&&0===L.length?(0,E.tZ)(Ct.Tc,{image:"empty.svg",title:(0,f.t)("No temporal columns found"),description:p===Te.i9.Table?(0,f.t)('Mark a column as temporal in "Edit datasource" modal'):(0,E.tZ)(l.Fragment,null,(0,E.tZ)("span",{role:"button",tabIndex:0,onClick:z},(0,f.t)("Create a dataset"))," ",(0,f.t)(" to mark a column as a time column"))}):(0,E.tZ)(l.Fragment,null,(0,E.tZ)(Et.xJ,{label:W},(0,E.tZ)(m.Ph,{ariaLabel:W,value:null==O?void 0:O.column_name,onChange:P,allowClear:!0,autoFocus:!O,placeholder:(0,f.t)("%s column(s)",L.length),options:L.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,E.tZ)(xt.l,{column:e,showType:!0}),key:e.column_name})))})),"x_axis"===e.typeData.name&&("echarts_timeseries_bar"===h.viz_type||"echarts_timeseries_line"===h.viz_type)&&(0,E.tZ)(Et.xJ,{label:"\u6392\u5e8f"},(0,E.tZ)(m.Ph,{ariaLabel:W,value:_,onChange:e=>{C(e),null==d||d.actions.setControlValue("adhoc_Sort",e)},mode:"multiple",allowClear:!0,placeholder:(0,f.t)("%s column(s)",y.length),options:y})))),(0,E.tZ)(_t.ZP.TabPane,{key:"sqlExpression",tab:(0,f.t)("Custom SQL")},(0,E.tZ)(Tt.iO,{value:(null==w?void 0:w.sqlExpression)||(null==O?void 0:O.column_name)||(null==R?void 0:R.expression),onFocus:H,showLoadingForImport:!0,onChange:k,width:"100%",height:St.H7-80+"px",showGutter:!1,editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0,ref:M}))),(0,E.tZ)("div",null,(0,E.tZ)(De.Z,{buttonSize:"small",onClick:V,cta:!0},(0,f.t)("Close")),(0,E.tZ)(De.Z,{disabled:!j||!B,buttonStyle:"primary",buttonSize:"small",onClick:U,"data-test":"ColumnEdit#save",cta:!0},(0,f.t)("Save"))))},er=(0,s.iK)(N.II)`
  border-radius: ${({theme:e})=>e.borderRadius};
  height: 26px;
  padding-left: ${({theme:e})=>2.5*e.gridUnit}px;
`,tr=({title:e,onChange:t,isEditDisabled:a,hasCustomLabel:n})=>{const[o,r]=(0,l.useState)(!1),[i,s]=(0,l.useState)(!1),c=(0,l.useCallback)((()=>{r(!0)}),[]),u=(0,l.useCallback)((()=>{r(!1)}),[]),d=(0,l.useCallback)((()=>{s(!0)}),[]),p=(0,l.useCallback)((()=>{s(!1)}),[]),h=(0,l.useCallback)((e=>{""===e.target.value&&t(e),p()}),[p,t]),m=(0,f.t)("My column");return a?(0,E.tZ)("span",null,e||m):i?(0,E.tZ)(er,{type:"text",placeholder:e,value:n?e:"",autoFocus:!0,onChange:t,onBlur:h}):(0,E.tZ)(Ae.u,{placement:"top",title:(0,f.t)("Click to edit label")},(0,E.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable","data-test":"AdhocMetricEditTitle#trigger",onMouseOver:c,onMouseOut:u,onClick:d,onBlur:p,role:"button",tabIndex:0},e||m,"\xa0",(0,E.tZ)("i",{className:"fa fa-pencil",style:{color:o?"black":"grey"}})))},ar=(0,f.t)("My column"),nr=({columns:e,editedColumn:t,onColumnEdit:a,isControlledComponent:n,children:o,isTemporal:r,typeData:i,...s})=>{const c=(0,g.v9)((e=>e.explore.datasource)),[u,d]=(0,l.useState)(ar),[p,h]=(0,l.useState)(!1),[m,v]=(0,l.useState)(!0),[y,b]=(0,l.useState)(!1),[_,C]=(0,l.useState)(!1);let T=ar;t&&(0,so.xN)(t)?T=t.verbose_name||t.column_name:t&&(0,Mt.GA)(t)&&(T=t.label||ar),(0,l.useEffect)((()=>{d(T)}),[T,p]);const S=(0,l.useCallback)((e=>{h(e)}),[]),x=(0,l.useCallback)((()=>{h(!1)}),[]),{visible:w,handleTogglePopover:A,handleClosePopover:R}=n?{visible:s.visible,handleTogglePopover:s.togglePopover,handleClosePopover:s.closePopover}:{visible:p,handleTogglePopover:S,handleClosePopover:x},D=(0,l.useCallback)((e=>{v("sqlExpression"!==e)}),[]),O=(0,l.useMemo)((()=>(0,E.tZ)(yt.b,null,(0,E.tZ)(Xo,{editedColumn:t,columns:e,setDatasetModal:C,onClose:R,onChange:a,label:u,setLabel:d,getCurrentTab:D,isTemporal:r,typeData:i}))),[e,t,D,R,r,a,u]),N=(0,l.useCallback)((e=>{d(e.target.value),b(!0)}),[]),M=(0,l.useMemo)((()=>(0,E.tZ)(tr,{title:u,onChange:N,isEditDisabled:m,hasCustomLabel:y})),[y,m,N,u]);return(0,E.tZ)(l.Fragment,null,_&&(0,E.tZ)(je.W,{visible:_,onHide:()=>C(!1),buttonTextOnSave:(0,f.t)("Save"),buttonTextOnOverwrite:(0,f.t)("Overwrite"),modalDescription:(0,f.t)("Save this query as a virtual dataset to continue exploring"),datasource:c}),(0,E.tZ)(Z.Z,{trigger:"click",content:O,defaultVisible:w,visible:w,onVisibleChange:A,title:M,destroyTooltipOnHide:!0,typeData:i},o))};const or=(0,Yo.pO)((function(e){var t;const{value:a,options:n,multi:r=!0,onChange:i,canDelete:s=!0,ghostButtonText:c,clickEnabledGhostButtonText:u,name:d,label:p,isTemporal:h}=e,[m,g]=(0,l.useState)(!1),v=(0,l.useRef)(),y=(0,l.useMemo)((()=>{const t=Object.fromEntries(n.map((e=>[e.column_name,e]))),o=new Qo(t,r,a);if("DndColumnSelect"===e.type&&"filter_price"===e.name&&!v.current){const e=V()(o),t=[];if(a&&Array.isArray(a)&&a.length)for(let e in a){const n=a[e];t.push({column_name:n,groupby:!0,advanced_data_type:null,certification_details:null,certified_by:null,description:null,expression:null,filterable:!0,id:Math.floor(9e4*Math.random())+1e4,is_certified:!1,is_dttm:!1,python_date_format:null,type:"BLOB",type_generic:null,verbose_name:"",warning_markdown:null})}e.values=t,v.current=e}return o}),[r,n,a]),b=(0,l.useCallback)((t=>{if("DndColumnSelect"===e.type&&"filter_price"===e.name){const e=t.value;v.current.multi||Wo()(v.current.values)?v.current.add(e.column_name):v.current.replace(0,e.column_name),i(v.current.getValues())}else{const e=t.value;y.multi||Wo()(y.values)?y.add(e.column_name):y.replace(0,e.column_name),i(y.getValues())}}),[i,y,v.current]),_=(0,l.useCallback)((t=>{if("DndColumnSelect"===e.type&&"filter_price"===e.name){const e=t.value.column_name;return v.current.options[e]=t.value,e in v.current.options&&!v.current.has(e)}{const e=t.value.column_name;return e in y.options&&!y.has(e)}}),[y]),C=(0,l.useCallback)((t=>{"DndColumnSelect"===e.type&&"filter_price"===e.name?(v.current.del(t),i(v.current.getValues())):(y.del(t),i(y.getValues()))}),[i,y,v.current]),T=(0,l.useCallback)(((e,t)=>{y.swap(e,t),i(y.getValues())}),[i,y]),Z=(0,l.useMemo)((()=>(0,nn.c)(nn.T.ENABLE_DND_WITH_CLICK_UX)),[]),S=(0,l.useCallback)((()=>("DndColumnSelect"===e.type&&"filter_price"===e.name?v.current:y).values.map(((t,a)=>{const o=(0,Mt.GA)(t)&&t.datasourceWarning?(0,f.t)("This column might be incompatible with current dataset"):void 0;return Z?(0,E.tZ)(nr,{key:a,columns:n,onColumnEdit:e=>{(0,so.xN)(e)?y.replace(a,e.column_name):y.replace(a,e),i(y.getValues())},editedColumn:t,isTemporal:h,typeData:e},(0,E.tZ)(Ft,{key:a,index:a,clickClose:C,onShiftOptions:T,type:`${pt.g.ColumnOption}_${d}_${p}`,canDelete:s,column:t,datasourceWarningMessage:o,withCaret:!0})):(0,E.tZ)(Ft,{key:a,index:a,clickClose:C,onShiftOptions:T,type:`${pt.g.ColumnOption}_${d}_${p}`,canDelete:s,column:t,datasourceWarningMessage:o})}))),[s,Z,h,p,d,i,C,T,y,n,v.current]),x=(0,l.useCallback)((e=>{(0,so.xN)(e)?y.add(e.column_name):y.add(e),i(y.getValues())}),[i,y]),w=(0,l.useCallback)((e=>{g(e)}),[]),A=(0,l.useCallback)((()=>{w(!1)}),[w]),R=(0,l.useCallback)((()=>{"filter_price"===e.name&&"DndColumnSelect"===e.type?w(!1):w(!0)}),[w]),D=(0,l.useMemo)((()=>{return"filter_object"===e.name?(0,f.tn)("Filter for: Drag columns/metrics here or click",r?2:1):"filter_price"===e.name?(0,f.tn)("Filter values: Drag column/metric here",r?2:1):Z?null!=(t=null!=u?u:c)?t:(0,f.tn)("Drop a column here or click","Drop columns here or click",r?2:1):null!=c?c:(0,f.tn)("Drop column here","Drop columns here",r?2:1);var t}),[Z,u,c,r,e.name]);let O=r||0===y.values.length;return"filter_object"===e.name&&(null==e||null==(t=e.value)?void 0:t.length)>=1&&(O=!1),(0,E.tZ)("div",null,(0,E.tZ)(At,o()({onDrop:b,canDrop:_,valuesRenderer:S,accept:pt.g.Column,displayGhostButton:O,ghostButtonText:D,onClickGhostButton:Z?R:void 0},e)),(0,E.tZ)(nr,{columns:n,onColumnEdit:x,isControlledComponent:!0,togglePopover:w,closePopover:A,visible:m,isTemporal:h,typeData:e},(0,E.tZ)("div",null)))}),ya.Z);var rr=a(68492),ir=a(111146),lr=a(561314);const{warning:sr}=Ua.Z,cr=[pt.g.Column,pt.g.Metric,pt.g.MetricOption,pt.g.AdhocMetricOption],ur=e=>!(e instanceof Dt.ZP)&&(null==e?void 0:e.expressionType),dr=(0,Yo.pO)((e=>{var t;const{datasource:a,onChange:n=(()=>{}),name:r,canDelete:i}=e,s=Array.from(null!=(t=e.value)?t:[]),[c,u]=(0,l.useState)(s.map((e=>ur(e)?new Dt.ZP(e):e))),[d,p]=(0,l.useState)(void 0),[h,m]=(0,l.useState)(!1),[g,v]=(0,l.useState)({}),y=(e,t)=>[...e,...[...(null==t?void 0:t.metrics)||[],null==t?void 0:t.metric].map((e=>e&&("string"===typeof e?{saved_metric_name:e}:new ht.Z(e))))].filter((e=>e)).reduce(((e,t)=>("saved_metric_name"in t&&t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):"column_name"in t&&t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof ht.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>{var a,n;return null!=(a=null==(n=e.saved_metric_name||e.column_name||e.label)?void 0:n.localeCompare(t.saved_metric_name||t.column_name||t.label||""))?a:0})),[b,_]=(0,l.useState)(y(e.columns,e.formData));(0,l.useEffect)((()=>{if(a&&"table"===a.type){var e;const t=null==(e=a.database)?void 0:e.id,{datasource_name:n,schema:o,is_sqllab_view:r}=a;!r&&t&&n&&o&&Ze.Z.get({endpoint:`/api/v1/database/${t}/table_extra/${n}/${o}/`}).then((({json:e})=>{if(null!=e&&e.partitions){const{partitions:t}=e;null!=t&&t.cols&&1===Object.keys(t.cols).length&&p(t.cols[0])}})).catch((e=>{rr.Z.error("fetch extra_table_metadata:",e.statusText)}))}}),[a]),(0,l.useEffect)((()=>{_(y(e.columns,e.formData))}),[e.columns,e.formData]),(0,l.useEffect)((()=>{u((e.value||[]).map((e=>ur(e)?new Dt.ZP(e):e)))}),[e.value]);const C=(0,l.useCallback)((e=>{const t=[...c];t.splice(e,1),u(t),n(t)}),[n,c]),T=(0,l.useCallback)((e=>{const t=null==i?void 0:i(c[e],c);"string"!==typeof t?C(e):sr({title:(0,f.t)("Warning"),content:t})}),[i,C,c]),Z=(0,l.useCallback)(((e,t)=>{const a=[...c];[a[t],a[e]]=[a[e],a[t]],u(a)}),[c]),S=(0,l.useCallback)((t=>{var a;return null==(a=e.savedMetrics.find((e=>e.metric_name===t)))?void 0:a.expression}),[e.savedMetrics]),x=(0,l.useCallback)((e=>{if(e instanceof Dt.ZP)return e;const t=e;return t.saved_metric_name?new Dt.ZP({expressionType:Dt.vq.SQL,subject:S(t.saved_metric_name),operator:St.LT[St.d.GREATER_THAN].operation,operatorId:St.d.GREATER_THAN,comparator:0,clause:Dt.Pr.HAVING}):t.label?new Dt.ZP({expressionType:Dt.vq.SQL,subject:new ht.Z(e).translateToSql(),operator:St.LT[St.d.GREATER_THAN].operation,operatorId:St.d.GREATER_THAN,comparator:0,clause:Dt.Pr.HAVING}):t.column_name?new Dt.ZP({expressionType:Dt.vq.SIMPLE,subject:t.column_name,operator:St.LT[St.d.EQUALS].operation,operatorId:St.d.EQUALS,comparator:"",clause:Dt.Pr.WHERE,isNew:!0}):null}),[a.type,S]),w=(0,l.useCallback)((e=>{n(c.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}),[n,c]),A=(0,l.useCallback)((e=>{const t=x(e);if(t){const e=[...c,t];u(e),n(e)}}),[x,n,c]),R=(0,l.useCallback)((e=>{m(e)}),[]),D=(0,l.useCallback)((()=>{R(!1)}),[R]),O=(0,l.useCallback)((()=>c.map(((e,t)=>(0,E.tZ)(Pt,{key:t,index:t,adhocFilter:e,options:b,datasource:a,onFilterEdit:w,partitionColumn:d,onClickClose:T,onShiftOptions:Z})))),[T,w,Z,b,d,a,c]),N=(0,l.useCallback)((()=>{v({}),R(!0)}),[R]),M=(0,lr.Ct)(),I=(0,l.useMemo)((()=>{if($t(g))return new Dt.ZP({expressionType:Dt.vq.SQL,clause:Dt.Pr.HAVING,sqlExpression:null==g?void 0:g.expression});if(g instanceof ht.Z)return new Dt.ZP({expressionType:Dt.vq.SQL,clause:Dt.Pr.HAVING,sqlExpression:null==g?void 0:g.translateToSql()});const t={subject:null==g?void 0:g.column_name};return t.subject&&(0,nn.c)(nn.T.UX_BETA)&&(t.operator=St.LT[St.d.IN].operation,t.operatorId=St.d.IN),ir.O6&&(0,so.xN)(g)&&(0,Se.x)(null==g?void 0:g.column_name,e.datasource)&&(t.operator=St.d.TEMPORAL_RANGE,t.operatorId=St.d.TEMPORAL_RANGE,t.comparator=M),new Dt.ZP(t)}),[g]),L=(0,l.useCallback)((e=>!e.value.field_code),[]),k=(0,l.useCallback)((e=>{v(e.value),R(!0)}),[r,R]),F=(0,nn.c)(nn.T.ENABLE_DND_WITH_CLICK_UX)?(0,f.t)("Drop columns/metrics here or click"):(0,f.t)("Drop columns or metrics here");return(0,E.tZ)(l.Fragment,null,(0,E.tZ)(At,o()({onDrop:k,canDrop:L,valuesRenderer:O,accept:cr,ghostButtonText:F,onClickGhostButton:(0,nn.c)(nn.T.ENABLE_DND_WITH_CLICK_UX)?N:void 0},e)),(0,E.tZ)(Rt.Z,{adhocFilter:I,options:b,datasource:a,onFilterEdit:A,partitionColumn:d,isControlledComponent:!0,visible:h,togglePopover:R,closePopover:D,requireSave:!!g}))}),Ja.Z);var pr=a(62446);const hr={},mr=[pt.g.Column,pt.g.Metric],gr=(e,t,a)=>{if(!e)return[];return(0,ut.Z)(e).filter((e=>(0,pr.AG)(e)?t.some((t=>t.metric_name===e)):!(0,pr.nX)(e)||a.some((t=>t.column_name===e.column.column_name)))).map((e=>{if(!(t=e)||t instanceof ht.Z||"string"===typeof t||!t.expressionType)return e;var t;if((0,pr.nX)(e)){const t=a.find((t=>t.column_name===e.column.column_name));if(t)return new ht.Z({...e,column:t})}return new ht.Z(e)}))},fr=(e,t,a)=>{var n;return null!=(n=null==e?void 0:e.filter((e=>{var n;return Array.isArray(t)?!t.includes(null!=(n=e.metric_name)?n:"")||e.metric_name===a:e})))?n:[]},vr=(0,Yo.pO)((e=>{const{onChange:t,multi:a,name:n}=e,r=(0,l.useCallback)((e=>{if(null===e)return void t(null);const n=(0,ut.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(a?n:n[0])}),[a,t]),[i,s]=(0,l.useState)(gr(e.value,e.savedMetrics,e.columns)),[c,u]=(0,l.useState)({}),[d,p]=(0,l.useState)(!1);(0,l.useEffect)((()=>{s(gr(e.value,e.savedMetrics,e.columns))}),[JSON.stringify(e.value),JSON.stringify(e.savedMetrics),JSON.stringify(e.columns)]);const h=(0,l.useCallback)((e=>{if(e.value.field_code)return!1;return!("metric"===e.type&&i.includes(e.value.metric_name))}),[i]),m=(0,l.useCallback)((t=>{const a=e.multi?[...i,t]:[t];s(a),r(a)}),[r,e.multi,i]),g=(0,l.useCallback)(((e,t)=>{if(t instanceof ht.Z&&t.equals(e))return;const a=i.map((a=>("metric_name"in t&&a===t.metric_name||"undefined"!==typeof a.optionName)&&a.optionName===t.optionName?e:a));s(a),r(a)}),[r,i]),v=(0,l.useCallback)((e=>{if(!Array.isArray(i))return;const t=[...i];t.splice(e,1),s(t),r(t)}),[r,i]),y=(0,l.useCallback)(((e,t)=>{const a=[...i];[a[t],a[e]]=[a[e],a[t]],s(a)}),[i]),b=(0,l.useMemo)((()=>fr(e.savedMetrics,e.value)),[e.savedMetrics,e.value]),_=(0,l.useCallback)((t=>{var a;return fr(e.savedMetrics,e.value,null==(a=e.value)?void 0:a[t])}),[e.savedMetrics,e.value]),C=(0,l.useCallback)((()=>t(a?i:i[0])),[a,t,i]),T=(0,l.useCallback)(((t,o)=>(0,E.tZ)(Xt,{key:o,name:n,index:o,option:t,onMetricEdit:g,onRemoveMetric:v,columns:e.columns,savedMetrics:e.savedMetrics,savedMetricsOptions:_(o),datasource:e.datasource,onMoveLabel:y,onDropLabel:C,type:`${pt.g.AdhocMetricOption}_${e.name}_${e.label}`,multi:a,datasourceWarningMessage:t instanceof ht.Z&&t.datasourceWarning?(0,f.t)("This metric might be incompatible with current dataset"):void 0})),[_,C,y,a,g,v,e.columns,e.datasource,e.label,e.name,e.savedMetrics]),Z=(0,l.useCallback)((()=>i.map(((e,t)=>T(e,t)))),[i,T]),S=(0,l.useCallback)((e=>{p(e)}),[]),x=(0,l.useCallback)((()=>{S(!1)}),[S]),w=(0,l.useCallback)((e=>{e.type===pt.g.Metric&&m(e.value),e.type===pt.g.Column&&(u(e),S(!0))}),[m,S]),A=(0,l.useCallback)((()=>{u({}),S(!0)}),[S]),R=(0,l.useMemo)((()=>{if((null==(e=c)?void 0:e.value)&&(null==e?void 0:e.type)&&c.type===pt.g.Column){const e=c.value,t={column:e};return(0,nn.c)(nn.T.UX_BETA)&&(e.type_generic===uo.Z.NUMERIC?t.aggregate=St.YY.SUM:e.type_generic!==uo.Z.STRING&&e.type_generic!==uo.Z.BOOLEAN&&e.type_generic!==uo.Z.TEMPORAL||(t.aggregate=St.YY.COUNT_DISTINCT)),new ht.Z(t)}var e;return new ht.Z({})}),[c]),D=(0,nn.c)(nn.T.ENABLE_DND_WITH_CLICK_UX)?(0,f.tn)("Drop a column/metric here or click","Drop columns/metrics here or click",a?2:1):(0,f.tn)("Drop column or metric here","Drop columns or metrics here",a?2:1);return(0,E.tZ)("div",{className:"metrics-select"},(0,E.tZ)(At,o()({onDrop:w,canDrop:h,valuesRenderer:Z,accept:mr,ghostButtonText:D,displayGhostButton:a||0===i.length,onClickGhostButton:(0,nn.c)(nn.T.ENABLE_DND_WITH_CLICK_UX)?A:void 0},e)),(0,E.tZ)(Wt,{adhocMetric:R,onMetricEdit:m,columns:e.columns,savedMetricsOptions:b,savedMetric:hr,datasource:e.datasource,isControlledComponent:!0,visible:d,togglePopover:S,closePopover:x,name:n,isNew:!0},(0,E.tZ)("div",null)))}),la);var yr=a(787253),br=a(281928);const _r={paddingRight:"5px"};const Cr={AnnotationLayerControl:R,BoundsControl:P,CheckboxControl:$.Z,CollectionControl:ee,ColorPickerControl:ce,ColorSchemeControl:ue.Z,PlaceNameMappingControl:_e,DatasourceControl:rt,DateFilterControl:it.ZP,DndColumnSelectControl:At,DndColumnSelect:or,DndFilterSelect:dr,DrillDownControl:function(e){const t=()=>{const t=e.chartId.toString();if(e.value)e.actions.updateDataMask(t,{ownState:{}});else{const a=br.Z.fromHierarchy(e.columns);e.actions.updateDataMask(t,{ownState:{drilldown:a}})}e.onChange(!e.value)},a=()=>(0,E.tZ)(yr.ZP,{onChange:t,style:_r,checked:e.value});return e.label?(0,E.tZ)(M.Z,o()({},e,{leftNode:a(),onClick:t})):a()},DndMetricSelect:vr,FixedOrMetricControl:ha,HiddenControl:function(e){return(0,E.tZ)(N.II,{type:"hidden",value:e.value})},SelectAsyncControl:va,SelectControl:ya.Z,SliderControl:function({default:e,name:t,label:a,description:n,renderTrigger:r,rightNode:i,leftNode:s,validationErrors:c,hovered:u,warning:d,danger:p,onClick:h,tooltipOnClick:m,onChange:g=(()=>{}),...f}){const v={name:t,label:a,description:n,renderTrigger:r,rightNode:i,leftNode:s,validationErrors:c,onClick:h,hovered:u,tooltipOnClick:m,warning:d,danger:p};return(0,E.tZ)(l.Fragment,null,(0,E.tZ)(M.Z,v),(0,E.tZ)(Ca,o()({},f,{onChange:g,defaultValue:e})))},SpatialControl:Ea.Z,TextAreaControl:Ta.Z,TextControl:ct.Z,TimeSeriesColumnControl:Na,ViewportControl:Fa,VizTypeControl:Qa,MetricsControl:la,AdhocFilterControl:Ja.Z,FilterBoxItemControl:_n,ConditionalFormattingControl:lo,ConditionalFormattingControlPro:Bo,XAxisSortControl:function(e){const[t,a]=(0,l.useState)(e.value);return(0,l.useEffect)((()=>{e.shouldReset&&(e.onChange(void 0),a(null))}),[e.shouldReset,e.value]),(0,E.tZ)(ya.Z,o()({},e,{value:t}))},...d.ZP},Er=Cr,Tr=s.iK.div`
  padding-bottom: ${({theme:e})=>4*e.gridUnit}px;
`;function Zr(e){const{actions:{setControlValue:t},name:a,type:n,hidden:r,isVisible:s,resetOnHide:d=!0}=e,[p,h]=(0,l.useState)(!1),m=(0,c.D)(s),g=(0,l.useCallback)(((e,n)=>t(a,e,n)),[a,t]);if((0,l.useEffect)((()=>{!0===m&&!1===s&&void 0!==e.default&&!i()(e.value,e.default)&&d&&(null==t||t(a,e.default))}),[a,m,s,t,e.value,e.default]),!n||!1===s)return null;const f="string"===typeof n?Er[n]:n;return f?(0,E.tZ)(Tr,{className:"Control","data-test":a,style:r?{display:"none"}:void 0,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)},(0,E.tZ)(u.Z,null,(0,E.tZ)(f,o()({onChange:g,hovered:p},e)))):null}},482342:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(667294),o=a(211965),r=a(751995),i=a(455867),l=a(358593),s=a(49238),c=a(731293);const u=o.iv`
  &.anticon {
    font-size: unset;
    .anticon {
      line-height: unset;
      vertical-align: unset;
    }
  }
`,d=({name:e,label:t,description:a,validationErrors:d=[],renderTrigger:p=!1,rightNode:h,leftNode:m,onClick:g,hovered:f=!1,tooltipOnClick:v=(()=>{}),warning:y,danger:b})=>{const{gridUnit:_,colors:C}=(0,r.Fg)(),E=(0,n.useRef)(!1),T=(0,n.useMemo)((()=>(d.length||(E.current=!0),E.current?d.length?C.error.base:"unset":C.alert.base)),[C.error.base,C.alert.base,d.length]);if(!t)return null;return(0,o.tZ)("div",{className:"ControlHeader","data-test":`${e}-header`},(0,o.tZ)("div",{className:"pull-left"},(0,o.tZ)(s.lX,{css:e=>o.iv`
              margin-bottom: ${.5*e.gridUnit}px;
              position: relative;
            `},m&&(0,o.tZ)("span",null,m),(0,o.tZ)("span",{role:"button",tabIndex:0,onClick:g,style:{cursor:g?"pointer":""}},t)," ",y&&(0,o.tZ)("span",null,(0,o.tZ)(l.u,{id:"error-tooltip",placement:"top",title:y},(0,o.tZ)(c.Z.AlertSolid,{iconColor:C.alert.base,iconSize:"s"}))," "),b&&(0,o.tZ)("span",null,(0,o.tZ)(l.u,{id:"error-tooltip",placement:"top",title:b},(0,o.tZ)(c.Z.ErrorSolid,{iconColor:C.error.base,iconSize:"s"}))," "),(null==d?void 0:d.length)>0&&(0,o.tZ)("span",{"data-test":"error-tooltip"},(0,o.tZ)(l.u,{id:"error-tooltip",placement:"top",title:null==d?void 0:d.join(" ")},(0,o.tZ)(c.Z.ExclamationCircleOutlined,{css:o.iv`
                    ${u}
                    color: ${T};
                  `}))," "),f?(0,o.tZ)("span",{css:()=>o.iv`
          position: absolute;
          top: 50%;
          right: 0;
          padding-left: ${_}px;
          transform: translate(100%, -50%);
          white-space: nowrap;
        `},a&&(0,o.tZ)("span",null,(0,o.tZ)(l.u,{id:"description-tooltip",title:a,placement:"top"},(0,o.tZ)(c.Z.InfoCircleOutlined,{css:u,onClick:v}))," "),p&&(0,o.tZ)("span",null,(0,o.tZ)(l.u,{id:"description-tooltip",title:(0,i.t)("Changing this control takes effect instantly"),placement:"top"},(0,o.tZ)(c.Z.ThunderboltOutlined,{css:u}))," ")):null)),h&&(0,o.tZ)("div",{className:"pull-right"},h),(0,o.tZ)("div",{className:"clearfix"}))}},550909:(e,t,a)=>{a.d(t,{C4:()=>M,HS:()=>x,_q:()=>L,m:()=>S,qi:()=>Z,uy:()=>w});var n=a(211965),o=a(667294),r=a(751995),i=a(455867),l=a(751115),s=a(642846),c=a(88889),u=a(23279),d=a.n(u),p=a(49937),h=a(9875),m=a(427600),g=a(287183),f=a(731293),v=a(835932),y=a(976697),b=a(454076),_=a(313433),C=a(989555),E=a(261587);const T=(0,r.iK)("span")`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,Z=(0,r.iK)(v.Z)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${({theme:e})=>2*e.gridUnit}px;
  }

  i {
    padding: 0 ${({theme:e})=>e.gridUnit}px;
  }
`,S=({data:e,columns:t})=>{const a=(0,r.Fg)();return(0,n.tZ)(_.Z,{text:e&&t?(0,b.Mv)(e,t):"",wrapped:!1,copyNode:(0,n.tZ)(f.Z.CopyOutlined,{iconColor:a.colors.grayscale.base,iconSize:"l","aria-label":(0,i.t)("Copy"),role:"button",css:n.iv`
            &.anticon > * {
              line-height: 0;
            }
          `})})},x=({onChangeHandler:e})=>{const t=(0,r.Fg)(),a=d()(e,m.M$);return(0,n.tZ)(h.II,{prefix:(0,n.tZ)(f.Z.Search,{iconColor:t.colors.grayscale.base}),placeholder:(0,i.t)("Search"),onChange:e=>{const t=e.target.value;a(t)},css:n.iv`
        width: 200px;
        margin-right: ${2*t.gridUnit}px;
      `})},w=({data:e,loading:t})=>{var a;return(0,n.tZ)(C.Z,{rowcount:null!=(a=null==e?void 0:e.length)?a:0,loading:t})};var A;!function(e){e.Formatted="formatted",e.Original="original"}(A||(A={}));const R=({onChange:e,value:t})=>(0,n.tZ)(g.Y.Group,{value:t,onChange:e},(0,n.tZ)(p.T,{direction:"vertical"},(0,n.tZ)(g.Y,{value:A.Formatted},(0,i.t)("Formatted date")),(0,n.tZ)(g.Y,{value:A.Original},(0,i.t)("Original value")))),D=r.iK.div`
  display: flex;
  flex-direction: column;

  padding: ${({theme:e})=>4*e.gridUnit+"px"};
`,O=r.iK.span`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  text-transform: uppercase;
`,N=({columnName:e,onTimeColumnChange:t,datasourceId:a,isOriginalTimeColumn:l})=>{const s=(0,r.Fg)(),c=a=>{t(e,a.target.value)},u=(0,o.useMemo)((()=>a?(0,n.tZ)(D,{onClick:e=>e.stopPropagation()},(0,n.tZ)(n.xB,{styles:n.iv`
              .column-formatting-popover .ant-popover-inner-content {
                padding: 0;
              }
            `}),(0,n.tZ)(O,null,(0,i.t)("Column Formatting")),(0,n.tZ)(R,{onChange:c,value:l?A.Original:A.Formatted})):null),[a,l]);return a?(0,n.tZ)("span",null,(0,n.tZ)(y.ZP,{overlayClassName:"column-formatting-popover",trigger:"click",content:u,placement:"bottomLeft",arrowPointAtCenter:!0},(0,n.tZ)(f.Z.SettingOutlined,{iconSize:"m",iconColor:s.colors.grayscale.light1,css:(0,n.iv)({marginRight:`${s.gridUnit}px`},"",""),onClick:e=>e.stopPropagation()})),e):(0,n.tZ)("span",null,e)},M=(e,t)=>{const a=(0,o.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,i.t)("N/A"))))))?e:[]}),[t]);return(0,o.useMemo)((()=>null!=t&&t.length?t.filter(((t,n)=>a[n].some((t=>null==t?void 0:t.includes(e.toLowerCase()))))):[]),[t,e,a])},I=(0,l.bt)(s.Z.DATABASE_DATETIME),L=(e,t,a,r,i,l)=>{const[s,u]=(0,o.useState)((0,E.W)(r)),d=(e,t)=>{if(r)if(t!==A.Original||s.includes(e)){if(t===A.Formatted&&s.includes(e)){const t=(0,E.W)(r);t.splice(t.indexOf(e),1),(0,E.e)(r,t),u(t)}}else{const t=(0,E.W)(r);t.push(e),(0,E.e)(r,t),u(t)}};return(0,o.useEffect)((()=>{i&&u((0,E.W)(r))}),[r,i]),(0,o.useMemo)((()=>e&&null!=a&&a.length?e.filter((e=>Object.keys(a[0]).includes(e))).map(((e,o)=>{const i=null==t?void 0:t[o],u=a[0][e],p=i===c.Z.TEMPORAL?s.indexOf(e):-1,h=s.includes(e);return{id:e||o,accessor:t=>t[e],Header:i===c.Z.TEMPORAL&&"string"!==typeof u?(0,n.tZ)(N,{columnName:e,datasourceId:r,onTimeColumnChange:d,isOriginalTimeColumn:h}):e,Cell:({value:e})=>!0===e?m.Ly:!1===e?m.gz:null===e?(0,n.tZ)(T,null,m.Wq):i===c.Z.TEMPORAL&&-1===p&&"number"===typeof e?I(e):String(e),...null==l?void 0:l[e]}})):[]),[e,a,t,r,l,s])}},261587:(e,t,a)=>{a.d(t,{W:()=>r,e:()=>i});var n=a(355786),o=a(961337);const r=e=>{const t=(0,o.rV)(o.dR.explore__data_table_original_formatted_time_columns,{});return void 0===e?[]:(0,n.Z)(t[e])},i=(e,t)=>{const a=(0,o.rV)(o.dR.explore__data_table_original_formatted_time_columns,{});(0,o.LS)(o.dR.explore__data_table_original_formatted_time_columns,{...a,[e]:t})}},642753:(e,t,a)=>{var n;a.d(t,{g:()=>n}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(n||(n={}))},563325:(e,t,a)=>{a.d(t,{b:()=>n});const n=a(751995).iK.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.gridUnit}px;
    margin-right: ${({theme:e})=>-2*e.gridUnit}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colors.grayscale.light2} solid thin;
  }
`},989555:(e,t,a)=>{a.d(t,{Z:()=>s});a(667294);var n=a(767190),o=a(455867),r=a(737921),i=a(358593),l=a(211965);function s(e){const{rowcount:t=0,limit:a,loading:s}=e,c=t===a,u=c||0===t&&!s?"danger":"default",d=(0,n.JB)()(t),p=(0,l.tZ)(r.Z,{type:u},s?(0,o.t)("Loading..."):(0,l.tZ)("span",{"data-test":"row-count-label"},(0,o.tn)("%s row","%s rows",t,d)));return c?(0,l.tZ)(i.u,{id:"tt-rowcount-tooltip",title:(0,l.tZ)("span",null,(0,o.t)("Limit reached"))},p):p}},676787:(e,t,a)=>{a.d(t,{Z:()=>_});var n=a(205872),o=a.n(n),r=a(623560),i=a.n(r),l=a(667294),s=a(751995),c=a(455867),u=a(49937),d=a(482342),p=a(358593),h=a(731293),m=a(211965);function g(e){const{id:t,label:a,colors:n}=e,[o,r]=(0,l.useState)(!1),i=(0,l.useRef)(null),s=(0,l.useRef)(null),c=()=>n.map(((e,a)=>(0,m.tZ)("span",{"data-test":"color",key:`${t}-${a}`,css:t=>m.iv`
          padding-left: ${t.gridUnit/2}px;
          :before {
            content: '';
            display: inline-block;
            background-color: ${e};
            border: 1px solid ${"white"===e?"black":e};
            width: 9px;
            height: 10px;
          }
        `})));return(0,m.tZ)(p.u,{"data-testid":"tooltip",overlayClassName:"color-scheme-tooltip",title:()=>(0,m.tZ)(l.Fragment,null,(0,m.tZ)("span",null,a),(0,m.tZ)("div",null,c())),key:t,visible:o},(0,m.tZ)("span",{className:"color-scheme-option",onMouseEnter:()=>{const e=i.current,t=s.current;e&&t&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight||t.scrollWidth>t.offsetWidth||t.scrollHeight>t.offsetHeight)&&r(!0)},onMouseLeave:()=>{r(!1)},css:m.iv`
          display: flex;
          align-items: center;
          justify-content: flex-start;
        `,"data-test":t},(0,m.tZ)("span",{className:"color-scheme-label",ref:i,css:e=>m.iv`
            min-width: 125px;
            padding-right: ${2*e.gridUnit}px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
          `},a),(0,m.tZ)("span",{ref:s,css:e=>m.iv`
            flex: 100%;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            padding-right: ${e.gridUnit}px;
          `},c())))}const f=(0,s.iK)(h.Z.AlertSolid)`
  color: ${({theme:e})=>e.colors.alert.base};
`,v=(0,c.t)("This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings"),y=(0,c.t)("The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties."),b=({label:e,hasCustomLabelColors:t,dashboardId:a})=>{if(t||a){const a=t?v:y;return(0,m.tZ)(l.Fragment,null,e," ",(0,m.tZ)(p.u,{title:a},(0,m.tZ)(f,{iconSize:"s"})))}return(0,m.tZ)(l.Fragment,null,e)},_=({hasCustomLabelColors:e=!1,dashboardId:t,label:a=(0,c.t)("Color scheme"),name:n,onChange:r=(()=>{}),value:s,clearable:h=!1,defaultScheme:f,choices:v=[],schemes:_={},isLinear:C,...E})=>{const T=(0,l.useMemo)((()=>{if(t)return"dashboard";let e=s||f;if("SUPERSET_DEFAULT"===e){var a;const t=i()(_)?_():_;e=null==t||null==(a=t.SUPERSET_DEFAULT)?void 0:a.id}return e}),[t,f,_,s]),Z=(0,l.useMemo)((()=>{if(t)return[{value:"dashboard",label:(0,c.t)("dashboard"),customLabel:(0,m.tZ)(p.u,{title:y},(0,c.t)("Dashboard scheme"))}];const e=i()(_)?_():_,a=i()(v)?v():v,n=[];return a.filter((e=>{const t=e[0],a="SUPERSET_DEFAULT"!==t&&!n.includes(t);return n.push(t),a})).map((([t])=>{var a;const n=e[t];let o=[];return n&&(o=C?n.getColors(10):n.colors),{customLabel:(0,m.tZ)(g,{id:n.id,label:n.label,colors:o}),label:(null==e||null==(a=e[t])?void 0:a.label)||t,value:t}}))}),[v,t,C,_]);return(0,m.tZ)(u.Ph,{header:(0,m.tZ)(d.Z,o()({},E,{label:(0,m.tZ)(b,{label:a,hasCustomLabelColors:e,dashboardId:t})})),ariaLabel:(0,c.t)("Select color scheme"),allowClear:h,disabled:!!t,name:`select-${n}`,onChange:e=>r(e),options:Z,placeholder:(0,c.t)("Select scheme"),value:T})}},927845:(e,t,a)=>{a.d(t,{Z:()=>u,j:()=>s});var n=a(205872),o=a.n(n),r=a(667294),i=a(976697),l=a(211965);const s=()=>{var e;return null==(e=document.getElementById("controlSections"))?void 0:e.lastElementChild},c=e=>{var t,a;const n=null==(t=window)?void 0:t.innerHeight,o=null==e||null==(a=e.getBoundingClientRect())?void 0:a.top;return n&&o?o/n:0},u=({getPopupContainer:e,getVisibilityRatio:t=c,visible:a,destroyTooltipOnHide:n=!1,typeData:u,...d})=>{const p=(0,r.useRef)(),[h,m]=(0,r.useState)(void 0===a?d.defaultVisible:a),[g,f]=r.useState("right"),v=(0,r.useCallback)((()=>{const e=t(p.current);f(e<.35&&"rightTop"!==g?"rightTop":e>.65&&"rightBottom"!==g?"rightBottom":"right")}),[t]),y=(0,r.useCallback)((e=>{const t=s();t&&t.style.setProperty("overflow-y",e?"hidden":"auto","important")}),[v]),b=(0,r.useCallback)((t=>(p.current=t,(null==e?void 0:e(t))||document.body)),[v,e]),_=(0,r.useCallback)((e=>{void 0===e&&y(e),void 0===u?(m(!!e),null==d.onVisibleChange||d.onVisibleChange(!!e)):"DndColumnSelect"===u.type&&"filter_price"===u.name?(m(!e),null==d.onVisibleChange||d.onVisibleChange(!e)):(m(!!e),null==d.onVisibleChange||d.onVisibleChange(!!e))}),[d,y]),C=(0,r.useCallback)((e=>{"Escape"===e.key&&(m(!1),null==d.onVisibleChange||d.onVisibleChange(!1))}),[d]);return(0,r.useEffect)((()=>{void 0!==a&&m(!!a)}),[a]),(0,r.useEffect)((()=>{void 0!==h&&y(h)}),[h,y]),(0,r.useEffect)((()=>(h&&document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)})),[C,h]),(0,r.useEffect)((()=>{h&&v()}),[h,v]),(0,l.tZ)(i.ZP,o()({},d,{visible:h,arrowPointAtCenter:!0,placement:g,onVisibleChange:_,getPopupContainer:b,destroyTooltipOnHide:n}))}},374092:(e,t,a)=>{a.d(t,{Z:()=>Y});var n=a(667294),o=a(751995),r=a(211965),i=a(5364),l=a(455867),s=a(918010),c=a(835932),u=a(482342),d=a(774069),p=a(49937),h=a(731293),m=a(281315),g=a(358593),f=a(112515),v=a(427600),y=a(454076),b=a(763279),_=a(561314),C=a(21089),E=a(927845),T=a(287183);function Z(e){let t="Last week";return _.bk.has(e.value)?t=e.value:e.onChange(t),(0,r.tZ)(n.Fragment,null,(0,r.tZ)("div",{className:"section-title","data-test":_.Db.commonFrame},(0,l.t)("Configure Time Range: Last...")),(0,r.tZ)(T.Y.Group,{value:t,onChange:t=>e.onChange(t.target.value)},_.Sm.map((({value:e,label:t})=>(0,r.tZ)(T.Y,{key:e,value:e,className:"vertical-radio"},t)))))}var S=a(831209);function x({onChange:e,value:t}){return(0,n.useEffect)((()=>{_.LY.has(t)||e(S.gT)}),[e,t]),_.LY.has(t)?(0,r.tZ)(n.Fragment,null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure Time Range: Previous...")),(0,r.tZ)(T.Y.Group,{value:t,onChange:t=>e(t.target.value)},_._S.map((({value:e,label:t})=>(0,r.tZ)(T.Y,{key:e,value:e,className:"vertical-radio"},t))))):null}var w=a(593754),A=a.n(w),R=a(828216),D=a(458146),O=a(9875),N=a(662276),M=a(409882);function I(e){var t;const{customRange:a,matchedFlag:n}=(0,_.c_)(e.value);n||e.onChange((0,_.jK)(a));const{sinceDatetime:o,sinceMode:i,sinceGrain:s,sinceGrainValue:c,untilDatetime:u,untilMode:d,untilGrain:h,untilGrainValue:g,anchorValue:f,anchorMode:v}={...a};function y(t,n){e.onChange((0,_.jK)({...a,[t]:n}))}function b(t,n){A()(n)&&n>0&&e.onChange((0,_.jK)({...a,[t]:n}))}const C=(0,R.v9)((e=>{var t;return null==e||null==(t=e.common)?void 0:t.locale})),E=null==(t=D.locales[_.ZU[C]])?void 0:t.DatePicker;return(0,r.tZ)("div",{"data-test":"custom-frame"},(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure custom time range")),(0,r.tZ)(p.X2,{gutter:24},(0,r.tZ)(p.JX,{span:12},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,r.tZ)(M.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,r.tZ)(m.Z,{ariaLabel:(0,l.t)("START (INCLUSIVE)"),options:_._d,value:i,onChange:e=>y("sinceMode",e)}),"specific"===i&&(0,r.tZ)(p.X2,null,(0,r.tZ)(N.M,{showTime:!0,defaultValue:(0,_.DL)(o),onChange:e=>y("sinceDatetime",e.format(_.KZ)),allowClear:!1,locale:E})),"relative"===i&&(0,r.tZ)(p.X2,{gutter:8},(0,r.tZ)(p.JX,{span:11},(0,r.tZ)(O.Rn,{placeholder:(0,l.t)("Relative quantity"),value:Math.abs(c),min:1,defaultValue:1,onChange:e=>b("sinceGrainValue",e||1),onStep:e=>b("sinceGrainValue",e||1)})),(0,r.tZ)(p.JX,{span:13},(0,r.tZ)(m.Z,{ariaLabel:(0,l.t)("Relative period"),options:_.kj,value:s,onChange:e=>y("sinceGrain",e)})))),(0,r.tZ)(p.JX,{span:12},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,r.tZ)(M.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,r.tZ)(m.Z,{ariaLabel:(0,l.t)("END (EXCLUSIVE)"),options:_.hj,value:d,onChange:e=>y("untilMode",e)}),"specific"===d&&(0,r.tZ)(p.X2,null,(0,r.tZ)(N.M,{showTime:!0,defaultValue:(0,_.DL)(u),onChange:e=>y("untilDatetime",e.format(_.KZ)),allowClear:!1,locale:E})),"relative"===d&&(0,r.tZ)(p.X2,{gutter:8},(0,r.tZ)(p.JX,{span:11},(0,r.tZ)(O.Rn,{placeholder:(0,l.t)("Relative quantity"),value:g,min:1,defaultValue:1,onChange:e=>b("untilGrainValue",e||1),onStep:e=>b("untilGrainValue",e||1)})),(0,r.tZ)(p.JX,{span:13},(0,r.tZ)(m.Z,{ariaLabel:(0,l.t)("Relative period"),options:_.Ae,value:h,onChange:e=>y("untilGrain",e)}))))),"relative"===i&&"relative"===d&&(0,r.tZ)("div",{className:"control-anchor-to"},(0,r.tZ)("div",{className:"control-label"},(0,l.t)("Anchor to")),(0,r.tZ)(p.X2,{align:"middle"},(0,r.tZ)(p.JX,null,(0,r.tZ)(T.Y.Group,{onChange:function(t){const n=t.target.value;"now"===n?e.onChange((0,_.jK)({...a,anchorValue:"now",anchorMode:n})):e.onChange((0,_.jK)({...a,anchorValue:_.V7,anchorMode:n}))},defaultValue:"now",value:v},(0,r.tZ)(T.Y,{key:"now",value:"now"},(0,l.t)("NOW")),(0,r.tZ)(T.Y,{key:"specific",value:"specific"},(0,l.t)("Date/Time")))),"now"!==v&&(0,r.tZ)(p.JX,null,(0,r.tZ)(N.M,{showTime:!0,defaultValue:(0,_.DL)(f),onChange:e=>y("anchorValue",e.format(_.KZ)),allowClear:!1,className:"control-anchor-to-datetime",locale:E})))))}var L=a(205872),k=a.n(L);const F=(0,r.tZ)(n.Fragment,null,(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATETIME"),(0,r.tZ)("p",null,(0,l.t)("Return to specific datetime.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"datetime([string])")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'datetime("2020-03-01 12:00:00")\ndatetime("now")\ndatetime("last year")'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATEADD"),(0,r.tZ)("p",null,(0,l.t)("Moves the given set of dates by a specified interval.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'dateadd(datetime("today"), -13, day)\ndateadd(datetime("2020-03-01"), 2, day)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"DATETRUNC"),(0,r.tZ)("p",null,(0,l.t)("Truncates the specified date to the accuracy specified by the date unit.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'datetrunc(datetime("2020-03-01"), week)\ndatetrunc(datetime("2020-03-01"), month)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"LASTDAY"),(0,r.tZ)("p",null,(0,l.t)("Get the last date by the date unit.")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"lastday([datetime], [dateunit])\ndateunit = (year | month | week)")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'lastday(datetime("today"), month)'))),(0,r.tZ)("div",null,(0,r.tZ)("h3",null,"HOLIDAY"),(0,r.tZ)("p",null,(0,l.t)("Get the specify date for the holiday")),(0,r.tZ)("h4",null,(0,l.t)("Syntax")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,"holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])")),(0,r.tZ)("h4",null,(0,l.t)("Example")),(0,r.tZ)("pre",null,(0,r.tZ)("code",null,'holiday("new year")\nholiday("christmas", datetime("2019"))\nholiday("christmas", dateadd(datetime("2019"), 1, year))\nholiday("christmas", datetime("2 years ago"))\nholiday("Easter Monday", datetime("2019"), "UK")')))),P=e=>{const t=(0,o.Fg)();return(0,r.tZ)(r.ms,null,(({css:a})=>(0,r.tZ)(g.u,k()({overlayClassName:a`
            .ant-tooltip-content {
              min-width: ${125*t.gridUnit}px;
              max-height: 410px;
              overflow-y: scroll;

              .ant-tooltip-inner {
                max-width: ${125*t.gridUnit}px;
                h3 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                h4 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                pre {
                  border: none;
                  text-align: left;
                  word-break: break-word;
                  font-size: ${t.typography.sizes.s}px;
                }
              }
            }
          `},e))))};function $(e){return(0,r.tZ)(P,k()({title:F},e))}function U(e){return e.includes(_.UD)?e:e.startsWith("Last")?[e,""].join(_.UD):e.startsWith("Next")?["",e].join(_.UD):_.UD}function V(e){const t=U(e.value||""),[a,o]=t.split(_.UD);function i(t,n){"since"===t?e.onChange(`${n}${_.UD}${o}`):e.onChange(`${a}${_.UD}${n}`)}return t!==e.value&&e.onChange(U(e.value||"")),(0,r.tZ)(n.Fragment,null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Configure Advanced Time Range "),(0,r.tZ)($,{placement:"rightBottom"},(0,r.tZ)("i",{className:"fa fa-info-circle text-muted"}))),(0,r.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,r.tZ)(M.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,r.tZ)(O.II,{key:"since",value:a,onChange:e=>i("since",e.target.value)}),(0,r.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,r.tZ)(M.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,r.tZ)(O.II,{key:"until",value:o,onChange:e=>i("until",e.target.value)}))}const q="#45BED6",H=o.iK.div`
  ${({theme:e,isActive:t,isPlaceholder:a})=>r.iv`
    width: 100%;
    height: ${8*e.gridUnit}px;

    display: flex;
    align-items: center;
    flex-wrap: nowrap;

    padding: 0 ${3*e.gridUnit}px;

    background-color: ${e.colors.grayscale.light5};

    border: 1px solid
      ${t?q:e.colors.grayscale.light2};
    border-radius: ${e.borderRadius}px;

    cursor: pointer;

    transition: border-color 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);
    :hover,
    :focus {
      border-color: ${q};
    }

    .date-label-content {
      color: ${a?e.colors.grayscale.light1:e.colors.grayscale.dark1};
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
      flex-shrink: 1;
      white-space: nowrap;
    }

    span[role='img'] {
      margin-left: auto;
      padding-left: ${e.gridUnit}px;

      & > span[role='img'] {
        line-height: 0;
      }
    }
  `}
`,z=(0,n.forwardRef)(((e,t)=>{const a=(0,o.Fg)();return(0,r.tZ)(H,k()({},e,{tabIndex:0}),(0,r.tZ)("span",{className:"date-label-content",ref:t},e.label),(0,r.tZ)(h.Z.CalendarOutlined,{iconSize:"s",iconColor:a.colors.grayscale.base}))})),j=(0,o.iK)(m.Z)`
  width: 272px;
`,B=o.iK.div`
  ${({theme:e})=>r.iv`
    .ant-row {
      margin-top: 8px;
    }

    .ant-input-number {
      width: 100%;
    }

    .ant-picker {
      padding: 4px 17px 4px;
      border-radius: 4px;
      width: 100%;
    }

    .ant-divider-horizontal {
      margin: 16px 0;
    }

    .control-label {
      font-size: 11px;
      font-weight: ${e.typography.weights.medium};
      color: ${e.colors.grayscale.light2};
      line-height: 16px;
      text-transform: uppercase;
      margin: 8px 0;
    }

    .vertical-radio {
      display: block;
      height: 40px;
      line-height: 40px;
    }

    .section-title {
      font-style: normal;
      font-weight: ${e.typography.weights.bold};
      font-size: 15px;
      line-height: 24px;
      margin-bottom: 8px;
    }

    .control-anchor-to {
      margin-top: 16px;
    }

    .control-anchor-to-datetime {
      width: 217px;
    }

    .footer {
      text-align: right;
    }
  `}
`,G=o.iK.span`
  span {
    margin-right: ${({theme:e})=>2*e.gridUnit}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
  .error {
    color: ${({theme:e})=>e.colors.error.base};
  }
`,W=(e,t,a)=>e?(0,r.tZ)("div",null,t&&(0,r.tZ)("strong",null,t),a&&(0,r.tZ)("div",{css:e=>r.iv`
            margin-top: ${e.gridUnit}px;
          `},a)):a||null;function Y(e){var t,a;const{onChange:m,onOpenPopover:T=y.EI,onClosePopover:S=y.EI,isOverflowingFilterBar:w=!1,formData:A}=e,R=(0,_.Ct)(),D=null!=(t=e.value)?t:R,[O,N]=(0,n.useState)(D),[M,L]=(0,n.useState)(!1),k=(0,n.useMemo)((()=>(0,_.X0)(D)),[D]),[F,P]=(0,n.useState)(k),[$,U]=(0,n.useState)(D),[q,H]=(0,n.useState)(D),[Y,K]=(0,n.useState)(!1),[Q,J]=(0,n.useState)(D),[X,ee]=(0,n.useState)(D),te=(0,o.Fg)(),[ae,ne]=(0,b.cB)();function oe(){H(D),P(k),L(!1),S()}(0,n.useEffect)((()=>{if(D===i.vM)return N(i.vM),ee(null),K(!0),void H(i.vM);(0,_.z1)(D).then((({value:e,error:t,timeRes:a})=>{if(a){const e=`${(null==a?void 0:a.since)||""}${_.UD}${a.until||""}`;H(e)}t?(J(t||""),K(!1),ee(D||null)):("Common"===k||"Calendar"===k||"No filter"===k?(N(D),ee(W(ne,D,e))):(N(e||""),ee(W(ne,e,D))),K(!0)),U(D),J(e||D)}))}),[k,ne,ae,D]),(0,f.bX)((()=>{if(q===i.vM)return J(i.vM),U(i.vM),void K(!0);$!==q&&(0,_.z1)(q).then((({value:e,error:t,timeRes:a})=>{if(a){const e=`${(null==a?void 0:a.since)||""}${_.UD}${a.until||""}`;H(e)}t?(J(t||""),K(!1)):(J(e||""),K(!0)),U(q)}))}),v.M$,[q]);const re=()=>{M?oe():(H(D),P(k),L(!0),T())};const ie=(0,r.tZ)(B,null,(0,r.tZ)("div",{className:"control-label"},(0,l.t)("RANGE TYPE")),(0,r.tZ)(j,{ariaLabel:(0,l.t)("RANGE TYPE"),options:_.un,value:F,onChange:function(e){e===i.vM&&H(i.vM),P(e)}}),"No filter"!==F&&(0,r.tZ)(p.iz,null),"Common"===F&&(0,r.tZ)(Z,{value:q,onChange:H}),"Calendar"===F&&(0,r.tZ)(x,{value:q,onChange:H}),"Advanced"===F&&(0,r.tZ)(V,{value:q,onChange:H}),"Custom"===F&&(0,r.tZ)(I,{value:q,onChange:H}),"No filter"===F&&(0,r.tZ)("div",{"data-test":_.Db.noFilter}),(0,r.tZ)(p.iz,null),(0,r.tZ)("div",null,(0,r.tZ)("div",{className:"section-title"},(0,l.t)("Actual time range")),Y&&(0,r.tZ)("div",null,Q),!Y&&(0,r.tZ)(G,{className:"warning"},(0,r.tZ)(h.Z.ErrorSolidSmall,{iconColor:te.colors.error.base}),(0,r.tZ)("span",{className:"text error"},Q))),(0,r.tZ)(p.iz,null),(0,r.tZ)("div",{className:"footer"},(0,r.tZ)(c.Z,{buttonStyle:"secondary",cta:!0,key:"cancel",onClick:oe,"data-test":_.Db.cancelButton},(0,l.t)("CANCEL")),(0,r.tZ)(c.Z,{buttonStyle:"primary",cta:!0,disabled:!Y,key:"apply",onClick:function(){m(q),L(!1),S()},"data-test":_.Db.applyButton},(0,l.t)("APPLY")))),le=(0,r.tZ)(G,null,(0,r.tZ)(h.Z.EditAlt,{iconColor:te.colors.grayscale.base}),(0,r.tZ)("span",{className:"text"},(0,l.t)("Edit time range")));(0,r.tZ)(E.Z,{placement:"right",trigger:"click",content:ie,title:le,defaultVisible:M,visible:M,onVisibleChange:re,overlayStyle:{width:"600px"},getPopupContainer:e=>w?e.parentNode:document.body,destroyTooltipOnHide:!0},(0,r.tZ)(g.u,{placement:"top",title:X},(0,r.tZ)(z,{label:O,isActive:M,isPlaceholder:O===i.vM,"data-test":_.Db.popoverOverlay,ref:ae}))),(0,r.tZ)(n.Fragment,null,(0,r.tZ)(g.u,{placement:"top",title:X},(0,r.tZ)(z,{onClick:re,label:O,isActive:M,isPlaceholder:O===i.vM,"data-test":_.Db.modalOverlay,ref:ae})),(0,r.tZ)(d.Z,{title:le,show:M,onHide:re,width:"600px",hideFooter:!0,zIndex:1030},ie));let se=null==A?void 0:A.timeGranularity;const ce=null==A||null==(a=A.extraFormData)?void 0:a.time_grain_sqla;if(ce){const e=null==s.c?void 0:s.c[ce];se="day"===e?"date":e}return(0,r.tZ)(n.Fragment,null,(0,r.tZ)(u.Z,e),(0,r.tZ)(C.Z,{value:q,valueFormat:_.KZ,formData:A,picker:se,onChange:e=>{const[t,a]=e;let n=i.vM;t&&a&&(n=`${t}${_.UD}${a}`),H(n),m(n)}}))}},101090:(e,t,a)=>{a.d(t,{ZP:()=>n.Z,z1:()=>o.z1});var n=a(374092),o=a(561314)},831209:(e,t,a)=>{a.d(t,{MZ:()=>o,gT:()=>n,po:()=>r});const n="previous calendar week",o="previous calendar month",r="previous calendar year"},561314:(e,t,a)=>{a.d(t,{_S:()=>E,LY:()=>D,gn:()=>T,Sm:()=>_,bk:()=>R,MI:()=>C,Db:()=>L,un:()=>b,ZU:()=>I,V7:()=>M,KZ:()=>O,UD:()=>d,kj:()=>S,_d:()=>w,Ae:()=>x,hj:()=>A,c_:()=>G,jK:()=>W,DL:()=>j,z1:()=>g,X0:()=>m,Ct:()=>f});var n=a(730381),o=a.n(n),r=a(115926),i=a.n(r),l=a(5364),s=a(431069),c=a(998286),u=a(828216);const d=" : ",p=(e,t)=>e.replace("T00:00:00","")||(t?"-\u221e":"\u221e"),h=(e,t="col")=>{const a=e.split(d);return 1===a.length?e:`${p(a[0],!0)} \u2264 ${t} < ${p(a[1])}`},m=e=>C.has(e)?"Common":T.has(e)?"Calendar":e===l.vM?"No filter":G(e).matchedFlag?"Custom":"Advanced",g=async(e,t="col")=>{const a=`/api/v1/time_range/?q=${i().encode_uri(e)}`;try{var n,o,r,l,u;const e=await s.Z.get({endpoint:a}),i=(p=(null==e||null==(n=e.json)||null==(o=n.result)?void 0:o.since)||"",m=(null==e||null==(r=e.json)||null==(l=r.result)?void 0:l.until)||"",`${p}${d}${m}`);return{value:t?h(i,t):i,timeRes:null==e||null==(u=e.json)?void 0:u.result}}catch(e){const t=await(0,c.O$)(e);return{error:t.message||t.error||e.statusText}}var p,m};function f(){var e;return null!=(e=(0,u.v9)((e=>{var t,a;return null==e||null==(t=e.common)||null==(a=t.conf)?void 0:a.DEFAULT_TIME_FILTER})))?e:l.vM}var v=a(455867),y=a(831209);const b=[{value:"Common",label:(0,v.t)("Last Time")},{value:"Calendar",label:(0,v.t)("Previous")},{value:"Custom",label:(0,v.t)("Custom")},{value:"Advanced",label:(0,v.t)("Advanced")},{value:"No filter",label:(0,v.t)("No filter")}],_=[{value:"Last day",label:(0,v.t)("last day")},{value:"Last week",label:(0,v.t)("last week")},{value:"Last month",label:(0,v.t)("last month")},{value:"Last quarter",label:(0,v.t)("last quarter")},{value:"Last year",label:(0,v.t)("last year")}],C=new Set(_.map((({value:e})=>e))),E=[{value:y.gT,label:(0,v.t)("previous calendar week")},{value:y.MZ,label:(0,v.t)("previous calendar month")},{value:y.po,label:(0,v.t)("previous calendar year")}],T=new Set(E.map((({value:e})=>e))),Z=[{value:"second",label:e=>(0,v.t)("Seconds %s",e)},{value:"minute",label:e=>(0,v.t)("Minutes %s",e)},{value:"hour",label:e=>(0,v.t)("Hours %s",e)},{value:"day",label:e=>(0,v.t)("Days %s",e)},{value:"week",label:e=>(0,v.t)("Weeks %s",e)},{value:"month",label:e=>(0,v.t)("Months %s",e)},{value:"quarter",label:e=>(0,v.t)("Quarters %s",e)},{value:"year",label:e=>(0,v.t)("Years %s",e)}],S=Z.map((e=>({value:e.value,label:e.label((0,v.t)("Before"))}))),x=Z.map((e=>({value:e.value,label:e.label((0,v.t)("After"))}))),w=[{value:"specific",label:(0,v.t)("Specific Date/Time")},{value:"relative",label:(0,v.t)("Relative Date/Time")},{value:"now",label:(0,v.t)("Now")},{value:"today",label:(0,v.t)("Midnight")}],A=w.slice(),R=new Set(["Last day","Last week","Last month","Last quarter","Last year"]),D=new Set([y.gT,y.MZ,y.po]),O="YYYY-MM-DD[T]HH:mm:ss",N=o()().utc().startOf("day").subtract(7,"days").format(O),M=o()().utc().startOf("day").format(O),I={en:"en_US",fr:"fr_FR",es:"es_ES",it:"it_IT",zh:"zh_CN",ja:"ja_JP",de:"de_DE",pt:"pt_PT",pt_BR:"pt_BR",ru:"ru_RU",ko:"ko_KR",sk:"sk_SK",sl:"sl_SI",nl:"nl_NL"};var L;!function(e){e.commonFrame="common-frame",e.modalOverlay="modal-overlay",e.popoverOverlay="time-range-trigger",e.noFilter="no-filter",e.cancelButton="cancel-button",e.applyButton="date-filter-control__apply-button"}(L||(L={}));const k=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,F=String.raw`(?:TODAY|NOW)`,P=String.raw`[+-]?[1-9][0-9]*`,$=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,U=RegExp(String.raw`^DATEADD\(DATETIME\("(${k}|${F})"\),\s(${P}),\s(${$})\)$`,"i"),V=RegExp(String.raw`^${k}$|^${F}$`,"i"),q=["now","today"],H={sinceDatetime:N,sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:M,untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},z=["specific","today","now"],j=e=>"now"===e?o()().utc().startOf("second"):"today"===e?o()().utc().startOf("day"):o()(e),B=e=>j(e).format(O),G=e=>{const t=e.split(d);if(2===t.length){const[e,a]=t;if(V.test(e)&&V.test(a)){const t=q.includes(e)?e:"specific",n=q.includes(a)?a:"specific";return{customRange:{...H,sinceDatetime:e,untilDatetime:a,sinceMode:t,untilMode:n},matchedFlag:!0}}const n=e.match(U);if(n&&V.test(a)&&e.includes(a)){const[e,t,o]=n.slice(1),r=q.includes(a)?a:"specific";return{customRange:{...H,sinceGrain:o,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:r},matchedFlag:!0}}const o=a.match(U);if(V.test(e)&&o&&a.includes(e)){const[t,a,n]=[...o.slice(1)],r=q.includes(e)?e:"specific";return{customRange:{...H,untilGrain:n,untilGrainValue:parseInt(a,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:r},matchedFlag:!0}}if(n&&o){const[e,t,a]=[...n.slice(1)],[r,i,l]=[...o.slice(1)];if(e===r)return{customRange:{...H,sinceGrain:a,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(i,10),untilDatetime:r,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:H,matchedFlag:!1}},W=e=>{const{sinceDatetime:t,sinceMode:a,sinceGrain:n,sinceGrainValue:o,untilDatetime:r,untilMode:i,untilGrain:l,untilGrainValue:s,anchorValue:c}={...e};if(z.includes(a)&&z.includes(i)){return`${"specific"===a?B(t):a} : ${"specific"===i?B(r):i}`}if(z.includes(a)&&"relative"===i){const e="specific"===a?B(t):a;return`${e} : ${`DATEADD(DATETIME("${e}"), ${s}, ${l})`}`}if("relative"===a&&z.includes(i)){const e="specific"===i?B(r):i;return`${`DATEADD(DATETIME("${e}"), ${-Math.abs(o)}, ${n})`} : ${e}`}return`${`DATEADD(DATETIME("${c}"), ${-Math.abs(o)}, ${n})`} : ${`DATEADD(DATETIME("${c}"), ${s}, ${l})`}`}},96055:(e,t,a)=>{a.d(t,{Z:()=>te});var n=a(667294),o=a(205872),r=a.n(o),i=a(45697),l=a.n(i),s=a(835932),c=a(751995),u=a(455867),d=a(957902),p=a(171262),h=a(717536),m=a(328543),g=a(804591),f=a(49937),v=a(237731),y=a(111146),b=a(431069),_=a(269856),C=a(940266),E=a(358593),T=a(9875),Z=a(454076),S=a(591877),x=a(593185),w=a(945211),A=a(23279),R=a.n(A),D=a(355786),O=a(115926),N=a.n(O);const M={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""},I=e=>{const[t,a]=(0,n.useState)(M),[o,r]=(0,n.useState)(),i=(0,n.useCallback)(((t,n,o)=>{const r=(0,D.Z)(t);o?R()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${N().encode({type:o,values:r})}`;b.Z.get({endpoint:t}).then((({json:t})=>{a({parsedAdvancedDataType:t.result.display_value,advancedDataTypeOperatorList:t.result.valid_filter_operators,errorMessage:t.result.error_message}),e(!t.result.error_message)})).catch((()=>{a({parsedAdvancedDataType:"",advancedDataTypeOperatorList:n.advancedDataTypeOperatorList,errorMessage:(0,u.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():a(M)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:o,setAdvancedDataTypesState:a,fetchAdvancedDataTypeValueCallback:i,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?r(t.advanced_data_type):e.validHandler(!0)}}};var L=a(7848),k=a(561314),F=a(211965);const P=(0,c.iK)(T.II)`
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
`,$=((0,c.iK)(g.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,(0,c.iK)(f.Ph)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colors.grayscale.light1};
    width: max-content;
  }
`),U=e=>{var t,a;const{onSubjectChange:o,onOperatorChange:i,isOperatorRelevant:l,onComparatorChange:s,onDatePickerChange:c}=(e=>{const t=(0,k.Ct)(),a=(t,a)=>{var n;const o=null==(n=e.datasource.columns)?void 0:n.find((e=>e.column_name===a)),r=!!o&&("BOOL"===o.type||"BOOLEAN"===o.type),i=!!o&&("INT"===o.type||"INTEGER"===o.type),l=!!o&&!!o.expression;if(t&&t===_.d.LATEST_PARTITION){const{partitionColumn:t}=e;return t&&a&&a===t}return(!t||t!==_.d.TEMPORAL_RANGE)&&(t===_.d.IS_TRUE||t===_.d.IS_FALSE?r||i||l:r?t===_.d.IS_NULL||t===_.d.IS_NOT_NULL:e.adhocFilter.clause!==m.Pr.HAVING||-1!==_.Ak.indexOf(t))};return{onSubjectChange:(n,o)=>{const r=e.options.find((e=>"column_name"in e&&e.column_name===n||"optionName"in e&&e.optionName===n));let i,l="";r&&"column_name"in r?(l=r.column_name,i=m.Pr.WHERE):r&&"saved_metric_name"in r?(l=r.saved_metric_name,i=m.Pr.HAVING):null!=r&&r.label&&(l=r.label,i=m.Pr.HAVING);let{operator:s,operatorId:c,comparator:u}=e.adhocFilter;s=s&&c&&a(c,l)?_.LT[c].operation:null,(0,v.Z)(s)||(s=_.d.IN,c=_.d.IN,u=void 0),y.O6&&(0,w.x)(n,e.datasource)&&(l=n,s=_.d.TEMPORAL_RANGE,c=_.d.TEMPORAL_RANGE,u=t),e.onChange(e.adhocFilter.duplicateWith({dropdown:o,subject:l,clause:i,operator:s,expressionType:m.vq.SIMPLE,operatorId:c,comparator:u}))},onOperatorChange:t=>{const a=e.adhocFilter.comparator;let n;n=_.qK.has(t)?Array.isArray(a)?a:[a].filter((e=>e)):Array.isArray(a)?a[0]:a,t!==_.d.IS_TRUE&&t!==_.d.IS_FALSE||(n=_.d.IS_TRUE===t),t&&_.qB.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:m.Pr.WHERE,operatorId:t,operator:_.LT[t].operation,expressionType:m.vq.SQL,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:_.LT[t].operation,comparator:n,expressionType:m.vq.SIMPLE}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:m.vq.SIMPLE}))},isOperatorRelevant:a,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,a)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:_.d.TEMPORAL_RANGE,comparator:a,expressionType:m.vq.SIMPLE}))}}})(e),{keyName:d}=e,[p,h]=(0,n.useState)([]),[g,T]=(0,n.useState)(e.adhocFilter.comparator),[A,R]=(0,n.useState)(!1),D=n.useRef(null),{advancedDataTypesState:O,subjectAdvancedDataType:N,fetchAdvancedDataTypeValueCallback:M,fetchSubjectAdvancedDataType:U}=I(e.validHandler),V=(e,t)=>N?l(e,t)&&O.advancedDataTypeOperatorList.includes(e):l(e,t),q=()=>{const e=(()=>{var e;const t=Array.isArray(g)?g.filter((e=>p.includes(e))).length:0;return null!=(e=(null==p?void 0:p.length)-t)?e:0})(),t=(0,u.t)("%s option(s)",e);return e?t:""},H=t=>{const{datasource:{id:a,type:n}}=e,r={datasource:{id:a,type:n},queries:[{extras:{having:"",where:""},metrics:[],columns:[t],orderby:[[t,!0]],order_desc:!0}],force:!1,result_format:"json",result_type:"full"};R(!0),b.Z.post({endpoint:"api/v1/chart/data",jsonPayload:r}).then((({json:e})=>{var a,n,r;const i=null!=(a=e.result)&&a.length&&null!=(n=null==(r=e.result[0])?void 0:r.data)?n:[],l=(i.length?Array.from(i,(e=>Object.values(e)[0])):[]).map((e=>({value:e,label:(0,Z.lo)(e)})));o(t,l),h(l),R(!1)})).catch((()=>{h([]),R(!1)}))};let z=e.options;const{subject:j,operator:B,operatorId:G,dropdown:W}=e.adhocFilter;(0,n.useEffect)((()=>{j&&H(j)}),[j]);const Y={ariaLabel:(0,u.t)("Select subject"),value:null!=j?j:void 0,onChange:e=>{T(void 0)},onSelect:H,notFoundContent:(0,u.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!j,placeholder:""};Y.placeholder=e.adhocFilter.clause===m.Pr.WHERE?(0,u.t)("%s column(s)",z.length):(0,u.t)("To filter on a metric, use Custom SQL tab."),z=e.options.filter((e=>"column_name"in e&&e.column_name));const K={placeholder:(0,u.t)("%s operator(s)",(null!=(t=e.operators)?t:_.GS).filter((e=>V(e,j))).length),value:G,onChange:i,autoFocus:!!Y.value&&!B,ariaLabel:(0,u.t)("Select operator")},Q=!!Y.value&&!!K.value,J={ref:D,allowClear:!0,allowNewOptions:!1,ariaLabel:(0,u.t)("Comparator option"),mode:_.GE.has(G)?"multiple":"single",loading:A,value:e.adhocFilter.comparator,onChange:s,onSearch:e=>{if(e){const t=W.slice(),a=[];for(let n=0;n<t.length;n++){const o=t[n],r=`${e}`.toUpperCase(),i=`${o.label}`.toUpperCase();r.length<=i.toUpperCase().length?-1!==i.indexOf(r)&&a.push(o):-1!==r.indexOf(i)&&a.push(o)}h(a)}},onBlur:()=>h(W),notFoundContent:(0,u.t)("Type a value here"),disabled:_.yi.includes(G),placeholder:q(),autoFocus:!1},X=g&&g.length>0&&q(),ee=(0,L.v)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===_.d.TEMPORAL_RANGE?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:c});(0,n.useEffect)((()=>{ee||(()=>{const{datasource:t}=e,a=e.adhocFilter.subject,n=e.adhocFilter.clause===m.Pr.HAVING;if(a&&t&&t.filter_select&&!n){const e=new AbortController,{signal:n}=e;A&&e.abort(),R(!0),b.Z.get({signal:n,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${a}/values/`}).then((({json:e})=>{h(e.result.map((e=>({value:e,label:(0,Z.lo)(e)})))),R(!1)})).catch((()=>{h([]),R(!1)}))}})()}),[e.adhocFilter.subject]),(0,n.useEffect)((()=>{(0,S.cr)(x.T.ENABLE_ADVANCED_DATA_TYPES)&&U(e)}),[e.adhocFilter.subject]),(0,n.useEffect)((()=>{(0,S.cr)(x.T.ENABLE_ADVANCED_DATA_TYPES)&&M(void 0===g?"":g,O,N)}),[g,N,M]),(0,n.useEffect)((()=>{(0,S.cr)(x.T.ENABLE_ADVANCED_DATA_TYPES)&&T(e.adhocFilter.comparator)}),[JSON.stringify(e.adhocFilter.comparator)]);const te="manualsetting"===d?{width:300}:{},ae=(0,F.tZ)(f.Ph,r()({css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),style:te,"data-test":"select-element",options:z.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,F.tZ)(C.Z,{option:t}))};var t}))},Y));(0,n.useEffect)((()=>{null!=W&&W.length&&h(W)}),[JSON.stringify(W)]);const ne=(0,F.tZ)(n.Fragment,null,(0,F.tZ)(f.Ph,r()({css:e=>({marginBottom:4*e.gridUnit}),style:"manualsetting"===d?{display:"none"}:{},options:(null!=(a=e.operators)?a:_.GS).filter((e=>V(e,j))).map(((e,t)=>({value:e,label:_.LT[e].display,key:e,order:t})))},K)),_.qK.has(G)||p.length>0?(0,F.tZ)(E.u,{title:O.errorMessage||O.parsedAdvancedDataType},(0,F.tZ)($,r()({style:te,labelText:X,options:p},J))):(0,F.tZ)(E.u,{title:O.errorMessage||O.parsedAdvancedDataType},(0,F.tZ)(P,{"data-test":"adhoc-filter-simple-value",name:"filter-value",ref:e=>{e&&Q&&e.focus()},onChange:e=>{const{value:t}=e.target;T(t),s(t)},value:g,placeholder:(0,u.t)("Filter value (case sensitive)"),disabled:_.yi.includes(G)})));return(0,F.tZ)(n.Fragment,null,ae,null!=ee?ee:ne)};var V=a(794670),q=a(233313),H=a(372201);const z={adhocFilter:l().instanceOf(m.ZP).isRequired,onChange:l().func.isRequired,options:l().arrayOf(l().oneOfType([H.Z,l().shape({saved_metric_name:l().string.isRequired}),h.Z])).isRequired,height:l().number.isRequired,activeKey:l().string.isRequired},j=(0,c.iK)(f.Ph)`
  ${({theme:e})=>`\n    width: ${30*e.gridUnit}px;\n    marginRight: ${e.gridUnit}px;\n  `}
`;class B extends n.Component{constructor(e){super(e),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onSqlExpressionClauseChange=this.onSqlExpressionClauseChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.selectProps={ariaLabel:(0,u.t)("Select column")}}componentDidUpdate(){this.aceEditorRef&&this.aceEditorRef.editor.resize()}onSqlExpressionClauseChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e,expressionType:m.vq.SQL}))}onSqlExpressionChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:m.vq.SQL}))}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}render(){const{adhocFilter:e,height:t,options:a}=this.props,n={placeholder:(0,u.t)("choose WHERE or HAVING..."),value:e.clause,onChange:this.onSqlExpressionClauseChange},o=q.Z.concat(a.map((e=>e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null)).filter(Boolean)),i=Object.keys(m.Pr).map((e=>({label:e,value:e})));return(0,F.tZ)("span",null,(0,F.tZ)("div",{className:"filter-edit-clause-section"},(0,F.tZ)(j,r()({options:i},this.selectProps,n)),(0,F.tZ)("span",{className:"filter-edit-clause-info"},(0,F.tZ)("strong",null,"WHERE")," ",(0,u.t)("Filters by columns"),(0,F.tZ)("br",null),(0,F.tZ)("strong",null,"HAVING")," ",(0,u.t)("Filters by metrics"))),(0,F.tZ)("div",{css:e=>({marginTop:4*e.gridUnit})},(0,F.tZ)(V.iO,{ref:this.handleAceEditorRef,keywords:o,height:t-130+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})))}}B.propTypes=z;const G={adhocFilter:l().instanceOf(m.ZP).isRequired,onChange:l().func.isRequired,onClose:l().func.isRequired,onResize:l().func.isRequired,options:l().arrayOf(l().oneOfType([H.Z,l().shape({saved_metric_name:l().string.isRequired}),h.Z])).isRequired,datasource:l().object,partitionColumn:l().string,theme:l().object,sections:l().arrayOf(l().string),operators:l().arrayOf(l().string),requireSave:l().bool},W=c.iK.i`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Y=c.iK.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.gridUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.typography.sizes.xs}px;
    padding-left: ${({theme:e})=>e.gridUnit}px;
  }

  .filter-edit-clause-section {
    display: inline-flex;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.gridUnit}px;
  }
`,K=c.iK.div`
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`;class Q extends n.Component{constructor(e){var t,a;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:_.kc,height:_.H7,activeKey:(null==(t=this.props)||null==(a=t.adhocFilter)?void 0:a.expressionType)||"SIMPLE",isSimpleTabValid:!0},this.popoverContentRef=n.createRef()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),_.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),_.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:a,onClose:n,onResize:o,datasource:i,partitionColumn:l,theme:c,operators:h,requireSave:g,keyName:f,...v}=this.props,{adhocFilter:y}=this.state,b=y.isValid(),_=g||!y.equals(e);return(0,F.tZ)(Y,r()({id:"filter-edit-popover"},v,{"data-test":"filter-edit-popover",ref:this.popoverContentRef}),"manualsetting"===f?(0,F.tZ)(d.Z,null,(0,F.tZ)(U,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:l,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid,keyName:f})):(0,F.tZ)(p.ZP,{id:"adhoc-filter-edit-tabs",defaultActiveKey:y.expressionType,className:"adhoc-filter-edit-tabs","data-test":"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange},(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:m.vq.SIMPLE,tab:(0,u.t)("Simple")},(0,F.tZ)(d.Z,null,(0,F.tZ)(U,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:l,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid}))),(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:m.vq.SQL,tab:(0,u.t)("Custom SQL")},(0,F.tZ)(d.Z,null,(0,F.tZ)(B,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})))),(0,F.tZ)(K,null,(0,F.tZ)(s.Z,{buttonSize:"small",onClick:this.props.onClose,cta:!0},(0,u.t)("Close")),(0,F.tZ)(s.Z,{"data-test":"adhoc-filter-edit-popover-save-button",disabled:!b||!this.state.isSimpleTabValid||!_,buttonStyle:"primary",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0},(0,u.t)("Save")),(0,F.tZ)(W,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}Q.propTypes=G;var J=a(563325),X=a(927845);class ee extends n.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{keyName:a}=this.props,{visible:n,togglePopover:o,closePopover:r}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},i=(0,F.tZ)(J.b,null,(0,F.tZ)(Q,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:r,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave,keyName:a}));return(0,F.tZ)(X.Z,{trigger:"click",content:i,defaultVisible:n,visible:n,onVisibleChange:o,destroyTooltipOnHide:!0},this.props.children)}}const te=ee},7848:(e,t,a)=>{a.d(t,{v:()=>g,w:()=>s});var n=a(667294),o=a(5364),r=a(101090),i=a(269856),l=a(328543);const s=e=>{const[t,a]=(0,n.useState)({});return(0,n.useEffect)((()=>{e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===l.vq.SIMPLE||a({}),e.operator===i.d.TEMPORAL_RANGE&&e.comparator===o.vM&&a({actualTimeRange:`${e.subject} (${o.vM})`,title:o.vM}),e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===l.vq.SIMPLE&&e.comparator!==o.vM&&t.title!==e.comparator&&(0,r.z1)(e.comparator,e.subject).then((({value:t,error:n})=>{a(n?{actualTimeRange:`${e.subject} (${e.comparator})`,title:n}:{actualTimeRange:null!=t?t:"",title:e.comparator})}))}),[e]),t};var c=a(111146),u=a(455867),d=a(945211),p=a(374092),h=a(482342),m=a(211965);const g=({columnName:e,timeRange:t,datasource:a,onChange:o})=>c.O6&&(0,d.x)(e,a)?(0,m.tZ)(n.Fragment,null,(0,m.tZ)(h.Z,{label:(0,u.t)("Time Range")}),(0,m.tZ)(p.Z,{value:t,name:"time_range",onChange:t=>o(e,t),overlayStyle:"Modal"})):void 0},427478:(e,t,a)=>{a.d(t,{EQ:()=>f,H$:()=>Z,IG:()=>x,Ne:()=>b,SW:()=>S,__:()=>v,a7:()=>g,gM:()=>E,gu:()=>_,yj:()=>T,yz:()=>w});var n=a(205872),o=a.n(n),r=a(667294),i=a(822068),l=a(727034),s=a(751995),c=a(455867),u=a(409882),d=a(358593),p=a(731293),h=a(699963),m=a(211965);const g=s.iK.div`
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,f=s.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  height: ${({theme:e})=>6*e.gridUnit}px;
  background-color: ${({theme:e})=>e.colors.grayscale.light3};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
`,v=s.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.gridUnit}px;\n    svg {\n      margin-right: ${e.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.gridUnit}px;\n      margin-left: ${e.gridUnit}px;\n      font-weight: ${e.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,y=s.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,b=s.iK.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  margin-left: auto;
`,_=s.iK.div`
  height: 100%;
  width: ${({theme:e})=>6*e.gridUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  cursor: pointer;
`,C=(0,s.iK)(u.V)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`,E=s.iK.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,T=s.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: solid 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,Z=s.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: ${({canDrop:e,isOver:t,theme:a})=>e?`dashed 1px ${a.colors.info.dark1}`:t&&!e?`dashed 1px ${a.colors.error.dark1}`:`solid 1px ${a.colors.grayscale.light2}`};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,S=s.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
  border: dashed 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light4};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light3};
  }
`,x=s.iK.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.gridUnit}px;
  width: ${({theme:e})=>4*e.gridUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colors.primary.dark1};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,w=({label:e,savedMetric:t,adhocMetric:a,onRemove:n,onMoveLabel:u,onDropLabel:E,withCaret:T,isFunction:Z,type:S,index:x,isExtra:w,datasourceWarningMessage:A,tooltipTitle:R,multi:D=!0,...O})=>{const N=(0,s.Fg)(),M=(0,r.useRef)(null),I=(0,r.useRef)(null),L=null==t?void 0:t.metric_name,[,k]=(0,i.L)({accept:S,drop(){D&&(null==E||E())},hover(e,t){var a;if(!D)return;if(!M.current)return;const n=e.index,o=x;if(n===o)return;const r=null==(a=M.current)?void 0:a.getBoundingClientRect(),i=(r.bottom-r.top)/2,l=t.getClientOffset(),s=null!=l&&l.y?(null==l?void 0:l.y)-r.top:0;n<o&&s<i||n>o&&s>i||(null==u||u(n,o),e.index=o)}}),[{isDragging:F},P]=(0,l.c)({item:{type:S,index:x,value:null!=t&&t.metric_name?t:a},collect:e=>({isDragging:e.isDragging()})});return P(k(M)),(0,m.tZ)(g,{ref:M},(0,m.tZ)(f,o()({withCaret:T,"data-test":"option-label"},O),(0,m.tZ)(_,{role:"button","data-test":"remove-control-button",onClick:n},(0,m.tZ)(p.Z.XSmall,{iconColor:N.colors.grayscale.light1})),(0,m.tZ)(v,{"data-test":"control-label"},Z&&(0,m.tZ)(p.Z.FieldDerived,null),(()=>{const a=!F&&"string"===typeof e&&R&&e&&R!==e||!F&&I&&I.current&&I.current.scrollWidth>I.current.clientWidth;return t&&L?(0,m.tZ)(h.B,{metric:t,labelRef:I,shouldShowTooltip:!F}):a?(0,m.tZ)(d.u,{title:R||e},(0,m.tZ)(y,{ref:I},e)):(0,m.tZ)(y,{ref:I},e)})()),(!!A||w)&&(0,m.tZ)(C,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:A||(0,c.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),T&&(0,m.tZ)(b,null,(0,m.tZ)(p.Z.CaretRight,{iconColor:N.colors.grayscale.light1}))))}},979684:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(667294),o=a(799298),r=a(375294),i=a(23279),l=a.n(i),s=a(427600),c=a(482342),u=a(9875),d=a(211965);const p=e=>null==e?"":String(e);class h extends n.Component{constructor(e){super(e),this.initialValue=void 0,this.onChange=e=>{var t,a;let n=e;const i=[];if(""!==e&&this.props.isFloat){const t=(0,o.Z)(e);t?i.push(t):n=e.match(/.*([.0])$/g)?e:parseFloat(e)}if(""!==e&&this.props.isInt){const t=(0,r.Z)(e);t?i.push(t):n=parseInt(e,10)}null==(t=(a=this.props).onChange)||t.call(a,n,i)},this.debouncedOnChange=l()((e=>{this.onChange(e)}),s.oP),this.onChangeWrapper=e=>{const{value:t}=e.target;this.setState({value:t},(()=>{this.debouncedOnChange(t)}))},this.initialValue=e.value,this.state={value:p(this.initialValue)}}render(){let{value:e}=this.state;return this.initialValue!==this.props.value&&(this.initialValue=this.props.value,e=p(this.props.value)),(0,d.tZ)("div",null,(0,d.tZ)(c.Z,this.props),(0,d.tZ)(u.II,{type:"text","data-test":"inline-name",placeholder:this.props.placeholder,onChange:this.onChangeWrapper,onFocus:this.props.onFocus,value:e,disabled:this.props.disabled,"aria-label":this.props.label}))}}},985626:(e,t,a)=>{a.d(t,{Z:()=>v});a(667294);var n=a(751995),o=a(252655),r=a(242110),i=a(600120),l=a(313433),s=a(550909),c=a(453459),u=a(849889),d=a(833743),p=a(622489),h=a(211965);const m=(0,n.iK)(s.qi)`
  && {
    margin: 0 0 ${({theme:e})=>e.gridUnit}px;
  }
`;r.Z.registerLanguage("markdown",c.Z),r.Z.registerLanguage("html",u.Z),r.Z.registerLanguage("sql",d.Z),r.Z.registerLanguage("json",p.Z);const g=n.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,f=(0,n.iK)(r.Z)`
  flex: 1;
`,v=e=>{const{sql:t,language:a="sql"}=e;return(0,h.tZ)(g,{key:t},(0,h.tZ)(l.Z,{text:t,shouldShowText:!1,copyNode:(0,h.tZ)(m,{buttonSize:"xsmall"},(0,h.tZ)(o.default,null))}),(0,h.tZ)(f,{language:a,style:i.Z},t))}},13284:(e,t,a)=>{a.d(t,{UB:()=>Z,ZP:()=>Q});var n,o=a(205872),r=a.n(o),i=a(667294),l=a(374221),s=a(294184),c=a.n(s),u=a(455867),d=a(751995),p=a(211965),h=a(616355),m=a(49937),g=a(358593),f=a(9875),v=a(737921),y=a(514278),b=a(731293),_=a(301510),C=a(364239);!function(e){e.ALL_CHARTS="ALL_CHARTS",e.CATEGORY="CATEGORY",e.TAGS="TAGS",e.RECOMMENDED_TAGS="RECOMMENDED_TAGS"}(n||(n={}));const E=["line","big_number","big_number_total","table","pivot_table_v2","echarts_timeseries_line","echarts_area","echarts_timeseries_bar","echarts_timeseries_scatter","pie","mixed_timeseries","filter_box","dist_bar","area","bar","deck_polygon","time_table","histogram","deck_scatter","deck_hex","time_pivot","deck_arc","heatmap","deck_grid","dual_line","deck_screengrid","line_multi","treemap","box_plot","sunburst","sankey","word_cloud","mapbox","kepler","cal_heatmap","rose","bubble","deck_geojson","horizon","deck_multi","compare","partition","event_flow","deck_path","graph_chart","world_map","paired_ttest","para","country_map"],T=new Set(E),Z=1090,S=(0,u.t)("Other"),x=(0,u.t)("All charts"),w=[(0,u.t)("Popular"),(0,u.t)("ECharts"),(0,u.t)("Advanced-Analytics")],A="viz-type-control",R=d.iK.div`
  ${({isSelectedVizMetadata:e})=>`\n    display: grid;\n    grid-template-rows: ${e?"auto minmax(100px, 1fr) minmax(200px, 35%)":"auto minmax(100px, 1fr)"};\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}
`,D=d.iK.h3`
  margin-top: 0;
  margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.l}px;
  font-weight: ${({theme:e})=>e.typography.weights.bold};
  line-height: ${({theme:e})=>6*e.gridUnit}px;
`,O=d.iK.div`
  grid-area: sidebar;
  display: flex;
  flex-direction: column;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  overflow: auto;

  .ant-collapse .ant-collapse-item {
    .ant-collapse-header {
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
      color: ${({theme:e})=>e.colors.grayscale.base};
      padding-left: ${({theme:e})=>2*e.gridUnit}px;
      padding-bottom: ${({theme:e})=>e.gridUnit}px;
    }
    .ant-collapse-content .ant-collapse-content-box {
      display: flex;
      flex-direction: column;
      padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    }
  }
`,N=d.iK.div`
  grid-area: main;
  overflow-y: auto;
`,M=d.iK.div`
  ${({theme:e})=>`\n    grid-area: search;\n    margin-top: ${3*e.gridUnit}px;\n    margin-bottom: ${e.gridUnit}px;\n    margin-left: ${3*e.gridUnit}px;\n    margin-right: ${3*e.gridUnit}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${2*e.gridUnit}px;\n    }\n  `}
`,I=d.iK.div`
  display: flex;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,L=d.iK.button`
  ${({theme:e})=>`\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${e.gridUnit}px 0;\n    padding: 0 ${e.gridUnit}px;\n    border-radius: ${e.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${e.colors.primary.base};\n      color: ${e.colors.primary.light5};\n\n      svg {\n        color: ${e.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${1.5*e.gridUnit}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}
`,k=d.iK.div`
  overflow: auto;
  display: grid;
  grid-template-columns: repeat(
    auto-fill,
    ${({theme:e})=>24*e.gridUnit}px
  );
  grid-auto-rows: max-content;
  justify-content: space-evenly;
  grid-gap: ${({theme:e})=>2*e.gridUnit}px;
  justify-items: center;
  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,F=e=>p.iv`
  grid-area: details;
  border-top: 1px solid ${e.colors.grayscale.light2};
`,P=e=>p.iv`
  padding: ${4*e.gridUnit}px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto 1fr;
  grid-template-areas:
    'viz-name examples-header'
    'viz-tags examples'
    'description examples';
`,$=d.iK.div`
  grid-area: viz-tags;
  width: ${({theme:e})=>120*e.gridUnit}px;
  padding-right: ${({theme:e})=>14*e.gridUnit}px;
  padding-bottom: ${({theme:e})=>2*e.gridUnit}px;
`,U=d.iK.p`
  grid-area: description;
  overflow: auto;
  padding-right: ${({theme:e})=>14*e.gridUnit}px;
  margin: 0;
`,V=d.iK.div`
  grid-area: examples;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  overflow: auto;
  gap: ${({theme:e})=>4*e.gridUnit}px;

  img {
    height: 100%;
    border-radius: ${({theme:e})=>e.gridUnit}px;
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }
`,q=e=>p.iv`
  cursor: pointer;
  width: ${24*e.gridUnit}px;
  position: relative;

  img {
    min-width: ${24*e.gridUnit}px;
    min-height: ${24*e.gridUnit}px;
    border: 1px solid ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
    transition: border-color ${e.transitionTiming};
  }

  &.selected img {
    border: 2px solid ${e.colors.primary.light2};
  }

  &:hover:not(.selected) img {
    border: 1px solid ${e.colors.grayscale.light1};
  }

  .viztype-label {
    margin-top: ${2*e.gridUnit}px;
    text-align: center;
  }
`,H=d.iK.div`
  ${({theme:e})=>`\n    border: 1px solid ${e.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${e.gridUnit}px;\n    background: ${e.colors.grayscale.light5};\n    line-height: ${2.5*e.gridUnit}px;\n    color: ${e.colors.primary.dark1};\n    font-size: ${e.typography.sizes.s}px;\n    font-weight: ${e.typography.weights.bold};\n    text-align: center;\n    padding: ${.5*e.gridUnit}px ${e.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}
`,z=d.iK.div`
  position: absolute;
  right: ${({theme:e})=>e.gridUnit}px;
  top: ${({theme:e})=>19*e.gridUnit}px;
`,j=d.iK.div`
  display: inline-block !important;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`;function B(e){return T.has(e.key)?E.indexOf(e.key):E.length}const G=({entry:e,selectedViz:t,setSelectedViz:a,onDoubleClick:n})=>{const o=(0,d.Fg)(),{key:r,value:i}=e,l=t===e.key;return(0,p.tZ)("div",{role:"button",css:q(o),tabIndex:0,className:l?"selected":"",onClick:()=>a(r),onDoubleClick:n,"data-test":"viztype-selector-container"},(0,p.tZ)("img",{alt:i.name,width:"100%",className:"viztype-selector "+(l?"selected":""),src:i.thumbnail}),(0,p.tZ)("div",{className:"viztype-label","data-test":`${A}__viztype-label`},i.name),i.label&&(0,p.tZ)(z,null,(0,p.tZ)(H,null,(0,p.tZ)("div",null,(0,u.t)(i.label)))))},W=({vizEntries:e,...t})=>(0,p.tZ)(k,{"data-test":`${A}__viz-row`},e.map((e=>(0,p.tZ)(G,r()({key:e.key},t,{entry:e}))))),Y=({selector:e,sectionId:t,icon:a,isSelected:n,onClick:o,className:r})=>{const l=(0,i.useRef)(null);return(0,i.useEffect)((()=>{n&&queueMicrotask((()=>(0,C.default)(l.current,{behavior:"smooth",scrollMode:"if-needed"})))}),[]),(0,p.tZ)(L,{ref:l,key:e,name:e,className:c()(r,n&&"selected"),onClick:()=>o(e,t)},a,e)},K=(e,t)=>t===e.category||t===S&&null==e.category||(e.tags||[]).indexOf(t)>-1;function Q(e){var t,a;const{selectedViz:o,onChange:r,onDoubleClick:s,className:c}=e,{mountedPluginMetadata:d}=(0,y.gp)(),C=(0,i.useRef)(),[E,T]=(0,i.useState)(""),[Z,L]=(0,i.useState)(!0),k=Z&&!!E,q=o?d[o]:null,z=(0,i.useMemo)((()=>{const e=Object.entries(d).map((([e,t])=>({key:e,value:t}))).filter((({value:e})=>(0,_.X3)(e.behaviors||[])&&!e.deprecated));return e.sort(((e,t)=>B(e)-B(t))),e}),[d]),G=(0,i.useMemo)((()=>{const e={};return z.forEach((t=>{const a=t.value.category||S;e[a]||(e[a]=[]),e[a].push(t)})),e}),[z]),Q=(0,i.useMemo)((()=>Object.keys(G).sort(((e,t)=>e===S?1:t===S?-1:e.localeCompare(t)))),[G]),J=(0,i.useMemo)((()=>{const e={};return z.forEach((t=>{(t.value.tags||[]).forEach((a=>{e[a]||(e[a]=[]),e[a].push(t)}))})),e}),[z]),X=(0,i.useMemo)((()=>Object.keys(J).sort(((e,t)=>e.localeCompare(t))).filter((e=>-1===w.indexOf(e)))),[J]),ee=(0,i.useMemo)((()=>z.sort(((e,t)=>e.key.localeCompare(t.key)))),[z]),[te,ae]=(0,i.useState)((()=>(null==q?void 0:q.category)||w[0])),[ne,oe]=(0,i.useState)((()=>null!=q&&q.category?n.CATEGORY:n.RECOMMENDED_TAGS)),re=(0,i.useMemo)((()=>new l.Z(z,{ignoreLocation:!0,threshold:.3,keys:[{name:"value.name",weight:4},{name:"value.tags",weight:2},"value.description"]})),[z]),ie=(0,i.useMemo)((()=>""===E.trim()?[]:re.search(E).map((e=>e.item)).sort(((e,t)=>{var a,n;const o=null==(a=e.value)?void 0:a.label,r=null==(n=t.value)?void 0:n.label,i=o&&h.eH[o]?h.eH[o].weight:0;return(r&&h.eH[r]?h.eH[r].weight:0)-i}))),[E,re]),le=(0,i.useCallback)((()=>{L(!0)}),[]),se=(0,i.useCallback)((e=>T(e.target.value)),[]),ce=(0,i.useCallback)((()=>{L(!1),T(""),C.current.blur()}),[]),ue=(0,i.useCallback)(((e,t)=>{Z&&ce(),ae(e),oe(t);const a=q&&K(q,e);e===te||a||r(null)}),[ce,Z,te,q,r]),de=(0,i.useMemo)((()=>({[n.RECOMMENDED_TAGS]:{title:(0,u.t)("Recommended tags"),icon:(0,p.tZ)(b.Z.Tags,null),selectors:w},[n.CATEGORY]:{title:(0,u.t)("Category"),icon:(0,p.tZ)(b.Z.Category,null),selectors:Q},[n.TAGS]:{title:(0,u.t)("Tags"),icon:(0,p.tZ)(b.Z.Tags,null),selectors:X}})),[Q,X]);return(0,p.tZ)(R,{className:c,isSelectedVizMetadata:Boolean(q)},(0,p.tZ)(O,null,(0,p.tZ)(Y,{css:({gridUnit:e})=>p.iv`
              margin: ${2*e}px;
              margin-bottom: 0;
            `,sectionId:n.ALL_CHARTS,selector:x,icon:(0,p.tZ)(b.Z.Ballot,null),isSelected:!k&&x===te&&n.ALL_CHARTS===ne,onClick:ue}),(0,p.tZ)(m.Ol,{expandIconPosition:"right",ghost:!0,defaultActiveKey:Object.keys(de)},Object.keys(de).map((e=>{const t=de[e];return(0,p.tZ)(m.Ol.Panel,{header:(0,p.tZ)("span",{className:"header"},t.title),key:e},t.selectors.map((a=>(0,p.tZ)(Y,{key:a,selector:a,sectionId:e,icon:t.icon,isSelected:!k&&a===te&&e===ne,onClick:ue}))))})))),(0,p.tZ)(M,null,(0,p.tZ)(f.II,{type:"text",ref:C,value:E,placeholder:(0,u.t)("Search all charts"),onChange:se,onFocus:le,"data-test":`${A}__search-input`,prefix:(0,p.tZ)(I,null,(0,p.tZ)(b.Z.Search,{iconSize:"m"})),suffix:(0,p.tZ)(I,null,E&&(0,p.tZ)(b.Z.XLarge,{iconSize:"m",onClick:ce}))})),(0,p.tZ)(N,null,(0,p.tZ)(W,{vizEntries:k?ie:te===x&&ne===n.ALL_CHARTS?ee:ne===n.CATEGORY&&G[te]?G[te]:ne!==n.TAGS&&ne!==n.RECOMMENDED_TAGS||!J[te]?[]:J[te],selectedViz:o,setSelectedViz:r,onDoubleClick:s})),q?(0,p.tZ)("div",{css:e=>[F(e),P(e)]},(0,p.tZ)(i.Fragment,null,(0,p.tZ)(D,{css:p.iv`
                grid-area: viz-name;
                position: relative;
              `},null==q?void 0:q.name,(null==q?void 0:q.label)&&(0,p.tZ)(g.u,{id:"viz-badge-tooltip",placement:"top",title:null!=(t=q.labelExplanation)?t:h.t$[q.label]},(0,p.tZ)(j,null,(0,p.tZ)(H,null,(0,p.tZ)("div",null,(0,u.t)(q.label)))))),(0,p.tZ)($,null,null==q?void 0:q.tags.map((e=>(0,p.tZ)(v.Z,{key:e},e)))),(0,p.tZ)(U,null,(null==q?void 0:q.description)||(0,u.t)("No description available.")),(0,p.tZ)(D,{css:p.iv`
                grid-area: examples-header;
              `},!(null==q||null==(a=q.exampleGallery)||!a.length)&&(0,u.t)("Examples")),(0,p.tZ)(V,null,((null==q?void 0:q.exampleGallery)||[]).map((e=>(0,p.tZ)("img",{src:e.url,alt:e.caption,title:e.caption})))))):null)}},699963:(e,t,a)=>{a.d(t,{B:()=>s,l:()=>c});a(667294);var n=a(751995),o=a(251384),r=a(365634),i=a(211965);const l=n.iK.div`
  width: 100%;
  > span {
    display: flex;
    align-items: center;
  }

  .option-label {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    & ~ i {
      margin-left: ${({theme:e})=>e.gridUnit}px;
    }
  }
  .type-label {
    margin-right: ${({theme:e})=>3*e.gridUnit}px;
    width: ${({theme:e})=>7*e.gridUnit}px;
    display: inline-block;
    text-align: center;
    font-weight: ${({theme:e})=>e.typography.weights.bold};
  }
`,s=e=>(0,i.tZ)(l,null,(0,i.tZ)(o.m,e)),c=e=>(0,i.tZ)(l,null,(0,i.tZ)(r.E,e))},410331:(e,t,a)=>{a.d(t,{os:()=>k,RO:()=>C,mi:()=>T,Bx:()=>b,vP:()=>E,YY:()=>A,Hu:()=>Z,Bq:()=>v});var n={};a.r(n),a.d(n,{NVD3TimeSeries:()=>g,annotations:()=>m,colorScheme:()=>p,datasourceAndVizType:()=>d,sqlaTimeSeries:()=>h});var o=a(130845),r=a(46078),i=a(837687),l=a(338575),s=a(389368),c=(a(667294),a(455867)),u=a(211965);const d={controlSetRows:[["datasource"],["viz_type"],[{name:"slice_id",config:{type:"HiddenControl",label:(0,c.t)("Chart ID"),hidden:!0,description:(0,c.t)("The id of the active chart")}},{name:"cache_timeout",config:{type:"HiddenControl",label:(0,c.t)("Cache Timeout (seconds)"),hidden:!0,description:(0,c.t)("The number of seconds before expiring the cache")}},{name:"url_params",config:{type:"HiddenControl",label:(0,c.t)("URL parameters"),hidden:!0,description:(0,c.t)("Extra parameters for use in jinja templated queries")}}]]},p={label:(0,c.t)("Color scheme"),controlSetRows:[["color_scheme"]]},h={label:(0,c.t)("Time"),description:(0,c.t)("Time related form attributes"),expanded:!0,controlSetRows:[["granularity_sqla"],["time_range"]]},m={label:(0,c.t)("Annotations and layers"),tabOverride:"data",expanded:!0,controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:[],description:(0,c.t)("Annotation layers"),renderTrigger:!0,tabOverride:"data"}}]]},g=[{label:(0,c.t)("Query"),expanded:!0,controlSetRows:[["metrics"],["adhoc_filters"],["groupby"],["limit","timeseries_limit_metric"],["order_desc"],[{name:"contribution",config:{type:"CheckboxControl",label:(0,c.t)("Contribution"),default:!1,description:(0,c.t)("Compute the contribution to the total")}}],["row_limit",null]]},{label:(0,c.t)("Advanced analytics"),tabOverride:"data",description:(0,c.t)("This section contains options that allow for advanced analytical post processing of query results"),controlSetRows:[[(0,u.tZ)("div",{className:"section-header"},(0,c.t)("Rolling window"))],[{name:"rolling_type",config:{type:"SelectControl",label:(0,c.t)("Rolling function"),default:"None",choices:[["None",(0,c.t)("None")],["mean",(0,c.t)("mean")],["sum",(0,c.t)("sum")],["std",(0,c.t)("std")],["cumsum",(0,c.t)("cumsum")]],description:(0,c.t)("Defines a rolling window function to apply, works along with the [Periods] text box")}},{name:"rolling_periods",config:{type:"TextControl",label:(0,c.t)("Periods"),isInt:!0,description:(0,c.t)("Defines the size of the rolling window function, relative to the time granularity selected")}},{name:"min_periods",config:{type:"TextControl",label:(0,c.t)("Min periods"),isInt:!0,description:(0,c.t)('The minimum number of rolling periods required to show a value. For instance if you do a cumulative sum on 7 days you may want your "Min Period" to be 7, so that all data points shown are the total of 7 periods. This will hide the "ramp up" taking place over the first 7 periods')}}],[(0,u.tZ)("div",{className:"section-header"},(0,c.t)("Time comparison"))],[{name:"time_compare",config:{type:"SelectControl",multi:!0,freeForm:!0,label:(0,c.t)("Time shift"),choices:[["1 day",(0,c.t)("1 day")],["1 week",(0,c.t)("1 week")],["28 days",(0,c.t)("28 days")],["30 days",(0,c.t)("30 days")],["52 weeks",(0,c.t)("52 weeks")],["1 year",(0,c.t)("1 year")],["104 weeks",(0,c.t)("104 weeks")],["2 years",(0,c.t)("2 years")],["156 weeks",(0,c.t)("156 weeks")],["3 years",(0,c.t)("3 years")]],description:(0,c.t)("Overlay one or more timeseries from a relative time period. Expects relative time deltas in natural language (example: 24 hours, 7 days, 52 weeks, 365 days). Free text is supported.")}},{name:"comparison_type",config:{type:"SelectControl",label:(0,c.t)("Calculation type"),default:"values",choices:[["values",(0,c.t)("Actual values")],["absolute",(0,c.t)("Difference")],["percentage",(0,c.t)("Percentage change")],["ratio",(0,c.t)("Ratio")]],description:(0,c.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts.")}}],[(0,u.tZ)("div",{className:"section-header"},(0,c.t)("Resample"))],[{name:"resample_rule",config:{type:"SelectControl",freeForm:!0,label:(0,c.t)("Rule"),default:null,choices:[["1T",(0,c.t)("1T")],["1H",(0,c.t)("1H")],["1D",(0,c.t)("1D")],["7D",(0,c.t)("7D")],["1M",(0,c.t)("1M")],["1AS",(0,c.t)("1AS")]],description:(0,c.t)("Pandas resample rule")}},{name:"resample_method",config:{type:"SelectControl",freeForm:!0,label:(0,c.t)("Method"),default:null,choices:[["asfreq",(0,c.t)("asfreq")],["bfill",(0,c.t)("bfill")],["ffill",(0,c.t)("ffill")],["median",(0,c.t)("median")],["mean",(0,c.t)("mean")],["sum",(0,c.t)("sum")]],description:(0,c.t)("Pandas resample method")}}]]}],f=(0,o.Z)(((e,t)=>{const{sectionOverrides:a={},controlOverrides:o,controlPanelSections:i=[]}=t,c={...n};Object.entries(a).forEach((([e,t])=>{"object"===typeof t&&t.constructor===Object?c[e]={...c[e],...t}:c[e]=t}));const{datasourceAndVizType:u}=c,d=[r.i9.Query,r.i9.Table].includes(e)?["granularity"]:["granularity_sqla","time_grain_sqla"];return[u].concat(i.filter(l.D_)).map((e=>{const{controlSetRows:t}=e;return{...e,controlSetRows:(null==t?void 0:t.map((e=>e.filter((e=>"string"!==typeof e||!d.includes(e))).map((e=>(0,s.q)(e,o))))))||[]}}))}));function v(e,t){const a=(0,i.Z)().get(e)||{};return f(t,a)}const y=(0,o.Z)(((e,t)=>{const{controlOverrides:a={},controlPanelSections:n=[]}=t,o=(0,s.q)(function(e,t){var a;return null!=(a=e.filter(l.D_).map((e=>e.controlSetRows)).flat(2).find((e=>t===e||null!==e&&"object"===typeof e&&"name"in e&&e.name===t)))?a:null}(n,e),a);return o&&"config"in o?o.config:o})),b=function(e,t){const a=(0,i.Z)().get(t)||{};return y(e,a)};var _=a(355786);function C(e,t){const{mapStateToProps:a}=e;let n={...e},{value:o}=n;return a&&t&&(n={...e,...a.call(e,t,e)},o=o||n.value),"function"===typeof n.initialValue&&(n.initialValue=n.initialValue(n,t),"function"===typeof n.initialValue&&delete n.initialValue),n.initialValue&&(o=n.initialValue,delete n.initialValue),"function"===typeof n.default&&(n.default=n.default(n,t),"function"===typeof n.default&&delete n.default),n.default&&void 0===o&&(o=n.default),o&&n.multi&&!Array.isArray(o)&&(o=[o]),n.value=o,function(e,t){const a=e.validators,{externalValidationErrors:n=[]}=e,o=[];a&&a.length>0&&a.forEach((a=>{const n=a.call(e,e.value,t);n&&o.push(n)}));const r=[...o,...n];return{...e,validationErrors:r}}(function(e){if("SelectControl"===e.type&&!e.freeForm&&e.choices&&e.value){const t={...e},a=e.choices,n=(0,_.Z)(e.value),o=a.map((e=>e[0]));if(e.multi&&n.length>0)return t.value=n.filter((e=>o.includes(e))),t;if(!e.multi&&!o.includes(n[0]))return t.value=null,t}return e}(n),n)}function E(e,t,a){if(!e)return null;const n={...e,value:a};return null!=t&&t.controls||null===t?C(n,t):n}function T(e,t,a,n){const o={};return v(e,t).forEach((e=>e.controlSetRows.forEach((e=>e.forEach((e=>{if(null!=e&&e.config&&e.name){const{config:t,name:r}=e;o[r]=E(t,a,n[r])}})))))),o}function Z(e){const t={};return Object.keys(e).forEach((a=>{const n=e[a];t[a]=n.value})),t}var S=a(62446),x=a(46306);const w=(e,t,a)=>t.options&&"string"===typeof a&&t.options.some((e=>Array.isArray(e)?e[0]===a:e.column_name===a))?e.columns.some((e=>e.column_name===a)):t.savedMetrics&&(0,S.AG)(a)&&t.savedMetrics.some((e=>e.metric_name===a))?e.metrics.some((e=>e.metric_name===a)):t.columns&&((0,S.nX)(a)||(0,x.Ki)(a))&&t.columns.some((e=>{var t;return e.column_name===(null==(t=a.column)?void 0:t.column_name)||e.column_name===a.subject}))?e.columns.some((e=>{var t;return e.column_name===(null==(t=a.column)?void 0:t.column_name)||e.column_name===a.subject})):!!(0,S.q5)(a)&&(Object.assign(a,{datasourceWarning:!0}),!0),A=(e,t,a)=>{if(void 0!==a&&null!==a){if(Array.isArray(a)){const n=a.filter((a=>w(e,t,a)));return n.length>0?n:t.default}return w(e,t,a)?a:t.default}};var R=a(957557),D=a.n(R),O=a(320002),N=a(635854);const M=["metric","metrics","metric_2","size","x","y","secondary_metric"],I=["groupby","columns","groupbyColumns","groupbyRows","entity","series","series_columns"],L=["granularity_sqla","time_grain_sqla","time_range","adhoc_filters","limit","timeseries_limit_metric","series_limit_metric","order_desc","row_limit","x_axis","rolling_type","rolling_periods","min_periods","time_compare","comparison_type","resample_rule","resample_method"];class k{constructor(e){var t,a;this.sfd=void 0;const n=Object.freeze(e),o=null==n||null==(t=n.standardizedFormData)?void 0:t.memorizedFormData,r=n.viz_type;let i,l=new Map;if(Array.isArray(o)&&o.length>0&&n.datasource===(null==(a=o.slice(-1)[0][1])?void 0:a.datasource))l=new Map(n.standardizedFormData.memorizedFormData),l.has(r)&&l.delete(r),l.set(r,n),i=k.getStandardizedControls(n);else{const e=D()(n,"standardizedFormData");l.set(r,e),i=k.getStandardizedControls(e)}this.sfd={controls:i,memorizedFormData:l}}static getStandardizedControls(e){const t={metrics:[],columns:[]};if(Object.entries(e).forEach((([e,a])=>{M.includes(e)&&t.metrics.push(...(0,_.Z)(a)),I.includes(e)&&t.columns.push(...(0,_.Z)(a))})),(0,l.pp)(e)){const{metrics:a,columns:n}=e.standardizedFormData.controls;t.metrics.push(...a),t.columns.push(...n)}return t}getLatestFormData(e){return this.has(e)?this.get(e):this.memorizedFormData.slice(-1)[0][1]}get standardizedControls(){return this.sfd.controls}get memorizedFormData(){return Array.from(this.sfd.memorizedFormData.entries())}serialize(){return{controls:this.standardizedControls,memorizedFormData:this.memorizedFormData}}has(e){return this.sfd.memorizedFormData.has(e)}get(e){return this.sfd.memorizedFormData.get(e)}transform(e,t){const a=this.getLatestFormData(e),n={};L.forEach((e=>{e in t.form_data&&(n[e]=t.form_data[e])}));const o=(0,N.R3)(t,{...a,...n,viz_type:e}),r={...Z(o),standardizedFormData:this.serialize()};let l={formData:r,controlsState:o};const s=(0,i.Z)().get(e);if(null!=s&&s.formDataOverrides){(0,O.u)().setStandardizedControls(r);const e={...s.formDataOverrides(r),standardizedFormData:{controls:{...(0,O.u)().controls},memorizedFormData:this.memorizedFormData}};(0,O.u)().clear(),l={formData:e,controlsState:(0,N.R3)(t,e)}}return l.controlsState=(0,N.R3)({...t,controls:l.controlsState},l.formData),l}}},131567:(e,t,a)=>{a.d(t,{E:()=>n});const n={defaultValue:null,enableEmptyFilter:!1,inverseSelection:!1,defaultToFirstItem:!1,multiSelect:!0,searchAllOptions:!1,sortAscending:!0}},356080:(e,t,a)=>{a.d(t,{EG:()=>c,WO:()=>s,XX:()=>u,gD:()=>i,r6:()=>l,vb:()=>r});var n=a(88889),o=a(454076);const r=(e,t,a=!1,n=!1)=>{const o={};return a?o.adhoc_filters=[{expressionType:"SQL",clause:"WHERE",sqlExpression:"1 = 0"}]:void 0!==t&&null!==t&&0!==t.length&&(o.filters=[{col:e,op:n?"NOT IN":"IN",val:t}]),o},i=(e,t)=>{const a={};return void 0!==e&&null!==e&&0!==e.length&&(a.adhoc_filters=[{expressionType:"SQL",clause:"WHERE",sqlExpression:e.map((e=>` ( ${t.map((t=>" `"+t+"` "+`= '${e[t]}' `)).join(" and ")} ) `)).join(" or ")}]),a},l=(e,t,a=!1,n=!1)=>{const o={};return a?{}:(o.filters=[{col:e,op:"ILIKE",val:`%${t}%`}],o)},s=(e,t,a)=>{const n=[];return void 0!==t&&null!==t&&t!==a&&n.push({col:e,op:">=",val:t}),void 0!==a&&null!==a&&a!==t&&n.push({col:e,op:"<=",val:a}),void 0!==a&&null!==a&&void 0!==t&&null!==t&&a===t&&n.push({col:e,op:"==",val:a}),n.length?{filters:n}:{}};function c({timeFormatter:e,numberFormatter:t}={}){return(a,r)=>{if(null===a||void 0===a)return o.li;if("boolean"===typeof a)return a?o.Tb:o.jy;if(r===n.Z.BOOLEAN)try{return JSON.parse(String(a).toLowerCase())?o.Tb:o.jy}catch{return o.jy}return"string"===typeof a?a:e&&r===n.Z.TEMPORAL?e(a):t&&"number"===typeof a&&r===n.Z.NUMERIC?t(a):String(a)}}const u=(e,t,a=!1,n=!1)=>{const o={};return a?{}:(o.filters=[{col:e,op:"SHOW COL",val:t}],o)}},609332:(e,t,a)=>{a.d(t,{d:()=>n.d});var n=a(765013)},765013:(e,t,a)=>{a.d(t,{d:()=>o});var n=a(667294);const o=e=>{const t=(0,n.useRef)(!1);(0,n.useEffect)((()=>{t.current?e():t.current=!0}),[e])}},677997:(e,t,a)=>{a.d(t,{YJ:()=>E});var n=a(431069),o=a(355786),r=a(68492),i=a(522102),l=a(920292),s=a(591877),c=a(593185),u=a(998286);const d="polling",p="error",h="done",m="last_async_event_id";let g,f,v,y,b,_,C;const E=async e=>new Promise(((t,a)=>{const i=e.job_id;var l;l=async e=>{switch(e.status){case h:{let{data:r,status:i}=await(async e=>{let t,a="success";try{const{json:a}=await n.Z.get({endpoint:String(e.result_url)});t="result"in a?a.result:a}catch(e){a="error",t=await(0,u.O$)(e)}return{status:a,data:t}})(e);r=(0,o.Z)(r),"success"===i?t(r):a(r);break}case p:{const t=(0,u.MV)(e);a(t);break}default:r.Z.warn("received event with status",e.status)}var l;b[l=i]&&delete b[l]},b[i]=l})),T=(0,i.Z)({method:"GET",endpoint:"/api/v1/async_event/"}),Z=async e=>{e.forEach((e=>{const t=e.job_id,a=b[t];a?(a(e),delete _[t]):(_[t]||(_[t]=0),_[t]+=1,_[t]<=6?setTimeout((()=>{Z([e])}),100*_[t]):(delete _[t],r.Z.warn("listener not found for job_id",e.job_id))),(e=>{C=e.id;try{localStorage.setItem(m,C)}catch(e){r.Z.warn("Error saving event Id to localStorage",e)}})(e)}))},S=async()=>{const e=C?{last_id:C}:{};if(Object.keys(b).length)try{const{result:t}=await T(e);null!=t&&t.length&&await Z(t)}catch(e){r.Z.warn(e)}f===d&&(y=window.setTimeout(S,v))};let x,w,A=0;const R=()=>{let e=g.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;C&&(e+=`?last_id=${C}`),w=new WebSocket(e),w.addEventListener("open",(()=>{r.Z.log("WebSocket connected"),clearTimeout(x),A=0})),w.addEventListener("close",(()=>{x=setTimeout((()=>{A+=1,A<=6?R():(r.Z.warn("WebSocket not available, falling back to async polling"),S())}),2500)})),w.addEventListener("error",(()=>{w.readyState<2&&w.close()})),w.addEventListener("message",(async e=>{let t=[];try{t=[JSON.parse(e.data)],await Z(t)}catch(e){r.Z.warn(e)}}))};(e=>{if((0,s.cr)(c.T.GLOBAL_ASYNC_QUERIES)){y&&clearTimeout(y),b={},_={},C=null,g=e||(0,l.Z)().common.conf,f=g.GLOBAL_ASYNC_QUERIES_TRANSPORT||d,v=g.GLOBAL_ASYNC_QUERIES_POLLING_DELAY||500;try{C=localStorage.getItem(m)}catch(e){r.Z.warn("Failed to fetch last event Id from localStorage")}f===d&&S(),"ws"===f&&R()}})()},205558:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(968630),o=a.n(n);function r(e){return function(e){return o()(e)&&"username"in e}(e)&&"permissions"in e&&"roles"in e}},212617:(e,t,a)=>{a.d(t,{R:()=>n});const n=(0,a(130845).Z)(((e,t,a)=>!a||!!a&&Object.values(a).some((a=>a.some((([a,n])=>a===e&&n===t))))))},542313:(e,t,a)=>{a.d(t,{T:()=>n});const n=e=>{var t,a;return null!=(t=e.uid)?t:`${null!=(a=e.id)?a:"None"}__${e.type}`}},23525:(e,t,a)=>{a.d(t,{C3:()=>S,Nm:()=>b,TO:()=>C,VW:()=>Z,YE:()=>y,Zn:()=>T,eY:()=>p,en:()=>E,ns:()=>x});var n=a(441609),o=a.n(n),r=a(431069),i=a(237731),l=a(115926),s=a.n(l),c=a(427600),u=a(643399),d=a(411370);function p({name:e,type:t}){const a=new URLSearchParams(window.location.search).get(e);switch(t){case"number":return a?"true"===a.toLowerCase()?1:"false"===a.toLowerCase()?0:Number.isNaN(Number(a))?null:Number(a):null;case"object":return a?JSON.parse(a):null;case"boolean":return a?"false"!==a.toLowerCase()&&"0"!==a:null;case"rison":if(!a)return null;try{return s().decode(a)}catch{return a}default:return a}}function h(e){const t=new URLSearchParams;return new URLSearchParams(window.location.search).forEach(((a,n)=>{e.includes(n)||t.append(n,a)})),t}function m(e){const t=[];return e.forEach(((e,a)=>t.push([a,e]))),t}function g(e){const t=e||c.$O,a=h(t),n=(0,u.De)();return o()(n)||t.includes(c.KD.preselectFilters.name)||a.append(c.KD.preselectFilters.name,JSON.stringify((0,d.Z)((0,u.De)()))),m(a)}function f(){const e=h(c.Rv),t=(0,u.De)();return o()(t)||e.append(c.KD.preselectFilters.name,JSON.stringify((0,d.Z)((0,u.De)()))),m(e)}function v(e,t){return r.Z.post({endpoint:e,jsonPayload:t}).then((e=>e.json.url))}function y(e,t){return v("/api/v1/explore/permalink",{formData:e,urlParams:g(t)})}function b({dashboardId:e,dataMask:t,activeTabs:a,anchor:n}){return v(`/api/v1/dashboard/${e}/permalink`,{urlParams:f(),dataMask:t,activeTabs:a,anchor:n})}const _=/^([^:/?#]+:)?(?:(\/\/)?([^/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/;function C(e){const t=e.match(_)||[];return"string"===typeof t[1]&&t[1].length>0||"//"===t[2]||"string"===typeof t[3]&&t[3].length>0}function E(e){const t=e.match(_)||[];return!C(e)||(0,i.Z)(t[1])||e.startsWith("//")?e:`//${e}`}function T(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;const a=e.charAt(t.length);return a&&"/"!==a?null:e.slice(t.length)||"/"}function Z(){var e,t;const a=new URLSearchParams(window.location.search),n=a.get("control"),o=a.get("standalone");let r;n&&atob(n)&&(r=JSON.parse(decodeURI(atob(n))));let i=!1;((null==(e=r)||null==(t=e.data)?void 0:t.actions)||[]).forEach((e=>{"opentab"===e.actionsName&&(i=!0)}));const l=new URLSearchParams;return o&&l.set("standalone",o),n&&l.set("control",n),{opentab:i,standalone:o,control:r,sp:l,osp:a}}function S(e,t){const{opentab:a}=t,n=x(e,t);a?window.open(n,"_blank"):window.location.assign(n)}function x(e,t){const{control:a,standalone:n}=t;let{sp:o}=t;o||(o=new URLSearchParams,n&&o.set("standalone",n),a&&o.set("control",a));let r=""+e;return o&&(r+=(r.indexOf("?")>-1?"&":"?")+o.toString()),r}},652389:(e,t,a)=>{a.d(t,{IV:()=>o,dY:()=>r,iX:()=>i,mI:()=>l});var n=a(455867);const o=25,r=[{id:"changed_on_delta_humanized",desc:!0}],i=(0,n.t)('The passwords for the databases below are needed in order to import them together with the datasets. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),l=(0,n.t)("You are importing one or more datasets that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?")}}]);