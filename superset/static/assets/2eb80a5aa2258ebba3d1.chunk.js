"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[79258],{596638:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(260229),l=n(667294),i=n(592770);const o=function(e){var t=(0,a.CR)((0,l.useState)(e),2),n=t[0],o=t[1];return[n,(0,l.useCallback)((function(e){o((function(t){var n=(0,i.mf)(e)?e(t):e;return n?(0,a.pi)((0,a.pi)({},t),n):t}))}),[])]}},875443:(e,t,n)=>{n.d(t,{Z:()=>C});var a=n(722122),l=n(428481),i=n(667294),o=n(294184),s=n.n(o),r=n(668855),c=n(915105),d=n(931097),u=n(71577),p=n(832413),Z=n(342051),m=n(885636),f=n(65632),v=n(381643),b=n(796159),g=void 0,y=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(n[a[l]]=e[a[l]])}return n},h=i.forwardRef((function(e,t){var n=i.useState(e.visible),o=(0,l.Z)(n,2),r=o[0],h=o[1];i.useEffect((function(){"visible"in e&&h(e.visible)}),[e.visible]),i.useEffect((function(){"defaultVisible"in e&&h(e.defaultVisible)}),[e.defaultVisible]);var C=function(t,n){"visible"in e||h(t),e.onVisibleChange&&e.onVisibleChange(t,n)},k=function(t){C(!1,t),e.onConfirm&&e.onConfirm.call(g,t)},w=function(t){C(!1,t),e.onCancel&&e.onCancel.call(g,t)},_=i.useContext(f.E_).getPrefixCls,x=e.prefixCls,I=e.placement,E=e.children,S=e.overlayClassName,T=y(e,["prefixCls","placement","children","overlayClassName"]),N=_("popover",x),P=_("popconfirm",x),O=s()(P,S),V=i.createElement(Z.Z,{componentName:"Popconfirm",defaultLocale:m.Z.Popconfirm},(function(t){return function(t,n){var l=e.okButtonProps,o=e.cancelButtonProps,s=e.title,r=e.cancelText,c=e.okText,d=e.okType,Z=e.icon;return i.createElement("div",{className:"".concat(t,"-inner-content")},i.createElement("div",{className:"".concat(t,"-message")},Z,i.createElement("div",{className:"".concat(t,"-message-title")},(0,v.Z)(s))),i.createElement("div",{className:"".concat(t,"-buttons")},i.createElement(u.Z,(0,a.Z)({onClick:w,size:"small"},o),r||n.cancelText),i.createElement(u.Z,(0,a.Z)({onClick:k},(0,p.n)(d),{size:"small"},l),c||n.okText)))}(N,t)}));return i.createElement(d.Z,(0,a.Z)({},T,{prefixCls:N,placement:I,onVisibleChange:function(t){e.disabled||C(t)},visible:r,overlay:V,overlayClassName:O,ref:t}),(0,b.Tm)(E,{onKeyDown:function(e){var t,n;i.isValidElement(E)&&(null===(n=null===E||void 0===E?void 0:(t=E.props).onKeyDown)||void 0===n||n.call(t,e)),function(e){e.keyCode===c.Z.ESC&&r&&C(!1,e)}(e)}}))}));h.defaultProps={transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary",icon:i.createElement(r.Z,null),disabled:!1};const C=h},79258:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var a=n(667294),l=n(432787),i=n(519650),o=n(748086),s=n(875443),r=n(71577),c=n(3006),d=n(751995),u=n(431069),p=n(619702),Z=n(958452),m=n(184311),f=n(432615),v=n(596638),b=n(730381),g=n.n(b),y=n(164561),h=n(757016),C=n(771230),k=n(515746),w=n(734041),_=n(747933),x=n(890057),I=n(920292),E=n(427600);const S="cdrJeXhTTlOKULhEiIXu",T="TebLAtN8lc0jZp6w1m7l",N="JxY902I0E4M9Lxs9aHKb";var P=n(211965);const O=e=>{var t;const{open:n,onCancel:i,onSuccess:s,id:r}=e,[c]=y.Z.useForm(),{user:d}=function(){const[e,t]=(0,x.x)({common:E.n4}),n=(0,I.Z)();return(0,a.useEffect)((()=>{t({...e,...n})}),[JSON.stringify(n)]),e}(),[p,Z]=(0,v.Z)({roles:[]});(0,a.useEffect)((()=>{(async()=>{const{json:{meta:e},response:t}=await u.Z.get({endpoint:"/api/v2/role/"});if(200===(null==t?void 0:t.status)&&200===(null==e?void 0:e.code)){const{data:{list:t}}=e;Z({roles:null!=t&&t.length?Array.from(t,(e=>({label:e.name,value:e.id}))):[]})}})()}),[]),(0,a.useEffect)((()=>{n&&(async()=>{if(r){const{json:n,response:a}=await u.Z.get({endpoint:`/api/v1/app_attribute/${r}?q=${JSON.stringify({keys:["none"]})}`});if(200===(null==a?void 0:a.status)){var e,t;const{result:a}=n;null==c||c.setFieldsValue({name:null==a?void 0:a.name,code:null==a?void 0:a.code,enabled:null==a?void 0:a.enabled,createTime:g()(null==a?void 0:a.changed_on_utc).format("YYYY-MM-DD"),founder:null==a||null==(e=a.created_by)?void 0:e.username,role_id:null==a||null==(t=a.role)?void 0:t.id,app_desc:null==a?void 0:a.app_desc})}}})()}),[r]);const m=()=>{null==c||c.resetFields(),null==i||i()},f=e=>{200!==(null==e?void 0:e.status)&&201!==(null==e?void 0:e.status)||(o.ZP.success((r?"\u7f16\u8f91":"\u65b0\u589e")+"\u6210\u529f"),m(),null==s||s())};return(0,P.tZ)(h.Z,{title:r?"\u7f16\u8f91":"\u6dfb\u52a0",maskClosable:!1,visible:n,onCancel:m,onOk:null==c?void 0:c.submit,cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a",width:800,className:N},(0,P.tZ)(y.Z,{autoComplete:"off",form:c,onFinish:async e=>{const{app_desc:t,code:n,enabled:a,name:l,role_id:i}=e,o={app_desc:t,code:n,enabled:a,name:l,role_id:i};if(r){const{response:e}=await u.Z.put({endpoint:`/api/v1/app_attribute/${r}`,jsonPayload:o});f(e)}else{const{response:e}=await u.Z.post({endpoint:"/api/v1/app_attribute",jsonPayload:o});f(e)}},layout:"vertical",initialValues:{enabled:!0,founder:null!=(t=null==d?void 0:d.username)?t:"",createTime:g()().format("YYYY-MM-DD")}},(0,P.tZ)(C.Z,{gutter:24},(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"name",label:"\u5e94\u7528\u540d\u79f0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5e94\u7528\u540d\u79f0"}]},(0,P.tZ)(l.Z,{placeholder:"\u8bf7\u8f93\u5165"}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"code",label:"\u5e94\u7528\u7f16\u7801",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5e94\u7528\u7f16\u7801"}]},(0,P.tZ)(l.Z,{placeholder:"\u8bf7\u8f93\u5165"}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"founder",label:"\u521b\u5efa\u4eba"},(0,P.tZ)(l.Z,{placeholder:"\u8bf7\u8f93\u5165",disabled:!0}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"createTime",label:"\u521b\u5efa\u65e5\u671f"},(0,P.tZ)(l.Z,{placeholder:"\u8bf7\u8f93\u5165",disabled:!0}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"role_id",label:"\u5173\u8054\u89d2\u8272",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u89d2\u8272"}]},(0,P.tZ)(w.Z,{options:p.roles,placeholder:"\u8bf7\u9009\u62e9",allowClear:!0}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"enabled",label:"\u662f\u5426\u542f\u7528",rules:[{required:!0}]},(0,P.tZ)(_.ZP.Group,null,(0,P.tZ)(_.ZP,{value:!0},"\u662f"),(0,P.tZ)(_.ZP,{value:!1},"\u5426"))))),(0,P.tZ)(C.Z,{gutter:24},(0,P.tZ)(k.Z,{span:24},(0,P.tZ)(y.Z.Item,{name:"app_desc",label:"\u63cf\u8ff0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u63cf\u8ff0\u5185\u5bb9"}]},(0,P.tZ)(l.Z.TextArea,{rows:5,placeholder:"\u8bf7\u8f93\u5165",allowClear:!0}))))))},V=e=>{const{open:t,onCancel:n,id:i}=e,[o]=y.Z.useForm();return(0,a.useEffect)((()=>{t?(async()=>{if(i){const{json:e,response:t}=await u.Z.get({endpoint:`/api/v1/app_attribute/${i}?q=${JSON.stringify({keys:["none"]})}`});if(200===(null==t?void 0:t.status)){const{result:t}=e;null==o||o.setFieldsValue({name:null==t?void 0:t.name,code:null==t?void 0:t.code,app_key:null==t?void 0:t.app_key,app_secret:null==t?void 0:t.app_secret})}}})():null==o||o.resetFields()}),[i]),(0,P.tZ)(h.Z,{maskClosable:!1,visible:t,width:800,className:N,onCancel:n,footer:[(0,P.tZ)(r.Z,{type:"default",key:"button-close",onClick:n},"\u5173\u95ed")],title:"\u67e5\u770b\u5bc6\u94a5"},(0,P.tZ)(y.Z,{form:o,autoComplete:"off",layout:"vertical"},(0,P.tZ)(C.Z,{gutter:24},(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"name",label:"\u5e94\u7528\u540d\u79f0"},(0,P.tZ)(l.Z,{disabled:!0,placeholder:"\u8bf7\u8f93\u5165"}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"code",label:"\u5e94\u7528\u7f16\u7801"},(0,P.tZ)(l.Z,{disabled:!0,placeholder:"\u8bf7\u8f93\u5165"}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"app_key",label:"\u5e94\u7528ID"},(0,P.tZ)(l.Z,{disabled:!0,placeholder:"\u8bf7\u8f93\u5165"}))),(0,P.tZ)(k.Z,{span:12},(0,P.tZ)(y.Z.Item,{name:"app_secret",label:"\u5e94\u7528\u5bc6\u94a5"},(0,P.tZ)(l.Z,{disabled:!0,placeholder:"\u8bf7\u8f93\u5165"}))))))},{Search:Y}=l.Z,j=(0,d.iK)((({onSearch:e})=>(0,P.tZ)(i.Z,{align:"center",style:{marginBottom:20}},(0,P.tZ)(Y,{placeholder:"\u8f93\u5165\u5e94\u7528\u540d\u79f0\u3001\u5e94\u7528\u7f16\u7801\u8fdb\u884c\u6a21\u7cca\u68c0\u7d22",allowClear:!0,enterButton:"\u641c\u7d22",onSearch:e,style:{width:400}}))))``,K=(0,d.iK)((({children:e,iStyle:t})=>(0,P.tZ)("div",{className:S,style:t?{paddingBottom:0}:{}},e)))``,D=()=>{const[e,t]=(0,v.Z)({data:[],loading:!1,openKey:!1,open:!1,id:"",searchValue:"",pagination:{total:0,current:1,pageSize:20}}),n=async()=>{const n={...!!e.searchValue&&{filters:[{col:"name",opr:"search",value:e.searchValue}]},page:e.pagination.current-1,page_size:e.pagination.pageSize};t({loading:!0});const{json:a,response:l}=await u.Z.get({endpoint:`/api/v1/app_attribute?q=${JSON.stringify(n)}`});if(200===(null==l?void 0:l.status)){const n=(null==a?void 0:a.result)||[];t({data:null!=n&&n.length?n.map(((t,n)=>({...t,key:n+1+(e.pagination.current-1)*e.pagination.pageSize}))):[],pagination:{...e.pagination,total:null==a?void 0:a.count}})}t({loading:!1})};(0,a.useEffect)((()=>{n()}),[JSON.stringify(e.pagination),e.searchValue]);const l=(0,a.useCallback)((e=>{t({openKey:!0,id:e})}),[]),d=(0,a.useCallback)((n=>{u.Z.delete({endpoint:`/api/v1/app_attribute/${n}`}).then((({response:n})=>{200===(null==n?void 0:n.status)&&(null==o.ZP||o.ZP.success("\u522a\u9664\u6210\u529f"),t({pagination:{...e.pagination,current:1,total:0}}))}))}),[]),b=(0,a.useCallback)((e=>t({id:e,open:!0})),[]),y={rowKey:"id",bordered:!1,size:"middle",columns:(e=>e.slice().map((e=>null!=e&&e.render?e:{...e,render:(t,n)=>{var a,l;return null!=(a=n[null!=(l=null==e?void 0:e.dataIndex)?l:e.key])?a:"-"}})))([{title:"\u5e8f\u53f7",dataIndex:"key",width:80},{title:"\u5e94\u7528\u540d\u79f0",dataIndex:"name",width:150,ellipsis:!0},{title:"\u5e94\u7528\u7f16\u7801",dataIndex:"code",width:120,ellipsis:!0},{title:"\u63cf\u8ff0",dataIndex:"app_desc",width:200,ellipsis:!0,render:(e,{app_desc:t})=>t||"-"},{title:"\u542f\u7528",dataIndex:"enabled",width:60,ellipsis:!0,render:(e,{enabled:t})=>t?"\u662f":"\u5426"},{title:"\u5173\u8054\u89d2\u8272",dataIndex:"role",width:120,ellipsis:!0,render:(e,{role:t})=>(null==t?void 0:t.name)||"-"},{title:"\u521b\u5efa\u4eba",dataIndex:"created_by",width:100,ellipsis:!0,render:(e,{created_by:{username:t}})=>t||"-"},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"changed_on_utc",width:150,render:(e,{changed_on_utc:t})=>t?g()(t).format("YYYY-MM-DD HH:mm:ss"):"-"},{title:"\u64cd\u4f5c",key:"operation",width:150,render:(e,{id:t})=>[(0,P.tZ)(s.Z,{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",onConfirm:()=>d(t),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",key:"button-view-delete"},(0,P.tZ)(i.Z,{style:{marginRight:"10px"}},(0,P.tZ)(p.default,null))),(0,P.tZ)(i.Z,{key:"button-view-update",style:{margin:"0 10px"}},(0,P.tZ)(Z.default,{onClick:()=>b(t)})),(0,P.tZ)(i.Z,{key:"button-view-detail",style:{margin:"0 10px"}},(0,P.tZ)(m.default,{onClick:()=>l(t)}))]}]),dataSource:e.data,loading:e.loading,pagination:e.pagination,onChange:e=>t({pagination:e}),scroll:{y:"calc(100vh - 270px)"}},h=(0,a.useCallback)((e=>{t({searchValue:e})}),[]);return(0,P.tZ)(a.Fragment,null,(0,P.tZ)(V,{id:e.id,open:e.openKey,onCancel:()=>t({openKey:!1,id:null})}),(0,P.tZ)(O,{id:e.id,open:e.open,onCancel:()=>t({open:!1,id:null}),onSuccess:n}),(0,P.tZ)(K,{iStyle:!!e.data.length},(0,P.tZ)("div",{className:T},(0,P.tZ)(j,{onSearch:h}),(0,P.tZ)(r.Z,{onClick:(0,a.useCallback)((()=>t({open:!0})),[]),icon:(0,P.tZ)(f.default,null),type:"primary"},"\u65b0\u589e\u5e94\u7528")),(0,P.tZ)(c.Z,y)))}}}]);