"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[86947],{762529:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(896156),l=a(190484),s=a(722122),i=a(667294),r=a(560444),o=a(294184),d=a.n(o),c=a(428481),u=a(65632),p=a(796159),m=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};function h(e){return e?e.toString().split("").reverse().map((function(e){var t=Number(e);return isNaN(t)?e:t})):[]}const g=function(e){var t=e.prefixCls,a=e.count,n=e.className,l=e.style,r=e.title,o=e.show,g=e.component,f=void 0===g?"sup":g,v=e.children,b=e.onAnimated,Z=void 0===b?function(){}:b,y=m(e,["prefixCls","count","className","style","title","show","component","children","onAnimated"]),_=(0,i.useState)(!0),x=(0,c.Z)(_,2),S=x[0],w=x[1],E=(0,i.useState)(a),k=(0,c.Z)(E,2),P=k[0],C=k[1],I=(0,i.useState)(a),N=(0,c.Z)(I,2),T=N[0],M=N[1],L=(0,i.useState)(a),D=(0,c.Z)(L,2),$=D[0],R=D[1],O=(0,i.useContext(u.E_).getPrefixCls)("scroll-number",t);T!==a&&(w(!0),M(a)),i.useEffect((function(){var e;return R(P),S&&(e=setTimeout((function(){w(!1),C(a),Z()}))),function(){e&&clearTimeout(e)}}),[S,a,Z]);var j=(0,s.Z)((0,s.Z)({},y),{"data-show":o,style:l,className:d()(O,n),title:r}),A=function(e,t){if("number"===typeof e){var a=function(e,t){var a=Math.abs(Number(P)),n=Math.abs(Number($)),l=Math.abs(h(P)[t]),s=Math.abs(h(n)[t]);return S?10+e:a>n?l>=s?10+e:20+e:l<=s?10+e:e}(e,t),n=S||void 0===h($)[t];return i.createElement("span",{className:"".concat(O,"-only"),style:{transition:n?"none":void 0,msTransform:"translateY(".concat(100*-a,"%)"),WebkitTransform:"translateY(".concat(100*-a,"%)"),transform:"translateY(".concat(100*-a,"%)")},key:t},function(e,t){for(var a=[],n=0;n<30;n++)a.push(i.createElement("p",{key:n.toString(),className:d()(t,{current:e===n})},n%10));return a}(a,"".concat(O,"-only-unit")))}return i.createElement("span",{key:"symbol",className:"".concat(O,"-symbol")},e)},U=P&&Number(P)%1===0?h(P).map((function(e,t){return A(e,t)})).reverse():P;return l&&l.borderColor&&(j.style=(0,s.Z)((0,s.Z)({},l),{boxShadow:"0 0 0 1px ".concat(l.borderColor," inset")})),v?(0,p.Tm)(v,(function(e){return{className:d()("".concat(O,"-custom-component"),null===e||void 0===e?void 0:e.className)}})):i.createElement(f,j,U)};var f=a(798787);function v(e){return-1!==f.Y.indexOf(e)}var b=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a},Z=function(e){var t,a,o=e.prefixCls,c=e.scrollNumberPrefixCls,m=e.children,h=e.status,f=e.text,Z=e.color,y=e.count,_=void 0===y?null:y,x=e.overflowCount,S=void 0===x?99:x,w=e.dot,E=void 0!==w&&w,k=e.size,P=void 0===k?"default":k,C=e.title,I=e.offset,N=e.style,T=e.className,M=e.showZero,L=void 0!==M&&M,D=b(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),$=i.useContext(u.E_),R=$.getPrefixCls,O=$.direction,j=R("badge",o),A=_>S?"".concat(S,"+"):_,U=null!==h&&void 0!==h||null!==Z&&void 0!==Z,F="0"===A||0===A,K=E&&!F||U,z=K?"":A,Y=(0,i.useMemo)((function(){return(null===z||void 0===z||""===z||F&&!L)&&!K}),[z,F,L,K]),H=(0,i.useRef)(z);Y||(H.current=z);var V=H.current,q=(0,i.useRef)(K);Y||(q.current=K);var G=(0,i.useMemo)((function(){if(!I)return(0,s.Z)({},N);var e={marginTop:I[1]};return"rtl"===O?e.left=parseInt(I[0],10):e.right=-parseInt(I[0],10),(0,s.Z)((0,s.Z)({},e),N)}),[O,I,N]),B=null!==C&&void 0!==C?C:"string"===typeof _||"number"===typeof _?_:void 0,W=Y||!f?null:i.createElement("span",{className:"".concat(j,"-status-text")},f),J=_&&"object"===(0,l.Z)(_)?(0,p.Tm)(_,(function(e){return{style:(0,s.Z)((0,s.Z)({},G),e.style)}})):void 0,X=d()((t={},(0,n.Z)(t,"".concat(j,"-status-dot"),U),(0,n.Z)(t,"".concat(j,"-status-").concat(h),!!h),(0,n.Z)(t,"".concat(j,"-status-").concat(Z),v(Z)),t)),Q={};Z&&!v(Z)&&(Q.background=Z);var ee=d()(j,(a={},(0,n.Z)(a,"".concat(j,"-status"),U),(0,n.Z)(a,"".concat(j,"-not-a-wrapper"),!m),(0,n.Z)(a,"".concat(j,"-rtl"),"rtl"===O),a),T);if(!m&&U){var te=G.color;return i.createElement("span",(0,s.Z)({},D,{className:ee,style:G}),i.createElement("span",{className:X,style:Q}),i.createElement("span",{style:{color:te},className:"".concat(j,"-status-text")},f))}return i.createElement("span",(0,s.Z)({},D,{className:ee}),m,i.createElement(r.default,{visible:!Y,motionName:"".concat(j,"-zoom"),motionAppear:!1},(function(e){var t,a=e.className,l=R("scroll-number",c),r=q.current,o=d()((t={},(0,n.Z)(t,"".concat(j,"-dot"),r),(0,n.Z)(t,"".concat(j,"-count"),!r),(0,n.Z)(t,"".concat(j,"-count-sm"),"small"===P),(0,n.Z)(t,"".concat(j,"-multiple-words"),!r&&V&&(null===V||void 0===V?void 0:V.toString().length)>1),(0,n.Z)(t,"".concat(j,"-status-").concat(h),!!h),(0,n.Z)(t,"".concat(j,"-status-").concat(Z),v(Z)),t)),u=(0,s.Z)({},G);return Z&&!v(Z)&&((u=u||{}).background=Z),i.createElement(g,{prefixCls:l,show:!Y,className:d()(a,o),count:V,title:B,style:u,key:"scrollNumber"},J)})),W)};Z.Ribbon=function(e){var t,a=e.className,l=e.prefixCls,r=e.style,o=e.color,c=e.children,p=e.text,m=e.placement,h=void 0===m?"end":m,g=i.useContext(u.E_),f=g.getPrefixCls,b=g.direction,Z=f("ribbon",l),y=v(o),_=d()(Z,"".concat(Z,"-placement-").concat(h),(t={},(0,n.Z)(t,"".concat(Z,"-rtl"),"rtl"===b),(0,n.Z)(t,"".concat(Z,"-color-").concat(o),y),t),a),x={},S={};return o&&!y&&(x.background=o,S.color=o),i.createElement("div",{className:"".concat(Z,"-wrapper")},c,i.createElement("div",{className:_,style:(0,s.Z)((0,s.Z)({},x),r)},i.createElement("span",{className:"".concat(Z,"-text")},p),i.createElement("div",{className:"".concat(Z,"-corner"),style:S})))};const y=Z},405584:(e,t,a)=>{var n=a(595318);t.Z=void 0;var l=n(a(967154)),s=n(a(653457)),i=n(a(915704)),r={lang:(0,l.default)({placeholder:"\u8bf7\u9009\u62e9\u65e5\u671f",yearPlaceholder:"\u8bf7\u9009\u62e9\u5e74\u4efd",quarterPlaceholder:"\u8bf7\u9009\u62e9\u5b63\u5ea6",monthPlaceholder:"\u8bf7\u9009\u62e9\u6708\u4efd",weekPlaceholder:"\u8bf7\u9009\u62e9\u5468",rangePlaceholder:["\u5f00\u59cb\u65e5\u671f","\u7ed3\u675f\u65e5\u671f"],rangeYearPlaceholder:["\u5f00\u59cb\u5e74\u4efd","\u7ed3\u675f\u5e74\u4efd"],rangeMonthPlaceholder:["\u5f00\u59cb\u6708\u4efd","\u7ed3\u675f\u6708\u4efd"],rangeWeekPlaceholder:["\u5f00\u59cb\u5468","\u7ed3\u675f\u5468"]},s.default),timePickerLocale:(0,l.default)({},i.default)};r.lang.ok="\u786e \u5b9a";var o=r;t.Z=o},915704:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4",rangePlaceholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"]};t.default=a},653457:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={locale:"zh_CN",today:"\u4eca\u5929",now:"\u6b64\u523b",backToToday:"\u8fd4\u56de\u4eca\u5929",ok:"\u786e\u5b9a",timeSelect:"\u9009\u62e9\u65f6\u95f4",dateSelect:"\u9009\u62e9\u65e5\u671f",weekSelect:"\u9009\u62e9\u5468",clear:"\u6e05\u9664",month:"\u6708",year:"\u5e74",previousMonth:"\u4e0a\u4e2a\u6708 (\u7ffb\u9875\u4e0a\u952e)",nextMonth:"\u4e0b\u4e2a\u6708 (\u7ffb\u9875\u4e0b\u952e)",monthSelect:"\u9009\u62e9\u6708\u4efd",yearSelect:"\u9009\u62e9\u5e74\u4efd",decadeSelect:"\u9009\u62e9\u5e74\u4ee3",yearFormat:"YYYY\u5e74",dayFormat:"D\u65e5",dateFormat:"YYYY\u5e74M\u6708D\u65e5",dateTimeFormat:"YYYY\u5e74M\u6708D\u65e5 HH\u65f6mm\u5206ss\u79d2",previousYear:"\u4e0a\u4e00\u5e74 (Control\u952e\u52a0\u5de6\u65b9\u5411\u952e)",nextYear:"\u4e0b\u4e00\u5e74 (Control\u952e\u52a0\u53f3\u65b9\u5411\u952e)",previousDecade:"\u4e0a\u4e00\u5e74\u4ee3",nextDecade:"\u4e0b\u4e00\u5e74\u4ee3",previousCentury:"\u4e0a\u4e00\u4e16\u7eaa",nextCentury:"\u4e0b\u4e00\u4e16\u7eaa"};t.default=a},197531:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Re});var n=a(667294),l=a(997183),s=a(164561),i=a(748086),r=a(71577),o=a(126272),d=a(734041),c=a(432787),u=a(3006),p=a(757016),m=a(730381),h=a.n(m),g=a(929119),f=a(431069),v=a(455867),b=a(827167),Z=a(652924),y=a(432615),_=a(667496),x=(a(838703),a(683862)),S=a(497880),w=a(99210),E=a(855241),k=a(339144),P=a(911382),C=a(970553),I=a(519650),N=a(701474),T=a(268084),M=a(540790),L=a(370583),D=a(732194),$=a(619702),R=a(67701),O=a(704851),j=a(192167),A=a(7737),U=a(751995),F=a(115926),K=a.n(F),z=a(49937),Y=a(737921),H=(a(49238),a(940277),a(414114)),V=a(442582),q=a(211965);const G=U.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${({theme:e})=>e.gridUnit-2}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,B=U.iK.div`
  ${({theme:e})=>`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n\n  & + & {\n    margin-top: ${4*e.gridUnit}px;\n  }\n\n  .select {\n    width: calc(100% - ${e.gridUnit+20}px);\n    flex: 1;\n  }\n\n  .refresh {\n    display: flex;\n    align-items: center;\n    width: 20px;\n    margin-left: ${e.gridUnit}px;\n    margin-top: ${5.5*e.gridUnit}px;\n\n    span[role="button"]{\n      font-size: ${4.25*e.gridUnit}px;\n    }\n  }\n`}
`,W=({backend:e,databaseName:t})=>(0,q.tZ)(G,null,(0,q.tZ)(Y.Z,{className:"backend"},e),(0,q.tZ)("span",{className:"name",title:t},t)),J=({renderSelect:e,refreshBtn:t})=>(0,q.tZ)(B,{className:"section"},(0,q.tZ)("span",{className:"select"},e),(0,q.tZ)("span",{className:"refresh"},t));function X({db:e,formMode:t=!1,emptyState:a,getDbList:l,handleError:s,isDatabaseSelectEnabled:i=!0,onDbChange:r,onEmptyResults:o,onSchemaChange:d,onSchemasLoad:c,readOnly:u=!1,schema:p,sqlLabMode:m=!1,onChangeValue:h}){const[g,b]=(0,n.useState)(),[Z,y]=(0,n.useState)(p?{label:p,value:p,title:p}:void 0),{addSuccessToast:_}=(0,H.e1)(),x=(0,n.useMemo)((()=>async(e,a,n)=>{K().encode({order_columns:"database_name",order_direction:"asc",page:a,page_size:n,...t||!m?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}});return f.Z.get({endpoint:"/api/v2/database_sync/database/elect/"}).then((({json:t})=>{const{data:a}=t.meta;0===a.length&&o&&o(e);const n=a.map((e=>({label:(0,q.tZ)(W,{backend:e.type,databaseName:e.verbose_name}),value:e.id,id:e.id,database_name:e.verbose_name,backend:null==e?void 0:e.type})));return{data:n,totalCount:n.length}}))}),[t,l,m]);function S(e){y(e),d&&d(null==e?void 0:e.value)}(0,n.useEffect)((()=>{b((t=>(null==t?void 0:t.id)!==(null==e?void 0:e.id)?e?{label:(0,q.tZ)(W,{backend:e.backend,databaseName:e.database_name}),value:e.id,...e}:void 0:t))}),[e]);const{data:w,isFetching:E,isFetched:k,refetch:P}=(0,V.Xx)({dbId:null==g?void 0:g.value,onSuccess:e=>{null==c||c(e),1===e.length?S(e[0]):e.find((e=>p===e.value))||S(void 0),k&&_("List refreshed")},onError:()=>s((0,v.t)("There was an error loading the schemas"))});function C(e,t){h({target:{...t,value:e,type:"selectDatabase"}}),b(t),y(void 0),r&&r(t),d&&d(void 0)}return(0,q.tZ)("div",{"data-test":"DatabaseSelector"},(0,q.tZ)(J,{renderSelect:(0,q.tZ)(z.qb,{optionFilterProps:["database_name","value"],"data-test":"select-database",notFoundContent:a,onChange:C,value:g,placeholder:(0,v.t)("Select database or type database name"),disabled:!i||u,options:x})}))}a(806646),a(778214),a(727989);var Q=a(232228),ee=a(731293);a(611209);const{Search:te}=c.Z,{Step:ae}=S.Z,{Option:ne}=d.Z,{Column:le}=u.Z,se=s.Z.Item;let ie=[],re=null;const oe={adddev_menu:(0,v.t)("New Directory"),adddev_name:(0,v.t)("Directory Name"),name:"",is_dir:"",id:"",pid:"",label:"Add",Shift_menu:"",table_group_id:""};let de={...oe};(0,v.t)('The passwords for the databases below are needed in order to import them together with the dashboards. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),(0,v.t)("You are importing one or more dashboards that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?");class ce extends n.Component{constructor(e){super(e),this.apiDivnone=()=>{this.setState({apiDiv:"none",isApiadd:!1,DataSetID:null,table_groupID:null})},this.getPerm=()=>{f.Z.get({endpoint:"/api/v2/menu/datasource/perm"}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?this.setState({btnperm:e.json.meta.data.perm}):i.ZP.error(e.json.meta.message)}))},this.DealList=()=>f.Z.get({endpoint:"/api/v2/database_sync/group"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){e.json.meta.data.forEach((e=>{var t,a;e.icon=(0,q.tZ)(T.default,null),e.title=e.name,e.key=e.group_id,e.is_dir=0,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.pmenu_img="/static/assets/images/superset-menu-children.png",e.list=[],(null==(t=e.children)?void 0:t.length)>0&&(this.forEach_children(e.children),this.forEach_list(e.children,0,e.list,e.group_id)),(null==(a=e.database_sync)?void 0:a.length)>0&&this.forEach_list(e.database_sync,1,e.list,e.group_id)}));let t=[];ie=e.json.meta.data,ie.map((e=>{t.push(e.key_name)})),re=ie,this.setState({Search_Data:e.json.meta.data,isMenuOpen:!0,rootSubmenuKeys:t})}else i.ZP.error(e.json.meta.message)})).finally((()=>{this.setState({Menuloading:!1})})),this.menuAdd=(e,t,a,n)=>{e.stopPropagation(),0==n?(de={...oe,adddev_menu:(0,v.t)("New Directory"),adddev_name:(0,v.t)("Directory Name"),pid:t,is_dir:n,id:t,name:"",label:"Add"},this.setState({isModalOpen:!0})):1==n?(de.table_group_id=t,sessionStorage.setItem("newsqldatabaseid",t),this.setState({databaseModalOpen:!0})):2==n&&(de.table_group_id=t,this.setState({isApiModalOpen:!0}))},this.onDatabasebtn=e=>{1==e&&this.DealList()},this.delete_Popconfirm=e=>{e.stopPropagation()},this.menuEdit=(e,t,a,n,l,s,r,o,d)=>{if(this.setState({database_sync_id:d}),e.stopPropagation(),0==n){de={...oe,id:t,is_dir:l,Shift_menu:(0,v.t)("take")+s+(0,v.t)("Move to"),name:s,pid:a};const e=[];1!=l&&e.push({id:"0",title:(0,v.t)("Move to Root Directory"),name:(0,v.t)("Move to Root Directory"),pid:"0",children:[],value:"0",is_dir:"0",group_id:"0",key:"0",icon:(0,q.tZ)(T.default,null)}),e.push(...this.state.controlledMenuList),this.setState({isModalOpenShift:!0,treeData:e})}else if(1==n)de={...oe,...0==l?{adddev_menu:(0,v.t)("Edit Catalog"),adddev_name:(0,v.t)("Directory Name")}:{adddev_menu:(0,v.t)("Edit Data"),adddev_name:(0,v.t)("Data Name")},is_dir:l,id:t,pid:a,name:s,label:"Edit"},this.setState({isModalOpen:!0});else if(2==n){if(0==l)return f.Z.delete({endpoint:encodeURI(`/api/v2/database_sync/group/${t}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList()):i.ZP.error(e.json.meta.message)}));{this.setState({delloading:!0});let e=this.state.delobj.id;return f.Z.delete({endpoint:encodeURI(`/api/v2/database_sync/database/${e}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.props.handleRemoveId()):i.ZP.error(e.json.meta.message)}))}}},this.handleChange=e=>{const t=e.target,a="checkbox"===t.type?t.checked:t.value;"name"==t.name&&(de.name=a),this.setState({})},this.handleClick=e=>{if(e.key!=this.state.Selectedmenu&&(this.setState({Selectedmenu:e.key}),1==e.key.split("&&")[1])){const{handleChangeMenu:t}=this.props;t(e.key,e.item.props.value);const a=e.key.split("&&");this.setState({currentNumInfo:{DataSetID:a[0],table_groupID:a[3],dataBaseType:a[4]}})}},this.handleBlockGet=()=>{const{name:e,pid:t,id:a,is_dir:n,label:l}=de;if(!e)return i.ZP.error((0,v.t)("Please enter a name"));if(0==n){if("Add"==l){const a={name:e,pid:t};return f.Z.post({endpoint:"/api/v2/database_sync/group/",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),de={...oe}):i.ZP.error(e.json.meta.message)}))}if("Edit"==l){const n={name:e,pid:t};return f.Z.put({endpoint:`/api/v2/database_sync/group/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),de={...oe}):i.ZP.error(e.json.meta.message)}))}}},this.onExpand=e=>{this.setState({expandedKeys:e})},this.onSelect=(e,t)=>{const a=de.id,n=de.is_dir,l=de.name;de={...oe,id:a,pid:t.node.group_id,is_dir:n,name:l},this.setState({checkedKeys:e})},this.selectonChange=(e,t,a)=>{const n=de.id,l=de.is_dir,s=de.name;de={...de,id:n,pid:e,is_dir:l,name:s},this.setState({checkedvalue:t[0]})},this.handleBlockShift=()=>{const{name:e,pid:t,id:a,is_dir:n}=de;if(0==n){const n={name:e,pid:t};return f.Z.put({endpoint:`/api/v2/database_sync/group/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,treeData:[],expandedKeys:[],checkedKeys:[],checkedvalue:null}),de={...oe}):i.ZP.error(e.json.meta.message)}))}{const a=this.state.database_sync_id,n={name:e,group_id:t};return f.Z.request({method:"PATCH",endpoint:`/api/v2/database_sync/database/${a}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,expandedKeys:[],checkedKeys:[],checkedvalue:null}),de={...oe}):i.ZP.error(e.json.meta.message)}))}},this.openDashboardImportModal=()=>{this.setState({importingDashboard:!0})},this.closeDashboardImportModal=()=>{this.setState({importingDashboard:!1})},this.handleDashboardImport=()=>{this.setState({importingDashboard:!1})},this.Exportwrap=(e,t,a,n,l,s,i,r)=>{let o=r+"&&"+t,d=[];d.push(o),(0,Q.Z)("database",d,(()=>{this.setState({preparingExport:!1})})),this.setState({preparingExport:!0})},this.setPasswordFields=e=>{this.setState({passwordFields:e})},this.renderSubMenu=({is_dir:e,list:t,group_id:a,pid:n,icon:l,name:s,pmenu_img:i,key_name:r,perm:o,url:d,database_id:c,d_type:u,id:p})=>(0,q.tZ)(w.Z.SubMenu,{key:r,value:p,title:(0,q.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginLeft:"2px"}},(0,q.tZ)("span",{style:{display:"flex",alignItems:"center",width:"75%"}},-1===this.state.openKeys.indexOf(r)?(0,q.tZ)(T.default,null):(0,q.tZ)(M.default,null),(0,q.tZ)("span",{title:s,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},s)),(0,q.tZ)("span",{style:{display:"black",width:"25%"}},o>=4&&(0,q.tZ)("div",{className:"superset-menu-Popover"},0==e&&(0,q.tZ)(E.Z,{overlayClassName:"popovercss",content:(0,q.tZ)("div",null,(0,q.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,0)},(0,q.tZ)(T.default,{style:{marginRight:"5px"}}),(0,v.t)("New Directory")),(0,q.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,1)},(0,q.tZ)(ee.Z.DatabaseMenu,{style:{fontSize:"16px",verticalAlign:"middle"}}),(0,v.t)("New DataSource"))),zIndex:998,trigger:"hover"},(0,q.tZ)(y.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})),(0,q.tZ)(E.Z,{overlayClassName:"popovercss",content:(0,q.tZ)("div",null,(0,q.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,n,0,e,s,c,u,p)},(0,q.tZ)(L.default,{style:{marginRight:"5px"}}),(0,v.t)("Move")),0==e&&(0,q.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,n,1,e,s,c,u,p)},(0,q.tZ)(D.default,{style:{marginRight:"5px"}}),(0,v.t)("Rename")),(0,q.tZ)("p",{className:"Popover-curPo",onClick:t=>{let l={e:t,group_id:a,pid:n,num2:2,is_dir:e,database_id:c,d_type:u,id:p};this.setState({delmodel:!0,delobj:l})}},(0,q.tZ)($.default,{style:{marginRight:"5px"}}),(0,v.t)("Delete"))),zIndex:998,trigger:"hover"},(0,q.tZ)(R.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})))))},t&&t.map((e=>e.list&&e.list.length>0||e.children?this.renderSubMenu(e):this.renderMenuItem(e)))),this.renderMenuItem=({is_dir:e,group_id:t,pid:a,icon:n,name:l,pmenu_img:s,key_name:i,perm:r,url:o,database_id:d,d_type:c,id:u})=>(0,q.tZ)(w.Z.Item,{value:u,key:i},(0,q.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},(0,q.tZ)("span",{style:{display:"flex",alignItems:"center",width:"80%"}},(0,q.tZ)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center"},title:l},"api"==c||"token_api"==c?(0,q.tZ)(ee.Z.DatabaseApi,{iconColor:"#04B49C",style:{fontSize:"16px",verticalAlign:"middle"}}):(0,q.tZ)(ee.Z.DatabaseMenu,{style:{fontSize:"16px",verticalAlign:"middle"}}),l)),(0,q.tZ)("span",{style:{display:"black",width:"20%"}},(0,q.tZ)("div",{className:"superset-menu-Popover"},0==e&&(0,q.tZ)(E.Z,{overlayClassName:"popovercss",content:(0,q.tZ)("div",null,(0,q.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,0)},(0,q.tZ)(T.default,{style:{marginRight:"5px"}}),(0,v.t)("New Directory")),(0,q.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,t,a,0)},(0,q.tZ)(ee.Z.DatabaseMenu,{style:{fontSize:"16px",verticalAlign:"middle"}}),(0,v.t)("New DataSource"))),zIndex:998,trigger:"hover"},(0,q.tZ)(y.default,null)),(0,q.tZ)(E.Z,{overlayClassName:"popovercss",content:(0,q.tZ)("div",null,(0,q.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,0,e,l,d,c,u)},(0,q.tZ)(L.default,{style:{marginRight:"5px"}}),(0,v.t)("Move")),0==e&&(0,q.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,t,a,1,e,l,d,c,u)},(0,q.tZ)(D.default,{style:{marginRight:"5px"}}),(0,v.t)("Rename")),(0,q.tZ)("p",{className:"Popover-curPo",onClick:n=>{let l={e:n,group_id:t,pid:a,num2:2,is_dir:e,database_id:d,d_type:c,id:u};this.setState({delmodel:!0,delobj:l})}},(0,q.tZ)($.default,{style:{marginRight:"5px"}}),(0,v.t)("Delete"))),trigger:"hover"},(0,q.tZ)(R.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})))))),this.onSearch=e=>{let{selectvalue:t}=this.state,a=e;if(this.setState({isMenuOpen:!1,valuename:e}),a)if("allvalue"==t){ie=this.resdatasource(this.state.Search_Data,a),this.setState({isMenuOpen:!0})}else f.Z.get({endpoint:`/api/v2/database_sync/group/?${t}=${a}`,headers:{"Content-Type":"application/json"}}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){e.json.meta.data.forEach((e=>{var t,a;e.icon=(0,q.tZ)(T.default,null),e.title=e.name,e.key=e.group_id,e.is_dir=0,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.pmenu_img="/static/assets/images/superset-menu-children.png",e.list=[],(null==(t=e.children)?void 0:t.length)>0&&(this.forEach_children(e.children),this.forEach_list(e.children,0,e.list,e.group_id)),(null==(a=e.database_sync)?void 0:a.length)>0&&this.forEach_list(e.database_sync,1,e.list,e.group_id)})),ie=e.json.meta.data;let t=[];ie.map((e=>{t.push(e.key_name)})),this.setState({Search_Data:e.json.meta.data,isMenuOpen:!0,rootSubmenuKeys:t})}else i.ZP.error(e.json.meta.message)}));else this.DealList()},this.resdatasource=(e,t)=>{let a=[],n=function(e,t){e.map((e=>{const l=n(e.list,t);return-1!==e.name.toLowerCase().indexOf(t.toLowerCase())?a.push(e):l&&l.length&&(e.list=l,a.push(e)),!1}))};return n(e,t),a},this.onOpenChange=e=>{let{openKeys:t,rootSubmenuKeys:a}=this.state;const n=e.find((e=>-1===t.indexOf(e)));-1===a.indexOf(n)?this.setState({openKeys:e}):this.setState({openKeys:n?[n]:[]})},this.selevtchange=e=>{this.setState({selectvalue:e},(()=>{this.onSearch(this.state.valuename)}))},this.onChangeData=e=>{this.setState({database_type:e.target.type,database_name:e.target.database_name,database_ids:e.target.id})},this.handleSource=()=>{const{name:e,pid:t,id:a,is_dir:n,label:l,table_group_id:s}=de,r={database_type:this.state.database_type,name:this.state.database_name,group_id:s,database_id:this.state.database_ids};f.Z.post({endpoint:"/api/v2/database_sync/database/",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(i.ZP.success(e.json.meta.message),this.DealList(),this.setState({databaseModalOpen:!1})):i.ZP.error(e.json.meta.message)}))},this.state={isMenuOpen:!1,isModalOpen:!1,isModalOpenShift:!1,treeData:[],Search_Data:[],expandedKeys:[],autoExpandParent:!0,checkedKeys:[],databaseModalOpen:!1,editdatabaseModalOpen:!1,isApiModalOpen:!1,Menuloading:!1,Selectedmenu:"",importingDashboard:!1,addSuccessToast:(0,v.t)("Chart imported"),addDangerToast:e.addDangerToast,passwordFields:"",preparingExport:!1,openKeys:[""],delmodel:!1,delloading:!1,delbtndisable:!1,delobj:{},deldata:[],checkedvalue:null,rootSubmenuKeys:[],pathtype:null,isSave:!1,apiDiv:"none",isApiadd:!1,DataSetID:null,table_groupID:null,valuename:"",btnperm:0,selectvalue:"name",controlledMenuList:[],currentNumInfo:{DataSetID:null,table_groupID:null,dataBaseType:""},database_type:"",database_name:"",database_ids:"",database_sync_id:""},this.formRef=n.createRef(),this.oneContentRef=n.createRef(),this.handleClick=this.handleClick.bind(this)}componentDidUpdate(e){if(this.props.clickEdit){const{dataBaseType:e,DataSetID:t,table_groupID:a}=this.state.currentNumInfo;["api","token_api"].includes(e)?this.setState({apiDiv:"block",isApiadd:!1,DataSetID:t}):(de.table_group_id=a,this.setState({editdatabaseModalOpen:!0})),this.props.setEditState(!1)}}componentDidMount(){this.getPerm(),this.DealList(),this.getControlledMenu()}getControlledMenu(){f.Z.get({endpoint:"api/v2/database_sync/group/"}).then((e=>{200!=e.json.meta.code&&201!=e.json.meta.code||(e.json.meta.data.forEach((e=>{var t;e.title=e.name,e.key=e.group_id,e.disabled=e.perm<4,(null==(t=e.children)?void 0:t.length)>0&&this.forEach_children(e.children)})),this.setState({controlledMenuList:e.json.meta.data}))}))}forEach_children(e){e.forEach((e=>{e.title=e.name,e.key=e.group_id,e.disabled=e.perm<4,e.children.length>0&&this.forEach_children(e.children)}))}forEach_list(e,t,a,n){e.forEach((e=>{e.is_dir=t,1==t?(e.name=e.name,e.group_id=e.datasource_id,e.database_id=e.database_id,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name+"&&"+e.database_id+"&&"+e.d_type+"&&"+e.perm,e.pid=n,e.pmenu_img="/static/assets/images/superset-menu-dashboards.png"):(e.icon=(0,q.tZ)(T.default,null),e.pmenu_img="/static/assets/images/superset-menu-children.png",e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name),e.list=[],e.children&&(e.children.length>0&&this.forEach_list(e.children,0,e.list,e.group_id),e.database_sync.length>0&&this.forEach_list(e.database_sync,1,e.list,e.group_id)),a.push(e)}))}render(){const{isModalOpen:e,isModalOpenShift:t,treeData:a,expandedKeys:i,checkedKeys:o,databaseModalOpen:u,editdatabaseModalOpen:m,isMenuOpen:h,isApiModalOpen:g,Menuloading:f,addDangerToast:b,addSuccessToast:Z,importingDashboard:_,preparingExport:x,passwordFields:S,openKeys:M,delmodel:L,delloading:D,delbtndisable:$,deldata:R,delobj:U,checkedvalue:F,isSave:K,apiDiv:z,isApiadd:Y,DataSetID:H,table_groupID:V,valuename:G,btnperm:B,selectvalue:W,controlledMenuList:J}=this.state,{collapsed:Q,sonwidth:ee}=this.props,te=(0,q.tZ)(d.Z,{value:W,onChange:this.selevtchange,options:[{label:(0,v.t)("Group"),value:"group_name"},{label:(0,v.t)("Resource"),value:"name"},{label:(0,v.t)("Creator"),value:"creator"}]});return(0,q.tZ)(n.Fragment,null,(0,q.tZ)(l.Z,null,(0,q.tZ)("div",{className:"lefttitle",style:{width:ee+"px"}},(0,q.tZ)(k.Z,{style:{width:"100%"}},(0,q.tZ)("span",{style:{fontSize:"15px",overflow:"hidden",whiteSpace:"nowrap",marginLeft:"-4px"}},(0,v.t)("Database Sync")),(0,q.tZ)("div",{className:"superset-menu-Popover-Card",style:{top:"12px",display:Q?"none":"block"}},f?(0,q.tZ)(O.default,null):(0,q.tZ)(j.default,{onClick:()=>{this.setState({Menuloading:!0,valuename:"",selectvalue:"name"}),this.DealList()},style:{marginRight:"10px"}}),(0,q.tZ)(E.Z,{overlayClassName:"popovercss",placement:"bottom",content:(0,q.tZ)("div",null,(0,q.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,0,0,0)},(0,q.tZ)(T.default,{style:{marginRight:"5px"}}),(0,v.t)("New Group"))),trigger:"hover"},B>1&&(0,q.tZ)(y.default,null)))),(0,q.tZ)("div",{style:{padding:"0px 35px 0 0px",display:Q?"none":"block"}},(0,q.tZ)(c.Z,{style:{width:"100%",background:"#253E5E",marginLeft:"20px",border:"none",height:"36px"},className:"inputcss",prefix:(0,q.tZ)(A.default,{style:{width:"30px",color:"rgb(89 ,109 ,135)"}}),placeholder:(0,v.t)("Search"),onChange:e=>this.onSearch(e.target.value),value:G,addonAfter:te}))),(0,q.tZ)(P.Z,{spinning:f},(0,q.tZ)(w.Z,{visible:h,onClick:this.handleClick,mode:"inline",theme:"dark",openKeys:M,onOpenChange:this.onOpenChange,className:"maxHeight800",style:{maxHeight:"calc(100vh - 180px)",overflowY:"auto"}},ie.map((e=>e.children||e.list&&e.list.length>0?this.renderSubMenu(e):this.renderMenuItem(e))))),(0,q.tZ)(p.Z,{title:de.adddev_menu,visible:e,destroyOnClose:!0,onCancel:()=>this.setState({isModalOpen:!1}),onOk:this.handleBlockGet,okText:(0,v.t)("Confirm"),cancelText:(0,v.t)("Cancel")},(0,q.tZ)(s.Z,{name:"DataSet",labelCol:{span:4},wrapperCol:{span:20},preserve:!1},(0,q.tZ)(se,{label:de.adddev_name,name:"name",rules:[{required:!0,message:(0,v.t)("Please enter a name")}]},(0,q.tZ)(c.Z,{type:"text",name:"name",allowClear:!0,value:de.name,defaultValue:de.name,placeholder:(0,v.t)("Please enter"),onChange:this.handleChange})))),(0,q.tZ)(p.Z,{title:de.Shift_menu,visible:t,destroyOnClose:!0,forceRender:!0,onCancel:()=>this.setState({isModalOpenShift:!1}),onOk:this.handleBlockShift,okText:(0,v.t)("Confirm"),cancelText:(0,v.t)("Cancel")},(0,q.tZ)(C.Z,{showSearch:!0,style:{width:"100%"},value:F,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,v.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:this.selectonChange,treeData:a,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,q.tZ)(T.default,null)})),(0,q.tZ)(p.Z,{title:"\u6dfb\u52a0\u6570\u636e\u6e90",visible:u,destroyOnClose:!0,onCancel:()=>this.setState({databaseModalOpen:!1}),onOk:this.handleSource,okText:(0,v.t)("Confirm"),cancelText:(0,v.t)("Cancel")},(0,q.tZ)(s.Z,{name:"DataSet",labelCol:{span:4},wrapperCol:{span:20},preserve:!1},(0,q.tZ)(se,{label:"\u6570\u636e\u6e90",name:"name",rules:[{required:!0,message:(0,v.t)("Please enter a name")}]},(0,q.tZ)(X,{onChangeValue:this.onChangeData})))),(0,q.tZ)(p.Z,{title:(0,v.t)("Delete"),width:"40%",visible:L,onCancel:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})},footer:[(0,q.tZ)("div",{key:"id"},(0,q.tZ)(I.Z,null,(0,q.tZ)(r.Z,{onClick:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})}},(0,v.t)("Cancel")),(0,q.tZ)(r.Z,{type:"primary",loading:D,onClick:()=>{this.menuEdit(U.e,U.group_id,U.pid,U.num2,U.is_dir,U.database_id,U.d_type,U.id).then((()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})}))}},(0,v.t)("Confirm"))))]},(0,q.tZ)("div",null,0==R.length?(0,q.tZ)("span",null,(0,v.t)("Confirm to delete?")):(0,q.tZ)("div",null,(0,q.tZ)(N.Z,{message:(0,v.t)("Please delete the following dataset first"),type:"warning",showIcon:!0}),(0,q.tZ)("div",{className:"srcolldel",style:{width:"100%",maxHeight:"700px",overflowX:"hidden",overflowY:"auto"}},R.map((e=>(0,q.tZ)("div",{key:e.id,style:{fontSize:"14px",marginTop:"10px",textIndent:"2em"}},e.title)))))))))}}const ue=ce;var pe=a(766678),me=a.n(pe),he=a(747933),ge=a(624225),fe=a(621537),ve=a(931097),be=a(405584),Ze=a(425665),ye=a(150361),_e=a.n(ye),xe=a(269856),Se=a(205872),we=a.n(Se);const Ee=e=>{const{isModalOpen:t,editDataIndex:a,editData:l={},onOk:i=(()=>{}),onCancel:o=(()=>{}),columnList:u=[],databaseId:m,tableName:h}=e,{subject:g,operator:v,comparator:b,operatorId:Z}=l,y=Z||xe.d.IN,[_,x]=(0,n.useState)([]),[S,w]=(0,n.useState)(y),[E]=s.Z.useForm();(0,n.useEffect)((()=>{g&&k(g)}),[]);const k=e=>{E.resetFields(["comparator"]),f.Z.get({endpoint:`/api/v2/database_sync/database/elect/table_fields_value_group_by/?table_name=${h}&dbs_id=${m}&field_name=${e}`}).then((e=>{var t,a;const n=(null==e||null==(t=e.json)||null==(a=t.data)?void 0:a.map((e=>({label:e,value:e}))))||[];x(n)})).catch((()=>{x([])}))};let P=!0,C=!1,I={};return[xe.d.IS_NULL,xe.d.IS_NOT_NULL].includes(S)&&(P=!1,C=!0),[xe.d.IN,xe.d.NOT_IN].includes(S)&&(I={mode:"multiple"}),[xe.d.LESS_THAN,xe.d.LESS_THAN_OR_EQUAL,xe.d.GREATER_THAN_OR_EQUAL,xe.d.GREATER_THAN,xe.d.LIKE,xe.d.ILIKE].includes(S)&&(I={mode:"tags"}),(0,q.tZ)(p.Z,{title:"\u8fc7\u6ee4\u5668\u914d\u7f6e",visible:t,maskClosable:!1,onCancel:()=>{o()},footer:[(0,q.tZ)(r.Z,{key:"back",onClick:()=>{o()}},"\u53d6\u6d88"),(0,q.tZ)(r.Z,{key:"submit",type:"primary",onClick:()=>{E.validateFields().then((e=>{i(e,a)}))}},"\u786e\u5b9a")]},(0,q.tZ)(s.Z,we()({},{labelCol:{span:4},wrapperCol:{span:20}},{form:E,onFinish:()=>{},initialValues:{subject:g,operatorId:y,operator:v||xe.RB.find((e=>e.value===y)).operation}}),(0,q.tZ)(s.Z.Item,{label:"\u8fc7\u6ee4\u5b57\u6bb5",name:"subject",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u5b57\u6bb5"}]},(0,q.tZ)(d.Z,{showSearch:!0,allowClear:!0,placeholder:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u5b57\u6bb5",options:u,defaultValue:g,filterOption:(e,t)=>{var a;return(null!=(a=null==t?void 0:t.label)?a:"").toLowerCase().includes(e.toLowerCase())},onChange:k})),(0,q.tZ)(s.Z.Item,{label:"\u8fc7\u6ee4\u903b\u8f91",name:"operatorId",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u903b\u8f91"}]},(0,q.tZ)(d.Z,{showSearch:!0,allowClear:!0,placeholder:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u903b\u8f91",options:xe.RB,defaultValue:y,onChange:e=>{E.setFieldsValue({operator:xe.RB.find((t=>t.value===e)).operation}),E.resetFields(["comparator"]),w(e)},filterOption:(e,t)=>{var a;return(null!=(a=null==t?void 0:t.label)?a:"").toLowerCase().includes(e.toLowerCase())}})),(0,q.tZ)(s.Z.Item,{style:{display:"none"},label:"\u8fc7\u6ee4\u903b\u8f91\u503c",name:"operator",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u903b\u8f91\u503c"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u8fc7\u6ee4\u903b\u8f91\u503c"})),(0,q.tZ)(s.Z.Item,{label:"\u8fc7\u6ee4\u503c",disabled:C,name:"comparator",rules:[{required:P,message:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u503c"}]},(0,q.tZ)(d.Z,we()({},I,{showSearch:!0,allowClear:!0,disabled:C,placeholder:"\u8bf7\u9009\u62e9\u8fc7\u6ee4\u503c",options:_,defaultValue:b,filterOption:(e,t)=>{var a;return(null!=(a=null==t?void 0:t.label)?a:"").toLowerCase().includes(e.toLowerCase())}})))))},ke="#1879FF",Pe=(e,t)=>{const{databaseId:a,tableName:l,columnList:i=[],callBackTodo:o=(()=>{}),values:d=[]}=e,[u]=s.Z.useForm(),[p,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)(d),[f,v]=(0,n.useState)(-1);(0,n.useImperativeHandle)(t,(()=>({handleCloseVail:u.resetFields,handleFieldsValue:u.setFieldsValue})),[u]);const b=e=>e.map((e=>{const{subject:t,operator:a,comparator:n,sqlExpression:l,operatorId:s}=e;let i="";return l||(s===xe.d.IS_NULL||s===xe.d.IS_NOT_NULL?` \`${t}\` ${a} `:(s===xe.d.EQUALS||s===xe.d.NOT_EQUALS||s===xe.d.LESS_THAN||s===xe.d.LESS_THAN_OR_EQUAL||s===xe.d.GREATER_THAN||s===xe.d.GREATER_THAN_OR_EQUAL||s===xe.d.LIKE||s===xe.d.REGEX||s===xe.d.ILIKE?i=` '${n}' `:s!==xe.d.IN&&s!==xe.d.NOT_IN||(i=Array.isArray(n)?` ( '${n.join("' , '")} ') `:` ( '${n}' ) `),` \`${t}\` ${a} ${i}`))})).join(" AND ");return(0,q.tZ)(s.Z,{className:"xddForm1",form:u,layout:"vertical",onFinish:()=>{}},(0,q.tZ)(q.xB,{styles:q.iv`
          .ant-btn-primary {
            background: ${ke};
            border-color: ${ke};
          }
          .ant-btn > .anticon + span,
          .ant-btn > span + .anticon {
            margin-left: 0px;
          }
        `}),(0,q.tZ)("div",{style:{display:"flex",flexDirection:"column"}},(0,q.tZ)("div",{style:{flex:1,overflow:"auto"}},h.map(((e,t)=>{const a=b([e]);return(0,q.tZ)("div",{key:t,style:{display:"flex",alignItems:"center",marginBottom:10}},(0,q.tZ)(c.Z,{placeholder:a,disabled:!0}),(0,q.tZ)(D.default,{onClick:()=>{v(t),m(!0)},style:{marginLeft:10,cursor:"pointer",color:ke}}),(0,q.tZ)($.default,{onClick:()=>{const e=h.filter(((e,a)=>a!==t));g(e)},style:{marginLeft:10,marginRight:10,cursor:"pointer",color:ke}}))})),(0,q.tZ)("div",{style:{width:"100%"}},(0,q.tZ)(r.Z,{type:"primary",onClick:()=>{m(!0)},size:"small"},(0,q.tZ)(y.default,null),"\u6dfb\u52a0")))),p&&(null==i?void 0:i.length)>0&&(0,q.tZ)(Ee,{isModalOpen:p,editData:-1===f?{}:h[f],editDataIndex:f,columnList:i,databaseId:a,tableName:l,onOk:(e,t)=>{const a=_e()(h);-1!==t?a[t]=e:a.push(e),g(a);const n=b(a);v(-1),m(!1),o(n,a)},onCancel:()=>{m(!1),v(-1)}}))},Ce=(0,n.forwardRef)(Pe),Ie=(e,t)=>{const{onClose:a,editDatabaseId:l,DatabaseId:o,operationType:u,gitTableList:p,editColumns:m,Datasource:g,source_database_List:v}=e,[b]=s.Z.useForm(),[Z,y]=(0,n.useState)(""),[_,x]=(0,n.useState)(null),[S,w]=(0,n.useState)(null),[E,k]=(0,n.useState)(null),[P,C]=(0,n.useState)(null),[I,N]=(0,n.useState)([]),[T,M]=(0,n.useState)([]),[L,D]=(0,n.useState)(""),[$,R]=(0,n.useState)(""),[O,j]=(0,n.useState)(""),[A,U]=(0,n.useState)([]),[F,K]=(0,n.useState)(""),[z,Y]=(0,n.useState)(1),[H,V]=(0,n.useState)(3);(0,n.useImperativeHandle)(t,(()=>({handleCloseVail:b.resetFields,handleFieldsValue:b.setFieldsValue})),[b]),(0,n.useEffect)((()=>{g&&b.setFieldsValue({source_database_type:g.source_database_type,source_name:g.source_name,source_database_name:g.source_database_name})}),[g]);const G=(e,t)=>{x(t)},B=(e,t)=>{k(t)},W=e=>{w(e.target.value)},J=e=>{K(e.target.value)},X=e=>{M(e)},Q=e=>{D(e.target.value)},ee=e=>{Y(e)},te=e=>{V(e)},ae=null==m?void 0:m.source_database_table_name;return(0,n.useEffect)((()=>{ae&&f.Z.get({endpoint:`/api/v2/database_sync/database/elect/table_fields/?table_name=${ae}&dbs_id=${o}`}).then((e=>{const t=e.json.data.table_name_list.map((e=>({label:e,value:e})));N(t),j(ae)}))}),[ae]),(0,n.useEffect)((()=>{if("edit"===u){null!=m&&m.source_database_table_name&&j(null==m?void 0:m.source_database_table_name),null!=m&&m.row_range_data_list&&U(JSON.parse(null==m?void 0:m.row_range_data_list)),null!=m&&m.row_range_type&&R(null==m?void 0:m.row_range_type);let e=null;m.cron_end_time&&(m.cron_end_time,e=h()(m.cron_end_time));let t=[];"all_columns"===m.column_range_type?t=[]:"selected_columns"===m.column_range_type&&(t=JSON.parse(m.column_range_data));let a=null;m.row_range_data&&(a=m.row_range_data);let n=null;"cron"===m.execute_type&&m.cron_expression&&(n=m.cron_expression);const l=null==m?void 0:m.cron_expression;if("simple"===m.execute_type){const e=(e=>{const t=null==e?void 0:e.split(" ");if(!t)return null;let a="",n=null;return t[0].startsWith("*/")?(a=t[0].substring(2),n=1):t[1].startsWith("*/")?(a=t[1].substring(2),n=2):t[2].startsWith("*/")&&(a=t[2].substring(2),n=3),[parseInt(a),n]})(l);if(null!==e){const[t,a]=e;Y(t||0),V(a||0)}}const s={...m,execute_type:"immediately"===m.execute_type?"immediately":"cron"===m.execute_type?"cron":"simple",cron_start_time:m.cron_start_time?h()(m.cron_start_time):m.cron_start_time,cron_end_time:m.cron_end_time?"end":"null",reset_end_time:e,column_range:t,row_range:a,cron_Value:n};b.setFieldsValue(s)}}),[m,u]),(0,q.tZ)(s.Z,{className:"xddForm1",form:b,layout:"vertical",onFinish:e=>{let t=null;if("simple"===P){const e=((e,t)=>{let a="";return 1===t?a=`*/${e} * * * *`:2===t?a=`0 */${e} * * *`:3===t&&(a=`0 0 */${e} * *`),a})(z,H);t=e}else"cron"===P&&(t=F);let n=null;n="null"===S?null:E;let s=null;"all_columns"===e.column_range_type?s=null:"selected_columns"===e.column_range_type&&(s=T);let r=null;"all_rows"===e.row_range_type?r=null:"conditional_selected_rows"===e.row_range_type&&(r=L);const d={...e,source_dbs_id:parseInt(o),database_sync_id:parseInt(l),cron_start_time:_,cron_end_time:n,column_range_data:JSON.stringify(s),row_range_data:r,row_range_data_list:JSON.stringify(A),cron_expression:t},c=me()(d),{reset_end_time:h,column_range:g,row_range:v,cron_Value:Z,...y}=c;if("add"===u)f.Z.post({endpoint:"/api/v2/database_sync_task/",body:JSON.stringify(y),headers:{"Content-Type":"application/json"}}).then((e=>{200===e.json.code&&(a(),b.resetFields(),i.ZP.success("\u65b0\u589e\u6210\u529f"),p(l))}));else{const e=m.id;f.Z.put({endpoint:`/api/v2/database_sync_task/${JSON.stringify(e)}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then((e=>{a(),b.resetFields(),i.ZP.success("\u7f16\u8f91\u6210\u529f"),p(l)}))}},initialValues:{execute_type:"immediately",cron_end_time:"null",column_range_type:"all_columns",row_range_type:"all_rows",target_database_type:"MySQL",target_database_table_name:Z}},(0,q.tZ)("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 110px)"}},(0,q.tZ)("div",{style:{flex:1,overflow:"auto"}},(0,q.tZ)("div",{style:{display:"flex"}},(0,q.tZ)("span",{className:"span"}),(0,q.tZ)("div",{className:"title"},"\u4efb\u52a1\u4fe1\u606f")),(0,q.tZ)(s.Z.Item,{label:"\u4efb\u52a1\u540d\u79f0",name:"task_name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d\u79f0"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d\u79f0"})),(0,q.tZ)(s.Z.Item,{label:"\u4efb\u52a1\u7f16\u7801",name:"task_code",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7f16\u7801"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7f16\u7801"})),(0,q.tZ)(s.Z.Item,{label:"\u662f\u5426\u542f\u7528",name:"is_active",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u662f\u5426\u542f\u7528"}]},(0,q.tZ)(he.ZP.Group,null,(0,q.tZ)(he.ZP,{value:!0},"\u662f"),(0,q.tZ)(he.ZP,{value:!1},"\u5426"))),(0,q.tZ)(s.Z.Item,{label:"\u66f4\u65b0\u65b9\u5f0f",name:"update_type",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u66f4\u65b0\u65b9\u5f0f"}]},(0,q.tZ)(he.ZP.Group,null,(0,q.tZ)(he.ZP,{value:"complete_update"},"\u5168\u91cf\u66f4\u65b0"),(0,q.tZ)(he.ZP,{value:"incremental_update"},"\u589e\u91cf\u66f4\u65b0"))),(0,q.tZ)(s.Z.Item,{label:"\u6267\u884c\u6548\u7387",name:"execute_type",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6267\u884c\u6548\u7387"}]},(0,q.tZ)(he.ZP.Group,{defaultValue:"immediately",onChange:e=>{C(e.target.value),"add"===u&&"simple"===e.target.value&&(Y(1),V(3))}},(0,q.tZ)(he.ZP,{value:"immediately"},"\u7acb\u5373\u6267\u884c"),(0,q.tZ)(he.ZP,{value:"cron"},"\u8868\u8fbe\u5f0f\u6267\u884c"),(0,q.tZ)(he.ZP,{value:"simple"},"\u7b80\u5355\u91cd\u590d"))),(0,q.tZ)(s.Z.Item,{noStyle:!0,shouldUpdate:!0},(({getFieldValue:e})=>{const t=e("execute_type");return"cron"==t||"simple"==t?(0,q.tZ)("div",null,"cron"==t?(0,q.tZ)(s.Z.Item,{label:"cron\u8868\u8fbe\u5f0f",name:"cron_Value",rules:[{required:!0,message:"\u8bf7\u8f93\u5165cron\u8868\u8fbe\u5f0f"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165cron\u8868\u8fbe\u5f0f",onChange:J})):"","simple"===t?(0,q.tZ)("div",{style:{display:"flex"}},(0,q.tZ)(s.Z.Item,{label:"\u6267\u884c\u5468\u671f",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6267\u884c\u5468\u671f"}]},(0,q.tZ)("span",null,"\u6bcf"),(0,q.tZ)(ge.Z,{value:z,onChange:ee,min:1})),(0,q.tZ)(s.Z.Item,{className:"xddSpecial",label:" ",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6267\u884c\u5468\u671f"}],style:{marginLeft:"10px"}},(0,q.tZ)(d.Z,{onChange:te,value:H,options:[{label:"\u5206",value:1},{label:"\u5c0f\u65f6",value:2},{label:"\u5929",value:3}],style:{width:"70px",marginRight:"10px"}}),(0,q.tZ)("span",null,"\u6267\u884c\u4e00\u6b21"))):null,(0,q.tZ)(s.Z.Item,{label:"\u5f00\u59cb\u65f6\u95f4",name:"cron_start_time",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5f00\u59cb\u65f6\u95f4"}]},(0,q.tZ)(fe.Z,{locale:be.Z,showTime:!0,format:"YYYY-MM-DD HH:mm:ss",onChange:G})),(0,q.tZ)(s.Z.Item,{label:"\u7ed3\u675f\u65f6\u95f4",name:"cron_end_time",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7ed3\u675f\u65f6\u95f4"}]},(0,q.tZ)(he.ZP.Group,{defaultValue:"null",onChange:W},(0,q.tZ)(he.ZP,{value:"null"},"\u65e0\u9650\u5236"),(0,q.tZ)(he.ZP,{value:"end"},"\u8bbe\u5b9a\u7ed3\u675f\u65f6\u95f4"))),(0,q.tZ)(s.Z.Item,{noStyle:!0,shouldUpdate:!0},(({getFieldValue:e})=>"end"==e("cron_end_time")?(0,q.tZ)(s.Z.Item,{name:"reset_end_time",rules:[{required:!0,message:"\u8bf7\u8bbe\u5b9a\u7ed3\u675f\u65f6\u95f4"}]},(0,q.tZ)(fe.Z,{locale:be.Z,showTime:!0,format:"YYYY-MM-DD HH:mm:ss",onChange:B})):""))):""})),(0,q.tZ)("div",{style:{display:"flex",marginTop:20}},(0,q.tZ)("span",{className:"span"}),(0,q.tZ)("div",{className:"title"},"\u6e90\u4fe1\u606f")),(0,q.tZ)(s.Z.Item,{label:"\u6e90\u6570\u636e\u5e93\u7c7b\u578b",name:"source_database_type",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6e90\u6570\u636e\u5e93\u7c7b\u578b"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u6e90\u6570\u636e\u5e93\u7c7b\u578b",disabled:!0})),(0,q.tZ)(s.Z.Item,{label:"\u6570\u636e\u6e90\u540d\u79f0",name:"source_name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u6e90\u540d\u79f0"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u6570\u636e\u6e90\u540d\u79f0",disabled:!0})),(0,q.tZ)(s.Z.Item,{label:"\u6e90\u6570\u636e\u5e93\u540d\u79f0",name:"source_database_name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6e90\u6570\u636e\u5e93\u540d\u79f0"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u8f93\u5165\u6e90\u6570\u636e\u5e93\u540d\u79f0",disabled:!0})),(0,q.tZ)(s.Z.Item,{label:"\u6e90\u6570\u636e\u8868\u540d\u79f0",name:"source_database_table_name",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6e90\u6570\u636e\u8868\u540d\u79f0"}]},(0,q.tZ)(d.Z,{showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u6e90\u6570\u636e\u8868\u540d\u79f0",options:v,onChange:e=>{b.setFieldsValue({target_database_table_name:e}),y(e),e&&(null==b||b.setFieldsValue({column_range:[]}),f.Z.get({endpoint:`/api/v2/database_sync/database/elect/table_fields/?table_name=${e}&dbs_id=${o}`}).then((t=>{const a=t.json.data.table_name_list.map((e=>({label:e,value:e})));N(a),j(e)})))}})),(0,q.tZ)(s.Z.Item,{label:(0,q.tZ)("span",{style:{fontSize:"14px"}},"\u6570\u636e\u5217\u8303\u56f4\xa0\xa0",(0,q.tZ)(ve.Z,{title:"\u8bf4\u660e  1\u3001\u7b5b\u9009\u5f85\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5217\u30022\u3001\u6240\u6709\u6570\u636e\u5217\u548c\u53ef\u7b5b\u9009\u7684\u5217\uff0c\u4e3a\u7528\u6237\u6743\u9650\u5185\u7684\u6240\u6709\u6570\u636e\u5217,\u4e0d\u7b49\u4e8e\u8868\u7684\u6240\u6709\u5217\u3002"},(0,q.tZ)(Ze.default,null))),name:"column_range_type",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6570\u636e\u5217\u8303\u56f4"}]},(0,q.tZ)(he.ZP.Group,{onChange:e=>{}},(0,q.tZ)(he.ZP,{value:"all_columns"},"\u6240\u6709\u6570\u636e\u5217"),(0,q.tZ)(he.ZP,{value:"selected_columns"},"\u7b5b\u9009\u90e8\u5206\u5217"))),(0,q.tZ)(s.Z.Item,{noStyle:!0,shouldUpdate:!0},(({getFieldValue:e})=>{const t=e("column_range_type");return"selected_columns"==t?(0,q.tZ)("div",null,"selected_columns"==t?(0,q.tZ)(s.Z.Item,{name:"column_range",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u5217\u8303\u56f4"}]},(0,q.tZ)(d.Z,{placeholder:"\u8bf7\u8f93\u5165\u6570\u636e\u5217\u8303\u56f4",allowClear:!0,mode:"multiple",onChange:X,options:I})):""):""})),(0,q.tZ)("div",{style:{position:"relative"}},(0,q.tZ)(s.Z.Item,{label:(0,q.tZ)("span",{style:{fontSize:"14px"}},"\u6570\u636e\u884c\u8303\u56f4\xa0\xa0",(0,q.tZ)(ve.Z,{title:"\u8bf4\u660e:1\u3001\u7b5b\u9009\u5f85\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5217\u30022\u3001\u6240\u6709\u6570\u636e\u5217\u548c\u53ef\u7b5b\u9009\u7684\u5217\uff0c\u4e3a\u7528\u6237\u6743\u9650\u5185\u7684\u6240\u6709\u6570\u636e\u5217\uff0c\u4e0d\u7b49\u4e8e\u8868\u7684\u6240\u6709\u5217\u3002"},(0,q.tZ)(Ze.default,null))),name:"row_range_type",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6570\u636e\u884c\u8303\u56f4"}]},(0,q.tZ)(he.ZP.Group,{onChange:e=>{R(e.target.value)}},(0,q.tZ)(he.ZP,{value:"all_rows"},"\u6240\u6709\u6570\u636e\u884c"),(0,q.tZ)(he.ZP,{value:"conditional_selected_rows"},"\u7b5b\u9009\u90e8\u5206\u884c",(0,q.tZ)(ve.Z,{placement:"topLeft",title:"\u5728\u4e0b\u9762\u6587\u672c\u6846\u8f93\u5165SQL\u8868\u8fbe\u5f0f\uff0c\u8fdb\u884c\u884c\u7b5b\u9009\uff0c\u5982:`\u533a\u57df\u5b57\u6bb5` in ('\u534e\u4e2d\u533a\u57df')\u3002"},(0,q.tZ)("span",{style:{marginLeft:"7px",fontSize:"14px"}},(0,q.tZ)(Ze.default,null)))))),"conditional_selected_rows"===$&&O&&(0,q.tZ)(Ce,{databaseId:o,tableName:O,columnList:I,values:A,callBackTodo:(e,t)=>{D(e),U(t||[]),b.setFieldsValue({row_range:e})}})),(0,q.tZ)(s.Z.Item,{shouldUpdate:!0,style:{display:"none"}},(({getFieldValue:e})=>{const t=e("row_range_type");return"conditional_selected_rows"==t?(0,q.tZ)("div",null,"conditional_selected_rows"==t?(0,q.tZ)(s.Z.Item,{name:"row_range",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7b5b\u9009\u90e8\u5206\u5217"}]},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u9009\u62e9\u7b5b\u9009\u90e8\u5206\u5217",onChange:Q})):""):""})),(0,q.tZ)("div",{style:{display:"flex",marginTop:20}},(0,q.tZ)("span",{className:"span"}),(0,q.tZ)("div",{className:"title"},"\u76ee\u6807\u4fe1\u606f")),(0,q.tZ)(s.Z.Item,{label:"\u76ee\u6807\u6570\u636e\u5e93\u7c7b\u578b",name:"target_database_type",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u76ee\u6807\u6570\u636e\u5e93\u7c7b\u578b"}]},(0,q.tZ)(c.Z,{disabled:!0,placeholder:"\u8bf7\u8f93\u5165\u76ee\u6807\u6570\u636e\u5e93\u7c7b\u578b"})),(0,q.tZ)(s.Z.Item,{label:"\u76ee\u6807\u6570\u636e\u5e93\u540d\u79f0",name:"target_database_name",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u76ee\u6807\u6570\u636e\u5e93\u540d\u79f0"}]},(0,q.tZ)(d.Z,{placeholder:"\u8bf7\u9009\u62e9\u76ee\u6807\u6570\u636e\u5e93\u540d\u79f0",options:[{value:"api_database",label:"api_database"}],disabled:"edit"===u})),(0,q.tZ)(s.Z.Item,{label:"\u76ee\u6807\u6570\u636e\u8868\u540d\u79f0",name:"target_database_table_name"},(0,q.tZ)(c.Z,{placeholder:"\u8bf7\u9009\u62e9\u76ee\u6807\u6570\u636e\u8868\u540d\u79f0",disabled:!0}))),(0,q.tZ)("div",{style:{height:50,padding:12}},(0,q.tZ)(s.Z.Item,{style:{textAlign:"right"}},(0,q.tZ)(r.Z,{htmlType:"button",onClick:()=>{b.resetFields(),a()}},"\u53d6\u6d88"),(0,q.tZ)(r.Z,{type:"primary",style:{marginLeft:"10px"},htmlType:"submit"},"\u786e\u5b9a")))))},Ne=(0,n.forwardRef)(Ie),Te=e=>{const{tableLog:t}=e,a=[{title:(0,v.t)("Task name"),dataIndex:"task_name",key:"task_name",align:"center"},{title:(0,v.t)("Start time"),key:"task_start_time",dataIndex:"task_start_time",align:"center",render:e=>{if(!e)return"";return h()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,v.t)("End time"),key:"task_end_time",dataIndex:"task_end_time",align:"center",render:e=>{if(e){return h()(e).format("YYYY-MM-DD HH:mm:ss")}return null}},{title:(0,v.t)("Execute result"),dataIndex:"execute_result",key:"execute_result",align:"center"},{title:(0,v.t)("Execution log"),dataIndex:"task_log",key:"task_log",align:"center",ellipsis:{showTitle:!1},render:e=>(0,q.tZ)(ve.Z,{placement:"topLeft",title:e},e)}];return(0,q.tZ)(u.Z,{columns:a,dataSource:t,bordered:!0,rowKey:e=>e})},{Header:Me,Footer:Le,Sider:De,Content:$e}=l.Z;const Re=()=>{const[e,t]=(0,n.useState)("240"),[a,l]=(0,n.useState)("240"),[m,S]=(0,n.useState)(!1),[w,E]=(0,n.useState)(null),[k,P]=(0,n.useState)(null),[C,I]=(0,n.useState)(!1),[N,T]=(0,n.useState)(null),[M,L]=(0,n.useState)(null),[D,$]=(0,n.useState)(0),[R,O]=(0,n.useState)("none"),[j,A]=(0,n.useState)(!1),[U,F]=(0,n.useState)(""),[K,z]=(0,n.useState)([]),[Y,H]=(0,n.useState)(""),V=()=>{S(!m),t(m?"240":"0"),l(m?"240":"0")};const[G]=s.Z.useForm(),[B,W]=(0,n.useState)(""),[J,X]=(0,n.useState)(!1),[Q,ee]=(0,n.useState)(null),[te,ae]=(0,n.useState)(!1),[ne,le]=(0,n.useState)(!1),[se,ie]=(0,n.useState)([]),[re,oe]=(0,n.useState)(1),[de,ce]=(0,n.useState)(10),pe=(0,n.useRef)(),[me,he]=(0,n.useState)([{}]),[ge,fe]=(0,n.useState)([]),[ve,be]=(0,n.useState)([]),[Ze,ye]=(0,n.useState)(!1),[_e,xe]=(0,n.useState)(""),[Se,we]=(0,n.useState)(""),[Ee,ke]=(0,n.useState)("");function Pe(e,t){const a={filters:[{col:"database_sync_id",opr:"eq",value:e.toString()}]};try{le(!0),f.Z.get({endpoint:`/api/v2/database_sync_task/?q=${JSON.stringify(a)}`}).then((e=>{z(e.json.result||[]),le(!1)}))}catch(e){le(!1)}}const Ce=({title:e,id:t=null})=>{X(!0),W(e),ee("add"),pe.current&&pe.current.handleCloseVail(),f.Z.get({endpoint:`/api/v2/database_sync/database/elect/${M}`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){fe(e.json.meta.data);const t=e.json.meta.data.source_database_table_name_list.map((e=>({label:e,value:e})));be(t)}else i.ZP.error(e.json.meta.message)}))},Ie=()=>{X(!1),ae(!1),he({}),pe.current&&pe.current.handleCloseVail()},Me=[{title:(0,v.t)("SN"),key:"index",align:"center",width:50,render:(e,t,a)=>a+1+(re-1)*de},{title:(0,v.t)("Task Information"),children:[{title:(0,v.t)("Task Name"),dataIndex:"task_name",key:"task_name",width:150},{title:(0,v.t)("Task Code"),dataIndex:"task_code",key:"task_code",width:150},{title:(0,v.t)("Execution Efficiency"),dataIndex:"execute_type",key:"execute_type",width:150,render:e=>"immediately"===e?(0,v.t)("Execute immediately"):"cron"===e?(0,v.t)("Expression execution"):(0,v.t)("Simple repetition")},{title:(0,v.t)("Last Execution Time"),dataIndex:"task_start_time",key:"task_start_time",width:150,render:e=>{if(!e)return"";return h()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,v.t)("Last Execution Result"),dataIndex:"execute_result",key:"execute_result",width:150},{title:(0,v.t)("Task Status"),dataIndex:"execute_status",key:"execute_status",width:150,render:e=>e?"In progress":"Waiting for execution"},{title:(0,v.t)("Task Enable Status"),dataIndex:"is_active",key:"is_active",width:150,render:e=>e?(0,v.t)("Yes"):(0,v.t)("No")}]},{title:(0,v.t)("Source information"),children:[{title:(0,v.t)("Synchronize data source name"),dataIndex:"source_name",key:"source_name",width:150},{title:(0,v.t)("Source database type"),dataIndex:"source_database_type",key:"source_database_type",width:150},{title:(0,v.t)("Source database name"),dataIndex:"source_database_name",key:"source_database_name",width:150},{title:(0,v.t)("Source Data Table Name"),dataIndex:"source_database_table_name",key:"source_database_table_name",width:150}]},{title:(0,v.t)("Target Information"),children:[{title:(0,v.t)("Target database type"),dataIndex:"target_database_type",key:"target_database_type",width:150},{title:(0,v.t)("Target database name"),dataIndex:"target_database_name",key:"target_database_name",width:150},{title:(0,v.t)("Target Data Table Name"),dataIndex:"target_database_table_name",key:"target_database_table_name",width:150}]},{title:(0,v.t)("Actions"),key:"operation",fixed:"right",width:340,align:"center",render:(e,t)=>(0,q.tZ)("div",null,(0,q.tZ)(r.Z,{type:"link",onClick:()=>{Le(t)}},(0,v.t)("Edit")),(0,q.tZ)(r.Z,{type:"link",onClick:()=>{Re(t)}},(0,v.t)("Execute immediately")),(0,q.tZ)(r.Z,{type:"link",onClick:()=>{Oe(t)}},(0,v.t)("Execution log")),(0,q.tZ)(r.Z,{type:"link",onClick:()=>{je(t)}},(0,v.t)("Delete")))}],Le=e=>{X(!0),Ce({title:(0,v.t)("Edit Task")}),ee("edit"),f.Z.get({endpoint:`/api/v2/database_sync_task/${e.id}`}).then((e=>{he(e.json.result[0])}))},Re=e=>{ye(!0),xe((0,v.t)("Execute immediately")),we((0,v.t)("Do you want to execute it immediately")),ke(e.id)},Oe=e=>{const t=0,a=20;le(!0),f.Z.get({endpoint:`/api/v2/database_sync_task/logs/${e.id}?q=(page:${t},page_size:${a})`}).then((t=>{if(t.json.results){for(let a=0;a<t.json.results.length;a++)t.json.results[a].task_name=e.task_name;le(!1),ie(t.json.results),ae(!0)}else le(!1),ie([]),ae(!0)})).catch((e=>{le(!1)}))},je=e=>{ye(!0),xe((0,v.t)("Delete")),we((0,v.t)("Do you want to delete it")),ke(e.id)};return(0,q.tZ)(x.Rh,null,(0,q.tZ)(g.e,{style:{position:"relative",left:0,zIndex:13,background:"#1c2f47 ",borderRight:"1px solid #777777",height:"calc(100vh - 50px)"},enable:{right:!0},size:{width:e+"px"},onResize:(e,n,l,s)=>((e,n,l,s)=>{let i=a-0+(s.width-0);t(i)})(0,0,0,s),onResizeStart:e=>{},onResizeStop:(t,n,s,i)=>{let r=a-0+(i.width-0);l(r),(e<=130&&!m||e>130&&m)&&V()},maxWidth:"550px",minWidth:m?"0px":"85px"},(0,q.tZ)(De,{className:"leftMenuSider",collapsible:!0,collapsed:m,trigger:null},(0,q.tZ)(ue,{sonwidth:e,collapsed:m,handleChangeMenu:function(e,t){I(!1);const a=e.split("&&");Pe(t,a[3]),L(a[3]),T(t),E(a[0]),H(a[2]),a.length>2&&(O(a[4]),$(a[5])),F(a[2])},databaseId:null==k?void 0:k.id,handleRemoveId:function(){E(null)}})),(0,q.tZ)("span",{onClick:()=>V(),className:"foldbtn"},m?(0,q.tZ)(b.default,{className:"foldbtnsvg"}):(0,q.tZ)(Z.default,{className:"foldbtnsvg"}))),(0,q.tZ)($e,{className:"conTent"},(0,q.tZ)(o.Z,{title:(0,v.t)("Execution log"),placement:"right",width:736,onClose:Ie,visible:te},(0,q.tZ)(Te,{tableLog:se})),w&&J?(0,q.tZ)(o.Z,{destroyOnClose:!0,title:B,placement:"right",width:736,onClose:Ie,visible:J},(0,q.tZ)(Ne,{onClose:Ie,editDatabaseId:N,DatabaseId:M,operationType:Q,ref:pe,gitTableList:Pe,editColumns:me,Datasource:ge,source_database_List:ve,open:J})):"",(0,q.tZ)("div",null,w?(0,q.tZ)("div",null,(0,q.tZ)("div",{style:{background:"#FFF"}},(0,q.tZ)("div",{className:"databaseName"},Y)),(0,q.tZ)("div",{style:{background:"#FFF",margin:"20px 12px 0"}},(0,q.tZ)("div",{className:"xddTitle"},(0,q.tZ)("div",{style:{background:"#FFF"}},(0,q.tZ)(s.Z,{form:G,layout:"inline",onFinish:e=>{const t={filters:[{col:"task_name",opr:"task_search",value:[{value:e.value||"",database_sync_id:N}]}]};le(!0),f.Z.get({endpoint:`/api/v2/database_sync_task/?q=${JSON.stringify(t)}`}).then((e=>{z(e.json.result||[]),le(!1)})).catch((e=>{le(!1)}))},initialValues:{}},(0,q.tZ)(s.Z.Item,{label:(0,v.t)("Target database type"),name:"target_database_type"},(0,q.tZ)(d.Z,{style:{width:"185px"},placeholder:(0,v.t)("Please select the target database type"),options:[{value:"MySQL",label:"MySQL"}]})),(0,q.tZ)(s.Z.Item,{label:(0,v.t)("Target database name"),name:"target_database_name"},(0,q.tZ)(d.Z,{style:{width:"185px"},placeholder:(0,v.t)("Please select the target database name"),options:[{value:"api_database",label:"api_database"}]})),(0,q.tZ)(s.Z.Item,{label:(0,v.t)("keywords"),name:"value"},(0,q.tZ)(c.Z,{placeholder:(0,v.t)("Please enter keywords for fuzzy search")})),(0,q.tZ)(s.Z.Item,null,(0,q.tZ)(r.Z,{type:"primary",htmlType:"submit"},(0,v.t)("query")),(0,q.tZ)(r.Z,{htmlType:"button",onClick:()=>{G.resetFields(),Pe(N)},style:{marginLeft:"10px"}},(0,v.t)("resetting"))))),(0,q.tZ)("div",null,(0,q.tZ)(r.Z,{type:"primary",icon:(0,q.tZ)(y.default,null),onClick:()=>Ce({title:(0,v.t)("Add task")})},(0,v.t)("Add task")))),(0,q.tZ)(u.Z,{columns:Me,dataSource:K,bordered:!0,rowKey:e=>e,scroll:{x:!0,y:"calc(100vh - 430px)"},show:C,pagination:!0,loading:ne}))):(0,q.tZ)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"90vh"}},(0,q.tZ)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,q.tZ)("img",{style:{width:"90px"},src:(0,_.VU)("/static/assets/images/emptyicon.png"),alt:""}),(0,q.tZ)("div",{style:{fontSize:"16px",color:"#BBBDBF",marginTop:"20px"}},(0,v.t)("Please select a data source on the left"))))),(0,q.tZ)(p.Z,{width:350,title:_e,visible:Ze,onOk:async()=>{if(_e===(0,v.t)("Delete")){const e=parseInt(Ee);try{le(!0),f.Z.delete({endpoint:encodeURI(`/api/v2/database_sync_task/${e}`)}).then((e=>{"OK"==e.json.message?(i.ZP.success((0,v.t)("Delete successful!")),Pe(N),ye(!1)):i.ZP.error(e.json.message)}))}catch(e){}finally{le(!1)}}else{const e={id:Ee};try{le(!0);const t=await f.Z.post({endpoint:"/api/v2/database_sync_task/execute/",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});200==t.json.result.status||201==t.json.result.status?(i.ZP.success((0,v.t)("Execution succeeded\uff01")),ye(!1),Pe(N)):i.ZP.error(t.json.meta.message)}catch(e){}finally{le(!1)}}},onCancel:()=>ye(!1),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},(0,q.tZ)("p",null,Se))))}},452630:(e,t,a)=>{t.iB=t.YM=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},l=r(a(667294)),s=r(a(45697)),i=a(402371);function r(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,a){return function(s){var i,r,o,d=e[s.type],c=(r=(i=s).value,o=i.isDisabled,function(){!o&&a&&t!==r&&a(r)});return l.default.createElement(d,n({onClick:c},s))}};t.YM=function(e){var t=e.itemTypeToComponent,a=e.WrapperComponent,r=void 0===a?"div":a,d=function(e){var a=e.currentPage,s=e.totalPages,d=e.boundaryPagesRange,c=e.siblingPagesRange,u=e.hideEllipsis,p=e.hidePreviousAndNextPageLinks,m=e.hideFirstAndLastPageLinks,h=e.onChange,g=e.disabled,f=function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}(e,["currentPage","totalPages","boundaryPagesRange","siblingPagesRange","hideEllipsis","hidePreviousAndNextPageLinks","hideFirstAndLastPageLinks","onChange","disabled"]),v=(0,i.getPaginationModel)({currentPage:a,totalPages:s,boundaryPagesRange:d,siblingPagesRange:c,hideEllipsis:u,hidePreviousAndNextPageLinks:p,hideFirstAndLastPageLinks:m}),b=o(t,a,h);return l.default.createElement(r,f,v.map((function(e){return b(n({},e,{isDisabled:!!g}))})))};return d.propTypes={currentPage:s.default.number.isRequired,totalPages:s.default.number.isRequired,boundaryPagesRange:s.default.number,siblingPagesRange:s.default.number,hideEllipsis:s.default.bool,hidePreviousAndNextPageLinks:s.default.bool,hideFirstAndLastPageLinks:s.default.bool,onChange:s.default.func,disabled:s.default.bool},d},t.iB=i.ITEM_TYPES},782607:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(205872),l=a.n(n),s=(a(667294),a(751995)),i=a(762529),r=a(211965);const o=(0,s.iK)((({textColor:e,color:t,text:a,...n})=>(0,r.tZ)(i.Z,l()({text:a,color:a?t:void 0},n))))`
  & > sup {
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    background: ${({theme:e,color:t})=>t||e.colors.primary.base};
    color: ${({theme:e,textColor:t})=>t||e.colors.grayscale.light5};
  }
`},852564:(e,t,a)=>{a.d(t,{u:()=>w});var n=a(205872),l=a.n(n),s=a(667294),i=a(835932),r=a(616550),o=a(211965),d=a(455867),c=a(807500),u=a(667496),p=a(454076),m=a(49937),h=a(358593),g=a(899612);const f=e=>o.iv`
  display: flex;
  font-size: 18px;
  font-weight: ${e.typography.weights.bold};
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;

  & .dynamic-title,
  & .dynamic-title-input {
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  & .dynamic-title {
    cursor: default;
  }
  & .dynamic-title-input {
    border: none;
    padding: 0;
    outline: none;

    &::placeholder {
      color: ${e.colors.grayscale.light1};
    }
  }

  & .input-sizer {
    position: absolute;
    left: -9999px;
    display: inline-block;
  }
`,v=({title:e,placeholder:t,onSave:a,canEdit:n,label:l})=>{const[i,r]=(0,s.useState)(!1),[c,u]=(0,s.useState)(e||""),p=(0,s.useRef)(null),[m,v]=(0,s.useState)(!1),{width:b,ref:Z}=(0,g.NB)(),{width:y,ref:_}=(0,g.NB)({refreshMode:"debounce"});(0,s.useEffect)((()=>{u(e)}),[e]),(0,s.useEffect)((()=>{if(i&&null!=p&&p.current&&(p.current.focus(),p.current.setSelectionRange)){const{length:e}=p.current.value;p.current.setSelectionRange(e,e),p.current.scrollLeft=p.current.scrollWidth}}),[i]),(0,s.useLayoutEffect)((()=>{null!=Z&&Z.current&&(Z.current.innerHTML=(c||t).replace(/\s/g,"&nbsp;"))}),[c,t,Z]),(0,s.useEffect)((()=>{p.current&&p.current.scrollWidth>p.current.clientWidth?v(!0):v(!1)}),[b,y]);const x=(0,s.useCallback)((()=>{n&&!i&&r(!0)}),[n,i]),S=(0,s.useCallback)((()=>{if(!n)return;const t=c.trim();u(t),e!==t&&a(t),r(!1)}),[n,c,a,e]),w=(0,s.useCallback)((e=>{n&&i&&u(e.target.value)}),[n,i]),E=(0,s.useCallback)((e=>{var t;n&&("Enter"===e.key&&(e.preventDefault(),null==(t=p.current)||t.blur()))}),[n]);return(0,o.tZ)("div",{css:f,ref:_},(0,o.tZ)(h.u,{id:"title-tooltip",title:m&&c&&!i?c:null},n?(0,o.tZ)("input",{"data-test":"editable-title-input",className:"dynamic-title-input","aria-label":null!=l?l:(0,d.t)("Title"),ref:p,onChange:w,onBlur:S,onClick:x,onKeyPress:E,placeholder:t,value:c,css:o.iv`
              cursor: ${i?"text":"pointer"};

              ${b&&b>0&&o.iv`
                width: ${b+1}px;
              `}
            `}):(0,o.tZ)("span",{className:"dynamic-title","aria-label":null!=l?l:(0,d.t)("Title"),ref:p,"data-test":"editable-title"},c)),(0,o.tZ)("span",{ref:Z,className:"input-sizer","aria-hidden":!0,tabIndex:-1}))};var b=a(679789),Z=a(236674);const y=e=>o.iv`
  display: flex;
  flex-direction: row;
  align-items: center;
  flex-wrap: nowrap;
  justify-content: space-between;
  // background-color: ${e.colors.grayscale.light5};
  background: #fefefe;
  // height: ${16*e.gridUnit}px;
  height: 48px;

  padding: 0 ${4*e.gridUnit}px;

  .editable-title {
    overflow: hidden;

    & > input[type='button'],
    & > span {
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      white-space: nowrap;
    }
  }

  span[role='button'] {
    display: flex;
    height: 100%;
  }

  .title-panel {
    display: flex;
    align-items: center;
    min-width: 0;
    margin-right: ${12*e.gridUnit}px;
  }

  .right-button-panel {
    display: flex;
    align-items: center;
  }
`,_=e=>o.iv`
  display: flex;
  align-items: center;
  padding-left: ${2*e.gridUnit}px;

  & .fave-unfave-icon {
    padding: 0 ${e.gridUnit}px;

    &:first-of-type {
      padding-left: 0;
    }
  }
`,x=e=>o.iv`
  margin-left: ${2*e.gridUnit}px;
`,S=()=>{const e=(0,r.k6)();return(0,o.tZ)(i.Z,{style:{paddingLeft:"6px"},buttonStyle:"link",buttonSize:"default",onClick:()=>{e.goBack()},"data-test":"discard-changes-button","aria-label":(0,d.t)("Discard")},(0,o.tZ)("div",null,(0,o.tZ)(c.default,{title:"\u8fd4\u56de"})))},w=({backButtonProps:e=(0,o.tZ)(S,null),editableTitleProps:t,showTitlePanelItems:a,certificatiedBadgeProps:n,showFaveStar:i,faveStarProps:r,titlePanelAdditionalItems:c,rightPanelAdditionalItems:h,centerPanelAdditionalItems:g,subPanelAdditionalItems:f,additionalActionsMenu:w,menuDropdownProps:E,tooltipProps:k})=>(0,o.tZ)(s.Fragment,null,(0,o.tZ)("div",{css:y,className:"header-with-actions",style:{...(0,p.w)()&&{marginTop:0}}},(0,o.tZ)("div",{className:"title-panel"},e,(0,o.tZ)(v,t),c,a&&(0,o.tZ)("div",{css:_},(null==n?void 0:n.certifiedBy)&&(0,o.tZ)(b.Z,n),i&&(0,o.tZ)(Z.Z,r))),(0,o.tZ)("div",{className:"center-button-panel"},g),(0,o.tZ)("div",{className:"right-button-panel"},h,E&&(0,o.tZ)("div",{css:x},(0,o.tZ)(m.Gj,l()({trigger:["click"],overlay:w},E),(0,o.tZ)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"}},(0,o.tZ)("img",{style:{width:"20px",height:"20px",marginRight:"4px"},src:(0,u.VU)("/static/assets/images/more-unselected.png"),alt:""}),(0,o.tZ)("span",null,(0,d.t)("More"))))))),f)},455324:(e,t,a)=>{a.r(t),a.d(t,{datasetReducer:()=>la,default:()=>ia});var n=a(667294),l=a(616550),s=a(14025),i=a(455867),r=a(852564),o=a(835932),d=a(731293),c=a(683862),u=a(751995),p=a(211965);const m=u.iK.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};
`,h=u.iK.div`
  width: 100%;
  height: 100%;
  flex-direction: column;
`,g=(0,u.iK)(h)`
  width: ${({theme:e})=>80*e.gridUnit}px;
  height: auto;
`,f=(0,u.iK)(h)`
  height: auto;
  display: flex;
  flex: 1 0 auto;
  width: calc(100% - ${({theme:e})=>80*e.gridUnit}px);
`,v=u.iK.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
`,b=(0,u.iK)(v)`
  flex: 1 0 auto;
`,Z=(0,u.iK)(v)`
  flex: 1 0 auto;
  height: auto;
`,y=(0,u.iK)(v)`
  flex: 0 0 auto;
  height: ${({theme:e})=>16*e.gridUnit}px;
  z-index: 0;
`,_=u.iK.div`
  ${({theme:e})=>`\n  flex: 0 0 auto;\n  height: ${16*e.gridUnit}px;\n  border-bottom: 2px solid ${e.colors.grayscale.light2};\n\n  .header-with-actions {\n    height: ${15.5*e.gridUnit}px;\n  }\n  `}
`,x=u.iK.div`
  ${({theme:e})=>`\n  margin: ${4*e.gridUnit}px;\n  font-size: ${e.typography.sizes.xl}px;\n  font-weight: ${e.typography.weights.bold};\n  `}
`,S=u.iK.div`
  ${({theme:e})=>`\n  width: ${80*e.gridUnit}px;\n  height: 100%;\n  border-right: 1px solid ${e.colors.grayscale.light2};\n  `}
`,w=u.iK.div`
  width: 100%;
  position: relative;
`,E=u.iK.div`
  ${({theme:e})=>`\n  border-left: 1px solid ${e.colors.grayscale.light2};\n  color: ${e.colors.success.base};\n  `}
`,k=u.iK.div`
  ${({theme:e})=>`\n  height: ${16*e.gridUnit}px;\n  width: 100%;\n  border-top: 1px solid ${e.colors.grayscale.light2};\n  border-bottom: 1px solid ${e.colors.grayscale.light2};\n  color: ${e.colors.info.base};\n  border-top: ${e.gridUnit/4}px solid\n    ${e.colors.grayscale.light2};\n  padding: ${4*e.gridUnit}px;\n  display: flex;\n  justify-content: flex-end;\n  background-color: ${e.colors.grayscale.light5};\n  z-index: ${e.zIndex.max}\n  `}
`,P=u.iK.div`
  .ant-btn {
    span {
      margin-right: 0;
    }

    &:disabled {
      svg {
        color: ${({theme:e})=>e.colors.grayscale.light1};
      }
    }
  }
`,C=e=>p.iv`
  width: ${21.5*e.gridUnit}px;

  &:disabled {
    background-color: ${e.colors.grayscale.light3};
    color: ${e.colors.grayscale.light1};
  }
`;var I;!function(e){e[e.selectDatabase=0]="selectDatabase",e[e.selectSchema=1]="selectSchema",e[e.selectTable=2]="selectTable",e[e.changeDataset=3]="changeDataset"}(I||(I={}));const N=(0,i.t)("New dataset"),T={text:(0,i.t)("Select a database table and create dataset"),placement:"bottomRight"},M=()=>(0,p.tZ)(o.Z,{buttonStyle:"primary",tooltip:null==T?void 0:T.text,placement:null==T?void 0:T.placement,disabled:!0,css:C},(0,p.tZ)(d.Z.Save,{iconSize:"m"}),(0,i.t)("Save")),L=()=>(0,p.tZ)(c.v2,null,(0,p.tZ)(c.v2.Item,null,(0,i.t)("Settings")),(0,p.tZ)(c.v2.Item,null,(0,i.t)("Delete")));function D({setDataset:e,title:t=N,editing:a=!1}){const l={title:null!=t?t:N,placeholder:N,onSave:t=>{e({type:I.changeDataset,payload:{name:"dataset_name",value:t}})},canEdit:!1,label:(0,i.t)("dataset name")};return(0,p.tZ)(P,null,a?(0,p.tZ)(r.u,{editableTitleProps:l,showTitlePanelItems:!1,showFaveStar:!1,faveStarProps:{itemId:1,saveFaveStar:()=>{}},titlePanelAdditionalItems:(0,p.tZ)(n.Fragment,null),rightPanelAdditionalItems:M(),additionalActionsMenu:L(),menuDropdownProps:{disabled:!0},tooltipProps:T}):(0,p.tZ)(x,null,t||N))}var $,R,O=a(782607),j=a(171262),A=a(205872),U=a.n(A),F=a(473727),K=a(355786),z=a(667496),Y=a(493197),H=a(94301);function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},V.apply(this,arguments)}const q=function(e){return n.createElement("svg",V({width:160,height:166,viewBox:"0 0 160 166",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),$||($=n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M123.638 8a.5.5 0 00-.5.5V158h28.758V8.5a.5.5 0 00-.5-.5h-27.758zM84.793 40.643a.5.5 0 01.5-.5h27.759a.5.5 0 01.5.5V158H84.793V40.643zM46.95 72.285a.5.5 0 00-.5.5V158h28.758V72.785a.5.5 0 00-.5-.5H46.95zM8.604 93.715a.5.5 0 00-.5.5V158h28.758V94.215a.5.5 0 00-.5-.5H8.604z",fill:"#FAFAFA"})),R||(R=n.createElement("path",{d:"M123.138 158h-.5v.5h.5v-.5zm28.758 0v.5h.5v-.5h-.5zm-38.344 0v.5h.5v-.5h-.5zm-28.759 0h-.5v.5h.5v-.5zm-38.344-.001h-.5v.5h.5v-.5zm28.758 0v.5h.5v-.5h-.5zM8.104 158h-.5v.5h.5v-.5zm28.758 0v.5h.5v-.5h-.5zM123.638 8.5v-1a1 1 0 00-1 1h1zm0 149.5V8.5h-1V158h1zm28.258-.5h-28.758v1h28.758v-1zm-.5-149V158h1V8.5h-1zm0 0h1a1 1 0 00-1-1v1zm-27.758 0h27.758v-1h-27.758v1zM85.293 39.643a1 1 0 00-1 1h1v-1zm27.759 0H85.293v1h27.759v-1zm1 1a1 1 0 00-1-1v1h1zm0 117.357V40.643h-1V158h1zm-29.259.5h28.759v-1H84.793v1zm-.5-117.857V158h1V40.643h-1zM46.95 72.785v-1a1 1 0 00-1 1h1zm0 85.214V72.785h-1V158h1zm28.258-.5H46.45v1h28.758v-1zm-.5-84.714V158h1V72.785h-1zm0 0h1a1 1 0 00-1-1v1zm-27.758 0h27.758v-1H46.95v1zM8.604 94.215v-1a1 1 0 00-1 1h1zm0 63.785V94.215h-1V158h1zm28.258-.5H8.104v1h28.758v-1zm-.5-63.285V158h1V94.215h-1zm0 0h1a1 1 0 00-1-1v1zm-27.758 0h27.758v-1H8.604v1z",fill:"#D9D9D9"})))};var G=a(414114),B=a(34858),W=a(418782),J=a(730381),X=a.n(J),Q=a(763279),ee=a(358593);const te=u.iK.div`
  & > span {
    width: 100%;
    display: flex;

    .ant-tooltip-open {
      display: inline;
    }
  }
`,ae=u.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: inline-block;
  width: 100%;
  vertical-align: bottom;
`,ne=u.iK.span`
  &:not(:last-child)::after {
    content: ', ';
  }
`,le=u.iK.div`
  .link {
    color: ${({theme:e})=>e.colors.grayscale.light5};
    display: block;
    text-decoration: underline;
  }
`,se=u.iK.span`
  ${({theme:e})=>`\n  cursor: pointer;\n  color: ${e.colors.primary.dark1};\n  font-weight: ${e.typography.weights.normal};\n  `}
`;function ie({items:e,renderVisibleItem:t=(e=>e),renderTooltipItem:a=(e=>e),getKey:l=(e=>e),maxLinks:s=20}){const r=(0,n.useRef)(null),o=(0,n.useRef)(null),[d,c]=(0,Q.ro)(r,o),u=(0,n.useMemo)((()=>e.length>s?e.length-s:void 0),[e,s]),m=(0,n.useMemo)((()=>(0,p.tZ)(ae,{ref:r,"data-test":"crosslinks"},e.map((e=>(0,p.tZ)(ne,{key:l(e)},t(e)))))),[l,e,t]),h=(0,n.useMemo)((()=>e.slice(0,s).map((e=>(0,p.tZ)(le,{key:l(e)},a(e))))),[l,e,s,a]);return(0,p.tZ)(te,null,(0,p.tZ)(ee.u,{placement:"top",title:d?(0,p.tZ)(n.Fragment,null,h,u&&(0,p.tZ)("span",null,(0,i.t)("+ %s more",u))):null},m,c&&(0,p.tZ)(se,{ref:o},"+",d)))}const re=e=>({key:e.id,to:`/superset/dashboard/${e.id}`,target:"_blank",rel:"noreferer noopener",children:e.dashboard_title}),oe=e=>p.iv`
  color: ${e.colors.grayscale.light5};
  text-decoration: underline;
  &:hover {
    color: inherit;
  }
`,de=[{key:"slice_name",title:(0,i.t)("Chart"),width:"320px",sorter:!0,render:(e,t)=>(0,p.tZ)(F.rU,{to:t.url},t.slice_name)},{key:"owners",title:(0,i.t)("Chart owners"),width:"242px",render:(e,t)=>{var a,n;return(0,p.tZ)(ie,{items:null!=(a=null==(n=t.owners)?void 0:n.map((e=>`${e.first_name} ${e.last_name}`)))?a:[]})}},{key:"last_saved_at",title:(0,i.t)("Chart last modified"),width:"209px",sorter:!0,defaultSortOrder:"descend",render:(e,t)=>t.last_saved_at?X().utc(t.last_saved_at).fromNow():null},{key:"last_saved_by.first_name",title:(0,i.t)("Chart last modified by"),width:"216px",sorter:!0,render:(e,t)=>t.last_saved_by?`${t.last_saved_by.first_name} ${t.last_saved_by.last_name}`:null},{key:"dashboards",title:(0,i.t)("Dashboard usage"),width:"420px",render:(e,t)=>(0,p.tZ)(ie,{items:t.dashboards,renderVisibleItem:e=>(0,p.tZ)(F.rU,re(e)),renderTooltipItem:e=>(0,p.tZ)(F.rU,U()({},re(e),{css:oe})),getKey:e=>e.id})}],ce=e=>p.iv`
  && th.ant-table-cell {
    color: ${e.colors.grayscale.light1};
  }

  .ant-table-placeholder {
    display: none;
  }
`,ue=(0,p.tZ)(n.Fragment,null,(0,p.tZ)(d.Z.PlusOutlined,{iconSize:"m",css:p.iv`
        & > .anticon {
          line-height: 0;
        }
      `}),(0,i.t)("Create chart with dataset")),pe=(0,u.iK)(H.XJ)`
  margin: ${({theme:e})=>13*e.gridUnit}px 0;
`,me=({datasetId:e})=>{const{loading:t,recordCount:a,data:l,onChange:s}=(e=>{const{addDangerToast:t}=(0,G.e1)(),a=(0,n.useMemo)((()=>[{id:"datasource_id",operator:W.p.equals,value:e}]),[e]),{state:{loading:l,resourceCount:s,resourceCollection:r},fetchData:o}=(0,B.Yi)("chart",(0,i.t)("chart"),t,!0,[],a),d=(0,n.useMemo)((()=>r.map((e=>({...e,key:e.id})))),[r]),c=(0,n.useCallback)(((e,t,a)=>{var n,l;const s=(null!=(n=e.current)?n:1)-1,i=null!=(l=e.pageSize)?l:0,r=(0,K.Z)(a).filter((({columnKey:e})=>"string"===typeof e)).map((({columnKey:e,order:t})=>({id:e,desc:"descend"===t})));o({pageIndex:s,pageSize:i,sortBy:r,filters:[]})}),[o]);return(0,n.useEffect)((()=>{o({pageIndex:0,pageSize:25,sortBy:[{id:"last_saved_at",desc:!0}],filters:[]})}),[o]),{loading:l,recordCount:s,data:d,onChange:c}})(e),r=(0,n.useCallback)((()=>window.open((0,z.VU)(`/explore/?dataset_type=table&dataset_id=${e}`),"_blank")),[e]);return(0,p.tZ)("div",{css:l.length?null:ce},(0,p.tZ)(Y.ZP,{columns:de,data:l,size:Y.ex.MIDDLE,defaultPageSize:25,recordCount:a,loading:t,onChange:s}),l.length||t?null:(0,p.tZ)(pe,{image:(0,p.tZ)(q,null),title:(0,i.t)("No charts"),description:(0,i.t)("This dataset is not used to power any charts."),buttonText:ue,buttonAction:r}))},he=(0,u.iK)(j.ZP)`
  ${({theme:e})=>`\n  margin-top: ${8.5*e.gridUnit}px;\n  padding-left: ${4*e.gridUnit}px;\n  padding-right: ${4*e.gridUnit}px;\n\n  .ant-tabs-top > .ant-tabs-nav::before {\n    width: ${50*e.gridUnit}px;\n  }\n  `}
`,ge=u.iK.div`
  ${({theme:e})=>`\n  .ant-badge {\n    width: ${8*e.gridUnit}px;\n    margin-left: ${2.5*e.gridUnit}px;\n  }\n  `}
`,fe={USAGE_TEXT:(0,i.t)("Usage"),COLUMNS_TEXT:(0,i.t)("Columns"),METRICS_TEXT:(0,i.t)("Metrics")},ve=({id:e})=>{const{usageCount:t}=(0,s.bI)(e),a=(0,p.tZ)(ge,null,(0,p.tZ)("span",null,fe.USAGE_TEXT),t>0&&(0,p.tZ)(O.Z,{count:t}));return(0,p.tZ)(he,{moreIcon:null,fullWidth:!1},(0,p.tZ)(j.ZP.TabPane,{tab:fe.COLUMNS_TEXT,key:"1"}),(0,p.tZ)(j.ZP.TabPane,{tab:fe.METRICS_TEXT,key:"2"}),(0,p.tZ)(j.ZP.TabPane,{tab:a,key:"3"},(0,p.tZ)(me,{datasetId:e})))};var be=a(431069),Ze=a(68492),ye=a(672570),_e=a(229487),xe=a(838703);const Se=(e,t,a)=>{var n;return null==t||null==(n=t[e])||null==n.localeCompare?void 0:n.localeCompare(null==a?void 0:a[e])},we=u.iK.div`
  padding: ${({theme:e})=>8*e.gridUnit}px
    ${({theme:e})=>6*e.gridUnit}px;

  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
`,Ee=(0,u.iK)(H.XJ)`
  max-width: 50%;

  p {
    width: ${({theme:e})=>115*e.gridUnit}px;
  }
`,ke=(0,i.t)("Datasets can be created from database tables or SQL queries. Select a database table to the left or "),Pe=(0,i.t)("create dataset from SQL query"),Ce=(0,i.t)(" to open SQL Lab. From there you can save the query as a dataset."),Ie=(0,i.t)("Select dataset source"),Ne=(0,i.t)("No table columns"),Te=(0,i.t)("This database table does not contain any data. Please select a different table."),Me=(0,i.t)("An Error Occurred"),Le=(0,i.t)("Unable to load columns for the selected table. Please select a different table."),De=e=>{const{hasError:t,tableName:a,hasColumns:l}=e;let s="empty-dataset.svg",i=Ie,r=(0,p.tZ)(n.Fragment,null,ke,(0,p.tZ)("span",{role:"button",onClick:()=>{window.top?window.top.location.href="/superset/sqllab":window.location.href="/superset/sqllab"},tabIndex:0},Pe),Ce);return t?(i=Me,r=(0,p.tZ)(n.Fragment,null,Le),s=void 0):a&&!l&&(s="no-columns.svg",i=Ne,r=(0,p.tZ)(n.Fragment,null,Te)),(0,p.tZ)(we,null,(0,p.tZ)(Ee,{image:s,title:i,description:r}))};var $e;!function(e){e.ABSOLUTE="absolute",e.RELATIVE="relative"}($e||($e={}));const Re=u.iK.div`
  ${({theme:e,position:t})=>`\n  position: ${t};\n  margin: ${4*e.gridUnit}px\n    ${3*e.gridUnit}px\n    ${3*e.gridUnit}px\n    ${6*e.gridUnit}px;\n  font-size: ${6*e.gridUnit}px;\n  font-weight: ${e.typography.weights.medium};\n  padding-bottom: ${3*e.gridUnit}px;\n\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n\n  .anticon:first-of-type {\n    margin-right: ${4*e.gridUnit}px;\n  }\n\n  .anticon:nth-of-type(2) {\n    margin-left: ${4*e.gridUnit}px;\n  `}
`,Oe=u.iK.div`
  ${({theme:e})=>`\n  margin-left: ${6*e.gridUnit}px;\n  margin-bottom: ${3*e.gridUnit}px;\n  font-weight: ${e.typography.weights.bold};\n  `}
`,je=u.iK.div`
  ${({theme:e})=>`\n  padding: ${8*e.gridUnit}px\n    ${6*e.gridUnit}px;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  `}
`,Ae=u.iK.div`
  ${({theme:e})=>`\n  max-width: 50%;\n  width: 200px;\n\n  img {\n    width: 120px;\n    margin-left: 40px;\n  }\n\n  div {\n    width: 100%;\n    margin-top: ${3*e.gridUnit}px;\n    text-align: center;\n    font-weight: ${e.typography.weights.normal};\n    font-size: ${e.typography.sizes.l}px;\n    color: ${e.colors.grayscale.light1};\n  }\n  `}
`,Ue=u.iK.div`
  ${({theme:e})=>`\n  position: relative;\n  margin: ${3*e.gridUnit}px;\n  margin-left: ${6*e.gridUnit}px;\n  height: calc(100% - ${60*e.gridUnit}px);\n  overflow: auto;\n  `}
`,Fe=u.iK.div`
  ${({theme:e})=>`\n  position: relative;\n  margin: ${3*e.gridUnit}px;\n  margin-left: ${6*e.gridUnit}px;\n  height: calc(100% - ${30*e.gridUnit}px);\n  overflow: auto;\n  `}
`,Ke=u.iK.div`
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
`,ze=(0,u.iK)(_e.Z)`
  ${({theme:e})=>`\n  border: 1px solid ${e.colors.info.base};\n  padding: ${4*e.gridUnit}px;\n  margin: ${6*e.gridUnit}px ${6*e.gridUnit}px\n    ${8*e.gridUnit}px;\n  .view-dataset-button {\n    position: absolute;\n    top: ${4*e.gridUnit}px;\n    right: ${4*e.gridUnit}px;\n    font-weight: ${e.typography.weights.normal};\n\n    &:hover {\n      color: ${e.colors.secondary.dark3};\n      text-decoration: underline;\n    }\n  }\n  `}
`,Ye=(0,i.t)("Refreshing columns"),He=(0,i.t)("Table columns"),Ve=((0,i.t)("Loading"),["5","10","15","25"]),qe=[{title:"Column Name",dataIndex:"name",key:"name",sorter:(e,t)=>Se("name",e,t)},{title:"Datatype",dataIndex:"type",key:"type",width:"100px",sorter:(e,t)=>Se("type",e,t)}],Ge=(0,i.t)("This table already has a dataset associated with it. You can only associate one dataset with a table.\n"),Be=(0,i.t)("View Dataset"),We=({tableName:e,columnList:t,loading:a,hasError:l,datasets:s})=>{var r;const o=(0,u.Fg)(),c=null!=(r=(null==t?void 0:t.length)>0)&&r,m=null==s?void 0:s.map((e=>e.table_name)),h=null==s?void 0:s.find((t=>t.table_name===e));let g,f;return a&&(f=(0,p.tZ)(je,null,(0,p.tZ)(Ae,null,(0,p.tZ)(xe.Z,{position:"inline-centered"}),(0,p.tZ)("div",null,Ye)))),a||(g=!a&&e&&c&&!l?(0,p.tZ)(n.Fragment,null,(0,p.tZ)(Oe,null,He),h?(0,p.tZ)(Ue,null,(0,p.tZ)(Ke,null,(0,p.tZ)(Y.ZP,{loading:a,size:Y.ex.SMALL,columns:qe,data:t,pageSizeOptions:Ve,defaultPageSize:25}))):(0,p.tZ)(Fe,null,(0,p.tZ)(Ke,null,(0,p.tZ)(Y.ZP,{loading:a,size:Y.ex.SMALL,columns:qe,data:t,pageSizeOptions:Ve,defaultPageSize:25})))):(0,p.tZ)(De,{hasColumns:c,hasError:l,tableName:e})),(0,p.tZ)(n.Fragment,null,e&&(0,p.tZ)(n.Fragment,null,(null==m?void 0:m.includes(e))&&(v=h,(0,p.tZ)(ze,{closable:!1,type:"info",showIcon:!0,message:(0,i.t)("This table already has a dataset"),description:(0,p.tZ)(n.Fragment,null,Ge,(0,p.tZ)("span",{role:"button",onClick:()=>{window.open(null==v?void 0:v.explore_url,"_blank","noreferrer noopener popup=false")},tabIndex:0,className:"view-dataset-button"},Be))})),(0,p.tZ)(Re,{position:!a&&c?$e.RELATIVE:$e.ABSOLUTE,title:e||""},e&&(0,p.tZ)(d.Z.Table,{iconColor:o.colors.grayscale.base}),e)),g,f);var v},Je=({tableName:e,dbId:t,schema:a,setHasColumns:l,datasets:s})=>{const[r,o]=(0,n.useState)([]),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),h=(0,n.useRef)(e),g=async e=>{const{dbId:t,tableName:a,schema:n}=e;c(!0),null==l||l(!1);const s=`/api/v1/database/${t}/table/${a}/${n}/`;try{const e=await be.Z.get({endpoint:s});if((e=>{let t=!0;if("string"!==typeof(null==e?void 0:e.name)&&(t=!1),t&&!Array.isArray(e.columns)&&(t=!1),t&&e.columns.length>0){const a=e.columns.some(((e,t)=>{const a=(e=>{let t=!0;return"string"!==typeof(null==e?void 0:e.name)&&(t=!1),t&&"string"!==typeof(null==e?void 0:e.type)&&(t=!1),t})(e);return!a}));t=!a}return t})(null==e?void 0:e.json)){const t=e.json;t.name===h.current&&(o(t.columns),null==l||l(t.columns.length>0),m(!1))}else o([]),null==l||l(!1),m(!0),(0,ye.Gb)((0,i.t)("The API response from %s does not match the IDatabaseTable interface.",s)),Ze.Z.error((0,i.t)("The API response from %s does not match the IDatabaseTable interface.",s))}catch(e){o([]),null==l||l(!1),m(!0)}finally{c(!1)}};return(0,n.useEffect)((()=>{h.current=e,e&&a&&t&&g({tableName:e,dbId:t,schema:a})}),[e,t,a]),(0,p.tZ)(We,{columnList:r,hasError:u,loading:d,tableName:e,datasets:s})};var Xe=a(115926),Qe=a.n(Xe),et=a(294184),tt=a.n(et),at=a(722122),nt=a(28991),lt=a(896156),st=a(428481),it=a(781253),rt=a(850344),ot=(a(580334),a(242550)),dt=a(34203),ct=a(391033),ut=new Map;var pt=new ct.Z((function(e){e.forEach((function(e){var t,a=e.target;null===(t=ut.get(a))||void 0===t||t.forEach((function(e){return e(a)}))}))}));var mt=a(306610),ht=a(5991),gt=a(110379),ft=a(460446),vt=function(e){(0,gt.Z)(a,e);var t=(0,ft.Z)(a);function a(){return(0,mt.Z)(this,a),t.apply(this,arguments)}return(0,ht.Z)(a,[{key:"render",value:function(){return this.props.children}}]),a}(n.Component),bt=n.createContext(null);function Zt(e,t){var a=e.children,l=e.disabled,s=n.useRef(null),i=n.useRef(null),r=n.useContext(bt),o="function"===typeof a,d=o?a(s):a,c=n.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),u=!o&&n.isValidElement(d)&&(0,ot.Yr)(d),p=u?d.ref:null,m=n.useMemo((function(){return(0,ot.sQ)(p,s)}),[p,s]),h=function(){return(0,dt.Z)(s.current)||(0,dt.Z)(i.current)};n.useImperativeHandle(t,(function(){return h()}));var g=n.useRef(e);g.current=e;var f=n.useCallback((function(e){var t=g.current,a=t.onResize,n=t.data,l=e.getBoundingClientRect(),s=l.width,i=l.height,o=e.offsetWidth,d=e.offsetHeight,u=Math.floor(s),p=Math.floor(i);if(c.current.width!==u||c.current.height!==p||c.current.offsetWidth!==o||c.current.offsetHeight!==d){var m={width:u,height:p,offsetWidth:o,offsetHeight:d};c.current=m;var h=o===Math.round(s)?s:o,f=d===Math.round(i)?i:d,v=(0,nt.Z)((0,nt.Z)({},m),{},{offsetWidth:h,offsetHeight:f});null===r||void 0===r||r(v,e,n),a&&Promise.resolve().then((function(){a(v,e)}))}}),[]);return n.useEffect((function(){var e,t,a=h();return a&&!l&&(e=a,t=f,ut.has(e)||(ut.set(e,new Set),pt.observe(e)),ut.get(e).add(t)),function(){return function(e,t){ut.has(e)&&(ut.get(e).delete(t),ut.get(e).size||(pt.unobserve(e),ut.delete(e)))}(a,f)}}),[s.current,l]),n.createElement(vt,{ref:i},u?n.cloneElement(d,{ref:m}):d)}const yt=n.forwardRef(Zt);function _t(e,t){var a=e.children;return("function"===typeof a?[a]:(0,rt.Z)(a)).map((function(a,l){var s=(null===a||void 0===a?void 0:a.key)||"".concat("rc-observer-key","-").concat(l);return n.createElement(yt,(0,at.Z)({},e,{key:s,ref:0===l?t:void 0}),a)}))}var xt=n.forwardRef(_t);xt.Collection=function(e){var t=e.children,a=e.onBatchResize,l=n.useRef(0),s=n.useRef([]),i=n.useContext(bt),r=n.useCallback((function(e,t,n){l.current+=1;var r=l.current;s.current.push({size:e,element:t,data:n}),Promise.resolve().then((function(){r===l.current&&(null===a||void 0===a||a(s.current),s.current=[])})),null===i||void 0===i||i(e,t,n)}),[a,i]);return n.createElement(bt.Provider,{value:r},t)};const St=xt;var wt=n.forwardRef((function(e,t){var a=e.height,l=e.offset,s=e.children,i=e.prefixCls,r=e.onInnerResize,o=e.innerProps,d={},c={display:"flex",flexDirection:"column"};return void 0!==l&&(d={height:a,position:"relative",overflow:"hidden"},c=(0,nt.Z)((0,nt.Z)({},c),{},{transform:"translateY(".concat(l,"px)"),position:"absolute",left:0,right:0,top:0})),n.createElement("div",{style:d},n.createElement(St,{onResize:function(e){e.offsetHeight&&r&&r()}},n.createElement("div",(0,at.Z)({style:c,className:tt()((0,lt.Z)({},"".concat(i,"-holder-inner"),i)),ref:t},o),s)))}));wt.displayName="Filler";const Et=wt;var kt=a(75164);function Pt(e){return"touches"in e?e.touches[0].pageY:e.pageY}var Ct=function(e){(0,gt.Z)(a,e);var t=(0,ft.Z)(a);function a(){var e;(0,mt.Z)(this,a);for(var l=arguments.length,s=new Array(l),i=0;i<l;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).moveRaf=null,e.scrollbarRef=n.createRef(),e.thumbRef=n.createRef(),e.visibleTimeout=null,e.state={dragging:!1,pageY:null,startTop:null,visible:!1},e.delayHidden=function(){clearTimeout(e.visibleTimeout),e.setState({visible:!0}),e.visibleTimeout=setTimeout((function(){e.setState({visible:!1})}),2e3)},e.onScrollbarTouchStart=function(e){e.preventDefault()},e.onContainerMouseDown=function(e){e.stopPropagation(),e.preventDefault()},e.patchEvents=function(){window.addEventListener("mousemove",e.onMouseMove),window.addEventListener("mouseup",e.onMouseUp),e.thumbRef.current.addEventListener("touchmove",e.onMouseMove),e.thumbRef.current.addEventListener("touchend",e.onMouseUp)},e.removeEvents=function(){window.removeEventListener("mousemove",e.onMouseMove),window.removeEventListener("mouseup",e.onMouseUp),e.thumbRef.current&&(e.thumbRef.current.removeEventListener("touchmove",e.onMouseMove),e.thumbRef.current.removeEventListener("touchend",e.onMouseUp)),kt.Z.cancel(e.moveRaf)},e.onMouseDown=function(t){var a=e.props.onStartMove;e.setState({dragging:!0,pageY:Pt(t),startTop:e.getTop()}),a(),e.patchEvents(),t.stopPropagation(),t.preventDefault()},e.onMouseMove=function(t){var a=e.state,n=a.dragging,l=a.pageY,s=a.startTop,i=e.props.onScroll;if(kt.Z.cancel(e.moveRaf),n){var r=s+(Pt(t)-l),o=e.getEnableScrollRange(),d=e.getEnableHeightRange(),c=d?r/d:0,u=Math.ceil(c*o);e.moveRaf=(0,kt.Z)((function(){i(u)}))}},e.onMouseUp=function(){var t=e.props.onStopMove;e.setState({dragging:!1}),t(),e.removeEvents()},e.getSpinHeight=function(){var t=e.props,a=t.height,n=a/t.count*10;return n=Math.max(n,20),n=Math.min(n,a/2),Math.floor(n)},e.getEnableScrollRange=function(){var t=e.props;return t.scrollHeight-t.height||0},e.getEnableHeightRange=function(){return e.props.height-e.getSpinHeight()||0},e.getTop=function(){var t=e.props.scrollTop,a=e.getEnableScrollRange(),n=e.getEnableHeightRange();return 0===t||0===a?0:t/a*n},e.showScroll=function(){var t=e.props,a=t.height;return t.scrollHeight>a},e}return(0,ht.Z)(a,[{key:"componentDidMount",value:function(){this.scrollbarRef.current.addEventListener("touchstart",this.onScrollbarTouchStart),this.thumbRef.current.addEventListener("touchstart",this.onMouseDown)}},{key:"componentDidUpdate",value:function(e){e.scrollTop!==this.props.scrollTop&&this.delayHidden()}},{key:"componentWillUnmount",value:function(){var e,t;this.removeEvents(),null===(e=this.scrollbarRef.current)||void 0===e||e.removeEventListener("touchstart",this.onScrollbarTouchStart),null===(t=this.thumbRef.current)||void 0===t||t.removeEventListener("touchstart",this.onMouseDown),clearTimeout(this.visibleTimeout)}},{key:"render",value:function(){var e=this.state,t=e.dragging,a=e.visible,l=this.props,s=l.prefixCls,i=l.direction,r=this.getSpinHeight(),o=this.getTop(),d=this.showScroll(),c=d&&a,u="rtl"===i?{left:0}:{right:0};return n.createElement("div",{ref:this.scrollbarRef,className:tt()("".concat(s,"-scrollbar"),(0,lt.Z)({},"".concat(s,"-scrollbar-show"),d)),style:(0,nt.Z)((0,nt.Z)({width:8,top:0,bottom:0},u),{},{position:"absolute",display:c?null:"none"}),onMouseDown:this.onContainerMouseDown,onMouseMove:this.delayHidden},n.createElement("div",{ref:this.thumbRef,className:tt()("".concat(s,"-scrollbar-thumb"),(0,lt.Z)({},"".concat(s,"-scrollbar-thumb-moving"),t)),style:{width:"100%",height:r,top:o,left:0,position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"},onMouseDown:this.onMouseDown}))}}]),a}(n.Component);function It(e){var t=e.children,a=e.setRef,l=n.useCallback((function(e){a(e)}),[]);return n.cloneElement(t,{ref:l})}const Nt=function(){function e(){(0,mt.Z)(this,e),this.maps=void 0,this.maps=Object.create(null)}return(0,ht.Z)(e,[{key:"set",value:function(e,t){this.maps[e]=t}},{key:"get",value:function(e){return this.maps[e]}}]),e}();var Tt=a(190484);function Mt(e,t,a){var l=n.useState(e),s=(0,st.Z)(l,2),i=s[0],r=s[1],o=n.useState(null),d=(0,st.Z)(o,2),c=d[0],u=d[1];return n.useEffect((function(){var n=function(e,t,a){var n,l,s=e.length,i=t.length;if(0===s&&0===i)return null;s<i?(n=e,l=t):(n=t,l=e);var r={__EMPTY_ITEM__:!0};function o(e){return void 0!==e?a(e):r}for(var d=null,c=1!==Math.abs(s-i),u=0;u<l.length;u+=1){var p=o(n[u]);if(p!==o(l[u])){d=u,c=c||p!==o(l[u+1]);break}}return null===d?null:{index:d,multiple:c}}(i||[],e||[],t);void 0!==(null===n||void 0===n?void 0:n.index)&&(null===a||void 0===a||a(n.index),u(e[n.index])),r(e)}),[e]),[c]}const Lt="object"===("undefined"===typeof navigator?"undefined":(0,Tt.Z)(navigator))&&/Firefox/i.test(navigator.userAgent),Dt=function(e,t){var a=(0,n.useRef)(!1),l=(0,n.useRef)(null);var s=(0,n.useRef)({top:e,bottom:t});return s.current.top=e,s.current.bottom=t,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e<0&&s.current.top||e>0&&s.current.bottom;return t&&n?(clearTimeout(l.current),a.current=!1):n&&!a.current||(clearTimeout(l.current),a.current=!0,l.current=setTimeout((function(){a.current=!1}),50)),!a.current&&n}};var $t=a(908410),Rt=14/15;var Ot=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","component","onScroll","onVisibleChange","innerProps"],jt=[],At={overflowY:"auto",overflowAnchor:"none"};function Ut(e,t){var a=e.prefixCls,l=void 0===a?"rc-virtual-list":a,s=e.className,i=e.height,r=e.itemHeight,o=e.fullHeight,d=void 0===o||o,c=e.style,u=e.data,p=e.children,m=e.itemKey,h=e.virtual,g=e.direction,f=e.component,v=void 0===f?"div":f,b=e.onScroll,Z=e.onVisibleChange,y=e.innerProps,_=(0,it.Z)(e,Ot),x=!(!1===h||!i||!r),S=x&&u&&r*u.length>i,w=(0,n.useState)(0),E=(0,st.Z)(w,2),k=E[0],P=E[1],C=(0,n.useState)(!1),I=(0,st.Z)(C,2),N=I[0],T=I[1],M=tt()(l,(0,lt.Z)({},"".concat(l,"-rtl"),"rtl"===g),s),L=u||jt,D=(0,n.useRef)(),$=(0,n.useRef)(),R=(0,n.useRef)(),O=n.useCallback((function(e){return"function"===typeof m?m(e):null===e||void 0===e?void 0:e[m]}),[m]),j={getKey:O};function A(e){P((function(t){var a=function(e){var t=e;Number.isNaN(ae.current)||(t=Math.min(t,ae.current));return t=Math.max(t,0),t}("function"===typeof e?e(t):e);return D.current.scrollTop=a,a}))}var U=(0,n.useRef)({start:0,end:L.length}),F=(0,n.useRef)(),K=Mt(L,O),z=(0,st.Z)(K,1)[0];F.current=z;var Y=function(e,t,a){var l=n.useState(0),s=(0,st.Z)(l,2),i=s[0],r=s[1],o=(0,n.useRef)(new Map),d=(0,n.useRef)(new Nt),c=(0,n.useRef)();function u(){kt.Z.cancel(c.current)}function p(){u(),c.current=(0,kt.Z)((function(){o.current.forEach((function(e,t){if(e&&e.offsetParent){var a=(0,dt.Z)(e),n=a.offsetHeight;d.current.get(t)!==n&&d.current.set(t,a.offsetHeight)}})),r((function(e){return e+1}))}))}return(0,n.useEffect)((function(){return u}),[]),[function(n,l){var s=e(n),i=o.current.get(s);l?(o.current.set(s,l),p()):o.current.delete(s),!i!==!l&&(l?null===t||void 0===t||t(n):null===a||void 0===a||a(n))},p,d.current,i]}(O,null,null),H=(0,st.Z)(Y,4),V=H[0],q=H[1],G=H[2],B=H[3],W=n.useMemo((function(){if(!x)return{scrollHeight:void 0,start:0,end:L.length-1,offset:void 0};var e;if(!S)return{scrollHeight:(null===(e=$.current)||void 0===e?void 0:e.offsetHeight)||0,start:0,end:L.length-1,offset:void 0};for(var t,a,n,l=0,s=L.length,o=0;o<s;o+=1){var d=L[o],c=O(d),u=G.get(c),p=l+(void 0===u?r:u);p>=k&&void 0===t&&(t=o,a=l),p>k+i&&void 0===n&&(n=o),l=p}return void 0===t&&(t=0,a=0,n=Math.ceil(i/r)),void 0===n&&(n=L.length-1),{scrollHeight:l,start:t,end:n=Math.min(n+1,L.length),offset:a}}),[S,x,k,L,B,i]),J=W.scrollHeight,X=W.start,Q=W.end,ee=W.offset;U.current.start=X,U.current.end=Q;var te=J-i,ae=(0,n.useRef)(te);ae.current=te;var ne=k<=0,le=k>=te,se=Dt(ne,le);var ie=function(e,t,a,l){var s=(0,n.useRef)(0),i=(0,n.useRef)(null),r=(0,n.useRef)(null),o=(0,n.useRef)(!1),d=Dt(t,a);return[function(t){if(e){kt.Z.cancel(i.current);var a=t.deltaY;s.current+=a,r.current=a,d(a)||(Lt||t.preventDefault(),i.current=(0,kt.Z)((function(){var e=o.current?10:1;l(s.current*e),s.current=0})))}},function(t){e&&(o.current=t.detail===r.current)}]}(x,ne,le,(function(e){A((function(t){return t+e}))})),re=(0,st.Z)(ie,2),oe=re[0],de=re[1];!function(e,t,a){var l,s=(0,n.useRef)(!1),i=(0,n.useRef)(0),r=(0,n.useRef)(null),o=(0,n.useRef)(null),d=function(e){if(s.current){var t=Math.ceil(e.touches[0].pageY),n=i.current-t;i.current=t,a(n)&&e.preventDefault(),clearInterval(o.current),o.current=setInterval((function(){(!a(n*=Rt,!0)||Math.abs(n)<=.1)&&clearInterval(o.current)}),16)}},c=function(){s.current=!1,l()},u=function(e){l(),1!==e.touches.length||s.current||(s.current=!0,i.current=Math.ceil(e.touches[0].pageY),r.current=e.target,r.current.addEventListener("touchmove",d),r.current.addEventListener("touchend",c))};l=function(){r.current&&(r.current.removeEventListener("touchmove",d),r.current.removeEventListener("touchend",c))},(0,$t.Z)((function(){return e&&t.current.addEventListener("touchstart",u),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("touchstart",u),l(),clearInterval(o.current)}}),[e])}(x,D,(function(e,t){return!se(e,t)&&(oe({preventDefault:function(){},deltaY:e}),!0)})),(0,$t.Z)((function(){function e(e){x&&e.preventDefault()}return D.current.addEventListener("wheel",oe),D.current.addEventListener("DOMMouseScroll",de),D.current.addEventListener("MozMousePixelScroll",e),function(){D.current&&(D.current.removeEventListener("wheel",oe),D.current.removeEventListener("DOMMouseScroll",de),D.current.removeEventListener("MozMousePixelScroll",e))}}),[x]);var ce=function(e,t,a,l,s,i,r,o){var d=n.useRef();return function(n){if(null!==n&&void 0!==n){if(kt.Z.cancel(d.current),"number"===typeof n)r(n);else if(n&&"object"===(0,Tt.Z)(n)){var c,u=n.align;c="index"in n?n.index:t.findIndex((function(e){return s(e)===n.key}));var p=n.offset,m=void 0===p?0:p;!function n(o,p){if(!(o<0)&&e.current){var h=e.current.clientHeight,g=!1,f=p;if(h){for(var v=p||u,b=0,Z=0,y=0,_=Math.min(t.length,c),x=0;x<=_;x+=1){var S=s(t[x]);Z=b;var w=a.get(S);b=y=Z+(void 0===w?l:w),x===c&&void 0===w&&(g=!0)}var E=null;switch(v){case"top":E=Z-m;break;case"bottom":E=y-h+m;break;default:var k=e.current.scrollTop;Z<k?f="top":y>k+h&&(f="bottom")}null!==E&&E!==e.current.scrollTop&&r(E)}d.current=(0,kt.Z)((function(){g&&i(),n(o-1,f)}),2)}}(3)}}else o()}}(D,L,G,r,O,q,A,(function(){var e;null===(e=R.current)||void 0===e||e.delayHidden()}));n.useImperativeHandle(t,(function(){return{scrollTo:ce}})),(0,$t.Z)((function(){if(Z){var e=L.slice(X,Q+1);Z(e,L)}}),[X,Q,L]);var ue=function(e,t,a,l,s,i){var r=i.getKey;return e.slice(t,a+1).map((function(e,a){var i=s(e,t+a,{}),o=r(e);return n.createElement(It,{key:o,setRef:function(t){return l(e,t)}},i)}))}(L,X,Q,V,p,j),pe=null;return i&&(pe=(0,nt.Z)((0,lt.Z)({},d?"height":"maxHeight",i),At),x&&(pe.overflowY="hidden",N&&(pe.pointerEvents="none"))),n.createElement("div",(0,at.Z)({style:(0,nt.Z)((0,nt.Z)({},c),{},{position:"relative"}),className:M},_),n.createElement(v,{className:"".concat(l,"-holder"),style:pe,ref:D,onScroll:function(e){var t=e.currentTarget.scrollTop;t!==k&&A(t),null===b||void 0===b||b(e)}},n.createElement(Et,{prefixCls:l,height:J,offset:ee,onInnerResize:q,ref:$,innerProps:y},ue)),x&&n.createElement(Ct,{ref:R,prefixCls:l,scrollTop:k,height:i,scrollHeight:J,count:L.length,direction:g,onScroll:function(e){A(e)},onStartMove:function(){T(!0)},onStopMove:function(){T(!1)}}))}var Ft=n.forwardRef(Ut);Ft.displayName="List";const Kt=Ft;var zt=a(9875),Yt=a(49238),Ht=a(517982),Vt=a(940277),qt=a(73995),Gt=a(961337);const Bt=(0,u.iK)(d.Z.Search)`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,Wt=u.iK.div`
  ${({theme:e})=>`\n    max-width: ${87.5*e.gridUnit}px;\n    padding: ${4*e.gridUnit}px;\n    height: 100%;\n    background-color: ${e.colors.grayscale.light5};\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    .emptystate {\n      flex: 1;\n    }\n    .section {\n      position: relative;\n\n      .refresh {\n        margin: 0;\n        position: absolute;\n        top: ${.5*e.gridUnit}px;\n        left: ${8*e.gridUnit}px;\n      }\n    }\n    .section-title {\n      margin-bottom: ${5*e.gridUnit}px;\n      font-weight: ${e.typography.weights.bold};\n    }\n    .table-form {\n      margin-top: ${5*e.gridUnit}px;\n      margin-bottom: ${5*e.gridUnit}px;\n\n      .table-title {\n        margin-bottom: ${5*e.gridUnit}px;\n        font-weight: ${e.typography.weights.bold};\n        position: relative;\n  \n        > span[aria-label="refresh"] {\n          margin-left: ${2.5*e.gridUnit}px;\n          font-size: ${4.25*e.gridUnit}px;\n        }\n      }\n    }\n    .options-list {\n      flex: 1;\n      overflow: auto;\n\n      .options {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        cursor: pointer;\n        padding: ${1.75*e.gridUnit}px;\n        border-radius: ${e.borderRadius}px;\n        :hover {\n          background-color: ${e.colors.grayscale.light4}\n        }\n\n        &.highlighted {\n          background-color: ${e.colors.primary.dark1};\n          color: ${e.colors.grayscale.light5};\n        }\n      }\n    }\n    .loading-container {\n      position: absolute;\n      top: ${89.75*e.gridUnit}px;\n      left: 0;\n      right: 0;\n      text-align: center;\n      img {\n        width: ${20*e.gridUnit}px;\n        margin-bottom: ${2.5*e.gridUnit}px;\n      }\n      p {\n        color: ${e.colors.grayscale.light1};\n      }\n    }\n`}
`;function Jt({setDataset:e,dataset:t,datasetNames:a}){var l;const s=(0,u.Fg)(),[r,o]=(0,n.useState)(0),[c,m]=(0,n.useState)([]),[h,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[b,Z]=(0,n.useState)(""),[y,_]=(0,n.useState)(!1),[x,S]=(0,n.useState)(null),{addDangerToast:w}=(0,G.e1)(),E=(0,n.useCallback)((t=>{e({type:I.selectDatabase,payload:{db:t}}),S(null),g(!0)}),[e]),k=(0,n.useCallback)((e=>{be.Z.get({url:e}).then((({json:e})=>{const t=e.result.map((e=>({value:e.value,label:(0,p.tZ)(Ht.ez,{table:e}),text:e.label})));m(t),v(!1),g(!1),_(!1)})).catch((e=>{w((0,i.t)("There was an error fetching tables")),Ze.Z.error((0,i.t)("There was an error fetching tables"),e)}))}),[w]),P=null!=t&&t.schema?encodeURIComponent(null==t?void 0:t.schema):void 0;(0,n.useEffect)((()=>{const e=(0,Gt.rV)(Gt.dR.db,null);e&&E(e)}),[E]),(0,n.useEffect)((()=>{if(f){var e;const a=Qe().encode({force:y,schema_name:P}),n=`/api/v1/database/${null==t||null==(e=t.db)?void 0:e.id}/tables/?q=${a}`;k(n)}}),[f,null==t||null==(l=t.db)?void 0:l.id,P,k,y]),(0,n.useEffect)((()=>{h&&(m([]),g(!1))}),[h]);const C=c.filter((e=>{var t;return null==e||null==(t=e.value)?void 0:t.toLowerCase().includes(b.toLowerCase())})),N=e=>(0,p.tZ)("div",{className:"loading-container"},(0,p.tZ)(xe.Z,{position:"inline"}),(0,p.tZ)("p",null,e)),T=(0,i.t)("Select database & schema"),M=(0,i.t)("Table loading"),L=(0,i.t)("No database tables found"),D=(0,i.t)("Try selecting a different schema"),$=(0,i.t)("Select database table"),R=(0,i.t)("Refresh table list"),O=(0,i.t)("Refresh tables"),j=(0,i.t)("Search tables"),[A,U]=(0,n.useState)(!1);return(0,p.tZ)(Wt,null,(0,p.tZ)("p",{className:"section-title db-schema"},T),(0,p.tZ)(qt.ZP,{db:null==t?void 0:t.db,handleError:w,onDbChange:E,onSchemaChange:t=>{t&&(e({type:I.selectSchema,payload:{name:"schema",value:t}}),v(!0)),S(null),g(!0)},emptyState:(0,H.UX)(A),onEmptyResults:e=>{U(!!e)}}),f&&!y&&N(M),(null==t?void 0:t.schema)&&!f&&!c.length&&!b&&(0,p.tZ)("div",{className:"emptystate"},(0,p.tZ)(H.x3,{image:"empty-table.svg",title:L,description:D})),(null==t?void 0:t.schema)&&(c.length>0||b.length>0)&&(0,p.tZ)(n.Fragment,null,(0,p.tZ)(Yt.l0,{className:"table-form"},(0,p.tZ)("p",{className:"table-title"},$,(0,p.tZ)(Vt.Z,{onClick:()=>{v(!0),_(!0)},tooltipContent:R})),y&&N(O),!y&&(0,p.tZ)(zt.II,{value:b,prefix:(0,p.tZ)(Bt,{iconSize:"l"}),onChange:e=>{Z(e.target.value)},placeholder:j,allowClear:!0})),!y&&(0,p.tZ)("div",{className:"options-list","data-test":"options-list","data-height":r,ref:e=>{o((null==e?void 0:e.clientHeight)||0)}},r&&(0,p.tZ)(Kt,{data:C,height:r,itemHeight:30,itemKey:"value"},((t,n)=>(0,p.tZ)("div",{className:tt()(["options",{highlighted:x===n}]),key:n,role:"button",tabIndex:0,onClick:()=>{return a=t.value,S(n),void e({type:I.selectTable,payload:{name:"table_name",value:a}});var a}},t.label,(null==a?void 0:a.includes(t.value))&&(0,p.tZ)(d.Z.Warning,{iconColor:x===n?s.colors.grayscale.light5:s.colors.info.base,iconSize:"m",css:p.iv`
                            margin-right: ${2*s.gridUnit}px;
                          `})))))))}var Xt=a(797381),Qt=a(203741);const ea=["db","schema","table_name"],ta=[Qt.Ph,Qt.FY,Qt.Eh,Qt.TA];const aa=(0,G.ZP)((function({datasetObject:e,addDangerToast:t,hasColumns:a=!1,datasets:s}){const r=(0,l.k6)(),{createResource:d}=(0,B.LE)("dataset",(0,i.t)("dataset"),t),c=(0,i.t)("Select a database table."),u=(0,i.t)("Create dataset and create chart"),m=!(null!=e&&e.table_name)||!a||(null==s?void 0:s.includes(null==e?void 0:e.table_name));return(0,p.tZ)(n.Fragment,null,(0,p.tZ)(o.Z,{onClick:()=>{if(e){const t=(e=>{let t=0;const a=Object.keys(e).reduce(((a,n)=>(ea.includes(n)&&e[n]&&(t+=1),t)),0);return ta[a]})(e);(0,Xt.logEvent)(t,e)}else(0,Xt.logEvent)(Qt.Ph,{});r.goBack()}},(0,i.t)("Cancel")),(0,p.tZ)(o.Z,{buttonStyle:"primary",disabled:m,tooltip:null!=e&&e.table_name?void 0:c,onClick:()=>{if(e){var t;const a={database:null==(t=e.db)?void 0:t.id,schema:e.schema,table_name:e.table_name};d(a).then((t=>{t&&"number"===typeof t&&((0,Xt.logEvent)(Qt.P$,e),r.push(`/chart/add/?dataset=${e.table_name}`))}))}}},u))}));function na({header:e,leftPanel:t,datasetPanel:a,rightPanel:n,footer:l}){return(0,p.tZ)(m,{"data-test":"dataset-layout-wrapper"},e&&(0,p.tZ)(_,null,e),(0,p.tZ)(b,null,t&&(0,p.tZ)(g,null,(0,p.tZ)(S,null,t)),(0,p.tZ)(f,null,(0,p.tZ)(Z,null,a&&(0,p.tZ)(w,null,a),n&&(0,p.tZ)(E,null,n)),(0,p.tZ)(y,null,l&&(0,p.tZ)(k,null,l)))))}function la(e,t){const a={...e||{}};switch(t.type){case I.selectDatabase:return{...a,...t.payload,schema:null,table_name:null};case I.selectSchema:return{...a,[t.payload.name]:t.payload.value,table_name:null};case I.selectTable:return{...a,[t.payload.name]:t.payload.value};case I.changeDataset:return{...a,[t.payload.name]:t.payload.value};default:return null}}const sa="/tablemodelview/list/?pageIndex=0&sortColumn=changed_on_delta_humanized&sortOrder=desc";function ia(){const[e,t]=(0,n.useReducer)(la,null),[a,i]=(0,n.useState)(!1),[r,o]=(0,n.useState)(!1),{datasets:d,datasetNames:c}=(0,s.Fk)(null==e?void 0:e.db,null==e?void 0:e.schema),{datasetId:u}=(0,l.UO)();(0,n.useEffect)((()=>{Number.isNaN(parseInt(u,10))||o(!0)}),[u]);return(0,p.tZ)(na,{header:(0,p.tZ)(D,{setDataset:t,title:null==e?void 0:e.table_name}),leftPanel:r?null:(0,p.tZ)(Jt,{setDataset:t,dataset:e,datasetNames:c}),datasetPanel:r?(0,p.tZ)(ve,{id:u}):(0,p.tZ)(Je,{tableName:null==e?void 0:e.table_name,dbId:null==e||null==(m=e.db)?void 0:m.id,schema:null==e?void 0:e.schema,setHasColumns:i,datasets:d}),footer:(0,p.tZ)(aa,{url:sa,datasetObject:e,hasColumns:a,datasets:c})});var m}},14025:(e,t,a)=>{a.d(t,{Cq:()=>c,Fk:()=>u,bI:()=>p});var n=a(667294),l=a(431069),s=a(455867),i=a(68492),r=a(115926),o=a.n(r),d=a(672570);function c({queries:e,fetchData:t,currentQueryId:a}){const l=e.findIndex((e=>e.id===a)),[s,i]=(0,n.useState)(l),[r,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1);function u(){o(0===s),c(s===e.length-1)}function p(a){const n=s+(a?-1:1);n>=0&&n<e.length&&(t(e[n].id),i(n),u())}return(0,n.useEffect)((()=>{u()})),{handleKeyPress:function(t){s>=0&&s<e.length&&("ArrowDown"===t.key||"k"===t.key?(t.preventDefault(),p(!1)):"ArrowUp"!==t.key&&"j"!==t.key||(t.preventDefault(),p(!0)))},handleDataChange:p,disablePrevious:r,disableNext:d}}const u=(e,t)=>{const[a,r]=(0,n.useState)([]),c=t?encodeURIComponent(t):void 0,u=(0,n.useCallback)((async e=>{let t,a=[],n=0;for(;void 0===t||a.length<t;){const r=o().encode_uri({filters:e,page:n});try{const e=await l.Z.get({endpoint:`/api/v1/dataset/?q=${r}`});({count:t}=e.json);const{json:{result:s}}=e;a=[...a,...s],n+=1}catch(e){(0,d.Gb)((0,s.t)("There was an error fetching dataset")),i.Z.error((0,s.t)("There was an error fetching dataset"),e)}}r(a)}),[]);(0,n.useEffect)((()=>{const a=[{col:"database",opr:"rel_o_m",value:null==e?void 0:e.id},{col:"schema",opr:"eq",value:c},{col:"sql",opr:"dataset_is_null_or_empty",value:!0}];t&&u(a)}),[null==e?void 0:e.id,t,c,u]);const p=null==a?void 0:a.map((e=>e.table_name));return{datasets:a,datasetNames:p}},p=e=>{const[t,a]=(0,n.useState)(0),r=(0,n.useCallback)((()=>l.Z.get({endpoint:`/api/v1/dataset/${e}/related_objects`}).then((({json:e})=>{a(null==e?void 0:e.charts.count)})).catch((e=>{(0,d.Gb)((0,s.t)("There was an error fetching dataset's related objects")),i.Z.error(e)}))),[e]);return(0,n.useEffect)((()=>{e&&r()}),[e,r]),{usageCount:t}}},656590:(e,t)=>{t.ITEM_TYPES={PAGE:"PAGE",ELLIPSIS:"ELLIPSIS",FIRST_PAGE_LINK:"FIRST_PAGE_LINK",PREVIOUS_PAGE_LINK:"PREVIOUS_PAGE_LINK",NEXT_PAGE_LINK:"NEXT_PAGE_LINK",LAST_PAGE_LINK:"LAST_PAGE_LINK"},t.ITEM_KEYS={FIRST_ELLIPSIS:-1,SECOND_ELLIPSIS:-2,FIRST_PAGE_LINK:-3,PREVIOUS_PAGE_LINK:-4,NEXT_PAGE_LINK:-5,LAST_PAGE_LINK:-6}},653804:(e,t,a)=>{var n=a(656590);t.createFirstEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.FIRST_ELLIPSIS,value:e,isActive:!1}},t.createSecondEllipsis=function(e){return{type:n.ITEM_TYPES.ELLIPSIS,key:n.ITEM_KEYS.SECOND_ELLIPSIS,value:e,isActive:!1}},t.createFirstPageLink=function(e){var t=e.currentPage;return{type:n.ITEM_TYPES.FIRST_PAGE_LINK,key:n.ITEM_KEYS.FIRST_PAGE_LINK,value:1,isActive:1===t}},t.createPreviousPageLink=function(e){var t=e.currentPage;return{type:n.ITEM_TYPES.PREVIOUS_PAGE_LINK,key:n.ITEM_KEYS.PREVIOUS_PAGE_LINK,value:Math.max(1,t-1),isActive:1===t}},t.createNextPageLink=function(e){var t=e.currentPage,a=e.totalPages;return{type:n.ITEM_TYPES.NEXT_PAGE_LINK,key:n.ITEM_KEYS.NEXT_PAGE_LINK,value:Math.min(a,t+1),isActive:t===a}},t.createLastPageLink=function(e){var t=e.currentPage,a=e.totalPages;return{type:n.ITEM_TYPES.LAST_PAGE_LINK,key:n.ITEM_KEYS.LAST_PAGE_LINK,value:a,isActive:t===a}},t.createPageFunctionFactory=function(e){var t=e.currentPage;return function(e){return{type:n.ITEM_TYPES.PAGE,key:e,value:e,isActive:e===t}}}},1158:(e,t)=>{t.createRange=function(e,t){for(var a=[],n=e;n<=t;n++)a.push(n);return a}},402371:(e,t,a)=>{var n=a(1158),l=a(653804);t.getPaginationModel=function(e){if(null==e)throw new Error("getPaginationModel(): options object should be a passed");var t=Number(e.totalPages);if(isNaN(t))throw new Error("getPaginationModel(): totalPages should be a number");if(t<0)throw new Error("getPaginationModel(): totalPages shouldn't be a negative number");var a=Number(e.currentPage);if(isNaN(a))throw new Error("getPaginationModel(): currentPage should be a number");if(a<0)throw new Error("getPaginationModel(): currentPage shouldn't be a negative number");if(a>t)throw new Error("getPaginationModel(): currentPage shouldn't be greater than totalPages");var s=null==e.boundaryPagesRange?1:Number(e.boundaryPagesRange);if(isNaN(s))throw new Error("getPaginationModel(): boundaryPagesRange should be a number");if(s<0)throw new Error("getPaginationModel(): boundaryPagesRange shouldn't be a negative number");var i=null==e.siblingPagesRange?1:Number(e.siblingPagesRange);if(isNaN(i))throw new Error("getPaginationModel(): siblingPagesRange should be a number");if(i<0)throw new Error("getPaginationModel(): siblingPagesRange shouldn't be a negative number");var r=Boolean(e.hidePreviousAndNextPageLinks),o=Boolean(e.hideFirstAndLastPageLinks),d=Boolean(e.hideEllipsis),c=d?0:1,u=[],p=l.createPageFunctionFactory(e);if(o||u.push(l.createFirstPageLink(e)),r||u.push(l.createPreviousPageLink(e)),1+2*c+2*i+2*s>=t){var m=n.createRange(1,t).map(p);u.push.apply(u,m)}else{var h=s,g=n.createRange(1,h).map(p),f=t+1-s,v=t,b=n.createRange(f,v).map(p),Z=Math.min(Math.max(a-i,h+c+1),f-c-2*i-1),y=Z+2*i,_=n.createRange(Z,y).map(p);if(u.push.apply(u,g),!d){var x=Z-1,S=(x===h+1?p:l.createFirstEllipsis)(x);u.push(S)}if(u.push.apply(u,_),!d){var w=y+1,E=(w===f-1?p:l.createSecondEllipsis)(w);u.push(E)}u.push.apply(u,b)}return r||u.push(l.createNextPageLink(e)),o||u.push(l.createLastPageLink(e)),u};var s=a(656590);t.ITEM_TYPES=s.ITEM_TYPES,t.ITEM_KEYS=s.ITEM_KEYS}}]);