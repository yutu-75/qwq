"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[22775],{133576:(e,t,a)=>{a.d(t,{Z:()=>h});var l=a(667294),n=a(981945),o=a(814277),u=a(828216),s=a(542170),i=a(973935),r=a(226618),d=a(211965);const v={minWidth:"60px",width:"100%",height:"30px",lineHeight:"15px",textAlign:"center",fontSize:"12px",background:"#f0f2f5",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},c=(e,t)=>{const{data:a,options:c,multiSelect:h,onSelectionChange:m=(()=>{}),filterState:p,id:f}=e,b=(0,u.v9)((e=>e.dashboardState.mobileFilterStatus)),Z=(0,u.v9)((e=>e.dashboardState.drawerStatus)),[g,S]=(0,l.useState)(p.value?p.value:[]),[w,y]=(0,l.useState)(p.value?p.value:[]),[C,k]=(0,l.useState)(null);(0,l.useEffect)((()=>{Z&&p.value&&(0,i.unstable_batchedUpdates)((()=>{S(p.value?p.value:[]),y(p.value?p.value:[])}))}),[Z]),(0,l.useImperativeHandle)(t,(()=>({viewValus:e=>{S(e)},viewIndex:e=>{y(e)}})),[]);const x=(e,t)=>{if(h)if(g.includes(e)){const a=g.filter((t=>t!==e)),l=w.filter((e=>e!==t));S(a),y(l),m(a,l)}else{const a=[...g,e],l=[...w,t];S(a),y(l),m(a,l)}else g.includes(e)?(S([]),y(""),m([],"")):(S([e]),y(t),m([e],t))},F=()=>{a.onOpen(),m(g,w,true)};let N=null;const M=e=>t=>{t.preventDefault(),N=setTimeout((()=>{k(e)}),500)},I=()=>{k(null),clearTimeout(N)};return(0,l.useEffect)((()=>{if(p.label){const e=c.find((e=>e.label===p.label));e&&!1===h&&y(e.label)}else y([])}),[p.label]),(0,s.Z)((()=>{!b.confirm&&b.reset&&(S([]),y([]))}),[JSON.stringify(b)]),(0,d.tZ)(l.Fragment,null,c.length>0?(0,d.tZ)(n.rj,{columns:3,gap:8},c.length>8?(0,d.tZ)(l.Fragment,null,c.slice(0,8).map((e=>(0,d.tZ)(n.rj.Item,{key:`${f}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value},(0,d.tZ)(n.zx,{shape:"rounded",style:{...v,background:g.includes(e.value)?r.Fu:"#f0f2f5",color:g.includes(e.value)?r.zP:"#000000"},onClick:()=>x(e.value,e.label),onTouchStart:M(e.value),onTouchEnd:I,onMouseDown:M(e.value),onMouseUp:I},e.label))))),(0,d.tZ)(n.rj.Item,{span:1},(0,d.tZ)(n.zx,{shape:"rounded",onClick:F,style:{...v}},"\u5c55\u5f00"))):c.map((e=>(0,d.tZ)(n.rj.Item,{key:`${f}-${e.value}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value,onVisibleChange:e=>{e||k(null)}},(0,d.tZ)(n.zx,{shape:"rounded",style:{...v,background:g.includes(e.value)?r.Fu:r.hR,color:g.includes(e.value)?r.zP:r.k2},onClick:()=>x(e.value,e.label),onTouchStart:M(e.value),onTouchEnd:I,onMouseDown:M(e.value),onMouseUp:I},e.label?e.label:e.value)))))):(0,d.tZ)(o.Z,{description:"\u6682\u65e0\u6570\u636e"}))},h=(0,l.forwardRef)(c)},722775:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var l=a(205872),n=a.n(l),o=a(667294),u=a(828216),s=a(355786),i=a(88889),r=a(455867),d=a(49937),v=a(981945),c=a(771230),h=a(515746),m=a(747933),p=a(814277),f=a(867e3),b=a(708509),Z=a(555453),g=a(401498),S=a(246789),w=a(133576),y=a(542170),C=a(211965);const k=e=>{const{onClose:t=(()=>{}),onOpen:a=(()=>{}),visible:l,data:n,options:s,onDetermine:i=(()=>{}),treeListData:r,id:d,name:k,filterState:x}=e,F=(0,u.v9)((e=>e.dashboardState.mobileFilterType)),N=(0,u.v9)((e=>e.dashboardState.mobileFilterStatus)),M=(0,u.v9)((e=>e.dashboardState.viewType||"rowAndColumn")),I=(0,u.v9)((e=>e.dashboardState.drawerStatus)),[T,O]=((0,u.v9)((e=>{var t;return(null==(t=e.dashboardState)?void 0:t.emulateRatio)||{width:350,height:680}})),(0,o.useState)(x.value&&x.value.length>0?x.value[0]:"")),[D,E]=(0,o.useState)(""),[$,A]=(0,o.useState)(s),[J,P]=(0,o.useState)(""),[R,_]=((0,u.v9)((e=>e.dashboardState.editMode)),(0,o.useState)(!1)),j=(0,o.useRef)(),z=(e,t)=>{const{viewValus:a,viewIndex:l}=j.current;a(e),l(t)},V=()=>{E(""),A(s),t()};(0,o.useEffect)((()=>{l&&!1===R&&O(x.value&&x.value.length>0?x.value[0]:"")}),[l]);const B=()=>{O(""),E(""),A(s)};return(0,y.Z)((()=>{N.confirm&&!N.reset&&J&&i(J),!N.confirm&&N.reset&&i()}),[JSON.stringify(N)]),(0,y.Z)((()=>{"grid"===M&&(N.confirm&&!N.reset&&J&&i(J),!N.confirm&&N.reset&&i())}),[JSON.stringify(N),J]),(0,C.tZ)(o.Fragment,null,(0,C.tZ)(f.Z,{id:d,name:k,onClick:a,type:F,defaultActiveKey:[d],multiSelect:!1},(0,C.tZ)(w.Z,{ref:j,data:e,options:s,onSelectionChange:(e,t,a)=>{P(e),O(t),_(a)},multiSelect:!1,filterState:x})),(0,C.tZ)("div",{className:"drop"},(0,C.tZ)(b.Z,{visible:l,onMaskClick:()=>{R?(z(J,T),V()):V()},position:"right"},(0,C.tZ)(Z.Z,null,(0,C.tZ)(g.Z,{text:k}),(0,C.tZ)("div",{className:"inputType"},(0,C.tZ)(v.II,{clearable:!0,value:D,onChange:e=>{const t=e.trim();E(e);const a=s.filter((e=>e.label.includes(t)));A(a)},placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u641c\u7d22",style:{"--text-align":"center"}})),(0,C.tZ)("div",{className:"warp"},$.length>0?$.map(((e,t)=>(0,C.tZ)(c.Z,{className:"borderBottom",key:e.label+"_"+e.value},(0,C.tZ)(h.Z,{className:"margins",span:20},e.label?e.label:e.value),(0,C.tZ)(h.Z,{className:"margins",span:4},(0,C.tZ)(m.ZP.Group,{onChange:t=>((e,t)=>{O(e.target.value),P(t.value)})(t,e),value:T},(0,C.tZ)(m.ZP,{value:e.value})))))):(0,C.tZ)(p.Z,{description:"\u6682\u65e0\u6570\u636e"})),(0,C.tZ)(S.Z,{onRest:()=>{R?(z("",""),B()):(i(),B())},onConfirm:()=>{0===I?R?(z(J,T),V()):(J&&i(J),V()):(z(J,T),t())}})))))};var x=a(174448),F=a(52004);function N(e){const{data:t,formData:a,height:l,width:v,setDataMask:c,setHoveredFilter:h,unsetHoveredFilter:m,setFocusedFilter:p,unsetFocusedFilter:f,setFilterActive:b,filterState:Z,inputRef:g}=e,{defaultValue:S}=a,w=(0,u.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_type})),[y,N]=(0,o.useState)(null!=S?S:[]),M=e=>{const t=(0,s.Z)(e);N(t);const a={};t.length&&(a.granularity_sqla=t[0]),c({extraFormData:a,filterState:{value:t.length?t:null}})};(0,o.useEffect)((()=>{M(null!=S?S:null)}),[JSON.stringify(S)]),(0,o.useEffect)((()=>{var e;M(null!=(e=Z.value)?e:null)}),[JSON.stringify(Z.value)]);const I=(t||[]).filter((e=>e.dtype===i.Z.TEMPORAL)),T=0===I.length?(0,r.t)("No time columns"):(0,r.tn)("%s option","%s options",I.length,I.length),O={};Z.validateMessage&&(O.extra=(0,C.tZ)(x.Am,{status:Z.validateStatus},Z.validateMessage));const D=I.map((e=>{const{column_name:t,verbose_name:a}=e;return{label:null!=a?a:t,value:t}}));let E=e=>(null==e?void 0:e.parentNode)||document.body;"grid"===w&&(E=()=>document.body);const[$,A]=(0,o.useState)(!1);return(0,u.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode}))===F.kB.MOBILE?(0,C.tZ)(k,{id:null==a?void 0:a.ftId,name:null==a?void 0:a.ftName,data:e,visible:$,onClose:()=>A(!1),onOpen:()=>A(!0),options:D,filterState:Z,onDetermine:e=>{M(e),A(!1)}}):(0,C.tZ)(x.un,{height:l,width:v},(0,C.tZ)(x.jp,n()({validateStatus:Z.validateStatus},O),(0,C.tZ)(d.Ph,{getPopupContainer:E,allowClear:!0,value:y,placeholder:T,onChange:M,onBlur:f,onFocus:p,onMouseEnter:h,onMouseLeave:m,ref:g,options:D,onDropdownVisibleChange:b})))}},174448:(e,t,a)=>{a.d(t,{Am:()=>s,jp:()=>u,un:()=>o});var l=a(751995),n=a(804591);const o=l.iK.div`
  min-height: ${({height:e})=>e}px;
  width: ${({width:e})=>e}px;
`,u=(0,l.iK)(n.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,s=l.iK.div`
  color: ${({theme:e,status:t="error"})=>{var a;return null==(a=e.colors[t])?void 0:a.base}};
`}}]);