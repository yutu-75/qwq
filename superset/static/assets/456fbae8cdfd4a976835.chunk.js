"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[21390],{734274:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var l=a(667294),s=a(164561),n=a(748086),o=a(519650),i=a(71577),d=a(931097),r=a(213958),c=a(747933),u=a(3006),p=a(757016),Z=a(432787),m=a(734041),h=(a(929119),a(455867)),f=a(431069),g=a(807500),v=a(203855),y=a(753141),x=a(135855),b=a(940287),w=a(211965);const P=()=>{const[e,t]=(0,l.useState)(!0),[a,P]=(0,l.useState)([]),[C,S]=(0,l.useState)(),[E,k]=(0,l.useState)([]),[j,_]=(0,l.useState)(null),[N,T]=(0,l.useState)(!1),[D,A]=(0,l.useState)(null),[F,O]=(0,l.useState)(null),[$,z]=(0,l.useState)([]),[I,L]=(0,l.useState)([]),[R,B]=(0,l.useState)([]),[V,H]=(0,l.useState)("REPLACE"),[M,G]=(0,l.useState)(!1),[K,U]=(0,l.useState)(!1),[W,q]=(0,l.useState)(!1),[J,Q]=(0,l.useState)((0,h.t)("Create a new excel dataset")),[X]=s.Z.useForm(),[Y,ee]=(0,l.useState)("");(0,l.useEffect)((()=>{const e=window.location.href.split("?")[1];let t=e.split("&")[0].split("=")[1],a=e.split("&")[1].split("=")[1],l=e.split("&")[2].split("=")[1];A(a),O(l),"add"==t?T(!0):(T(!1),a&&te(a))}),[]),(0,l.useEffect)((()=>{var e;const t=null==(e=a[0])?void 0:e.name.split(".")[0];X.setFieldsValue({dataset_name:j||t,table_name:""}),ee(j)}),[j,a]);const te=e=>{f.Z.get({endpoint:"/api/v1/dataset/"+e}).then((({json:e={}})=>{Q(e.result.custom_name)})).catch((()=>{n.ZP.error((0,h.t)("An error occurred while fetching dataset related data"))}))},ae=(0,w.tZ)("span",null,(0,w.tZ)("p",null,(0,h.t)("1. Merge cells cannot exist in Excel files;")),(0,w.tZ)("p",null,(0,h.t)("2. The first row of the Excel file's title line cannot be empty or date type;")),(0,w.tZ)("p",null,(0,h.t)("3. Please ensure that the file size is within 500M."))),le={onRemove:e=>{const t=a.indexOf(e),l=a.slice();l.splice(t,1),P(l),L([]),B([])},beforeUpload:e=>{let t=e.name.split(".");if(!t)return n.ZP.error((0,h.t)("Please upload the Excel file"));if(!["xlsx","xls","json","csv"].includes(t[1]))return n.ZP.error((0,h.t)("Only Excel files can be uploaded"));if(1==a.length)return n.ZP.error((0,h.t)("Only one file can be uploaded at a time"));P([...a,e]),S(t[1]);const l=new FormData;return l.append("formData",e),U(!0),f.Z.post({endpoint:"/api/v2/dataset/file/data/",body:l}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let a=[];if("xlsx"==t[1]||"xls"==t[1]){a=e.json.meta.data[0].result,z(e.json.meta.data);const t=[];e.json.meta.data.forEach((e=>{t.push(e.sheet)})),k(t),_(t[0])}else a=e.json.meta.data;ne(a)}else n.ZP.error(e.json.meta.message);U(!1)})).catch((()=>{n.ZP.error((0,h.t)("upload failed")),U(!1)})),!1},fileList:a},se=e=>{t(e)},ne=e=>{const t=[];Object.keys(e[0]).map((e=>{t.push({title:e,dataIndex:e,key:e,ellipsis:!0})})),L(e),B(t)};return(0,w.tZ)("div",{className:"contentgl"},(0,w.tZ)("div",{className:"topbtn"},(0,w.tZ)("div",null,(0,w.tZ)(o.Z,null,(0,w.tZ)(g.default,{onClick:()=>{window.history.go(-1)}})," ",(0,w.tZ)("span",{style:{fontSize:"18px",fontWeight:600}},J))),(0,w.tZ)("div",null,(0,w.tZ)(o.Z,null,(0,w.tZ)("span",null,(0,h.t)("selected"),"\uff1a",(0,w.tZ)("span",{style:{color:"#5d9cec"}},a.length," "),(0,h.t)("Sheet")),(0,w.tZ)(i.Z,{type:"primary",onClick:()=>void 0==a[0]?n.ZP.error((0,h.t)("Please upload the file first")):G(!0)},(0,h.t)("Save"))))),(0,w.tZ)("div",{className:"contentdiv"},(0,w.tZ)("div",{className:"leftdiv",style:{display:e?"block":"none"}},(0,w.tZ)("div",null,(0,w.tZ)(o.Z,null,(0,w.tZ)("span",{className:"spantext"},(0,h.t)("Select Data Table")),(0,w.tZ)(d.Z,{placement:"right",title:ae,overlayClassName:"TooltipClassName"},(0,w.tZ)(v.default,{style:{color:"#8f959e"}}))),e&&(0,w.tZ)(y.default,{onClick:()=>se(!1),className:"noneicon"})),(0,w.tZ)("div",{className:"uploaddiv"},(0,w.tZ)(r.Z,le,(0,w.tZ)(i.Z,{icon:(0,w.tZ)(x.default,null)},(0,h.t)("upload data"))),0==a.length?(0,w.tZ)("div",{className:"nodata"},(0,h.t)("There is currently no data available")):"")),!e&&(0,w.tZ)(b.default,{onClick:()=>se(!0),className:"bockicon"}),(0,w.tZ)("div",{className:"rightdiv"},R.length>0&&I.length>0?(0,w.tZ)("div",null,"xlsx"==C||"xls"==C?(0,w.tZ)(s.Z,{style:{marginTop:"20px",marginLeft:"15px"}},(0,w.tZ)(s.Z.Item,{label:"Sheet",name:"disabled",valuePropName:"checked"},(0,w.tZ)(c.ZP.Group,{options:E,onChange:({target:{value:e}})=>{_(e);const t=E.indexOf(e),a=$[t].result;ne(a)},value:j}))):null,(0,w.tZ)(u.Z,{loading:K,columns:R,dataSource:I,style:{marginTop:"20px"},pagination:{pageSize:10,showSizeChanger:!0},rowKey:e=>e.id,scroll:{x:!0,y:I.length>(window.innerHeight-300)/55?window.innerHeight-400+"px":void 0}})):(0,w.tZ)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"90vh"}},(0,w.tZ)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,w.tZ)("img",{style:{width:"90px"},src:"/static/assets/images/excelnodata.png",alt:""}),(0,w.tZ)("div",{style:{fontSize:"16px",color:"#BBBDBF",marginTop:"20px"}},(0,h.t)("Please upload Excel data first")))))),(0,w.tZ)(p.Z,{title:(0,h.t)("Excel Datasets"),width:"450px",visible:M,onCancel:()=>{G(!1),H("REPLACE")},maskClosable:!1,footer:[(0,w.tZ)("div",{key:"id"},(0,w.tZ)(o.Z,null,(0,w.tZ)(i.Z,{onClick:()=>{G(!1),H("REPLACE")}},(0,h.t)("Cancel")),(0,w.tZ)(i.Z,{onClick:()=>(()=>{if(void 0==a[0])return n.ZP.error((0,h.t)("Please upload the file first"));let e=X.getFieldValue("dataset_name")||j,t=X.getFieldValue("table_name")||e;const l=new FormData;l.append("formData",a[0]),q(!0),N?f.Z.post({endpoint:`/api/v2/dataset/file/?group_id=${D}&dataset_name=${e}&sheet_name=${j}&table_name=${t}`,body:l}).then((({json:e})=>{200==e.meta.code||201==e.meta.code?(n.ZP.success((0,h.t)("upload successfully.")),setTimeout((()=>{window.location.href="/tablemodelview/list/"}),100)):400==e.meta.code&&"\u5df2\u5b58\u5728"==e.meta.message?n.ZP.error((0,h.t)("Table name already exists, please re-enter!")):n.ZP.error(e.meta.message),q(!1)})).catch((()=>{q(!1),n.ZP.error((0,h.t)("upload failed"))})):f.Z.put({endpoint:`/api/v2/dataset/file/${D}/?if_exists=${V}&sheet_name=${j}`,body:l}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(n.ZP.success((0,h.t)("upload successfully.")),setTimeout((()=>{window.location.href="/tablemodelview/list/"}),100)):n.ZP.error(e.json.meta.message),q(!1)})).catch((()=>{q(!1),n.ZP.error((0,h.t)("upload failed"))}))})(),type:"primary"},(0,h.t)("Confirm"))))]},(0,w.tZ)("div",null,N?(0,w.tZ)(s.Z,{form:X,name:"dataset_name",layout:"horizontal",labelAlign:"right",labelCol:{span:8},wrapperCol:{span:16},style:{width:"360px"},onValuesChange:e=>{Object.hasOwnProperty.call(e,"dataset_name")&&ee(e.dataset_name)}},(0,w.tZ)(s.Z.Item,{name:"dataset_name",label:(0,h.t)("Dataset name")},(0,w.tZ)(Z.Z,{placeholder:(0,h.t)("Please enter a dataset name"),allowClear:!0})),(0,w.tZ)(s.Z.Item,{name:"table_name",label:(0,h.t)("Table Name"),help:(0,h.t)("Default dataset name used!")},(0,w.tZ)(Z.Z,{placeholder:Y,allowClear:!0}))):(0,w.tZ)(m.Z,{style:{width:200},onChange:e=>{H(e)},placeholder:(0,h.t)("Select Type"),options:[{value:"REPLACE",label:(0,h.t)("Replace data")},{value:"APPEND",label:(0,h.t)("Append data")}],value:V}))))}}}]);