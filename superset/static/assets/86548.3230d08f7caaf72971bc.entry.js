"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[86548],{611409:(e,t,r)=>{r.r(t),r.d(t,{ADD_QUERY_EDITOR:()=>N,CHANGE_DATA_PREVIEW_ID:()=>ce,CLEAR_QUERY_RESULTS:()=>de,CLONE_QUERY_TO_NEW_TAB:()=>D,COLLAPSE_TABLE:()=>Q,COST_ESTIMATE_FAILED:()=>Ae,COST_ESTIMATE_RETURNED:()=>Ie,COST_ESTIMATE_STARTED:()=>Se,CREATE_DATASOURCE_FAILED:()=>pe,CREATE_DATASOURCE_STARTED:()=>ye,CREATE_DATASOURCE_SUCCESS:()=>Oe,CtasEnum:()=>De,END_QUERY:()=>P,EXPAND_TABLE:()=>f,LOAD_QUERY_EDITOR:()=>z,MERGE_TABLE:()=>b,MIGRATE_QUERY:()=>k,MIGRATE_QUERY_EDITOR:()=>j,MIGRATE_TABLE:()=>W,MIGRATE_TAB_HISTORY:()=>H,QUERY_EDITOR_PERSIST_HEIGHT:()=>K,QUERY_EDITOR_SAVED:()=>h,QUERY_EDITOR_SETDB:()=>v,QUERY_EDITOR_SET_AUTORUN:()=>w,QUERY_EDITOR_SET_FUNCTION_NAMES:()=>G,QUERY_EDITOR_SET_QUERY_LIMIT:()=>Z,QUERY_EDITOR_SET_SCHEMA:()=>g,QUERY_EDITOR_SET_SCHEMA_OPTIONS:()=>B,QUERY_EDITOR_SET_SELECTED_TEXT:()=>$,QUERY_EDITOR_SET_SQL:()=>F,QUERY_EDITOR_SET_TABLE_OPTIONS:()=>Y,QUERY_EDITOR_SET_TEMPLATE_PARAMS:()=>V,QUERY_EDITOR_SET_TITLE:()=>M,QUERY_EDITOR_TOGGLE_LEFT_BAR:()=>x,QUERY_FAILED:()=>ue,QUERY_SUCCESS:()=>se,QUERY_VALIDATION_FAILED:()=>Te,QUERY_VALIDATION_RETURNED:()=>le,REFRESH_QUERIES:()=>re,REMOVE_DATA_PREVIEW:()=>_e,REMOVE_QUERY:()=>q,REMOVE_QUERY_EDITOR:()=>U,REMOVE_TABLES:()=>L,REQUEST_QUERY_RESULTS:()=>ie,RESET_STATE:()=>m,RUN_QUERY:()=>ae,SET_ACTIVE_QUERY_EDITOR:()=>J,SET_ACTIVE_SOUTHPANE_TAB:()=>te,SET_DATABASES:()=>X,SET_TABLES:()=>ee,SET_USER_OFFLINE:()=>ne,START_QUERY:()=>oe,START_QUERY_VALIDATION:()=>Re,STOP_QUERY:()=>Ee,UPDATE_QUERY_EDITOR:()=>C,addDangerToast:()=>Ce,addInfoToast:()=>me,addNewQueryEditor:()=>rt,addQueryEditor:()=>tt,addSavedQueryToTabState:()=>Ot,addSuccessToast:()=>Ne,addTable:()=>Pt,addWarningToast:()=>he,changeDataPreviewId:()=>qt,clearQueryResults:()=>Ge,cloneQueryToNewTab:()=>nt,collapseTable:()=>vt,convertQueryToClient:()=>qe,convertQueryToServer:()=>Pe,createCtasDatasource:()=>jt,createDatasource:()=>xt,createDatasourceFailed:()=>Kt,createDatasourceStarted:()=>$t,createDatasourceSuccess:()=>Gt,estimateQueryCost:()=>we,expandTable:()=>Qt,fetchQueryResults:()=>je,getUpToDateQuery:()=>fe,loadQueryEditor:()=>ot,mergeTable:()=>Ut,migrateQueryEditorFromLocalStorage:()=>et,persistEditorHeight:()=>Mt,popDatasourceQuery:()=>Vt,popQuery:()=>Zt,popSavedQuery:()=>Ft,popStoredQuery:()=>wt,postStopQuery:()=>Je,queryEditorSetAndSaveSql:()=>Nt,queryEditorSetAutorun:()=>It,queryEditorSetDb:()=>Rt,queryEditorSetFunctionNames:()=>Ht,queryEditorSetQueryLimit:()=>Ct,queryEditorSetSchema:()=>lt,queryEditorSetSchemaOptions:()=>Tt,queryEditorSetSelectedText:()=>Dt,queryEditorSetSql:()=>mt,queryEditorSetTableOptions:()=>St,queryEditorSetTemplateParams:()=>ht,queryEditorSetTitle:()=>At,queryFailed:()=>Ve,querySuccess:()=>Ze,queryValidationFailed:()=>Be,queryValidationReturned:()=>ge,reFetchQueryResults:()=>ft,reRunQuery:()=>ke,refreshQueries:()=>Bt,removeAllOtherQueryEditors:()=>_t,removeDataPreview:()=>Ke,removeQuery:()=>ct,removeQueryEditor:()=>dt,removeTables:()=>gt,requestQueryResults:()=>xe,resetState:()=>Qe,runQuery:()=>He,runQueryFromSqlEditor:()=>We,saveQuery:()=>yt,scheduleQuery:()=>Me,setActiveQueryEditor:()=>at,setActiveSouthPaneTab:()=>st,setDatabases:()=>ze,setTables:()=>Et,setUserOffline:()=>Yt,startQuery:()=>Fe,startQueryValidation:()=>ve,stopQuery:()=>$e,switchQueryEditor:()=>it,toggleLeftBar:()=>ut,updateQueryEditor:()=>Ye,updateSavedQuery:()=>pt,validateQuery:()=>Xe});var n=r(714670),a=r.n(n),o=r(115926),E=r.n(o),i=r(455867),s=r(431069),u=r(163137),d=r.n(u),_=r(567523),c=r.n(_),R=r(591877),l=r(593185),T=r(444814),S=r(672570),I=r(998286),A=r(966785);const y=/^Untitled Query (\d+)$/,O="Untitled Query ",p=(e,t=`${O}1`)=>{const r=(0,i.t)(t);if(e.length>0){const t=e.filter((e=>{var t;return null==(t=e.name)?void 0:t.match(y)})).map((e=>+e.name.replace(O,"")));if(t.length>0){const e=Math.max(...t);return(0,i.t)("%s%s",O,e+1)}return r}return r},m="RESET_STATE",N="ADD_QUERY_EDITOR",C="UPDATE_QUERY_EDITOR",h="QUERY_EDITOR_SAVED",D="CLONE_QUERY_TO_NEW_TAB",U="REMOVE_QUERY_EDITOR",b="MERGE_TABLE",L="REMOVE_TABLES",P="END_QUERY",q="REMOVE_QUERY",f="EXPAND_TABLE",Q="COLLAPSE_TABLE",v="QUERY_EDITOR_SETDB",g="QUERY_EDITOR_SET_SCHEMA",B="QUERY_EDITOR_SET_SCHEMA_OPTIONS",Y="QUERY_EDITOR_SET_TABLE_OPTIONS",M="QUERY_EDITOR_SET_TITLE",w="QUERY_EDITOR_SET_AUTORUN",F="QUERY_EDITOR_SET_SQL",Z="QUERY_EDITOR_SET_QUERY_LIMIT",V="QUERY_EDITOR_SET_TEMPLATE_PARAMS",$="QUERY_EDITOR_SET_SELECTED_TEXT",G="QUERY_EDITOR_SET_FUNCTION_NAMES",K="QUERY_EDITOR_PERSIST_HEIGHT",x="QUERY_EDITOR_TOGGLE_LEFT_BAR",j="MIGRATE_QUERY_EDITOR",H="MIGRATE_TAB_HISTORY",W="MIGRATE_TABLE",k="MIGRATE_QUERY",X="SET_DATABASES",J="SET_ACTIVE_QUERY_EDITOR",z="LOAD_QUERY_EDITOR",ee="SET_TABLES",te="SET_ACTIVE_SOUTHPANE_TAB",re="REFRESH_QUERIES",ne="SET_USER_OFFLINE",ae="RUN_QUERY",oe="START_QUERY",Ee="STOP_QUERY",ie="REQUEST_QUERY_RESULTS",se="QUERY_SUCCESS",ue="QUERY_FAILED",de="CLEAR_QUERY_RESULTS",_e="REMOVE_DATA_PREVIEW",ce="CHANGE_DATA_PREVIEW_ID",Re="START_QUERY_VALIDATION",le="QUERY_VALIDATION_RETURNED",Te="QUERY_VALIDATION_FAILED",Se="COST_ESTIMATE_STARTED",Ie="COST_ESTIMATE_RETURNED",Ae="COST_ESTIMATE_FAILED",ye="CREATE_DATASOURCE_STARTED",Oe="CREATE_DATASOURCE_SUCCESS",pe="CREATE_DATASOURCE_FAILED",me=S.bM,Ne=S.ws,Ce=S.Gb,he=S.Dz,De={TABLE:"TABLE",VIEW:"VIEW"},Ue=(0,i.t)("The query couldn't be loaded"),be={id:"remoteId",db_id:"dbId",label:"name",template_parameters:"templateParams"},Le=e=>t=>c()(t,((t,r)=>r in e?e[r]:r)),Pe=Le(d()(be)),qe=Le(be);function fe(e,t,r){const{sqlLab:{unsavedQueryEditor:n}}=e,a=null!=r?r:t.id;return{...t,...a===n.id&&n}}function Qe(){return{type:m}}function ve(e){return Object.assign(e,{id:e.id?e.id:a().generate()}),{type:Re,query:e}}function ge(e,t){return{type:le,query:e,results:t}}function Be(e,t,r){return{type:Te,query:e,message:t,error:r}}function Ye(e){return{type:C,alterations:e}}function Me(e){return t=>s.Z.post({endpoint:"/savedqueryviewapi/api/create",postPayload:e,stringify:!1}).then((()=>t(Ne((0,i.t)("Your query has been scheduled. To see details of your query, navigate to Saved queries"))))).catch((()=>t(Ce((0,i.t)("Your query could not be scheduled")))))}function we(e){return(t,r)=>{const{dbId:n,schema:a,sql:o,selectedText:E,templateParams:u}=fe(r(),e),d=E||o,_=null===a?`/superset/estimate_query_cost/${n}/`:`/superset/estimate_query_cost/${n}/${a}/`;return Promise.all([t({type:Se,query:e}),s.Z.post({endpoint:_,postPayload:{sql:d,templateParams:JSON.parse(u||"{}")}}).then((({json:r})=>t({type:Ie,query:e,json:r}))).catch((r=>(0,I.O$)(r).then((r=>{const n=r.error||r.statusText||(0,i.t)("Failed at retrieving results");return t({type:Ae,query:e,error:n})}))))])}}function Fe(e){return Object.assign(e,{id:e.id?e.id:a().generate(),progress:0,startDttm:(0,T.zO)(),state:e.runAsync?"pending":"running",cached:!1}),{type:oe,query:e}}function Ze(e,t){return function(r){var n;const a=null==t||null==(n=t.query)?void 0:n.sqlEditorId;return(a&&!e.isDataPreview&&(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${a}`),postPayload:{latest_query_id:e.id}}):Promise.resolve()).then((()=>r({type:se,query:e,results:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while storing the latest query id in the backend. Please contact your administrator if this problem persists.")))))}}function Ve(e,t,r,n){return function(a){return(!e.isDataPreview&&(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.sqlEditorId}`),postPayload:{latest_query_id:e.id}}):Promise.resolve()).catch((()=>a(Ce((0,i.t)("An error occurred while storing the latest query id in the backend. Please contact your administrator if this problem persists."))))).then((()=>a({type:ue,query:e,msg:t,link:r,errors:n})))}}function $e(e){return{type:Ee,query:e}}function Ge(e){return{type:de,query:e}}function Ke(e){return{type:_e,table:e}}function xe(e){return{type:ie,query:e}}function je(e,t){return function(r){r(xe(e));const n=E().encode({key:e.resultsKey,rows:t||null});return s.Z.get({endpoint:`/api/v1/sqllab/results/?q=${n}`,parseMethod:"json-bigint"}).then((({json:t})=>r(Ze(e,t)))).catch((t=>(0,I.O$)(t).then((t=>{const n=t.error||t.statusText||(0,i.t)("Failed at retrieving results");return r(Ve(e,n,t.link,t.errors))}))))}}function He(e){return function(t){t(Fe(e));const r={client_id:e.id,database_id:e.dbId,json:!0,runAsync:e.runAsync,schema:e.schema,sql:e.sql,sql_editor_id:e.sqlEditorId,tab:e.tab,tmp_table_name:e.tempTable,select_as_cta:e.ctas,ctas_method:e.ctas_method,templateParams:e.templateParams,queryLimit:e.queryLimit,expand_data:!0},n=window.location.search||"";return s.Z.post({endpoint:`/api/v1/sqllab/execute/${n}`,body:JSON.stringify(r),headers:{"Content-Type":"application/json"},parseMethod:"json-bigint"}).then((({json:r})=>{e.runAsync||t(Ze(e,r))})).catch((r=>(0,I.O$)(r).then((r=>{let n=r.error||r.message||r.statusText||(0,i.t)("Unknown error");n.includes("CSRF token")&&(n=(0,i.t)(A.Z.SESSION_TIMED_OUT)),t(Ve(e,n,r.link,r.errors))}))))}}function We(e,t,r,n,a,o){return function(E,i){const s=fe(i(),t,t.id);E(He({dbId:s.dbId,sql:s.selectedText||s.sql,sqlEditorId:s.id,tab:s.name,schema:s.schema,tempTable:n,templateParams:s.templateParams,queryLimit:s.queryLimit||r,runAsync:!!e&&e.allow_run_async,ctas:a,ctas_method:o,updateTabState:!s.selectedText}))}}function ke(e){return function(t){t(He({...e,id:a().generate()}))}}function Xe(e,t){return function(r,n){const{sqlLab:{unsavedQueryEditor:a}}=n(),o={...e,...e.id===a.id&&a},E={dbId:o.dbId,sql:t,sqlEditorId:o.id,schema:o.schema,templateParams:o.templateParams};r(ve(E));const u={schema:E.schema,sql:E.sql,template_params:E.templateParams};return s.Z.post({endpoint:`/api/v1/database/${E.dbId}/validate_sql/`,body:JSON.stringify(u),headers:{"Content-Type":"application/json"}}).then((({json:e})=>r(ge(E,e.result)))).catch((e=>(0,I.O$)(e.result).then((e=>{let t=e.error||e.statusText||(0,i.t)("Unknown error");t.includes("CSRF token")&&(t=(0,i.t)(A.Z.SESSION_TIMED_OUT)),r(Be(E,t,e))}))))}}function Je(e){return function(t){return s.Z.post({endpoint:"/api/v1/query/stop",body:JSON.stringify({client_id:e.id}),headers:{"Content-Type":"application/json"}}).then((()=>t($e(e)))).then((()=>t(Ne((0,i.t)("Query was stopped."))))).catch((()=>t(Ce((0,i.t)("Failed at stopping query. %s",e.id)))))}}function ze(e){return{type:X,databases:e}}function et(e,t,r){return function(n){return s.Z.post({endpoint:"/tabstateview/",postPayload:{queryEditor:e}}).then((({json:a})=>{const o={...e,id:a.id.toString()};return n({type:j,oldQueryEditor:e,newQueryEditor:o}),n({type:H,oldId:e.id,newId:o.id}),Promise.all([...t.map((e=>function(e,t,r){return s.Z.post({endpoint:encodeURI("/tableschemaview/"),postPayload:{table:{...e,queryEditorId:t}}}).then((({json:n})=>{const a={...e,id:n.id,queryEditorId:t};return r({type:W,oldTable:e,newTable:a})})).catch((()=>r(he((0,i.t)("Unable to migrate table schema state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}(e,o.id,n))),...r.map((e=>function(e,t,r){return s.Z.post({endpoint:encodeURI(`/tabstateview/${t}/migrate_query`),postPayload:{queryId:e}}).then((()=>r({type:k,queryId:e,queryEditorId:t}))).catch((()=>r(he((0,i.t)("Unable to migrate query state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}(e.id,o.id,n)))])})).catch((()=>n(he((0,i.t)("Unable to migrate query editor state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}}function tt(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.post({endpoint:"/tabstateview/",postPayload:{queryEditor:e}}):Promise.resolve({json:{id:a().generate()}})).then((({json:r})=>{const n={...e,id:r.id.toString()};return t({type:N,queryEditor:n})})).catch((()=>t(Ce((0,i.t)("Unable to add a new tab to the backend. Please contact your administrator.")))))}}function rt(){return function(e,t){const{sqlLab:{queryEditors:r,tabHistory:n,unsavedQueryEditor:a,defaultDbId:o,databases:E},common:s}=t(),u=r.find((e=>e.id===n[n.length-1])),d=Object.values(E).map((e=>e.id)),_=d.length>0?Math.min(...d):void 0,{dbId:c,schema:T,queryLimit:S,autorun:I}={...r[0],...u,...a.id===(null==u?void 0:u.id)&&a},A=(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?"":(0,i.t)("-- Note: Unless you save your query, these tabs will NOT persist if you clear your cookies or change browsers.\n\n"),y=p(r||[]);return e(tt({dbId:c||o||_,schema:null!=T?T:null,autorun:null!=I&&I,sql:`${A}SELECT ...`,queryLimit:S||s.conf.DEFAULT_SQLLAB_LIMIT,name:y}))}}function nt(e,t){return function(r,n){const a=n(),{queryEditors:o,tabHistory:E}=a.sqlLab,s=o.find((e=>e.id===E[E.length-1]));return r(tt({name:(0,i.t)("Copy of %s",s.name),dbId:e.dbId?e.dbId:null,schema:e.schema?e.schema:null,autorun:t,sql:e.sql,queryLimit:s.queryLimit,maxRow:s.maxRow,templateParams:s.templateParams}))}}function at(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.post({endpoint:encodeURI(`/tabstateview/${e.id}/activate`)}):Promise.resolve()).then((()=>t({type:J,queryEditor:e}))).catch((r=>404!==r.status?t(Ce((0,i.t)("An error occurred while setting the active tab. Please contact your administrator."))):t({type:U,queryEditor:e})))}}function ot(e){return{type:z,queryEditor:e}}function Et(e){const t=e.filter((e=>null!==e.description)).map((e=>{const{columns:t,selectStar:r,primaryKey:n,foreignKeys:a,indexes:o,dataPreviewQueryId:E}=e.description;return{dbId:e.database_id,queryEditorId:e.tab_state_id.toString(),schema:e.schema,name:e.table,expanded:e.expanded,id:e.id,dataPreviewQueryId:E,columns:t,selectStar:r,primaryKey:n,foreignKeys:a,indexes:o,isMetadataLoading:!1,isExtraMetadataLoading:!1}}));return{type:ee,tables:t}}function it(e,t){return function(r){(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)&&e&&!e.loaded?s.Z.get({endpoint:encodeURI(`/tabstateview/${e.id}`)}).then((({json:e})=>{var n,a;const o={id:e.id.toString(),loaded:!0,name:e.label,sql:e.sql,selectedText:null,latestQueryId:null==(n=e.latest_query)?void 0:n.id,autorun:e.autorun,dbId:e.database_id,templateParams:e.template_params,schema:e.schema,queryLimit:e.query_limit,remoteId:null==(a=e.saved_query)?void 0:a.id,validationResult:{id:null,errors:[],completed:!1},hideLeftBar:e.hide_left_bar};r(ot(o)),r(Et(e.table_schemas||[])),r(at(o)),e.latest_query&&e.latest_query.resultsKey&&r(je(e.latest_query,t))})).catch((t=>404!==t.status?r(Ce((0,i.t)("An error occurred while fetching tab state"))):r({type:U,queryEditor:e}))):r(at(e))}}function st(e){return{type:te,tabId:e}}function ut(e){const t=!e.hideLeftBar;return function(r){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{hide_left_bar:t}}):Promise.resolve()).then((()=>r({type:x,queryEditor:e,hideLeftBar:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while hiding the left bar. Please contact your administrator.")))))}}function dt(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.delete({endpoint:encodeURI(`/tabstateview/${e.id}`)}):Promise.resolve()).then((()=>t({type:U,queryEditor:e}))).catch((()=>t(Ce((0,i.t)("An error occurred while removing tab. Please contact your administrator.")))))}}function _t(e){return function(t,r){var n;const{sqlLab:a}=r();null==(n=a.queryEditors)||n.forEach((r=>{r.id!==e.id&&t(dt(r))}))}}function ct(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.delete({endpoint:encodeURI(`/tabstateview/${e.sqlEditorId}/query/${e.id}`)}):Promise.resolve()).then((()=>t({type:q,query:e}))).catch((()=>t(Ce((0,i.t)("An error occurred while removing query. Please contact your administrator.")))))}}function Rt(e,t){return function(r){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{database_id:t}}):Promise.resolve()).then((()=>r({type:v,queryEditor:e,dbId:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while setting the tab database ID. Please contact your administrator.")))))}}function lt(e,t){return function(r){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)&&"object"===typeof e?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{schema:t}}):Promise.resolve()).then((()=>r({type:g,queryEditor:e||{},schema:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while setting the tab schema. Please contact your administrator.")))))}}function Tt(e,t){return{type:B,queryEditor:e,options:t}}function St(e,t){return{type:Y,queryEditor:e,options:t}}function It(e,t){return function(r){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{autorun:t}}):Promise.resolve()).then((()=>r({type:w,queryEditor:e,autorun:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while setting the tab autorun. Please contact your administrator.")))))}}function At(e,t,r){return function(n){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${r}`),postPayload:{label:t}}):Promise.resolve()).then((()=>n({type:M,queryEditor:{...e,id:r},name:t}))).catch((()=>n(Ce((0,i.t)("An error occurred while setting the tab name. Please contact your administrator.")))))}}function yt(e,t){const{id:r,...n}=Pe(e);return r=>s.Z.post({endpoint:"/api/v1/saved_query/",jsonPayload:Pe(n)}).then((n=>{const a=qe({id:n.json.id,...n.json.result});return r({type:h,query:e,clientId:t,result:a}),r(At(e,e.name,t)),a})).catch((()=>r(Ce((0,i.t)("Your query could not be saved")))))}const Ot=(e,t)=>r=>((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:`/tabstateview/${e.id}`,postPayload:{saved_query_id:t.remoteId}}):Promise.resolve()).catch((()=>{r(Ce((0,i.t)("Your query was not properly saved")))})).then((()=>{r(Ne((0,i.t)("Your query was saved")))}));function pt(e,t){const{id:r,...n}=Pe(e);return r=>s.Z.put({endpoint:`/api/v1/saved_query/${e.remoteId}`,jsonPayload:Pe(n)}).then((()=>{r(Ne((0,i.t)("Your query was updated"))),r(At(e,e.name,t))})).catch((e=>{const t=(0,i.t)("Your query could not be updated");r(Ce(t))})).then((()=>r(Ye(e))))}function mt(e,t){return{type:F,queryEditor:e,sql:t}}function Nt(e,t){return function(r,n){const a=fe(n(),e);return r(mt(a,t)),(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${a.id}`),postPayload:{sql:t,latest_query_id:a.latestQueryId}}).catch((()=>r(Ce((0,i.t)('An error occurred while storing your query in the backend. To avoid losing your changes, please save your query using the "Save Query" button.'))))):Promise.resolve()}}function Ct(e,t){return function(r){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{query_limit:t}}):Promise.resolve()).then((()=>r({type:Z,queryEditor:e,queryLimit:t}))).catch((()=>r(Ce((0,i.t)("An error occurred while setting the tab name. Please contact your administrator.")))))}}function ht(e,t){return function(r){r({type:V,queryEditor:e,templateParams:t});return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{template_params:t}}):Promise.resolve()).catch((()=>r(Ce((0,i.t)("An error occurred while setting the tab template parameters. Please contact your administrator.")))))}}function Dt(e,t){return{type:$,queryEditor:e,sql:t}}function Ut(e,t,r){return{type:b,table:e,query:t,prepend:r}}function bt(e,t,r){return s.Z.get({endpoint:encodeURI(`/api/v1/database/${t.dbId}/table/${encodeURIComponent(e.name)}/${encodeURIComponent(e.schema)}/`)}).then((({json:t})=>{const n={...e,...t,expanded:!0,isMetadataLoading:!1};return r(Ut(n)),n})).catch((()=>Promise.all([r(Ut({...e,isMetadataLoading:!1})),r(Ce((0,i.t)("An error occurred while fetching table metadata")))])))}function Lt(e,t,r){return s.Z.get({endpoint:encodeURI(`/api/v1/database/${t.dbId}/table_extra/${encodeURIComponent(e.name)}/${encodeURIComponent(e.schema)}/`)}).then((({json:t})=>(r(Ut({...e,...t,isExtraMetadataLoading:!1})),t))).catch((()=>Promise.all([r(Ut({...e,isExtraMetadataLoading:!1})),r(Ce((0,i.t)("An error occurred while fetching table metadata")))])))}function Pt(e,t,r,n){return function(o,E){const u=fe(E(),e,e.id),d={dbId:u.dbId,queryEditorId:u.id,schema:n,name:r};return o(Ut({...d,isMetadataLoading:!0,isExtraMetadataLoading:!0,expanded:!0},null,!0)),Promise.all([bt(d,u,o),Lt(d,u,o)]).then((([e,r])=>{const n=(0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.post({endpoint:encodeURI("/tableschemaview/"),postPayload:{table:{...e,...r}}}):Promise.resolve({json:{id:a().generate()}});if(!t.disable_data_preview&&t.id===u.dbId){const r={id:a().generate(),dbId:u.dbId,sql:e.selectStar,tableName:d.name,sqlEditorId:null,tab:"",runAsync:t.allow_run_async,ctas:!1,isDataPreview:!0};Promise.all([o(Ut({...e,dataPreviewQueryId:r.id},r)),o(He(r))])}return n.then((({json:e})=>o(Ut({...d,id:e.id})))).catch((()=>o(Ce((0,i.t)("An error occurred while fetching table metadata. Please contact your administrator.")))))}))}}function qt(e,t){return{type:ce,oldQueryId:e,newQuery:t}}function ft(e){return function(t){const r={id:a().generate(),dbId:e.dbId,sql:e.sql,tableName:e.tableName,sqlEditorId:null,tab:"",runAsync:!1,ctas:!1,queryLimit:e.queryLimit,isDataPreview:e.isDataPreview};t(He(r)),t(qt(e.id,r))}}function Qt(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.post({endpoint:encodeURI(`/tableschemaview/${e.id}/expanded`),postPayload:{expanded:!0}}):Promise.resolve()).then((()=>t({type:f,table:e}))).catch((()=>t(Ce((0,i.t)("An error occurred while expanding the table schema. Please contact your administrator.")))))}}function vt(e){return function(t){return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?s.Z.post({endpoint:encodeURI(`/tableschemaview/${e.id}/expanded`),postPayload:{expanded:!1}}):Promise.resolve()).then((()=>t({type:Q,table:e}))).catch((()=>t(Ce((0,i.t)("An error occurred while collapsing the table schema. Please contact your administrator.")))))}}function gt(e){return function(t){var r;const n=null!=(r=null==e?void 0:e.filter(Boolean))?r:[];return((0,R.cr)(l.T.SQLLAB_BACKEND_PERSISTENCE)?Promise.all(n.map((e=>s.Z.delete({endpoint:encodeURI(`/tableschemaview/${e.id}`)})))):Promise.resolve()).then((()=>t({type:L,tables:n}))).catch((()=>t(Ce((0,i.t)("An error occurred while removing the table schema. Please contact your administrator.")))))}}function Bt(e){return{type:re,alteredQueries:e}}function Yt(e){return{type:ne,offline:e}}function Mt(e,t,r){return{type:K,queryEditor:e,northPercent:t,southPercent:r}}function wt(e){return function(t){return s.Z.get({endpoint:`/kv/${e}`}).then((({json:e})=>t(tt({name:e.name?e.name:(0,i.t)("Shared query"),dbId:e.dbId?parseInt(e.dbId,10):null,schema:e.schema?e.schema:null,autorun:!!e.autorun&&e.autorun,sql:e.sql?e.sql:"SELECT ...",templateParams:e.templateParams})))).catch((()=>t(Ce(Ue))))}}function Ft(e){return function(t){return s.Z.get({endpoint:`/api/v1/saved_query/${e}`}).then((({json:e})=>{var r,n;const a={...qe(e.result),dbId:null==(r=e.result)||null==(n=r.database)?void 0:n.id,loaded:!0,autorun:!1};return t(tt(a))})).catch((()=>t(Ce(Ue))))}}function Zt(e){return function(t){return s.Z.get({endpoint:`/api/v1/query/${e}`}).then((({json:e})=>{const r=e.result,n={dbId:r.database.id,schema:r.schema,sql:r.sql,name:(0,i.t)("Copy of %s",r.tab_name),autorun:!1};return t(tt(n))})).catch((()=>t(Ce(Ue))))}}function Vt(e,t){return function(r){const n=(0,i.t)("Query"),a=e.split("__")[0];return s.Z.get({endpoint:`/api/v1/dataset/${a}?q=(keys:!(none))`}).then((({json:e})=>r(tt({name:`${n} ${e.result.name}`,dbId:e.result.database.id,schema:e.result.schema,autorun:void 0!==t,sql:t||e.result.select_star})))).catch((()=>r(Ce((0,i.t)("The datasource couldn't be loaded")))))}}function $t(){return{type:ye}}function Gt(e){const t=`${e.table_id}__table`;return{type:Oe,datasource:t}}function Kt(e){return{type:pe,err:e}}function xt(e){return t=>(t($t()),s.Z.post({endpoint:"/superset/sqllab_viz/",postPayload:{data:e}}).then((({json:e})=>(t(Gt(e)),Promise.resolve(e)))).catch((e=>((0,I.O$)(e).then((e=>{t(Ce(e.error))})),t(Kt((0,i.t)("An error occurred while creating the data source"))),Promise.reject()))))}function jt(e){return t=>(t($t()),s.Z.post({endpoint:"/api/v1/dataset/get_or_create/",jsonPayload:e}).then((({json:e})=>(t(Gt(e.result)),e.result))).catch((()=>{const e=(0,i.t)("An error occurred while creating the data source");return t(Kt(e)),Promise.reject(new Error(e))})))}function Ht(e,t){return function(r){return s.Z.get({endpoint:encodeURI(`/api/v1/database/${t}/function_names/`)}).then((({json:t})=>r({type:G,queryEditor:e,functionNames:t.function_names}))).catch((t=>{404===t.status?r({type:G,queryEditor:e,functionNames:[]}):r(Ce((0,i.t)("An error occurred while fetching function names.")))}))}}},343716:(e,t,r)=>{r.d(t,{C5:()=>a,Qn:()=>u,Tb:()=>E,WN:()=>o,YC:()=>c,ZP:()=>R,eh:()=>d,pY:()=>_,sn:()=>i,yv:()=>s});var n=r(46078);const a={FRONTEND_CSRF_ERROR:"FRONTEND_CSRF_ERROR",FRONTEND_NETWORK_ERROR:"FRONTEND_NETWORK_ERROR",FRONTEND_TIMEOUT_ERROR:"FRONTEND_TIMEOUT_ERROR",GENERIC_DB_ENGINE_ERROR:"GENERIC_DB_ENGINE_ERROR",COLUMN_DOES_NOT_EXIST_ERROR:"COLUMN_DOES_NOT_EXIST_ERROR",TABLE_DOES_NOT_EXIST_ERROR:"TABLE_DOES_NOT_EXIST_ERROR",SCHEMA_DOES_NOT_EXIST_ERROR:"SCHEMA_DOES_NOT_EXIST_ERROR",CONNECTION_INVALID_USERNAME_ERROR:"CONNECTION_INVALID_USERNAME_ERROR",CONNECTION_INVALID_PASSWORD_ERROR:"CONNECTION_INVALID_PASSWORD_ERROR",CONNECTION_INVALID_HOSTNAME_ERROR:"CONNECTION_INVALID_HOSTNAME_ERROR",CONNECTION_PORT_CLOSED_ERROR:"CONNECTION_PORT_CLOSED_ERROR",CONNECTION_INVALID_PORT_ERROR:"CONNECTION_INVALID_PORT_ERROR",CONNECTION_HOST_DOWN_ERROR:"CONNECTION_HOST_DOWN_ERROR",CONNECTION_ACCESS_DENIED_ERROR:"CONNECTION_ACCESS_DENIED_ERROR",CONNECTION_UNKNOWN_DATABASE_ERROR:"CONNECTION_UNKNOWN_DATABASE_ERROR",CONNECTION_DATABASE_PERMISSIONS_ERROR:"CONNECTION_DATABASE_PERMISSIONS_ERROR",CONNECTION_MISSING_PARAMETERS_ERRORS:"CONNECTION_MISSING_PARAMETERS_ERRORS",OBJECT_DOES_NOT_EXIST_ERROR:"OBJECT_DOES_NOT_EXIST_ERROR",SYNTAX_ERROR:"SYNTAX_ERROR",VIZ_GET_DF_ERROR:"VIZ_GET_DF_ERROR",UNKNOWN_DATASOURCE_TYPE_ERROR:"UNKNOWN_DATASOURCE_TYPE_ERROR",FAILED_FETCHING_DATASOURCE_INFO_ERROR:"FAILED_FETCHING_DATASOURCE_INFO_ERROR",TABLE_SECURITY_ACCESS_ERROR:"TABLE_SECURITY_ACCESS_ERROR",DATASOURCE_SECURITY_ACCESS_ERROR:"DATASOURCE_SECURITY_ACCESS_ERROR",DATABASE_SECURITY_ACCESS_ERROR:"DATABASE_SECURITY_ACCESS_ERROR",QUERY_SECURITY_ACCESS_ERROR:"QUERY_SECURITY_ACCESS_ERROR",MISSING_OWNERSHIP_ERROR:"MISSING_OWNERSHIP_ERROR",BACKEND_TIMEOUT_ERROR:"BACKEND_TIMEOUT_ERROR",DATABASE_NOT_FOUND_ERROR:"DATABASE_NOT_FOUND_ERROR",MISSING_TEMPLATE_PARAMS_ERROR:"MISSING_TEMPLATE_PARAMS_ERROR",INVALID_TEMPLATE_PARAMS_ERROR:"INVALID_TEMPLATE_PARAMS_ERROR",RESULTS_BACKEND_NOT_CONFIGURED_ERROR:"RESULTS_BACKEND_NOT_CONFIGURED_ERROR",DML_NOT_ALLOWED_ERROR:"DML_NOT_ALLOWED_ERROR",INVALID_CTAS_QUERY_ERROR:"INVALID_CTAS_QUERY_ERROR",INVALID_CVAS_QUERY_ERROR:"INVALID_CVAS_QUERY_ERROR",SQLLAB_TIMEOUT_ERROR:"SQLLAB_TIMEOUT_ERROR",RESULTS_BACKEND_ERROR:"RESULTS_BACKEND_ERROR",ASYNC_WORKERS_ERROR:"ASYNC_WORKERS_ERROR",GENERIC_COMMAND_ERROR:"GENERIC_COMMAND_ERROR",GENERIC_BACKEND_ERROR:"GENERIC_BACKEND_ERROR",INVALID_PAYLOAD_FORMAT_ERROR:"INVALID_PAYLOAD_FORMAT_ERROR",INVALID_PAYLOAD_SCHEMA_ERROR:"INVALID_PAYLOAD_SCHEMA_ERROR"},o={TABLE:"TABLE",VIEW:"VIEW"};var E;!function(e){e.STARTED="started",e.STOPPED="stopped",e.FAILED="failed",e.PENDING="pending",e.RUNNING="running",e.SCHEDULED="scheduled",e.SUCCESS="success",e.FETCHING="fetching",e.TIMED_OUT="timed_out"}(E||(E={}));const i=[E.RUNNING,E.STARTED,E.PENDING,E.FETCHING,E.SCHEDULED],s=[E.STOPPED,E.FAILED,E.SUCCESS,E.TIMED_OUT],u={id:"clientId2353",dbId:1,sql:"SELECT * FROM something",sqlEditorId:"dfsadfs",tab:"unimportant",tempTable:"",ctas:!1,cached:!1,errorMessage:null,extra:{progress:null},isDataPreview:!1,progress:0,resultsKey:null,state:E.SUCCESS,tempSchema:null,trackingUrl:null,templateParams:null,rows:42,queryLimit:100,limitingFactor:"",endDttm:1476910579693,duration:"",startDttm:1476910566092.96,time:{},user:{},userId:1,db:{},started:"",querylink:{},queryId:1,executedSql:"",output:"",actions:{},type:n.i9.Query,columns:[{name:"Column 1",type:"STRING",is_dttm:!1},{name:"Column 3",type:"STRING",is_dttm:!1},{name:"Column 2",type:"TIMESTAMP",is_dttm:!0}]},d={results:{displayLimitReached:!1,columns:[{name:"Column 1",type:"STRING",is_dttm:!1},{name:"Column 3",type:"STRING",is_dttm:!1},{name:"Column 2",type:"TIMESTAMP",is_dttm:!0}],data:[{"Column 1":"a","Column 2":"b","Column 3":"2014-11-11T00:00:00"}],expanded_columns:[],selected_columns:[{name:"Column 1",type:"STRING",is_dttm:!1},{name:"Column 3",type:"STRING",is_dttm:!1},{name:"Column 2",type:"TIMESTAMP",is_dttm:!0}],query:{limit:6}}},_={...u,...d};var c;!function(e){e.Row="row",e.Column="column"}(c||(c={}));const R={}},782607:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(205872),a=r.n(n),o=(r(667294),r(751995)),E=r(762529),i=r(211965);const s=(0,o.iK)((({textColor:e,color:t,text:r,...n})=>(0,i.tZ)(E.Z,a()({text:r,color:r?t:void 0},n))))`
  & > sup {
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    background: ${({theme:e,color:t})=>t||e.colors.primary.base};
    color: ${({theme:e,textColor:t})=>t||e.colors.grayscale.light5};
  }
`},657011:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(205872),a=r.n(n),o=(r(667294),r(570302)),E=r(211965);const i=({padded:e,...t})=>(0,E.tZ)(o.Z,a()({},t,{css:t=>({backgroundColor:t.colors.grayscale.light4,borderRadius:t.borderRadius,".ant-card-body":{padding:e?4*t.gridUnit:t.gridUnit}})}))},679789:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(667294),a=r(751995),o=r(455867),E=r(731293),i=r(358593),s=r(211965);const u=function({certifiedBy:e,details:t,size:r="l"}){const u=(0,a.Fg)();return(0,s.tZ)(i.u,{id:"certified-details-tooltip",title:(0,s.tZ)(n.Fragment,null,e&&(0,s.tZ)("div",null,(0,s.tZ)("strong",null,(0,o.t)("Certified by %s",e))),(0,s.tZ)("div",null,t))},(0,s.tZ)(E.Z.Certified,{iconColor:u.colors.primary.base,iconSize:r}))}}}]);