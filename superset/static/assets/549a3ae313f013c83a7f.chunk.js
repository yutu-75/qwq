"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[45681],{133576:(e,t,a)=>{a.d(t,{Z:()=>h});var l=a(667294),n=a(981945),o=a(814277),i=a(828216),s=a(542170),u=a(973935),r=a(226618),d=a(211965);const c={minWidth:"60px",width:"100%",height:"30px",lineHeight:"15px",textAlign:"center",fontSize:"12px",background:"#f0f2f5",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},v=(e,t)=>{const{data:a,options:v,multiSelect:h,onSelectionChange:m=(()=>{}),filterState:f,id:p}=e,b=(0,i.v9)((e=>e.dashboardState.mobileFilterStatus)),Z=(0,i.v9)((e=>e.dashboardState.drawerStatus)),[g,S]=(0,l.useState)(f.value?f.value:[]),[w,y]=(0,l.useState)(f.value?f.value:[]),[C,k]=(0,l.useState)(null);(0,l.useEffect)((()=>{Z&&f.value&&(0,u.unstable_batchedUpdates)((()=>{S(f.value?f.value:[]),y(f.value?f.value:[])}))}),[Z]),(0,l.useImperativeHandle)(t,(()=>({viewValus:e=>{S(e)},viewIndex:e=>{y(e)}})),[]);const x=(e,t)=>{if(h)if(g.includes(e)){const a=g.filter((t=>t!==e)),l=w.filter((e=>e!==t));S(a),y(l),m(a,l)}else{const a=[...g,e],l=[...w,t];S(a),y(l),m(a,l)}else g.includes(e)?(S([]),y(""),m([],"")):(S([e]),y(t),m([e],t))},F=()=>{a.onOpen(),m(g,w,true)};let N=null;const I=e=>t=>{t.preventDefault(),N=setTimeout((()=>{k(e)}),500)},M=()=>{k(null),clearTimeout(N)};return(0,l.useEffect)((()=>{if(f.label){const e=v.find((e=>e.label===f.label));e&&!1===h&&y(e.label)}else y([])}),[f.label]),(0,s.Z)((()=>{!b.confirm&&b.reset&&(S([]),y([]))}),[JSON.stringify(b)]),(0,d.tZ)(l.Fragment,null,v.length>0?(0,d.tZ)(n.rj,{columns:3,gap:8},v.length>8?(0,d.tZ)(l.Fragment,null,v.slice(0,8).map((e=>(0,d.tZ)(n.rj.Item,{key:`${p}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value},(0,d.tZ)(n.zx,{shape:"rounded",style:{...c,background:g.includes(e.value)?r.Fu:"#f0f2f5",color:g.includes(e.value)?r.zP:"#000000"},onClick:()=>x(e.value,e.label),onTouchStart:I(e.value),onTouchEnd:M,onMouseDown:I(e.value),onMouseUp:M},e.label))))),(0,d.tZ)(n.rj.Item,{span:1},(0,d.tZ)(n.zx,{shape:"rounded",onClick:F,style:{...c}},"\u5c55\u5f00"))):v.map((e=>(0,d.tZ)(n.rj.Item,{key:`${p}-${e.value}-${e.label}`},(0,d.tZ)(n.J2,{content:e.label||e.value,visible:C===e.value,onVisibleChange:e=>{e||k(null)}},(0,d.tZ)(n.zx,{shape:"rounded",style:{...c,background:g.includes(e.value)?r.Fu:r.hR,color:g.includes(e.value)?r.zP:r.k2},onClick:()=>x(e.value,e.label),onTouchStart:I(e.value),onTouchEnd:M,onMouseDown:I(e.value),onMouseUp:M},e.label?e.label:e.value)))))):(0,d.tZ)(o.Z,{description:"\u6682\u65e0\u6570\u636e"}))},h=(0,l.forwardRef)(v)},745681:(e,t,a)=>{a.r(t),a.d(t,{default:()=>F});var l=a(205872),n=a.n(l),o=a(355786),i=a(455867),s=a(667294),u=a(49937),r=a(174448),d=a(828216),c=a(981945),v=a(771230),h=a(515746),m=a(747933),f=a(814277),p=a(708509),b=a(555453),Z=a(401498),g=a(246789),S=a(867e3),w=a(133576),y=a(542170),C=a(211965);const k=e=>{const{onClose:t=(()=>{}),onOpen:a=(()=>{}),visible:l,data:n,options:o,onDetermine:i=(()=>{}),id:u,name:r,filterState:k}=e,x=(0,d.v9)((e=>e.dashboardState.mobileFilterType)),F=(0,d.v9)((e=>e.dashboardState.mobileFilterStatus)),N=(0,d.v9)((e=>e.dashboardState.drawerStatus)),I=(0,d.v9)((e=>e.dashboardState.viewType||"rowAndColumn")),[M,O]=((0,d.v9)((e=>{var t;return(null==(t=e.dashboardState)?void 0:t.emulateRatio)||{width:350,height:680}})),(0,s.useState)(k.label||"")),[T,D]=(0,s.useState)(""),[E,J]=(0,s.useState)(o),[$,j]=(0,s.useState)(),z=(0,s.useRef)(),[A,P]=(0,s.useState)(!1),R=(e,t)=>{const{viewValus:a,viewIndex:l}=z.current;a([e]),l(t)},V=()=>{D(""),J(o),t()};(0,s.useEffect)((()=>{l&&!1===A&&O(k.label||"")}),[l]);const _=()=>{O(""),D(""),J(o)};return(0,y.Z)((()=>{F.confirm&&!F.reset&&$&&i($),!F.confirm&&F.reset&&i()}),[JSON.stringify(F)]),(0,y.Z)((()=>{"grid"===I&&(F.confirm&&!F.reset&&$&&i($),!F.confirm&&F.reset&&i())}),[JSON.stringify(F),$]),(0,C.tZ)(s.Fragment,null,(0,C.tZ)(S.Z,{id:u,name:r,onClick:a,type:x,defaultActiveKey:[u],multiSelect:!1},(0,C.tZ)(w.Z,{ref:z,data:e,options:o,onSelectionChange:(e,t,a)=>{j(e),O(t),P(a)},multiSelect:!1,filterState:k})),(0,C.tZ)(p.Z,{visible:l,onMaskClick:()=>{A?(V(),R($,M)):V()},position:"right"},(0,C.tZ)(b.Z,null,(0,C.tZ)(Z.Z,{text:r}),(0,C.tZ)("div",{className:"inputType"},(0,C.tZ)(c.II,{clearable:!0,value:T,onChange:e=>{const t=e.trim();D(t);const a=o.filter((e=>e.label.includes(t)));J(a)},placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u641c\u7d22",style:{"--text-align":"center"}})),(0,C.tZ)("div",{className:"warp"},E.length>0?E.map(((e,t)=>(0,C.tZ)(v.Z,{className:"borderBottom",key:e.label},(0,C.tZ)(h.Z,{className:"margins",span:20},e.label),(0,C.tZ)(h.Z,{className:"margins",span:4},(0,C.tZ)(m.ZP.Group,{onChange:t=>((e,t)=>{O(e.target.value),j(t.value)})(t,e),value:M},(0,C.tZ)(m.ZP,{value:e.label})))))):(0,C.tZ)(f.Z,{description:"\u6682\u65e0\u6570\u636e"})),(0,C.tZ)(g.Z,{onRest:()=>{A?(R("",""),_()):(i(),_())},onConfirm:()=>{0===N?A?(i($),R($,M),V()):($&&i($),V()):(R($,M),t())}}))))};var x=a(52004);function F(e){const{data:t,formData:a,height:l,width:c,setDataMask:v,setHoveredFilter:h,unsetHoveredFilter:m,setFocusedFilter:f,unsetFocusedFilter:p,setFilterActive:b,filterState:Z,inputRef:g}=e,{defaultValue:S}=a,w=(0,d.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_type})),[y,F]=(0,s.useState)(null!=S?S:[]),N=(0,s.useMemo)((()=>t.reduce(((e,{duration:t,name:a})=>({...e,[t]:a})),{})),[JSON.stringify(t)]),I=e=>{const t=(0,o.Z)(e),[a]=t,l=a?N[a]:void 0,n={};a&&(n.time_grain_sqla=a),F(t),v({extraFormData:n,filterState:{label:l,value:t.length?t:null}})};(0,s.useEffect)((()=>{I(null!=S?S:[])}),[JSON.stringify(S)]),(0,s.useEffect)((()=>{var e;I(null!=(e=Z.value)?e:[])}),[JSON.stringify(Z.value)]);const M=0===(t||[]).length?(0,i.t)("No data"):(0,i.tn)("%s option","%s options",t.length,t.length),O={};Z.validateMessage&&(O.extra=(0,C.tZ)(r.Am,{status:Z.validateStatus},Z.validateMessage));const T=(t||[]).map((e=>{const{name:t,duration:a}=e;return{label:t,value:a}}));let D=e=>(null==e?void 0:e.parentNode)||document.body;"grid"===w&&(D=()=>document.body);const[E,J]=(0,s.useState)(!1);return(0,d.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode}))===x.kB.MOBILE?(0,C.tZ)(k,{id:null==a?void 0:a.ftId,name:null==a?void 0:a.ftName,data:e,visible:E,onClose:()=>J(!1),onOpen:()=>J(!0),options:T,filterState:Z,onDetermine:e=>{I(e),J(!1)}}):(0,C.tZ)(r.un,{height:l,width:c},(0,C.tZ)(r.jp,n()({validateStatus:Z.validateStatus},O),(0,C.tZ)(u.Ph,{getPopupContainer:D,allowClear:!0,value:y,placeholder:M,onChange:I,onBlur:p,onFocus:f,onMouseEnter:h,onMouseLeave:m,ref:g,options:T,onDropdownVisibleChange:b})))}},174448:(e,t,a)=>{a.d(t,{Am:()=>s,jp:()=>i,un:()=>o});var l=a(751995),n=a(804591);const o=l.iK.div`
  min-height: ${({height:e})=>e}px;
  width: ${({width:e})=>e}px;
`,i=(0,l.iK)(n.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,s=l.iK.div`
  color: ${({theme:e,status:t="error"})=>{var a;return null==(a=e.colors[t])?void 0:a.base}};
`}}]);