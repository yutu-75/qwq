"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[53723,95470],{320957:(e,t,a)=>{a.r(t),a.d(t,{default:()=>st});var n=a(211965),l=a(667294),s=a(616550),i=a(929119),r=a(997183),o=a(748086),d=a(435247),c=a(751995),p=a(431069),u=a(732746),m=a(823147),h=a(114666),Z=a(305099),g=a(535741),y=a(455867),f=a(886994),_=a(807500),v=a(205872),b=a.n(v),S=a(164561),x=a(359314),C=a(931097),k=a(855241),P=a(560331),A=a(519650),j=a(71577),T=a(432787),E=a(3006),N=a(149531),w=a(757016),I=a(771230),O=a(515746),R=a(970553),F=a(213958),L=a(730381),D=a.n(L),$=(a(115926),a(714670)),U=a.n($),z=a(492018),V=a(648138),M=a(135855),H=a(530744),K=a(49937),B=a(589816);const G=()=>{const e=document.getElementById("app"),{user:t}=JSON.parse((null==e?void 0:e.getAttribute("data-bootstrap"))||"{}"),a=t.isAdmin,[s]=S.Z.useForm(),[i]=S.Z.useForm(),[r,d]=(0,l.useState)(!1),[c,u]=(0,l.useState)(""),[m,h]=(0,l.useState)(0),[Z,g]=(0,l.useState)(1),[f,_]=(0,l.useState)(10),[v,L]=(0,l.useState)(""),[$,G]=(0,l.useState)([]),[J,q]=(0,l.useState)([]),[Y,W]=(0,l.useState)([]),[X,Q]=(0,l.useState)([]),[ee,te]=(0,l.useState)(!1),[ae,ne]=(0,l.useState)(""),[le,se]=(0,l.useState)(!1),[ie,re]=(0,l.useState)([]),[oe,de]=(0,l.useState)(!1),[ce,pe]=(0,l.useState)(!1),[ue,me]=(0,l.useState)(""),[he,Ze]=(0,l.useState)(!1),[ge,ye]=(0,l.useState)(0),fe=(e,t)=>{"add"==e&&(u((0,y.t)("New users")),i.setFieldsValue({is_admin:!1}),ke(!1,null)),"edit"==e&&u((0,y.t)("Edit User")),t&&(ne(t),p.Z.get({endpoint:`/api/v2/user/${t}/`,headers:{"Content-Type":"application/json"}}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=e.json.meta.data;if(t.roles.length>0){let e=[];t.roles.map((t=>{Y.some((e=>e.value===t.id))||e.push({label:t.name,value:t.id,disabled:!0})})),q([...e,...Y])}let a=[];t.depts.length>0&&t.depts.map((e=>{a.push(e.id)})),i.setFieldsValue({cn_name:t.cn_name,active:!!t.active&&t.active,first_name:t.first_name,last_name:t.last_name,username:t.username,password:t.password,roles:t.roles.map((e=>e.id)),dept_id:a,email:t.email,is_admin:t.is_admin}),a.length?a.forEach((e=>{ke(!0,e)})):ke(!0,null)}else o.ZP.error(e.json.meta.message)}))),d(!0)},_e=()=>{i.setFieldsValue({cn_name:void 0,active:!1,first_name:void 0,last_name:void 0,username:void 0,password:void 0,roles:void 0,email:void 0,is_admin:void 0,dept_id:void 0}),i.resetFields(),d(!1),te(!1),ne("")},ve=[{title:(0,y.t)("Name"),dataIndex:"name",key:"name",width:120,render:(e,t)=>(0,n.tZ)("span",null,t.cn_name)},{title:(0,y.t)("Email"),dataIndex:"email",width:150},{title:(0,y.t)("Account"),dataIndex:"username",width:150},{title:(0,y.t)("Is Super Administrator"),dataIndex:"",key:"4",width:150,render:(e,t)=>(0,n.tZ)("div",null,(0,n.tZ)(x.Z,{onChange:e=>((e,t)=>{if(t){const e=t.roles.map((e=>e.id)),a=t.depts.map((e=>e.id));let n={active:t.active,cn_name:t.cn_name,email:t.email,first_name:t.first_name,is_admin:!t.is_admin,last_name:t.first_name,roles:e,dept_id:a,username:t.username};pe(!0),p.Z.put({method:"PATCH",endpoint:`/api/v2/user/${t.id}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),pe(!1)):(o.ZP.error(e.json.meta.message),pe(!1))})).catch((()=>{pe(!1)}))}})(0,t),checked:t.is_admin}))},{title:(0,y.t)("Role"),dataIndex:"",key:"2",ellipsis:!0,render:(e,t)=>{var a;return(0,n.tZ)("span",null,null==(a=t.roles)?void 0:a.map(((e,t)=>(0,n.tZ)("span",{key:e.id},t?",":"",e.name))))}},{title:(0,y.t)("Organizaiton"),dataIndex:"",ellipsis:!0,render:(e,t)=>{var a;return(0,n.tZ)("span",null,null==(a=t.depts)?void 0:a.map(((e,t)=>(0,n.tZ)("span",{key:e.id},t?",":"",e.title))))}},{title:(0,y.t)("CreateTime"),dataIndex:"",ellipsis:!0,render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)("span",null,(0,n.tZ)(C.Z,{placement:"topLeft",title:D().utc(t.created_on).format("YYYY-MM-DD HH:mm:ss")},D().utc(t.created_on).format("YYYY-MM-DD"))))},{title:(0,y.t)("Activation status"),dataIndex:"",key:"4",width:150,render:(e,t)=>(0,n.tZ)("div",null,(0,n.tZ)(x.Z,{onChange:e=>((e,t)=>{if(t){let a={active:e?1:0};pe(!0),p.Z.request({method:"PATCH",endpoint:`/api/v2/user/${t.id}/active/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),pe(!1)):(o.ZP.error(e.json.meta.message),pe(!1))})).catch((()=>{pe(!1)}))}})(e,t),checked:t.active}))},{title:(0,y.t)("Account status"),dataIndex:"",key:"4",width:150,render:(e,t)=>{var a;return(0,n.tZ)("div",null,null!=(a=t.account_lock)&&a.status&&t.account_lock.ttl-ge+1?(0,n.tZ)(k.Z,{content:be(t),title:(0,y.t)("Account locked"),trigger:"hover"},(0,n.tZ)(P.Z,{icon:(0,n.tZ)(z.default,null),color:"error"},`${(0,y.t)("Lock for")} ${t.account_lock.ttl-ge} ${(0,y.t)("seconds")}`)):(0,n.tZ)(P.Z,{icon:(0,n.tZ)(V.default,null),color:"success"},(0,y.t)("Normal")))}},{title:(0,y.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)(A.Z,null,(0,n.tZ)("span",{className:"btncolor",onClick:()=>fe("edit",t.id)},(0,y.t)("Edit")),(0,n.tZ)("span",{className:"btncolor",onClick:()=>{Ze(!0),me(t.id)}},(0,y.t)("Delete"))))}],be=e=>(0,n.tZ)("div",{style:{width:"200px"}},(0,n.tZ)("p",null,(0,y.t)("The user's account has been locked due to multiple incorrect password inputs. It will be automatically unlocked after the countdown ends!")),a&&(0,n.tZ)("div",null,(0,n.tZ)("p",null,(0,y.t)("Administrator clicks the button below to manually unlock"),"\uff1a"),(0,n.tZ)("p",null,(0,n.tZ)(j.Z,{type:"primary",size:"small",onClick:()=>(e=>{pe(!0),p.Z.delete({endpoint:`/api/v2/user/${e.id}/account/lock`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),pe(!1)):(o.ZP.error(e.json.meta.message),pe(!1))})).catch((()=>{pe(!1)}))})(e)},(0,y.t)("Unlock")))));function Se(){p.Z.get({endpoint:`/api/v2/user/?username=${v||""}&page_index=${Z}&page_size=${f}`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(h(e.json.meta.data.count),G(e.json.meta.data.list),ye(0)):o.ZP.error(e.json.meta.message)}))}const xe=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.value=e.dept_id,a.pid=e.pid,a.children=e.children?xe(e.children):[],t.push(a),!1})),t};(0,l.useEffect)((()=>{Se()}),[Z,f,v]),(0,l.useEffect)((()=>{p.Z.get({endpoint:"/api/v2/role/"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=[];e.json.meta.data.list.map((e=>{t.push({label:e.name,value:e.id})})),W(t),q(t)}else o.ZP.error(e.json.meta.message)})),p.Z.get({endpoint:"/api/v2/dept/"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=xe(e.json.meta.data);Q(t)}else o.ZP.error(e.json.meta.message)}));const e=setInterval((()=>{ye((e=>e+1))}),1e3);return()=>{clearInterval(e)}}),[]);const Ce=()=>{re([]),se(!1)},ke=(e,t)=>{const a=JSON.parse(JSON.stringify(X));if(t){const n=Ae(t);null!==n&&(a[n].value!==t&&(a[n].disabled=e),Pe(e,t,a[n].children))}else Pe(!1,0,a);Q(a)};function Pe(e,t,a){a.forEach((a=>{a.value==t?a.disabled=!1:a.disabled=e,a.children&&a.children.length>0&&Pe(e,t,a.children)}))}const Ae=e=>{function t(e,a){let n=0;return a.forEach((a=>{a.value==e?n++:a.children&&a.children.length>0&&(n+=t(e,a.children))})),n}let a=null;return X.forEach(((n,l)=>{(n.value==e||n.children&&n.children.length>0&&t(e,n.children))&&(a=l)})),a},je={onRemove:e=>{const t=ie.indexOf(e),a=ie.slice();a.splice(t,1),re(a)},beforeUpload:e=>e.name.split(".")?"xlsx"===e.name.split(".")[1]||"xls"===e.name.split(".")[1]?1==ie.length?o.ZP.error((0,y.t)("Only one file can be uploaded at a time")):(re([...ie,e]),!1):o.ZP.error((0,y.t)("Only Excel files can be uploaded")):o.ZP.error((0,y.t)("Please upload the Excel file")),fileList:ie};a||ve.splice(3,1);return(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"topbox"},(0,n.tZ)(S.Z,{form:s,name:"horizontal_login",layout:"inline",onFinish:e=>{g(1),L(e.username)}},(0,n.tZ)(S.Z.Item,{name:"username",label:(0,y.t)("Name")},(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Please enter")})),(0,n.tZ)(S.Z.Item,{shouldUpdate:!0},(()=>(0,n.tZ)(j.Z,{type:"primary",htmlType:"submit"},(0,y.t)("Search")))),(0,n.tZ)(S.Z.Item,null,(0,n.tZ)(j.Z,{onClick:()=>{s.resetFields(),L(""),Se()}},(0,y.t)("Reset")))),(0,n.tZ)("div",null,(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{type:"primary",onClick:()=>fe("add")},(0,y.t)("Add")),(0,n.tZ)(j.Z,{onClick:()=>{se(!0)},type:"primary"},(0,y.t)("Import"))))),(0,n.tZ)("div",{className:"contenttalbe"},(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:ve,dataSource:$,pagination:!1,loading:ce,scroll:{x:"1320px",y:"calc(100vh - 350px)"},style:{width:"100%",padding:"0 15px"}}),(0,n.tZ)("div",{className:"paginationseat"},m>0&&(0,n.tZ)(N.Z,{onChange:(e,t)=>{g(e),_(t)},total:m}))),(0,n.tZ)(w.Z,{width:"50%",title:c,visible:r,onCancel:_e,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:_e},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:ee,onClick:()=>{i.validateFields().then((e=>{if(e){if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(i.getFieldValue().email))return o.ZP.error("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u5bf9");ae?(te(!0),p.Z.put({endpoint:`/api/v2/user/${ae}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(i.getFieldValue())}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),d(!1),te(!1),_e()):(o.ZP.error(e.json.meta.message),te(!1))})).catch((()=>{te(!1)}))):(i.getFieldValue().first_name="",i.getFieldValue().last_name="",te(!0),p.Z.post({endpoint:"/api/v2/user/",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.getFieldValue())}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),d(!1),te(!1),_e()):(o.ZP.error(e.json.meta.message),te(!1))})).catch((()=>{te(!1)})))}else te(!1)})).catch((()=>{te(!1)}))}},(0,y.t)("Confirm"))))]},(0,n.tZ)(S.Z,{form:i,labelCol:{span:8},wrapperCol:{span:16},name:"userform"},(0,n.tZ)(I.Z,null,(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"cn_name",label:(0,y.t)("Name"),rules:[{required:!0,message:(0,y.t)("Please enter name!")}]},(0,n.tZ)(T.Z,{maxLength:64,placeholder:(0,y.t)("Please enter")}))),(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"email",label:(0,y.t)("Email"),rules:[{type:"email",required:!0,message:(0,y.t)("Please enter your email address!")}]},(0,n.tZ)(T.Z,{maxLength:35,placeholder:(0,y.t)("Please enter")}))),(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"username",label:(0,y.t)("Account"),rules:[{required:!0,message:(0,y.t)("enter one user account")}]},(0,n.tZ)(T.Z,{maxLength:64,placeholder:(0,y.t)("Please enter")}))),c==(0,y.t)("New users")?(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"password",label:(0,y.t)("Password"),rules:[{required:!0,message:(0,y.t)("Please input a password")},{validator:async(e,t,a)=>t?t.length<8||t.length>16?Promise.reject(new Error((0,y.t)("The password length must be greater than or equal to 8 but less than or equal to 16"))):void a():Promise.resolve()}]},(0,n.tZ)(T.Z.Password,{title:(0,y.t)("The password must contain uppercase and lowercase letters and numbers, and the password length must be greater than or equal to 8 but less than or equal to 16"),maxLength:16,placeholder:(0,y.t)("Please enter")}))):"",(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"dept_id",label:(0,y.t)("Organizaiton"),rules:[{required:!0,message:(0,y.t)("Please select the dept you belong to!")}]},(0,n.tZ)(R.Z,{onChange:(e,t,a)=>{i.setFieldsValue({dept_id:e}),ke(a.selected,a.triggerValue)},placeholder:(0,y.t)("Please select"),treeData:X,multiple:!0}))),(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"roles",label:(0,y.t)("Role"),rules:[{required:!0,message:(0,y.t)("Please select the role you belong to!")}]},(0,n.tZ)(K.Ph,{mode:"multiple",onChange:e=>{i.setFieldsValue({roles:e})},placeholder:(0,y.t)("Please select"),allowClear:!0,options:J}))),(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"active",label:(0,y.t)("Activation status"),valuePropName:"checked"},(0,n.tZ)(x.Z,{onChange:e=>{i.getFieldValue({active:e})}}))),a?(0,n.tZ)(O.Z,{span:12},(0,n.tZ)(S.Z.Item,{name:"is_admin",label:(0,y.t)("Is Super Administrator"),valuePropName:"checked"},(0,n.tZ)(x.Z,{onChange:e=>{i.getFieldValue({is_admin:e})}}))):null))),(0,n.tZ)(w.Z,{title:(0,y.t)("Import"),width:"50%",visible:le,onCancel:Ce,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:Ce},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:oe,onClick:()=>{const e=new FormData;if(e.append("formData",ie[0]),void 0==ie[0])return o.ZP.error((0,y.t)("Please upload the file first"));de(!0),p.Z.post({endpoint:"/api/v2/user/import/",body:e}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success((0,y.t)("upload successfully.")),Ce(),Se()):o.ZP.error(e.json.meta.message)})).catch((()=>{o.ZP.error((0,y.t)("upload failed"))})).finally((()=>{de(!1)}))}},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{display:"flex"}},(0,n.tZ)(F.Z,b()({},je,{accept:".xls, .xlsx"}),(0,n.tZ)(j.Z,{icon:(0,n.tZ)(M.default,null)},(0,y.t)("Import"))),(0,n.tZ)(j.Z,{onClick:()=>{const e=U().generate(),t=document.createElement("iframe");t.style.display="none",t.src="/api/v2/user/import/template/",document.body.appendChild(t);const a=window.setInterval((()=>{"done"===(0,B.Z)()[e]&&(window.clearInterval(a),document.body.removeChild(t))}),200)},icon:(0,n.tZ)(H.default,null),style:{marginLeft:"10px"}},(0,y.t)("Download Template")))),(0,n.tZ)(w.Z,{title:(0,y.t)("Delete"),width:"20%",visible:he,onCancel:()=>{Ze(!1),de(!1)},footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>{Ze(!1),de(!1)}},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:oe,onClick:()=>{return e=ue,de(!0),void p.Z.delete({endpoint:`/api/v2/user/${e}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(Se(),Ze(!1),de(!1),o.ZP.success(e.json.meta.message)):(o.ZP.error(e.json.meta.message),de(!1))}));var e}},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{marginTop:"20px"}},(0,n.tZ)("span",null,(0,y.t)("Confirm to delete?")))))};var J=a(948205),q=a(734041),Y=a(184728);const{Option:W}=q.Z,X=()=>{const[e]=S.Z.useForm(),[t]=S.Z.useForm(),[a,s]=(0,l.useState)(!1),[i,r]=(0,l.useState)(),[d,c]=(0,l.useState)(0),[u,m]=(0,l.useState)(1),[h,Z]=(0,l.useState)(10),[g,f]=(0,l.useState)(""),[_,v]=(0,l.useState)([]),[b,x]=(0,l.useState)([]),[C,k]=(0,l.useState)(!1),[P,R]=((0,l.useRef)(),(0,l.useState)("")),[F,L]=(0,l.useState)(!1),[D,$]=(0,l.useState)(!1),U=(e,a)=>{"add"==e&&r((0,y.t)("New Role")),"edit"==e&&(r((0,y.t)("Edit Role")),t.setFieldsValue({id:a.id,name:a.name})),s(!0)},z=()=>{t.resetFields(),s(!1),k(!1)},V=[{title:(0,y.t)("Role Name"),dataIndex:"name",key:"name"},{title:(0,y.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)(A.Z,null,(0,n.tZ)("span",{className:"btncolor",onClick:()=>U("edit",t)},(0,y.t)("Edit")),(0,n.tZ)("span",{className:"btncolor",onClick:()=>{L(!0),R(t.id)}},(0,y.t)("Delete"))))}];function M(){p.Z.get({endpoint:`/api/v2/role/?name=${g}&page_index=${u}&page_size=${h}`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(c(e.json.meta.data.count),v(e.json.meta.data.list)):o.ZP.error(e.json.meta.message)}))}(0,l.useEffect)((()=>{M()}),[u,h,g]);return(0,n.tZ)("div",null,(0,n.tZ)("div",{style:{textAlign:"right",width:"100%"}},(0,n.tZ)(A.Z,null,(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Please enter a role name to search for"),onChange:e=>{m(1),Z(10),f(e.target.value)}}),(0,n.tZ)(j.Z,{type:"primary",onClick:()=>U("add")},(0,y.t)("Add")))),(0,n.tZ)("div",{className:"contenttalbe"},(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:V,dataSource:_,pagination:!1,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0 15px"}}),(0,n.tZ)("div",{className:"paginationseat"},d>0&&(0,n.tZ)(N.Z,{onChange:(e,t)=>{m(e),Z(t)},total:d}))),(0,n.tZ)(w.Z,{onCancel:z,destroyOnClose:!0,width:"40%",title:i,visible:a,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:z},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:C,onClick:()=>{t.validateFields().then((e=>{if(e)if(k(!0),t.getFieldValue().id){let e={name:t.getFieldValue().name};p.Z.put({endpoint:`/api/v2/role/${t.getFieldValue().id}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),M(),s(!1),z(),k(!1)):(o.ZP.error(e.json.meta.message),k(!1))}))}else p.Z.post({endpoint:"/api/v2/role/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.getFieldValue())}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),M(),s(!1),z(),k(!1)):(o.ZP.error(e.json.meta.message),k(!1))})).catch((()=>{k(!1)}));else k(!1)})).catch((()=>{k(!1)}))}},(0,y.t)("Confirm"))))]},(0,n.tZ)(S.Z,{form:t,labelCol:{span:8},wrapperCol:{span:16},name:"userform",preserve:!1},(0,n.tZ)(I.Z,null,(0,n.tZ)(O.Z,{span:24},(0,n.tZ)(S.Z.Item,{name:"name",label:(0,y.t)("Role Name"),rules:[{required:!0,message:(0,y.t)("Please enter a role name!")}]},(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Please enter"),maxLength:64})))))),(0,n.tZ)(w.Z,{title:(0,y.t)("Delete"),width:"20%",visible:F,onCancel:()=>{L(!1),$(!1)},footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>{L(!1),$(!1)}},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:D,onClick:()=>{return e=P,$(!0),void p.Z.delete({endpoint:`/api/v2/role/${e}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(m(1),Z(10),M(),L(!1),$(!1),o.ZP.success(e.json.meta.message)):(o.ZP.error(e.json.meta.message),$(!1))}));var e}},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{marginTop:"20px"}},(0,n.tZ)("span",null,(0,y.t)("Confirm to delete?")))))},{Search:Q}=T.Z;let ee=0,te=1;const ae=()=>{(0,l.useRef)();const[e]=S.Z.useForm(),[t,a]=(0,l.useState)(1),[s,i]=(0,l.useState)(!1),[r,d]=(0,l.useState)([]),[c,u]=(0,l.useState)((0,y.t)("Organization Management")),[m,h]=(0,l.useState)(),[Z,g]=(0,l.useState)([]),[f,_]=(0,l.useState)(!1),[v,b]=(0,l.useState)(!1),[x,C]=(0,l.useState)(""),[k,P]=(0,l.useState)(""),[R,F]=(0,l.useState)([]),[L,D]=(0,l.useState)(""),[$,U]=(0,l.useState)(!0),[z,V]=(0,l.useState)(""),[M,H]=(0,l.useState)(""),[K,B]=(0,l.useState)([]),[G,W]=(0,l.useState)(0),[Q,ae]=(0,l.useState)(),[ne,le]=(0,l.useState)(""),[se,ie]=(0,l.useState)(!1),[re,oe]=(0,l.useState)(!1),[de,ce]=(0,l.useState)(0),[pe,ue]=(0,l.useState)(1),[me,he]=(0,l.useState)(10),Ze=()=>{e.resetFields(),_(!1),b(!1),P("")};function ge(e){p.Z.get({endpoint:`/api/v2/role/?name=${M}&page_index=${e}&page_size=25`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){if(t.json.meta.data.list.length>0){const a=1==e?[]:[...K];t.json.meta.data.list.map((e=>{let t={value:e.id,label:e.name};a.push(t)})),ae(a[0].value),B(a),W(t.json.meta.data.count),te=e}}else o.ZP.error(t.json.meta.message)}))}function ye(e=1){Q&&p.Z.get({endpoint:`/api/v2/user/?role_id=${Q}&username=${z}&page_index=${e}&page_size=${me}`}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?(ce(t.json.meta.data.count),g(t.json.meta.data.list),ue(e)):o.ZP.error(t.json.meta.message)}))}(0,l.useEffect)((()=>{ge(1)}),[M]),(0,l.useEffect)((()=>{ye()}),[Q]);const fe=[{title:(0,y.t)("Name"),dataIndex:"name",key:"name",render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)("span",null,t.cn_name))},{title:(0,y.t)("Username"),dataIndex:"username",key:"username"},{title:(0,y.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)(A.Z,null,(0,n.tZ)("span",{className:"btncolor",onClick:()=>{ie(!0),le(t.id)}},(0,y.t)("Delete"))))}];(0,l.useEffect)((()=>{ye()}),[z]);const _e=(0,l.useCallback)((e=>{const{scrollTop:t,clientHeight:a,scrollHeight:n}=e.currentTarget;if(t-ee>0){if(t+a>n-2&&K.length<G){ge(te+1)}}ee=t}),[K,G]);return(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"topbtn"},(0,n.tZ)(J.Z,{defaultActiveKey:"1",style:{width:"100%"},onChange:function(e){a(e),ge(1)}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("member"),key:"1"},(0,n.tZ)("div",{className:"treediv"},(0,n.tZ)("div",{style:{width:"100%"}},(0,n.tZ)("div",{className:"righttop"},(0,n.tZ)("div",{className:"rightr",style:{textAlign:"right",width:"100%"}},(0,n.tZ)(A.Z,null,(0,n.tZ)(q.Z,{placeholder:(0,y.t)("Search by role name"),onChange:e=>{e!=Q&&ae(e)},options:K,onPopupScroll:_e,showSearch:!0,filterOption:(e,t)=>t.label.includes(e),style:{width:"223px",textAlign:"left"},value:Q}),(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Search by name"),onChange:e=>{V(e.target.value)},value:z}),(0,n.tZ)(j.Z,{type:"primary",onClick:()=>{_(!0)}},(0,y.t)("Add"))))),(0,n.tZ)("div",{className:"tablediv"},(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:fe,dataSource:Z,pagination:!1,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0 15px"}}),(0,n.tZ)("div",{className:"paginationseat"},de>0&&(0,n.tZ)(N.Z,{onChange:e=>{ye(e)},total:de})),(0,n.tZ)(w.Z,{onCancel:Ze,destroyOnClose:!0,width:"40%",title:(0,y.t)("Add Members"),visible:f,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:Ze},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:v,onClick:()=>{if(b(!0),!Q)return b(!1),o.ZP.error((0,y.t)("Please select a role"));if(""==k)return b(!1),o.ZP.error((0,y.t)("Please select a member"));if(k){let e={user_ids:[k]};p.Z.post({endpoint:`/api/v2/role/${Q}/users/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),b(!1),ye(),Ze()):(o.ZP.error(e.json.meta.message),b(!1))})).catch((()=>{b(!1)}))}else b(!1)}},(0,y.t)("Confirm"))))]},(0,n.tZ)(S.Z,{form:e,labelCol:{span:8},wrapperCol:{span:16},name:"userform",preserve:!1},(0,n.tZ)(I.Z,null,(0,n.tZ)(O.Z,{span:24},(0,n.tZ)(S.Z.Item,{name:"",label:(0,y.t)("Select Members")},(0,n.tZ)(Y.Z,{placeholder:(0,y.t)("Please select a member for selection"),style:{width:200},getvalue:function(e){P(e)},role_id:Q})))))))))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Role"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(X,null))))),(0,n.tZ)(w.Z,{title:(0,y.t)("Delete"),width:"20%",visible:se,onCancel:()=>{ie(!1),oe(!1)},footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>{ie(!1),oe(!1)}},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:re,onClick:()=>function(e){oe(!0);let t={user_ids:[e]};p.Z.delete({endpoint:`/api/v2/role/${Q}/users/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),ye(),ie(!1),oe(!1)):(o.ZP.error(e.json.meta.message),oe(!1))}))}(ne)},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{marginTop:"20px"}},(0,n.tZ)("span",null,(0,y.t)("Confirm to delete?")))))};var ne=a(150361),le=a.n(ne),se=a(591665),ie=a(227049);let re,oe="",de=0,ce=!0,pe=1;const ue=(e,t,a=[],n=1,l=25)=>{re&&(clearTimeout(re),re=null),oe=e.value;re=setTimeout((()=>{p.Z.get({endpoint:`/api/v2/user/?username=${e.value}&filter_dept_id=${e.deptId}&page_index=${n}&page_size=${l}`}).then((l=>{if(oe===e.value&&l.json.meta.data.list.length>0){const e=l.json.meta.data.list.map((e=>({value:e.id,text:e.cn_name?e.cn_name:""}))),s=[...a,...e];t(s),pe=n}ce=!0}))}),300)},me=e=>{const[t,a]=(0,l.useState)([]),[s,i]=(0,l.useState)();(0,l.useEffect)((()=>{let t={value:"",deptId:e.deptId};ue(t,a)}),[]);return(0,n.tZ)(q.Z,{showSearch:!0,value:s,placeholder:e.placeholder,style:e.style,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:t=>{if(t){let n={value:t,deptId:e.deptId};ue(n,a)}else a([])},onChange:t=>{e.getvalue(t)},notFoundContent:null,onPopupScroll:n=>{const{scrollTop:l,clientHeight:s,scrollHeight:i}=n.currentTarget;if(l-de>0){if(l+s>i-2&&ce){ce=!1;let n=pe+1,l={value:oe,deptId:e.deptId};ue(l,a,t,n)}}de=l},options:(t||[]).map((e=>({value:e.value,label:e.text})))})};var he=a(566342),Ze=a(191873);const{Search:ge}=T.Z,ye=()=>{(0,l.useRef)();const[e]=S.Z.useForm(),[t,a]=(0,l.useState)(!1),[s,i]=(0,l.useState)([]),[r,d]=(0,l.useState)(),[c,u]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),[Z,g]=(0,l.useState)(!1),[f,_]=(0,l.useState)(""),[v,b]=(0,l.useState)(!1),[x,C]=(0,l.useState)(""),[k,P]=(0,l.useState)([]),[N,F]=(0,l.useState)(),[L,$]=(0,l.useState)(""),[U,z]=(0,l.useState)(!1),[V,M]=(0,l.useState)(!1),[H,K]=(0,l.useState)([]),B=document.getElementById("app"),{user:G}=JSON.parse((null==B?void 0:B.getAttribute("data-bootstrap"))||"{}"),J=G.isAdmin,q=(t,a)=>{"add"==t&&(e.setFieldsValue({pid:"",dept_id:""}),F((0,y.t)("New Organization")),Q()),"edit"==t&&(F((0,y.t)("Edit Organization")),e.setFieldsValue({dept_id:a.dept_id,pid:0==a.pid?"":a.pid?a.pid:"",title:a.title}),Q(a.dept_id,t)),"addson"==t&&(F((0,y.t)("Add suborganization")),e.setFieldsValue({pid:a.dept_id,title:""}),Q(a.dept_id,t)),_(t),g(!0)},Y=()=>{x.resetFields,e.setFieldsValue({pid:"",dept_id:"",title:""}),g(!1),b(!1)};function W(){p.Z.get({endpoint:"/api/v2/dept/"}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(u(e.json.meta.data),h(e.json.meta.data)):o.ZP.error(e.json.meta.message)}))}(0,l.useEffect)((()=>{W()}),[]),(0,l.useEffect)((()=>{var t;!J&&Z&&"add"==f&&s.length>0&&e.setFieldsValue({pid:null==(t=s[0])?void 0:t.value})}),[Z,f,s]);const X=[{title:"",width:"150px"},{title:(0,y.t)("Organization Name"),dataIndex:"title",key:"title",sorter:(e,t)=>e.title.length-t.title.length},{title:(0,y.t)("CreateTime"),dataIndex:"",render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)("span",null,t.created_on?D().utc(t.created_on).format("YYYY-MM-DD HH:mm:ss"):""))},{title:(0,y.t)("Actions"),key:"operation",render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)(A.Z,null,(0,n.tZ)("span",{className:"btncolor",onClick:()=>q("edit",t)},(0,y.t)("Edit")),(0,n.tZ)("span",{className:"btncolor",onClick:()=>q("addson",t)},(0,y.t)("Add suborganization")),(0,n.tZ)("span",{className:"btncolor",onClick:()=>{z(!0),$(t.dept_id)}},(0,y.t)("Delete"))))}];function Q(e,t){p.Z.get({endpoint:"/api/v2/dept/"}).then((a=>{if(200==a.json.meta.code||201==a.json.meta.code){let n=ee(a.json.meta.data);if(e&&"edit"==t){let t=[];n.map((a=>{a.value!=e&&t.push(a)})),i(t)}else i(n)}else o.ZP.error(a.json.meta.message)}))}const ee=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.value=e.dept_id,a.children=e.children?ee(e.children):[],t.push(a),!1})),t},te=e=>{let t=e.target.value;if(t){let e=ne(c,t);u(e);let a=ae(e);K(a)}else u(m)},ae=e=>{let t=[],a=function(e){e&&e.length>0&&e.map((e=>{const n=a(e.children);return t.push(e.dept_id),n&&n.length&&a(e.children),!1}))};return a(e),t},ne=(e,t)=>{let a=[];return e.map((e=>{const n=ne(e.children,t);return-1!==e.title.indexOf(t)?a.push(e):n&&n.length&&(e.children=n,a.push(e)),!1})),a};return(0,n.tZ)("div",null,(0,n.tZ)("div",null,(0,n.tZ)("div",null,(0,n.tZ)("div",null,(0,n.tZ)("div",{style:{textAlign:"right"}},(0,n.tZ)(A.Z,null,(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Search by name"),onChange:()=>{u(m)},onBlur:te,onKeyDown:e=>(e=>{13==e.keyCode&&te(e)})(e)}),(0,n.tZ)(j.Z,{type:"primary",onClick:()=>q("add")},(0,y.t)("Add"))))),(0,n.tZ)("div",{className:"tablediv"},(0,n.tZ)(E.Z,{expandIcon:({expanded:e,onExpand:t,record:a})=>{if(e){if(a.children.length>0)return(0,n.tZ)(he.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(a.children.length>0)return(0,n.tZ)(Ze.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.dept_id,columns:X,dataSource:c,pagination:!1,scroll:{y:"calc(100vh - 350px)"},style:{width:"100%",padding:"0"},expandedRowKeys:H,onExpand:(e,t)=>{const a=e?[...H,t.dept_id]:H.filter((e=>e!==t.dept_id));K(a)},locale:{emptyText:(0,y.t)("No Data"),triggerDesc:(0,y.t)("Click to sort descending"),triggerAsc:(0,y.t)("Click to cancel sorting"),cancelSort:(0,y.t)("Click to sort ascending")}}),(0,n.tZ)(w.Z,{onCancel:Y,destroyOnClose:!0,width:"40%",title:N,visible:Z,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:Y},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:v,onClick:()=>{b(!0),e.validateFields().then((t=>{if(t)if(e.getFieldValue().dept_id){let t={title:e.getFieldValue().title,pid:e.getFieldValue().pid&&null!=e.getFieldValue().pid&&""!=e.getFieldValue().pid?e.getFieldValue().pid:0};p.Z.put({endpoint:`/api/v2/dept/${e.getFieldValue().dept_id}/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(b(!1),W(),Y()):(o.ZP.error(e.json.meta.message),b(!1))})).catch((()=>{b(!1)}))}else{let t={title:e.getFieldValue().title,pid:e.getFieldValue().pid&&null!=e.getFieldValue().pid&&""!=e.getFieldValue().pid?e.getFieldValue().pid:0};p.Z.post({endpoint:"/api/v2/dept/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),b(!1),W(),Y()):(o.ZP.error(e.json.meta.message),b(!1))})).catch((()=>{b(!1)}))}else b(!1)})).catch((()=>{b(!1)}))}},(0,y.t)("Confirm"))))]},(0,n.tZ)(S.Z,{form:e,labelCol:{span:8},wrapperCol:{span:16},name:"userform",preserve:!1},(0,n.tZ)(I.Z,null,(0,n.tZ)(O.Z,{span:24},(0,n.tZ)(S.Z.Item,{name:"title",label:(0,y.t)("Organization Name"),rules:[{required:!0,message:(0,y.t)("Please enter the organization name")}]},(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Please enter the organization name"),maxLength:100})),(0,n.tZ)(S.Z.Item,{name:"pid",label:(0,y.t)("Associated Parent Organization"),rules:[{required:!J,message:(0,y.t)("Please select an associated parent organization")}]},(0,n.tZ)(R.Z,{showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,y.t)("Please select an associated parent organization"),allowClear:!0,treeDefaultExpandAll:!0,onChange:t=>{e.setFieldsValue({pid:t})},treeData:s})))))),(0,n.tZ)(w.Z,{title:(0,y.t)("Delete"),width:"20%",visible:U,onCancel:()=>{z(!1),M(!1)},footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>{z(!1),M(!1)}},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:V,onClick:()=>{return e=L,M(!0),void p.Z.delete({endpoint:`/api/v2/dept/${e}/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),W(),z(!1),M(!1)):(o.ZP.error(e.json.meta.message),M(!1))}));var e}},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{marginTop:"20px"}},(0,n.tZ)("span",null,(0,y.t)("Confirm to delete?"))))))))},{Search:fe}=T.Z,_e=()=>{const[e]=S.Z.useForm(),[t,a]=(0,l.useState)(1),[s,i]=(0,l.useState)(!1),[r,d]=(0,l.useState)([]),[c,u]=(0,l.useState)((0,y.t)("Organization Management")),[m,h]=(0,l.useState)(),[Z,g]=(0,l.useState)([]),[f,_]=(0,l.useState)([]),[v,b]=(0,l.useState)(!1),[x,C]=(0,l.useState)(!1),[k,P]=(0,l.useState)(""),[R,F]=(0,l.useState)(""),[L,D]=(0,l.useState)([]),[$,U]=(0,l.useState)(""),[z,V]=(0,l.useState)(!0),[M,H]=(0,l.useState)([]),[K,B]=(0,l.useState)(""),[G,q]=(0,l.useState)(""),[Y,W]=(0,l.useState)(!1),[X,Q]=(0,l.useState)(!1),[ee,te]=(0,l.useState)(0),[ae,ne]=(0,l.useState)(1),[re,oe]=(0,l.useState)(10),de=()=>{e.resetFields(),b(!1),C(!1),F("")};function ce(){p.Z.get({endpoint:"/api/v2/dept/"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=pe(e.json.meta.data);d(t);let a=he(le()(t),[]);H(a)}else o.ZP.error(e.json.meta.message)}))}(0,l.useEffect)((()=>{ce()}),[]);const pe=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.key=e.dept_id,a.pid=e.pid,a.name=e.title,a.children=e.children?pe(e.children):[],t.push(a),!1})),t};function ue(e=1,t){m&&p.Z.get({endpoint:`/api/v2/user/?dept_id=${m}&username=${K}&page_index=${e}&page_size=${t||re}`}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?(te(t.json.meta.data.count),g(t.json.meta.data.list),ne(e)):o.ZP.error(t.json.meta.message)}))}(0,l.useEffect)((()=>{ue()}),[m]);const he=(e,t)=>{for(let a=0;a<e.length;a++){const n=e[a],{key:l,title:s}=n;t.push({key:l,title:s}),n.children&&he(n.children,t)}return t},Ze=(e,t)=>{let a;for(let n=0;n<t.length;n++){const l=t[n];l.children&&(l.children.some((t=>t.key===e))?a=l.key:Ze(e,l.children)&&(a=Ze(e,l.children)))}return a},ge=e=>e.map((e=>{const t=e.title.indexOf($),a=e.title.substr(0,t),l=e.title.substr(t+$.length),s=t>-1?(0,n.tZ)("span",null,a,(0,n.tZ)("span",{className:"site-tree-search-value"},$),l):(0,n.tZ)("span",null,e.title);return e.children?{title:s,key:e.key,children:ge(e.children)}:{title:s,key:e.key}})),fe=[{title:(0,y.t)("Name"),dataIndex:"name",key:"name",render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)("span",null,t.cn_name))},{title:(0,y.t)("Username"),dataIndex:"username",key:"username"},{title:(0,y.t)("Actions"),key:"operation",width:100,render:(e,t)=>(0,n.tZ)("span",null,(0,n.tZ)(A.Z,null,(0,n.tZ)("span",{className:"btncolor",onClick:()=>{W(!0),q(t.id)}},(0,y.t)("Delete"))))}];(0,l.useEffect)((()=>{ue()}),[K]);return(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"topbtn"},(0,n.tZ)(J.Z,{defaultActiveKey:"1",style:{width:"100%"},onChange:function(e){a(e),ce()}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("member"),key:"1"},(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"treediv"},(0,n.tZ)("div",{className:"leftdiv",style:{width:"270px"}},(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search based on keywords"),onChange:e=>{const t=e.target.value;const a=he(r,[]).map((e=>e.title.indexOf(t)>-1?Ze(e.key,r):null)).filter(((e,t,a)=>e&&a.indexOf(e)===t));D(a),U(t),V(!0)}}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{onExpand:e=>{D(e),V(!1)},expandedKeys:L,autoExpandParent:z,onSelect:(e,t)=>{if(e&&e.length>0){h(e);const t=M.find((t=>t.key==e[0]));u(t.title)}},treeData:ge(r)}))),(0,n.tZ)(ie.Z,{type:"vertical",style:{height:"calc(100vh - 212px)",marginLeft:"20px",marginRight:"20px"}}),(0,n.tZ)("div",{className:"rightdiv",style:{margin:"0",flex:"1 0 auto"}},(0,n.tZ)("div",{className:"righttop"},(0,n.tZ)("div",{className:"rightleft"},(0,n.tZ)("span",null)," ",c),(0,n.tZ)("div",{className:"rightr"},(0,n.tZ)(A.Z,null,(0,n.tZ)(T.Z,{placeholder:(0,y.t)("Search by name"),onChange:e=>{B(e.target.value)},value:K}),(0,n.tZ)(j.Z,{type:"primary",onClick:()=>{b(!0)}},(0,y.t)("Add"))))),(0,n.tZ)("div",{className:"tablediv"},(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:fe,dataSource:Z,pagination:!1,scroll:{y:"calc(100vh - 350px)"},style:{width:"100%",padding:"0"}}),(0,n.tZ)("div",{className:"paginationseat"},ee>0&&(0,n.tZ)(N.Z,{onChange:(e,t)=>{oe(t),ue(e,t)},total:ee})),(0,n.tZ)(w.Z,{onCancel:de,destroyOnClose:!0,width:"40%",title:(0,y.t)("Add Members"),visible:v,footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:de},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:x,onClick:()=>{if(C(!0),!m)return C(!1),o.ZP.error((0,y.t)("Please select an organizational structure"));if(""==R)return C(!1),o.ZP.error((0,y.t)("Please select a member"));if(R){let e={user_ids:[R]};p.Z.post({endpoint:`/api/v2/dept/${m}/users/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),C(!1),ue(),de()):(o.ZP.error(e.json.meta.message),C(!1))})).catch((()=>{C(!1)}))}else C(!1)}},(0,y.t)("Confirm"))))]},(0,n.tZ)(S.Z,{form:e,labelCol:{span:8},wrapperCol:{span:16},name:"userform",preserve:!1},(0,n.tZ)(I.Z,null,(0,n.tZ)(O.Z,{span:24},(0,n.tZ)(S.Z.Item,{name:"",label:(0,y.t)("Select Members")},(0,n.tZ)(me,{placeholder:(0,y.t)("Please select a member for selection"),style:{width:200},getvalue:function(e){F(e)},deptId:m}))))))))))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Organization"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(ye,null))))),(0,n.tZ)(w.Z,{title:(0,y.t)("Delete"),width:"20%",visible:Y,onCancel:()=>{W(!1),Q(!1)},footer:[(0,n.tZ)("div",{key:"id"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>{W(!1),Q(!1)}},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:X,onClick:()=>function(e){Q(!0);let t={user_ids:[e]};p.Z.delete({endpoint:`/api/v2/dept/${m}/users/`,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(o.ZP.success(e.json.meta.message),ue(),W(!1),Q(!1)):(o.ZP.error(e.json.meta.message),Q(!1))}))}(G)},(0,y.t)("Confirm"))))]},(0,n.tZ)("div",{style:{marginTop:"20px"}},(0,n.tZ)("span",null,(0,y.t)("Confirm to delete?")))))};var ve=a(281763),be=a.n(ve),Se=a(828216),xe=(a(470463),a(609676)),Ce=a(176720),ke=a(667496),Pe=a(731293),Ae=a(358593);const je=["dept","role","user"],Te=["datasource","dataset","dashboard","chart","menu"],Ee=[3,6,14,30],Ne={1:(0,y.t)("Explore"),2:(0,y.t)("Export"),4:(0,y.t)("Manage"),6:(0,y.t)("Row and column safety"),8:(0,y.t)("Authorize")},we=[0,1,4,8],Ie=[0,1,2,4,8],Oe=[0,1,4,6,8],Re=[0,4,8],Fe=()=>{(0,Se.v9)((e=>{var t;return null==(t=e.user)?void 0:t.isAdmin}));const[e,t]=(0,l.useState)(),[a,s]=(0,l.useState)(0),[r,d]=(0,l.useState)(),[c,u]=(0,l.useState)(""),[m,h]=(0,l.useState)(),[Z,g]=(0,l.useState)(),[f,_]=(0,l.useState)("1"),[v,b]=(0,l.useState)("1"),[S,C]=(0,l.useState)([]),[P,A]=(0,l.useState)([]),[j,w]=(0,l.useState)(""),[I,O]=(0,l.useState)(!0),[R,F]=(0,l.useState)(""),[L,D]=(0,l.useState)([]),[$,U]=(0,l.useState)([]),[z,V]=(0,l.useState)(""),[M,H]=(0,l.useState)([]),[K,B]=(0,l.useState)([]),[G,q]=(0,l.useState)([]),[Y,W]=(0,l.useState)(!1),[X,Q]=(0,l.useState)(0),[ee,te]=(0,l.useState)(1),[ae,ne]=(0,l.useState)(10);const le=e=>{let t=e.target?e.target.value:e,a=[];t?(K.map((e=>{if(e.name.indexOf(t)>-1)return a.push(e)})),H(a)):H(K),V(t)},re=(e,t)=>{const a=t||K;let n=e.target?e.target.value:e;if(V(n),n){let e=oe(a,n);H(e);const t=[],l=e=>{e.forEach((e=>{t.push(e.id),e.children&&e.children.length&&l(e.children)}))};e.length&&n&&l(e),A(t)}else A([]),H(a)},oe=(e,t)=>{let a=[];return e&&e.length>0&&e.map((e=>{const n=oe(e.children,t);return-1!==e.name.indexOf(t)?a.push(e):n&&n.length&&(e.children=n,a.push(e)),!1})),a},de=(e,t)=>{let a=[];return e.map((e=>{var n;const l=de(e.children,t);return-1!==(null==e||null==(n=e.title)?void 0:n.indexOf(t))?a.push(e):l&&l.length&&(e.children=l,a.push(e)),!1})),a};function ce(e){p.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code)if("menu"==e){let e=he(t.json.meta.data);D(e),U(e)}else{t.json.meta.data.forEach((e=>{e.pid=e.pid,e.is_dir=0,e.list=[],e.pmenu_img=(0,ke.VU)("/static/assets/images/folderM.png"),e.children.length>0&&(pe(e.children),ue(e.children,0,e.list,e.group_id)),e.datasources&&e.datasources.length>0&&ue(e.datasources,1,e.list,e.group_id),e.dashboards&&e.dashboards.length>0&&ue(e.dashboards,1,e.list,e.group_id),e.datasets&&e.datasets.length>0&&ue(e.datasets,1,e.list,e.group_id),e.slices&&e.slices.length>0&&ue(e.slices,1,e.list,e.group_id)}));let e=me(t.json.meta.data);D(e),U(e)}else o.ZP.error(t.json.meta.message)}))}(0,l.useEffect)((()=>{ce("datasource")}),[]);const pe=e=>{e.forEach((e=>{e.title=e.name,e.key=e.group_id,e.pid=e.pid,e.children.length>0&&pe(e.children)}))},ue=(e,t,a,n)=>{e&&e.length>0&&e.forEach((e=>{e.is_dir=t,e.pid=n,1==t?(e.name=e.name?e.name:e.dashboard_title?e.dashboard_title:e.dataset_name?e.dataset_name:e.slice_name?e.slice_name:"",e.group_id=e.slice_id?e.slice_id:e.datasource_id?e.datasource_id:e.dashboard_id?e.dashboard_id:e.dataset_id?e.dataset_id:"",e.slice_id=e.slice_id?e.slice_id:"",e.pmenu_img=(0,ke.VU)("/static/assets/images/fileM.png")):e.pmenu_img=(0,ke.VU)("/static/assets/images/folderM.png"),e.list=[],e.children&&(e.children.length>0&&ue(e.children,0,e.list,e.group_id),e.datasources&&e.datasources.length>0&&ue(e.datasources,1,e.list,e.group_id),e.dashboards&&e.dashboards.length>0&&ue(e.dashboards,1,e.list,e.group_id),e.datasets&&e.datasets.length>0&&ue(e.datasets,1,e.list,e.group_id),e.slices&&e.slices.length>0&&ue(e.slices,1,e.list,e.group_id)),a.push(e)}))},me=e=>{let t=[];return e&&e.length&&e.map((e=>{let a=e.slice_id?e.slice_id:"",n={};return n.title=e.name,n.is_dir=e.is_dir,n.key=a+e.name+":"+e.group_id,n.group_id=e.group_id,n.pid=e.pid,n.children=e.list?me(e.list):[],t.push(n),!1})),t},he=e=>{let t=[];return e.map((e=>{let a={title:e.label,group_id:e.id,pid:e.pid||0,key:e.id,is_dir:1,children:e.children?he(e.children):[]};return t.push(a),!1})),t},Ze=async(e,a)=>{q(e);Array.isArray(e)&&e[0];d(a.node.is_dir);let n="";n=5!=f?a.node.key.split(":")[1]:a.node.key,t(n),s(a.node.pid),u(Te[f-1]),ge(n,Te[f-1],je[v-1],1,10,z)},ge=(e,t,a,n=1,l=10,s="",i)=>{if(!e)return;h(e),g(a),te(n);let d={direction:"target",auth_source:e,auth_target_type:a};t&&"menu"!=t&&(d.auth_source_type=1==r?t:t+"_group"),"menu"==t&&(d.auth_source_type=t),"user"!==a&&(l=1e3),p.Z.post({endpoint:`/api/v2/auth/detail/?username=${"user"==a?s:""}&page_size=${l}&page_index=${n}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=ye(e.json.meta.data,a);"dept"==a&&(t=fe(t)),"user"==a&&e.json.meta.data.length>0&&Q(e.json.meta.data[0].count);const n=e=>e.map((e=>e.children&&e.children.length?{...e,children:n(e.children)}:(delete e.children,e))),l=n(t);H(l),B(t);const s=void 0!==i?i:z;s&&"1"===v&&re(s,t),s&&"2"===v&&le(s)}else o.ZP.error(e.json.meta.message)}))},ye=(e,t)=>{let a=[];switch(t){case"dept":e.forEach((e=>{let n={name:e.title,id:e.dept_id,pid:e.pid,pmenu_img:e.pmenu_img?e.pmenu_img:"",perm:e.perm,max_perm:e.max_perm||0};e.children&&(n.children=ye(e.children,t)),a.push(n)}));break;case"role":e.forEach((e=>{a.push({name:e.name,id:e.id,perm:e.perm,max_perm:e.max_perm||0})}));break;case"user":e.forEach((e=>{a.push({name:e.cn_name,id:e.id,perm:e.perm,max_perm:e.max_perm||0})}))}return a},fe=e=>(e.map((e=>{if(e.children){const t=[0,0,0,0,0],a=e.children.length;e.children.map((e=>{e.perm>0&&(t[0]++,e.perm>=2&&t[1]++,e.perm>=4&&t[2]++,e.perm>=6&&t[3]++,e.perm>=8&&t[4]++)})),e.indeterminate1=e.perm>0&&t[0]<a,e.indeterminate2=e.perm>=2&&t[1]<a,e.indeterminate4=e.perm>=4&&t[2]<a,e.indeterminate6=e.perm>=6&&t[3]<a,e.indeterminate8=e.perm>=8&&t[4]<a,fe(e.children)}return!1})),e),_e=(e,t,a,n,l)=>{let s=a;if(!t){if("menu"==e)if(Ee.includes(n)||Ee.includes(l)){const e=Re.indexOf(a);s=-1!==e?Re[e-1]:0}else{const e=we.indexOf(a);s=-1!==e?we[e-1]:0}if("datasource"==e){const e=we.indexOf(a);s=-1!==e?we[e-1]:0}if("dataset"==e){const e=Oe.indexOf(a);s=-1!==e?Oe[e-1]:0}if("dashboard"==e||"chart"==e){const e=Ie.indexOf(a);s=-1!==e?Ie[e-1]:0}}return s.toString()},ve=(e,t,a)=>(0,n.tZ)("div",null,(0,n.tZ)("p",null,(0,y.t)("Inherit permissions from organizations or roles")),(0,n.tZ)("p",null,(0,y.t)("Individual authorization"),":"," ",(0,n.tZ)(x.Z,{size:"small",onClick:()=>Ce(e,t,a,!0)}))),be=(e,t,a,l,s)=>(0,n.tZ)(xe.Z,{indeterminate:a[`indeterminate${t}`],checked:l>=t,onChange:n=>Ce(e,t,a,n.target.checked),disabled:s});function Ce(t,n,l,s){if(!e)return o.ZP.error((0,y.t)("Please select a resource configuration item"));W(!0);const{is_dir:i,perm:d}=l;let u={perm:[{auth_source_type:1==r?c:c+"_group",auth_source:e,auth_target:l.id,auth_target_type:t,privilege_value:_e(c,s,n,e,a)}]},m=[];"dept"==t&&(m=((e,t)=>{let a=[],n=((e,t)=>{let a={},n=[],l=e=>{for(let t=0;t<e.length;t++){let n=e[t];a[n.pid]?a[n.pid].push({id:n.id,perm:n.perm}):a[n.pid]=[{id:n.id,perm:n.perm}],n.children&&(n.children=l(n.children))}};return l(e),(e=>{const t=a[e];for(let e in t)n.push({id:t[e].id})})(t),n})(e,t);return n&&n.length>0&&n.map((e=>{a.push({id:e.id})})),a})(M,l.id)),m&&m.length>0&&m.map((a=>{u.perm.push({auth_source_type:1==r?c:c+"_group",auth_source:e,auth_target:a.id,auth_target_type:t,privilege_value:u.perm[0].privilege_value})})),p.Z.post({endpoint:"/api/v2/auth/change/",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then((a=>{if(200==a.json.meta.code||201==a.json.meta.code){W(!1);let a={auth_source:e,auth_source_type:c};ge(a.auth_source,a.auth_source_type,t)}else W(!1),o.ZP.error(a.json.meta.message)})).catch((()=>{W(!1)}))}function Fe(t,l,s){const i=[];"datasource"==c&&i.push(...we),"dataset"==c&&i.push(...Oe),"dashboard"!=c&&"chart"!=c||i.push(...Ie),"menu"==c&&i.push(...we);const r=[{title:(0,y.t)(t),width:"60%",render:(e,t)=>{return(0,n.tZ)("span",null,(0,n.tZ)("span",null," ",(a=t.name)?a.split(s).map(((e,t)=>0===t?(0,n.tZ)("span",{key:`${a}${t}`},e):(0,n.tZ)("span",{key:`${a}${t}`},(0,n.tZ)("span",{style:{color:"#f50"}},s),e))):a));var a}}];return i.forEach((t=>{t&&r.push({title:(0,y.t)(Ne[t]),render:(s,i)=>(0,n.tZ)("span",null,"menu"==c&&1==t&&(Ee.includes(e)||Ee.includes(a))?(0,n.tZ)(Ae.u,{title:(0,y.t)("This directory cannot be individually controlled for viewing permissions")},be(l,t,i,i.perm||i.max_perm,!0)):3==v&&t>i.perm&&i.max_perm>=t?(0,n.tZ)(k.Z,{content:ve(l,t,i)},be(l,t,i,i.max_perm,!0)):(0,n.tZ)("span",null,be(l,t,i,i.perm,!1)))})})),r}const Le=e=>{const t=e.target.value;F(t);let a=de($,t);const n=[],l=e=>{e&&e.length&&e.forEach((e=>{n.push(e.key),e.children&&e.children.length&&l(e.children)}))};a.length&&t&&l(a),D(a),C(n),w(t),O(!0)},De=e=>{C(e),O(!1)},$e=e=>e.map((e=>{if(e){const t=e.title.indexOf(j),a=e.title.substr(0,t),l=e.title.substr(t+j.length),s=t>-1?(0,n.tZ)("span",null,5!=f?(0,n.tZ)("span",null,1==e.is_dir?(0,n.tZ)(Pe.Z.FileM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}}):(0,n.tZ)(Pe.Z.FolderM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}})):null,a,(0,n.tZ)("span",{className:"site-tree-search-value"},j),l):(0,n.tZ)("span",null,5!=f?(0,n.tZ)("span",null,1==e.is_dir?(0,n.tZ)(Pe.Z.FileM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}}):(0,n.tZ)(Pe.Z.FolderM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}})):null,e.title);return e.children?{title:s,show:t>-1,key:e.key,group_id:e.id,pid:e.pid||0,is_dir:e.is_dir,children:$e(e.children)}:{title:s,show:t>-1,key:e.key,group_id:e.id,pid:e.pid||0,icon:e.icon,is_dir:e.is_dir}}return[]}))||[],Ue=e=>{const t=[];return e.map((e=>{e.show?t.push(e):e.children&&(e.children=Ue(e.children),e.children.length&&t.push(e))})),t};return(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"contentdiv"},(0,n.tZ)("div",{className:"treediv"},(0,n.tZ)(i.e,{defaultSize:{width:290},enable:{top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}},(0,n.tZ)("div",{className:"leftdiv",style:{width:"calc(100% - 20px)",marginRight:"20px"}},(0,n.tZ)(J.Z,{defaultActiveKey:"1",onChange:function(e){w(""),_(e),t(""),s(0),ce(Te[e-1]),F("")}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Datasource"),key:"1"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by datasource name"),onChange:e=>Le(e),value:R}),(0,n.tZ)("div",{style:{marginTop:"20px"}},null),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{showIcon:!0,onExpand:De,expandedKeys:S,autoExpandParent:I,onSelect:Ze,treeData:Ue($e(L)),selectedKeys:G})))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Dataset"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by dataset name"),onChange:e=>Le(e),value:R}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{showIcon:!0,onExpand:De,expandedKeys:S,autoExpandParent:I,onSelect:Ze,treeData:Ue($e(L))})))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Dashboard"),key:"3"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by dashboard name"),onChange:e=>Le(e),value:R}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{showIcon:!0,onExpand:De,expandedKeys:S,autoExpandParent:I,onSelect:Ze,treeData:Ue($e(L))})))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Chart"),key:"4"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by chart name"),onChange:e=>Le(e),value:R}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{showIcon:!0,onExpand:De,expandedKeys:S,autoExpandParent:I,onSelect:Ze,treeData:Ue($e(L))})))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Menu and Operations"),key:"5"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by Menu and Operations name"),onChange:e=>Le(e),value:R}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{showIcon:!0,onExpand:De,expandedKeys:S,autoExpandParent:I,onSelect:Ze,treeData:Ue($e(L))}))))))),(0,n.tZ)(ie.Z,{type:"vertical",style:{height:"calc(100vh - 240px)",marginLeft:"0",marginRight:"20px",marginTop:"56px"}}),(0,n.tZ)("div",{className:"rightdiv",style:{margin:"0",flex:"1 0 auto"}},(0,n.tZ)("div",{className:"righttop"},(0,n.tZ)(J.Z,{defaultActiveKey:"1",style:{width:"100%"},onChange:function(t){v!==t&&(b(t),V(""),H([]),B([]),ge(e,Te[f-1],je[t-1],1,ae,"",""))}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Organization"),key:"1"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by organization name"),value:z,onChange:re}),(0,n.tZ)(E.Z,{expandedRowKeys:P,onExpandedRowsChange:e=>{A(e)},rowKey:e=>e.id,columns:Fe(`${(0,y.t)("All")}${(0,y.t)("Organization")}`,"dept",z),dataSource:M,pagination:!1,loading:Y,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Role"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by role name"),value:z,onChange:le}),(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:Fe(`${(0,y.t)("All")}${(0,y.t)("Roles")}`,"role",z),dataSource:M,pagination:!1,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("User"),key:"3"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by username"),value:z,onChange:e=>{let t=e.target?e.target.value:e;V(t),ge(m,c,Z,ee,ae,t)}}),(0,n.tZ)(E.Z,{rowKey:e=>e.id,columns:Fe(`${(0,y.t)("All")}${(0,y.t)("User")}`,"user",z),dataSource:M,pagination:!1,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}),(0,n.tZ)("div",{className:"paginationseat"},X>0&&(0,n.tZ)(N.Z,{onChange:(e,t)=>{ne(t),ge(m,c,Z,e,t)},total:X,current:ee,pageSize:ae}))))))))))},Le=["dept","role","user"],De=["datasource","dataset","dashboard","chart","menu","database sync","databases"],$e=[3,6,14,30],Ue={1:(0,y.t)("Explore"),2:(0,y.t)("Export"),4:(0,y.t)("Manage"),6:(0,y.t)("Row and column safety"),8:(0,y.t)("Authorize")},ze=[0,1,4,8],Ve=[0,1,2,4,8],Me=[0,1,4,6,8],He=[0,4,8],Ke=[0,1,8];let Be=null,Ge=null,Je=0,qe={};const Ye=()=>{const e=(0,l.useRef)(null),t=(0,l.useRef)(null);let a=!0;const[s,r]=(0,l.useState)(1),[d,c]=(0,l.useState)(1),[u,m]=(0,l.useState)([]),[h,Z]=(0,l.useState)([]),[g,_]=(0,l.useState)((0,y.t)("Scroll down to load more")),[v,b]=(0,l.useState)(),[S,C]=(0,l.useState)(1),[P,N]=(0,l.useState)(1),[w,I]=(0,l.useState)([]),[O,R]=(0,l.useState)([]),[F,L]=(0,l.useState)(""),[D,$]=(0,l.useState)(!0),[U,z]=(0,l.useState)([]),[V,M]=(0,l.useState)([]),[H,K]=(0,l.useState)(""),[B,G]=(0,l.useState)([]),[q,Y]=(0,l.useState)([]),[W,X]=(0,l.useState)(""),[Q,ee]=(0,l.useState)(!1),[te,ae]=(0,l.useState)(0);let ne=0;function re(e){c(e),1!=e&&b("")}(0,l.useEffect)((()=>{me("dept")}),[]),(0,l.useEffect)((()=>{if(te&&B[Ge].children.length==te){const e=le()(q);e[Ge].children.map((e=>{e.children=qe[e.group_id]})),Y(e),G(e)}}),[te]),(0,l.useEffect)((()=>{if(3==Je&&null!=Ge&&B[Ge].children){const e=B[Ge].children;null==e||e.map(((e,t)=>{fe(e,t)}))}(4==Je&&null!=Ge&&B[Ge].children.length==te||2==Je&&Be)&&(Ye(Be.auth_source_type,Be.checkbox_value,Be.record,Be.checkbox,Be.checkbox_index),Be=null,Ge=null,Je=0,qe={},ae(0))}),[B]);const oe=(e,t)=>{const a=le()(t||q);let n=e.target?e.target.value:e;if(X(n),n){let e=de(a,n);const t=[],l=e=>{e.forEach((e=>{t.push(e.key),e.children&&e.children.length&&l(e.children)}))};e.length&&l(e),R(t),G(e)}else R([]),G(a)},de=(e=[],t)=>{let a=[];return e.map((e=>{const n=de(e.children,t);return-1!==e.name.indexOf(t)?a.push(e):n&&n.length&&(e.children=n,a.push(e)),!1})),a},ce=(e,t)=>{let a=[];return e.map((e=>{var n;const l=ce(e.children,t);return-1!==(null==e||null==(n=e.title)?void 0:n.indexOf(t))?a.push(e):l&&l.length&&(e.children=l,a.push(e)),!1})),a};function pe(e,t=25,n=1,l=""){p.Z.get({endpoint:`/api/v2/${e}?name=${l}&page_index=${n}&page_size=${t}`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){const t=1==n?[]:[...U];e.json.meta.data.list.length>0?(t.push(...e.json.meta.data.list),z(t),_((0,y.t)("Scroll down to load more")),r(n)):(z(t),_((0,y.t)("There is no more data")))}else o.ZP.error(e.json.meta.message);a=!0}))}function ue(e,t=25,n=1,l=""){p.Z.get({endpoint:`/api/v2/${e}?username=${l}&page_index=${n}&page_size=${t}`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){const t=1==n?[]:[...V];e.json.meta.data.list.length>0?(t.push(...e.json.meta.data.list),M(t),_("\u4e0b\u6eda\u52a8\u52a0\u8f7d\u66f4\u591a\uff01"),r(n)):(M(t),_("\u6ca1\u6709\u66f4\u591a\u6570\u636e\u4e86\uff01"))}else o.ZP.error(e.json.meta.message);a=!0}))}function me(e){p.Z.get({endpoint:`/api/v2/auth/${e}/`}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){let t=he(e.json.meta.data);m(t),Z(t)}else o.ZP.error(e.json.meta.message)}))}const he=e=>{let t=[];return e.map((e=>{const a={};return a.title=e.title,a.key=e.dept_id,a.pid=e.pid,a.children=e.children?he(e.children):[],t.push(a),!1})),t},Ze=async(e,t)=>{const a=Array.isArray(e)?e[0]:e;b(a),ge(a,Le[S-1],De[P-1])},ge=(e,t,a,n)=>{if(!e)return;const l=n&&7==n||!n&&7==P;ee(!0);let s={direction:"source",auth_target:e,auth_target_type:t};a&&(s.auth_source_type=l?"datasource":a),p.Z.post({endpoint:"/api/v2/auth/detail/",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code)if("menu"==a){let e=Ee(t.json.meta.data),a=Te(e);G(a),Y(a),W&&oe(W,a)}else{t.json.meta.data.forEach((e=>{e.is_dir=0,e.list=[],e.pmenu_img=(0,ke.VU)("/static/assets/images/folderM.png"),e.children.length>0&&(ve(e.children),Se(e.children,0,e.list,e.group_id)),e.datasources&&e.datasources.length>0&&Se(e.datasources,1,e.list,e.group_id),e.dashboards&&e.dashboards.length>0&&Se(e.dashboards,1,e.list,e.group_id),e.datasets&&e.datasets.length>0&&Se(e.datasets,1,e.list,e.group_id),e.slices&&e.slices.length>0&&Se(e.slices,1,e.list,e.group_id),e.database_sync&&e.database_sync.length>0&&Se(e.database_sync,1,e.list,e.group_id)}));let a=je(t.json.meta.data);Te(a);if(l)return void ye(e,a);G(a),Y(a),W&&oe(W,a)}else o.ZP.error(t.json.meta.message);ee(!1)}))},ye=(e,t)=>{e&&(ee(!0),p.Z.get({endpoint:"/api/v2/datasource/database/list/"}).then((({json:e})=>{const a=e.meta.data.map((e=>({is_dir:0,pmenu_img:(0,ke.VU)("/static/assets/images/databases-icon.png"),name:e.database_name,key:e.database_name+e.id,datasource_id:e.datasource_id,group_id:e.id,pid:0,perm:0,max_perm:0,dataType:"db"}))),n=_e(a,t);G(n),Y(n),W&&oe(W,n),ee(!1)})))},fe=({group_id:e,key:t,database_id:a,datasource_id:n,dataType:l,checkbox:s,perm:i,max_perm:r},d,c)=>{if(!e)return;let u=d;const m="db"==l;m&&q.some(((t,a)=>(t.group_id===e&&(u=a),!1)));let h={auth_target:v,auth_target_type:Le[S-1],auth_source_type:m?"db_schema":"db_schema_table"};const Z="/api/v2/auth/database/"+(m?`${e}/schema/`:`${a}/schema/${e}/tables`);ee(!0),p.Z.post({endpoint:Z,headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then((({json:l})=>{const o=l.meta.data.map((t=>({is_dir:m?0:1,pmenu_img:(0,ke.VU)(m?"/static/assets/images/schema-icon.png":"/static/assets/images/datatable-icon.png"),name:m?t.schema:t.table_name,key:`${t.database_id}_${t.schema}${m?"":"_"+t.table_name}`,group_id:m?t.schema:t.table_name,schema:m?t.schema:e,perm:m||i<t.perm||i<4?t.perm:4==i?1:i,max_perm:m||r<t.max_perm||r<4?t.max_perm:4==r?1:r,database_id:m?e:a,datasource_id:n,dataType:m?"db_schema":"db_schema_table",indeterminate1:m&&1==t.perm,indeterminate8:m&&6==t.perm,disabledPerm:m&&t.current_user_perm<8})));if(Be&&"db"==Be.record.dataType){if(!m)return Je=4,ae((e=>e+1)),void(qe[e]=o);Je=s?0:3,Ge=u,o.map((e=>{qe[e.group_id]=[]}))}const d=JSON.parse(JSON.stringify(q));if(m)d[u].children=o;else{for(let e=0;e<d.length;e++){const t=d[e];if(t.group_id==a){t.children[u].children=o;break}}Je=2}if(Y(d),W?oe(W,d):G(d),c){const e=JSON.parse(JSON.stringify(O));e.push(t),R(e)}ee(!1)})).catch((({status:e,statusText:t})=>{ee(!1),o.ZP.error(`Code: ${e}, ${t}`)}))},_e=(e,t)=>{const a=Ne(t);return e.map((e=>{a.map((t=>{e.group_id===t.database_id&&(e.perm=Math.max(e.perm,t.perm))}))})),e},ve=e=>{e.forEach((e=>{e.title=e.name,e.key=e.group_id,e.pid=e.pid,e.children.length>0&&ve(e.children)}))},Se=(e,t,a,n)=>{e&&e.length>0&&e.forEach((e=>{e.is_dir=t,1==t?(e.pid=n,e.name=e.name||e.dashboard_title||e.dataset_name||e.slice_name,e.group_id=e.slice_id||e.datasource_id||e.dashboard_id||e.dataset_id||e.database_id,e.database_id&&(e.database_id=e.database_id),e.pmenu_img=(0,ke.VU)("/static/assets/images/fileM.png")):e.pmenu_img=(0,ke.VU)("/static/assets/images/folderM.png"),e.list=[],e.children&&(e.children.length>0&&Se(e.children,0,e.list,e.group_id),e.datasources&&e.datasources.length>0&&Se(e.datasources,1,e.list,e.group_id),e.dashboards&&e.dashboards.length>0&&Se(e.dashboards,1,e.list,e.group_id),e.datasets&&e.datasets.length>0&&Se(e.datasets,1,e.list,e.group_id),e.slices&&e.slices.length>0&&Se(e.slices,1,e.list,e.group_id),e.database_sync&&e.database_sync.length>0&&Se(e.database_sync,1,e.list,e.group_id)),a.push(e)}))},je=e=>{let t=[];return e.map((e=>{let a={name:e.name,key:e.name+e.group_id,group_id:e.group_id,is_dir:e.is_dir,pid:e.pid,pmenu_img:e.pmenu_img?e.pmenu_img:"",perm:e.perm,max_perm:e.max_perm};return e.database_id&&(a.database_id=e.database_id),e.list&&(a.children=je(e.list)),t.push(a),!1})),t},Te=e=>(e.map((e=>{if(e.children){const t=[0,0,0,0,0],a=e.children.length;e.children.map((e=>{e.perm>0&&(t[0]++,e.perm>=2&&t[1]++,e.perm>=4&&t[2]++,e.perm>=6&&t[3]++,e.perm>=8&&t[4]++)})),e.indeterminate1=e.perm>0&&t[0]<a,e.indeterminate2=e.perm>=2&&t[1]<a,e.indeterminate4=e.perm>=4&&t[2]<a,e.indeterminate6=e.perm>=6&&t[3]<a,e.indeterminate8=e.perm>=8&&t[4]<a,Te(e.children)}return!1})),e),Ee=e=>{let t=[];return e.map((e=>{let a={name:e.label,group_id:e.id,is_dir:e.children&&e.children.length>0?0:1,pmenu_img:e.pmenu_img?e.pmenu_img:"",children:e.children?Ee(e.children):[],perm:e.perm,max_perm:e.max_perm,pid:e.pid};return t.push(a),!1})),t},Ne=e=>{let t=[],a=function(e){for(let n=0;n<e.length;n++){const l=e[n];1==l.is_dir&&t.push({id:l.group_id,database_id:l.database_id,perm:Math.max(l.perm,l.max_perm)}),l.children&&l.children.length>0&&a(l.children)}};return a(e),t},we=(e,t)=>{const a=[];let n=null;return function e(t,a){for(let l=0;l<t.length;l++){const s=t[l];if(s.group_id==a?n=s.children||[]:s.children&&s.children.length>0&&e(s.children,a),n)return}}(e,t),n&&function e(t){t.map((t=>{t.group_id&&a.push({id:t.group_id,is_dir:t.is_dir,perm:t.perm,schema:t.schema,dataType:t.dataType}),t.children&&t.children.length>0&&e(t.children)}))}(n),a},Ie=(e,t,a,n,l,s,i)=>{let r=[],o=t?((e,t)=>{let a={},n=[],l=e=>{for(let t=0;t<e.length;t++){let n=e[t];a[n.group_id]={pid:n.pid,perm:n.perm,is_dir:n.is_dir,schema:n.schema,dataType:n.dataType},n.children&&l(n.children)}};l(e);let s=e=>{if(0==e)return;const t=a[e];t&&(n.push({pid:e,is_dir:t.is_dir,perm:t.perm,schema:t.schema,dataType:t.dataType}),s(t.pid))};return s(t),n})(e,t):[];return s&&o.map((t=>{(l&&(i&&t.perm<1||!i&&t.perm<n||3==s&&t.perm<6)||2==s&&!((e,t,a,n)=>{let l=!1;return(t?we(e,t):[]).forEach((e=>{e.id!==a&&e.perm>=n&&(l=!0)})),l})(e,t.pid,a,n)||4==s&&t.perm>=n)&&r.push({id:t.pid,is_dir:t.is_dir,perm:t.perm,schema:t.schema,dataType:t.dataType,isMainModules:i})})),we(e,a).map((e=>{(l&&e.perm<n||!l&&e.perm>=n)&&r.push(e)})),r},Oe=(e,t,a)=>(0,n.tZ)("div",null,"databases"!=e||"db"!=a.dataType&&!a.disabledPerm?(0,n.tZ)("div",null,(0,n.tZ)("p",null,(0,y.t)("Inherit permissions from organizations or roles")),(0,n.tZ)("p",null,(0,y.t)("Individual authorization"),":"," ",(0,n.tZ)(x.Z,{size:"small",onClick:()=>Ye(e,t,a,!0)}))):(0,n.tZ)("div",{style:{width:"200px"}},"db"==a.dataType&&(0,n.tZ)("div",null,(0,n.tZ)("p",null,(0,y.t)("Database permissions cannot be changed. Please choose the following actions"),"\uff1a"),(0,n.tZ)("p",null,(0,y.t)("Schame and table permissions"),"\uff1a")),a.disabledPerm&&(0,n.tZ)("p",null,(0,y.t)("The schema is not authorized and can be operated as follows:")),(0,n.tZ)("p",null,(0,n.tZ)(j.Z,{type:"primary",size:"small",onClick:()=>Ye(e,t,a,!0),style:{marginRight:"10px"}},(0,y.t)("Select all items")),(0,n.tZ)(j.Z,{size:"small",onClick:()=>Ye(e,t,a,!1)},(0,y.t)("Cancel All"))))),Re=(e,t,a,l,s,i)=>(0,n.tZ)(xe.Z,{indeterminate:a[`indeterminate${t}`],checked:l>=t,onChange:n=>Ye(e,t,a,n.target.checked,i),disabled:s}),Ye=(e,t,a,n,l)=>{if(!v)return o.ZP.error((0,y.t)("Please select an organization, role, or user"));ee(!0);const s="databases"==e,i="menu"==e,r=["datasource","dataset","dashboard","chart","databases"].includes(e),{is_dir:d,pid:c,group_id:m,schema:h,dataType:Z,database_id:g,datasource_id:f,perm:_,disabledPerm:b}=a,x="db_schema"==Z;if(s&&"db_schema_table"!==Z&&!a.children&&!Be)return Be={auth_source_type:e,checkbox_value:t,record:a,checkbox:n,checkbox_index:l},void fe(a,l,!x);i&&0==d&&a[`indeterminate${t}`]&&(n=!0),x&&a.indeterminate8&&(n=!1);const C=[],k=((e,t,a,n,l)=>{let s=a;if(!t){if("menu"==e)if($e.includes(n)||$e.includes(l)){const e=He.indexOf(a);s=-1!==e?He[e-1]:0}else{const e=ze.indexOf(a);s=-1!==e?ze[e-1]:0}if("datasource"==e||"database sync"==e){const e=ze.indexOf(a);s=-1!==e?ze[e-1]:0}if("dataset"==e){const e=Me.indexOf(a);s=-1!==e?Me[e-1]:0}if("dashboard"==e||"chart"==e){const e=Ve.indexOf(a);s=-1!==e?Ve[e-1]:0}if("databases"==e){const e=Ke.indexOf(a);s=-1!==e?Ve[e-1]:0}}return s})(e,n,t,m,c);"db"!==Z&&!b&&C.push({id:m,is_dir:d,schema:h,dataType:Z,perm:x&&1==k?4:k});let P=1;i&&(P=2),"db_schema_table"===Z&&(P=n?3:4);Ie(B,P>=3?h:c,m,t,n,P,r).map((e=>{"db"!==e.dataType&&be()(e.perm||NaN)&&("db_schema_table"==Z&&"db_schema"==e.dataType?(8!=t||4!=e.perm&&8!=e.perm||(e.perm=6,C.push(e)),1==t&&1!=e.perm&&(e.perm=1,C.push(e))):(!n||"db_schema_table"!=Z||"db_schema"!=e.dataType||e.perm<=k)&&(e.perm=e.isMainModules?1:k,C.push(e)))}));const A=[],j=[v];1==S&&j.push(...(e=>{const t=[];let a=null;return function e(t,n){t.map((t=>{t.key==n?a=t.children||[]:t.children&&t.children.length>0&&e(t.children,n)}))}(u,e),a&&function e(a){a.map((a=>{a.key&&t.push(a.key),a.children&&a.children.length>0&&e(a.children)}))}(a),t})(v)),j.map((t=>{C.map((a=>{const n={auth_source_type:1==a.is_dir||i?e:e+"_group",auth_target:t,auth_target_type:Le[S-1],privilege_value:a.perm};s?(n.auth_source_type=a.dataType,n.database_id="db"==Z?m:g,n.datasource_id=f,n.schema=a.schema||a.id,"db_schema_table"==a.dataType&&(n.table_name=a.id)):n.auth_source=a.id,A.push(n)}))})),p.Z.post({endpoint:"/api/v2/auth/change/"+("databases"==e?"database/":""),headers:{"Content-Type":"application/json"},body:JSON.stringify({perm:A})}).then((({json:t})=>{200==t.meta.code||201==t.meta.code?(We(C,s,v,e,t.meta.data),ee(!1)):(ee(!1),o.ZP.error(t.meta.message))})).catch((()=>{ee(!1)})),Be=null},We=(e,t,a,n,l)=>{if(!t){let e={auth_target:a||"",auth_target_type:Le[S-1]};return void ge(e.auth_target,e.auth_target_type,n)}const s=JSON.parse(JSON.stringify(q));function i(e,t){e.map((e=>{e.group_id==t.id?(e.perm=t.perm,e.indeterminate1="db_schema"==t.dataType&&1==t.perm,e.indeterminate8="db_schema"==t.dataType&&6==t.perm,e.max_perm=(null==l?void 0:l[`${t.database_id}_${t.schema}${"db_schema"==t.dataType?"":"_"+t.id}`])||0):e.children&&e.children.length>0&&i(e.children,t)}))}e.map((e=>{i(s,e)}));let r=s;t||(r=Te(s)),G(r),Y(r),W&&oe(W,r)},Xe=(e,t,a,l)=>{const s=[{title:(0,y.t)(e),width:"60%",render:(e,t,s)=>{return(0,n.tZ)("span",null,"databases"!=a||0!=t.is_dir||t.children?t.children&&t.children.length?"":(0,n.tZ)("span",{style:{marginRight:"24px"}}):(0,n.tZ)(Pe.Z.RightOutlined,{iconColor:"rgb(153, 153, 153)",style:{fontSize:"14px",verticalAlign:"middle",marginRight:"10px"},onClick:()=>{fe(t,s,!0)}}),("menu"==a||"databases"==a)&&(t.pmenu_img?(0,n.tZ)("img",{style:{width:"15px"},src:t.pmenu_img,alt:""}):""),"menu"!==a&&"databases"!==a&&(0==t.is_dir?(0,n.tZ)(Pe.Z.FolderM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}}):(0,n.tZ)(Pe.Z.FileM,{iconColor:"#faba62",style:{fontSize:"16px",verticalAlign:"middle"}})),(0,n.tZ)("span",null," ",(i=t.name)?i.split(l).map(((e,t)=>0===t?(0,n.tZ)("span",{key:`${i}${t}`},e):(0,n.tZ)("span",{key:`${i}${t}`},(0,n.tZ)("span",{style:{color:"#f50"}},l),e))):i));var i}}];return t.forEach((e=>{e&&s.push({title:(0,y.t)(Ue[e]),render:(t,l,s)=>(0,n.tZ)("span",null,"menu"==a&&1==e&&($e.includes(l.group_id)||$e.includes(l.pid))?(0,n.tZ)(Ae.u,{title:(0,y.t)("This directory cannot be individually controlled for viewing permissions")},Re(a,e,l,l.perm||l.max_perm,!0)):"db"==l.dataType||l.disabledPerm?(0,n.tZ)(k.Z,{content:Oe(a,e,l)},Re(l.dataType,e,l,l.perm,!0)):3==S&&e>l.perm&&l.max_perm>=e?(0,n.tZ)(k.Z,{content:Oe(a,e,l)},Re(a,e,l,l.max_perm,!0)):(0,n.tZ)("span",null,Re(a,e,l,l.perm,!1,s)))})})),s},Qe=e=>e.map((e=>{const t=e.title.indexOf(F),a=e.title.substr(0,t),l=e.title.substr(t+F.length),s=t>-1?(0,n.tZ)("span",null,a,(0,n.tZ)("span",{className:"site-tree-search-value"},F),l):(0,n.tZ)("span",null,e.title);return e.children?{title:s,key:e.key,children:Qe(e.children)}:{title:s,key:e.key}})),et=e=>{R(e)},tt=(e,t)=>{if(!e)return e;return e.split(t).map(((a,l)=>0===l?(0,n.tZ)("span",{key:`${e}${l}`},a):(0,n.tZ)("span",{key:`${e}${l}`},(0,n.tZ)("span",{style:{color:"#f50"}},t),a)))};return(0,n.tZ)("div",null,(0,n.tZ)("div",{className:"topbtn"},(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{type:1==d?"primary":"default",onClick:()=>re(1)},(0,y.t)("Configure permissions by user")),(0,n.tZ)(j.Z,{type:2==d?"primary":"default",onClick:()=>re(2)},(0,y.t)("Configure permissions by resource")))),(0,n.tZ)("div",{className:"contentdiv"},1==d?(0,n.tZ)("div",{className:"treediv"},(0,n.tZ)(i.e,{defaultSize:{width:290},enable:{right:!0}},(0,n.tZ)("div",{className:"leftdiv",style:{width:"calc(100% - 20px)",marginRight:"20px"}},(0,n.tZ)(J.Z,{defaultActiveKey:"1",onChange:function(e){e!==S&&(C(e),K(""),b(""),1==e&&me("dept"),2==e&&pe("role"),3==e&&ue("user"))}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Organization"),key:"1"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by organization name"),onChange:e=>{const t=e.target.value;K(t);let a=ce(u,t);const n=[],l=e=>{e&&e.length&&e.forEach((e=>{n.push(e.key),e.children&&e.children.length&&l(e.children)}))};a.length&&t&&l(a),Z(a),I(n),L(t),$(!0)},value:H}),(0,n.tZ)("div",{style:{marginTop:"20px"}}),(0,n.tZ)("div",{className:"treescroll"},(0,n.tZ)(se.Z,{onExpand:e=>{I(e),$(!1)},expandedKeys:w,autoExpandParent:D,onSelect:Ze,treeData:Qe(h),selectedKeys:v?[v]:[]})))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Role"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by role name"),onChange:e=>{let t=e.target.value;K(t),pe("role",25,1,t),ne=0},value:H}),(0,n.tZ)("div",{className:"userbox",ref:e,onScroll:()=>{const{scrollTop:t,clientHeight:n,scrollHeight:l}=e.current;if(t-ne>0){if(t+n>l-2&&a){a=!1,_("\u52a0\u8f7d\u4e2d..."),pe("role",25,s+1,H)}}ne=t}},U.map((e=>(0,n.tZ)("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:v==e.id?"rolecssSlect":"rolecss",onClick:()=>Ze(e.id),key:e.id},(0,n.tZ)(Ae.u,{id:"allow-run-async-header-tooltip",title:e.name,placement:"top"},tt(e.name,H))))),(0,n.tZ)("p",{style:{padding:"5px",textAlign:"center",color:"#ccc"}},g)))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Username"),key:"3"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by username"),onChange:e=>{let t=e.target.value;K(t),ue("user",25,1,t),ne=0},value:H}),(0,n.tZ)("div",{className:"userbox",ref:t,onScroll:()=>{const{scrollTop:e,clientHeight:n,scrollHeight:l}=t.current;if(e-ne>0){if(e+n>l-2&&a){a=!1,_("\u52a0\u8f7d\u4e2d..."),ue("user",25,s+1,H)}}ne=e}},V.map((e=>(0,n.tZ)("div",{className:v==e.id?"usercssSlect":"usercss",onClick:()=>Ze(e.id),key:e.id,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},(0,n.tZ)(Ae.u,{id:"allow-run-async-header-tooltip",title:e.cn_name,placement:"top"},tt(e.cn_name,H))))),(0,n.tZ)("p",{style:{padding:"5px",textAlign:"center",color:"#ccc"}},g))))))),(0,n.tZ)(ie.Z,{type:"vertical",style:{height:"calc(100vh - 240px)",marginLeft:"0",marginRight:"20px",marginTop:"56px"}}),(0,n.tZ)("div",{className:"rightdiv",style:{margin:"0",flex:"1 0 auto"}},(0,n.tZ)("div",{className:"righttop"},(0,n.tZ)(J.Z,{style:{width:"100%"},defaultActiveKey:"1",onChange:function(e){P!==e&&(N(e),X(""),G([]),R([]),ge(v,Le[S-1],De[e-1],e))}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Datasource"),key:"1"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by datasource name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Datasource")}`,ze,"datasource",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Datasets"),key:"2"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by dataset name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Datasets")}`,Me,"dataset",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Dashboards"),key:"3"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by dashboard name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Dashboards")}`,Ve,"dashboard",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Charts"),key:"4"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by chart name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Charts")}`,Ve,"chart",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Menu and Operations"),key:"5"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by Menu and Operations name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if((null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if((null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.group_id,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Menu and Operations")}`,ze,"menu",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Database Sync"),key:"6"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by database sync name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Database Sync")}`,ze,"database sync",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Databases"),key:"7"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{style:{marginBottom:8},placeholder:(0,y.t)("Search by Databases or table name"),onChange:oe,value:W}),(0,n.tZ)(E.Z,{expandedRowKeys:O,onExpandedRowsChange:et,expandIcon:({expanded:e,onExpand:t,record:a})=>{var l,s;if(e){if(0==a.is_dir&&(null==a||null==(l=a.children)?void 0:l.length)>0)return(0,n.tZ)(Ce.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})}else if(0==a.is_dir&&(null==a||null==(s=a.children)?void 0:s.length)>0)return(0,n.tZ)(f.default,{style:{marginRight:"10px",fontSize:"14px",color:"#999",paddingTop:"3px"},onClick:e=>t(a,e)})},rowKey:e=>e.key,columns:Xe(`${(0,y.t)("All")}${(0,y.t)("Databases")}`,Ke,"databases",W),dataSource:B,pagination:!1,loading:Q,scroll:{y:"calc(100vh - 400px)"},style:{width:"100%",padding:"0"}}))))))):(0,n.tZ)("div",null,(0,n.tZ)(Fe,null))))};var We=a(495470);const Xe=()=>{const[e]=S.Z.useForm(),[t]=S.Z.useForm(),[a,s]=(0,l.useState)(1),[i,r]=(0,l.useState)(!1),o=e=>{s(e)};function d(a){let n="";2==a&&(n="LOGIN_LDAP"),4==a&&(n="LOGIN_CAS"),p.Z.get({endpoint:`/api/v2/sys/config?type=${n}`}).then((n=>{200==n.json.meta.code||201==n.json.meta.code?(4==a&&t.setFieldsValue({CAS_USER_INFO_URL:n.json.meta.data.CAS_USER_INFO_URL,status:n.json.meta.data.status}),2==a&&e.setFieldsValue({AUTH_LDAP_SERVER:n.json.meta.data.AUTH_LDAP_SERVER,AUTH_LDAP_SEARCH:n.json.meta.data.AUTH_LDAP_SEARCH,AUTH_LDAP_BIND_PASSWORD:n.json.meta.data.AUTH_LDAP_BIND_PASSWORD,AUTH_LDAP_UID_FIELD:n.json.meta.data.AUTH_LDAP_UID_FIELD,AUTH_LDAP_USERNAME_FORMAT:n.json.meta.data.AUTH_LDAP_USERNAME_FORMAT,AUTH_LDAP_BIND_USER:n.json.meta.data.AUTH_LDAP_BIND_USER,status:n.json.meta.data.status})):message.error(n.json.meta.message)}))}function c(a){let n="";2==a&&(n="LOGIN_LDAP",e.validateFields().then((t=>{if(t){r(!0);let t={param:{AUTH_LDAP_SERVER:e.getFieldValue().AUTH_LDAP_SERVER,AUTH_LDAP_SEARCH:e.getFieldValue().AUTH_LDAP_SEARCH,AUTH_LDAP_BIND_PASSWORD:e.getFieldValue().AUTH_LDAP_BIND_PASSWORD,AUTH_LDAP_UID_FIELD:e.getFieldValue().AUTH_LDAP_UID_FIELD,AUTH_LDAP_USERNAME_FORMAT:e.getFieldValue().AUTH_LDAP_USERNAME_FORMAT,AUTH_LDAP_BIND_USER:e.getFieldValue().AUTH_LDAP_BIND_USER},type:n,status:e.getFieldValue().status};p.Z.put({endpoint:"/api/v2/sys/config/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d(a),r(!1),s(1)):message.error(e.json.meta.message)}))}else r(!1)})).catch((()=>{r(!1)}))),4==a&&(n="LOGIN_CAS",t.validateFields().then((e=>{if(e){r(!0);let e={param:{CAS_USER_INFO_URL:t.getFieldValue().CAS_USER_INFO_URL},type:n,status:t.getFieldValue().status};p.Z.put({endpoint:"/api/v2/sys/config/",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d(a),r(!1),s(1)):message.error(e.json.meta.message)}))}else r(!1)})).catch((()=>{r(!1)})))}return(0,l.useEffect)((()=>{d(2)}),[]),(0,n.tZ)(J.Z,{defaultActiveKey:"1",onChange:e=>{d(++e),s(1)}},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("LDAP Settings"),key:"1"},(0,n.tZ)("div",{className:"content"},(0,n.tZ)("div",{className:"tabs3Top"},(0,n.tZ)("div",{className:"sunTitle"},(0,y.t)("LDAP Settings")),(0,n.tZ)("div",null,(0,n.tZ)("span",null,1==a?(0,n.tZ)(j.Z,{type:"primary",onClick:()=>o(2)},(0,y.t)("Edit")):(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>o(1)},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:i,onClick:()=>c(2)},(0,y.t)("Confirm")))))),(0,n.tZ)(S.Z,{form:e,layout:"vertical",autoComplete:"off",className:"scollercss"},(0,n.tZ)(S.Z.Item,{label:(0,y.t)("LDAP Address"),name:"AUTH_LDAP_SERVER",rules:[{required:!0,message:(0,y.t)("Please enter an LDAP address")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Bind DN"),name:"AUTH_LDAP_SEARCH",rules:[{required:!0,message:(0,y.t)("Please enter a Bind DN")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Password"),name:"AUTH_LDAP_BIND_PASSWORD",rules:[{required:!0,message:(0,y.t)("Please enter the password")}]},(0,n.tZ)(T.Z.Password,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("User OU"),name:"AUTH_LDAP_UID_FIELD",rules:[{required:!0,message:(0,y.t)("Please enter a User OU")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("User Filter"),name:"AUTH_LDAP_USERNAME_FORMAT",rules:[{required:!0,message:(0,y.t)("Please enter a User Filter")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("LDAP attribute mapping"),name:"AUTH_LDAP_BIND_USER",rules:[{required:!0,message:(0,y.t)("Please enter an LDAP attribute mapping")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:""})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Enable LDAP authentication"),name:"status",valuePropName:"checked"},(0,n.tZ)(x.Z,{disabled:1==a,onChange:t=>{e.getFieldValue({status:t})}}))))),(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("CAS Settings"),key:"3"},(0,n.tZ)("div",{className:"content"},(0,n.tZ)("div",{className:"tabs3Top"},(0,n.tZ)("div",{className:"sunTitle"},(0,y.t)("CAS Settings")),(0,n.tZ)("div",null,(0,n.tZ)("span",null,1==a?(0,n.tZ)(j.Z,{type:"primary",onClick:()=>o(2)},(0,y.t)("Edit")):(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>o(1)},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:i,onClick:()=>c(4)},(0,y.t)("Confirm")))))),(0,n.tZ)(S.Z,{form:t,layout:"vertical",autoComplete:"off",className:"scollercss"},(0,n.tZ)(S.Z.Item,{label:(0,y.t)("CAS Service Address"),name:"CAS_USER_INFO_URL",rules:[{required:!0,message:(0,y.t)("Please enter the CAS service address")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:"eg:http://caddmuat.changan.com.cn"})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Enable CAS authentication"),name:"status",valuePropName:"checked"},(0,n.tZ)(x.Z,{disabled:1==a,onChange:e=>{t.getFieldValue({status:e})}}))))))};a(74401);const Qe=()=>{const[e,t]=(0,l.useState)(1),[a,s]=(0,l.useState)(!1),[i,r]=(0,l.useState)([]),[d,c]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),[h,Z]=(0,l.useState)(""),[g,f]=(0,l.useState)(""),[_,v]=(0,l.useState)(""),[b,x]=(0,l.useState)(""),[C,k]=(0,l.useState)([]),P=e=>{t(e)};function E(){p.Z.get({endpoint:"/api/v2/sys/config?type=APPEARANCE"}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(v(e.json.meta.data.LOGIN_LOGO),x(e.json.meta.data.LOGIN_NAME)):o.ZP.error(e.json.meta.message)}))}return(0,l.useEffect)((()=>{E()}),[]),(0,n.tZ)(J.Z,{defaultActiveKey:"1"},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Display Settings"),key:"1"},(0,n.tZ)("div",{className:"content"},(0,n.tZ)("div",{className:"tabs3Top"},(0,n.tZ)("div",{className:"sunTitle"},(0,y.t)("Display Settings")),(0,n.tZ)("div",null,(0,n.tZ)("span",null,1==e?(0,n.tZ)(j.Z,{type:"primary",onClick:()=>P(2)},(0,y.t)("Edit")):(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>P(1)},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:a,onClick:()=>function(){if(!_)return o.ZP.error((0,y.t)("Please upload the login page logo"));if(!b)return o.ZP.error((0,y.t)("Please enter the system name"));s(!0);let e={param:{LOGIN_LOGO:_,LOGIN_NAME:b},type:"APPEARANCE",status:!0};p.Z.put({endpoint:"/api/v2/sys/config/",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(E(),s(!1),t(1)):(o.ZP.error(e.json.meta.message),s(!1))}))}()},(0,y.t)("Confirm")))))),(0,n.tZ)(S.Z,{layout:"vertical",autoComplete:"off",className:"scollercss"},(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Login page logo"),name:"LOGIN_LOGO"},(0,n.tZ)("div",{className:"imgsize"},(0,n.tZ)("div",null,(0,n.tZ)(F.Z,{action:"",disabled:1==e,onPreview:async e=>{e.url||e.preview||(e.preview=await(e=>new Promise(((t,a)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>a(e)})))(e.originFileObj)),Z(e.url||e.preview),m(!0),f(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},listType:"picture-card",fileList:i,onChange:e=>{if(r(e.fileList),"done"===e.file.status){const e=new FormData;e.append("formData",C[0]),p.Z.post({endpoint:"/api/v1/file/upload",body:e}).then((e=>{v(e.json.result.url)})).catch((()=>{o.ZP.error((0,y.t)("upload failed"))}))}},beforeUpload:e=>{const t="image/jpeg"===e.type||"image/png"===e.type;if(!t)return o.ZP.error((0,y.t)("Only images in JPG/PNG format can be uploaded"));const a=e.size/1024/1024<2;if(!a)return o.ZP.error((0,y.t)("Image size cannot exceed 2MB"));t&&a&&k([...C,e])},accept:".png, .jpg"},i.length<1&&(0,n.tZ)("div",null,(0,n.tZ)(M.default,null),(0,n.tZ)("div",{style:{marginTop:8}},(0,y.t)("Click to Upload")))),(0,n.tZ)("p",null,(0,y.t)("Suggested size 134 * 34, supporting JPG and PNG, with a size not exceeding 2M")),(0,n.tZ)(T.Z,{onChange:e=>v(e.target.value),disabled:1==e,value:_})))),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("System name"),name:"LOGIN_NAME"},(0,n.tZ)("div",{className:"imgsize"},(0,n.tZ)("div",null,(0,n.tZ)(T.Z,{onChange:e=>x(e.target.value),disabled:1==e,value:b})))))),(0,n.tZ)(w.Z,{visible:u,title:g,footer:null,onCancel:()=>m(!1)},(0,n.tZ)("img",{alt:"example",style:{width:"100%"},src:h}))))},et=()=>{const[e]=S.Z.useForm(),[t]=S.Z.useForm(),[a,s]=(0,l.useState)(1),[i,r]=(0,l.useState)(!1),o=e=>{s(e)};function d(){p.Z.get({endpoint:"/api/v2/sys/config?type=SYSTEM_PARAM"}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?e.setFieldsValue({NUM_OF_LOGIN_FAILURES:t.json.meta.data.NUM_OF_LOGIN_FAILURES,LOGIN_FAILURE_TIME:t.json.meta.data.LOGIN_FAILURE_TIME}):message.error(t.json.meta.message)}))}return(0,l.useEffect)((()=>{d()}),[]),(0,n.tZ)(J.Z,{defaultActiveKey:"1"},(0,n.tZ)(J.Z.TabPane,{tab:(0,y.t)("Basic Settings"),key:"1"},(0,n.tZ)("div",{className:"content"},(0,n.tZ)("div",{className:"tabs3Top"},(0,n.tZ)("div",{className:"sunTitle"},(0,y.t)("Basic Settings")),(0,n.tZ)("div",null,(0,n.tZ)("span",null,1==a?(0,n.tZ)(j.Z,{type:"primary",onClick:()=>o(2)},(0,y.t)("Edit")):(0,n.tZ)(A.Z,null,(0,n.tZ)(j.Z,{onClick:()=>o(1)},(0,y.t)("Cancel")),(0,n.tZ)(j.Z,{type:"primary",loading:i,onClick:()=>{e.validateFields().then((t=>{if(t){r(!0);let t={param:{NUM_OF_LOGIN_FAILURES:e.getFieldValue().NUM_OF_LOGIN_FAILURES,LOGIN_FAILURE_TIME:e.getFieldValue().LOGIN_FAILURE_TIME},type:"SYSTEM_PARAM",status:!0};p.Z.put({endpoint:"/api/v2/sys/config/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d(),r(!1),s(1)):message.error(e.json.meta.message)}))}else r(!1)})).catch((()=>{r(!1)}))}},(0,y.t)("Confirm")))))),(0,n.tZ)(S.Z,{form:e,layout:"vertical",autoComplete:"off",className:"scollercss"},(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Number of IP failures within the time period"),name:"NUM_OF_LOGIN_FAILURES",rules:[{required:!0,message:(0,y.t)("Please enter the number of IP failures within the time period")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:(0,y.t)("Please enter the number of IP failures within the time period")})),(0,n.tZ)(S.Z.Item,{label:(0,y.t)("Login failure lock time/hour"),name:"LOGIN_FAILURE_TIME",rules:[{required:!0,message:(0,y.t)("Please enter the login failure lock time")}]},(0,n.tZ)(T.Z,{disabled:1==a,placeholder:(0,y.t)("Please enter the login failure lock time")}))))))};var tt=a(683862);const{Content:at,Sider:nt}=r.Z,lt=[],st=()=>{const e=(0,c.Fg)(),[t,a]=(0,l.useState)(),[v,b]=(0,l.useState)(""),[S,x]=(0,l.useState)([]),[C,k]=(0,l.useState)("240"),[P,A]=(0,l.useState)("240"),[j,T]=(0,l.useState)([]),[E,N]=(0,l.useState)(!1);const w=(e,t)=>{let a={},n=function(e,t){for(let l=0;l<e.length;l++){const s=e[l];s.key==t.key?(a={label:s.label,name:s.name},n(s.children,t)):s.children&&s.children.length>0&&n(s.children,t)}};return n(e,t),a};const I=e=>{let t=[];return e.map((e=>{let a={key:e.id,label:e.label,name:e.name,icon:e.icon,children:e.children?I(e.children):[]};return t.push(a),!1})),t};(0,l.useEffect)((()=>{p.Z.get({endpoint:"/api/v2/menu/sys/manager/"}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){e.json.meta.data.map((e=>{"User Management"==e.name&&(e.icon=(0,n.tZ)(u.default,null)),"Role Management"==e.name&&(e.icon=(0,n.tZ)(m.default,null)),"Dept Management"==e.name&&(e.icon=(0,n.tZ)(h.default,null)),"Permission Management"==e.name&&(e.icon=(0,n.tZ)(Z.default,null)),"System Configuration"==e.name&&(e.icon=(0,n.tZ)(g.default,null))}));let t=I(e.json.meta.data);t.map((e=>{lt.push(e.key)})),x(t)}else o.ZP.error(e.json.meta.message)}))}),[]);const O=()=>{N(!E),k(E?"240":"60"),A(E?"240":"60")};return(0,n.tZ)(r.Z,{style:{minHeight:"100vh"},className:"layoutdiv"},(0,n.tZ)(i.e,{style:{position:"relative",left:0,zIndex:9,background:"#1c2f47 ",overflow:"hidden",borderRight:"1px solid #777777"},enable:{right:!0},size:{width:C+"px"},onResize:(e,t,a,n)=>((e,t,a,n)=>{let l=P-0+(n.width-0);k(l)})(0,0,0,n),onResizeStart:e=>{},onResizeStop:(e,t,a,n)=>{let l=P-0+(n.width-0);A(l),(C<=100&&!E||C>100&&E)&&O()},maxWidth:"550px",minWidth:E?"60px":"85px"},(0,n.tZ)(nt,{css:(0,n.iv)({marginTop:e.navMenuHeight},"",""),className:"leftMenuSider",collapsible:!0,collapsed:"true"==E?1:0,trigger:null},E?(0,n.tZ)("div",{style:{fontSize:"16px",overflow:"hidden",whiteSpace:"nowrap",color:"#FFF",padding:"11.5px 8px"}},(0,y.t)("System")):(0,n.tZ)("div",{style:{fontSize:"15px",overflow:"hidden",whiteSpace:"nowrap",color:"#FFF",padding:"11.5px 8px"}},(0,y.t)("System Management")),(0,n.tZ)(tt.v2,{onClick:function(e){let t=w(S,e);b(t.label),a(t.name)},defaultSelectedKeys:["7"],mode:"inline",theme:"dark",openKeys:j,onOpenChange:e=>{const t=e.find((e=>-1===j.indexOf(e)));-1===lt.indexOf(t)?T(e):T(t?[t]:[])},className:"maxHeight800",collapsed:"true"==E?1:0},S.map((e=>e.children&&0==e.children.length?(0,n.tZ)(tt.v2.Item,{key:e.key,icon:e.icon},e.label):e.children&&e.children.length>0&&(0,n.tZ)(tt.v2.SubMenu,{key:e.key,title:e.label,icon:e.icon},e.children.map((e=>(0,n.tZ)(tt.v2.Item,{key:e.key,icon:e.icon},(0,n.tZ)("span",{style:{marginLeft:"20px"}},e.label))))))))),(0,n.tZ)("b",{onClick:()=>O(),className:"foldbtn"},E?(0,n.tZ)(f.default,{className:"foldbtnsvg"}):(0,n.tZ)(_.default,{className:"foldbtnsvg"}))),(0,n.tZ)(r.Z,{className:"site-layout",css:(0,n.iv)({marginTop:e.navMenuHeight},"","")},(0,n.tZ)(d.Z,{style:{margin:"16px"}},(0,n.tZ)(d.Z.Item,null,(0,n.tZ)("span",{style:{fontSize:"16px"}},v||S.length>0&&S[0].label))),(0,n.tZ)(at,{style:{background:"#fff",padding:"20px",maxHeight:"calc(100vh - 120px)"}},(0,n.tZ)(s.rs,null,"User Management"==t?(0,n.tZ)(G,null):"Role Management"==t?(0,n.tZ)(ae,null):"Dept Management"==t?(0,n.tZ)(_e,null):"Permission Management"==t?(0,n.tZ)(Ye,null):"Watermark Settings"==t?(0,n.tZ)(We.default,null):"Authentication Settings"==t?(0,n.tZ)(Xe,null):"Appearance"==t?(0,n.tZ)(Qe,null):"System Param"==t?(0,n.tZ)(et,null):S.length>0&&"User Management"==S[0].name?(0,n.tZ)(G,null):S.length>0&&"Role Management"==S[0].name?(0,n.tZ)(ae,null):S.length>0&&"Dept Management"==S[0].name?(0,n.tZ)(_e,null):S.length>0&&"Permission Management"==S[0].name?(0,n.tZ)(Ye,null):S.length>0&&"Watermark Settings"==S[0].name?(0,n.tZ)(We.default,null):S.length>0&&"Authentication Settings"==S[0].name?(0,n.tZ)(Xe,null):S.length>0&&"Appearance"==S[0].name?(0,n.tZ)(Qe,null):S.length>0&&"System Param"==S[0].name?(0,n.tZ)(et,null):""))))}},495470:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var n=a(150361),l=a.n(n),s=a(667294),i=a(164561),r=a(71577),o=a(519650),d=a(931097),c=a(560331),p=a(855241),u=a(432787),m=a(624225),h=a(455867),Z=a(431069),g=a(74401),y=a(205872),f=a.n(y),_=a(318933),v=a(818397),b=a(604942),S=a(211965);const x=[{type:"paragraph",children:[{text:""}]}],C=({value:e=x,setValue:t},a)=>{const n=(0,s.useCallback)((e=>(0,S.tZ)(P,e)),[]),l=(0,s.useMemo)((()=>k((0,b.BU)((0,v.VC)((0,_.Jh)())))),[]),i=(0,s.useCallback)(((e,t)=>{const a={type:"mention",character:e,children:[{text:t,bold:!0}]};_.YR.insertNodes(l,a),_.YR.move(l)}),[l]);return(0,s.useImperativeHandle)(a,(()=>({addNode:i}))),(0,S.tZ)(b.mH,{style:{heigt:"40px"},editor:l,initialValue:e,value:e,onChange:e=>{t(e)}},(0,S.tZ)(b.CX,{renderElement:n,placeholder:(0,h.t)("Enter webpage link")}))},k=e=>{const{isInline:t,isVoid:a,markableVoid:n}=e;return e.isInline=e=>"mention"===e.type||t(e),e.isVoid=e=>"mention"===e.type||a(e),e.markableVoid=e=>"mention"===e.type||n(e),e},P=e=>{const{attributes:t,children:a,element:n}=e;return"mention"===n.type?(0,S.tZ)(A,e):(0,S.tZ)("p",t,a)},A=({attributes:e,children:t,element:a})=>{const n=(0,b.vt)(),l=(0,b.UE)(),s={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:n&&l?"0 0 0 2px #B4D5FF":"none"};return a.children[0].bold&&(s.fontWeight="bold"),a.children[0].italic&&(s.fontStyle="italic"),(0,S.tZ)("span",f()({},e,{contentEditable:!1,"data-cy":`mention-${a.character.replace(" ","-")}`,style:s}),a.character,t)},j=(0,s.forwardRef)(C),T=[{label:(0,h.t)("Name"),key:"name"},{label:(0,h.t)("Account"),key:"username"},{label:(0,h.t)("Email"),key:"email"}],E=()=>{const[e]=i.Z.useForm(),t=(0,s.useRef)(null),[a,n]=(0,s.useState)(1),[y,f]=(0,s.useState)(!1),[_,v]=(0,s.useState)("#000"),[b,x]=(0,s.useState)(null),[C,k]=(0,s.useState)([]),[P,A]=(0,s.useState)(""),[E,N]=(0,s.useState)([]),w=t=>{n(t),1==t&&(e.setFieldsValue({TEXT:b.original_text,COLOR:b.COLOR,SIZE:b.SIZE,OPACITY:b.OPACITY,SPACE:b.SPACE,ANGLE:b.ANGLE,status:b.status}),v(b.COLOR),O(b.original_text))};function I(){Z.Z.get({endpoint:"/api/v2/sys/config?type=WATER_MARK"}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?(e.setFieldsValue({TEXT:t.json.meta.data.original_text,COLOR:t.json.meta.data.COLOR,SIZE:t.json.meta.data.SIZE,OPACITY:t.json.meta.data.OPACITY,SPACE:t.json.meta.data.SPACE,ANGLE:t.json.meta.data.ANGLE,status:t.json.meta.data.status}),x(l()(t.json.meta.data)),v(t.json.meta.data.COLOR),O(t.json.meta.data.original_text)):message.error(t.json.meta.message)}))}(0,s.useEffect)((()=>{I()}),[]);const O=(e="")=>{const t=null==e?void 0:e.split("/#"),a=/^\$\{([\s\S]*?)\}$/,n=[];let l="";const s=[];null==t||t.forEach(((e,i)=>{if(a.test(e)){const r=e.substr(2,e.length-3),o=T.find((e=>e.key==r));o&&(n.push({character:o.label,type:"mention",children:[{bold:!0,text:o.key}]}),(0==i||a.test(t[i-1]))&&n.splice(i,0,{text:""}),i==t.length-1&&n.push({text:""}),l+=o.label,s.push(o.key))}else n.push({text:e}),l+=e})),k([{type:"paragraph",children:n}]),A(l),N(s)};(0,s.useEffect)((()=>{}),[C]);return(0,S.tZ)("div",{className:"content"},(0,S.tZ)("div",{className:"tabs3Top"},(0,S.tZ)("div",{className:"sunTitle"},(0,h.t)("Watermark Settings")),(0,S.tZ)("div",null,(0,S.tZ)("span",null,1==a?(0,S.tZ)(r.Z,{type:"primary",onClick:()=>w(2)},(0,h.t)("Edit")):(0,S.tZ)(o.Z,null,(0,S.tZ)(r.Z,{onClick:()=>w(1)},(0,h.t)("Cancel")),(0,S.tZ)(r.Z,{type:"primary",loading:y,onClick:()=>{e.validateFields().then((t=>{if(t){f(!0);let t={param:{TEXT:e.getFieldValue().TEXT,COLOR:e.getFieldValue().COLOR,SIZE:e.getFieldValue().SIZE,OPACITY:e.getFieldValue().OPACITY,SPACE:e.getFieldValue().SPACE,ANGLE:e.getFieldValue().ANGLE},type:"WATER_MARK",status:!0};Z.Z.put({endpoint:"/api/v2/sys/config/",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(I(),f(!1),n(1)):message.error(e.json.meta.message)}))}else f(!1)})).catch((()=>{f(!1)}))}},(0,h.t)("Confirm")))))),(0,S.tZ)(i.Z,{form:e,layout:"vertical",autoComplete:"off",className:"scollercss"},(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Text"),name:"TEXT",rules:[{required:!0,message:(0,h.t)("Please enter a text")}]},1==a?(0,S.tZ)("div",{className:"TEXT-view"},P):(0,S.tZ)("div",null,(0,S.tZ)("div",{className:"TEXT-source"},(0,S.tZ)("span",null,(0,h.t)("Available values:")),T.map((e=>(0,S.tZ)(d.Z,{title:E.includes(e.key)?(0,h.t)("Click to cancel"):(0,h.t)("Click to add to input box")},(0,S.tZ)(c.Z.CheckableTag,{key:e.key,checked:E.includes(e.key),onChange:a=>((e,a)=>{var n;const l=a?[...E,e.key]:E.filter((t=>t!==e.key));N(l),null==(n=t.current)||n.addNode(e.label,e.key)})(e,a)},e.label))))),(0,S.tZ)("div",{className:"TEXT-editor"},(0,S.tZ)(j,{ref:t,style:{height:"100%",backgroundColor:"#fff"},value:C,setValue:t=>{let a="",n="";const l=[];t.forEach((e=>{"paragraph"===e.type&&e.children.forEach((e=>{"mention"===e.type?(a=`${a?a+"/#":""}\${${e.children[0].text}}`,n+=e.character,l.push(e.children[0].text)):e.text&&(a=`${a?a+"/#":""}${e.text}`,n+=e.text)}))})),e.setFieldsValue({TEXT:a,COLOR:e.getFieldValue().COLOR,SIZE:e.getFieldValue().SIZE,OPACITY:e.getFieldValue().OPACITY,SPACE:e.getFieldValue().SPACE,ANGLE:e.getFieldValue().ANGLE}),A(n),N(l)}})))),(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Text Color"),name:"COLOR",rules:[{required:!0,message:(0,h.t)("Please enter a text color")}]},(0,S.tZ)(p.Z,{content:(0,S.tZ)(g.xS,{color:_,onChangeComplete:t=>{const{hex:a,rgb:{r:n,g:l,b:s,a:i}}=t,r=a;e.setFieldsValue({COLOR:r}),v(r)},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,S.tZ)(u.Z,{disabled:1==a,placeholder:(0,h.t)("Please enter a text color"),value:_}))),(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Text Size"),name:"SIZE",rules:[{required:!0,message:(0,h.t)("Please enter a text size")}]},(0,S.tZ)(m.Z,{style:{width:"100%"},min:10,max:100,disabled:1==a,placeholder:(0,h.t)("Please enter a text size")})),(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Opacity"),name:"OPACITY",rules:[{required:!0,message:(0,h.t)("Please enter a opacity")}]},(0,S.tZ)(m.Z,{style:{width:"100%"},min:0,max:1,step:.1,disabled:1==a,placeholder:(0,h.t)("Please enter a opacity")})),(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Space"),name:"SPACE",rules:[{required:!0,message:(0,h.t)("Please enter a space")}]},(0,S.tZ)(m.Z,{style:{width:"100%"},min:0,max:9999,disabled:1==a,placeholder:(0,h.t)("Please enter a space")})),(0,S.tZ)(i.Z.Item,{label:(0,h.t)("Angle"),name:"ANGLE",rules:[{required:!0,message:(0,h.t)("Please enter a angle")}]},(0,S.tZ)(m.Z,{style:{width:"100%"},min:0,max:360,disabled:1==a,placeholder:(0,h.t)("Please enter a angle")}))))}}}]);