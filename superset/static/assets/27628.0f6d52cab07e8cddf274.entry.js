"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[27628],{419485:(e,t,r)=>{r.r(t),r.d(t,{FETCH_DASHBOARDS_FAILED:()=>h,FETCH_DASHBOARDS_SUCCEEDED:()=>c,INIT_RICH_TEXT:()=>C,REMOVE_SAVE_MODAL_ALERT:()=>v,SAVE_RICH_TEXT_SUCCESS:()=>D,SAVE_SLICE_FAILED:()=>E,SAVE_SLICE_SUCCESS:()=>T,SET_SAVE_CHART_MODAL_VISIBILITY:()=>_,createDashboard:()=>x,createSlice:()=>O,errorHandle:()=>w,fetchDashboards:()=>y,fetchDashboardsFailed:()=>p,fetchDashboardsSucceeded:()=>u,getDashboard:()=>U,getSliceDashboards:()=>L,getSlicePayload:()=>b,removeSaveModalAlert:()=>A,saveRichTextSuccess:()=>g,saveSlice:()=>M,saveSliceFailed:()=>m,saveSliceSuccess:()=>S,setSaveChartModalVisibility:()=>f,todoRichTextState:()=>I,updateSlice:()=>F});var a=r(115926),n=r.n(a),o=r(431069),i=r(455867),s=r(672570),d=r(112515);const l=/^adhoc_filters/,c="FETCH_DASHBOARDS_SUCCEEDED";function u(e){return{type:c,choices:e}}const h="FETCH_DASHBOARDS_FAILED";function p(e){return{type:h,userId:e}}const _="SET_SAVE_CHART_MODAL_VISIBILITY";function f(e){return{type:_,isVisible:e}}function y(e){return function(t){return o.Z.get({endpoint:`/dashboardasync/api/read?_flt_0_owners=${e}`}).then((({json:e})=>{const r=e.pks.map(((t,r)=>({value:t,label:(e.result[r]||{}).dashboard_title})));return r.sort(((e,t)=>e.label.localeCompare(t.label,{sensitivity:"base",numeric:!0}))),t(u(r))})).catch((()=>t(p(e))))}}const E="SAVE_SLICE_FAILED";function m(e=""){return{type:E,msg:e}}const T="SAVE_SLICE_SUCCESS";function S(e){return{type:T,data:e}}const v="REMOVE_SAVE_MODAL_ALERT";function A(){return{type:v}}const C=[{type:"paragraph",children:[{text:""}]}],D="SAVE_RICH_TEXT_SUCCESS";function g(e){return{type:D,data:e}}const b=(e,t,r,a,n,o)=>{const i=Object.entries(t).reduce(((e,[t,r])=>l.test(t)?{...e,[t]:null==r?void 0:r.filter((e=>!e.isExtra))}:e),{}),s={...t,...i,dashboards:r},[c,u]=s.datasource.split("__");"rich_text"===s.viz_type&&(s.rich_data_text=o);return{params:JSON.stringify(s),slice_name:e,viz_type:s.viz_type,datasource_id:parseInt(c,10),datasource_type:u,dashboards:r,owners:a,query_context:JSON.stringify((0,d.u)({formData:s,force:!1,resultFormat:"json",resultType:"full",setDataMask:null,ownState:null})),slice_group_id:n}},R=(e,t,r)=>{const a=[];return e?a.push((0,s.ws)((0,i.t)("Chart [%s] has been saved",t))):a.push((0,s.ws)((0,i.t)("Chart [%s] has been overwritten",t))),r&&(r.new?a.push((0,s.ws)((0,i.t)("Dashboard [%s] just got created and chart [%s] was added to it",r.title,t))):a.push((0,s.ws)((0,i.t)("Chart [%s] was added to dashboard [%s]",t,r.title)))),a},I=e=>async t=>{t(g(e))},F=({slice_id:e,owners:t},r,a,n,i)=>async(s,d)=>{const{explore:{form_data:{url_params:l,...c}},saveModal:{richTextData:u}}=d();try{const d=await o.Z.put({endpoint:`/api/v1/chart/${e}`,jsonPayload:b(r,c,a,t,i,u)});return s(S()),R(!1,r,n).map(s),d.json}catch(e){throw w(e,s),e}},w=(e,t)=>{var r;null==e||null==(r=e.json())||r.then((e=>{t(m(null==e?void 0:e.message))}))},O=(e,t,r,a=[],n)=>async(i,s)=>{const{explore:{form_data:{url_params:d,...l}},saveModal:{richTextData:c}}=s();try{const s=await o.Z.post({endpoint:"/api/v1/chart/",jsonPayload:b(e,l,t,a,n,c)});return i(S()),R(!0,e,r).map(i),s.json}catch(e){throw w(e,i),e}},x=(e,t)=>async r=>{try{return(await o.Z.post({endpoint:"/api/v1/dashboard/",jsonPayload:{dashboard_title:e,dashboard_group_id:t}})).json}catch(e){throw r(m()),e}},U=e=>async t=>{try{return(await o.Z.get({endpoint:`/api/v1/dashboard/${e}`})).json}catch(e){throw t(m()),e}},L=e=>async t=>{try{return(await o.Z.get({endpoint:`/api/v1/chart/${e.slice_id}?q=${n().encode({columns:["dashboards.id"]})}`})).json.result.dashboards.map((({id:e})=>e))}catch(e){throw t(m()),e}};function M(e,t){return r=>{const a=(0,d.H6)({formData:e,endpointType:"base",force:!1,curUrl:null,requestParams:t}),n=(0,d.u)({formData:e,force:!1,resultFormat:"json",resultType:"full"});return o.Z.post({url:a,postPayload:{form_data:e,query_context:n}}).then((e=>(r(S(e.json)),e.json))).catch((()=>r(m())))}}},161358:(e,t,r)=>{r.d(t,{Aw:()=>u,Dr:()=>f,J8:()=>p,M:()=>E,MZ:()=>m,Me:()=>y,cq:()=>_,jt:()=>c});var a=r(441609),n=r.n(a),o=r(431069),i=r(455867),s=r(115926),d=r.n(s),l=r(672570);const c="SET_REPORT";function u({userId:e,filterField:t,creationMethod:r,resourceId:a}){const n=d().encode({filters:[{col:t,opr:"eq",value:a},{col:"creation_method",opr:"eq",value:r},{col:"created_by",opr:"rel_o_m",value:e}]});return function(e){return o.Z.get({endpoint:`/api/v1/report/?q=${n}`}).then((({json:n})=>{e(function(e,t,r,a){return{type:c,report:e,resourceId:t,creationMethod:r,filterField:a}}(n,a,r,t))})).catch((()=>e((0,l.Gb)((0,i.t)("There was an issue fetching reports attached to this dashboard.")))))}}const h=(e,t)=>{const r=t(),{user:a,dashboardInfo:o,charts:i,explore:s}=r;if(n()(o)){var d;const[t]=Object.keys(i);e(u({userId:(null==(d=s.user)?void 0:d.userId)||(null==a?void 0:a.userId),filterField:"chart_id",creationMethod:"charts",resourceId:i[t].id}))}else e(u({userId:a.userId,filterField:"dashboard_id",creationMethod:"dashboards",resourceId:o.id}))},p="ADD_REPORT",_=e=>t=>o.Z.post({endpoint:"/api/v1/report/",jsonPayload:e}).then((({json:e})=>{t({type:p,json:e}),t((0,l.ws)((0,i.t)("The report has been created")))})),f="EDIT_REPORT",y=(e,t)=>r=>o.Z.put({endpoint:`/api/v1/report/${e}`,jsonPayload:t}).then((({json:e})=>{r({type:f,json:e}),r((0,l.ws)((0,i.t)("Report updated")))}));function E(e,t){return function(r){return o.Z.put({endpoint:encodeURI(`/api/v1/report/${e.id}`),headers:{"Content-Type":"application/json"},body:JSON.stringify({active:t})}).catch((()=>{r((0,l.Gb)((0,i.t)("We were unable to active or deactivate this report.")))})).finally((()=>{r(h)}))}}function m(e){return function(t){return o.Z.delete({endpoint:encodeURI(`/api/v1/report/${e.id}`)}).catch((()=>{t((0,l.Gb)((0,i.t)("Your report could not be deleted")))})).finally((()=>{t(h),t((0,l.ws)((0,i.t)("Deleted: %s",e.name)))}))}}},653652:(e,t,r)=>{r.d(t,{Z:()=>a});const a=class{constructor(e){this.name="TypedRegistry",this.records=void 0,this.records=e}get(e){return this.records[e]}set(e,t){this.records[e]=t}}},175049:(e,t,r)=>{r.d(t,{I:()=>i,_:()=>s});var a=r(653652),n=r(601875);class o extends a.Z{constructor(...e){super(...e),this.name="ExtensionsRegistry"}}const i=(0,n.Z)(o,{}),s=i},229147:(e,t,r)=>{r.d(t,{DG:()=>l,fG:()=>d});var a=r(667294),n=r(427600),o=r(23525),i=r(211965);const s=(0,a.createContext)({hideTitle:!1,hideTab:!1,hideNav:!1,hideChartControls:!1}),d=()=>(0,a.useContext)(s),l=({children:e})=>{const t=(0,o.eY)(n.KD.uiConfig)||0,[r]=(0,a.useState)({hideTitle:0!==(1&t),hideTab:0!==(2&t),hideNav:0!==(4&t),hideChartControls:0!==(8&t)});return(0,i.tZ)(s.Provider,{value:r},e)}},199068:(e,t,r)=>{r.d(t,{AG:()=>s,yn:()=>c});var a=r(431069),n=r(672570),o=r(998286),i=r(200651);const s="SET_DATASOURCE";function d(e){return{type:s,datasource:e}}function l(e){return function(t,r){const{explore:{datasource:a}}=r();t(d(e)),t((0,i.updateFormDataByDatasource)(a,e))}}const c={setDatasource:d,changeDatasource:l,saveDataset:function({schema:e,sql:t,database:r,templateParams:i,datasourceName:s,columns:d}){return async function(c){try{const{json:{data:n}}=await a.Z.post({endpoint:"/superset/sqllab_viz/",postPayload:{data:{schema:e,sql:t,dbId:null==r?void 0:r.id,templateParams:i,datasourceName:s,metrics:[],columns:d}}});return c(l(n)),n}catch(e){throw(0,o.O$)(e).then((e=>{c((0,n.Gb)(e.error))})),e}}}}},200651:(e,t,r)=>{r.r(t),r.d(t,{CREATE_NEW_SLICE:()=>x,FETCH_DATASOURCES_STARTED:()=>h,FETCH_DATASOURCES_SUCCEEDED:()=>_,FETCH_DATASOURCE_SUCCEEDED:()=>c,FETCH_FAVE_STAR:()=>m,POST_DATASOURCE_STARTED:()=>l,SAVE_FAVE_STAR:()=>S,SET_EXPLORE_CONTROLS:()=>D,SET_FIELD_VALUE:()=>A,SET_FORCE_QUERY:()=>Z,SET_FORM_DATA:()=>b,SET_SAVE_ACTION:()=>w,SLICE_UPDATED:()=>L,TOGGLE_FAVE_STAR:()=>y,UPDATE_CHART_TITLE:()=>I,UPDATE_FORM_DATA_BY_DATASOURCE:()=>s,createNewSlice:()=>U,exploreActions:()=>V,fetchDatasourceSucceeded:()=>u,fetchDatasourcesStarted:()=>p,fetchDatasourcesSucceeded:()=>f,fetchFaveStar:()=>T,saveFaveStar:()=>v,setControlValue:()=>C,setExploreControls:()=>g,setForceQuery:()=>P,setFormData:()=>R,setSaveAction:()=>O,sliceUpdated:()=>M,toggleFaveStar:()=>E,updateChartTitle:()=>F,updateFormDataByDatasource:()=>d});var a=r(431069),n=r(455867),o=r(672570);const i="/superset/favstar/slice",s="UPDATE_FORM_DATA_BY_DATASOURCE";function d(e,t){return{type:s,prevDatasource:e,newDatasource:t}}const l="POST_DATASOURCE_STARTED",c="FETCH_DATASOURCE_SUCCEEDED";function u(){return{type:c}}const h="FETCH_DATASOURCES_STARTED";function p(){return{type:h}}const _="FETCH_DATASOURCES_SUCCEEDED";function f(){return{type:_}}const y="TOGGLE_FAVE_STAR";function E(e){return{type:y,isStarred:e}}const m="FETCH_FAVE_STAR";function T(e){return function(t){a.Z.get({endpoint:`${i}/${e}/count/`}).then((({json:e})=>{e.count>0&&t(E(!0))}))}}const S="SAVE_FAVE_STAR";function v(e,t){return function(r){const s=t?"unselect":"select";a.Z.get({endpoint:`${i}/${e}/${s}/`}).then((()=>r(E(!t)))).catch((()=>{r((0,o.Gb)((0,n.t)("An error occurred while starring this chart")))}))}}const A="SET_FIELD_VALUE";function C(e,t,r){return{type:A,controlName:e,value:t,validationErrors:r}}const D="UPDATE_EXPLORE_CONTROLS";function g(e){return{type:D,formData:e}}const b="UPDATE_FORM_DATA";function R(e){return{type:b,formData:e}}const I="UPDATE_CHART_TITLE";function F(e){return{type:I,sliceName:e}}const w="SET_SAVE_ACTION";function O(e){return{type:w,saveAction:e}}const x="CREATE_NEW_SLICE";function U(e,t,r,a,n){return{type:x,can_add:e,can_download:t,can_overwrite:r,slice:a,form_data:n}}const L="SLICE_UPDATED";function M(e){return{type:L,slice:e}}const Z="SET_FORCE_QUERY";function P(e){return{type:Z,force:e}}const V={...o.s2,fetchDatasourcesStarted:p,fetchDatasourcesSucceeded:f,toggleFaveStar:E,fetchFaveStar:T,saveFaveStar:v,setControlValue:C,setExploreControls:g,updateChartTitle:F,createNewSlice:U,sliceUpdated:M,setForceQuery:P}},234453:(e,t,r)=>{r.d(t,{Cy:()=>Ee,zn:()=>Se,h:()=>Te});var a=r(14890),n=r(753894),o=r(672570);var i=r(599543),s=r(937863),d=r(8868),l=r(161358);var c=r(150361),u=r.n(c),h=r(641295),p=r(182140),_=r(52004);var f=r(314824);var y=r(909467);const E={viewType:"rowAndColumn",dashboardComponentTarget:"none",ratioX:0,drawerStatus:0,isFulling:!1,mobileFilterType:"horizontal",mobileFilterStatus:{reset:!1,confirm:!1},emulateRatio:{width:350,height:680}};var m=r(839023),T=r(239759),S=r(224350),v=r.n(S),A=r(550810);var C=r(437927),D=r(21090),g=r(680621),b=r(990605),R=r(132485),I=r(995173),F=r(347456),w=r(437418),O=r(128428),x=r(591282),U=r(81255);const L=(0,r(454076).cz)();function M({dropResult:e,layout:t,mobile:r}){const{dragging:a,destination:n}=e,o=a.type,i=t[n.id],s=i.type;let d=(0,O.Z)(o,a.meta);if(d.parents=(i.parents||[]).concat(i.id),(0,R.Z)(a)&&(d.meta.width=(0,F.Z)({dropResult:e,layout:t})||void 0,r)){let e=L;const r=(d.parents||[]).filter((e=>e.indexOf("ROW-")>-1)),a=(null==r?void 0:r[0])||"";if(a){const r=t[a],n=Object.values(t),o=r.children||[];o.forEach(((t,r)=>{const a=n.filter((e=>(null==e?void 0:e.id)===t));a.length&&(e-=a[0].meta.width||0),o.length}))}d.meta.width=e}const l=(0,x.Z)({parentType:s,childType:o}),c={[d.id]:d};if(l){const e=(0,O.Z)(U.Os);e.children=[d.id],e.parents=(i.parents||[]).concat(i.id),c[e.id]=e,d.parents=e.parents.concat(e.id),d=e}else if(o===U.yR){const e=(0,O.Z)(U.gn);e.parents=(i.parents||[]).concat(i.id),d.children=[e.id],c[e.id]=e}const u=[...i.children];return u.splice(n.index,0,d.id),c[n.id]={...i,children:u},c}function Z({entitiesMap:e,source:t,destination:r}){const a=[...e[t.id].children],n=[...e[r.id].children],o=a[t.index];if(t.id===r.id){const n=function(e,t,r){const a=[...e],[n]=a.splice(t,1);return a.splice(r,0,n),a}(a,t.index,r.index);return{...e,[t.id]:{...e[t.id],children:n}}}a.splice(t.index,1),n.splice(r.index,0,o);return{...e,[t.id]:{...e[t.id],children:a},[r.id]:{...e[r.id],children:n}}}var P=r(489293),V=r(674547);function j(e,t,r){const a=null==r?void 0:r[e];if(a){delete r[e];const{children:n=[]}=a;null==n||null==n.forEach||n.forEach((t=>{j(t,e,r)}));const o=null==r?void 0:r[t];if(Array.isArray(null==o?void 0:o.children)){const a=o.children.indexOf(e);if(a>-1){const e=[...o.children];e.splice(a,1),r[t]={...o,children:e}}}}}const H={[p.$]:(e,t)=>({...t.data.dashboardLayout.present}),[b.nj](e,t){const{payload:{nextComponents:r,sync:a}}=t;return a?(0,V.Dz)(e,r):{...e,...r}},[b.CB](e,t){var r;const{payload:{id:a,parentId:n}}=t;let o=n;if(!o&&e[a]){const t=e[a].parents.length-1;o=e[a].parents[t]}if(!o||!a||!e[a]||!e[o])return e;const i={...e};j(a,o,i);const s=i[o];if((null==s?void 0:s.type)===U.Os&&0===(null==s||null==(r=s.children)?void 0:r.length)){j(o,(0,I.Z)({childId:o,layout:i}),i)}return i},[b.TE](e,t){const{payload:{dropResult:r}}=t,a=(0,P.Z)({dropResult:r,layout:e,mobile:!1});return{...e,...a}},[b.J0](e,t){const{payload:{dropResult:r}}=t,a=M({dropResult:r,layout:e});return{...e,...a}},[b.aZ](e,t){const{payload:{dropResult:r}}=t,{source:a,destination:n,dragging:o}=r;if(!a||!n||!o)return e;if("float"===o.meta.layoutType){var i,s;const t={...e};return t[o.id].meta.pos||(t[o.id].meta.pos={}),t[o.id].meta.pos.x=((null==(i=t[o.id].meta.pos)?void 0:i.x)||0)+n.pos.x,t[o.id].meta.pos.y=((null==(s=t[o.id].meta.pos)?void 0:s.y)||0)+n.pos.y,{...t}}const d=Z({entitiesMap:e,source:a,destination:n});if((0,R.Z)(d[o.id])){const t=(0,F.Z)({dropResult:r,layout:e})||void 0;(d[o.id].meta||{}).width!==t&&(d[o.id]={...d[o.id],meta:{...d[o.id].meta,width:t}})}if((0,x.Z)({parentType:n.type,childType:o.type})){const e=d[n.id],t=e.children,r=(0,O.Z)(U.Os);r.children=[t[n.index]],r.parents=(e.parents||[]).concat(n.id),t[n.index]=r.id,d[r.id]=r}return{...e,...d}},[b.YA](e,t){const{payload:{dropResult:r}}=t,{source:a,dragging:n}=r,o=e[g._4],i=o.children[0],s=e[i];if(a.id!==g.D0){const t=e[n.id].children[0],r=e[t],a=[...s.children].filter((e=>e!==n.id));return{...e,[g._4]:{...o,children:[n.id]},[i]:{...s,children:[]},[t]:{...r,children:[...r.children,...a]}}}const d=M({dropResult:r,layout:e}),l=Object.values(d),c=l.find((e=>e.type===U.gn)),u=l.find((e=>e.type===U.yR));return c.children=[...s.children],d[i]={...s,children:[]},d[g._4]={...o,children:[u.id]},{...e,...d}},[b.Mu](e){const t=e[g._4],r=t.children[0],a=e[r];if(a.type!==U.yR)return e;let n=[];const o={...e};return a.children.forEach((t=>{const r=e[t];n=[...n,...r.children],delete o[t]})),delete o[r],o[g._4]={...t,children:[g.PV]},o[g.PV]={...e[g.PV],children:n},o},[b.x_](e){const t={...e};return(0,w.Z)({currentComponent:t[g._4],layout:t}),{...t}},[b.bK]:(e,t)=>({...e,[g.M2]:{...e[g.M2],meta:{...e[g.M2].meta,text:t.text}}}),[b.G8](e,t){var r,a;const n=null==t||null==(r=t.data)?void 0:r.id,o=null==t||null==(a=t.data)?void 0:a.url;return{...e,[n]:{...e[n],meta:{...e[n].meta,url:o}}}}};const N=(0,D.ZP)((function(e={},t){if(t.type in H){return(0,H[t.type])(e,t)}return e}),{limit:g.Q9+2,ignoreInitialState:!0,filter:(0,D.an)([p.$,b.nj,b.CB,b.J0,b.YA,b.Mu,b.qL,b.aZ,b.L1])});var $=r(714670),q=r.n($),B=r(431069),G=r(667496),Y=r(309679),z=r(797381),k=r(203741),X=r(23279),J=r.n(X);const Q=new class{constructor({callback:e=(()=>{}),sizeThreshold:t=1e3,delayThreshold:r=1e3}){this.queue=[],this.sizeThreshold=t,this.delayThreshold=r,this.trigger=J()(this.trigger.bind(this),this.delayThreshold),this.callback=e}append(e){this.queue.push(e),this.trigger()}trigger(){if(this.queue.length>0){const e=this.queue.splice(0,this.sizeThreshold);this.callback.call(null,e),this.queue.length>0&&this.trigger()}}}({callback:e=>{if(e.length<=0)return;let t="/superset/log/?explode=events";const{source:r,source_id:a}=e[0];if("dashboard"===r?t+=`&dashboard_id=${a}`:"slice"===r&&(t+=`&slice_id=${a}`),navigator.sendBeacon){const r=new FormData;r.append("events",(0,Y.o)(e)),B.Z.getGuestToken()&&r.append("guest_token",B.Z.getGuestToken()),navigator.sendBeacon((0,G.VU)(t),r)}else B.Z.post({endpoint:t,postPayload:{events:e},parseMethod:null})},sizeThreshold:1024,delayThreshold:1e3});let W=0;const K=e=>t=>r=>{var a;if(r.type!==z.LOG_EVENT)return t(r);const{dashboardInfo:n,explore:o,impressionId:i,dashboardLayout:s,sqlLab:d}=e.getState();let l={impression_id:i,version:"v2"};if(null!=n&&n.id)l={source:"dashboard",source_id:n.id,...l};else if(null!=o&&o.slice)l={source:"explore",source_id:o.slice?o.slice.slice_id:0,...l};else if(d){const e=d.queryEditors.find((({id:e})=>e===d.tabHistory.slice(-1)[0]));l={source:"sqlLab",source_id:null==e?void 0:e.id,db_id:null==e?void 0:e.dbId,schema:null==e?void 0:e.schema}}const{eventName:c}=r.payload;let{eventData:u={}}=r.payload;if(u={...l,ts:(new Date).getTime(),event_name:c,...u},k.TY.has(c)?u={...u,event_type:"timing",trigger_event:W}:(W=q().generate(),u={...u,event_type:"user",event_id:W,visibility:document.visibilityState}),u.target_id&&null!=s&&null!=(a=s.present)&&a[u.target_id]){const{meta:e}=s.present[u.target_id];u.target_name=e.chartId?e.sliceName:e.text}return Q.append(u),u};var ee=r(455867),te=r(419485),re=r(476445);var ae=r(355786),ne=r(935500),oe=r(635854),ie=r(410331),se=r(200651);var de=r(542313),le=r(199068);var ce=r(920292),ue=r(974713);function he(e,t,r){const a=null==r?void 0:r[e];if(a){delete r[e];const{children:n=[]}=a;null==n||null==n.forEach||n.forEach((t=>{he(t,e,r)}));const o=null==r?void 0:r[t];if(Array.isArray(null==o?void 0:o.children)){const a=o.children.indexOf(e);if(a>-1){const e=[...o.children];e.splice(a,1),r[t]={...o,children:e}}}}}const pe={[p.$]:(e,t)=>({...t.data.mobileDashboardLayout.present}),[ue.nj](e,t){const{payload:{nextComponents:r,sync:a}}=t;return a?(0,V.Dz)(e,r):{...e,...r}},[ue.CB](e,t){var r;const{payload:{id:a,parentId:n}}=t;let o=n;if(!o&&e[a]){const t=e[a].parents.length-1;o=e[a].parents[t]}if(!o||!a||!e[a]||!e[o])return e;const i={...e};he(a,o,i);const s=i[o];if((null==s?void 0:s.type)===U.Os&&0===(null==s||null==(r=s.children)?void 0:r.length)){he(o,(0,I.Z)({childId:o,layout:i}),i)}return i},[ue.TE](e,t){const{payload:{dropResult:r}}=t,a=(0,P.Z)({dropResult:r,layout:e,mobile:!0});return{...e,...a}},[ue.J0](e,t){const{payload:{dropResult:r}}=t,a=M({dropResult:r,layout:e,mobile:!0});return{...e,...a}},[ue.aZ](e,t){const{payload:{dropResult:r}}=t,{source:a,destination:n,dragging:o}=r;if(!a||!n||!o)return e;if("float"===o.meta.layoutType){var i,s;const t={...e};return t[o.id].meta.pos||(t[o.id].meta.pos={}),t[o.id].meta.pos.x=((null==(i=t[o.id].meta.pos)?void 0:i.x)||0)+n.pos.x,t[o.id].meta.pos.y=((null==(s=t[o.id].meta.pos)?void 0:s.y)||0)+n.pos.y,{...t}}const d=Z({entitiesMap:e,source:a,destination:n});if((0,R.Z)(d[o.id])){const t=(0,F.Z)({dropResult:r,layout:e})||void 0;(d[o.id].meta||{}).width!==t&&(d[o.id]={...d[o.id],meta:{...d[o.id].meta,width:t}})}if((0,x.Z)({parentType:n.type,childType:o.type})){const e=d[n.id],t=e.children,r=(0,O.Z)(U.Os);r.children=[t[n.index]],r.parents=(e.parents||[]).concat(n.id),t[n.index]=r.id,d[r.id]=r}return{...e,...d}},[ue.YA](e,t){const{payload:{dropResult:r}}=t,{source:a,dragging:n}=r,o=e[g._4],i=o.children[0],s=e[i];if(a.id!==g.D0){const t=e[n.id].children[0],r=e[t],a=[...s.children].filter((e=>e!==n.id));return{...e,[g._4]:{...o,children:[n.id]},[i]:{...s,children:[]},[t]:{...r,children:[...r.children,...a]}}}const d=M({dropResult:r,layout:e}),l=Object.values(d),c=l.find((e=>e.type===U.gn)),u=l.find((e=>e.type===U.yR));return c.children=[...s.children],d[i]={...s,children:[]},d[g._4]={...o,children:[u.id]},{...e,...d}},[ue.Mu](e){const t=e[g._4],r=t.children[0],a=e[r];if(a.type!==U.yR)return e;let n=[];const o={...e};return a.children.forEach((t=>{const r=e[t];n=[...n,...r.children],delete o[t]})),delete o[r],o[g._4]={...t,children:[g.PV]},o[g.PV]={...e[g.PV],children:n},o},[ue.x_](e){const t={...e};return(0,w.Z)({currentComponent:t[g._4],layout:t}),{...t}},[ue.bK]:(e,t)=>({...e,[g.M2]:{...e[g.M2],meta:{...e[g.M2].meta,text:t.text}}}),[ue.G8](e,t){var r,a;const n=null==t||null==(r=t.data)?void 0:r.id,o=null==t||null==(a=t.data)?void 0:a.url;return{...e,[n]:{...e[n],meta:{...e[n].meta,url:o}}}}};const _e=(0,D.ZP)((function(e={},t){if(t.type in pe){return(0,pe[t.type])(e,t)}return e}),{limit:g.Q9+2,ignoreInitialState:!0,filter:(0,D.an)([p.$,ue.nj,ue.CB,ue.J0,ue.YA,ue.Mu,ue.qL,ue.aZ,ue.L1])}),fe=e=>(t=e)=>t,ye=(0,ce.Z)(),Ee="USER_LOADED",me=(0,a.UY)({messageToasts:function(e=[],t){switch(t.type){case o.h:{const{payload:r}=t,a=e.slice();return r.noDuplicate&&a.find((e=>e.text===r.text))?e:[r,...e]}case o.K7:{const{payload:{id:r}}=t;return[...e].filter((e=>e.id!==r))}default:return e}},common:fe(ye.common),user:(e=ye.user||{},t)=>t.type===Ee?t.user:e,impressionId:fe(q().generate()),charts:s.Z,datasources:(e,t)=>t.type===A.Rn.SET_DATASOURCES?function(e,t){return t.type===A.Rn.SET_DATASOURCES?{...e,...v()(t.datasources,"uid")}:t.type===A.Rn.SET_DATASOURCE?{...e,[t.key]:t.datasource}:e||{}}(e,t):function(e,t){return t.type===le.AG?{...e,[(0,de.T)(t.datasource)]:t.datasource}:t.type===re._?{...t.data.datasources}:e||{}}(e,t),dashboardInfo:function(e={},t){var r;switch(t.type){case h.gA:let a=u()(e);const n=(null==a||null==(r=a.metadata)?void 0:r.native_filter_configuration)||[];return n.length>0&&a.metadata&&a.metadata.native_filter_configuration&&(a.metadata.native_filter_configuration=n.filter((e=>(null==e?void 0:e.id)!=(null==t?void 0:t.filterId)))),a;case h.$A:return{...e,...t.newInfo,last_modified_time:Math.round((new Date).getTime()/1e3)};case p.$:return{...e,...t.data.dashboardInfo};case h.nH:return{...e,filterBarOrientation:t.filterBarOrientation};case h.Fl:return{...e,crossFiltersEnabled:t.crossFiltersEnabled};case h.Xb:{const r=t.payload;return{...e,[r.type]:{...e[r.type],...r.data}}}case h.IC:return{...e,changedInfo:t.changedInfo};default:return e}},dashboardFilters:m.ZP,dataMask:d.Z,nativeFilters:T.Z,dashboardState:function(e={...E},t){const r={[y.Lg]:()=>({...e,ratioX:t.ratioX}),[y.Pl]:()=>({...e,isFulling:t.status}),[y.mD]:()=>({...e,viewType:t.viewType}),[y.pC]:()=>({...e,dashboardShare:t.dashboardShare}),[y.R8]:()=>({...e,dashboardComponentTarget:t.target}),[y.x4]:()=>({...e,dashboardConfig_old:{...e.dashboardConfig_old,floats:t.components}}),[y.Vl]:()=>({...e,dashboardConfig_old:{...e.dashboardConfig_old,fitConfig:t.config}}),[p.$]:()=>({...e,...t.data.dashboardState}),[y.Be]:()=>({...e,css:t.css}),[y.BD](){const r=new Set(e.sliceIds);return r.add(t.slice.slice_id),{...e,sliceIds:Array.from(r)}},[y.Vd](){const{sliceId:r}=t,a=new Set(e.sliceIds);return a.delete(r),{...e,sliceIds:Array.from(a)}},[y.Z9]:()=>({...e,isStarred:t.isStarred}),[y.H9]:()=>({...e,isPublished:t.isPublished}),[y.$f]:()=>({...e,editMode:t.editMode}),[y.rW]:()=>({...e,layoutMode:t.layoutMode}),[y.NW](){var r,a,n,o,i,s;const d=_.zn.filter((e=>e.type===t.payload.emulateType)),l=d.length>0&&(t.payload.emulateType&&{width:d[0].width||(null==(r=e.emulateRatio)?void 0:r.width),height:d[0].height||(null==(a=e.emulateRatio)?void 0:a.height)}||{width:(null==(n=e.emulateRatio)?void 0:n.width)||d[0].width,height:(null==(o=e.emulateRatio)?void 0:o.height)||d[0].height})||null;return null!=(i=t.payload.emulateRatio)&&i.width&&(l.width=t.payload.emulateRatio.width),null!=(s=t.payload.emulateRatio)&&s.height&&(l.height=t.payload.emulateRatio.height),{...e,emulateType:t.payload.emulateType,emulateRatio:{...l}}},[y.n1](){const{maxUndoHistoryExceeded:r=!0}=t.payload;return{...e,maxUndoHistoryExceeded:r}},[y.oJ]:()=>({...e}),[y.J$]:()=>({...e,colorScheme:t.colorScheme,updatedColorScheme:!0}),[y.ek](){const r={...e.expandedSlices},{sliceId:a}=t;return r[a]?delete r[a]:r[a]=!0,{...e,expandedSlices:r}},[y.P0]:()=>({...e,hasUnsavedChanges:!0}),[y.hD]:()=>({...e,dashboardIsSaving:!0}),[y.qJ]:()=>({...e,dashboardIsSaving:!1}),[y.Ii]:()=>({...e,hasUnsavedChanges:!1,maxUndoHistoryExceeded:!1,editMode:!1,updatedColorScheme:!1,lastModifiedTime:t.lastModifiedTime}),[y.ee](){const{hasUnsavedChanges:r}=t.payload;return{...e,hasUnsavedChanges:r}},[y.yV]:()=>({...e,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:t.isPersistent,hasUnsavedChanges:t.isPersistent}),[y.ec]:()=>({...e,isRefreshing:!0}),[y.bs]:()=>({...e,isFiltersRefreshing:!0}),[y.sm]:()=>({...e,isFiltersRefreshing:!1}),[y.k5]:()=>({...e,isRefreshing:!1}),[y.RU]:()=>({...e,directPathToChild:t.path,directPathLastUpdated:Date.now()}),[y.iy]:()=>({...e,drawerStatus:t.drawerStatus}),[y.BR](){const r=e.mobileFilterChange,a=t.mobileFilterChange;return{...e,mobileFilterChange:Object.assign({},r||{},a)}},[y.Iz]:()=>({...e,mobileFilterType:t.mobileFilterType}),[y.zI](){const r=Object.assign(e.mobileFilterStatus||{},t.mobileFilterStatus);return{...e,mobileFilterStatus:r}},[y.nV](){const r=new Set(e.activeTabs);return r.delete(t.prevTabId),r.add(t.tabId),{...e,activeTabs:Array.from(r)}},[y.w9]:()=>({...e,overwriteConfirmMetadata:t.overwriteConfirmMetadata}),[y.mq]:()=>({...e,focusedFilterField:{chartId:t.chartId,column:t.column}}),[y.Iw]:()=>e.focusedFilterField&&t.chartId===e.focusedFilterField.chartId&&t.column===e.focusedFilterField.column?{...e,focusedFilterField:null}:e,[y.r$]:()=>({...e,fullSizeChartId:t.chartId}),[y.FF]:()=>({...e,datasetsStatus:t.status}),[y.PU]:()=>({...e,showComponentPropertyPane:t.componentId}),[y.E9]:()=>({...e,dashboardConfig:t.config})};return t.type in r?r[t.type]():e},dashboardLayout:N,mobileDashboardLayout:_e,mobileDashboardStandby:function(e=[],t){switch(t.type){case p.$:return[...t.data.mobileDashboardStandby];case f.TE:return[...e,...t.payload];case f.CB:let r=t.payload.index;return void 0===r&&t.payload.id&&(r=e.findIndex((e=>e.id===t.payload.id))),void 0!==r&&-1!==r&&e[r]?(e.splice(r,1),[...e]):e;default:return e}},sliceEntities:C.Z,reports:function(e={},t){const r={[l.jt](){var r,a;const{report:n,resourceId:o,creationMethod:i,filterField:s}=t,d=null==(r=n.result)?void 0:r.find((e=>e[s]===o));if(d)return{...e,[i]:{...e[i],[o]:d}};if(null!=e&&null!=(a=e[i])&&a[o]){const t={...e};return delete t[i][o],t}return{...e}},[l.J8](){const{result:r,id:a}=t.json,n={...r,id:a},o=n.dashboard||n.chart;return{...e,[n.creation_method]:{...e[n.creation_method],[o]:n}}},[l.Dr](){const r={...t.json.result,id:t.json.id},a=r.dashboard||r.chart;return{...e,[r.creation_method]:{...e[r.creation_method],[a]:r}}}};return t.type in r?r[t.type]():e},saveModal:function(e={richTextData:te.INIT_RICH_TEXT},t){const r={[te.SET_SAVE_CHART_MODAL_VISIBILITY]:()=>({...e,isVisible:t.isVisible}),[te.FETCH_DASHBOARDS_SUCCEEDED]:()=>({...e,dashboards:t.choices}),[te.FETCH_DASHBOARDS_FAILED]:()=>({...e,saveModalAlert:`fetching dashboards failed for ${t.userId}`}),[te.SAVE_SLICE_FAILED]:()=>({...e,saveModalAlert:t.msg||(0,ee.t)("Failed to save slice")}),[te.SAVE_SLICE_SUCCESS]:t=>({...e,data:t}),[te.REMOVE_SAVE_MODAL_ALERT]:()=>({...e,saveModalAlert:null}),[te.SAVE_RICH_TEXT_SUCCESS]:()=>({...e,richTextData:(null==t?void 0:t.data)||te.INIT_RICH_TEXT}),[re._]:()=>({...t.data.saveModal})};return t.type in r?r[t.type]():e},explore:function(e={},t){const r={[ne.DYNAMIC_PLUGIN_CONTROLS_READY]:()=>({...e,controls:t.controlsState}),[se.TOGGLE_FAVE_STAR]:()=>({...e,isStarred:t.isStarred}),[se.POST_DATASOURCE_STARTED]:()=>({...e,isDatasourceMetaLoading:!0}),[se.UPDATE_FORM_DATA_BY_DATASOURCE](){const r={...e.form_data},{prevDatasource:a,newDatasource:n}=t,o={...e.controls},i=[];a.id===n.id&&a.type===n.type||(r.datasource=n.uid),Object.entries(o).forEach((([e,t])=>{("column_name"===t.valueKey||"savedMetrics"in t||"columns"in t||"options"in t&&!Array.isArray(t.options))&&(r[e]=(0,ie.YY)(n,t,t.value),(0,ae.Z)(r[e]).length>0&&r[e]!==o[e].default&&i.push(e))}));const s={...e,controls:o,datasource:t.newDatasource};return{...s,form_data:r,controls:(0,oe.R3)(s,r),controlsTransferred:i}},[se.FETCH_DATASOURCES_STARTED]:()=>({...e,isDatasourcesLoading:!0}),[se.SET_FIELD_VALUE](){const{controlName:r,value:a,validationErrors:n}=t;let o={...e.form_data,[r]:a};const i=e.form_data.metrics,s=e.form_data.column_config,d=o.viz_type;"metrics"===r&&i&&s&&(a.forEach(((e,t)=>{var r,a;(null==e?void 0:e.label)!==(null==(r=i[t])?void 0:r.label)&&s[null==(a=i[t])?void 0:a.label]&&(s[e.label]=s[i[t].label],delete s[i[t].label])})),o.column_config=s);const l=e.controls[t.controlName]||(0,ie.Bx)(t.controlName,d)||{},c={...(0,ie.vP)(l,e,t.value)},u={...e.controls.column_config,...s&&{value:s}},h={...e,controls:{...e.controls,[r]:c,..."metrics"===r&&{column_config:u}}},p={};Array.isArray(c.rerender)&&c.rerender.forEach((e=>{p[e]={...(0,ie.vP)(h.controls[e],h,h.controls[e].value)}}));const _=c.validationErrors||[];(n||[]).forEach((e=>{_.includes(e)||_.push(e)}));const f=_&&_.length>0,y="viz_type"===t.controlName&&t.value!==e.controls.viz_type.value;let E=e.controls;if(y){const r=new ie.os(e.form_data).transform(t.value,e);o=r.formData,E=r.controlsState}return{...e,form_data:o,triggerRender:c.renderTrigger&&!f,controls:{...E,[t.controlName]:{...c,validationErrors:_},...p}}},[se.SET_EXPLORE_CONTROLS]:()=>({...e,controls:(0,oe.R3)(e,t.formData)}),[se.SET_FORM_DATA]:()=>({...e,form_data:t.formData}),[se.UPDATE_CHART_TITLE]:()=>({...e,sliceName:t.sliceName}),[se.SET_SAVE_ACTION]:()=>({...e,saveAction:t.saveAction}),[se.CREATE_NEW_SLICE]:()=>({...e,slice:t.slice,controls:(0,oe.R3)(e,t.form_data),can_add:t.can_add,can_download:t.can_download,can_overwrite:t.can_overwrite}),[se.SLICE_UPDATED](){var r;return{...e,slice:{...e.slice,...t.slice,owners:t.slice.owners?t.slice.owners.map((e=>e.value)):null},sliceName:null!=(r=t.slice.slice_name)?r:e.sliceName,metadata:{...e.metadata,owners:t.slice.owners?t.slice.owners.map((e=>e.label)):null}}},[se.SET_FORCE_QUERY]:()=>({...e,force:t.force}),[re._]:()=>({...t.data.explore})};return t.type in r?r[t.type]():e}}),Te=(0,a.MT)(me,{},(0,a.qC)((0,a.md)(n.Z,K),(0,i.hU)(!1)));function Se(e=!1){return(0,a.MT)(me,{},(0,a.qC)((0,a.md)(n.Z,K),(0,i.hU)(!1,void 0,e)))}}}]);