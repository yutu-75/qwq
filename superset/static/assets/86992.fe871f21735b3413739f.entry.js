(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[86992],{132657:(e,t,a)=>{"use strict";a.d(t,{Z:()=>he});var n,l=a(828216),i=a(14890),o=a(935500),r=a(797381),s=a(205872),d=a.n(s),c=a(150361),u=a.n(c),h=a(45697),p=a.n(h),m=a(667294),g=a(455867),f=a(751995),v=a(281928),y=a(68492),b=a(355786),w=a(591877),k=a(593185),x=a(409531),Z=a(838703),C=a(94301),S=a(957902),R=a(203741),D=a(427600),O=a(23525),T=a(71894);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(n||(n={}));var _=a(242190),M=a(49937),I=a(618446),E=a.n(I),z=a(211865),j=a.n(z),F=a(616355),$=a(311064),A=a(888274),L=a(211965),N=a(973935),P=a(683862),B=a(345671),U=a(569175);const Q=({id:e,formData:t,onSelection:a,onClose:n},l)=>{const[{filters:i,clientX:o,clientY:r},s]=(0,m.useState)({clientX:0,clientY:0}),d=[],c=(0,k.c)(k.T.DRILL_TO_DETAIL);c&&d.push((0,L.tZ)(B.p,{chartId:e,formData:t,filters:i,isContextMenu:!0,contextMenuY:r,onSelection:a}));const u=(0,m.useCallback)(((t,a,n)=>{var l;const i=[c?2:0].reduce(((e,t)=>e+t),0)||1,o=(0,U.$t)(a,i);s({clientX:t,clientY:o,filters:n}),null==(l=document.getElementById(`hidden-span-${e}`))||l.click()}),[e,c]);return(0,m.useImperativeHandle)(l,(()=>({open:u})),[u]),N.createPortal((0,L.tZ)(M.Gj,{overlay:(0,L.tZ)(P.v2,null,d.length?d:null),trigger:["click"],onVisibleChange:e=>!e&&n()},(0,L.tZ)("span",{id:`hidden-span-${e}`,css:(0,L.iv)({visibility:"hidden",position:"fixed",top:r,left:o,width:1,height:1},"","")})),document.body)},V=(0,m.forwardRef)(Q),q={annotationData:p().object,actions:p().object,chartId:p().number.isRequired,datasource:p().object,initialValues:p().object,formData:p().object.isRequired,latestQueryFormData:p().object,labelColors:p().object,sharedLabelColors:p().object,height:p().number,width:p().number,setControlValue:p().func,vizType:p().string.isRequired,triggerRender:p().bool,chartAlert:p().string,chartStatus:p().string,queriesResponse:p().arrayOf(p().object),triggerQuery:p().bool,chartIsStale:p().bool,addFilter:p().func,setDataMask:p().func,onFilterMenuOpen:p().func,onFilterMenuClose:p().func,ownState:p().object,postTransformProps:p().func,source:p().oneOf([n.Dashboard,n.Explore]),emitCrossFilters:p().bool},W={},H=[F.cg.INTERACTIVE_CHART],Y={addFilter:()=>W,onFilterMenuOpen:()=>W,onFilterMenuClose:()=>W,initialValues:W,setControlValue(){},triggerRender:!1};class K extends m.Component{constructor(e){super(e),this.state={showContextMenu:e.source===n.Dashboard&&(0,k.c)(k.T.DRILL_TO_DETAIL),inContextMenu:!1},this.hasQueryResponseChange=!1,this.contextMenuRef=m.createRef(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.trclick=this.trclick.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)}}}shouldComponentUpdate(e,t){var a,n;return!(!(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1)||null!=(a=e.queriesResponse)&&null!=(n=a[0])&&n.error)&&(!E()(this.state,t)||(this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange||!E()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelColors!==this.props.labelColors||e.sharedLabelColors!==this.props.sharedLabelColors||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters))}handleAddFilter(e,t,a=!0,n=!0,l=!1){this.props.addFilter(e,t,a,n,l)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:a,vizType:n}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(a),this.hasQueryResponseChange&&e.logEvent(R.aD,{slice_id:a,viz_type:n,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:R.Yd.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:a,chartId:n}=this.props;y.Z.warn(e),a.chartRenderingFailed(e.toString(),n,t?t.componentStack:null),this.hasQueryResponseChange&&a.logEvent(R.aD,{slice_id:n,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:R.Yd.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,a){this.contextMenuRef.current.open(e,t,a),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}trclick(e){const{actions:t,formData:a,queriesResponse:n,runQuery:l,chartStatus:i,charts:o,chartId:r}=this.props,s=e.target;if(a.drillDown&&("TD"===s.tagName||"SPAN"===s.parentNode.firstChild.tagName)&&("rendered"===i||"success"===i)){let e=o[r].filters||[];const i={col:n[0].colnames[0],op:"IN",val:null==s?void 0:s.textContent};e.push(i);let d=[a.groupby[e.length]];e.length===a.groupby.length&&(d=[],e=[]),t.chartFilter(e,d,r),l()}}render(){var e;const{chartAlert:t,chartStatus:a,chartId:l,emitCrossFilters:i}=this.props;if("loading"===a||t||null===a)return null;this.renderStartTime=R.Yd.getTimestamp();const{width:o,height:r,datasource:s,annotationData:c,initialValues:u,ownState:h,filterState:p,chartIsStale:f,formData:v,latestQueryFormData:y,queriesResponse:b,postTransformProps:w}=this.props,k=f&&y?y:v,x=k.viz_type||this.props.vizType,Z=j()(x),S="table"===x?`superset-chart-${Z}`:Z;let D;const O=(0,g.t)("No results were returned for this query"),T=this.props.source===n.Explore?(0,g.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,_="chart.svg";D=o>300&&r>220?(0,L.tZ)(C.XJ,{title:O,description:T,image:_}):(0,L.tZ)(C.Tc,{title:O,image:_});const M=null!=(e=(0,$.Z)().get(v.viz_type))&&e.behaviors.find((e=>e===F.cg.DRILL_TO_DETAIL))?{inContextMenu:this.state.inContextMenu}:{};return(0,L.tZ)(m.Fragment,null,this.state.showContextMenu&&(0,L.tZ)(V,{ref:this.contextMenuRef,id:l,formData:k,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,L.tZ)("div",{"aria-hidden":"true",onClick:e=>this.trclick(e),onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0},(0,L.tZ)(A.Z,d()({disableErrorBoundary:!0,key:`${l}`,id:`chart-id-${l}`,className:S,chartType:x,width:o,height:r,annotationData:c,datasource:s,initialValues:u,formData:k,ownState:h,filterState:p,hooks:this.hooks,behaviors:H,queriesData:b,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:D,postTransformProps:w,emitCrossFilters:i},M))))}}K.propTypes=q,K.defaultProps=Y;const J=K;var G=a(442582),X=a(272875);const ee=({chartId:e,error:t,...a})=>{const{result:n}=(0,G.hb)(e),l=t&&{...t,extra:{...t.extra,owners:n}};return(0,L.tZ)(X.Z,d()({},a,{error:l}))};var te=a(599543),ae=a(775701);const ne={annotationData:p().object,actions:p().object,chartId:p().number.isRequired,datasource:p().object,dashboardId:p().number,initialValues:p().object,formData:p().object.isRequired,labelColors:p().object,sharedLabelColors:p().object,width:p().number,height:p().number,setControlValue:p().func,timeout:p().number,vizType:p().string.isRequired,triggerRender:p().bool,force:p().bool,isFiltersInitialized:p().bool,isDeactivatedViz:p().bool,chartAlert:p().string,chartStatus:p().string,chartStackTrace:p().string,queriesResponse:p().arrayOf(p().object),triggerQuery:p().bool,chartIsStale:p().bool,errorMessage:p().node,addFilter:p().func,onQuery:p().func,onFilterMenuOpen:p().func,onFilterMenuClose:p().func,ownState:p().object,postTransformProps:p().func,datasetsStatus:p().oneOf(["loading","error","complete"]),isInView:p().bool,emitCrossFilters:p().bool},le={},ie=(0,g.t)("The dataset associated with this chart no longer exists"),oe={addFilter:()=>le,onFilterMenuOpen:()=>le,onFilterMenuClose:()=>le,initialValues:le,setControlValue(){},triggerRender:!1,dashboardId:null,chartStackTrace:null,isDeactivatedViz:!1,force:!1,isInView:!0},re=f.iK.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
  }

  .slice_container {
    height: ${e=>e.height}px;
    //overflow: auto;  // 饼图会出现滚动条
    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.gridUnit}px;
    }
  }
`,se=f.iK.div`
  font-family: ${({theme:e})=>e.typography.families.monospace};
  word-break: break-word;
  overflow-x: auto;
  white-space: pre-wrap;
`;class de extends m.PureComponent{constructor(e){var t;super(e),this.runQuery=()=>{this.props.chartId>0&&(0,w.cr)(k.T.CLIENT_CACHE)?this.props.actions.getSavedChart(this.props.formData,this.props.force||(0,O.eY)(D.KD.force),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState,this.props.charts):this.props.actions.postChartFormData(this.props.formData,this.props.force||(0,O.eY)(D.KD.force),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState,this.props.charts)},this.getBreadcrumbItem=()=>{const{charts:e,formData:t,chartId:a}=this.props,n=[{id:0,name:t.groupby[0],val:t.groupby[0]}];return e[a].filters&&e[a].filters.forEach(((e,a)=>{n.push({id:a+1,name:e.val,val:t.groupby[a+1]})})),n},this.handBreadcrumb=e=>{const{charts:t,formData:a,chartId:n,actions:l}=this.props;if(t[n].filters&&t[n].filters.length>0&&t[n].groupbys[0]!==e){const i=[e],o=a.groupby.indexOf(e),r=t[n].filters.slice(0,o);l.chartFilter(r,i,n),this.runQuery()}},this.state={filterMask:(null==e||null==(t=e.formData)?void 0:t.dataMask)||{}},this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){var e;if(null!=(e=this.props.formData)&&e.drillDown){const e=v.Z.fromHierarchy(this.props.formData.groupby);this.props.actions.updateDataMask(this.props.chartId,{ownState:{drilldown:e}})}this.props.triggerQuery&&"UNDECIDED"!==this.props.filterboxMigrationState&&this.runQuery()}componentDidUpdate(e){var t,a,n;if(e.formData.drillDown!==this.props.formData.drillDown&&this.props.actions.removeChartFilter(this.props.chartId),null!=(t=this.props.formData)&&t.drillDown&&(null==(a=e.formData)||!a.drillDown)){const e=v.Z.fromHierarchy(this.props.formData.groupby);this.props.actions.updateDataMask(this.props.chartId,{ownState:{drilldown:e}})}const{dashboardState:l}=this.props,i=u()(e.formData);delete i.label_colors;const o=u()(this.props.formData);delete o.label_colors;const r=!(0,te.JB)(i,o),s=(null==(n=this.props)?void 0:n.dataMask)||{},d=this.state.filterMask||{};let c=!1;if(Object.keys(s).length!=Object.keys(d).length?c=!0:Object.keys(s).forEach((e=>{var t,a;const n=s[e],l=d[e];e.indexOf("NATIVE_FILTER")>-1&&JSON.stringify(null==n||null==(t=n.filterState)?void 0:t.value)!==JSON.stringify(null==l||null==(a=l.filterState)?void 0:a.value)&&(c=!0)})),this.props.triggerQuery&&"UNDECIDED"!==this.props.filterboxMigrationState){if(this.props.isDeactivatedViz&&this.props.queriesResponse)return;this.runQuery()}this.props.dashboardState.editMode&&c&&r&&this.setState({filterMask:s},(()=>{this.runQuery()}))}handleRenderContainerFailure(e,t){const{actions:a,chartId:n}=this.props;y.Z.warn(e),a.chartRenderingFailed(e.toString(),n,t?t.componentStack:null),a.logEvent(R.aD,{slice_id:n,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:R.Yd.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:a,chartAlert:l,chartStackTrace:i,datasource:o,dashboardId:r,height:s,datasetsStatus:d}=this.props,c=null==e||null==(t=e.errors)?void 0:t[0],u=l||(null==e?void 0:e.message);return void 0!==l&&l!==ie&&o===x.tw&&d!==_.ni.ERROR?(0,L.tZ)(re,{key:a,"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:s},(0,L.tZ)(Z.Z,null)):(0,L.tZ)(ee,{key:a,chartId:a,error:c,subtitle:(0,L.tZ)(se,null,u),copyText:u,link:e?e.link:null,source:r?n.Dashboard:n.Explore,stackTrace:i})}render(){const{formData:e,height:t,chartAlert:a,chartStatus:n,errorMessage:l,chartIsStale:i,queriesResponse:o=[],isDeactivatedViz:r=!1,ownState:s,vizType:c,width:u}=this.props,h="loading"===n;if(this.renderContainerStartTime=R.Yd.getTimestamp(),"failed"===n)return o.map((e=>this.renderErrorMessage(e)));if(l&&0===(0,b.Z)(o).length)return(0,L.tZ)(C.XJ,{title:(0,g.t)("Add required control values to preview chart"),description:(0,ae.J)(!0),image:"chart.svg"});if(!h&&!a&&!l&&i&&0===(0,b.Z)(o).length)return(0,L.tZ)(C.XJ,{title:(0,g.t)("Your chart is ready to go!"),description:(0,L.tZ)("span",null,(0,g.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,L.tZ)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery},(0,g.t)("click here")),"."),image:"chart.svg"});let p=null,m={};return null!=e&&e.forecastDisplayExternal&&null!=e&&e.forecastPeriodExternal&&"2"===`${null==e?void 0:e.forecastTodoMethod}`&&(p="\u6570\u636e\u9884\u6d4b\u53ef\u80fd\u9700\u8981\u8f83\u957f\u65f6\u95f4\uff0c\u8bf7\u7b49\u5f85...",m={width:300}),(0,L.tZ)(S.Z,{onError:this.handleRenderContainerFailure,showMessage:!1},(0,L.tZ)(re,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:t,width:u},(e.drillDown||(null==s?void 0:s.drilldown))&&"table"===c&&o&&o.length>0&&(0,L.tZ)(M.O5,null,this.getBreadcrumbItem().map((e=>(0,L.tZ)(M.O5.Item,{onClick:()=>this.handBreadcrumb(e.val)},e.name)))),(0,L.tZ)("div",{className:"slice_container","data-test":"slice-container"},this.props.isInView||!(0,w.cr)(k.T.DASHBOARD_VIRTUALIZATION)||(0,T.b)()?(0,L.tZ)(J,d()({},this.props,{runQuery:this.runQuery,source:this.props.dashboardId?"dashboard":"explore","data-test":this.props.vizType})):(0,L.tZ)(Z.Z,null)),h&&!r&&(0,L.tZ)(Z.Z,{tip:p,style:m})))}}de.propTypes=ne,de.defaultProps=oe;const ce=de;var ue=a(174599);const he=(0,l.$j)((function({charts:e,dashboardState:t,dataMask:a}){return{dashboardState:t,charts:e,dataMask:a}}),(function(e){return{actions:(0,i.DE)({...o,updateDataMask:ue.updateDataMask,logEvent:r.logEvent},e)}}))(ce)},755961:(e,t,a)=>{"use strict";a.d(t,{Z:()=>k});var n=a(150361),l=a.n(n),i=a(667294),o=a(748086),r=a(99210),s=a(455867),d=a(211965),c=a(828216),u=a(456727),h=a(685832),p=a(933691),m=a(813858),g=a(797381),f=a(112515),v=a(920292),y=a(203741),b=a(81255);const w=(0,v.Z)(),k=e=>{const{position:t,viz_type:a,selectorString:n,downLoadTitle:v,slice:k,latestQueryFormData:x={}}=e,Z=(0,c.I0)(),C=(0,c.v9)((e=>e)),{charts:S,sliceEntities:R,datasources:D,explore:O,dashboardLayout:T}=C,_=(null==T?void 0:T.present)||{},M=(null==R?void 0:R.slices)||{},I=(null==k?void 0:k.slice_id)||0,E=null==S?void 0:S[I],z=(null==E?void 0:E.latestQueryFormData)||x,j=w.common.conf.CHART_EXPORT_MAX_LIMIT||null,F=["pivot_table","pivot_table_v2"],$=e=>{if("dashbord"===t){let t=document.getElementsByClassName("header-controls");for(let a=0;a<t.length;a++)t[a].setAttribute("style",`display:${e}`)}else if("dashbord-chart-single"===t){let t=document.getElementsByClassName(`dashboard-chart-id-${I}`);for(let a=0;a<t.length;a++){let n=t[a].getElementsByClassName("header-controls");for(let t=0;t<n.length;t++)n[t].setAttribute("style",`display:${e}`)}}},A=e=>{const a=t=>{let a=document.getElementsByClassName(t);for(let t=0;t<a.length;t++)a[t].setAttribute("style","display:"+("hidden"===e?"none":""))};["chart-edit","dashbord"].includes(t)&&(a("ant-dropdown-menu-submenu-placement-leftTop"),a("ant-dropdown ant-dropdown-placement-bottomRight")),a("ant-dropdown-menu-submenu ant-dropdown-menu-submenu-popup ant-dropdown-menu ant-dropdown-menu-light"),["dashbord-chart-single"].includes(t)&&a("ant-dropdown-menu-submenu ant-dropdown-menu-submenu-popup ant-dropdown-menu ant-dropdown-menu-light"),a("ant-dropdown-menu ant-dropdown-menu-light ant-dropdown-menu-root ant-dropdown-menu-vertical")};let L={};return"dashbord"===t&&(L={overflow:"hidden"}),(0,d.tZ)("div",{className:"div-xxx",style:L},(0,d.tZ)(d.xB,{styles:d.iv`
          // 覆盖全局的样式
          .div-xxx .ant-menu.ant-menu-dark,
          .div-xxx .ant-menu-dark .ant-menu-item,
          .div-xxx .ant-menu-submenu,
          .div-xxx .ant-layout-sider-children .ant-input-search-button svg {
            color: #000 !important;
          }
          .div-xxx .ant-menu-submenu-title:hover {
            color: #000 !important;
          }
          // 处理看板页面导出样式问题
          ${"dashbord"===t&&" \n          .div-xxx .ant-menu-root.ant-menu-vertical{\n            margin-left: -7px; \n          }\n          .div-xxx .ant-menu-submenu-active, .div-xxx .ant-menu-item-active {\n            color: #000 !important;\n            background: #f5f5f5 !important;\n          }\n        "}
        `}),(0,d.tZ)(r.Z,null,(0,d.tZ)(r.Z.Item,{onClick:e=>{(e=>{$("none"),A("hidden"),(0,u.Z)(n,v,!0)(e).then((()=>{A("visible"),$("flex")})),Z((0,g.logEvent)(y.n2))})(e)}},(0,s.t)("Download as image")),(0,d.tZ)(r.Z.Item,{onClick:e=>{(e=>{A("hidden"),$("none"),(0,h.Z)(n,v,!0)(e).then((()=>{A("visible"),$("flex")})),Z((0,g.logEvent)(y.Kr))})(e)}},(0,s.t)("Download as pdf")),(0,d.tZ)(r.Z.Item,{onClick:e=>{(e=>{if(A("hidden"),$("none"),["dashbord"].includes(t))if(Object.keys(_).length&&Object.keys(_).length){const t=Object.values(S),a=t.length?t.filter((e=>"rendered"===e.chartStatus)):[],n=a.length?a.map((e=>e.id)):[],l=Array.from(Object.values(M),(e=>({key:e.slice_id,id:`.dashboard-chart-id-${e.slice_id}`,name:e.slice_name}))).filter((e=>n.includes(e.key))),i=[b.Mg,b.qu,b.Q7,b.xh,b.Ce,b.t],o=[...l,...Object.values(_).filter((e=>i.includes(null==e?void 0:e.type))).map((e=>{var t;return{id:`#${e.id}`,key:`${e.id}`,name:null==e||null==(t=e.meta)?void 0:t.sliceName}}))];(0,p.Z)(o,v,!0)(e).then((()=>{A("visible"),$("flex")})),Z((0,g.logEvent)(y.CQ))}else o.ZP.warning((0,s.t)("The current dashboard is empty, please add a chart first"));else(0,p.Z)(n,v,!0)(e).then((()=>{A("visible"),$("flex")})),Z((0,g.logEvent)(y.CQ))})(e)}},(0,s.t)("Download as ppt")),a?F.includes(a)?(0,d.tZ)(i.Fragment,null,(0,d.tZ)(r.Z.SubMenu,{title:(0,s.t)("Download as CSV file")},(0,d.tZ)(r.Z.Item,{onClick:()=>{(0,f.pe)({formData:z,resultType:"post_processed",resultFormat:"csv"})}},(0,s.t)("Download as configured")),(0,d.tZ)(r.Z.Item,{onClick:()=>{(()=>{const e={...z,row_limit:j};(0,f.pe)({formData:e,resultType:"post_processed",resultFormat:"csv"})})()}},(0,s.t)("Download in full")))):(0,d.tZ)(r.Z.Item,{onClick:()=>{(0,f.pe)({formData:z,ownState:{},resultType:"full",resultFormat:"csv"})}},(0,s.t)("Download as CSV file")):null,F.includes(a)?(0,d.tZ)(i.Fragment,null,(0,d.tZ)(r.Z.SubMenu,{title:(0,s.t)("Download as excel")},(0,d.tZ)(r.Z.Item,{onClick:()=>{(0,f.pe)({formData:z,resultType:"results",resultFormat:"xlsx"})}},(0,s.t)("Download as configured")),(0,d.tZ)(r.Z.Item,{onClick:()=>{(()=>{const e={...z,row_limit:j};(0,f.pe)({formData:e,resultType:"results",resultFormat:"xlsx"})})()}},(0,s.t)("Download in full")))):(0,d.tZ)(r.Z.Item,{onClick:()=>{(()=>{if("dashbord"===t){const e={excelTitle:"\u770b\u677f-"+v,charts:S,sliceEntities:M,selector:".dashboard",datasources:D};(0,m.Z)(e)}else if(a){const e=l()(S)[I];if(e){e.form_data=(null==k?void 0:k.form_data)||(null==O?void 0:O.form_data);const a={excelTitle:"\u56fe\u8868-"+v,charts:{[I]:e},sliceEntities:{[I]:k||{}},selector:`#chart-id-${I}`,datasources:D,position:t};(0,m.Z)(a)}}})()}},(0,s.t)("Download as excel")),["chart-preview","chart-edit"].includes(t)?(0,d.tZ)(r.Z.Item,{onClick:()=>{(0,f.pe)({formData:z,resultType:"results",resultFormat:"json"})}},(0,s.t)("Download as JSON file")):null))}},813858:(e,t,a)=>{"use strict";a.d(t,{Z:()=>f});var n=a(474295),l=a(748086),i=a(519650),o=a(701474),r=a(461120),s=a.n(r),d=a(427600),c=a(455867),u=a(751995),h=a(751115),p=a(642846),m=a(182608),g=a(211965);function f(e={}){const{excelTitle:t,charts:a={},sliceEntities:r={},selector:f=".dashboard",datasources:v,position:y}=e,b=new n.Workbook,w=Object.keys(a).map((e=>"chart-preview"===y?{...r[e],...a[e]}:a[e])),k=document.querySelector(f);if(!k)return l.ZP.error((0,c.t)("Image download failed, please refresh and try again."));const x=k.offsetWidth,Z=k.offsetHeight;s()(k,{scale:d.go,width:x,backgroundColor:u.K6.colors.grayscale.light4,heigth:Z,useCORS:!0}).then((e=>{const a=e.toDataURL("image/png",1);let n=[];(0,m.Jx)().then((e=>{(0,m.Qf)(a,"",e.watermarkText,e.fontSize,e.spacing,e.fontColor,e.angle,e.opacity).then((e=>{let a=e;const l=b.addWorksheet(t);n.push(t);const s=a,d=b.addImage({base64:s,extension:"jpeg"});l.addImage(d,{tl:{col:0,row:1},ext:{width:x||900,height:Z||400}}),w.map(((e,t)=>{var a,l,s,d,c;let u=null==(a=r[(null==e?void 0:e.id)||(null==e?void 0:e.slice_id)])?void 0:a.slice_name;if(!u&&"#chart-id-0"!==f)return;n.includes(u)&&(u=`${u}(${t})`),n.push(u);const m=u,y=b.addWorksheet(m,{properties:{defaultRowHeight:25}});y.pageSetup.horizontalCentered=!0,y.pageSetup.verticalCentered=!0;const w=(null==e||null==(l=e.queriesResponse)||null==(s=l[0])?void 0:s.data)||[],k=v[null==e||null==(d=e.form_data)?void 0:d.datasource],x=((null==k?void 0:k.columns)||[]).filter((e=>"DATETIME"===(null==e?void 0:e.type))).map((e=>null==e?void 0:e.column_name));x.length>0&&((null==e?void 0:e.queriesResponse)||[]).forEach((e=>{const t=(null==e?void 0:e.data)||[],a=(null==t?void 0:t[0])||{};if(!Array.isArray(a)){let e=!1;Object.keys(a).forEach((t=>{x.includes(t)&&(e=!0)})),e&&t.forEach((e=>{Object.keys(e).forEach((t=>{if(x.includes(t)){const a=(0,h.bt)(p.Z.DATABASE_DATETIME);e[t]=a(e[t])}}))}))}}));const Z=null==e||null==(c=e.form_data)?void 0:c.viz_type;if("table"===Z||"excel_table"===Z)y.columns=Object.keys((null==w?void 0:w[0])||{}).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("echarts_timeseries_bar"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("radar"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("para"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("word_cloud"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("tree_chart"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("echarts_timeseries_step"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("echarts_timeseries_scatter"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("gauge_chart"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("funnel"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("handlebars"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("graph_chart"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("echarts_timeseries_smooth"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("country_map"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("world_map"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("mixed_timeseries"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("sankey"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("box_plot"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("sunburst"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("big_number_total"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("pivot_table_v2"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("big_number"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("number_component"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("echarts_timeseries_line"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("pie"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("treemap"===Z){var C,S;y.columns=Object.keys(null==w||null==(C=w[0].children)||null==(S=C[0].children)?void 0:S[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{e.children.map((e=>{e.children.map((e=>{y.addRow(e)}))}))}))}else if("heatmap"===Z){var R;y.columns=Object.keys(null==(R=w.records)?void 0:R[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.records.map((e=>{y.addRow(e)}))}else if("bubble"===Z){var D;y.columns=Object.keys(null==w||null==(D=w[0].values)?void 0:D[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),null==w||w[0].values.map((e=>{y.addRow(e)}))}else if("dist_bar"===Z){var O;y.columns=Object.keys(null==w||null==(O=w[0].values)?void 0:O[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("dual_line"===Z){var T;y.columns=Object.keys(null==w||null==(T=w[0].values)?void 0:T[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("area"===Z){var _;y.columns=Object.keys(null==w||null==(_=w[0].values)?void 0:_[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("line_multi"===Z){var M;y.columns=Object.keys(null==w||null==(M=w[0].values)?void 0:M[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("bar"===Z){var I;y.columns=Object.keys(null==w||null==(I=w[0].values)?void 0:I[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("line"===Z){var E;y.columns=Object.keys(null==w||null==(E=w[0].values)?void 0:E[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("horizon"===Z){var z;y.columns=Object.keys(null==w||null==(z=w[0].values)?void 0:z[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w[0].values.map((e=>{y.addRow(e)}))}else if("deck_scatter"===Z){var j;y.columns=Object.keys(null==(j=w.features)?void 0:j[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_grid"===Z){var F;y.columns=Object.keys(null==(F=w.features)?void 0:F[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_hex"===Z){var $;y.columns=Object.keys(null==($=w.features)?void 0:$[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_polygon"===Z){var A;y.columns=Object.keys(null==(A=w.features)?void 0:A[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_arc"===Z){var L;y.columns=Object.keys(null==(L=w.features)?void 0:L[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_path"===Z){var N;y.columns=Object.keys(null==(N=w.features)?void 0:N[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_screengrid"===Z){var P;y.columns=Object.keys(null==(P=w.features)?void 0:P[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("deck_multi"===Z){var B;y.columns=Object.keys(null==(B=w.features)?void 0:B[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.features.map((e=>{y.addRow(e)}))}else if("correlation_analysis"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("scatter_clustering"===Z)y.columns=Object.keys(null==w?void 0:w[0]).map((e=>({header:e,key:e,width:25,style:{alignment:{vertical:"middle",horizontal:"center"}}}))),w.map((e=>{y.addRow(e)}));else if("pivot_table"===Z)return void(0,g.tZ)(i.Z,{direction:"vertical",style:{width:"100%"}},(0,g.tZ)(o.Z,{message:"Error Text",type:"error"}),";")})),b.xlsx.writeBuffer().then((e=>{c(`${t}.xlsx`,e)}));const c=(e,t)=>{let a=document.createElement("a"),n=new Blob([t],{type:"text/plain"});a.download=e,a.href=URL.createObjectURL(n),a.click()}}))}))}))}},182608:(e,t,a)=>{"use strict";a.d(t,{Jx:()=>r,Qf:()=>s,e_:()=>d});var n=a(121804),l=a.n(n),i=a(431069);const o=(e,t=new Date)=>`${l()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`,r=async()=>{try{const e=await i.Z.get({endpoint:"/api/v2/sys/config?type=WATER_MARK"}),t=e.json.meta.data.TEXT,a=e.json.meta.data.SIZE,n=e.json.meta.data.SPACE,l=e.json.meta.data.COLOR,o=e.json.meta.data.ANGLE,r={watermarkText:t,fontSize:a,spacing:n,fontColor:l,angle:o,opacity:e.json.meta.data.OPACITY};return Promise.resolve(r)}catch(e){return null}};function s(e,t,a,n,l,i,r,s){return new Promise((d=>{const c=document.createElement("canvas"),u=c.getContext("2d"),h=new Image;h.onload=()=>{c.width=h.width,c.height=h.height,u.drawImage(h,0,0),u.font=`${n}px Arial`,u.fillStyle=i,u.textBaseline="bottom",u.translate(c.width/2,c.height/2),u.rotate(-r*Math.PI/180);const e=Math.ceil(c.width/l),p=Math.ceil(c.height/l);for(let t=-p;t<p;t++)for(let n=-e;n<e;n++){const e=n*l,i=t*l;u.globalAlpha=s,u.fillText(a,e,i)}u.rotate(r*Math.PI/180),u.translate(-c.width/2,-c.height/2);const m=document.createElement("a");m.download=`${o(t)}.jpg`,m.href=c.toDataURL("image/jpeg",1),d(m.href)},h.src=e}))}function d(e,t,a,n,l,i,o){const r=document.createElement("canvas"),s=r.getContext("2d"),d=s.measureText(t).width,c=a,u=e.internal.pageSize.getWidth(),h=e.internal.pageSize.getHeight(),p=Math.floor(u/(d+n)),m=Math.floor(h/(c+n));r.width=u,r.height=h,s.font=`${a}px Arial`,s.fillStyle=l,s.globalAlpha=o,s.rotate(-Math.PI/180*i);for(let a=1;a<=e.internal.getNumberOfPages();a++){e.setPage(a);for(let e=0;e<m;e++)for(let a=0;a<p;a++){const l=a*(d+n),i=e*(c+n);s.fillText(t,l,i)}const l=r.toDataURL();e.addImage(l,"PNG",0,0,u,h),s.clearRect(0,0,u,h)}}},345671:(e,t,a)=>{"use strict";a.d(t,{p:()=>ie});var n=a(205872),l=a.n(n),i=a(441609),o=a.n(i),r=a(667294),s=a(455867),d=a(211965),c=a(751995),u=a(311064),h=a(616355),p=a(569363),m=a(683862),g=a(731293),f=a(358593),v=a(616550),y=a(774069),b=a(835932),w=a(828216),k=a(637936),x=a(88889),Z=a(355786),C=a(899612),S=a(838703),R=a(427600);const D=function({value:e}){return(0,d.tZ)("span",null,e?R.Ly:R.gz)};const O=function(){return(0,d.tZ)("span",{css:e=>d.iv`
          color: ${e.colors.grayscale.light1};
        `},R.Wq)};var T=a(642846),_=a(751115);const M=function({format:e=T.Z.DATABASE_DATETIME,value:t}){return t?(0,d.tZ)("span",null,(0,_.bt)(e).format(t)):(0,d.tZ)(O,null)};var I=a(94301),E=a(935500),z=a(493197),j=a(159507),F=a(229487),$=a(442582),A=a(287183),L=a(49937),N=a(976697);const P=function(e){const{headerTitle:t,groupTitle:a,groupOptions:n,value:l,onChange:i}=e,o=(0,c.Fg)(),[s,u]=(0,r.useState)(!1);return(0,d.tZ)("div",{css:d.iv`
        display: flex;
        align-items: center;
      `},(0,d.tZ)(N.ZP,{trigger:"click",visible:s,content:(0,d.tZ)("div",null,(0,d.tZ)("div",{css:d.iv`
                font-weight: ${o.typography.weights.bold};
                margin-bottom: ${o.gridUnit}px;
              `},a),(0,d.tZ)(A.Y.Group,{value:l,onChange:e=>{i(e.target.value),u(!1)}},(0,d.tZ)(L.T,{direction:"vertical"},n.map((e=>(0,d.tZ)(A.Y,{key:e.value,value:e.value},e.label)))))),placement:"bottomLeft",arrowPointAtCenter:!0},(0,d.tZ)(g.Z.SettingOutlined,{iconSize:"m",iconColor:o.colors.grayscale.light1,css:d.iv`
            margin-top: 3px; // we need exactly 3px to align the icon
            margin-right: ${o.gridUnit}px;
          `,onClick:()=>u(!0)})),t)};var B=a(560331),U=a(472813),Q=a(989555);function V({filters:e,setFilters:t,totalCount:a,loading:n,onReload:l}){const i=(0,c.Fg)(),o=(0,r.useMemo)((()=>Object.assign({},...e.map((e=>({[(0,U.GA)(e.col)?e.col.label:e.col]:e}))))),[e]),u=(0,r.useCallback)((e=>{const a={...o};delete a[e],t([...Object.values(a)])}),[o,t]),h=(0,r.useMemo)((()=>Object.entries(o).map((([e,{val:t,formattedVal:a}])=>({colName:e,val:null!=a?a:t}))).sort(((e,t)=>e.colName.localeCompare(t.colName)))),[o]);return(0,d.tZ)("div",{css:d.iv`
        display: flex;
        justify-content: space-between;
        padding: ${i.gridUnit/2}px 0;
        margin-bottom: ${2*i.gridUnit}px;
      `},(0,d.tZ)("div",{css:d.iv`
          display: flex;
          flex-wrap: wrap;
          margin-bottom: -${4*i.gridUnit}px;
        `},h.map((({colName:e,val:t})=>(0,d.tZ)(B.Z,{closable:!0,onClose:u.bind(null,e),key:e,css:d.iv`
              height: ${6*i.gridUnit}px;
              display: flex;
              align-items: center;
              padding: ${i.gridUnit/2}px ${2*i.gridUnit}px;
              margin-right: ${4*i.gridUnit}px;
              margin-bottom: ${4*i.gridUnit}px;
              line-height: 1.2;
            `,"data-test":"filter-col"},(0,d.tZ)("span",{css:d.iv`
                margin-right: ${i.gridUnit}px;
              `},e),(0,d.tZ)("strong",{"data-test":"filter-val"},t))))),(0,d.tZ)("div",{css:d.iv`
          display: flex;
          align-items: center;
          height: min-content;
        `},(0,d.tZ)(Q.Z,{loading:n&&!a,rowcount:a}),(0,d.tZ)(g.Z.ReloadOutlined,{iconColor:i.colors.grayscale.light1,iconSize:"l","aria-label":(0,s.t)("Reload"),role:"button",onClick:l})))}var q=a(786276);const W=50;var H,Y={name:"82a6rk",styles:"flex:1"};function K({children:e}){const{ref:t,height:a}=(0,C.NB)();return(0,d.tZ)("div",{ref:t,css:Y},r.cloneElement(e,{height:a}))}function J({formData:e,initialFilters:t}){const a=(0,c.Fg)(),[n,l]=(0,r.useState)(0),i=(0,r.useRef)(n),[o,u]=(0,r.useState)(t),[h,p]=(0,r.useState)(!1),[m,g]=(0,r.useState)(""),[f,v]=(0,r.useState)(new Map),[y,b]=(0,r.useState)({}),k=(0,w.v9)((e=>e.common.conf.SAMPLES_ROW_LIMIT)),[C,R]=(0,r.useMemo)((()=>e.datasource.split("__")),[e.datasource]),T=(0,r.useMemo)((()=>{const e=f.get(n);return e?(i.current=n,e):f.get(i.current)}),[n,f]),_=(0,r.useMemo)((()=>(null==T?void 0:T.colNames.map(((e,t)=>({key:e,dataIndex:e,title:(null==T?void 0:T.colTypes[t])===x.Z.TEMPORAL?(0,d.tZ)(P,{headerTitle:e,groupTitle:(0,s.t)("Formatting"),groupOptions:[{label:(0,s.t)("Original value"),value:H.Original},{label:(0,s.t)("Formatted value"),value:H.Formatted}],value:y[e]===H.Original?H.Original:H.Formatted,onChange:t=>b((a=>({...a,[e]:t})))}):e,render:a=>!0===a||!1===a?(0,d.tZ)(D,{value:a}):null===a?(0,d.tZ)(O,null):(null==T?void 0:T.colTypes[t])===x.Z.TEMPORAL&&y[e]!==H.Original&&("number"===typeof a||a instanceof Date)?(0,d.tZ)(M,{value:a}):String(a),width:150}))))||[]),[null==T?void 0:T.colNames,null==T?void 0:T.colTypes,y]),A=(0,r.useMemo)((()=>(null==T?void 0:T.data.map(((e,t)=>null==T?void 0:T.colNames.reduce(((t,a)=>({...t,[a]:e[a]})),{key:t}))))||[]),[null==T?void 0:T.colNames,null==T?void 0:T.data]),L=(0,r.useCallback)((()=>{g(""),v(new Map),l(0)}),[]);(0,r.useEffect)((()=>{g(""),v(new Map),l(0)}),[o]),(0,r.useEffect)((()=>{if(f.has(n)&&[...f.keys()].at(-1)!==n){const e=new Map(f);e.delete(n),v(e.set(n,f.get(n)))}}),[n,f]),(0,r.useEffect)((()=>{if(!m&&!h&&!f.has(n)){var t;p(!0);const a=null!=(t=(0,q.w)(e,o))?t:{},l=Math.ceil(k/W);(0,E.getDatasourceSamples)(R,C,!1,a,W,n+1).then((e=>{v(new Map([...[...f.entries()].slice(1-l),[n,{total:e.total_count,data:e.data,colNames:(0,Z.Z)(e.colnames),colTypes:(0,Z.Z)(e.coltypes)}]])),g("")})).catch((e=>{g(`${e.name}: ${e.message}`)})).finally((()=>{p(!1)}))}}),[k,C,R,o,e,h,n,m,f]);const N=(0,$.s_)(`/api/v1/dataset/${C}`),B=!m&&!f.size||"loading"===N.status;let U=null;if(m)U=(0,d.tZ)("pre",{css:d.iv`
          margin-top: ${4*a.gridUnit}px;
        `},m);else if(B)U=(0,d.tZ)(S.Z,null);else if(0===(null==T?void 0:T.total)){const e=(0,s.t)("No rows were returned for this dataset");U=(0,d.tZ)(I.x3,{image:"document.svg",title:e})}else U=(0,d.tZ)(K,null,(0,d.tZ)(z.ZP,{data:A,columns:_,size:z.ex.SMALL,defaultPageSize:W,recordCount:null==T?void 0:T.total,usePagination:!0,loading:h,onChange:e=>l(e.current?e.current-1:0),resizable:!0,virtualize:!0}));const Q=(0,r.useMemo)((()=>{const{status:e,result:t}=N,n=[];if(t){var l,i;const{changed_on_humanized:e,created_on_humanized:a,description:o,table_name:r,changed_by:d,created_by:c,owners:u}=t,h=(0,s.t)("Not available"),p=`${null!=(l=null==c?void 0:c.first_name)?l:""} ${null!=(i=null==c?void 0:c.last_name)?i:""}`.trim()||h,m=d?`${d.first_name} ${d.last_name}`:h,g=u.length>0?u.map((e=>`${e.first_name} ${e.last_name}`)):[h];n.push({type:j.pG.TABLE,title:r}),n.push({type:j.pG.LAST_MODIFIED,value:e,modifiedBy:m}),n.push({type:j.pG.OWNER,createdBy:p,owners:g,createdOn:a}),o&&n.push({type:j.pG.DESCRIPTION,value:o})}return(0,d.tZ)("div",{css:d.iv`
          display: flex;
          margin-bottom: ${4*a.gridUnit}px;
        `},"complete"===e&&(0,d.tZ)(j.ZP,{items:n,tooltipPlacement:"bottom"}),"error"===e&&(0,d.tZ)(F.Z,{type:"error",message:(0,s.t)("There was an error loading the dataset metadata")}))}),[N,a.gridUnit]);return(0,d.tZ)(r.Fragment,null,!B&&Q,!B&&(0,d.tZ)(V,{filters:o,setFilters:u,totalCount:null==T?void 0:T.total,loading:h,onReload:L}),U)}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(H||(H={}));const G=({exploreChart:e,closeModal:t})=>(0,d.tZ)(r.Fragment,null,(0,d.tZ)(b.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:e},(0,s.t)("Edit chart")),(0,d.tZ)(b.Z,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drilltodetail-modal"},(0,s.t)("Close")));function X({chartId:e,formData:t,initialFilters:a,showModal:n,onHideModal:l}){const i=(0,c.Fg)(),o=(0,v.k6)(),u=(0,r.useContext)(k.DashboardPageIdContext),{slice_name:h}=(0,w.v9)((t=>t.sliceEntities.slices[e])),p=(0,r.useMemo)((()=>`/explore/?dashboard_page_id=${u}&slice_id=${e}`),[e,u]),m=(0,r.useCallback)((()=>{o.push(p)}),[p,o]);return(0,d.tZ)(y.Z,{show:n,onHide:null!=l?l:()=>null,css:d.iv`
        .ant-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,title:(0,s.t)("Drill to detail: %s",h),footer:(0,d.tZ)(G,{exploreChart:m}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*i.gridUnit,minWidth:128*i.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1},(0,d.tZ)(J,{formData:t,initialFilters:a}))}var ee=a(569175);const te=(0,s.t)("Drill to detail by"),ae=({title:e})=>(0,d.tZ)(f.u,{title:e,placement:"top"},(0,d.tZ)(g.Z.InfoCircleOutlined,{"data-test":"tooltip-trigger",css:e=>d.iv`
        color: ${e.colors.text.label};
        margin-left: ${2*e.gridUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `})),ne=({children:e,...t})=>(0,d.tZ)(m.v2.Item,l()({disabled:!0},t),(0,d.tZ)("div",{css:d.iv`
        white-space: normal;
        max-width: 160px;
      `},e)),le=c.iK.span`
  ${({theme:e})=>`\n     font-weight: ${e.typography.weights.bold};\n     color: ${e.colors.primary.base};\n   `}
`,ie=({chartId:e,formData:t,filters:a=[],isContextMenu:n=!1,contextMenuY:i=0,onSelection:c=(()=>null),onClick:g=(()=>null),...f})=>{const[v,y]=(0,r.useState)([]),[b,w]=(0,r.useState)(!1),k=(0,r.useCallback)(((e,t)=>{g(t),c(),y(e),w(!0)}),[g,c]),x=(0,r.useCallback)((()=>{w(!1)}),[]),Z=(0,r.useMemo)((()=>{var e;return null==(e=(0,u.Z)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===h.cg.DRILL_TO_DETAIL))}),[t.viz_type]),C=(0,r.useMemo)((()=>{const{metrics:e}=(0,p.Z)(t);return o()(e)}),[t]);let S,R;S=Z&&C?(0,d.tZ)(ne,l()({},f,{key:"drill-detail-no-aggregations"}),(0,s.t)("Drill to detail"),(0,d.tZ)(ae,{title:(0,s.t)("Drill to detail is disabled because this chart does not group data by dimension value.")})):(0,d.tZ)(m.v2.Item,l()({},f,{key:"drill-detail-no-filters",onClick:k.bind(null,[])}),(0,s.t)("Drill to detail")),Z||(R=(0,d.tZ)(ne,l()({},f,{key:"drill-detail-by-chart-not-supported"}),te,(0,d.tZ)(ae,{title:(0,s.t)("Drill to detail by value is not yet supported for this chart type.")}))),Z&&C&&(R=(0,d.tZ)(ne,l()({},f,{key:"drill-detail-by-no-aggregations"}),te));const D=(0,r.useMemo)((()=>{const e=a.length>1?a.length+1:a.length,t=i+4+ee.xW+4;return(0,ee.$t)(t,e)-t}),[i,a.length]);return Z&&!C&&null!=a&&a.length&&(R=(0,d.tZ)(m.v2.SubMenu,l()({},f,{popupOffset:[0,D],title:te}),(0,d.tZ)("div",{"data-test":"drill-to-detail-by-submenu"},a.map(((e,t)=>(0,d.tZ)(m.v2.Item,l()({},f,{key:`drill-detail-filter-${t}`,onClick:k.bind(null,[e])}),`${te} `,(0,d.tZ)(le,null,e.formattedVal)))),a.length>1&&(0,d.tZ)(m.v2.Item,l()({},f,{key:"drill-detail-filter-all",onClick:k.bind(null,a)}),`${te} `,(0,d.tZ)(le,null,(0,s.t)("all")))))),!Z||C||null!=a&&a.length||(R=(0,d.tZ)(ne,l()({},f,{key:"drill-detail-by-select-aggregation"}),te,(0,d.tZ)(ae,{title:(0,s.t)("Right-click on a dimension value to drill to detail by that value.")}))),(0,d.tZ)(r.Fragment,null,S,n&&R,(0,d.tZ)(X,{chartId:e,formData:t,initialFilters:v,showModal:b,onHideModal:x}))}},786276:(e,t,a)=>{"use strict";a.d(t,{w:()=>r});var n=a(957557),l=a.n(n),i=a(365946),o=a(355786);function r(e,t){if(!e)return;const a=(0,i.Z)(e),n=l()(a.extras,"having"),r=[...(0,o.Z)(a.filters),...(0,o.Z)(t).map((e=>l()(e,"formattedVal")))];return{granularity:a.granularity,time_range:a.time_range,filters:r,extras:n}}},159507:(e,t,a)=>{"use strict";a.d(t,{pG:()=>x,ZP:()=>Z});var n=a(187185),l=a.n(n),i=a(667294),o=a(899612),r=a(751995),s=a(358593),d=a(355786),c=a(455867),u=a(731293),h=a(211965);const p=r.iK.div`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`,m=({text:e,header:t})=>{const a=(0,d.Z)(e);return(0,h.tZ)(i.Fragment,null,t&&(0,h.tZ)(p,null,t),a.map((e=>(0,h.tZ)("div",{key:e},e))))},g=16,f={dashboards:0,table:1,sql:2,rows:3,tags:4,description:5,owner:6,lastModified:7},v=r.iK.div`
  ${({theme:e,count:t})=>`\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    background-color: ${e.colors.grayscale.light4};\n    color: ${e.colors.grayscale.base};\n    font-size: ${e.typography.sizes.s}px;\n    min-width: ${24+32*t-g}px;\n    border-radius: ${e.borderRadius}px;\n    line-height: 1;\n  `}
`,y=r.iK.div`
  ${({theme:e,collapsed:t,last:a,onClick:n})=>`\n    display: flex;\n    align-items: center;\n    max-width: ${174+(a?0:g)}px;\n    min-width: ${t?16+(a?0:g):94+(a?0:g)}px;\n    padding-right: ${a?0:g}px;\n    cursor: ${n?"pointer":"default"};\n    & .metadata-icon {\n      color: ${n&&t?e.colors.primary.base:e.colors.grayscale.base};\n      padding-right: ${t?0:8}px;\n      & .anticon {\n        line-height: 0;\n      }\n    }\n    & .metadata-text {\n      min-width: 70px;\n      overflow: hidden;\n      text-overflow: ${t?"unset":"ellipsis"};\n      white-space: nowrap;\n      text-decoration: ${n?"underline":"none"};\n      line-height:16px;\n    }\n  `}
`,b=r.iK.div`
  display: -webkit-box;
  -webkit-line-clamp: 20;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
`,w=({barWidth:e,contentType:t,collapsed:a,last:n=!1,tooltipPlacement:l})=>{const{icon:o,title:r,tooltip:d=r}=(e=>{const{type:t}=e;switch(t){case x.DASHBOARDS:return{icon:u.Z.FundProjectionScreenOutlined,title:e.title,tooltip:e.description?(0,h.tZ)("div",null,(0,h.tZ)(m,{header:e.title,text:e.description})):void 0};case x.DESCRIPTION:return{icon:u.Z.BookOutlined,title:e.value};case x.LAST_MODIFIED:return{icon:u.Z.EditOutlined,title:e.value,tooltip:(0,h.tZ)("div",null,(0,h.tZ)(m,{header:(0,c.t)("Last modified"),text:e.value}),(0,h.tZ)(m,{header:(0,c.t)("Modified by"),text:e.modifiedBy}))};case x.OWNER:return{icon:u.Z.UserOutlined,title:e.createdBy,tooltip:(0,h.tZ)("div",null,(0,h.tZ)(m,{header:(0,c.t)("Created by"),text:e.createdBy}),(0,h.tZ)(m,{header:(0,c.t)("Owners"),text:e.owners}),(0,h.tZ)(m,{header:(0,c.t)("Created on"),text:e.createdOn}))};case x.ROWS:return{icon:u.Z.InsertRowBelowOutlined,title:e.title,tooltip:e.title};case x.SQL:return{icon:u.Z.ConsoleSqlOutlined,title:e.title,tooltip:e.title};case x.TABLE:return{icon:u.Z.Table,title:e.title,tooltip:e.title};case x.TAGS:return{icon:u.Z.TagsOutlined,title:e.values.join(", "),tooltip:(0,h.tZ)("div",null,(0,h.tZ)(m,{header:(0,c.t)("Tags"),text:e.values}))};default:throw Error(`Invalid type provided: ${t}`)}})(t),[p,g]=(0,i.useState)(!1),f=(0,i.useRef)(null),v=o,{type:w,onClick:k}=t;(0,i.useEffect)((()=>{g(!!f.current&&f.current.scrollWidth>f.current.clientWidth)}),[e,g,t]);const Z=(0,h.tZ)(y,{collapsed:a,last:n,onClick:k?()=>k(w):void 0},(0,h.tZ)(v,{iconSize:"l",className:"metadata-icon"}),!a&&(0,h.tZ)("span",{ref:f,className:"metadata-text"},r));return p||a||d&&d!==r?(0,h.tZ)(s.u,{placement:l,title:(0,h.tZ)(b,null,d)},Z):Z},k=({items:e,tooltipPlacement:t="top"})=>{const[a,n]=(0,i.useState)(),[r,s]=(0,i.useState)(!1),d=l()(e,((e,t)=>e.type===t.type)).sort(((e,t)=>f[e.type]-f[t.type])),c=d.length;if(c<2)throw Error("The minimum number of items for the metadata bar is 2.");if(c>6)throw Error("The maximum number of items for the metadata bar is 6.");const u=(0,i.useCallback)((e=>{const t=110*c-g;n(e),s(Boolean(e&&e<t))}),[c]),{ref:p}=(0,o.NB)({onResize:u});return(0,h.tZ)(v,{ref:p,count:c,"data-test":"metadata-bar"},d.map(((e,n)=>(0,h.tZ)(w,{barWidth:a,key:n,contentType:e,collapsed:r,last:n===c-1,tooltipPlacement:t}))))};var x;!function(e){e.DASHBOARDS="dashboards",e.DESCRIPTION="description",e.LAST_MODIFIED="lastModified",e.OWNER="owner",e.ROWS="rows",e.SQL="sql",e.TABLE="table",e.TAGS="tags"}(x||(x={}));const Z=k},456727:(e,t,a)=>{"use strict";a.d(t,{Z:()=>p});var n=a(121804),l=a.n(n),i=a(455867),o=a(751995),r=a(748086),s=a(182608),d=a(461120),c=a.n(d),u=a(427600);const h=(e,t=new Date)=>`${l()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`;function p(e,t,a=!1){return async n=>{const l=a?document.querySelector(e):n.currentTarget.closest(e);if(!l)return r.ZP.error((0,i.t)("Image download failed, please refresh and try again."));const d=await(0,s.Jx)(),p=l.offsetWidth,m=l.offsetHeight;return c()(l,{scale:u.go,width:p,backgroundColor:o.K6.colors.grayscale.light4,heigth:m,useCORS:!0}).then((function(e){const a=e.toDataURL("image/png",1);(0,s.Qf)(a,t,null==d?void 0:d.watermarkText,null==d?void 0:d.fontSize,null==d?void 0:d.spacing,null==d?void 0:d.fontColor,null==d?void 0:d.angle,null==d?void 0:d.opacity).then((e=>{const a=document.createElement("a");a.download=`${h(t)}.jpg`,a.href=e,a.click()}))}))}}},933691:(e,t,a)=>{"use strict";a.d(t,{Z:()=>f});var n=a(455867),l=a(751995),i=a(461120),o=a.n(i),r=a(427600),s=a(823907),d=a(672570),c=a(182608);const u=e=>(0,d.Dz)((0,n.t)(e||"PPT download failed, please refresh and try again.")),h=l.K6.colors.grayscale.light5,p=async e=>{const t=await(0,c.Jx)(),a=e.offsetWidth,n=e.offsetHeight;return o()(e,{scale:r.go,width:a,backgroundColor:h,heigth:n,useCORS:!0}).then((function(e){const a=e.toDataURL("image/png",1);return(0,c.Qf)(a,"",null==t?void 0:t.watermarkText,null==t?void 0:t.fontSize,null==t?void 0:t.spacing,null==t?void 0:t.fontColor,null==t?void 0:t.angle,null==t?void 0:t.opacity)}))},m=({isExactSelector:e,selector:t,event:a})=>e?document.querySelector(t):a.currentTarget.closest(t),g=e=>e/96,f=(e,t,a)=>async n=>{if(!Array.isArray(e)){const l=m({isExactSelector:a,selector:e,event:n});if(!l)return u();const i=new s.Z,o=i.addSlide();return i.layout="LAYOUT_16x10",p(l).then((e=>{o.addImage({w:"100%",h:"100%",data:`${e}`}),i.writeFile({fileName:t})})).catch((()=>{u("Failed to download ppt. Please try again later")}))}{var l;const i=m({isExactSelector:a,selector:null==(l=e[0])?void 0:l.id,event:n});if(null==e||!e.length||!i)return u();const o=new s.Z;o.layout="LAYOUT_16x10";for(let t=0;t<e.length;t++){const l=e[t],i=m({isExactSelector:a,selector:l.id,event:n}),r=o.addSlide(),s=await p(i),d=(null==i?void 0:i.clientWidth)||0,c=g(d),u=(null==i?void 0:i.clientHeight)||0,h=g(u);let f=c,v=h;const y=10,b=6.25;c>=h&&c>y?v>b?(f=b*c/h,v=b):(f=y,v=y*h/c):v>b&&(f=b*c/h,v=b),r.addImage({w:f,h:v,data:`${s}`,altText:l.name})}o.writeFile({fileName:t})}}},685832:(e,t,a)=>{"use strict";a.d(t,{Z:()=>h});var n=a(461120),l=a.n(n),i=a(427600),o=a(201168),r=a(455867),s=a(751995),d=a(672570);const c=a.p+"b96aaa9d5efed653a5b5.ttf";var u=a(182608);function h(e,t,a=!1){return async n=>{const h=a?document.querySelector(e):n.currentTarget.closest(e);if(!h)return(0,d.Dz)((0,r.t)("Pdf download failed, please refresh and try again."));const p=await(0,u.Jx)(),m=h.offsetWidth,g=h.offsetHeight;return l()(h,{scale:i.go,width:m,backgroundColor:s.K6.colors.grayscale.light4,heigth:g,useCORS:!0}).then((e=>{const a=e.toDataURL("image/png",1),n=595.28,l=document.createElement("img");l.src=`${a}`,l.style.width="595.28px";let i=new o.ZP("p","pt","a4");i.addFont(c,"CustomFont","normal"),i.setFont("CustomFont");let r=document.createElement("div"),s=l;r.setAttribute("style","font-family:\u5fae\u8f6f\u96c5\u9ed1;width:595.28px");if(m>n){const e=n*g/m;s.setAttribute("style",`width:575.28px;height:${e}px;margin:10px`)}else s.setAttribute("style",`width:${m-10}px;height:${g}px;margin-left:10px;margin-top:10px`);r.appendChild(s),i.html(r,{html2canvas:{width:n,scale:1},callback:function(e){(0,u.e_)(e,null==p?void 0:p.watermarkText,28,200,null==p?void 0:p.fontColor,null==p?void 0:p.angle,null==p?void 0:p.opacity),e.save(String(t)+".pdf")}})})).catch((()=>{}))}}},775701:(e,t,a)=>{"use strict";a.d(t,{J:()=>o});var n=a(455867);const l=(0,n.t)("Create chart"),i=(0,n.t)("Update chart"),o=e=>(0,n.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?l:i}"`)},71894:(e,t,a)=>{"use strict";a.d(t,{b:()=>n});const n=()=>{var e,t;return null==(e=window)||null==(t=e.navigator)?void 0:t.webdriver}},493180:()=>{},647687:()=>{}}]);