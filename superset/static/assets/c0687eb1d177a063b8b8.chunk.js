"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[30115],{330115:(e,t,a)=>{a.d(t,{Z:()=>Ie});var s=a(667294),n=a(14890),i=a(828216),o=a(45697),l=a.n(o),r=a(164561),d=a(748086),h=a(99210),p=a(855241),c=a(734041),u=a(997183),m=a(339144),g=a(931097),y=a(432787),f=a(911382),v=a(757016),Z=a(71577),b=a(519650),_=a(701474),x=a(970553),w=a(455867),S=a(431069),C=a(268084),k=a(540790),P=a(432615),I=a(370583),D=a(732194),$=a(477017),M=a(619702),j=a(67701),E=a(958452),N=a(311064),O=a(704851),T=a(192167),U=a(844760),R=a(7737),A=a(667496),K=a(468135),L=a(631405),z=a(321720),F=a(107447),B=a(514278),H=a(187185),V=a.n(H),J=a(751995),q=a(237731),G=a(23525),X=a(427600),Y=a(835932),W=a(49937),Q=a(49238),ee=a(358593),te=a(454076),ae=a(13284),se=a(211965);const ne=J.iK.div`
  ${({theme:e})=>`\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${ae.UB}px;\n    max-height: calc(100vh - 56px);\n    border-radius: ${e.gridUnit}px;\n    background-color: ${e.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${4*e.gridUnit}px;\n    padding-right: ${4*e.gridUnit}px;\n    padding-bottom: ${4*e.gridUnit}px;\n\n    h3 {\n      padding-bottom: ${3*e.gridUnit}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      & > div {\n        min-width: 200px;\n        width: 360px;\n      }\n\n      & > span {\n        color: ${e.colors.grayscale.light1};\n        margin-left: ${4*e.gridUnit}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${e.colors.grayscale.light2};\n      border-radius: ${e.gridUnit}px;\n      margin: ${e.gridUnit}px 0px;\n      max-height: calc(100vh - 306px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${e.colors.grayscale.light1};\n        margin-right: ${4*e.gridUnit}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${2*e.gridUnit}px;\n      width: ${5*e.gridUnit}px;\n      height: ${5*e.gridUnit}px;\n      line-height: ${5*e.gridUnit}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${5*e.gridUnit}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${3*e.gridUnit}px;\n    }\n    .ant-tree-select-dropdown .ant-select-tree-list-holder-inner .ant-select-tree-treenode {\n      padding-bottom: 0px !important;\n    }\n  `}
`,ie=J.iK.div`
  ${({theme:e,hasDescription:t})=>`\n    .tooltip-header {\n      font-size: ${t?e.typography.sizes.l:e.typography.sizes.s}px;\n      font-weight: ${t?e.typography.weights.bold:e.typography.weights.normal};\n    }\n\n    .tooltip-description {\n      margin-top: ${2*e.gridUnit}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}
`,oe=J.iK.span`
  ${({theme:e})=>`\n    position: absolute;\n    left: ${3*e.gridUnit}px;\n    right: ${3*e.gridUnit}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `}
`;class le extends s.PureComponent{constructor(e){super(e),this.getTreeExpanded=(e=[],t)=>{let a=[];return null==e||e.map((e=>{var s;const n=this.getTreeExpanded(e.children,t);return-1!==(null==e||null==(s=e.name)?void 0:s.indexOf(t))?(n&&n.length&&(e.children=n),a.push({...e,title:e.name})):n&&n.length&&(e.children=n,a.push({...e,title:e.name})),!1})),a},this.findKeys=e=>{let t=[];return e.forEach((e=>{t.push(e.value),e.children&&(t=t.concat(this.findKeys(e.children)))})),t},this.searchDatasource=e=>{if(this.setState({searchVal:e}),e){const t=this.getTreeExpanded(this.state.dataSources,e);this.setState({treeExpandedKeys:this.findKeys(t)})}else this.setState({treeExpandedKeys:[]})},this.expandedChange=e=>{this.setState({treeExpandedKeys:e})},this.getExpandedKeys=()=>{},this.state={visType:null,dataSources:null,isModal:!0,treeExpandedKeys:[],searchVal:""},this.changeDatasource=this.changeDatasource.bind(this),this.changeVisType=this.changeVisType.bind(this),this.gotoSlice=this.gotoSlice.bind(this),this.newLabel=this.newLabel.bind(this),this.loadDatasources=this.loadDatasources.bind(this),this.loadDatasources()}componentDidMount(){"/chart/list/"==window.location.pathname&&this.setState({isModal:!1});const e=new URLSearchParams(window.location.search),t=e.get("table_name"),a=e.get("table_id");t&&a&&this.setState({datasource:{label:t||"",value:`${a}__table`||""}})}exploreUrl(){var e;const t=(0,G.eY)(X.KD.dashboardId);let a=(0,A.VU)(`/explore/?viz_type=${this.state.visType}&datasource=${null==(e=this.state.datasource)?void 0:e.value}`);return(0,q.Z)(t)&&(a+=`&dashboard_id=${t}`),a}gotoSlice(){let e=this.exploreUrl();(0,te.w)()&&(e=`${e}&standalone=true`),window.location.href=e}changeDatasource(e){this.setState({datasource:{label:e.label.props["data-test"],value:e.value},searchVal:""})}changeVisType(e){this.setState({visType:e})}isBtnDisabled(){var e;return!(null!=(e=this.state.datasource)&&e.value&&this.state.visType)}newLabel(e){return(0,se.tZ)(ee.u,{mouseEnterDelay:1,placement:"right",title:(0,se.tZ)(ie,{hasDescription:!!e.description},(0,se.tZ)("div",{className:"tooltip-header"},e.custom_name?e.custom_name:e.table_name),e.description&&(0,se.tZ)("div",{className:"tooltip-description"},e.description))},(0,se.tZ)(oe,null,e.custom_name?e.custom_name:e.table_name))}loadDatasources(){S.Z.get({endpoint:"/api/v2/dataset/group/"}).then((e=>{const t=e.json.meta.data||[],a=[],s=e=>{var t;return e.length?null==(t=e.map((e=>{var t,n,i,o;const l={value:`${e.group_id}__${e.name}`,name:e.name,id:e.group_id,mark:e.mark,selectable:!1};let r=null==(t=e.datasets)||null==(n=t.map((e=>a.includes(e.dataset_id)?null:(a.push(e.dataset_id),{value:`${e.dataset_id}__table`,name:e.dataset_name,id:e.dataset_id,mark:e.mark}))))?void 0:n.filter((e=>e));if(r=V()(r,((e,t)=>e.value===t.value)),r.length&&(l.children=r),e.children&&e.children.length){const t=s(e.children);l.children?l.children=[...t,...l.children]:l.children=t}return null!=e&&null!=(i=e.children)&&i.length||null!=l&&null!=(o=l.children)&&o.length?l:null})))?void 0:t.filter((e=>e)):[]},n=s(t);this.setState({dataSources:n})}))}render(){var e;const t=this.isBtnDisabled(),{dataSources:a,isModal:n,searchVal:i,treeExpandedKeys:o}=this.state,l=()=>{if((0,te.w)())return window.open(`/exceltodatabaseview/form?standalone=true&table_entry=data&table_source=excel&redict_url=${window.parent.location.href}`);window.open(`/exceltodatabaseview/form?standalone=true&table_entry=data&table_source=excel&redict_url=${window.location.pathname+window.location.search}`)},r=()=>{if((0,te.w)())return window.open(`/csvtodatabaseview/form?standalone=true&table_entry=data&table_source=csv&redict_url=${window.parent.location.href}`);window.open(`/csvtodatabaseview/form?standalone=true&table_entry=data&table_source=csv&redict_url=${window.location.pathname+window.location.search}`)},d=(e,t)=>{const a=e.indexOf(t),s=e.substr(0,a),n=e.substr(a+t.length);return a>-1?(0,se.tZ)("span",{style:{color:"#000"}},s,(0,se.tZ)("span",{style:{color:"#f50"}},t),n):(0,se.tZ)("span",{style:{color:"#000"}},e)},h=(e=[],t)=>{let a=[];return null==e||e.map((e=>{var s;const n=h(e.children,t);return-1!==(null==e||null==(s=e.name)?void 0:s.indexOf(t))?(n&&n.length&&(e.children=n),a.push({...e,title:(0,se.tZ)("div",{style:{display:"flex",margin:"5px",lineHeight:"20px"},"data-test":e.name},e.mark&&(0,se.tZ)("span",{style:{width:"50px",height:"15px",lineHeight:"16px",color:"#000",fontSize:"12",background:"#c2bcbc",borderRadius:"20px",textAlign:"center",margin:"2px 5px 0 0"}},"\u5e38\u7528")," ",d(e.name,t))})):n&&n.length&&(e.children=n,a.push({...e,title:d(e.name,t)})),!1})),a};return(0,se.tZ)(ne,{style:{marginTop:n?"56px":"0"}},(0,se.tZ)("h3",null,(0,w.t)("Create a new chart")),(0,se.tZ)(W.Rg,{direction:"vertical",size:"small"},(0,se.tZ)(W.Rg.Step,{title:(0,se.tZ)(Q.lX,null,(0,w.t)("Select a dataset")),status:null!=(e=this.state.datasource)&&e.value?"finish":"process",description:(0,se.tZ)("div",{className:"dataset"},a&&(0,se.tZ)(x.Z,{showSearch:!0,dropdownRender:e=>(0,se.tZ)(s.Fragment,null,(0,te.w)()&&(0,se.tZ)(W.T,{style:{padding:"0 8px 4px"}},(0,se.tZ)(Y.Z,{type:"text",onClick:l},"\u672c\u5730Excel\u5bfc\u5165"),(0,se.tZ)(Y.Z,{type:"text",onClick:r},"\u672c\u5730CSV\u6587\u4ef6\u5bfc\u5165")),e),labelInValue:!0,value:this.state.datasource,dropdownStyle:{maxHeight:400,overflow:"auto"},treeExpandedKeys:o,placeholder:(0,w.t)("Select database or type database name"),filterTreeNode:()=>!0,onTreeExpand:this.expandedChange,onChange:this.changeDatasource,treeData:h(a,i),onSearch:this.searchDatasource}))}),(0,se.tZ)(W.Rg.Step,{title:(0,se.tZ)(Q.lX,null,(0,w.t)("Select a chart")),status:this.state.visType?"finish":"process",description:(0,se.tZ)(ae.ZP,{className:"viz-gallery",onChange:this.changeVisType,selectedViz:this.state.visType})})),(0,se.tZ)("div",{className:"footer"},t&&(0,se.tZ)("span",null,(0,w.t)("Please select both a Dataset and a Chart type to proceed")),(0,se.tZ)(Y.Z,{buttonStyle:"primary",disabled:t,onClick:this.gotoSlice},(0,w.t)("Create new chart"))))}}var re=a(591877),de=a(968606);(0,z.Z)(),(0,F.Z)();const he=document.getElementById("app"),pe=JSON.parse((null==he?void 0:he.getAttribute("data-bootstrap"))||"{}");(0,re.fG)(pe.common.feature_flags);const ce=()=>(0,se.tZ)(K.a,{theme:de.rS},(0,se.tZ)(L.n,null),(0,se.tZ)(B.EM,null,(0,se.tZ)(le,null)));var ue=a(731293),me=a(727989),ge=a(232228),ye=a(301510),fe=a(641295),ve=a(935500);const Ze=r.Z.Item,be={dataAll:l().object.isRequired,Menuname:l().string.isRequired,collapsed:l().bool.isRequired,handleChangeMenu:l().func.isRequired,handleRemoveId:l().func.isRequired};let _e=[],xe=null;const we={adddev_menu:(0,w.t)("New Directory"),adddev_name:(0,w.t)("Directory Name"),name:"",is_dir:"",id:"",pid:"",label:"Add",Shift_menu:""};let Se={...we};const Ce=(0,w.t)('The passwords for the databases below are needed in order to import them together with the dashboards. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),ke=(0,w.t)("You are importing one or more dashboards that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?");class Pe extends s.Component{constructor(e){var t;super(e),this.getPerm=()=>{const{Menuname:e}=this.props;S.Z.get({endpoint:`/api/v2/menu/${e}/perm`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?this.setState({btnperm:e.json.meta.data.perm}):d.ZP.error(e.json.meta.message)}))},this.DealList=()=>{const{Menuname:e}=this.props,{selectvalue:t,valuename:a}=this.state;return S.Z.get({endpoint:`/api/v2/${e}/group/`+(a?`?${t}=${a}`:"")}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){t.json.meta.data.forEach((t=>{var a,s,n;t.icon=(0,se.tZ)(C.default,null),t.title=t.name,t.key=t.group_id,t.is_dir=0,t.key_name=t.group_id+"&&"+t.is_dir+"&&"+t.name+"&&"+t.perm,t.menu_key=`${t.group_id}`,t.pmenu_img="/static/assets/images/superset-menu-children.png",t.list=[],(null==(a=t.children)?void 0:a.length)>0&&(this.forEach_children(t.children),this.forEach_list(t.children,0,t.list,t.group_id)),((null==(s=t.slices)?void 0:s.length)>0||(null==(n=t.dashboards)?void 0:n.length)>0)&&this.forEach_list("dashboard"==e?t.dashboards:t.slices,1,t.list,t.group_id)})),_e=t.json.meta.data;let a=[];_e.map((e=>{a.push(e.key_name)})),xe=_e,this.setState({Search_Data:t.json.meta.data,isMenuOpen:!0,rootSubmenuKeys:a})}else d.ZP.error(t.json.meta.message)})).finally((()=>{this.setState({Menuloading:!1})}))},this.menuAdd=(e,t,a,s)=>{e.stopPropagation(),Se={...we,..."dashboard"==this.props.Menuname?0==s?{adddev_menu:(0,w.t)("New Directory"),adddev_name:(0,w.t)("Directory Name"),pid:t}:{adddev_menu:(0,w.t)(this.props.dataAll.newbuilt),adddev_name:(0,w.t)("Dashboard Name"),pid:a}:{pid:t},is_dir:s,id:t,name:"",label:"Add"},this.setState({isModalOpen:!0}),"chart"==this.props.Menuname&&sessionStorage.setItem("chartGroup_id",t)},this.delete_Popconfirm=e=>{e.stopPropagation()},this.menuEdit=(e,t,a,s,n,i,o)=>{const{Menuname:l}=this.props;e.stopPropagation(),0==s?(Se={...we,id:t,is_dir:n,Shift_menu:(0,w.t)("take")+i+(0,w.t)("Move to"),name:i,pid:a},this.getControlledMenu(n),this.setState({isModalOpenShift:!0})):1==s?(Se={...we,...0==n?{adddev_menu:(0,w.t)("Edit Catalog"),adddev_name:(0,w.t)("Directory Name")}:{adddev_menu:(0,w.t)(this.props.dataAll.adddev_menu),adddev_name:(0,w.t)(this.props.dataAll.adddev_name)},is_dir:n,id:t,pid:a,name:i,label:"Edit"},this.setState({isModalOpen:!0})):2==s?(Se.id=t,Se.is_dir=n,this.setState({delmodel:!0}),1==n&&"dashboard"!=l&&this.Extractdeldata(t)):3==s&&(window.location.assign((0,A.VU)(o)),sessionStorage.setItem("chartIds",t),sessionStorage.setItem("chartTitle",i),sessionStorage.setItem("chartGroup_id",a))},this.handleChange=e=>{const t=e.target,a="checkbox"===t.type?t.checked:t.value;"name"==t.name&&(Se.name=a)},this.handleClick=e=>{if(this.setState({selectedKeys:e.key}),sessionStorage.setItem("key",e.key),sessionStorage.setItem("keyPath",JSON.stringify(e.keyPath.slice(1))),sessionStorage.setItem("chartTitle",e.item.node.innerText),1==e.item.props.basicInfo.key_name.split("&&")[1]){const{handleChangeMenu:t}=this.props;t(e.item.props.basicInfo.key_name,e.item.props.basicInfo.layoutMode),"dashboard"==this.props.Menuname&&(sessionStorage.setItem("isperm",e.item.props.basicInfo.key_name.split("&&")[3]),sessionStorage.setItem("dashboardGroup_id",e.keyPath[1].split("&&")[0])),"chart"==this.props.Menuname&&(sessionStorage.setItem("chartGroup_id",e.keyPath[1].split("&&")[0]),sessionStorage.setItem("chart_basicInfo",JSON.stringify(e.item.props.basicInfo||{})));const{created_on:a,created_by:s,changed_on:n,changed_by:i}=e.item.props.basicInfo;this.setState({showId:e.key,showData:JSON.stringify({created_on:a,created_by:s,changed_on:n,changed_by:i})})}},this.onOpenChange=e=>{let{openKeys:t,rootSubmenuKeys:a}=this.state;const s=e.find((e=>-1===t.indexOf(e)));-1===a.indexOf(s)?this.setState({openKeys:e}):this.setState({openKeys:s?[s]:[]})},this.handleBlockGet=()=>{const{Menuname:e}=this.props,{name:t,pid:a,id:s,is_dir:n,label:i}=Se;if(!t)return d.ZP.error((0,w.t)("Please enter a name"));if(0==n){if("Add"==i){const s={name:t,pid:a};return S.Z.post({endpoint:`/api/v2/${e}/group/`,body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),Se={...we}):d.ZP.error(e.json.meta.message)}))}if("Edit"==i){const n={name:t,pid:a};return S.Z.put({endpoint:`/api/v2/${e}/group/${s}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),Se={...we}):d.ZP.error(e.json.meta.message)}))}}else{if("Add"==i){const a="dashboard"==e?{dashboard_group_id:s,dashboard_title:t}:{slice_name:t,slice_group_id:s};return S.Z.post({endpoint:`/api/v2/${e}/`,body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),Se={...we};const t=e.json.meta.data||{};sessionStorage.setItem("key",t.id);const a=this.state.openKeys.includes(`${t.dashboard_group_id}`)?this.state.openKeys:[`${t.dashboard_group_id}`,...this.state.openKeys];this.setState({openKeys:a,selectedKeys:`${t.id}`}),sessionStorage.setItem("keyPath",JSON.stringify(a)),sessionStorage.setItem("chartTitle",t.dashboard_title),this.setState({selectedKeys:`${t.id}`}),this.props.handleChangeMenu(`${t.id}&&1&&${t.dashboard_title}&&8`)}else d.ZP.error(e.json.meta.message)}))}if("Edit"==i){const n="dashboard"==e?{dashboard_title:t,dashboard_group_id:a}:{new_title:t,target_id:a};return S.Z.request({method:"PATCH",endpoint:`/api/v2/${e}/${s}/`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpen:!1}),Se={...we}):d.ZP.error(e.json.meta.message)}))}}},this.selectonChange=(e,t,a)=>{const s=Se.id,n=Se.is_dir,i=Se.name;Se={...Se,id:s,pid:e,is_dir:n,name:i},this.setState({checkedvalue:t[0]})},this.handleBlockShift=()=>{const{name:e,pid:t,id:a,is_dir:s}=Se,{Menuname:n}=this.props;if(0==s){const s={name:e,pid:t};return S.Z.put({endpoint:`/api/v2/${n}/group/${a}/`,body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,treeData:[],checkedvalue:null}),Se={...we}):d.ZP.error(e.json.meta.message)}))}{const s="dashboard"==n?{dashboard_title:e,dashboard_group_id:t}:{new_title:e,target_id:t};return S.Z.request({method:"PATCH",endpoint:`/api/v2/${n}/${a}/`,body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),this.setState({isModalOpenShift:!1,expandedKeys:[],checkedvalue:null}),Se={...we}):d.ZP.error(e.json.meta.message)}))}},this.openDashboardImportModal=()=>{this.setState({importingDashboard:!0})},this.closeDashboardImportModal=()=>{this.setState({importingDashboard:!1})},this.handleDashboardImport=()=>{this.setState({importingDashboard:!1})},this.Exportwrap=(e,t,a,s,n,i)=>{const{Menuname:o}=this.props;let l=[];l.push(t),(0,ge.Z)(o,l,(()=>{this.setState({preparingExport:!1})})),this.setState({preparingExport:!0})},this.setPasswordFields=e=>{this.setState({passwordFields:e})},this.renderSubMenu=({is_dir:e,list:t,group_id:a,pid:s,icon:n,name:i,pmenu_img:o,key_name:l,perm:r,url:d,menu_key:c})=>(0,se.tZ)(h.Z.SubMenu,{key:c,title:(0,se.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},(0,se.tZ)("span",{style:{display:"flex",alignItems:"center",width:"65%"}},-1===this.state.openKeys.indexOf(c)?(0,se.tZ)(C.default,null):(0,se.tZ)(k.default,null),(0,se.tZ)("span",{title:i,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},i)),(0,se.tZ)("span",{style:{display:"black",width:"25%"}},r>=4&&(0,se.tZ)("div",{className:"superset-menu-Popover"},0==e&&(0,se.tZ)(p.Z,{overlayClassName:"popovercss",content:(0,se.tZ)("div",null,(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,s,0)},(0,se.tZ)(C.default,{style:{marginRight:"5px"}}),(0,w.t)("New Directory")),(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,s,1)},"dashboard"==this.props.Menuname?(0,se.tZ)(ue.Z.DashbordPcicon,{style:{fontSize:"16px",verticalAlign:"middle"}}):(0,se.tZ)(ue.Z.ChartPcicon,{style:{fontSize:"16px",verticalAlign:"middle"}}),(0,w.t)(this.props.dataAll.newbuilt))),zIndex:998,trigger:"hover"},(0,se.tZ)(P.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})),(0,se.tZ)(p.Z,{overlayClassName:"popovercss",content:(0,se.tZ)("div",null,(0,se.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,s,0,e,i)},(0,se.tZ)(I.default,{style:{marginRight:"5px"}}),(0,w.t)("Move")),(0,se.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,s,1,e,i)},(0,se.tZ)(D.default,{style:{marginRight:"5px"}}),(0,w.t)("Rename")),1==e&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:t=>this.menuEdit(t,a,s,3,e,i,d)},(0,se.tZ)($.default,{style:{marginRight:"5px"}}),(0,w.t)("Export")),(0,se.tZ)("p",{className:"Popover-curPo",onClick:n=>this.menuEdit(n,a,s,2,e,t)},(0,se.tZ)(M.default,{style:{marginRight:"5px"}}),(0,w.t)("Delete"))),zIndex:998,trigger:"hover"},(0,se.tZ)(j.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}})))))},t&&t.map((e=>e.list&&e.list.length>0||e.children?this.renderSubMenu(e):this.renderMenuItem(e)))),this.renderMenuItem=e=>{const{is_dir:t,group_id:a,pid:n,icon:i,name:o,pmenu_img:l,key_name:r,menu_key:d,perm:c,url:u,adaptation_equipment:m,created_on:g,created_by_fk:y,changed_on:f,changed_by_fk:v}=e;d===this.state.showId&&this.state.setBasicInfo&&("chart"===this.props.Menuname&&sessionStorage.setItem("chart_basicInfo",JSON.stringify({key_name:r,layoutMode:null==m?void 0:m.toUpperCase(),created_on:g,created_by:null==y?void 0:y.cn_name,changed_on:f,changed_by:null==v?void 0:v.cn_name})),this.setState({setBasicInfo:!1}));return(0,se.tZ)(h.Z.Item,{key:d,basicInfo:{key_name:r,layoutMode:null==m?void 0:m.toUpperCase(),created_on:g,created_by:null==y?void 0:y.cn_name,changed_on:f,changed_by:null==v?void 0:v.cn_name}},(0,se.tZ)("span",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},(0,se.tZ)("span",{style:{display:"flex",alignItems:"center",width:"80%"}},(0,se.tZ)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:o},"dashboard"==this.props.Menuname?(0,se.tZ)(s.Fragment,null,"pc"==m?(0,se.tZ)(ue.Z.DashbordPcicon,{style:{fontSize:"16px",verticalAlign:"middle"}}):(0,se.tZ)(ue.Z.TabletOutlined,{style:{fontSize:"16px",verticalAlign:"middle"}})):(0,se.tZ)(ue.Z.ChartPcicon,{style:{fontSize:"16px",verticalAlign:"middle"}}),(e=>{var t;const a=e.indexOf(this.state.valuename),s=e.substr(0,a),n=e.substr(a+((null==(t=this.state.valuename)?void 0:t.length)||0));return a>-1?(0,se.tZ)("span",null,s,(0,se.tZ)("span",{style:{color:"#ff5500"}},this.state.valuename),n):(0,se.tZ)("span",null,e)})(o))),(0,se.tZ)("span",{style:{display:"black",width:"20%"}},c>=2&&(0,se.tZ)("div",{className:"superset-menu-Popover"},0==t&&c>=4&&(0,se.tZ)(p.Z,{overlayClassName:"popovercss",content:(0,se.tZ)("div",null,(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,0)},(0,w.t)("New Directory")),(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,a,n,1)},(0,w.t)(this.props.dataAll.newbuilt))),zIndex:998,trigger:"hover"},(0,se.tZ)("img",{src:(0,A.VU)("/static/assets/images/superset-menu-add.png"),alt:(0,w.t)("New Group")})),(0,se.tZ)(p.Z,{overlayClassName:"popovercss",content:(0,se.tZ)("div",null,c>=4&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuEdit(e,a,n,0,t,o)},(0,se.tZ)(I.default,{style:{marginRight:"5px"}}),(0,w.t)("Move")),c>=4&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuEdit(e,a,n,1,t,o)},(0,se.tZ)(D.default,{style:{marginRight:"5px"}}),(0,w.t)("Rename")),1==t&&"chart"==this.props.Menuname&&c>=4&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuEdit(e,a,n,3,t,o,u)},(0,se.tZ)(E.default,{style:{marginRight:"5px"}}),(0,w.t)("Edit")),0==t&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:()=>this.openDashboardImportModal()},(0,w.t)(this.props.dataAll.Import)),1==t&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.Exportwrap(e,a,n,3,t,o,u)},(0,se.tZ)($.default,{style:{marginRight:"5px"}}),(0,w.t)("Export")),c>=4&&(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuEdit(e,a,n,2,t)},(0,se.tZ)(M.default,{style:{marginRight:"5px"}}),(0,w.t)("Delete"))),zIndex:998,trigger:"hover"},(0,se.tZ)(j.default,{onClick:e=>{e.preventDefault(),e.stopPropagation()}}))))))},this.onSearch=e=>{const{Menuname:t}=this.props;let{selectvalue:a}=this.state,s=e;if(this.setState({isMenuOpen:!1,valuename:e}),s&&"allvalue"==a){_e=this.resdatasource(this.state.Search_Data,s),this.setState({isMenuOpen:!0})}else S.Z.get({endpoint:`/api/v2/${t}/group/`+(s?`?${a}=${s}`:""),headers:{"Content-Type":"application/json"}}).then((a=>{if(200==a.json.meta.code||201==a.json.meta.code){a.json.meta.data.forEach((e=>{var a,s,n;e.icon=(0,se.tZ)(C.default,null),e.title=e.name,e.key=e.group_id,e.is_dir=0,e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name,e.menu_key=e.group_id+"&&"+e.name,e.pmenu_img="/static/assets/images/superset-menu-children.png",e.list=[],(null==(a=e.children)?void 0:a.length)>0&&(this.forEach_children(e.children),this.forEach_list(e.children,0,e.list,e.group_id)),((null==(s=e.slices)?void 0:s.length)>0||(null==(n=e.dashboards)?void 0:n.length)>0)&&this.forEach_list("dashboard"==t?e.dashboards:e.slices,1,e.list,e.group_id)})),_e=a.json.meta.data;let s=[];_e.map((e=>{s.push(e.key_name)}));const n=[],i=e=>{e.length&&e.forEach((e=>{0===e.is_dir&&n.push(e.menu_key),e.list&&e.list.length&&i(e.children)}))};e.trim()&&i(a.json.meta.data),this.setState({Search_Data:a.json.meta.data,openKeys:n,isMenuOpen:!0,rootSubmenuKeys:s})}else d.ZP.error(a.json.meta.message)}))},this.resdatasource=(e,t)=>{let a=[],s=function(e,t){e.map((e=>{const n=s(e.list,t);return-1!==e.name.toLowerCase().indexOf(t.toLowerCase())?a.push(e):n&&n.length&&(e.list=n,a.push(e)),!1}))};return s(e,t),a},this.Extractdeldata=e=>{S.Z.get({endpoint:`/api/v2/chart/${e}/dashboards/`}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?this.setState({deldata:e.json.meta.data}):d.ZP.error(e.json.meta.message)}))},this.delhandleOk=()=>{const{Menuname:e,handleRemoveId:t}=this.props,{deldata:a}=this.state;0==Se.is_dir?S.Z.delete({endpoint:encodeURI(`/api/v2/${e}/group/${Se.id}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList()):d.ZP.error(e.json.meta.message)})):("dashboard"==e&&S.Z.delete({endpoint:encodeURI(`/api/v2/${e}/${Se.id}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),sessionStorage.getItem("daidOrSlug_ids")==Se.id&&(sessionStorage.removeItem("isperm"),sessionStorage.removeItem("daidOrSlug_ids"),t(Se.id))):d.ZP.error(e.json.meta.message)})),"chart"==e&&S.Z.delete({endpoint:encodeURI(`/api/v2/${e}/${Se.id}/`)}).then((e=>{200==e.json.meta.code||201==e.json.meta.code?(d.ZP.success(e.json.meta.message),this.DealList(),sessionStorage.getItem("chartIds")==Se.id&&(sessionStorage.removeItem("chartIds"),t(Se.id))):d.ZP.error(e.json.meta.message)}))),this.setState({delmodel:!1})},this.delhandleCancel=()=>{this.setState({delmodel:!1})},this.selevtchange=e=>{this.setState({selectvalue:e},(()=>{this.onSearch(this.state.valuename)}))};const a=sessionStorage.getItem("chart_basicInfo");a&&e.handleChangeMenu(null==(t=JSON.parse(a))?void 0:t.key_name,sessionStorage.getItem("chartTitle")),this.state={isMenuOpen:!1,isModalOpen:!1,isModalOpenShift:!1,treeData:[],Search_Data:[],expandedKeys:[],autoExpandParent:!0,checkedvalue:null,isModalOpenaddChart:!1,Menuloading:!1,delmodel:!1,delloading:!1,delbtndisable:!1,delobj:{},deldata:[],importingDashboard:!1,addSuccessToast:(0,w.t)("Chart imported"),addDangerToast:e.addDangerToast,passwordFields:"",preparingExport:!1,openKeys:sessionStorage.getItem("keyPath")?JSON.parse(sessionStorage.getItem("keyPath")):[],rootSubmenuKeys:[],valuename:null,btnperm:0,selectvalue:"name",controlledMenuList:[],setBasicInfo:!0,selectedKeys:sessionStorage.getItem("key")||"",showData:null,showId:"chart"===e.Menuname?sessionStorage.getItem("chartIds"):sessionStorage.getItem("daidOrSlug_ids")}}componentDidMount(){this.getPerm(),this.DealList();const e=this;window.flushedtDealList=()=>{e.DealList()}}componentDidUpdate(e,t){this.state.showData&&this.state.showData!==t.showData&&this.updateInfo(JSON.parse(this.state.showData))}getControlledMenu(e){const{Menuname:t}=this.props;S.Z.get({endpoint:`api/v2/${t}/group/`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){const a=this.forEach_Controlled(t.json.meta.data),s=[];1!=e&&s.push({id:"0",title:(0,w.t)("Move to Root Directory"),name:(0,w.t)("Move to Root Directory"),pid:"0",children:[],value:"0",is_dir:"0",group_id:"0",key:"0",icon:(0,se.tZ)(C.default,null)}),s.push(...a),this.setState({treeData:s})}}))}forEach_children(e){e.forEach((e=>{e.title=e.name,e.key=e.group_id,e.children.length>0&&this.forEach_children(e.children)}))}forEach_Controlled(e=[]){const t=[];return e.forEach((e=>{const a={title:e.name,key:e.group_id,disabled:e.perm<4,children:this.forEach_Controlled(e.children)};(!a.disabled||a.children.length>0)&&t.push(a)})),t}updateInfo(e){"dashboard"===this.props.Menuname?this.props.updateDashboardChangedInfo(e):this.props.updateChartChangedInfo(e,this.state.showId)}forEach_list(e,t,a,s){e.forEach((e=>{var n,i,o,l,r;(e.is_dir=t,1==t)?(e.name=e.dashboard_title||e.slice_name,e.group_id=e.dashboard_id||e.slice_id,e.key_name=`${e.group_id}&&${e.is_dir}&&${e.name}&&${"chart"==this.props.Menuname&&`${e.url}${e.query_context}&&`}${e.perm}`,e.menu_key=`${e.group_id}`,e.pid=s,e.pmenu_img="/static/assets/images/superset-menu-dashboards.png",e.group_id==this.state.showId&&this.setState({showData:JSON.stringify({created_on:e.created_on,created_by:null==(n=e.created_by_fk)?void 0:n.cn_name,changed_on:e.changed_on,changed_by:null==(i=e.changed_by_fk)?void 0:i.cn_name})})):(e.icon=(0,se.tZ)(C.default,null),e.pmenu_img="/static/assets/images/superset-menu-children.png",e.key_name=e.group_id+"&&"+e.is_dir+"&&"+e.name+"&&"+e.perm,e.menu_key=`${e.group_id}`);(e.list=[],e.children)&&((null==(o=e.children)?void 0:o.length)>0&&this.forEach_list(e.children,0,e.list,e.group_id),((null==(l=e.slices)?void 0:l.length)>0||(null==(r=e.dashboards)?void 0:r.length)>0)&&this.forEach_list("dashboard"==this.props.Menuname?e.dashboards:e.slices,1,e.list,e.group_id));a.push(e)}))}render(){const{Menuloading:e,isMenuOpen:t,isModalOpen:a,delmodel:s,delloading:n,deldata:i,delobj:o,openKeys:l,isModalOpenShift:d,treeData:S,expandedKeys:k,checkedvalue:I,importingDashboard:D,addDangerToast:$,addSuccessToast:M,passwordFields:j,valuename:E,btnperm:A,selectvalue:K,selectedKeys:L,controlledMenuList:z}=this.state,{collapsed:F,dataAll:B,Menuname:H}=this.props;let V=[{label:(0,w.t)("Group"),value:"group_name"},{label:(0,w.t)("Resource"),value:"name"},{label:(0,w.t)("Creator"),value:"creator"}];"chart"==this.props.Menuname&&V.push({label:(0,w.t)("types of"),value:"viz_type"});const J=(0,se.tZ)(c.Z,{value:K,onChange:this.selevtchange,options:V}),q=(0,N.Z)();let G=q.keys().filter((e=>{var t;return(0,ye.X3)((null==(t=q.get(e))?void 0:t.behaviors)||[])})).map((e=>{var t;return{label:(null==(t=q.get(e))?void 0:t.name)||e,value:e}})).sort(((e,t)=>e.label&&t.label?e.label>t.label?1:e.label<t.label?-1:0:0));const X=(0,te.w)();return(0,se.tZ)(u.Z,null,(0,se.tZ)("div",{className:"lefttitle",style:{width:B.width-0}},(0,se.tZ)(m.Z,{style:{width:"100%"}},(0,se.tZ)("span",{style:{fontSize:"15px",overflow:"hidden",whiteSpace:"nowrap"}},"dashboard"==this.props.Menuname?(0,w.t)("Dashboard"):(0,w.t)("Chart")),(0,se.tZ)("div",{className:"superset-menu-Popover-Card",style:{top:"12px",display:F?"none":"block"}},e?(0,se.tZ)(O.default,null):(0,se.tZ)(g.Z,{title:(0,w.t)("Refresh")},(0,se.tZ)(T.default,{onClick:()=>{this.setState({Menuloading:!0,valuename:null,selectvalue:"name"}),this.DealList()},style:{marginRight:"10px"}})),(0,se.tZ)(p.Z,{overlayClassName:"popovercss",placement:"bottom",content:(0,se.tZ)("div",null,(0,se.tZ)("p",{className:"Popover-curPo",onClick:()=>this.openDashboardImportModal()},(0,se.tZ)(U.default,{style:{marginRight:"5px"}}),(0,w.t)(B.Import)),(0,se.tZ)("p",{className:"Popover-curPo",onClick:e=>this.menuAdd(e,0,0,0)},(0,se.tZ)(C.default,{style:{marginRight:"5px"}}),(0,w.t)("New Group"))),zIndex:998,trigger:"hover"},A>1&&(0,se.tZ)(P.default,null)))),(0,se.tZ)("div",{style:{padding:"0px 35px 0 0px",display:F?"none":"block"}},"viz_type"!=K?(0,se.tZ)(y.Z,{style:{width:"100%",background:X?"#ffffff":"#253E5E",opacity:"1",marginLeft:"20px",border:"none",height:"36px"},className:"inputcss",prefix:(0,se.tZ)(R.default,{style:{width:"30px",color:X?"#000":"rgb(89 ,109 ,135)"}}),placeholder:(0,w.t)("Search"),onChange:e=>this.onSearch(e.target.value),value:E,addonAfter:J}):(0,se.tZ)("div",{className:"searchSelect"},(0,se.tZ)(c.Z,{allowClear:!0,style:{flex:1},onChange:e=>this.onSearch(e),options:G,value:E,placeholder:(0,w.t)("Search"),showSearch:!0,optionFilterProp:"label"}),(0,se.tZ)(c.Z,{style:{width:"70px"},value:K,onChange:this.selevtchange,options:V})))),(0,se.tZ)(f.Z,{spinning:e,style:{marginTop:"20px"}},(0,se.tZ)(h.Z,{visible:t,selectedKeys:L,onClick:this.handleClick,mode:"inline",theme:"dark",openKeys:l,onOpenChange:this.onOpenChange,className:X?"":"maxHeight800",style:{maxHeight:"calc(100vh - 180px)",overflowY:"auto"}},_e.map((e=>e.children||e.list&&e.list.length>0?this.renderSubMenu(e):this.renderMenuItem(e))))),(0,se.tZ)(v.Z,{style:{marginTop:"chart"==H&&1==Se.is_dir&&"Add"==Se.label?"-90px":"30px",padding:"chart"==H&&1==Se.is_dir&&"Add"==Se.label&&"0px"},title:"chart"==H&&1==Se.is_dir&&"Add"==Se.label?null:Se.adddev_menu,visible:a,width:"chart"==H&&1==Se.is_dir&&"Add"==Se.label?"1090px":520,destroyOnClose:!0,onCancel:()=>this.setState({isModalOpen:!1}),footer:"chart"==H&&1==Se.is_dir&&"Add"==Se.label?null:(0,se.tZ)("div",null,(0,se.tZ)(Z.Z,{onClick:()=>this.setState({isModalOpen:!1})},(0,w.t)("Cancel")),(0,se.tZ)(Z.Z,{type:"primary",onClick:this.handleBlockGet},(0,w.t)("Confirm")))},"chart"==H&&1==Se.is_dir&&"Add"==Se.label?(0,se.tZ)(ce,{idOrSlug:Se.pid}):(0,se.tZ)(r.Z,{name:"DataSet",labelCol:{span:4},wrapperCol:{span:20},preserve:!1},(0,se.tZ)(Ze,{label:Se.adddev_name,name:"name",rules:[{required:!0,message:(0,w.t)("Please enter a name")}]},(0,se.tZ)(y.Z,{type:"text",name:"name",allowClear:!0,value:Se.name,defaultValue:Se.name,placeholder:(0,w.t)("Please enter"),onChange:this.handleChange})))),(0,se.tZ)(v.Z,{title:(0,w.t)("Delete"),width:"40%",visible:s,onCancel:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})},footer:[(0,se.tZ)("div",{key:"id"},(0,se.tZ)(b.Z,null,(0,se.tZ)(Z.Z,{onClick:()=>{this.setState({delmodel:!1,delloading:!1,deldata:[]})}},(0,w.t)("Cancel")),(0,se.tZ)(Z.Z,{type:"primary",loading:n,onClick:()=>{this.delhandleOk()}},(0,w.t)("Confirm"))))]},0==i.length?(0,se.tZ)("span",null,(0,w.t)("Confirm to delete?")):(0,se.tZ)("div",null,(0,se.tZ)(_.Z,{message:(0,w.t)("Please delete the following content"),type:"warning",showIcon:!0}),(0,se.tZ)("div",{className:"srcolldel",style:{width:"100%",maxHeight:"700px",overflowX:"hidden",overflowY:"auto"}},i.map((e=>(0,se.tZ)("div",{key:e.id,style:{fontSize:"14px",marginTop:"10px",textIndent:"2em"}},e.title)))))),(0,se.tZ)(v.Z,{title:Se.Shift_menu,visible:d,destroyOnClose:!0,forceRender:!0,onCancel:()=>this.setState({isModalOpenShift:!1}),onOk:this.handleBlockShift,okText:(0,w.t)("Confirm"),cancelText:(0,w.t)("Cancel")},(0,se.tZ)(x.Z,{showSearch:!0,style:{width:"100%"},value:I,treeNodeFilterProp:"title",dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,w.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:this.selectonChange,treeData:S,treeIcon:!0,suffixIcon:(0,se.tZ)(C.default,null)})),(0,se.tZ)(me.Z,{resourceName:"chart"==H?"chart":"dashboard",resourceLabel:"chart"==H?(0,w.t)("chart"):(0,w.t)("dashboard"),passwordsNeededMessage:Ce,confirmOverwriteMessage:ke,addDangerToast:$,addSuccessToast:M,onModelImport:this.handleDashboardImport,show:D,onHide:this.closeDashboardImportModal,passwordFields:j,setPasswordFields:this.setPasswordFields,DealList:this.DealList}))}}Pe.propTypes=be;const Ie=(0,i.$j)(null,(function(e){return(0,n.DE)({updateDashboardChangedInfo:fe.Sr,updateChartChangedInfo:ve.updateChartChangedInfo},e)}))(Pe)},727989:(e,t,a)=>{a.d(t,{Z:()=>b});var s=a(150361),n=a.n(s),i=a(667294),o=a(748086),l=a(970553),r=a(751995),d=a(431069),h=a(455867),p=a(268084),c=a(835932),u=a(774069),m=a(49937),g=a(34858),y=a(762921),f=a(211965);const v=r.iK.div`
  display: block;
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,Z=r.iK.div`
  padding-bottom: ${({theme:e})=>2*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;

  & > div {
    margin: ${({theme:e})=>e.gridUnit}px 0;
  }

  &.extra-container {
    padding-top: 8px;
  }

  .confirm-overwrite {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }

  .input-container {
    display: flex;
    align-items: center;

    label {
      display: flex;
      margin-right: ${({theme:e})=>2*e.gridUnit}px;
    }

    i {
      margin: 0 ${({theme:e})=>e.gridUnit}px;
    }
  }

  input,
  textarea {
    flex: 1 1 auto;
  }

  textarea {
    height: 160px;
    resize: none;
  }

  input::placeholder,
  textarea::placeholder {
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }

  textarea,
  input[type='text'],
  input[type='number'] {
    padding: ${({theme:e})=>1.5*e.gridUnit}px
      ${({theme:e})=>2*e.gridUnit}px;
    border-style: none;
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-radius: ${({theme:e})=>e.gridUnit}px;

    &[name='name'] {
      flex: 0 1 auto;
      width: 40%;
    }

    &[name='sqlalchemy_uri'] {
      margin-right: ${({theme:e})=>3*e.gridUnit}px;
    }
  }
`,b=({resourceName:e,resourceLabel:t,passwordsNeededMessage:a,confirmOverwriteMessage:s,onModelImport:r,show:b,onHide:_,passwordFields:x=[],setPasswordFields:w=(()=>{}),DealList:S})=>{const[C,k]=(0,i.useState)(!0),[P,I]=(0,i.useState)(!1),[D,$]=(0,i.useState)({}),[M,j]=(0,i.useState)(!1),[E,N]=(0,i.useState)(!1),[O,T]=(0,i.useState)([]),[U,R]=(0,i.useState)(!1),[A,K]=(0,i.useState)(),[L,z]=(0,i.useState)([]),[F,B]=(0,i.useState)(null),[H,V]=(0,i.useState)([]),[J,q]=(0,i.useState)(null),[G,X]=(0,i.useState)([]),[Y,W]=(0,i.useState)(null),[Q,ee]=(0,i.useState)([]),[te,ae]=(0,i.useState)(null),se=()=>{T([]),w([]),$({}),j(!1),N(!1),R(!1),K(""),B(null),q(null),W(null),ae(null)};(0,i.useEffect)((()=>{b&&!P&&(ne("datasource"),"dataset"==e&&ne("dataset"),"chart"==e&&(ne("dataset"),ne("chart")),"dashboard"==e&&(ne("dataset"),ne("chart"),ne("dashboard")))}),[b]);const ne=e=>{d.Z.get({endpoint:`/api/v2/${e}/group/`}).then((t=>{if(200==t.json.meta.code||201==t.json.meta.code){const a=ie(n()(t.json.meta.data),"");"dataset"==e&&z(a),"datasource"==e&&V(a),"chart"==e&&X(a),"dashboard"==e&&ee(a),I(!0)}else I(!1),o.ZP.error(t.json.meta.message)}))},ie=(e,t)=>{const a=[];return e.forEach((e=>{const s={title:e.name,allname:`${t?t+"-":""}${e.name}`,key:e.group_id,value:e.group_id,disabled:e.perm<4,children:ie(e.children,e.name)};(!s.disabled||s.children.length>0)&&a.push(s)})),a},{state:{alreadyExists:oe,passwordsNeeded:le},importResource:re}=(0,g.PW)(e,t,(e=>{K(e)}));(0,i.useEffect)((()=>{w(le),le.length>0&&R(!1)}),[le,w]),(0,i.useEffect)((()=>{j(oe.length>0),oe.length>0&&R(!1)}),[oe,j]);const de=e=>{var t,a;const s=null!=(t=null==(a=e.currentTarget)?void 0:a.value)?t:"";N(s.toUpperCase()===(0,h.t)("OVERWRITE"))};C&&b&&k(!1);return(0,f.tZ)(u.Z,{name:"model",className:"import-model-modal",disablePrimaryButton:0===O.length||M&&!E||U,onHandledPrimaryAction:()=>{var t;if(!((null==(t=O[0])?void 0:t.originFileObj)instanceof File))return;let a=F,s=J,n=Y,i=te;return s&&("dataset"!=e||a)&&("chart"!=e||n||a)&&("dashboard"!=e||n||i||a)?(R(!0),re(O[0].originFileObj,D,E,a,s,n,i).then((e=>!!e&&(o.ZP.success((0,h.t)("success")),se(),r(),null==S||S(),!1))),!1):o.ZP.error((0,h.t)("Select Group"))},onHide:()=>{k(!0),_(),se()},primaryButtonName:M?(0,h.t)("Overwrite"):(0,h.t)("Import"),primaryButtonType:M?"danger":"primary",width:"750px",show:b,title:(0,f.tZ)("h4",null,(0,h.t)("Import %s",t))},(0,f.tZ)(Z,null,(0,f.tZ)("div",null,("chart"==e||"dashboard"==e||"dataset"==e)&&(0,f.tZ)("div",{style:{marginBottom:"20px"}},(0,f.tZ)("span",null,(0,f.tZ)("span",{style:{color:"red"}},"*"),(0,h.t)("dataset"),"\uff1a"),(0,f.tZ)(l.Z,{showSearch:!0,style:{width:"300px"},value:F,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,h.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{B(e)},treeData:L,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,f.tZ)(p.default,null)})),(0,f.tZ)("div",{style:{marginBottom:"20px"}},(0,f.tZ)("span",null,(0,f.tZ)("span",{style:{color:"red"}},"*"),(0,h.t)("database"),"\uff1a"),(0,f.tZ)(l.Z,{showSearch:!0,style:{width:"300px"},value:J,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,h.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{q(e)},treeData:H,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,f.tZ)(p.default,null)})),("chart"==e||"dashboard"==e)&&(0,f.tZ)("div",{style:{marginBottom:"20px"}},(0,f.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,f.tZ)("span",{style:{color:"red"}},"*"),(0,h.t)("chart"),"\uff1a"),(0,f.tZ)(l.Z,{showSearch:!0,style:{width:"300px"},value:Y,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,h.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{W(e)},treeData:G,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,f.tZ)(p.default,null)})),"dashboard"==e&&(0,f.tZ)("div",{style:{marginBottom:"20px"}},(0,f.tZ)("span",{style:{display:"inline-block",width:"62px"}},(0,f.tZ)("span",{style:{color:"red"}},"*"),(0,h.t)("dashboard"),"\uff1a"),(0,f.tZ)(l.Z,{showSearch:!0,style:{width:"300px"},value:te,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,h.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{ae(e)},treeData:Q,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,f.tZ)(p.default,null)})),(0,f.tZ)(m.gq,{name:"modelFile",id:"modelFile","data-test":"model-file-input",accept:".yaml,.json,.yml,.zip",fileList:O,onChange:e=>{T([{...e.file,status:"done"}])},onRemove:e=>(T(O.filter((t=>t.uid!==e.uid))),!1),customRequest:()=>{},disabled:U},(0,f.tZ)(c.Z,{loading:U},(0,h.t)("Select file"))))),A&&(0,f.tZ)(y.Z,{errorMessage:A,showDbInstallInstructions:x.length>0}),0===x.length?null:(0,f.tZ)(i.Fragment,null,(0,f.tZ)("h5",null,(0,h.t)("Database passwords")),(0,f.tZ)(v,null,a),x.map((e=>(0,f.tZ)(Z,{key:`password-for-${e}`},(0,f.tZ)("div",{className:"control-label"},e,(0,f.tZ)("span",{className:"required"},"*")),(0,f.tZ)("input",{name:`password-${e}`,autoComplete:`password-${e}`,type:"password",value:D[e],onChange:t=>$({...D,[e]:t.target.value})}))))),M?(0,f.tZ)(i.Fragment,null,(0,f.tZ)(Z,null,(0,f.tZ)("div",{className:"confirm-overwrite"},s),(0,f.tZ)("div",{className:"control-label"},(0,h.t)('Type "%s" to confirm',(0,h.t)("OVERWRITE"))),(0,f.tZ)("input",{"data-test":"overwrite-modal-input",id:"overwrite",type:"text",onChange:de}))):null)}}}]);