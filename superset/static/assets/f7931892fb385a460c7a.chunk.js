"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[33711],{941842:(e,t,n)=>{n.d(t,{Z:()=>s});n(667294);var l=n(925550),r=n(455867),i=n(211965);function s(e){const{listValueFilter:t,bcItemClick:n=(()=>{}),clearFilter:s=(()=>{}),styleCums:a={}}=e,o={position:"absolute",zIndex:1,...a};return(0,i.tZ)("div",{style:o},t.length>0&&(0,i.tZ)(l.Z,null,(0,i.tZ)(l.g,{onClick:()=>{s()}},(0,r.t)("Back to all")),t.map(((e,t)=>(0,i.tZ)(l.g,{onClick:()=>{n(e,t)}},e)))))}},925550:(e,t,n)=>{n.d(t,{Z:()=>a,g:()=>o});var l=n(205872),r=n.n(l),i=(n(667294),n(435247)),s=n(211965);const a=e=>(0,s.tZ)(i.Z,r()({},e,{css:e=>({".ant-breadcrumb-link":{cursor:"pointer"}})})),o=i.Z.Item},915872:(e,t,n)=>{n.d(t,{Z:()=>c});var l=n(667294),r=n(757016),i=n(751995),s=n(455867),a=n(683862),o=n(211965);const u=i.iK.div`
  ${({position:e})=>`\n    position: ${e.position};\n    left: ${e.left||0};\n    top: ${e.top||0};\n    z-index: 9999;\n    border: 1px #eee solid;\n\n\n    .ant-menu-submenu-active {\n      background: #5d9cec;\n    }\n\n    .ant-menu-submenu-active .ant-menu-submenu-title {\n      color: #ffffff;\n    }\n    \n    .ant-menu-submenu{\n      color:#000000 !important\n    }\n  `}
`,c=({position:e,showDiv:t,sliceJumpSetData:n=[],setShowDiv:i,clickProps:c,handleDrillingIn:d,handleProps:p})=>{const[h,f]=(0,l.useState)(!1),[m,g]=(0,l.useState)(""),[v,w]=(0,l.useState)(0),y=(e,t,r)=>(0,o.tZ)(l.Fragment,null,r?(0,o.tZ)(a.v2.SubMenu,{title:e,key:t,style:{color:"000"}},r.map(((e,t)=>y(e.name,`jump_${t}`)))):(0,o.tZ)(a.v2.Item,{key:t,onClick:e=>{(e=>{if(e.key.includes("jump")){const t=e.key.split("_"),l=n[t[1]];let r="";1===l.type&&(r=`${window.location.origin}/dashboard/list/?target_id=${l.config.treeValue}&standalone=true${l.config.list.map((e=>e.targetId?`&${e.targetId}=${c[e.sourceId.split("&&")[1]]?c[e.sourceId.split("&&")[1]]:""}`:"")).join("")}`),2===l.type&&l.config&&l.config.jumpUrl&&(r=l.config.jumpUrl.map((e=>e.children.map((e=>c[e.character]?c[e.character]:e.text||"")).join(""))).join("")),"1"===l.config.openType?window.open(r):(g(r),f(!0),i(!1))}else d&&d(p);i(!1)})(e)}},(0,s.t)(e)));return(0,l.useEffect)((()=>{n&&Array.isArray(n)?w(n.length):w(0)}),[n]),(0,l.useEffect)((()=>{document.addEventListener("click",(()=>{i(!1)}))}),[]),(0,o.tZ)(l.Fragment,null,t&&(0,o.tZ)(u,{position:e},(0,o.tZ)(a.v2,{"data-test":"menu-item-menu"},y("\u4e0b\u94bb","drilling_in"),v>0&&(0,o.tZ)(l.Fragment,null,v>1?y((0,s.t)("Jumo to"),"jump",n):y(`${(0,s.t)("Jumo to")}${n[0].name}`,"jump_0")))),(0,o.tZ)(r.Z,{title:null,closable:!1,visible:h,width:"95%",style:{top:20,height:"90vh"},footer:null,onCancel:()=>f(!1)},(0,o.tZ)("iframe",{src:m,title:"myIframe",width:"800",height:"750",frameborder:"0",scrolling:"yes",name:"myIframe",id:"myIframe",sandbox:"allow-scripts allow-same-origin"})))}},33711:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var l=n(150361),r=n.n(l),i=n(667294),s=n(281928),a=n(753506),o=n(455867),u=n(263475),c=n(499381),d=n(915872),p=n(748086),h=n(941842),f=n(211965);function m(e){const{height:t,width:n,echartOptions:l,setDataMask:m,labelMap:g,groupby:v,selectedValues:w,refs:y,emitCrossFilters:b,formData:Z,ownState:S}=e,{enableChartDrilldown:k,drilldownColumns:I=[],vizType:C}=Z,{listValueFilter:D=[]}=S,[E,F]=(0,i.useState)(!1),[$,x]=(0,i.useState)({}),[j,O]=(0,i.useState)({}),[V,J]=(0,i.useState)({values:[],props:{}}),{sliceJumpSetData:A,sliceJumpType:T}=(null==Z?void 0:Z.meta)||{};(0,i.useEffect)((()=>{m({ownState:{}})}),[JSON.stringify(Z.xAxis),JSON.stringify(Z.metrics),JSON.stringify(v),JSON.stringify(Z.adhocFilters),k,JSON.stringify(I)]);const M=(0,i.useCallback)(((e,t)=>{if(!b&&!Z.drillDown)return;const n=e.map((e=>g[e]));let l={};if(Z.emitFilter&&(l={extraFormData:{filters:0===e.length?[]:v.map(((e,t)=>({col:e,op:"IN",val:n.map((e=>e[t]))})))},filterState:{value:n.length?n:null,selectedValues:e.length?e:null}}),Z.drillDown&&null!=S&&S.drilldown){const t=s.Z.drillDown(null==S?void 0:S.drilldown,e[0]);l={extraFormData:{filters:t.filters},filterState:{value:n.length&&t.filters.length>0?n:null},ownState:{drilldown:t}}}m(l)}),[v,g,m,w]),N=(0,i.useCallback)((()=>{M(V.values,V.props)}),[M,V.values,V.props]),z=(0,c.C0)(e,((e=[],t)=>{const{componentType:n}=t,l=t;if(l.name&&k&&(0,a.Z)(C)){const e=[...v,...I];if(D.length>=e.length-1)return void p.ZP.warning((0,o.t)("It has reached the deepest level"));const t=r()(D);return t.push(l.name),void m({ownState:{listValueFilter:t}})}var i,s,u;"series"===n&&(A&&Array.isArray(A)&&A.length>0&&T?(x({position:"absolute",left:`${null==(i=t.event)?void 0:i.offsetX}px`,top:`${null==(s=t.event)?void 0:s.offsetY}px`}),O({[Z.groupby[0]]:t.data.name,[null==Z||null==(u=Z.metric)?void 0:u.label]:t.data.value}),setTimeout((()=>{F(!0)}),0)):M(e,t));J({values:e,dataObj:t})}));return(0,f.tZ)(i.Fragment,null,(0,f.tZ)(h.Z,{listValueFilter:D,bcItemClick:(e,t)=>{const n=D.filter(((e,n)=>n<=t));m({ownState:{listValueFilter:n}})},clearFilter:()=>{m({ownState:{}})}}),(0,f.tZ)(u.Z,{refs:y,height:t,width:n,echartOptions:l,eventHandlers:z,selectedValues:w}),(0,f.tZ)(d.Z,{position:$,showDiv:E,sliceJumpSetData:A,setShowDiv:F,clickProps:j,handleProps:j,handleDrillingIn:N}))}},263475:(e,t,n)=>{n.d(t,{Z:()=>u});var l=n(667294),r=n(751995),i=n(53552),s=n(211965);const a=r.iK.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function o({width:e,height:t,echartOptions:n,eventHandlers:r,zrEventHandlers:o,selectedValues:u={},refs:c},d){const p=(0,l.useRef)(null);c&&(c.divRef=p);const h=(0,l.useRef)(),f=(0,l.useMemo)((()=>Object.keys(u)||[]),[u]),m=(0,l.useRef)([]);(0,l.useImperativeHandle)(d,(()=>({getEchartInstance:()=>h.current}))),(0,l.useEffect)((()=>{p.current&&(h.current||(h.current=(0,i.S1)(p.current)),Object.entries(r||{}).forEach((([e,t])=>{var n,l;null==(n=h.current)||n.off(e),null==(l=h.current)||l.on(e,t)})),Object.entries(o||{}).forEach((([e,t])=>{var n,l;null==(n=h.current)||n.getZr().off(e),null==(l=h.current)||l.getZr().on(e,t)})),h.current.setOption(n,!0))}),[n,r,o]),(0,l.useEffect)((()=>{h.current&&(h.current.dispatchAction({type:"downplay",dataIndex:m.current.filter((e=>!f.includes(e)))}),f.length&&h.current.dispatchAction({type:"highlight",dataIndex:f}),h.current.dispatchAction({type:"hideTip"}),m.current=f)}),[f]);const g=(0,l.useCallback)((({width:e,height:t})=>{h.current&&h.current.resize({width:e,height:t})}),[]);return(0,l.useEffect)((()=>{if(!h.current)return;const e=()=>{h.current&&h.current.dispatchAction({type:"hideTip"})};return window.addEventListener("message",(t=>{"share-page-scroll"===t.data.type&&e()})),()=>{window.removeEventListener("message",e)}}),[h.current]),(0,l.useEffect)((()=>(g({width:e,height:t}),()=>{var e;return null==(e=h.current)?void 0:e.dispose()})),[]),(0,l.useLayoutEffect)((()=>{g({width:e,height:t})}),[e,t,g]),(0,s.tZ)(a,{ref:p,height:t,width:e})}const u=(0,l.forwardRef)(o)},499381:(e,t,n)=>{n.d(t,{C0:()=>i});const l=(e,t)=>n=>{const{name:l}=n,r=Object.values(e);r.includes(l)?t(r.filter((e=>e!==l)),n):t([l],n)},r=(e,t,n)=>l=>{if(t){l.event.stop();const r=l.event.event,i=[];if(e.length>0){const t=n[l.name];e.forEach(((e,n)=>i.push({col:e,op:"==",val:t[n],formattedVal:String(t[n])})))}t(r.clientX,r.clientY,i)}},i=(e,t)=>{const{groupby:n,selectedValues:i,onContextMenu:s,labelMap:a}=e;return{click:l(i,t),contextmenu:r(n,s,a)}}}}]);