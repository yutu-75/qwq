"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[94109],{888154:(t,e,n)=>{n.d(e,{Z:()=>r});var a=n(205872),i=n.n(a),s=n(667294),l=n(970553),o=n(211965);const r=({onChange:t,treeData:e=[],allowNewOptions:n,...a})=>{const[r,d]=(0,s.useState)(""),[c,p]=(0,s.useState)([]),[h,u]=(0,s.useState)([]),g=(t,e)=>{const n=t.indexOf(e),a=t.substr(0,n),i=t.substr(n+e.length);return n>-1?(0,o.tZ)("span",{"test-data":t,style:{color:"#000"}},a,(0,o.tZ)("span",{style:{color:"#f50"}},e),i):(0,o.tZ)("span",{"test-data":t,style:{color:"#000"}},t)},b=(t=[],e,n=!1)=>{if(!t||!e)return t;const a=[];return t.forEach((t=>{t.title.includes(e)?a.push({...t,title:g(t.title,e),children:b(t.children,e,!0)}):t.children&&t.children.length>0?n?(t.children=b(t.children,e,n),a.push({...t,title:g(t.title,e)})):(t.children=b(t.children,e),t.children.length>0&&a.push({...t,title:g(t.title,e)})):n&&a.push({...t,title:g(t.title,e)})})),a},w=(0,s.useMemo)((()=>{if(n){if(r){const t=b(JSON.parse(JSON.stringify(h)),r);return t.length?t:(u([{title:r,value:r},...e]),[{title:r,value:r}])}return"string"===typeof a.value?[{title:a.value,value:a.value},...e]:h}return b(JSON.parse(JSON.stringify(h)),r)}),[r,h]);return(0,s.useEffect)((()=>{"number"===typeof a.value&&u(e)}),[a.value]),(0,s.useEffect)((()=>{if(r){const t=b(JSON.parse(JSON.stringify(e)),r),n=t=>{let e=[];return t.forEach((t=>{e.push(t.value),t.children&&(e=e.concat(n(t.children)))})),e},a=n(t);p(a)}else p([])}),[e,r]),(0,s.useEffect)((()=>{u(e)}),[e]),(0,o.tZ)(l.Z,i()({filterTreeNode:()=>!0,treeExpandedKeys:c,onChange:e=>{d(""),t&&(a.labelInValue?t({...e,label:"string"===typeof e.label?e.label:e.label.props["test-data"]}):t(e))},treeData:w,onTreeExpand:t=>p(t),onSearch:t=>d(t)},a))}},976499:(t,e,n)=>{n.r(e),n.d(e,{ChartCreation:()=>z,default:()=>C});var a=n(667294),i=n(517563),s=n(751995),l=n(455867),o=n(237731),r=n(431069),d=n(667496),c=n(23525),p=n(427600),h=n(616550),u=n(835932),g=n(49937),b=n(358593),w=n(414114),m=n(13284),f=n(212617),x=n(920292),y=n(454076),v=n(888154),$=n(211965);const Z=(0,x.Z)().common.conf.VIZ_TYPE_DENYLIST||[],S=s.iK.div`
  ${({theme:t})=>`\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${m.UB}px;\n    max-height: calc(100vh - 56px);\n    border-radius: ${t.gridUnit}px;\n    background-color: ${t.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-top: 50px;\n    padding-left: ${4*t.gridUnit}px;\n    padding-right: ${4*t.gridUnit}px;\n    padding-bottom: ${4*t.gridUnit}px;\n\n    h3 {\n      padding-bottom: ${3*t.gridUnit}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${t.colors.grayscale.light1};\n        margin-left: ${4*t.gridUnit}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${t.colors.grayscale.light2};\n      border-radius: ${t.gridUnit}px;\n      margin: ${t.gridUnit}px 0px;\n      max-height: calc(100vh - 306px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${t.colors.grayscale.light1};\n        margin-right: ${4*t.gridUnit}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${2*t.gridUnit}px;\n      width: ${5*t.gridUnit}px;\n      height: ${5*t.gridUnit}px;\n      line-height: ${5*t.gridUnit}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${5*t.gridUnit}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${t.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${3*t.gridUnit}px;\n    }\n  `}
`,_=s.iK.div`
  ${({theme:t,hasDescription:e})=>`\n    .tooltip-header {\n      font-size: ${e?t.typography.sizes.l:t.typography.sizes.s}px;\n      font-weight: ${e?t.typography.weights.bold:t.typography.weights.normal};\n    }\n\n    .tooltip-description {\n      margin-top: ${2*t.gridUnit}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}
`,D=s.iK.span`
  ${({theme:t})=>`\n    position: absolute;\n    left: ${3*t.gridUnit}px;\n    right: ${3*t.gridUnit}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `}
`,T=s.iK.span`
  ${({theme:{typography:{sizes:t,weights:e}}})=>`\n      font-size: ${t.m}px;\n      font-weight: ${e.bold};\n    `}
`,U=s.iK.div`
  ${({theme:{gridUnit:t}})=>`\n    margin-top: ${4*t}px;\n    margin-bottom: ${3*t}px;\n  `}
`;class z extends a.PureComponent{constructor(t){super(t),this.state={vizType:null,canCreateDataset:(0,f.R)("can_write","Dataset",t.user.roles),chartTreeOptions:[]},this.changeDatasource=this.changeDatasource.bind(this),this.changeVizType=this.changeVizType.bind(this),this.gotoSlice=this.gotoSlice.bind(this),this.newLabel=this.newLabel.bind(this),this.loadDatasources=this.loadDatasources.bind(this),this.onVizTypeDoubleClick=this.onVizTypeDoubleClick.bind(this),this.loadDatasources()}componentDidMount(){var t;if((null==(t=i.parse(window.location.search))?void 0:t.dataset)&&(this.loadDatasources(),this.props.addSuccessToast((0,l.t)("The dataset has been saved"))),(0,y.w)()){const t=new URLSearchParams(window.parent.location.search),e=t.get("table_name"),n=t.get("table_id");e&&n&&this.setState({datasource:{label:e,value:`${n}__table`}})}else{const t=new URLSearchParams(window.location.search),e=t.get("table_name"),n=t.get("table_id");e&&n&&this.setState({datasource:{label:e,value:`${n}__table`}})}}exploreUrl(){var t;const e=(0,c.eY)(p.KD.dashboardId);let n=(0,d.VU)(`/explore/?viz_type=${this.state.vizType}&datasource=${null==(t=this.state.datasource)?void 0:t.value}`);return(0,o.Z)(e)&&(n+=`&dashboard_id=${e}`),n}gotoSlice(){let t=this.exploreUrl();(0,y.w)()&&(t=`${t}&standalone=true`),window.location.href=t}changeDatasource(t){this.setState({datasource:t})}changeVizType(t){this.setState({vizType:t})}isBtnDisabled(){var t;return!(null!=(t=this.state.datasource)&&t.value&&this.state.vizType)}onVizTypeDoubleClick(){this.isBtnDisabled()||this.gotoSlice()}newLabel(t){return(0,$.tZ)(b.u,{mouseEnterDelay:1,placement:"right",title:(0,$.tZ)(_,{hasDescription:!!t.description},(0,$.tZ)("div",{className:"tooltip-header"},t.custom_name),t.description&&(0,$.tZ)("div",{className:"tooltip-description"},t.description))},(0,$.tZ)(D,null,t.custom_name))}loadDatasources(){r.Z.get({endpoint:"/api/v2/dataset/group/"}).then((t=>{const e=t.json.meta.data||[],n=t=>t.map((t=>({title:t.name,value:t.group_id,selectable:!1,children:[...n(t.children),...t.datasets.map((t=>({title:t.dataset_name,value:`${t.dataset_id}__table`})))]}))),a=n(e);this.setState({chartTreeOptions:a})}))}render(){var t;const e=()=>{if((0,y.w)())return window.open(`/exceltodatabaseview/form?standalone=true&table_entry=data&table_source=excel&redict_url=${window.parent.location.href}`);window.open(`/exceltodatabaseview/form?standalone=true&table_entry=data&table_source=excel&redict_url=${window.location.pathname+window.location.search}`)},n=()=>{if((0,y.w)())return window.open(`/csvtodatabaseview/form?standalone=true&table_entry=data&table_source=csv&redict_url=${window.parent.location.href}`);window.open(`/csvtodatabaseview/form?standalone=true&table_entry=data&table_source=csv&redict_url=${window.location.pathname+window.location.search}`)},i=this.isBtnDisabled();return(0,$.tZ)(S,null,(0,$.tZ)("h3",null,(0,l.t)("Create a new chart")),(0,$.tZ)(g.Rg,{direction:"vertical",size:"small"},(0,$.tZ)(g.Rg.Step,{title:(0,$.tZ)(T,null,(0,l.t)("Select a dataset")),status:null!=(t=this.state.datasource)&&t.value?"finish":"process",description:(0,$.tZ)(U,{className:"dataset"},(0,$.tZ)(v.Z,{dropdownRender:t=>(0,$.tZ)(a.Fragment,null,(0,y.w)()&&(0,$.tZ)(g.T,{style:{padding:"0 8px 4px"}},(0,$.tZ)(u.Z,{type:"text",onClick:e},"\u672c\u5730Excel\u5bfc\u5165"),(0,$.tZ)(u.Z,{type:"text",onClick:n},"\u672c\u5730CSV\u6587\u4ef6\u5bfc\u5165")),t),autoFocus:!0,ariaLabel:(0,l.t)("Dataset"),name:"select-datasource",onChange:this.changeDatasource,placeholder:(0,l.t)("Select a dataset"),showSearch:!0,value:this.state.datasource,allowClear:!0,labelInValue:!0,treeData:this.state.chartTreeOptions||[]}))}),(0,$.tZ)(g.Rg.Step,{title:(0,$.tZ)(T,null,(0,l.t)("Select a chart")),status:this.state.vizType?"finish":"process",description:(0,$.tZ)(U,null,(0,$.tZ)(m.ZP,{denyList:Z,className:"viz-gallery",onChange:this.changeVizType,onDoubleClick:this.onVizTypeDoubleClick,selectedViz:this.state.vizType}))})),(0,$.tZ)("div",{className:"footer"},i&&(0,$.tZ)("span",null,(0,l.t)("Please select both a Dataset and a Chart type to proceed")),(0,$.tZ)(u.Z,{buttonStyle:"primary",disabled:i,onClick:this.gotoSlice},(0,l.t)("Create new chart"))))}}const C=(0,h.EN)((0,w.ZP)(z))}}]);