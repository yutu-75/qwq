"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7273],{807273:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var n=a(205872),l=a.n(n),o=a(23279),i=a.n(o),s=a(667294),r=a(355786),u=a(310581),d=a(662720),c=a(616355),p=a(890057),h=a(49937),f=a(174448),m=a(356080),g=a(828216),v=a(52004),b=a(981945),y=a(923313),x=a(609676),C=a(814277),S=a(226618),Z=a(211965);const k=e=>{const{formData:t,options:a,filterState:n,handleChange:l,popupList:o,setPopupList:i}=e,r=(0,g.v9)((e=>e.dashboardState.mobileFilterType)),u={position:"absolute",borderRadius:"10px 0 0 10px"},d={minWidth:"60px",width:"100%",height:"30px",lineHeight:"15px",textAlign:"center",fontSize:"12px",background:"#f0f2f5",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},[c,p]=(0,s.useState)(!1),[h,f]=(0,s.useState)(""),[m,v]=(0,s.useState)([]),[k,I]=(0,s.useState)(!1),[w,E]=(0,s.useState)(!1),[_,D]=(0,s.useState)(null),O=(e=[])=>{v(e),I(!!e.length&&e.length<a.length),E(e.length===a.length)},z=(0,s.useCallback)((()=>{"vertical"===r?i(m):l(m),p(!1)}),[m,o]),A=(0,s.useCallback)((()=>{O("vertical"===r?o:(null==n?void 0:n.value)||[])}),[o]),M=(0,s.useMemo)((()=>null==a?void 0:a.filter((e=>{var t;return null==e||null==(t=e.label)?void 0:t.includes(h)}))),[a,h]);let T=null;const F=e=>t=>{t.preventDefault(),T=setTimeout((()=>{D(e)}),500)},N=()=>{D(null),clearTimeout(T)},L=(0,s.useCallback)((e=>{i((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))}),[]),j=(0,s.useCallback)((()=>{v(o),p(!0)}),[o]);return(0,Z.tZ)("div",null,"vertical"===r?(0,Z.tZ)(b.UO,{defaultActiveKey:[t.ftId]},(0,Z.tZ)(b.UO.Panel,{key:t.ftId,title:(0,Z.tZ)("span",{style:{fontSize:"16px",marginLeft:"5px"}},t.ftName," ",(0,Z.tZ)("span",{style:{fontSize:"10px"}},"\u591a\u9009"))},(0,Z.tZ)(b.rj,{columns:3,gap:8},a.slice(0,7).map(((e,t)=>(0,Z.tZ)(b.rj.Item,{key:`${t}-${e.label}`},(0,Z.tZ)(b.J2,{content:e.label||e.value,visible:_===e.value},(0,Z.tZ)(b.zx,{style:{...d,background:o.includes(e.value)?S.Fu:"#f0f2f5",color:o.includes(e.value)?S.zP:"#000000"},shape:"rounded",onClick:()=>L(e.value),onTouchStart:F(e.value),onTouchEnd:N,onMouseDown:F(e.value),onMouseUp:N},e.label))))),a.length>8&&(0,Z.tZ)(b.rj.Item,{span:1},(0,Z.tZ)(b.zx,{shape:"rounded",onClick:j,style:{...d}},"\u5c55\u5f00"))))):(0,Z.tZ)("div",{onClick:()=>{p(!0),O((null==n?void 0:n.value)||[])},style:{height:"45px",lineHeight:"45px"}},(0,Z.tZ)("span",{style:{marginRight:"2px"}},null==t?void 0:t.ftName),(0,Z.tZ)(y.Z,null)),(0,Z.tZ)(b.GI,{visible:c,position:"right",style:{...u,width:"100%",top:0,bottom:0,right:0,zIndex:99},maskStyle:{...u},bodyStyle:{...u,width:"calc(100% - 60px)"},getContainer:document.getElementById("mobile-body-container"),onMaskClick:()=>p(!1)},(0,Z.tZ)("div",{css:()=>"\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        height: 100%;\n        padding: 16px;\n        background-color: white;\n        border-radius: 10px 0 0 10px;\n\n        .adm-input-element {\n          font-size: 12px;\n          line-height: 2.5;\n        }\n      "},(0,Z.tZ)("div",{style:{textAlign:"center",paddingBottom:"10px",fontSize:"18px"}},null==t?void 0:t.ftName),(0,Z.tZ)("div",{style:{borderRadius:"30px",backgroundColor:"#f5f5f5f5",height:"30px"}},(0,Z.tZ)(b.II,{clearable:!0,value:h,onChange:e=>f(e),placeholder:"\u8f93\u5165\u5173\u952e\u5b57\u641c\u7d22",style:{"--text-align":"center",fontSize:"14px"}})),(0,Z.tZ)("div",{css:()=>"\n          flex: 1;\n          overflow: auto auto;\n\n          .ant-checkbox-group {\n            display: block;\n          }\n\n          .ant-checkbox-group-item {\n            display: block;\n            padding: 9px 0;\n            border-bottom: 1px solid #cccccc36;\n          }\n        "},(0,Z.tZ)(x.Z,{indeterminate:k,onChange:e=>{v(e.target.checked?a.map((e=>e.value)):[]),I(!1),E(e.target.checked)},checked:w,style:{padding:"10px 0",marginRight:"8px",width:"100%",borderBottom:"1px solid #cccccc36"}},"\u5168\u9009",m.length,"/",a.length),M.length>0?(0,Z.tZ)(x.Z.Group,{options:M,value:m,onChange:O}):(0,Z.tZ)(C.Z,{description:"\u6682\u65e0\u6570\u636e"})),(0,Z.tZ)("div",{style:{display:"flex",justifyContent:"space-around"}},(0,Z.tZ)(b.zx,{size:"small",style:{paddingInline:"6px",width:"100%",marginRight:16},onClick:A},"\u91cd\u7f6e"),(0,Z.tZ)(b.zx,{size:"small",style:{paddingInline:"6px",width:"100%"},color:"primary",onClick:z},"\u4fdd\u5b58")))))};var I=a(542170),w=a(909467),E=a(68969);function _(e,t){return"filterDynamicColumn"===t.type?(e.extraFormData=t.extraFormData,e.__cache=t.__cache,e.filterState={...e.filterState,...t.filterState},e):e}function D(e){const{coltypeMap:t,data:a,filterState:n,formData:o,height:b,width:y,setDataMask:x,appSection:C}=e,S=(0,g.v9)((e=>e.dashboardState.mobileFilterStatus));o.defaultValue=(0,g.v9)((e=>{const t=[];return o.scopeBindDatasetAndColumn&&o.scopeBindDatasetAndColumn.length>0&&o.scopeBindDatasetAndColumn.forEach((a=>{if("object"==typeof a.tableColumnChoose&&a.nodeTreeId){const n=e.sliceEntities.slices[a.nodeTreeId]||{},l=a.tableColumnChoose.map((e=>e.value));"pivot_table_v2"===n.form_data.viz_type?t.push(...l.filter((e=>n.form_data.groupbyColumns.includes(e)))):t.push(...l.filter((e=>n.form_data.groupby.includes(e))))}})),Array.from(new Set(t))}));const D=(0,g.I0)(),[O,z]=(0,s.useState)(o.defaultValue),[A,M]=(0,s.useState)([]),[T,F]=(0,s.useState)(n.value||[]);(0,s.useEffect)((()=>{sessionStorage.setItem("popupList",JSON.stringify(T))}),[T]);const{enableEmptyFilter:N,inverseSelection:L,defaultToFirstItem:j,scopeBindDatasetAndColumn:B}=o,J=(0,s.useMemo)((()=>(0,r.Z)(o.groupby).map(u.Z)),[o.groupby]),[R]=J,[G,$]=(0,p.C)(_,{extraFormData:{},filterState:n}),K=t[R],P=(0,s.useMemo)((()=>(0,m.EG)({timeFormatter:d.Z})),[]);(0,s.useEffect)((()=>{const e=[];B&&B.length>0&&B.forEach((t=>{Array.isArray(t.tableColumnChoose)&&t.tableColumnChoose.forEach((t=>{e.push(JSON.stringify(t))}))}));const t=Array.from(new Set(e)),a=[];t.forEach((e=>{a.push(JSON.parse(e))})),M(a)}),[B]);const U=(0,s.useCallback)((e=>{const t=!e;$({type:"filterDynamicColumn",__cache:n,extraFormData:(0,m.XX)(R,e,t,L),filterState:{...n,value:C===c.Tr.FILTER_CONFIG_MODAL&&j?[]:e}})}),[C,R,K,j,$,N,L,JSON.stringify(n),P]),V=C===c.Tr.FILTER_CONFIG_MODAL&&j,H=(0,s.useCallback)((e=>{Q(e||[]),z(e),X(e)}),[U]),X=(0,s.useCallback)(i()((e=>{U(e)}),100),[]);(0,I.Z)((()=>{S.confirm&&!S.reset?((()=>{const e=JSON.parse(sessionStorage.getItem("popupList")||"{}");H(e)})(),D((0,w.rE)({confirm:!1,reset:!1}))):!S.confirm&&S.reset&&F([])}),[JSON.stringify(S)]),(0,s.useEffect)((()=>{U(n.value)}),[R,V,j,N,L,U,a,JSON.stringify(n.value)]),(0,s.useEffect)((()=>{x(G)}),[JSON.stringify(G)]);const W=(0,s.useMemo)((()=>{if(n.validateMessage)return(0,Z.tZ)(f.Am,{status:n.validateStatus},n.validateMessage)}),[n.validateMessage,n.validateStatus]),q=(0,g.v9)((e=>{var t,a;return null==(t=e.dashboardInfo)||null==(a=t.metadata)?void 0:a.layout_mode})),Q=e=>{B&&B.length>0&&B.forEach((t=>{const a=[];e&&"object"==typeof e&&e.forEach((e=>{if("object"==typeof t.tableColumnChoose){t.tableColumnChoose.find((t=>e==t.value))&&a.push(e)}})),D((0,E._t)(t.nodeTreeId,a))}))};return q===v.kB.MOBILE?(0,Z.tZ)("div",null,(0,Z.tZ)(k,l()({},e,{options:A,handleChange:H,popupList:T,setPopupList:F}))):(0,Z.tZ)(f.un,{height:b,width:y},(0,Z.tZ)(f.jp,{validateStatus:n.validateStatus,extra:W},(0,Z.tZ)(h.r4.Group,{defaultValue:O||n.value,options:A,onChange:H})))}},174448:(e,t,a)=>{a.d(t,{Am:()=>s,jp:()=>i,un:()=>o});var n=a(751995),l=a(804591);const o=n.iK.div`
  min-height: ${({height:e})=>e}px;
  width: ${({width:e})=>e}px;
`,i=(0,n.iK)(l.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,s=n.iK.div`
  color: ${({theme:e,status:t="error"})=>{var a;return null==(a=e.colors[t])?void 0:a.base}};
`}}]);