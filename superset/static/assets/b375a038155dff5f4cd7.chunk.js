/*! For license information please see b375a038155dff5f4cd7.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[60452,39541],{762529:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r=n(896156),o=n(190484),i=n(722122),a=n(667294),s=n(560444),l=n(294184),d=n.n(l),u=n(428481),c=n(65632),p=n(796159),h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function f(e){return e?e.toString().split("").reverse().map((function(e){var t=Number(e);return isNaN(t)?e:t})):[]}const g=function(e){var t=e.prefixCls,n=e.count,r=e.className,o=e.style,s=e.title,l=e.show,g=e.component,m=void 0===g?"sup":g,v=e.children,b=e.onAnimated,y=void 0===b?function(){}:b,x=h(e,["prefixCls","count","className","style","title","show","component","children","onAnimated"]),C=(0,a.useState)(!0),w=(0,u.Z)(C,2),S=w[0],Z=w[1],k=(0,a.useState)(n),M=(0,u.Z)(k,2),D=M[0],E=M[1],R=(0,a.useState)(n),T=(0,u.Z)(R,2),_=T[0],I=T[1],O=(0,a.useState)(n),P=(0,u.Z)(O,2),z=P[0],F=P[1],N=(0,a.useContext(c.E_).getPrefixCls)("scroll-number",t);_!==n&&(Z(!0),I(n)),a.useEffect((function(){var e;return F(D),S&&(e=setTimeout((function(){Z(!1),E(n),y()}))),function(){e&&clearTimeout(e)}}),[S,n,y]);var $=(0,i.Z)((0,i.Z)({},x),{"data-show":l,style:o,className:d()(N,r),title:s}),L=function(e,t){if("number"===typeof e){var n=function(e,t){var n=Math.abs(Number(D)),r=Math.abs(Number(z)),o=Math.abs(f(D)[t]),i=Math.abs(f(r)[t]);return S?10+e:n>r?o>=i?10+e:20+e:o<=i?10+e:e}(e,t),r=S||void 0===f(z)[t];return a.createElement("span",{className:"".concat(N,"-only"),style:{transition:r?"none":void 0,msTransform:"translateY(".concat(100*-n,"%)"),WebkitTransform:"translateY(".concat(100*-n,"%)"),transform:"translateY(".concat(100*-n,"%)")},key:t},function(e,t){for(var n=[],r=0;r<30;r++)n.push(a.createElement("p",{key:r.toString(),className:d()(t,{current:e===r})},r%10));return n}(n,"".concat(N,"-only-unit")))}return a.createElement("span",{key:"symbol",className:"".concat(N,"-symbol")},e)},B=D&&Number(D)%1===0?f(D).map((function(e,t){return L(e,t)})).reverse():D;return o&&o.borderColor&&($.style=(0,i.Z)((0,i.Z)({},o),{boxShadow:"0 0 0 1px ".concat(o.borderColor," inset")})),v?(0,p.Tm)(v,(function(e){return{className:d()("".concat(N,"-custom-component"),null===e||void 0===e?void 0:e.className)}})):a.createElement(m,$,B)};var m=n(798787);function v(e){return-1!==m.Y.indexOf(e)}var b=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},y=function(e){var t,n,l=e.prefixCls,u=e.scrollNumberPrefixCls,h=e.children,f=e.status,m=e.text,y=e.color,x=e.count,C=void 0===x?null:x,w=e.overflowCount,S=void 0===w?99:w,Z=e.dot,k=void 0!==Z&&Z,M=e.size,D=void 0===M?"default":M,E=e.title,R=e.offset,T=e.style,_=e.className,I=e.showZero,O=void 0!==I&&I,P=b(e,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","showZero"]),z=a.useContext(c.E_),F=z.getPrefixCls,N=z.direction,$=F("badge",l),L=C>S?"".concat(S,"+"):C,B=null!==f&&void 0!==f||null!==y&&void 0!==y,A="0"===L||0===L,j=k&&!A||B,H=j?"":L,q=(0,a.useMemo)((function(){return(null===H||void 0===H||""===H||A&&!O)&&!j}),[H,A,O,j]),U=(0,a.useRef)(H);q||(U.current=H);var V=U.current,W=(0,a.useRef)(j);q||(W.current=j);var G=(0,a.useMemo)((function(){if(!R)return(0,i.Z)({},T);var e={marginTop:R[1]};return"rtl"===N?e.left=parseInt(R[0],10):e.right=-parseInt(R[0],10),(0,i.Z)((0,i.Z)({},e),T)}),[N,R,T]),K=null!==E&&void 0!==E?E:"string"===typeof C||"number"===typeof C?C:void 0,Y=q||!m?null:a.createElement("span",{className:"".concat($,"-status-text")},m),X=C&&"object"===(0,o.Z)(C)?(0,p.Tm)(C,(function(e){return{style:(0,i.Z)((0,i.Z)({},G),e.style)}})):void 0,Q=d()((t={},(0,r.Z)(t,"".concat($,"-status-dot"),B),(0,r.Z)(t,"".concat($,"-status-").concat(f),!!f),(0,r.Z)(t,"".concat($,"-status-").concat(y),v(y)),t)),J={};y&&!v(y)&&(J.background=y);var ee=d()($,(n={},(0,r.Z)(n,"".concat($,"-status"),B),(0,r.Z)(n,"".concat($,"-not-a-wrapper"),!h),(0,r.Z)(n,"".concat($,"-rtl"),"rtl"===N),n),_);if(!h&&B){var te=G.color;return a.createElement("span",(0,i.Z)({},P,{className:ee,style:G}),a.createElement("span",{className:Q,style:J}),a.createElement("span",{style:{color:te},className:"".concat($,"-status-text")},m))}return a.createElement("span",(0,i.Z)({},P,{className:ee}),h,a.createElement(s.default,{visible:!q,motionName:"".concat($,"-zoom"),motionAppear:!1},(function(e){var t,n=e.className,o=F("scroll-number",u),s=W.current,l=d()((t={},(0,r.Z)(t,"".concat($,"-dot"),s),(0,r.Z)(t,"".concat($,"-count"),!s),(0,r.Z)(t,"".concat($,"-count-sm"),"small"===D),(0,r.Z)(t,"".concat($,"-multiple-words"),!s&&V&&(null===V||void 0===V?void 0:V.toString().length)>1),(0,r.Z)(t,"".concat($,"-status-").concat(f),!!f),(0,r.Z)(t,"".concat($,"-status-").concat(y),v(y)),t)),c=(0,i.Z)({},G);return y&&!v(y)&&((c=c||{}).background=y),a.createElement(g,{prefixCls:o,show:!q,className:d()(n,l),count:V,title:K,style:c,key:"scrollNumber"},X)})),Y)};y.Ribbon=function(e){var t,n=e.className,o=e.prefixCls,s=e.style,l=e.color,u=e.children,p=e.text,h=e.placement,f=void 0===h?"end":h,g=a.useContext(c.E_),m=g.getPrefixCls,b=g.direction,y=m("ribbon",o),x=v(l),C=d()(y,"".concat(y,"-placement-").concat(f),(t={},(0,r.Z)(t,"".concat(y,"-rtl"),"rtl"===b),(0,r.Z)(t,"".concat(y,"-color-").concat(l),x),t),n),w={},S={};return l&&!x&&(w.background=l,S.color=l),a.createElement("div",{className:"".concat(y,"-wrapper")},u,a.createElement("div",{className:C,style:(0,i.Z)((0,i.Z)({},w),s)},a.createElement("span",{className:"".concat(y,"-text")},p),a.createElement("div",{className:"".concat(y,"-corner"),style:S})))};const x=y},925550:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s,g:()=>l});var r=n(205872),o=n.n(r),i=(n(667294),n(435247)),a=n(211965);const s=e=>(0,a.tZ)(i.Z,o()({},e,{css:e=>({".ant-breadcrumb-link":{cursor:"pointer"}})})),l=i.Z.Item},676986:(e,t,n)=>{"use strict";var r=n(431069);window.waterMark=function(e){e=Object.assign({},{content:" XHM",fontSize:"16px",opacity:.5,rotate:"-10",color:"#adadad",canId:"ramdonCanId",spacing:10,modalId:"handle-water-mark-todo"},e),r.Z.get({endpoint:"/api/v2/sys/config?type=WATER_MARK"}).then((t=>{var n,r;const o=(null==t||null==(n=t.json)||null==(r=n.meta)?void 0:r.data)||{},i=o.TEXT,a=o.SIZE,s=o.SPACE,l=o.COLOR,d=o.ANGLE,u=o.OPACITY;e={...e,content:i,fontSize:`${a}px`,opacity:u,rotate:d,color:l,spacing:s};const c=document.getElementById(e.modalId),p=document.createElement("div");p.setAttribute("id",e.canId),p.style.position="fixed",p.style.top=0,p.style.left=0,p.style.bottom=0,p.style.right=0,p.style["background-color"]="transparent",p.style["pointer-events"]="none",p.style["user-select"]="none",p.style["z-index"]=9999,p.style.overflow="hidden";const h=document.createElement("span");h.style.position="relative",h.style.display="inline-block",h.style.padding="40px 0",h.style.height="80px",h.style["text-align"]="center",h.style["white-space"]="nowrap",h.style["margin-left"]=`${e.spacing}px`,h.style.opacity=e.opacity,h.style["pointer-events"]="none",h.style["user-select"]="none";const f=document.createElement("span");f.innerHTML=e.content,f.style.position="absolute",f.style.display="inline-block",f.style["pointer-events"]="none",f.style["user-select"]="none",f.style.top="50%",f.style.left="50%",f.style.transform=`translate(-50%, -50%) rotate(${e.rotate}deg)`,f.style["font-size"]=e.fontSize,f.style.color=e.color,h.appendChild(f);const g=h.outerHTML;let m="";for(let e=0;e<100;e++)m+=g;p.innerHTML=m,c.appendChild(p)}))}},386010:(e,t,n)=>{"use strict";function r(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function o(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(o&&(o+=" "),o+=t);return o}n.r(t),n.d(t,{clsx:()=>o,default:()=>i});const i=o},882689:(e,t,n)=>{var r=n(829932),o=n(297786),i=n(267206),a=n(269199),s=n(571131),l=n(307518),d=n(285022),u=n(406557),c=n(701469);e.exports=function(e,t,n){t=t.length?r(t,(function(e){return c(e)?function(t){return o(t,1===e.length?e[0]:e)}:e})):[u];var p=-1;t=r(t,l(i));var h=a(e,(function(e,n,o){return{criteria:r(t,(function(t){return t(e)})),index:++p,value:e}}));return s(h,(function(e,t){return d(e,t,n)}))}},571131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},626393:(e,t,n)=>{var r=n(733448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,o=null===e,i=e===e,a=r(e),s=void 0!==t,l=null===t,d=t===t,u=r(t);if(!l&&!u&&!a&&e>t||a&&s&&d&&!l&&!u||o&&s&&d||!n&&d||!i)return 1;if(!o&&!a&&!u&&e<t||u&&n&&i&&!o&&!a||l&&n&&i||!s&&i||!d)return-1}return 0}},285022:(e,t,n)=>{var r=n(626393);e.exports=function(e,t,n){for(var o=-1,i=e.criteria,a=t.criteria,s=i.length,l=n.length;++o<s;){var d=r(i[o],a[o]);if(d)return o>=l?d:d*("desc"==n[o]?-1:1)}return e.index-t.index}},763105:(e,t,n)=>{var r=n(234963),o=n(580760),i=n(267206),a=n(701469);e.exports=function(e,t){return(a(e)?r:o)(e,i(t,3))}},189734:(e,t,n)=>{var r=n(121078),o=n(882689),i=n(105976),a=n(816612),s=i((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),o(e,r(t,1),[])}));e.exports=s},944908:(e,t,n)=>{var r=n(345652);e.exports=function(e){return e&&e.length?r(e):[]}},609238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>Y,DragSource:()=>$,DropTarget:()=>q});var r=n(828195);function o(e){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){return"function"===typeof e}function a(){}function s(e){if(!function(e){return"object"===o(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"===typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null===e||void 0===e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var u=n(667294),c=n(215047),p=n(108679),h=n.n(p),f=n(982514);function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}var b=function(){var e=function(){function e(t){g(this,e),this.isDisposed=!1,this.action=i(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&i(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){g(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}}]),e}(),x=function(){function e(){g(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function C(e){return C="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D(e);if(t){var o=D(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===C(t)||"function"===typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function E(e){var t=e.DecoratedComponent,n=e.createHandler,o=e.createMonitor,i=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,p=e.collect,g=e.options.arePropsEqual,m=void 0===g?c.w:g,v=t,C=t.displayName||t.name||"Component",S=function(){var e=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(S,e);var t,s,h,g=M(S);function S(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),(t=g.call(this,e)).decoratedRef=u.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,c.w)(e,t.state)||t.setState(e)},t.disposable=new x,t.receiveProps(e),t.dispose(),t}return t=S,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!m(e,this.props)||!(0,c.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new x,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){m(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=w(a(e,this.handler,this.manager),2),n=t[0],r=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var o=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(o),new b(r)))}}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?p(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return u.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!==typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),u.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,r.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",C,C),void 0!==e&&(this.manager=e,this.handlerMonitor=o(e),this.handlerConnector=i(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&Z(t.prototype,s),h&&Z(t,h),S}(u.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(C,")"),e}();return h()(S,t)}var R=n(33273),T=n(660938),_=n(608556);function I(e){return I="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function O(e,t){return"string"===typeof e||"symbol"===I(e)||!!t&&Array.isArray(e)&&e.every((function(e){return O(e,!1)}))}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=["canDrag","beginDrag","isDragging","endDrag"],F=["beginDrag"],N=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(o.props)return o.spec.beginDrag(o.props,o.monitor,o.ref.current)},this.spec=t,this.monitor=n,this.ref=r}var t,n,r;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&P(t.prototype,n),r&&P(t,r),e}();function $(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e;"function"!==typeof e&&((0,r.k)(O(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),i=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=function(e){return Object.keys(e).forEach((function(t){(0,r.k)(z.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',z.join(", "),t),(0,r.k)("function"===typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),F.forEach((function(t){(0,r.k)("function"===typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}(t);return(0,r.k)("function"===typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,r.k)(s(o),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return E({containerDisplayName:"DragSource",createHandler:a,registerHandler:R.w,createConnector:function(e){return new _.x(e)},createMonitor:function(e){return new T.p(e)},DecoratedComponent:e,getType:i,collect:n,options:o})}}var L=n(189026),B=n(956941);function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=["canDrop","hover","drop"],H=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=r}var t,n,r;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&A(t.prototype,n),r&&A(t,r),e}();function q(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=e;"function"!==typeof e&&((0,r.k)(O(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),i=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=function(e){return Object.keys(e).forEach((function(t){(0,r.k)(j.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',j.join(", "),t),(0,r.k)("function"===typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new H(e,t,n)}}(t);return(0,r.k)("function"===typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,r.k)(s(o),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return E({containerDisplayName:"DropTarget",createHandler:a,registerHandler:R.n,createMonitor:function(e){return new B.H(e)},createConnector:function(e){return new L.Y(e)},DecoratedComponent:e,getType:i,collect:n,options:o})}}function U(e){return U="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K(e);if(t){var o=K(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===U(t)||"function"===typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},K(e)}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.k)("function"===typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,r.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var o=n,i=t.arePropsEqual,a=void 0===i?c.w:i,s=o.displayName||o.name||"Component",l=function(){var t=function(t){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(h,t);var n,i,l,p=G(h);function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=p.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=u.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,c.w)(t,e.state)||e.setState(t)}},e}return n=h,(i=[{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,c.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return u.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?u.createElement(o,Object.assign({},e.props,e.state,{ref:d(o)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,r.k)("object"===U(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}])&&V(n.prototype,i),l&&V(n,l),h}(u.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return h()(l,n)}}},984785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>o.DragLayer,DragSource:()=>o.DragSource,DropTarget:()=>o.DropTarget});var r=n(231388);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(609238)},473897:()=>{},648058:()=>{},231388:(e,t,n)=>{"use strict";var r=n(275253);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(648058);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var i=n(972105);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var a=n(473897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},275253:()=>{},972105:()=>{},175966:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=p(n(667294)),i=p(n(45697)),a=n(861193),s=n(101706),l=n(367493),d=n(607373),u=n(692886),c=p(n(386010));function p(e){return e&&e.__esModule?e:{default:e}}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=y(e);if(t){var i=y(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}(this,n)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(u,e);var t,n,r,i=v(u);function u(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(b(e=i.call.apply(i,[this].concat(n))),"state",{resizing:null,dragging:null,className:""}),x(b(e),"elementRef",o.default.createRef()),x(b(e),"onDragStart",(function(t,n){var r=n.node,o=e.props,i=o.onDragStart,a=o.transformScale;if(i){var s={top:0,left:0},l=r.offsetParent;if(l){var u=l.getBoundingClientRect(),c=r.getBoundingClientRect(),p=c.left/a,h=u.left/a,f=c.top/a,g=u.top/a;s.left=p-h+l.scrollLeft,s.top=f-g+l.scrollTop,e.setState({dragging:s});var m=(0,d.calcXY)(e.getPositionParams(),s.top,s.left,e.props.w,e.props.h),v=m.x,y=m.y;return i.call(b(e),e.props.i,v,y,{e:t,node:r,newPosition:s})}}})),x(b(e),"onDrag",(function(t,n){var r=n.node,o=n.deltaX,i=n.deltaY,a=e.props.onDrag;if(a){if(!e.state.dragging)throw new Error("onDrag called before onDragStart.");var s=e.state.dragging.top+i,l=e.state.dragging.left+o,u=e.props,c=u.isBounded,p=u.i,h=u.w,f=u.h,g=u.containerWidth,m=e.getPositionParams();if(c){var v=r.offsetParent;if(v){var y=e.props,x=y.margin,C=y.rowHeight,w=v.clientHeight-(0,d.calcGridItemWHPx)(f,C,x[1]);s=(0,d.clamp)(s,0,w);var S=(0,d.calcGridColWidth)(m),Z=g-(0,d.calcGridItemWHPx)(h,S,x[0]);l=(0,d.clamp)(l,0,Z)}}var k={top:s,left:l};e.setState({dragging:k});var M=(0,d.calcXY)(m,s,l,h,f),D=M.x,E=M.y;return a.call(b(e),p,D,E,{e:t,node:r,newPosition:k})}})),x(b(e),"onDragStop",(function(t,n){var r=n.node,o=e.props.onDragStop;if(o){if(!e.state.dragging)throw new Error("onDragEnd called before onDragStart.");var i=e.props,a=i.w,s=i.h,l=i.i,u=e.state.dragging,c=u.left,p=u.top,h={top:p,left:c};e.setState({dragging:null});var f=(0,d.calcXY)(e.getPositionParams(),p,c,a,s),g=f.x,m=f.y;return o.call(b(e),l,g,m,{e:t,node:r,newPosition:h})}})),x(b(e),"onResizeStop",(function(t,n){e.onResizeHandler(t,n,"onResizeStop")})),x(b(e),"onResizeStart",(function(t,n){e.onResizeHandler(t,n,"onResizeStart")})),x(b(e),"onResize",(function(t,n){e.onResizeHandler(t,n,"onResize")})),e}return t=u,n=[{key:"shouldComponentUpdate",value:function(e,t){if(this.props.children!==e.children)return!0;if(this.props.droppingPosition!==e.droppingPosition)return!0;var n=(0,d.calcGridItemPosition)(this.getPositionParams(this.props),this.props.x,this.props.y,this.props.w,this.props.h,this.state),r=(0,d.calcGridItemPosition)(this.getPositionParams(e),e.x,e.y,e.w,e.h,t);return!(0,l.fastPositionEqual)(n,r)||this.props.useCSSTransforms!==e.useCSSTransforms}},{key:"componentDidMount",value:function(){this.moveDroppingItem({})}},{key:"componentDidUpdate",value:function(e){this.moveDroppingItem(e)}},{key:"moveDroppingItem",value:function(e){var t=this.props.droppingPosition;if(t){var n=this.elementRef.current;if(n){var r=e.droppingPosition||{left:0,top:0},o=this.state.dragging,i=o&&t.left!==r.left||t.top!==r.top;if(o){if(i){var a=t.left-o.left,s=t.top-o.top;this.onDrag(t.e,{node:n,deltaX:a,deltaY:s})}}else this.onDragStart(t.e,{node:n,deltaX:t.left,deltaY:t.top})}}}},{key:"getPositionParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return{cols:e.cols,containerPadding:e.containerPadding,containerWidth:e.containerWidth,margin:e.margin,maxRows:e.maxRows,rowHeight:e.rowHeight}}},{key:"createStyle",value:function(e){var t,n=this.props,r=n.usePercentages,o=n.containerWidth;return n.useCSSTransforms?t=(0,l.setTransform)(e):(t=(0,l.setTopLeft)(e),r&&(t.left=(0,l.perc)(e.left/o),t.width=(0,l.perc)(e.width/o))),t}},{key:"mixinDraggable",value:function(e,t){return o.default.createElement(a.DraggableCore,{disabled:!t,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,handle:this.props.handle,cancel:".react-resizable-handle"+(this.props.cancel?","+this.props.cancel:""),scale:this.props.transformScale,nodeRef:this.elementRef},e)}},{key:"mixinResizable",value:function(e,t,n){var r=this.props,i=r.cols,a=r.x,l=r.minW,u=r.minH,c=r.maxW,p=r.maxH,h=r.transformScale,f=r.resizeHandles,g=r.resizeHandle,m=this.getPositionParams(),v=(0,d.calcGridItemPosition)(m,0,0,i-a,0).width,b=(0,d.calcGridItemPosition)(m,0,0,l,u),y=(0,d.calcGridItemPosition)(m,0,0,c,p),x=[b.width,b.height],C=[Math.min(y.width,v),Math.min(y.height,1/0)];return o.default.createElement(s.Resizable,{draggableOpts:{disabled:!n},className:n?void 0:"react-resizable-hide",width:t.width,height:t.height,minConstraints:x,maxConstraints:C,onResizeStop:this.onResizeStop,onResizeStart:this.onResizeStart,onResize:this.onResize,transformScale:h,resizeHandles:f,handle:g},e)}},{key:"onResizeHandler",value:function(e,t,n){var r=t.node,o=t.size,i=this.props[n];if(i){var a=this.props,s=a.cols,l=a.x,u=a.y,c=a.i,p=a.maxH,h=a.minH,f=this.props,g=f.minW,m=f.maxW,v=(0,d.calcWH)(this.getPositionParams(),o.width,o.height,l,u),b=v.w,y=v.h;g=Math.max(g,1),m=Math.min(m,s-l),b=(0,d.clamp)(b,g,m),y=(0,d.clamp)(y,h,p),this.setState({resizing:"onResizeStop"===n?null:o}),i.call(this,c,b,y,{e,node:r,size:o})}}},{key:"render",value:function(){var e=this.props,t=e.x,n=e.y,r=e.w,i=e.h,a=e.isDraggable,s=e.isResizable,l=e.droppingPosition,u=e.useCSSTransforms,p=(0,d.calcGridItemPosition)(this.getPositionParams(),t,n,r,i,this.state),h=o.default.Children.only(this.props.children),g=o.default.cloneElement(h,{ref:this.elementRef,className:(0,c.default)("react-grid-item",h.props.className,this.props.className,{static:this.props.static,resizing:Boolean(this.state.resizing),"react-draggable":a,"react-draggable-dragging":Boolean(this.state.dragging),dropping:Boolean(l),cssTransforms:u}),style:f(f(f({},this.props.style),h.props.style),this.createStyle(p))});return g=this.mixinResizable(g,p,s),g=this.mixinDraggable(g,a)}}],n&&g(t.prototype,n),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(o.default.Component);t.default=C,x(C,"propTypes",{children:i.default.element,cols:i.default.number.isRequired,containerWidth:i.default.number.isRequired,rowHeight:i.default.number.isRequired,margin:i.default.array.isRequired,maxRows:i.default.number.isRequired,containerPadding:i.default.array.isRequired,x:i.default.number.isRequired,y:i.default.number.isRequired,w:i.default.number.isRequired,h:i.default.number.isRequired,minW:function(e,t){var n=e[t];return"number"!==typeof n?new Error("minWidth not Number"):n>e.w||n>e.maxW?new Error("minWidth larger than item width/maxWidth"):void 0},maxW:function(e,t){var n=e[t];return"number"!==typeof n?new Error("maxWidth not Number"):n<e.w||n<e.minW?new Error("maxWidth smaller than item width/minWidth"):void 0},minH:function(e,t){var n=e[t];return"number"!==typeof n?new Error("minHeight not Number"):n>e.h||n>e.maxH?new Error("minHeight larger than item height/maxHeight"):void 0},maxH:function(e,t){var n=e[t];return"number"!==typeof n?new Error("maxHeight not Number"):n<e.h||n<e.minH?new Error("maxHeight smaller than item height/minHeight"):void 0},i:i.default.string.isRequired,resizeHandles:u.resizeHandleAxesType,resizeHandle:u.resizeHandleType,onDragStop:i.default.func,onDragStart:i.default.func,onDrag:i.default.func,onResizeStop:i.default.func,onResizeStart:i.default.func,onResize:i.default.func,isDraggable:i.default.bool.isRequired,isResizable:i.default.bool.isRequired,isBounded:i.default.bool.isRequired,static:i.default.bool,useCSSTransforms:i.default.bool.isRequired,transformScale:i.default.number,className:i.default.string,handle:i.default.string,cancel:i.default.string,droppingPosition:i.default.shape({e:i.default.object.isRequired,left:i.default.number.isRequired,top:i.default.number.isRequired})}),x(C,"defaultProps",{className:"",cancel:"",handle:"",minH:1,minW:1,maxH:1/0,maxW:1/0,transformScale:1})},649580:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(o,a,s):o[a]=e[a]}o.default=e,n&&n.set(e,o);return o}(n(667294)),i=c(n(572307)),a=c(n(386010)),s=n(367493),l=n(607373),d=c(n(175966)),u=c(n(692886));function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function h(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},x(e,t)}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}(this,n)}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k="react-grid-layout",M=!1;try{M=/firefox/i.test(navigator.userAgent)}catch(e){}var D=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}(c,e);var t,n,r,u=C(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Z(w(e=u.call.apply(u,[this].concat(n))),"state",{activeDrag:null,layout:(0,s.synchronizeLayoutWithChildren)(e.props.layout,e.props.children,e.props.cols,(0,s.compactType)(e.props),e.props.allowOverlap),mounted:!1,oldDragItem:null,oldLayout:null,oldResizeItem:null,droppingDOMNode:null,children:[]}),Z(w(e),"dragEnterCounter",0),Z(w(e),"onDragStart",(function(t,n,r,o){var i=o.e,a=o.node,l=e.state.layout,d=(0,s.getLayoutItem)(l,t);if(d)return e.setState({oldDragItem:(0,s.cloneLayoutItem)(d),oldLayout:l}),e.props.onDragStart(l,d,d,null,i,a)})),Z(w(e),"onDrag",(function(t,n,r,o){var i=o.e,a=o.node,l=e.state.oldDragItem,d=e.state.layout,u=e.props,c=u.cols,p=u.allowOverlap,h=u.preventCollision,f=(0,s.getLayoutItem)(d,t);if(f){var g={w:f.w,h:f.h,x:f.x,y:f.y,placeholder:!0,i:t};d=(0,s.moveElement)(d,f,n,r,!0,h,(0,s.compactType)(e.props),c,p),e.props.onDrag(d,l,f,g,i,a),e.setState({layout:p?d:(0,s.compact)(d,(0,s.compactType)(e.props),c),activeDrag:g})}})),Z(w(e),"onDragStop",(function(t,n,r,o){var i=o.e,a=o.node;if(e.state.activeDrag){var l=e.state.oldDragItem,d=e.state.layout,u=e.props,c=u.cols,p=u.preventCollision,h=u.allowOverlap,f=(0,s.getLayoutItem)(d,t);if(f){d=(0,s.moveElement)(d,f,n,r,!0,p,(0,s.compactType)(e.props),c,h),e.props.onDragStop(d,l,f,null,i,a);var g=h?d:(0,s.compact)(d,(0,s.compactType)(e.props),c),m=e.state.oldLayout;e.setState({activeDrag:null,layout:g,oldDragItem:null,oldLayout:null}),e.onLayoutMaybeChanged(g,m)}}})),Z(w(e),"onResizeStart",(function(t,n,r,o){var i=o.e,a=o.node,l=e.state.layout,d=(0,s.getLayoutItem)(l,t);d&&(e.setState({oldResizeItem:(0,s.cloneLayoutItem)(d),oldLayout:e.state.layout}),e.props.onResizeStart(l,d,d,null,i,a))})),Z(w(e),"onResize",(function(t,n,r,o){var i=o.e,a=o.node,l=e.state,d=l.layout,u=l.oldResizeItem,c=e.props,p=c.cols,h=c.preventCollision,f=c.allowOverlap,v=(0,s.withLayoutItem)(d,t,(function(e){var t;if(h&&!f){var o=(0,s.getAllCollisions)(d,g(g({},e),{},{w:n,h:r})).filter((function(t){return t.i!==e.i}));if(t=o.length>0){var i=1/0,a=1/0;o.forEach((function(t){t.x>e.x&&(i=Math.min(i,t.x)),t.y>e.y&&(a=Math.min(a,t.y))})),Number.isFinite(i)&&(e.w=i-e.x),Number.isFinite(a)&&(e.h=a-e.y)}}return t||(e.w=n,e.h=r),e})),b=m(v,2),y=b[0],x=b[1];if(x){var C={w:x.w,h:x.h,x:x.x,y:x.y,static:!0,i:t};e.props.onResize(y,u,x,C,i,a),e.setState({layout:f?y:(0,s.compact)(y,(0,s.compactType)(e.props),p),activeDrag:C})}})),Z(w(e),"onResizeStop",(function(t,n,r,o){var i=o.e,a=o.node,l=e.state,d=l.layout,u=l.oldResizeItem,c=e.props,p=c.cols,h=c.allowOverlap,f=(0,s.getLayoutItem)(d,t);e.props.onResizeStop(d,u,f,null,i,a);var g=h?d:(0,s.compact)(d,(0,s.compactType)(e.props),p),m=e.state.oldLayout;e.setState({activeDrag:null,layout:g,oldResizeItem:null,oldLayout:null}),e.onLayoutMaybeChanged(g,m)})),Z(w(e),"onDragOver",(function(t){var n;if(t.preventDefault(),t.stopPropagation(),M&&(null===(n=t.nativeEvent.target)||void 0===n||!n.classList.contains(k)))return!1;var r=e.props,i=r.droppingItem,a=r.onDropDragOver,s=r.margin,d=r.cols,u=r.rowHeight,c=r.maxRows,p=r.width,f=r.containerPadding,m=r.transformScale,v=null===a||void 0===a?void 0:a(t);if(!1===v)return e.state.droppingDOMNode&&e.removeDroppingPlaceholder(),!1;var b=g(g({},i),v),y=e.state.layout,x=t.nativeEvent,C=x.layerX,w=x.layerY,S={left:C/m,top:w/m,e:t};if(e.state.droppingDOMNode){if(e.state.droppingPosition){var Z=e.state.droppingPosition,D=Z.left,E=Z.top;(D!=C||E!=w)&&e.setState({droppingPosition:S})}}else{var R={cols:d,margin:s,maxRows:c,rowHeight:u,containerWidth:p,containerPadding:f||s},T=(0,l.calcXY)(R,w,C,b.w,b.h);e.setState({droppingDOMNode:o.createElement("div",{key:b.i}),droppingPosition:S,layout:[].concat(h(y),[g(g({},b),{},{x:T.x,y:T.y,static:!1,isDraggable:!0})])})}})),Z(w(e),"removeDroppingPlaceholder",(function(){var t=e.props,n=t.droppingItem,r=t.cols,o=e.state.layout,i=(0,s.compact)(o.filter((function(e){return e.i!==n.i})),(0,s.compactType)(e.props),r);e.setState({layout:i,droppingDOMNode:null,activeDrag:null,droppingPosition:void 0})})),Z(w(e),"onDragLeave",(function(t){t.preventDefault(),t.stopPropagation(),e.dragEnterCounter--,0===e.dragEnterCounter&&e.removeDroppingPlaceholder()})),Z(w(e),"onDragEnter",(function(t){t.preventDefault(),t.stopPropagation(),e.dragEnterCounter++})),Z(w(e),"onDrop",(function(t){t.preventDefault(),t.stopPropagation();var n=e.props.droppingItem,r=e.state.layout,o=r.find((function(e){return e.i===n.i}));e.dragEnterCounter=0,e.removeDroppingPlaceholder(),e.props.onDrop(r,o,t)})),e}return t=c,r=[{key:"getDerivedStateFromProps",value:function(e,t){var n;return t.activeDrag?null:((0,i.default)(e.layout,t.propsLayout)&&e.compactType===t.compactType?(0,s.childrenEqual)(e.children,t.children)||(n=t.layout):n=e.layout,n?{layout:(0,s.synchronizeLayoutWithChildren)(n,e.children,e.cols,(0,s.compactType)(e),e.allowOverlap),compactType:e.compactType,children:e.children,propsLayout:e.layout}:null)}}],(n=[{key:"componentDidMount",value:function(){this.setState({mounted:!0}),this.onLayoutMaybeChanged(this.state.layout,this.props.layout)}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.children!==e.children||!(0,s.fastRGLPropsEqual)(this.props,e,i.default)||this.state.activeDrag!==t.activeDrag||this.state.mounted!==t.mounted||this.state.droppingPosition!==t.droppingPosition}},{key:"componentDidUpdate",value:function(e,t){if(!this.state.activeDrag){var n=this.state.layout,r=t.layout;this.onLayoutMaybeChanged(n,r)}}},{key:"containerHeight",value:function(){if(this.props.autoSize){var e=(0,s.bottom)(this.state.layout),t=this.props.containerPadding?this.props.containerPadding[1]:this.props.margin[1];return e*this.props.rowHeight+(e-1)*this.props.margin[1]+2*t+"px"}}},{key:"onLayoutMaybeChanged",value:function(e,t){t||(t=this.state.layout),(0,i.default)(t,e)||this.props.onLayoutChange(e)}},{key:"placeholder",value:function(){var e=this.state.activeDrag;if(!e)return null;var t=this.props,n=t.width,r=t.cols,i=t.margin,a=t.containerPadding,s=t.rowHeight,l=t.maxRows,u=t.useCSSTransforms,c=t.transformScale;return o.createElement(d.default,{w:e.w,h:e.h,x:e.x,y:e.y,i:e.i,className:"react-grid-placeholder",containerWidth:n,cols:r,margin:i,containerPadding:a||i,maxRows:l,rowHeight:s,isDraggable:!1,isResizable:!1,isBounded:!1,useCSSTransforms:u,transformScale:c},o.createElement("div",null))}},{key:"processGridItem",value:function(e,t){if(e&&e.key){var n=(0,s.getLayoutItem)(this.state.layout,String(e.key));if(!n)return null;var r=this.props,i=r.width,a=r.cols,l=r.margin,u=r.containerPadding,c=r.rowHeight,p=r.maxRows,h=r.isDraggable,f=r.isResizable,g=r.isBounded,m=r.useCSSTransforms,v=r.transformScale,b=r.draggableCancel,y=r.draggableHandle,x=r.resizeHandles,C=r.resizeHandle,w=this.state,S=w.mounted,Z=w.droppingPosition,k="boolean"===typeof n.isDraggable?n.isDraggable:!n.static&&h,M="boolean"===typeof n.isResizable?n.isResizable:!n.static&&f,D=n.resizeHandles||x,E=k&&g&&!1!==n.isBounded;return o.createElement(d.default,{containerWidth:i,cols:a,margin:l,containerPadding:u||l,maxRows:p,rowHeight:c,cancel:b,handle:y,onDragStop:this.onDragStop,onDragStart:this.onDragStart,onDrag:this.onDrag,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,isDraggable:k,isResizable:M,isBounded:E,useCSSTransforms:m&&S,usePercentages:!S,transformScale:v,w:n.w,h:n.h,x:n.x,y:n.y,i:n.i,minH:n.minH,minW:n.minW,maxH:n.maxH,maxW:n.maxW,static:n.static,droppingPosition:t?Z:void 0,resizeHandles:D,resizeHandle:C},e)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.style,i=t.isDroppable,l=t.innerRef,d=(0,a.default)(k,n),u=g({height:this.containerHeight()},r);return o.createElement("div",{ref:l,className:d,style:u,onDrop:i?this.onDrop:s.noop,onDragLeave:i?this.onDragLeave:s.noop,onDragEnter:i?this.onDragEnter:s.noop,onDragOver:i?this.onDragOver:s.noop},o.Children.map(this.props.children,(function(t){return e.processGridItem(t)})),i&&this.state.droppingDOMNode&&this.processGridItem(this.state.droppingDOMNode,!0),this.placeholder())}}])&&y(t.prototype,n),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.Component);t.default=D,Z(D,"displayName","ReactGridLayout"),Z(D,"propTypes",u.default),Z(D,"defaultProps",{autoSize:!0,cols:12,className:"",style:{},draggableHandle:"",draggableCancel:"",containerPadding:null,rowHeight:150,maxRows:1/0,layout:[],margin:[10,10],isBounded:!1,isDraggable:!0,isResizable:!0,allowOverlap:!1,isDroppable:!1,useCSSTransforms:!0,transformScale:1,verticalCompact:!0,compactType:"vertical",preventCollision:!1,droppingItem:{i:"__dropping-elem__",h:1,w:1},resizeHandles:["se"],onLayoutChange:s.noop,onDragStart:s.noop,onDrag:s.noop,onDragStop:s.noop,onResizeStart:s.noop,onResize:s.noop,onResizeStop:s.noop,onDrop:s.noop,onDropDragOver:s.noop})},692886:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resizeHandleType=t.resizeHandleAxesType=t.default=void 0;var r=i(n(45697)),o=i(n(667294));function i(e){return e&&e.__esModule?e:{default:e}}var a=r.default.arrayOf(r.default.oneOf(["s","w","e","n","sw","nw","se","ne"]));t.resizeHandleAxesType=a;var s=r.default.oneOfType([r.default.node,r.default.func]);t.resizeHandleType=s;var l={className:r.default.string,style:r.default.object,width:r.default.number,autoSize:r.default.bool,cols:r.default.number,draggableCancel:r.default.string,draggableHandle:r.default.string,verticalCompact:function(e){e.verticalCompact,0},compactType:r.default.oneOf(["vertical","horizontal"]),layout:function(e){var t=e.layout;void 0!==t&&n(367493).validateLayout(t,"layout")},margin:r.default.arrayOf(r.default.number),containerPadding:r.default.arrayOf(r.default.number),rowHeight:r.default.number,maxRows:r.default.number,isBounded:r.default.bool,isDraggable:r.default.bool,isResizable:r.default.bool,allowOverlap:r.default.bool,preventCollision:r.default.bool,useCSSTransforms:r.default.bool,transformScale:r.default.number,isDroppable:r.default.bool,resizeHandles:a,resizeHandle:s,onLayoutChange:r.default.func,onDragStart:r.default.func,onDrag:r.default.func,onDragStop:r.default.func,onResizeStart:r.default.func,onResize:r.default.func,onResizeStop:r.default.func,onDrop:r.default.func,droppingItem:r.default.shape({i:r.default.string.isRequired,w:r.default.number.isRequired,h:r.default.number.isRequired}),children:function(e,t){var n=e[t],r={};o.default.Children.forEach(n,(function(e){if(null!=(null===e||void 0===e?void 0:e.key)){if(r[e.key])throw new Error('Duplicate child key "'+e.key+'" found! This will cause problems in ReactGridLayout.');r[e.key]=!0}}))},innerRef:r.default.any};t.default=l},965966:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.default=void 0;var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(o,a,s):o[a]=e[a]}o.default=e,n&&n.set(e,o);return o}(n(667294)),i=c(n(45697)),a=c(n(572307)),s=n(367493),l=n(205651),d=c(n(649580)),u=["breakpoint","breakpoints","cols","layouts","margin","containerPadding","onBreakpointChange","onLayoutChange","onWidthChange"];function c(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function h(){return h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h.apply(this,arguments)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},b(e,t)}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=C(e);if(t){var i=C(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}(this,n)}}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(e){return Object.prototype.toString.call(e)};function Z(e,t){return null==e?null:Array.isArray(e)?e:e[t]}var k=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(c,e);var t,n,r,i=y(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return w(x(e=i.call.apply(i,[this].concat(n))),"state",e.generateInitialState()),w(x(e),"onLayoutChange",(function(t){e.props.onLayoutChange(t,m(m({},e.props.layouts),{},w({},e.state.breakpoint,t)))})),e}return t=c,r=[{key:"getDerivedStateFromProps",value:function(e,t){if(!(0,a.default)(e.layouts,t.layouts)){var n=t.breakpoint,r=t.cols;return{layout:(0,l.findOrGenerateResponsiveLayout)(e.layouts,e.breakpoints,n,n,r,e.compactType),layouts:e.layouts}}return null}}],(n=[{key:"generateInitialState",value:function(){var e=this.props,t=e.width,n=e.breakpoints,r=e.layouts,o=e.cols,i=(0,l.getBreakpointFromWidth)(n,t),a=(0,l.getColsFromBreakpoint)(i,o),s=!1===this.props.verticalCompact?null:this.props.compactType;return{layout:(0,l.findOrGenerateResponsiveLayout)(r,n,i,i,a,s),breakpoint:i,cols:a}}},{key:"componentDidUpdate",value:function(e){this.props.width==e.width&&this.props.breakpoint===e.breakpoint&&(0,a.default)(this.props.breakpoints,e.breakpoints)&&(0,a.default)(this.props.cols,e.cols)||this.onWidthChange(e)}},{key:"onWidthChange",value:function(e){var t=this.props,n=t.breakpoints,r=t.cols,o=t.layouts,i=t.compactType,a=this.props.breakpoint||(0,l.getBreakpointFromWidth)(this.props.breakpoints,this.props.width),d=this.state.breakpoint,u=(0,l.getColsFromBreakpoint)(a,r),c=m({},o);if(d!==a||e.breakpoints!==n||e.cols!==r){d in c||(c[d]=(0,s.cloneLayout)(this.state.layout));var p=(0,l.findOrGenerateResponsiveLayout)(c,n,a,d,u,i);p=(0,s.synchronizeLayoutWithChildren)(p,this.props.children,u,i,this.props.allowOverlap),c[a]=p,this.props.onLayoutChange(p,c),this.props.onBreakpointChange(a,u),this.setState({breakpoint:a,layout:p,cols:u})}var h=Z(this.props.margin,a),f=Z(this.props.containerPadding,a);this.props.onWidthChange(this.props.width,h,u,f)}},{key:"render",value:function(){var e=this.props,t=(e.breakpoint,e.breakpoints,e.cols,e.layouts,e.margin),n=e.containerPadding,r=(e.onBreakpointChange,e.onLayoutChange,e.onWidthChange,f(e,u));return o.createElement(d.default,h({},r,{margin:Z(t,this.state.breakpoint),containerPadding:Z(n,this.state.breakpoint),onLayoutChange:this.onLayoutChange,layout:this.state.layout,cols:this.state.cols}))}}])&&v(t.prototype,n),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.Component);t.default=k,w(k,"propTypes",{breakpoint:i.default.string,breakpoints:i.default.object,allowOverlap:i.default.bool,cols:i.default.object,margin:i.default.oneOfType([i.default.array,i.default.object]),containerPadding:i.default.oneOfType([i.default.array,i.default.object]),layouts:function(e,t){if("[object Object]"!==S(e[t]))throw new Error("Layout property must be an object. Received: "+S(e[t]));Object.keys(e[t]).forEach((function(t){if(!(t in e.breakpoints))throw new Error("Each key in layouts must align with a key in breakpoints.");(0,s.validateLayout)(e.layouts[t],"layouts."+t)}))},width:i.default.number.isRequired,onBreakpointChange:i.default.func,onLayoutChange:i.default.func,onWidthChange:i.default.func}),w(k,"defaultProps",{breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},containerPadding:{lg:null,md:null,sm:null,xs:null,xxs:null},layouts:{},margin:[10,10],allowOverlap:!1,onBreakpointChange:s.noop,onLayoutChange:s.noop,onWidthChange:s.noop})},607373:(e,t)=>{"use strict";function n(e){var t=e.margin,n=e.containerPadding,r=e.containerWidth,o=e.cols;return(r-t[0]*(o-1)-2*n[0])/o}function r(e,t,n){return Number.isFinite(e)?Math.round(t*e+Math.max(0,e-1)*n):e}function o(e,t,n){return Math.max(Math.min(e,n),t)}Object.defineProperty(t,"__esModule",{value:!0}),t.calcGridColWidth=n,t.calcGridItemPosition=function(e,t,o,i,a,s){var l=e.margin,d=e.containerPadding,u=e.rowHeight,c=n(e),p={};s&&s.resizing?(p.width=Math.round(s.resizing.width),p.height=Math.round(s.resizing.height)):(p.width=r(i,c,l[0]),p.height=r(a,u,l[1]));s&&s.dragging?(p.top=Math.round(s.dragging.top),p.left=Math.round(s.dragging.left)):(p.top=Math.round((u+l[1])*o+d[1]),p.left=Math.round((c+l[0])*t+d[0]));return p},t.calcGridItemWHPx=r,t.calcWH=function(e,t,r,i,a){var s=e.margin,l=e.maxRows,d=e.cols,u=e.rowHeight,c=n(e),p=Math.round((t+s[0])/(c+s[0])),h=Math.round((r+s[1])/(u+s[1]));return p=o(p,0,d-i),h=o(h,0,l-a),{w:p,h}},t.calcXY=function(e,t,r,i,a){var s=e.margin,l=e.cols,d=e.rowHeight,u=e.maxRows,c=n(e),p=Math.round((r-s[0])/(c+s[0])),h=Math.round((t-s[1])/(d+s[1]));return p=o(p,0,l-i),h=o(h,0,u-a),{x:p,y:h}},t.clamp=o},827135:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.default=function(e){var t;return t=function(t){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(d,t);var n,i,l=(n=d,i=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(n);if(i){var o=f(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,e)});function d(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return g(h(e=l.call.apply(l,[this].concat(n))),"state",{width:1280}),g(h(e),"elementRef",o.createRef()),g(h(e),"mounted",!1),g(h(e),"onWindowResize",(function(){if(e.mounted){var t=e.elementRef.current;t instanceof HTMLElement&&t.offsetWidth&&e.setState({width:t.offsetWidth})}})),e}return function(e,t,n){t&&c(e.prototype,t);n&&c(e,n);Object.defineProperty(e,"prototype",{writable:!1})}(d,[{key:"componentDidMount",value:function(){this.mounted=!0,window.addEventListener("resize",this.onWindowResize),this.onWindowResize()}},{key:"componentWillUnmount",value:function(){this.mounted=!1,window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function(){var t=this.props,n=t.measureBeforeMount,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,s);return n&&!this.mounted?o.createElement("div",{className:(0,a.default)(this.props.className,m),style:this.props.style,ref:this.elementRef}):o.createElement(e,u({innerRef:this.elementRef},r,this.state))}}]),d}(o.Component),g(t,"defaultProps",{measureBeforeMount:!1}),g(t,"propTypes",{measureBeforeMount:i.default.bool}),t};var o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(o,a,s):o[a]=e[a]}o.default=e,n&&n.set(e,o);return o}(n(667294)),i=l(n(45697)),a=l(n(386010)),s=["measureBeforeMount"];function l(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m="react-grid-layout"},631362:e=>{e.exports=function(e,t,n){return e===t||e.className===t.className&&n(e.style,t.style)&&e.width===t.width&&e.autoSize===t.autoSize&&e.cols===t.cols&&e.draggableCancel===t.draggableCancel&&e.draggableHandle===t.draggableHandle&&n(e.verticalCompact,t.verticalCompact)&&n(e.compactType,t.compactType)&&n(e.layout,t.layout)&&n(e.margin,t.margin)&&n(e.containerPadding,t.containerPadding)&&e.rowHeight===t.rowHeight&&e.maxRows===t.maxRows&&e.isBounded===t.isBounded&&e.isDraggable===t.isDraggable&&e.isResizable===t.isResizable&&e.allowOverlap===t.allowOverlap&&e.preventCollision===t.preventCollision&&e.useCSSTransforms===t.useCSSTransforms&&e.transformScale===t.transformScale&&e.isDroppable===t.isDroppable&&n(e.resizeHandles,t.resizeHandles)&&n(e.resizeHandle,t.resizeHandle)&&e.onLayoutChange===t.onLayoutChange&&e.onDragStart===t.onDragStart&&e.onDrag===t.onDrag&&e.onDragStop===t.onDragStop&&e.onResizeStart===t.onResizeStart&&e.onResize===t.onResize&&e.onResizeStop===t.onResizeStop&&e.onDrop===t.onDrop&&n(e.droppingItem,t.droppingItem)&&n(e.innerRef,t.innerRef)}},205651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findOrGenerateResponsiveLayout=function(e,t,n,i,a,s){if(e[n])return(0,r.cloneLayout)(e[n]);for(var l=e[i],d=o(t),u=d.slice(d.indexOf(n)),c=0,p=u.length;c<p;c++){var h=u[c];if(e[h]){l=e[h];break}}return l=(0,r.cloneLayout)(l||[]),(0,r.compact)((0,r.correctBounds)(l,{cols:a}),s,a)},t.getBreakpointFromWidth=function(e,t){for(var n=o(e),r=n[0],i=1,a=n.length;i<a;i++){var s=n[i];t>e[s]&&(r=s)}return r},t.getColsFromBreakpoint=function(e,t){if(!t[e])throw new Error("ResponsiveReactGridLayout: `cols` entry for breakpoint "+e+" is missing!");return t[e]},t.sortBreakpoints=o;var r=n(367493);function o(e){return Object.keys(e).sort((function(t,n){return e[t]-e[n]}))}},367493:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bottom=c,t.childrenEqual=function(e,t){return(0,r.default)(o.default.Children.map(e,(function(e){return null===e||void 0===e?void 0:e.key})),o.default.Children.map(t,(function(e){return null===e||void 0===e?void 0:e.key})))},t.cloneLayout=p,t.cloneLayoutItem=f,t.collides=m,t.compact=v,t.compactItem=x,t.compactType=function(e){var t=e||{},n=t.verticalCompact,r=t.compactType;return!1===n?null:r},t.correctBounds=C,t.fastPositionEqual=function(e,t){return e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height},t.fastRGLPropsEqual=void 0,t.getAllCollisions=Z,t.getFirstCollision=S,t.getLayoutItem=w,t.getStatics=k,t.modifyLayout=h,t.moveElement=M,t.moveElementAwayFromCollision=D,t.noop=void 0,t.perc=function(e){return 100*e+"%"},t.setTopLeft=function(e){var t=e.top,n=e.left,r=e.width,o=e.height;return{top:"".concat(t,"px"),left:"".concat(n,"px"),width:"".concat(r,"px"),height:"".concat(o,"px"),position:"absolute"}},t.setTransform=function(e){var t=e.top,n=e.left,r=e.width,o=e.height,i="translate(".concat(n,"px,").concat(t,"px)");return{transform:i,WebkitTransform:i,MozTransform:i,msTransform:i,OTransform:i,width:"".concat(r,"px"),height:"".concat(o,"px"),position:"absolute"}},t.sortLayoutItems=E,t.sortLayoutItemsByColRow=T,t.sortLayoutItemsByRowCol=R,t.synchronizeLayoutWithChildren=function(e,t,n,r,i){e=e||[];var a=[];o.default.Children.forEach(t,(function(t){if(null!=(null===t||void 0===t?void 0:t.key)){var n=w(e,String(t.key));if(n)a.push(f(n));else{!d&&t.props._grid;var r=t.props["data-grid"]||t.props._grid;r?(d||_([r],"ReactGridLayout.children"),a.push(f(s(s({},r),{},{i:t.key})))):a.push(f({w:1,h:1,x:0,y:c(a),i:String(t.key)}))}}}));var l=C(a,{cols:n});return i?l:v(l,r,n)},t.validateLayout=_,t.withLayoutItem=function(e,t,n){var r=w(e,t);return r?(r=n(f(r)),[e=h(e,r),r]):[e,null]};var r=i(n(572307)),o=i(n(667294));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=!0,u=!1;function c(e){for(var t,n=0,r=0,o=e.length;r<o;r++)(t=e[r].y+e[r].h)>n&&(n=t);return n}function p(e){for(var t=Array(e.length),n=0,r=e.length;n<r;n++)t[n]=f(e[n]);return t}function h(e,t){for(var n=Array(e.length),r=0,o=e.length;r<o;r++)t.i===e[r].i?n[r]=t:n[r]=e[r];return n}function f(e){return{w:e.w,h:e.h,x:e.x,y:e.y,i:e.i,minW:e.minW,maxW:e.maxW,minH:e.minH,maxH:e.maxH,moved:Boolean(e.moved),static:Boolean(e.static),isDraggable:e.isDraggable,isResizable:e.isResizable,resizeHandles:e.resizeHandles,isBounded:e.isBounded}}var g=n(631362);function m(e,t){return e.i!==t.i&&(!(e.x+e.w<=t.x)&&(!(e.x>=t.x+t.w)&&(!(e.y+e.h<=t.y)&&!(e.y>=t.y+t.h))))}function v(e,t,n){for(var r=k(e),o=E(e,t),i=Array(e.length),a=0,s=o.length;a<s;a++){var l=f(o[a]);l.static||(l=x(r,l,t,n,o),r.push(l)),i[e.indexOf(o[a])]=l,l.moved=!1}return i}t.fastRGLPropsEqual=g;var b={x:"w",y:"h"};function y(e,t,n,r){var o=b[r];t[r]+=1;for(var i=e.map((function(e){return e.i})).indexOf(t.i)+1;i<e.length;i++){var a=e[i];if(!a.static){if(a.y>t.y+t.h)break;m(t,a)&&y(e,a,n+t[o],r)}}t[r]=n}function x(e,t,n,r,o){var i,a="horizontal"===n;if("vertical"===n)for(t.y=Math.min(c(e),t.y);t.y>0&&!S(e,t);)t.y--;else if(a)for(;t.x>0&&!S(e,t);)t.x--;for(;i=S(e,t);)a?y(o,t,i.x+i.w,"x"):y(o,t,i.y+i.h,"y"),a&&t.x+t.w>r&&(t.x=r-t.w,t.y++);return t.y=Math.max(t.y,0),t.x=Math.max(t.x,0),t}function C(e,t){for(var n=k(e),r=0,o=e.length;r<o;r++){var i=e[r];if(i.x+i.w>t.cols&&(i.x=t.cols-i.w),i.x<0&&(i.x=0,i.w=t.cols),i.static)for(;S(n,i);)i.y++;else n.push(i)}return e}function w(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].i===t)return e[n]}function S(e,t){for(var n=0,r=e.length;n<r;n++)if(m(e[n],t))return e[n]}function Z(e,t){return e.filter((function(e){return m(e,t)}))}function k(e){return e.filter((function(e){return e.static}))}function M(e,t,n,r,o,i,a,s,l){if(t.static&&!0!==t.isDraggable)return e;if(t.y===r&&t.x===n)return e;I("Moving element ".concat(t.i," to [").concat(String(n),",").concat(String(r),"] from [").concat(t.x,",").concat(t.y,"]"));var d=t.x,u=t.y;"number"===typeof n&&(t.x=n),"number"===typeof r&&(t.y=r),t.moved=!0;var c=E(e,a);("vertical"===a&&"number"===typeof r?u>=r:"horizontal"===a&&"number"===typeof n&&d>=n)&&(c=c.reverse());var h=Z(c,t),f=h.length>0;if(f&&l)return p(e);if(f&&i)return I("Collision prevented on ".concat(t.i,", reverting.")),t.x=d,t.y=u,t.moved=!1,e;for(var g=0,m=h.length;g<m;g++){var v=h[g];I("Resolving collision between ".concat(t.i," at [").concat(t.x,",").concat(t.y,"] and ").concat(v.i," at [").concat(v.x,",").concat(v.y,"]")),v.moved||(e=v.static?D(e,v,t,o,a,s):D(e,t,v,o,a,s))}return e}function D(e,t,n,r,o,i){var a="horizontal"===o,s="horizontal"!==o,l=t.static;if(r){r=!1;var d={x:a?Math.max(t.x-n.w,0):n.x,y:s?Math.max(t.y-n.h,0):n.y,w:n.w,h:n.h,i:"-1"};if(!S(e,d))return I("Doing reverse collision on ".concat(n.i," up to [").concat(d.x,",").concat(d.y,"].")),M(e,n,a?d.x:void 0,s?d.y:void 0,r,l,o,i)}return M(e,n,a?n.x+1:void 0,s?n.y+1:void 0,r,l,o,i)}function E(e,t){return"horizontal"===t?T(e):"vertical"===t?R(e):e}function R(e){return e.slice(0).sort((function(e,t){return e.y>t.y||e.y===t.y&&e.x>t.x?1:e.y===t.y&&e.x===t.x?0:-1}))}function T(e){return e.slice(0).sort((function(e,t){return e.x>t.x||e.x===t.x&&e.y>t.y?1:-1}))}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Layout",n=["x","y","w","h"];if(!Array.isArray(e))throw new Error(t+" must be an array!");for(var r=0,o=e.length;r<o;r++)for(var i=e[r],a=0;a<n.length;a++)if("number"!==typeof i[n[a]])throw new Error("ReactGridLayout: "+t+"["+r+"]."+n[a]+" must be a number!")}function I(){var e;u&&(e=console).log.apply(e,arguments)}t.noop=function(){}},669968:(e,t,n)=>{e.exports=n(649580).default,e.exports.utils=n(367493),e.exports.Responsive=n(965966).default,e.exports.Responsive.utils=n(205651),e.exports.WidthProvider=n(827135).default},122827:(e,t,n)=>{"use strict";t.__esModule=!0,t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}r.default=e,n&&n.set(e,r);return r}(n(667294)),o=n(861193),i=n(459069),a=n(100448),s=["children","className","draggableOpts","width","height","handle","handleSize","lockAspectRatio","axis","minConstraints","maxConstraints","onResize","onResizeStop","onResizeStart","resizeHandles","transformScale"];function l(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}var f=function(e){var t,n;function a(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).handleRefs={},t.lastHandleRect=null,t.slack=null,t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,h(t,n);var l=a.prototype;return l.componentWillUnmount=function(){this.resetData()},l.resetData=function(){this.lastHandleRect=this.slack=null},l.runConstraints=function(e,t){var n=this.props,r=n.minConstraints,o=n.maxConstraints,i=n.lockAspectRatio;if(!r&&!o&&!i)return[e,t];if(i){var a=this.props.width/this.props.height,s=e-this.props.width,l=t-this.props.height;Math.abs(s)>Math.abs(l*a)?t=e/a:e=t*a}var d=e,u=t,c=this.slack||[0,0],p=c[0],h=c[1];return e+=p,t+=h,r&&(e=Math.max(r[0],e),t=Math.max(r[1],t)),o&&(e=Math.min(o[0],e),t=Math.min(o[1],t)),this.slack=[p+(d-e),h+(u-t)],[e,t]},l.resizeHandler=function(e,t){var n=this;return function(r,o){var i=o.node,a=o.deltaX,s=o.deltaY;"onResizeStart"===e&&n.resetData();var l=("both"===n.props.axis||"x"===n.props.axis)&&"n"!==t&&"s"!==t,d=("both"===n.props.axis||"y"===n.props.axis)&&"e"!==t&&"w"!==t;if(l||d){var u=t[0],c=t[t.length-1],p=i.getBoundingClientRect();if(null!=n.lastHandleRect){if("w"===c)a+=p.left-n.lastHandleRect.left;if("n"===u)s+=p.top-n.lastHandleRect.top}n.lastHandleRect=p,"w"===c&&(a=-a),"n"===u&&(s=-s);var h=n.props.width+(l?a/n.props.transformScale:0),f=n.props.height+(d?s/n.props.transformScale:0),g=n.runConstraints(h,f);h=g[0],f=g[1];var m=h!==n.props.width||f!==n.props.height,v="function"===typeof n.props[e]?n.props[e]:null;v&&!("onResize"===e&&!m)&&(null==r.persist||r.persist(),v(r,{node:i,size:{width:h,height:f},handle:t})),"onResizeStop"===e&&n.resetData()}}},l.renderResizeHandle=function(e,t){var n=this.props.handle;if(!n)return r.createElement("span",{className:"react-resizable-handle react-resizable-handle-"+e,ref:t});if("function"===typeof n)return n(e,t);var o=c({ref:t},"string"===typeof n.type?{}:{handleAxis:e});return r.cloneElement(n,o)},l.render=function(){var e=this,t=this.props,n=t.children,a=t.className,l=t.draggableOpts,u=(t.width,t.height,t.handle,t.handleSize,t.lockAspectRatio,t.axis,t.minConstraints,t.maxConstraints,t.onResize,t.onResizeStop,t.onResizeStart,t.resizeHandles),p=(t.transformScale,function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(t,s));return(0,i.cloneElement)(n,c(c({},p),{},{className:(a?a+" ":"")+"react-resizable",children:[].concat(n.props.children,u.map((function(t){var n,i=null!=(n=e.handleRefs[t])?n:e.handleRefs[t]=r.createRef();return r.createElement(o.DraggableCore,d({},l,{nodeRef:i,key:"resizableHandle-"+t,onStop:e.resizeHandler("onResizeStop",t),onStart:e.resizeHandler("onResizeStart",t),onDrag:e.resizeHandler("onResize",t)}),e.renderResizeHandle(t,i))})))}))},a}(r.Component);t.default=f,f.propTypes=a.resizableProps,f.defaultProps={axis:"both",handleSize:[20,20],lockAspectRatio:!1,minConstraints:[20,20],maxConstraints:[1/0,1/0],resizeHandles:["se"],transformScale:1}},808735:(e,t,n)=>{"use strict";t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=o?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}r.default=e,n&&n.set(e,r);return r}(n(667294)),o=l(n(45697)),i=l(n(122827)),a=n(100448),s=["handle","handleSize","onResize","onResizeStart","onResizeStop","draggableOpts","minConstraints","maxConstraints","lockAspectRatio","axis","width","height","resizeHandles","style","transformScale"];function l(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}var g=function(e){var t,n;function o(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).state={width:t.props.width,height:t.props.height,propsWidth:t.props.width,propsHeight:t.props.height},t.onResize=function(e,n){var r=n.size;t.props.onResize?(null==e.persist||e.persist(),t.setState(r,(function(){return t.props.onResize&&t.props.onResize(e,n)}))):t.setState(r)},t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,f(t,n),o.getDerivedStateFromProps=function(e,t){return t.propsWidth!==e.width||t.propsHeight!==e.height?{width:e.width,height:e.height,propsWidth:e.width,propsHeight:e.height}:null},o.prototype.render=function(){var e=this.props,t=e.handle,n=e.handleSize,o=(e.onResize,e.onResizeStart),a=e.onResizeStop,l=e.draggableOpts,d=e.minConstraints,c=e.maxConstraints,h=e.lockAspectRatio,f=e.axis,g=(e.width,e.height,e.resizeHandles),m=e.style,v=e.transformScale,b=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,s);return r.createElement(i.default,{axis:f,draggableOpts:l,handle:t,handleSize:n,height:this.state.height,lockAspectRatio:h,maxConstraints:c,minConstraints:d,onResizeStart:o,onResize:this.onResize,onResizeStop:a,resizeHandles:g,transformScale:v,width:this.state.width},r.createElement("div",u({},b,{style:p(p({},m),{},{width:this.state.width+"px",height:this.state.height+"px"})})))},o}(r.Component);t.default=g,g.propTypes=p(p({},a.resizableProps),{},{children:o.default.element})},100448:(e,t,n)=>{"use strict";t.__esModule=!0,t.resizableProps=void 0;var r,o=(r=n(45697))&&r.__esModule?r:{default:r};n(861193);var i={axis:o.default.oneOf(["both","x","y","none"]),className:o.default.string,children:o.default.element.isRequired,draggableOpts:o.default.shape({allowAnyClick:o.default.bool,cancel:o.default.string,children:o.default.node,disabled:o.default.bool,enableUserSelectHack:o.default.bool,offsetParent:o.default.node,grid:o.default.arrayOf(o.default.number),handle:o.default.string,nodeRef:o.default.object,onStart:o.default.func,onDrag:o.default.func,onStop:o.default.func,onMouseDown:o.default.func,scale:o.default.number}),height:o.default.number.isRequired,handle:o.default.oneOfType([o.default.node,o.default.func]),handleSize:o.default.arrayOf(o.default.number),lockAspectRatio:o.default.bool,maxConstraints:o.default.arrayOf(o.default.number),minConstraints:o.default.arrayOf(o.default.number),onResizeStop:o.default.func,onResizeStart:o.default.func,onResize:o.default.func,resizeHandles:o.default.arrayOf(o.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),transformScale:o.default.number,width:o.default.number.isRequired};t.resizableProps=i},459069:(e,t,n)=>{"use strict";t.__esModule=!0,t.cloneElement=function(e,t){t.style&&e.props.style&&(t.style=a(a({},e.props.style),t.style));t.className&&e.props.className&&(t.className=e.props.className+" "+t.className);return o.default.cloneElement(e,t)};var r,o=(r=n(667294))&&r.__esModule?r:{default:r};function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},101706:(e,t,n)=>{"use strict";e.exports=function(){throw new Error("Don't instantiate Resizable directly! Use require('react-resizable').Resizable")},e.exports.Resizable=n(122827).default,e.exports.ResizableBox=n(808735).default},324903:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(667294),i=l(o),a=l(n(45697)),s=n(376597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){if("undefined"!==typeof e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),r=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return r.type=r.type||"search",r.value=this.state.searchTerm,r.onChange=this.updateSearch,r.className=n,r.placeholder=r.placeholder||"Search",i.default.createElement("div",{className:t},i.default.createElement("input",r))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,r=t.caseSensitive,o=t.fuzzy,i=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:r,fuzzy:o,sortResults:i})}}]),t}(o.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},s.createFilter},376597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=s,t.searchStrings=l,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var o=e.split(" ");return t?("string"===typeof t&&(t=[t]),o.every((function(e){var o=void 0;if(-1!==e.indexOf(":")){var i=e.split(":")[0];e=e.split(":")[1],o=t.filter((function(e){return e.toLowerCase().indexOf(i)>-1}))}else o=t;return o.some((function(t){return l(s(t,r),e,n)}))}))):o.every((function(e){return l([r],e,n)}))}};var r,o=n(369021),i=(r=o)&&r.__esModule?r:{default:r};function a(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?a(t):t)}),[])}function s(e,t){var n=e.split("."),r=[t];return n.forEach((function(e){var t=[];r.forEach((function(n){if(n)if(n instanceof Array){var r=parseInt(e,10);if(!isNaN(r))return t.push(n[r]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"===typeof n.get?t.push(n.get(e)):t.push(n[e])})),r=t})),(r=a(r=r.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"===typeof e||"number"===typeof e}))}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{return o?("function"===typeof e.toJS&&(e=e.toJS()),new i.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:r,shouldSort:a}).search(t).length):e.some((function(e){try{return r||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},369021:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var r=n.location,o=void 0===r?0:r,i=n.distance,a=void 0===i?100:i,l=n.threshold,d=void 0===l?.6:l,u=n.maxPatternLength,c=void 0===u?32:u,p=n.caseSensitive,h=void 0!==p&&p,f=n.tokenSeparator,g=void 0===f?/ +/g:f,m=n.findAllMatches,v=void 0!==m&&m,b=n.minMatchCharLength,y=void 0===b?1:b,x=n.id,C=void 0===x?null:x,w=n.keys,S=void 0===w?[]:w,Z=n.shouldSort,k=void 0===Z||Z,M=n.getFn,D=void 0===M?s:M,E=n.sortFn,R=void 0===E?function(e,t){return e.score-t.score}:E,T=n.tokenize,_=void 0!==T&&T,I=n.matchAllTokens,O=void 0!==I&&I,P=n.includeMatches,z=void 0!==P&&P,F=n.includeScore,N=void 0!==F&&F,$=n.verbose,L=void 0!==$&&$;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:o,distance:a,threshold:d,maxPatternLength:c,isCaseSensitive:h,tokenSeparator:g,findAllMatches:v,minMatchCharLength:y,id:C,keys:S,includeMatches:z,includeScore:N,shouldSort:k,getFn:D,sortFn:R,verbose:L,tokenize:_,matchAllTokens:O},this.setCollection(t),this._processKeys(S)}var t,n,a;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var o=null,i=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var u=d.name;if(this._keyNames.push(u),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var c=d.weight;if(c<0||c>1)throw new Error('"weight" property in key must bein the range of [0, 1)');i=null==i?c:Math.max(i,c),o=null==o?c:Math.min(o,c),this._keyWeights[u]=c,a+=c}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,o=n.fullSearcher,i=this._search(r,o);return this._computeScore(i),this.options.shouldSort&&this._sort(i),t.limit&&"number"==typeof t.limit&&(i=i.slice(0,t.limit)),this._format(i)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,o=n.length;r<o;r+=1)t.push(new i(n[r],this.options));return{tokenSearchers:t,fullSearcher:new i(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},o=[];if("string"==typeof n[0]){for(var i=0,a=n.length;i<a;i+=1)this._analyze({key:"",value:n[i],record:i,index:i},{resultMap:r,results:o,tokenSearchers:e,fullSearcher:t});return o}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],u=0,c=this._keyNames.length;u<c;u+=1){var p=this._keyNames[u];this._analyze({key:p,value:this.options.getFn(d,p),record:d,index:s},{resultMap:r,results:o,tokenSearchers:e,fullSearcher:t})}return o}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,o=e.arrayIndex,i=void 0===o?-1:o,a=e.value,s=e.record,d=e.index,u=t.tokenSearchers,c=void 0===u?[]:u,p=t.fullSearcher,h=t.resultMap,f=void 0===h?{}:h,g=t.results,m=void 0===g?[]:g;!function e(t,o,i,a){if(null!=o)if("string"==typeof o){var s=!1,d=-1,u=0;n._log("\nKey: ".concat(""===r?"--":r));var h=p.search(o);if(n._log('Full text: "'.concat(o,'", score: ').concat(h.score)),n.options.tokenize){for(var g=o.split(n.options.tokenSeparator),v=g.length,b=[],y=0,x=c.length;y<x;y+=1){var C=c[y];n._log('\nPattern: "'.concat(C.pattern,'"'));for(var w=!1,S=0;S<v;S+=1){var Z=g[S],k=C.search(Z),M={};k.isMatch?(M[Z]=k.score,s=!0,w=!0,b.push(k.score)):(M[Z]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(Z,'", score: ').concat(M[Z]))}w&&(u+=1)}d=b[0];for(var D=b.length,E=1;E<D;E+=1)d+=b[E];d/=D,n._log("Token score average:",d)}var R=h.score;d>-1&&(R=(R+d)/2),n._log("Score average:",R);var T=!n.options.tokenize||!n.options.matchAllTokens||u>=c.length;if(n._log("\nCheck Matches: ".concat(T)),(s||h.isMatch)&&T){var _={key:r,arrayIndex:t,value:o,score:R};n.options.includeMatches&&(_.matchedIndices=h.matchedIndices);var I=f[a];I?I.output.push(_):(f[a]={item:i,output:[_]},m.push(f[a]))}}else if(l(o))for(var O=0,P=o.length;O<P;O+=1)e(O,o[O],i,a)}(i,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,o=e.length;r<o;r+=1){for(var i=e[r],a=i.output,s=a.length,l=1,d=0;d<s;d+=1){var u=a[d],c=u.key,p=n?t[c]:1,h=0===u.score&&t&&t[c]>0?Number.EPSILON:u.score;l*=Math.pow(h,p)}i.score=l,this._log(i)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var o=[];this.options.includeMatches&&o.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,o=n.length;r<o;r+=1){var i=n[r];if(0!==i.matchedIndices.length){var a={indices:i.matchedIndices,value:i.value};i.key&&(a.key=i.key),i.hasOwnProperty("arrayIndex")&&i.arrayIndex>-1&&(a.arrayIndex=i.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&o.push((function(e,t){t.score=e.score}));for(var i=0,a=e.length;i<a;i+=1){var s=e[i];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),o.length){for(var l={item:s.item},d=0,u=o.length;d<u;d+=1)o[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&o(t.prototype,n),a&&o(t,a),e}();e.exports=d},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(2),i=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,o=void 0===r?0:r,i=n.distance,s=void 0===i?100:i,l=n.threshold,d=void 0===l?.6:l,u=n.maxPatternLength,c=void 0===u?32:u,p=n.isCaseSensitive,h=void 0!==p&&p,f=n.tokenSeparator,g=void 0===f?/ +/g:f,m=n.findAllMatches,v=void 0!==m&&m,b=n.minMatchCharLength,y=void 0===b?1:b,x=n.includeMatches,C=void 0!==x&&x;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:o,distance:s,threshold:d,maxPatternLength:c,isCaseSensitive:h,tokenSeparator:g,findAllMatches:v,includeMatches:C,minMatchCharLength:y},this.pattern=h?t:t.toLowerCase(),this.pattern.length<=c&&(this.patternAlphabet=a(this.pattern))}var t,n,s;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return o(e,this.pattern,d);var u=this.options,c=u.location,p=u.distance,h=u.threshold,f=u.findAllMatches,g=u.minMatchCharLength;return i(e,this.pattern,this.patternAlphabet,{location:c,distance:p,threshold:h,findAllMatches:f,minMatchCharLength:g,includeMatches:r})}}])&&r(t.prototype,n),s&&r(t,s),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,o=new RegExp(t.replace(n,"\\$&").replace(r,"|")),i=e.match(o),a=!!i,s=[];if(a)for(var l=0,d=i.length;l<d;l+=1){var u=i[l];s.push([e.indexOf(u),u.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),o=n(5);e.exports=function(e,t,n,i){for(var a=i.location,s=void 0===a?0:a,l=i.distance,d=void 0===l?100:l,u=i.threshold,c=void 0===u?.6:u,p=i.findAllMatches,h=void 0!==p&&p,f=i.minMatchCharLength,g=void 0===f?1:f,m=i.includeMatches,v=void 0!==m&&m,b=s,y=e.length,x=c,C=e.indexOf(t,b),w=t.length,S=[],Z=0;Z<y;Z+=1)S[Z]=0;if(-1!==C){var k=r(t,{errors:0,currentLocation:C,expectedLocation:b,distance:d});if(x=Math.min(k,x),-1!==(C=e.lastIndexOf(t,b+w))){var M=r(t,{errors:0,currentLocation:C,expectedLocation:b,distance:d});x=Math.min(M,x)}}C=-1;for(var D=[],E=1,R=w+y,T=1<<(w<=31?w-1:30),_=0;_<w;_+=1){for(var I=0,O=R;I<O;)r(t,{errors:_,currentLocation:b+O,expectedLocation:b,distance:d})<=x?I=O:R=O,O=Math.floor((R-I)/2+I);R=O;var P=Math.max(1,b-O+1),z=h?y:Math.min(b+O,y)+w,F=Array(z+2);F[z+1]=(1<<_)-1;for(var N=z;N>=P;N-=1){var $=N-1,L=n[e.charAt($)];if(L&&(S[$]=1),F[N]=(F[N+1]<<1|1)&L,0!==_&&(F[N]|=(D[N+1]|D[N])<<1|1|D[N+1]),F[N]&T&&(E=r(t,{errors:_,currentLocation:$,expectedLocation:b,distance:d}))<=x){if(x=E,(C=$)<=b)break;P=Math.max(1,2*b-C)}}if(r(t,{errors:_+1,currentLocation:b,expectedLocation:b,distance:d})>x)break;D=F}var B={isMatch:C>=0,score:0===E?.001:E};return v&&(B.matchedIndices=o(S,g)),B}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,o=t.currentLocation,i=void 0===o?0:o,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,u=r/e.length,c=Math.abs(s-i);return d?u+c/d:c?1:u}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,o=-1,i=0,a=e.length;i<a;i+=1){var s=e[i];s&&-1===r?r=i:s||-1===r||((o=i-1)-r+1>=t&&n.push([r,o]),r=-1)}return e[i-1]&&i-r>=t&&n.push([r,i-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var o=0;o<n;o+=1)t[e.charAt(o)]|=1<<n-o-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},o=function(e){return"string"==typeof e},i=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,u=null;-1!==l&&(d=s.slice(0,l),u=s.slice(l+1));var c=t[d];if(null!=c)if(u||!o(c)&&!i(c))if(n(c))for(var p=0,h=c.length;p<h;p+=1)e(c[p],u);else u&&e(c,u);else a.push(r(c))}else a.push(t)}(e,t),a},isArray:n,isString:o,isNum:i,toString:r}}])},782607:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(205872),o=n.n(r),i=(n(667294),n(751995)),a=n(762529),s=n(211965);const l=(0,i.iK)((({textColor:e,color:t,text:n,...r})=>(0,s.tZ)(a.Z,o()({text:n,color:n?t:void 0},r))))`
  & > sup {
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    background: ${({theme:e,color:t})=>t||e.colors.primary.base};
    color: ${({theme:e,textColor:t})=>t||e.colors.grayscale.light5};
  }
`},138270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(205872),o=n.n(r),i=n(667294),a=n(473727),s=n(828216),l=n(294184),d=n.n(l),u=n(751995),c=n(455867),p=n(211965),h=n(358593),f=n(52004),g=n(679789);const m=(0,u.iK)(g.Z)`
  vertical-align: middle;
`;function v({canEdit:e=!1,editing:t=!1,extraClasses:n,multiLine:r=!1,noPermitTooltip:l,onSaveTitle:u,showTooltip:g=!0,headerTooltip:v,style:b,textareaStyle:y,title:x="",defaultTitle:C="",placeholder:w="",certifiedBy:S,certificationDetails:Z,url:k,textColor:M,...D}){const[E,R]=(0,i.useState)(t),[T,_]=(0,i.useState)(x),[I,O]=(0,i.useState)(x),[P,z]=(0,i.useState)(null),F=(0,s.v9)((e=>e.dashboardState.layoutMode||f.kB.PC)),N=(0,i.useRef)();function $(){if(!e||E)return;const t=y||(N.current?N.current.getBoundingClientRect():null);R(!0),z(t)}function L(){const t=T.trim();e&&(R(!1),t.length?(I!==t&&O(t),x!==t&&u(t)):_(I))}function B(e){" "===e.key&&e.stopPropagation()}function A(t){e&&_(t.target.value)}function j(e){}function H(e){const t=e.split("\n");return t.map(((e,n)=>(0,p.tZ)(i.Fragment,null,e,n<t.length-1?(0,p.tZ)("br",null):null)))}let q;(0,i.useEffect)((()=>{x!==T&&(O(T),_(x))}),[x]),(0,i.useEffect)((()=>{if(E&&(N.current.focus(),N.current.setSelectionRange)){const{length:e}=N.current.value;N.current.setSelectionRange(e,e),N.current.scrollLeft=N.current.scrollWidth,N.current.scrollTop=N.current.scrollHeight}}),[E]),q=T,E||T||(q=C||x);const U=P?{height:`${P.height}px`,width:`${P.width}px`}:void 0;let V=r?E?(0,p.tZ)("textarea",{"data-test":"editable-title-input",ref:N,value:q,className:x?void 0:"text-muted",onKeyDown:B,onChange:A,onBlur:L,onClick:$,onKeyPress:j,placeholder:w,style:U}):(0,p.tZ)("div",{onClick:$},H(q)):(0,p.tZ)("input",{"data-test":"editable-title-input",ref:N,type:E?"text":"button",value:q,className:x?void 0:"text-muted",onKeyDown:B,onChange:A,onBlur:L,onClick:$,onKeyPress:j,placeholder:w});return g&&!E&&(V=(0,p.tZ)(h.u,{id:"title-tooltip",title:e?(0,c.t)("Click to edit"):l||(0,c.t)("You don't have the rights to alter this title.")},V)),e||(V=k?(0,p.tZ)(h.u,{title:v},(0,p.tZ)(a.rU,{to:F===f.kB.PC?k:"#",onClick:e=>{F===f.kB.MOBILE&&e.preventDefault()},"data-test":"editable-title-input",css:e=>p.iv`
            color: ${M||e.colors.grayscale.dark1};
            text-decoration: none;
            :hover {
              text-decoration: underline;
            }
          `},H(q))):(0,p.tZ)("span",{"data-test":"editable-title-input"},H(q))),(0,p.tZ)("div",o()({"data-test":"editable-title",className:d()("editable-title",n,e&&"editable-title--editable",E&&"editable-title--editing"),style:b},D),S&&(0,p.tZ)(i.Fragment,null,(0,p.tZ)(m,{certifiedBy:S,details:Z,size:"xl"})," "),V)}},229147:(e,t,n)=>{"use strict";n.d(t,{DG:()=>d,fG:()=>l});var r=n(667294),o=n(427600),i=n(23525),a=n(211965);const s=(0,r.createContext)({hideTitle:!1,hideTab:!1,hideNav:!1,hideChartControls:!1}),l=()=>(0,r.useContext)(s),d=({children:e})=>{const t=(0,i.eY)(o.KD.uiConfig)||0,[n]=(0,r.useState)({hideTitle:0!==(1&t),hideTab:0!==(2&t),hideNav:0!==(4&t),hideChartControls:0!==(8&t)});return(0,a.tZ)(s.Provider,{value:n},e)}},645433:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(667294),o=n(455867),i=(n(23525),n(414114)),a=n(828216);n(998286);function s({dashboardId:e,anchorLinkId:t,placement:n="right",emailContent:o="",emailSubject:s=""}){const[l,d]=(0,r.useState)(""),{addDangerToast:u}=(0,i.e1)(),{dataMask:c,activeTabs:p}=(0,a.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs})));return null}var l=n(156967),d=n(211965);function u({id:e,dashboardId:t,placement:n="right",scrollIntoView:i=!1,showShortLinkButton:a=!0}){const u=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({block:"center",behavior:"smooth"})},c=(0,l.Z)();return(0,r.useEffect)((()=>{c&&e===c&&u(e)}),[c,e]),(0,r.useEffect)((()=>{i&&u(e)}),[e,i]),(0,d.tZ)("span",{className:"anchor-link-container",id:e},a&&t&&(0,d.tZ)(s,{anchorLinkId:e,dashboardId:t,emailSubject:(0,o.t)("Superset chart"),emailContent:(0,o.t)("Check out this chart in dashboard:"),placement:n}))}},60071:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>bD});var r=n(14890),o=n(828216),i=n(52004),a=n(667294),s=n(45697),l=n.n(s),d=n(455867),u=n(593185),c=(n(676986),n(514278)),p=n(838703),h=n(920292),f=n(81255);function g(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===f.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var m,v=n(294184),b=n.n(v),y=n(751995),x=n(211965),C=n(25130),w=n(174599),S=n(441609),Z=n.n(S),k=n(730381),M=n.n(k),D=(n(470463),Object.defineProperty),E=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,_=(e,t,n)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))R.call(t,n)&&_(e,n,t[n]);if(E)for(var n of E(t))T.call(t,n)&&_(e,n,t[n]);return e},O=(e,t)=>{var n={};for(var r in e)R.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&E)for(var r of E(e))t.indexOf(r)<0&&T.call(e,r)&&(n[r]=e[r]);return n};(e=>{const t=class{constructor(e,n,r,o){if(this.version=e,this.errorCorrectionLevel=n,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version value out of range");if(o<-1||o>7)throw new RangeError("Mask value out of range");this.size=4*e+17;let a=[];for(let e=0;e<this.size;e++)a.push(!1);for(let e=0;e<this.size;e++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const s=this.addEccAndInterleave(r);if(this.drawCodewords(s),-1==o){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const n=this.getPenaltyScore();n<e&&(o=t,e=n),this.applyMask(t)}}i(0<=o&&o<=7),this.mask=o,this.applyMask(o),this.drawFormatBits(o),this.isFunction=[]}static encodeText(n,r){const o=e.QrSegment.makeSegments(n);return t.encodeSegments(o,r)}static encodeBinary(n,r){const o=e.QrSegment.makeBytes(n);return t.encodeSegments([o],r)}static encodeSegments(e,n,o=1,a=40,l=-1,d=!0){if(!(t.MIN_VERSION<=o&&o<=a&&a<=t.MAX_VERSION)||l<-1||l>7)throw new RangeError("Invalid value");let u,c;for(u=o;;u++){const r=8*t.getNumDataCodewords(u,n),o=s.getTotalBits(e,u);if(o<=r){c=o;break}if(u>=a)throw new RangeError("Data too long")}for(const e of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])d&&c<=8*t.getNumDataCodewords(u,e)&&(n=e);let p=[];for(const t of e){r(t.mode.modeBits,4,p),r(t.numChars,t.mode.numCharCountBits(u),p);for(const e of t.getData())p.push(e)}i(p.length==c);const h=8*t.getNumDataCodewords(u,n);i(p.length<=h),r(0,Math.min(4,h-p.length),p),r(0,(8-p.length%8)%8,p),i(p.length%8==0);for(let e=236;p.length<h;e^=253)r(e,8,p);let f=[];for(;8*f.length<p.length;)f.push(0);return p.forEach(((e,t)=>f[t>>>3]|=e<<7-(7&t))),new t(u,n,f,l)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)0==n&&0==r||0==n&&r==t-1||n==t-1&&0==r||this.drawAlignmentPattern(e[n],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let n=t;for(let e=0;e<10;e++)n=n<<1^1335*(n>>>9);const r=21522^(t<<10|n);i(r>>>15==0);for(let e=0;e<=5;e++)this.setFunctionModule(8,e,o(r,e));this.setFunctionModule(8,7,o(r,6)),this.setFunctionModule(8,8,o(r,7)),this.setFunctionModule(7,8,o(r,8));for(let e=9;e<15;e++)this.setFunctionModule(14-e,8,o(r,e));for(let e=0;e<8;e++)this.setFunctionModule(this.size-1-e,8,o(r,e));for(let e=8;e<15;e++)this.setFunctionModule(8,this.size-15+e,o(r,e));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^7973*(e>>>11);const t=this.version<<12|e;i(t>>>18==0);for(let e=0;e<18;e++){const n=o(t,e),r=this.size-11+e%3,i=Math.floor(e/3);this.setFunctionModule(r,i,n),this.setFunctionModule(i,r,n)}}drawFinderPattern(e,t){for(let n=-4;n<=4;n++)for(let r=-4;r<=4;r++){const o=Math.max(Math.abs(r),Math.abs(n)),i=e+r,a=t+n;0<=i&&i<this.size&&0<=a&&a<this.size&&this.setFunctionModule(i,a,2!=o&&4!=o)}}drawAlignmentPattern(e,t){for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,t+n,1!=Math.max(Math.abs(r),Math.abs(n)))}setFunctionModule(e,t,n){this.modules[t][e]=n,this.isFunction[t][e]=!0}addEccAndInterleave(e){const n=this.version,r=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(n,r))throw new RangeError("Invalid argument");const o=t.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][n],a=t.ECC_CODEWORDS_PER_BLOCK[r.ordinal][n],s=Math.floor(t.getNumRawDataModules(n)/8),l=o-s%o,d=Math.floor(s/o);let u=[];const c=t.reedSolomonComputeDivisor(a);for(let n=0,r=0;n<o;n++){let o=e.slice(r,r+d-a+(n<l?0:1));r+=o.length;const i=t.reedSolomonComputeRemainder(o,c);n<l&&o.push(0),u.push(o.concat(i))}let p=[];for(let e=0;e<u[0].length;e++)u.forEach(((t,n)=>{(e!=d-a||n>=l)&&p.push(t[e])}));return i(p.length==s),p}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let r=0;r<this.size;r++)for(let i=0;i<2;i++){const a=t-i,s=0==(t+1&2)?this.size-1-r:r;!this.isFunction[s][a]&&n<8*e.length&&(this.modules[s][a]=o(e[n>>>3],7-(7&n)),n++)}}i(n==8*e.length)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let n=0;n<this.size;n++){let r;switch(e){case 0:r=(n+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=n%3==0;break;case 3:r=(n+t)%3==0;break;case 4:r=(Math.floor(n/3)+Math.floor(t/2))%2==0;break;case 5:r=n*t%2+n*t%3==0;break;case 6:r=(n*t%2+n*t%3)%2==0;break;case 7:r=((n+t)%2+n*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][n]&&r&&(this.modules[t][n]=!this.modules[t][n])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let r=!1,o=0,i=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[n][a]==r?(o++,5==o?e+=t.PENALTY_N1:o>5&&e++):(this.finderPenaltyAddHistory(o,i),r||(e+=this.finderPenaltyCountPatterns(i)*t.PENALTY_N3),r=this.modules[n][a],o=1);e+=this.finderPenaltyTerminateAndCount(r,o,i)*t.PENALTY_N3}for(let n=0;n<this.size;n++){let r=!1,o=0,i=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[a][n]==r?(o++,5==o?e+=t.PENALTY_N1:o>5&&e++):(this.finderPenaltyAddHistory(o,i),r||(e+=this.finderPenaltyCountPatterns(i)*t.PENALTY_N3),r=this.modules[a][n],o=1);e+=this.finderPenaltyTerminateAndCount(r,o,i)*t.PENALTY_N3}for(let n=0;n<this.size-1;n++)for(let r=0;r<this.size-1;r++){const o=this.modules[n][r];o==this.modules[n][r+1]&&o==this.modules[n+1][r]&&o==this.modules[n+1][r+1]&&(e+=t.PENALTY_N2)}let n=0;for(const e of this.modules)n=e.reduce(((e,t)=>e+(t?1:0)),n);const r=this.size*this.size,o=Math.ceil(Math.abs(20*n-10*r)/r)-1;return i(0<=o&&o<=9),e+=o*t.PENALTY_N4,i(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{const e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2));let n=[6];for(let r=this.size-7;n.length<e;r-=t)n.splice(1,0,r);return n}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version number out of range");let n=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;n-=(25*t-10)*t-55,e>=7&&(n-=36)}return i(208<=n&&n<=29648),n}static getNumDataCodewords(e,n){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[n.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let n=[];for(let t=0;t<e-1;t++)n.push(0);n.push(1);let r=1;for(let o=0;o<e;o++){for(let e=0;e<n.length;e++)n[e]=t.reedSolomonMultiply(n[e],r),e+1<n.length&&(n[e]^=n[e+1]);r=t.reedSolomonMultiply(r,2)}return n}static reedSolomonComputeRemainder(e,n){let r=n.map((e=>0));for(const o of e){const e=o^r.shift();r.push(0),n.forEach(((n,o)=>r[o]^=t.reedSolomonMultiply(n,e)))}return r}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^285*(n>>>7),n^=(t>>>r&1)*e;return i(n>>>8==0),n}finderPenaltyCountPatterns(e){const t=e[1];i(t<=3*this.size);const n=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(n&&e[0]>=4*t&&e[6]>=t?1:0)+(n&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,n){return e&&(this.finderPenaltyAddHistory(t,n),t=0),t+=this.size,this.finderPenaltyAddHistory(t,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};let n=t;function r(e,t,n){if(t<0||t>31||e>>>t!=0)throw new RangeError("Value out of range");for(let r=t-1;r>=0;r--)n.push(e>>>r&1)}function o(e,t){return 0!=(e>>>t&1)}function i(e){if(!e)throw new Error("Assertion error")}n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=n;const a=class{constructor(e,t,n){if(this.mode=e,this.numChars=t,this.bitData=n,t<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(e){let t=[];for(const n of e)r(n,8,t);return new a(a.Mode.BYTE,e.length,t)}static makeNumeric(e){if(!a.isNumeric(e))throw new RangeError("String contains non-numeric characters");let t=[];for(let n=0;n<e.length;){const o=Math.min(e.length-n,3);r(parseInt(e.substr(n,o),10),3*o+1,t),n+=o}return new a(a.Mode.NUMERIC,e.length,t)}static makeAlphanumeric(e){if(!a.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t,n=[];for(t=0;t+2<=e.length;t+=2){let o=45*a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t));o+=a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),r(o,11,n)}return t<e.length&&r(a.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,n),new a(a.Mode.ALPHANUMERIC,e.length,n)}static makeSegments(e){return""==e?[]:a.isNumeric(e)?[a.makeNumeric(e)]:a.isAlphanumeric(e)?[a.makeAlphanumeric(e)]:[a.makeBytes(a.toUtf8ByteArray(e))]}static makeEci(e){let t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)r(e,8,t);else if(e<16384)r(2,2,t),r(e,14,t);else{if(!(e<1e6))throw new RangeError("ECI assignment value out of range");r(6,3,t),r(e,21,t)}return new a(a.Mode.ECI,0,t)}static isNumeric(e){return a.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return a.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let n=0;for(const r of e){const e=r.mode.numCharCountBits(t);if(r.numChars>=1<<e)return 1/0;n+=4+e+r.bitData.length}return n}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let n=0;n<e.length;n++)"%"!=e.charAt(n)?t.push(e.charCodeAt(n)):(t.push(parseInt(e.substr(n+1,2),16)),n+=2);return t}};let s=a;s.NUMERIC_REGEX=/^[0-9]*$/,s.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,s.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.QrSegment=s})(m||(m={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};let n=t;n.LOW=new t(0,1),n.MEDIUM=new t(1,0),n.QUARTILE=new t(2,3),n.HIGH=new t(3,2),e.Ecc=n})(t=e.QrCode||(e.QrCode={}))})(m||(m={})),(e=>{let t;(e=>{const t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};let n=t;n.NUMERIC=new t(1,[10,12,14]),n.ALPHANUMERIC=new t(2,[9,11,13]),n.BYTE=new t(4,[8,16,16]),n.KANJI=new t(8,[8,10,12]),n.ECI=new t(7,[0,0,0]),e.Mode=n})(t=e.QrSegment||(e.QrSegment={}))})(m||(m={}));var P=m,z={L:P.QrCode.Ecc.LOW,M:P.QrCode.Ecc.MEDIUM,Q:P.QrCode.Ecc.QUARTILE,H:P.QrCode.Ecc.HIGH},F=128,N="L",$="#FFFFFF",L="#000000",B=!1,A=4,j=.1;function H(e,t=0){const n=[];return e.forEach((function(e,r){let o=null;e.forEach((function(i,a){if(!i&&null!==o)return n.push(`M${o+t} ${r+t}h${a-o}v1H${o+t}z`),void(o=null);if(a!==e.length-1)i&&null===o&&(o=a);else{if(!i)return;null===o?n.push(`M${a+t},${r+t} h1v1H${a+t}z`):n.push(`M${o+t},${r+t} h${a+1-o}v1H${o+t}z`)}}))})),n.join("")}function q(e,t){return e.slice().map(((e,n)=>n<t.y||n>=t.y+t.h?e:e.map(((e,n)=>(n<t.x||n>=t.x+t.w)&&e))))}function U(e,t,n,r){if(null==r)return null;const o=n?A:0,i=e.length+2*o,a=Math.floor(t*j),s=i/t,l=(r.width||a)*s,d=(r.height||a)*s,u=null==r.x?e.length/2-l/2:r.x*s,c=null==r.y?e.length/2-d/2:r.y*s;let p=null;if(r.excavate){let e=Math.floor(u),t=Math.floor(c);p={x:e,y:t,w:Math.ceil(l+u-e),h:Math.ceil(d+c-t)}}return{x:u,y:c,h:d,w:l,excavation:p}}var V=function(){try{(new Path2D).addPath(new Path2D)}catch(e){return!1}return!0}();function W(e){const t=e,{value:n,size:r=F,level:o=N,bgColor:i=$,fgColor:s=L,includeMargin:l=B,style:d,imageSettings:u}=t,c=O(t,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),p=null==u?void 0:u.src,h=(0,a.useRef)(null),f=(0,a.useRef)(null),[g,m]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(null!=h.current){const e=h.current,t=e.getContext("2d");if(!t)return;let a=P.QrCode.encodeText(n,z[o]).getModules();const d=l?A:0,c=a.length+2*d,p=U(a,r,l,u),g=f.current,m=null!=p&&null!==g&&g.complete&&0!==g.naturalHeight&&0!==g.naturalWidth;m&&null!=p.excavation&&(a=q(a,p.excavation));const v=window.devicePixelRatio||1;e.height=e.width=r*v;const b=r/c*v;t.scale(b,b),t.fillStyle=i,t.fillRect(0,0,c,c),t.fillStyle=s,V?t.fill(new Path2D(H(a,d))):a.forEach((function(e,n){e.forEach((function(e,r){e&&t.fillRect(r+d,n+d,1,1)}))})),m&&t.drawImage(g,p.x+d,p.y+d,p.w,p.h)}})),(0,a.useEffect)((()=>{m(!1)}),[p]);const v=I({height:r,width:r},d);let b=null;return null!=p&&(b=a.createElement("img",{src:p,key:p,style:{display:"none"},onLoad:()=>{m(!0)},ref:f})),a.createElement(a.Fragment,null,a.createElement("canvas",I({style:v,height:r,width:r,ref:h},c)),b)}function G(e){const t=e,{value:n,size:r=F,level:o=N,bgColor:i=$,fgColor:s=L,includeMargin:l=B,imageSettings:d}=t,u=O(t,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let c=P.QrCode.encodeText(n,z[o]).getModules();const p=l?A:0,h=c.length+2*p,f=U(c,r,l,d);let g=null;null!=d&&null!=f&&(null!=f.excavation&&(c=q(c,f.excavation)),g=a.createElement("image",{xlinkHref:d.src,height:f.h,width:f.w,x:f.x+p,y:f.y+p,preserveAspectRatio:"none"}));const m=H(c,p);return a.createElement("svg",I({height:r,width:r,viewBox:`0 0 ${h} ${h}`},u),a.createElement("path",{fill:i,d:`M0,0 h${h}v${h}H0z`,shapeRendering:"crispEdges"}),a.createElement("path",{fill:s,d:m,shapeRendering:"crispEdges"}),g)}var K=e=>{const t=e,{renderAs:n}=t,r=O(t,["renderAs"]);return"svg"===n?a.createElement(G,I({},r)):a.createElement(W,I({},r))},Y=n(748086),X=n(126272),Q=n(855241),J=n(175049),ee=n(431069),te=n(478161),ne=n(958452),re=n(807500),oe=n(591877),ie=n(203741),ae=n(731293),se=n(835932),le=n(287183),de=n(49937),ue=n(212617),ce=n(358593),pe=n(309679),he=n(205872),fe=n.n(he),ge=n(683862),me=n(427600),ve=n(710222),be=n(68492),ye=n(23525);const xe=e=>{const{copyMenuItemTitle:t,emailMenuItemTitle:n,temporaryShare:r,emailSubject:i,emailBody:a,addDangerToast:s,addSuccessToast:l,dashboardId:u,dashboardComponentId:c,recordShareLog:p=(()=>{}),...h}=e,{dataMask:f,activeTabs:g}=(0,o.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs})));return(0,x.tZ)(ge.v2,{selectable:!1},r,(0,x.tZ)(ge.v2.Item,fe()({key:"copy-url"},h),(0,x.tZ)("div",{onClick:async function(){try{const{origin:e}=window.location,n=`${e}/superset/dashboard/${u}/?standalone=true`,r=()=>new Promise((e=>{e(n)}));await(0,ve.Z)(r),l((0,d.t)("Copied to clipboard!")),p(t,n)}catch(e){be.Z.error(e),s((0,d.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},t)),(0,x.tZ)(ge.v2.Item,fe()({key:"share-by-email"},h),(0,x.tZ)("div",{onClick:async function(){try{const e=encodeURIComponent(`${a}${await async function(){return(0,ye.Nm)({dashboardId:u,dataMask:f,activeTabs:g,anchor:c})}()}`),n=encodeURIComponent(i);window.location.href=`mailto:?Subject=${n}%20&Body=${e}`,p(t,e)}catch(e){be.Z.error(e),s((0,d.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},n)))};var Ce=n(601304),we=n(794670);const Se=y.iK.div`
  ${({theme:e})=>`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      h5 {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${e.colors.grayscale.light1};\n    }\n  `}
`,Ze={initialCss:l().string,triggerNode:l().node.isRequired,onChange:l().func,templates:l().array};class ke extends a.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){we.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate({key:e}){this.changeCss(e)}renderTemplateSelector(){if(this.props.templates){const e=(0,x.tZ)(ge.v2,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,x.tZ)(ge.v2.Item,{key:e.css},e.label))));return(0,x.tZ)(de.Gj,{overlay:e,placement:"bottomRight"},(0,x.tZ)(se.Z,null,(0,d.t)("Load a CSS template")))}return null}render(){return(0,x.tZ)(Ce.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("CSS"),modalBody:(0,x.tZ)(Se,null,(0,x.tZ)("div",{className:"css-editor-header"},(0,x.tZ)("h5",null,(0,d.t)("Live CSS editor")),this.renderTemplateSelector()),(0,x.tZ)(we.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}ke.propTypes=Ze,ke.defaultProps={initialCss:"",onChange:()=>{}};const Me=ke;var De=n(281315),Ee=n(229487),Re=n(49238),Te=n(985633);const _e=(0,y.iK)(Ce.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,Ie=y.iK.div`
  margin-top: ${({theme:e})=>6*e.gridUnit}px;
`;class Oe extends a.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=a.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e,t;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef)||null==(t=e.current)||t.close(),this.props.addSuccessToast((0,d.t)("Refresh interval saved"))}onCancel(){var e,t;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef)||null==(t=e.current)||t.close()}handleFrequencyChange(e){const{refreshIntervalOptions:t}=this.props;this.setState({refreshFrequency:e||t[0][0]})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n,refreshIntervalOptions:r}=this.props,{refreshFrequency:o=0}=this.state,i=!!o&&!!t&&o<e;return(0,x.tZ)(_e,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Refresh interval"),modalBody:(0,x.tZ)("div",null,(0,x.tZ)(Re.lX,null,(0,d.t)("Refresh frequency")),(0,x.tZ)(De.Z,{ariaLabel:(0,d.t)("Refresh interval"),options:r.map((e=>({value:e[0],label:(0,d.t)(e[1])}))),value:o,onChange:this.handleFrequencyChange,sortComparator:(0,Te.mj)("value")}),i&&(0,x.tZ)(Ie,null,(0,x.tZ)(Ee.Z,{type:"warning",message:(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",null,t),(0,x.tZ)("br",null),(0,x.tZ)("strong",null,(0,d.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,d.t)("Save"):(0,d.t)("Save for this session")),(0,x.tZ)(se.Z,{onClick:this.onCancel,buttonSize:"small"},(0,d.t)("Cancel")))})}}Oe.defaultProps={refreshLimit:0,refreshWarning:null};const Pe=Oe;var ze=n(164561),Fe=n(970553),Ne=n(268084),$e=n(9875),Le=n(787253),Be=n(680621);const Ae={saveType:Be.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1},je=(e,t)=>{e.forEach((e=>{e.title=e.name,e.allname=t+(t?"-":"")+e.name,e.value=e.group_id,e.children.length>0&&je(e.children,e.name)}))};class He extends a.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:e.dashboardTitle+(0,d.t)("[copy]"),duplicateSlices:!1,checkedvaluedashboard:Number(sessionStorage.getItem("dashboardGroup_id")||"0"),treeDatadashboard:[],checkedvaluechart:"",treeDatachart:[]},this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this),this.modal=a.createRef(),this.selectonChangedashboard=this.selectonChangedashboard.bind(this),this.getGroup=this.getGroup.bind(this),this.selectonChangechart=this.selectonChangechart.bind(this),this.state.saveType===Be.kS&&this.getGroup("dashboard"),this.state.duplicateSlices&&this.getGroup("chart")}toggleDuplicateSlices(e){this.setState({duplicateSlices:e}),e&&this.getGroup("chart")}handleSaveTypeChange(e){this.setState({saveType:e.target.value}),this.state.saveType===Be.kS?this.getGroup("dashboard"):this.setState({duplicateSlices:!1})}handleNameChange(e){this.setState({newDashName:e,saveType:Be.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n,checkedvaluedashboard:r,checkedvaluechart:o}=this.state,{dashboardTitle:i,dashboardInfo:a,layout:s,mobileLayout:l,customCss:u,dashboardId:c,refreshFrequency:p,shouldPersistRefreshFrequency:h,lastModifiedTime:f}=this.props,g=h?p:null==(e=a.metadata)?void 0:e.refresh_frequency,m={certified_by:a.certified_by,certification_details:a.certification_details,css:u,dashboard_title:t===Be.kS?n:i,duplicate_slices:this.state.duplicateSlices,last_modified_time:f,owners:a.owners,roles:a.roles,metadata:{...null==a?void 0:a.metadata,positions:s,mobile_positions:l,refresh_frequency:g},mobile_metadata:{...null==a?void 0:a.mobile_metadata,positions:l,refresh_frequency:g},dashboard_group_id:t===Be.kS?r:null,slice_group_id:t===Be.kS&&this.state.duplicateSlices?o:null};var v,b;t!==Be.kS||n?(this.onSave(m,c,t).then((e=>{t===Be.kS&&e&&e.json&&e.json.id&&window.flushedtDealList()})),null==(v=this.modal)||null==(b=v.current)||null==b.close||b.close()):this.props.addDangerToast((0,d.t)("You must pick a name for the new dashboard"))}getGroup(e){ee.Z.get({endpoint:`/api/v2/${e}/group/tree/`}).then((t=>{200==t.json.meta.code||201==t.json.meta.code?(je(t.json.meta.data,null),"dashboard"==e&&this.setState({treeDatadashboard:t.json.meta.data}),"chart"==e&&this.setState({treeDatachart:t.json.meta.data})):Y.ZP.error(t.json.meta.message)}))}selectonChangedashboard(e){this.setState({checkedvaluedashboard:e})}selectonChangechart(e){this.setState({checkedvaluechart:e})}render(){return(0,x.tZ)(Ce.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Save dashboard"),modalBody:(0,x.tZ)("div",null,(0,x.tZ)(le.Y,{value:Be.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===Be.TN,disabled:!this.props.canOverwrite},(0,d.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,x.tZ)("hr",null),(0,x.tZ)(le.Y,{value:Be.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===Be.kS},(0,d.t)("Save as:")),this.state.saveType===Be.kS&&(0,x.tZ)(ze.Z,{labelCol:{span:4},wrapperCol:{span:14},layout:"horizontal"},(0,x.tZ)(ze.Z.Item,{label:(0,d.t)("Dashboard Name")},(0,x.tZ)($e.II,{type:"text",placeholder:(0,d.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)})),(0,x.tZ)(ze.Z.Item,{label:(0,d.t)("Select Directory")},(0,x.tZ)(Fe.Z,{showSearch:!0,value:this.state.checkedvaluedashboard,placeholder:(0,d.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:this.selectonChangedashboard,treeData:this.state.treeDatadashboard,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,x.tZ)(Ne.default,null)})),(0,x.tZ)("div",{className:"m-l-25 m-t-5"},(0,x.tZ)(Le.ZP,{checked:this.state.duplicateSlices,onChange:this.toggleDuplicateSlices}),(0,x.tZ)("span",{className:"m-l-5"},(0,d.t)("also copy (duplicate) charts"))),this.state.duplicateSlices&&(0,x.tZ)(ze.Z.Item,{label:(0,d.t)("Select Directory")},(0,x.tZ)(Fe.Z,{showSearch:!0,value:this.state.checkedvaluechart,placeholder:(0,d.t)("Please select"),allowClear:!0,treeDefaultExpandAll:!0,onChange:this.selectonChangechart,treeData:this.state.treeDatachart,treeNodeFilterProp:"title",treeIcon:!0,suffixIcon:(0,x.tZ)(Ne.default,null)})))),modalFooter:(0,x.tZ)("div",null,(0,x.tZ)(se.Z,{"data-test":"modal-save-dashboard-button",buttonStyle:"primary",onClick:this.saveDashboard},(0,d.t)("Save")))})}}He.defaultProps=Ae;const qe=He;var Ue=n(397634),Ve=n(514505),We=n(968084),Ge=n(456727),Ke=n(685832),Ye=n(813858),Xe=n(933691),Qe=n(411370);function Je({pathname:e,filters:t={},hash:n="",standalone:r}){const o=new URLSearchParams;o.set(me.KD.preselectFilters.name,JSON.stringify((0,Qe.Z)(t))),r&&o.set(me.KD.standalone.name,r.toString());const i=(0,ye.eY)(me.KD.nativeFiltersKey);i&&o.set(me.KD.nativeFiltersKey.name,i);const a=n?`#${n}`:"";return`${e}?${o.toString()}${a}`}var et=n(643399),tt=n(755961),nt=n(269856),rt=n(672570);const ot={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,dashboardInfo:l().object.isRequired,dashboardId:l().number,dashboardTitle:l().string,dataMask:l().object.isRequired,customCss:l().string,colorNamespace:l().string,colorScheme:l().string,onChange:l().func.isRequired,updateCss:l().func.isRequired,forceRefreshAllCharts:l().func.isRequired,refreshFrequency:l().number,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,startPeriodicRender:l().func.isRequired,editMode:l().bool.isRequired,userCanEdit:l().bool,userCanShare:l().bool,userCanSave:l().bool,userCanCurate:l().bool.isRequired,isLoading:l().bool.isRequired,layout:l().object.isRequired,mobileLayout:l().object.isRequired,expandedSlices:l().object,onSave:l().func.isRequired,showPropertiesModal:l().func.isRequired,manageEmbedded:l().func.isRequired,shareTo:l().func.isRequired,logEvent:l().func,refreshLimit:l().number,refreshWarning:l().string,lastModifiedTime:l().number.isRequired,filterboxMigrationState:l().oneOf(Object.keys(nt.Qi).map((e=>nt.Qi[e])))},it={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:nt.Qi.NOOP},at="save-modal",st="share-dashboard",lt="refresh-dashboard",dt="autorefresh-modal",ut="set-filter-mapping",ct="edit-properties",pt="edit-css",ht="download-as-image",ft="toggle-fullscreen",gt="manage-embedded",mt="share-to",vt="download-as-pdf",bt="download-as-ppt",yt="download-as-excel",xt=".dashboard";class Ct extends a.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[],showReportSubMenu:null,isPerm:e.isPerm},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.setShowReportSubMenu=this.setShowReportSubMenu.bind(this),this.recordShareLog=this.recordShareLog.bind(this)}UNSAFE_componentWillMount(){ee.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((({json:e})=>{const t=e.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:t})})).catch((()=>{this.props.addDangerToast((0,d.t)("An error occurred while fetching available CSS templates"))}))}UNSAFE_componentWillReceiveProps(e){this.props.customCss!==e.customCss&&this.setState({css:e.customCss},(()=>{(0,Ve.Z)(e.customCss)}))}setShowReportSubMenu(e){this.setState({showReportSubMenu:e})}changeCss(e){this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick({key:e,domEvent:t}){switch(e){case lt:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,d.t)("Refreshing charts"));break;case ct:this.props.showPropertiesModal();break;case ht:{var n,r;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Ge.Z)(xt,this.props.dashboardTitle,!0)(t).then((()=>{e.style.visibility="visible"})),null==(n=(r=this.props).logEvent)||n.call(r,ie.n2);break}case bt:{const{charts:e,sliceEntities:n}=this.props,r=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");if(Object.keys(n).length&&Object.keys(e).length){var o,i;const a=Object.values(e),s=a.length?a.filter((e=>"rendered"===e.chartStatus)):[],l=s.length?s.map((e=>e.id)):[],d=Array.from(Object.values(n),(e=>({key:e.slice_id,id:`.dashboard-chart-id-${e.slice_id}`,name:e.slice_name}))).filter((e=>l.includes(e.key)));r.style.visibility="hidden",(0,Xe.Z)(d,this.props.dashboardTitle,!0)(t).then((()=>{r.style.visibility="visible"})),null==(o=(i=this.props).logEvent)||o.call(i,ie.CQ);break}var a,s;r.style.visibility="hidden",(0,Xe.Z)(xt,this.props.dashboardTitle,!0)(t).then((()=>{r.style.visibility="visible"})),null==(a=(s=this.props).logEvent)||a.call(s,ie.CQ);break}case vt:{var l,u;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Ke.Z)(xt,this.props.dashboardTitle,!0)(t).then((()=>{e.style.visibility="visible"})),null==(l=(u=this.props).logEvent)||l.call(u,ie.Kr);break}case yt:{const e=this.props.charts,t=this.props.dashboardTitle;(0,Ye.Z)(t,e,this.props.sliceEntities);break}case ft:Je({pathname:window.location.pathname,filters:(0,et.De)(),hash:window.location.hash,standalone:!(0,ye.eY)(me.KD.standalone)});break;case gt:this.props.manageEmbedded();break;case mt:this.props.shareTo()}}recordShareLog(e,t){const{dashboardTitle:n,dashboardId:r}=this.props;ee.Z.post({endpoint:"sys/v2/log/",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"\u5206\u4eab\u770b\u677f\u6c38\u4e45\u94fe\u63a5",extra:JSON.stringify({dashboard_id:r,dashboard_title:n,share_mode:e,share_url:t})})}).then((({json:e})=>{}))}render(){var e,t;const{dashboardTitle:n,dashboardId:r,dashboardInfo:o,refreshFrequency:i,shouldPersistRefreshFrequency:s,editMode:l,customCss:u,colorNamespace:c,colorScheme:p,layout:h,mobileLayout:f,expandedSlices:g,onSave:m,userCanEdit:v,userCanShare:b,userCanSave:y,userCanCurate:C,isLoading:w,refreshLimit:S,refreshWarning:Z,lastModifiedTime:k,addSuccessToast:M,addDangerToast:D,filterboxMigrationState:E,setIsDropdownVisible:R,isDropdownVisible:T,..._}=this.props,I=`${(0,d.t)("Superset dashboard")} ${n}`,O=(0,d.t)("Check out this dashboard: "),P=Je({pathname:window.location.pathname,filters:(0,et.De)(),hash:window.location.hash}),z=null==(e=o.common)||null==(t=e.conf)?void 0:t.DASHBOARD_AUTO_REFRESH_INTERVALS;return(0,x.tZ)(ge.v2,fe()({selectable:!1,"data-test":"header-actions-menu"},_),!l&&(0,x.tZ)(ge.v2.Item,{key:lt,disabled:w,"data-test":"refresh-dashboard-menu-item",onClick:this.handleMenuClick},(0,d.t)("Refresh dashboard")),l&&(0,x.tZ)(ge.v2.Item,{key:pt},(0,x.tZ)(Me,{triggerNode:(0,x.tZ)("span",null,(0,d.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),(0,x.tZ)(ge.v2.Divider,null),y&&(0,x.tZ)(ge.v2.Item,{key:at},(0,x.tZ)(qe,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:r,dashboardTitle:n,dashboardInfo:o,saveType:Be.kS,layout:h,mobileLayout:f,expandedSlices:g,refreshFrequency:i,shouldPersistRefreshFrequency:s,lastModifiedTime:k,customCss:u,colorNamespace:c,colorScheme:p,onSave:m,triggerNode:(0,x.tZ)("span",{"data-test":"save-as-menu-item"},(0,d.t)("Save as")),canOverwrite:v})),this.state.isPerm>=2&&!l&&(0,x.tZ)(ge.v2.SubMenu,{title:(0,d.t)("Download")},(0,x.tZ)(tt.Z,{position:"dashbord",selectorString:xt,downLoadTitle:n})),!1,b&&(0,x.tZ)(ge.v2.SubMenu,{key:st,"data-test":"share-dashboard-menu-item",title:(0,d.t)("Share")},(0,x.tZ)(xe,{url:P,copyMenuItemTitle:(0,d.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,d.t)("Share permalink by email"),temporaryShare:l?null:(0,x.tZ)(ge.v2.Item,{key:mt,onClick:this.handleMenuClick},(0,d.t)("Share template")),emailSubject:I,emailBody:O,addSuccessToast:M,addDangerToast:D,dashboardId:r,recordShareLog:this.recordShareLog})),!l&&(0,x.tZ)(ge.v2.Item,{key:gt,onClick:this.handleMenuClick},(0,d.t)("Embed dashboard")),(0,x.tZ)(ge.v2.Divider,null),l?null:this.state.showReportSubMenu?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ge.v2.SubMenu,{title:(0,d.t)("Manage email report")},(0,x.tZ)(Ue.Z,{dashboardId:o.id,setShowReportSubMenu:this.setShowReportSubMenu,showReportSubMenu:this.state.showReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),(0,x.tZ)(ge.v2.Divider,null)):(0,x.tZ)(ge.v2,null,(0,x.tZ)(Ue.Z,{dashboardId:o.id,setShowReportSubMenu:this.setShowReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),l&&E!==nt.Qi.CONVERTED&&(0,x.tZ)(ge.v2.Item,{key:ut},(0,x.tZ)(We.Z,{className:"m-r-5",triggerNode:(0,d.t)("Set filter mapping")})),(0,x.tZ)(ge.v2.Item,{key:dt},(0,x.tZ)(Pe,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:i,refreshLimit:S,refreshWarning:Z,onChange:this.changeRefreshInterval,editMode:l,refreshIntervalOptions:z,triggerNode:(0,x.tZ)("span",null,(0,d.t)("Set auto-refresh interval"))})))}}Ct.propTypes=ot,Ct.defaultProps=it;const wt=Ct;var St=n(737921);const Zt={dashboardId:l().number,isPublished:l().bool.isRequired,savePublished:l().func.isRequired,canEdit:l().bool,canSave:l().bool},kt=(0,d.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),Mt=(0,d.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),Dt=(0,d.t)("This dashboard is published. Click to make it a draft.");class Et extends a.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,x.tZ)(ce.u,{id:"published-dashboard-tooltip",placement:"bottom",title:Dt},(0,x.tZ)(St.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,x.tZ)(ce.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:kt},(0,x.tZ)(St.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Draft"))):(0,x.tZ)(ce.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Mt},(0,x.tZ)(St.Z,null,(0,d.t)("Draft")))}}Et.propTypes=Zt;const Rt={onUndo:l().func.isRequired,onRedo:l().func.isRequired};class Tt extends a.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,r=document&&document.querySelector(".dashboard-markdown--editing"),o=document&&document.querySelector(".editable-title--editing");if(!r&&!o&&(t||n)){e.preventDefault();(t?this.props.onUndo:this.props.onRedo)()}}}render(){return null}}Tt.propTypes=Rt;var _t=n(720818),It=n(602275);const Ot=e=>{e&&clearInterval(e)};var Pt=n(852564);const zt=e=>x.iv`
  display: flex;
  flex-direction: row;
  align-items: center;
  flex-wrap: nowrap;
  justify-content: space-between;
  // background-color: ${e.colors.grayscale.light5};
  background: #fefefe;
  // height: ${16*e.gridUnit}px;
  height: 42px;
  border-top: 1px solid rgb(235, 237, 240);

  padding: 0 ${4*e.gridUnit}px;

  .editable-title {
    overflow: hidden;

    & > input[type='button'],
    & > span {
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      white-space: nowrap;
    }
  }

  span[role='button'] {
    display: flex;
    height: 100%;
  }

  .left-panel {
    display: flex;
    align-items: start;
    min-width: 0;
    margin-right: ${12*e.gridUnit}px;
    flex-direction: column;
    align-self: flex-start;
  }

  .right-button-panel {
    display: flex;
    align-items: center;
  }
`,Ft=({leftPanelAdditionalItems:e,rightPanelAdditionalItems:t,centerPanelAdditionalItems:n})=>{(0,y.Fg)();return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{css:zt,className:"header-with-actions sub-actions"},(0,x.tZ)("div",{className:"left-panel"},e),(0,x.tZ)("div",{className:"center-button-panel"},n),(0,x.tZ)("div",{className:"right-button-panel"},t)))};var Nt=n(68969),$t=n(23279),Lt=n.n($t),Bt=n(150361),At=n.n(Bt),jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},Ut=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Vt=void 0;Vt="undefined"!==typeof window?window:"undefined"!==typeof self?self:n.g;var Wt=null,Gt=null,Kt=Vt.clearTimeout,Yt=Vt.setTimeout,Xt=Vt.cancelAnimationFrame||Vt.mozCancelAnimationFrame||Vt.webkitCancelAnimationFrame,Qt=Vt.requestAnimationFrame||Vt.mozRequestAnimationFrame||Vt.webkitRequestAnimationFrame;function Jt(e){var t=void 0,n=void 0,r=void 0,o=void 0,i=void 0,a=void 0,s=void 0,l="undefined"!==typeof document&&document.attachEvent;if(!l){a=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,r=t.lastElementChild,o=n.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,o.style.width=n.offsetWidth+1+"px",o.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},i=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},s=function(e){if(!(e.target.className&&"function"===typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;a(this),this.__resizeRAF__&&Wt(this.__resizeRAF__),this.__resizeRAF__=Gt((function(){i(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))}};var d=!1,u="";r="animationstart";var c="Webkit Moz O ms".split(" "),p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h=document.createElement("fakeelement");if(void 0!==h.style.animationName&&(d=!0),!1===d)for(var f=0;f<c.length;f++)if(void 0!==h.style[c[f]+"AnimationName"]){u="-"+c[f].toLowerCase()+"-",r=p[f],d=!0;break}t="@"+u+"keyframes "+(n="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",o=u+"animation: 1ms "+n+"; "}return{addResizeListener:function(i,d){if(l)i.attachEvent("onresize",d);else{if(!i.__resizeTriggers__){var u=i.ownerDocument,c=Vt.getComputedStyle(i);c&&"static"===c.position&&(i.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){var r=(t||"")+".resize-triggers { "+(o||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=n.head||n.getElementsByTagName("head")[0],a=n.createElement("style");a.id="detectElementResize",a.type="text/css",null!=e&&a.setAttribute("nonce",e),a.styleSheet?a.styleSheet.cssText=r:a.appendChild(n.createTextNode(r)),i.appendChild(a)}}(u),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=u.createElement("div")).className="resize-triggers";var p=u.createElement("div");p.className="expand-trigger",p.appendChild(u.createElement("div"));var h=u.createElement("div");h.className="contract-trigger",i.__resizeTriggers__.appendChild(p),i.__resizeTriggers__.appendChild(h),i.appendChild(i.__resizeTriggers__),a(i),i.addEventListener("scroll",s,!0),r&&(i.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&a(i)},i.__resizeTriggers__.addEventListener(r,i.__resizeTriggers__.__animationListener__))}i.__resizeListeners__.push(d)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",s,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(r,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}null==Xt||null==Qt?(Wt=Kt,Gt=function(e){return Yt(e,20)}):(Wt=function(e){var t=Ut(e,2),n=t[0],r=t[1];Xt(n),Kt(r)},Gt=function(e){var t=Qt((function(){Kt(n),e()})),n=Yt((function(){Xt(t),e()}),20);return[t,n]});var en=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=qt(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.state={height:r.props.defaultHeight||0,width:r.props.defaultWidth||0},r._onResize=function(){var e=r.props,t=e.disableHeight,n=e.disableWidth,o=e.onResize;if(r._parentNode){var i=r._parentNode.offsetHeight||0,a=r._parentNode.offsetWidth||0,s=window.getComputedStyle(r._parentNode)||{},l=parseInt(s.paddingLeft,10)||0,d=parseInt(s.paddingRight,10)||0,u=parseInt(s.paddingTop,10)||0,c=parseInt(s.paddingBottom,10)||0,p=i-u-c,h=a-l-d;(!t&&r.state.height!==p||!n&&r.state.width!==h)&&(r.setState({height:i-u-c,width:a-l-d}),o({height:i,width:a}))}},r._setRef=function(e){r._autoSizer=e},qt(r,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),jt(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=Jt(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,r=e.disableHeight,o=e.disableWidth,i=e.style,s=this.state,l=s.height,d=s.width,u={overflow:"visible"},c={},p=!1;return r||(0===l&&(p=!0),u.height=0,c.height=l),o||(0===d&&(p=!0),u.width=0,c.width=d),(0,a.createElement)("div",{className:n,ref:this._setRef,style:Ht({},u,i)},!p&&t(c))}}]),t}(a.PureComponent);en.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}};const tn=en;n(324903);var nn=n(591665),rn=n(667496),on=n(685931),an=n(132657),sn=n(414114),ln=n(935500);(0,rn.VU)("/static/assets/images/chart-card-fallback.svg");const dn=({children:e,...t})=>{const[n,r]=(0,a.useState)(!1),o=(0,a.useRef)(null);(0,a.useEffect)((()=>{r(!!o.current&&o.current.scrollWidth>o.current.clientWidth)}),[e]);const i=(0,x.tZ)("div",fe()({},t,{ref:o,css:x.iv`
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
      `}),e);return n?(0,x.tZ)(ce.u,{title:e},i):i},un=({label:e,value:t})=>(0,x.tZ)("div",{css:e=>x.iv`
      font-size: ${e.typography.sizes.s}px;
      display: flex;
      justify-content: space-between;

      &:not(:last-child) {
        margin-bottom: ${e.gridUnit}px;
      }
    `},(0,x.tZ)("span",{css:e=>x.iv`
        margin-right: ${4*e.gridUnit}px;
        color: ${e.colors.grayscale.base};
      `},e),(0,x.tZ)("span",{css:x.iv`
        min-width: 0;
      `},(0,x.tZ)(dn,null,t))),cn=(0,sn.ZP)((({innerRef:e,isSelected:t=!1,style:n={},component:r,charts:i,sliceName:s,setSliceDetails:l})=>{const h=(0,o.I0)(),[f,g]=((0,u.c)(u.T.THUMBNAILS),(0,a.useState)()),{mountedPluginMetadata:m}=(0,c.gp)(),[v,b]=(0,a.useState)({}),[y,C]=(0,a.useState)(!1),[w,S]=(0,a.useState)({}),[Z,k]=(0,a.useState)(0),M=(0,o.v9)((e=>e.sliceEntities.slices[r.meta.chartId])),D=(0,a.useMemo)((()=>{var e;return v.viz_type?null==m||null==(e=m[v.viz_type])?void 0:e.name:null}),[m,v.viz_type]);(0,a.useEffect)((()=>{const e={chartTitle:s,ownState:void 0,annotationData:void 0,chartAlert:null,chartStackTrace:null,chartId:M.slice_id,chartIsStale:!1,chartStatus:"success",triggerRender:!1,force:!1,errorMessage:null,onQuery:void 0,setControlValue:void 0,timeout:300,triggerQuery:!1};b(e)}),[]);const E=(0,o.v9)((e=>e.dashboardInfo.id));(0,a.useEffect)((()=>{var e,t;i[null==r||null==(e=r.meta)?void 0:e.chartId]&&!w&&T(null==r||null==(t=r.meta)?void 0:t.chartId)}),[w]),(0,a.useEffect)((()=>{Z&&Z<3&&M.viz_type&&R(M)}),[M,Z]);const R=e=>{let t;try{var n;t=null==(n=i[e.slice_id])?void 0:n.queriesResponse}catch(e){}const r={...v,datasource:e.dataset,formData:e.form_data,latestQueryFormData:e.form_data,queriesResponse:t,datasource_url:e.datasource_url,datasource_name:e.datasource_name,changed_on_humanized:e.changed_on_humanized,viz_type:e.form_data.viz_type};b(r),h((0,ln.getSavedChart)(e.form_data,e.force||(0,ye.eY)(me.KD.force),300,e.slice_id,E,void 0)),S(i[e.slice_id]),setTimeout((()=>{C(!0),k((e=>e+1))}),500)},T=e=>{C(!1),k(1),v.viz_type?setTimeout((()=>{C(!0),k(2)}),500):l(r.meta.chartId)};return(0,x.tZ)("div",{ref:e,style:n},(0,x.tZ)("div",{"data-test":"chart-card",css:e=>x.iv`
          // border: 1px solid ${e.colors.grayscale.light2};
          border-radius: ${e.gridUnit}px;
          // background: ${e.colors.grayscale.light5};
          // padding: ${4*e.gridUnit}px;
          // // margin: 0 ${3*e.gridUnit}px
          //   ${3*e.gridUnit}px
          //   ${3*e.gridUnit}px;
          position: relative;
          cursor: ${t?"not-allowed":"move"};
          white-space: nowrap;
          overflow: hidden;
          // line-height: 1.3;
          color: ${e.colors.grayscale.dark1};

          opacity: ${t?.4:"unset"};
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          :hover {
            background: ${t?"":"#edeff1"};
          }
        `,draggable:!0,onDragStart:()=>{l(r.meta.chartId);let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(-300px)"}),400))},onDragEnd:()=>{let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(0px)"}),300))}},(0,x.tZ)("div",{css:()=>x.iv`
              margin-left: 10px;
              width: 80%;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            `},s),(0,x.tZ)("div",{style:{marginRight:"10px"}},(0,x.tZ)(Q.Z,{placement:"right",title:(0,x.tZ)("span",{style:{fontWeight:"bold"}},s),content:(0,x.tZ)("div",null,(0,x.tZ)("div",null,(0,x.tZ)(un,{label:(0,d.t)("Viz type"),value:D}),(0,x.tZ)(un,{label:(0,d.t)("Dataset"),value:null!=v&&v.datasource_url?(0,x.tZ)(on.m,{to:v.datasource_url},v.datasource_name):v.datasource_name}),(0,x.tZ)(un,{label:(0,d.t)("Modified"),value:v.changed_on_humanized})),(0,x.tZ)("div",{css:x.iv`
                    border: 1px solid #dcdfe6;
                    min-height: 150px;
                    min-width: 210px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                  `},y&&Z>2&&v.datasource?(0,x.tZ)(an.Z,{width:210,height:150,ownState:v.ownState,annotationData:v.annotationData,chartAlert:v.chartAlert,chartStackTrace:v.chartStackTrace,chartId:v.chartId,chartStatus:v.chartStatus,triggerRender:v.triggerRender,force:v.force,datasource:v.datasource,errorMessage:v.errorMessage,formData:v.formData,latestQueryFormData:v.latestQueryFormData,onQuery:v.onQuery,queriesResponse:v.queriesResponse,chartIsStale:v.chartIsStale,setControlValue:v.setControlValue,timeout:v.timeout,triggerQuery:v.triggerQuery,vizType:v.viz_type,chartTitle:s}):(0,x.tZ)(p.Z,{css:x.iv`
                        && {
                          margin-top: 60px;
                        }
                      `}))),trigger:"click",onClick:()=>{T(r.meta.chartId)}},(0,x.tZ)(ae.Z.Review,{css:()=>x.iv`
                cursor: pointer;
                color: #101010;
                :hover {
                  color: #bbb;
                }
              `})))))})),pn=cn;var hn=n(984785);const fn={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},gn={dragItem:l().shape({index:l().number.isRequired}),slices:l().arrayOf(It.Rw),isDragging:l().bool.isRequired,currentOffset:l().shape({x:l().number.isRequired,y:l().number.isRequired})};function mn({dragItem:e,slices:t,isDragging:n,currentOffset:r}){if(!n||!r||!e||!t)return null;const o=t[e.index];return o&&e.parentType===f.F0&&e.type===f.dW?(0,x.tZ)(pn,{style:{...fn,transform:`translate(${r.x}px, ${r.y}px)`},sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name}):null}mn.propTypes=gn,mn.defaultProps={currentOffset:null,dragItem:null,slices:null};(0,hn.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(mn);var vn;var bn=n(823493),yn=n.n(bn);const xn=Be.Mu+1,Cn=Be.Mu+3,wn=Be.Mu+4,Sn=Be.Mu+5,Zn={[f.U0]:{[f.yR]:Be.Mu,[f.BG]:Be.Mu},[f.BG]:{[f.dW]:xn,[f.t]:xn,[f.xh]:xn,[f.Ce]:xn,[f.qu]:xn,[f.hI]:xn,[f.kE]:xn,[f.GV]:xn,[f.Mg]:xn,[f.BA]:xn,[f.hE]:xn,[f.Nc]:xn,[f.Os]:xn,[f.yR]:xn,[f.Q7]:xn},[f.Os]:{[f.dW]:wn,[f.t]:wn,[f.xh]:wn,[f.Ce]:wn,[f.qu]:wn,[f.hI]:wn,[f.kE]:wn,[f.GV]:wn,[f.Mg]:wn,[f.BA]:wn,[f.Q7]:wn},[f.yR]:{[f.gn]:Cn},[f.gn]:{[f.dW]:Sn,[f.t]:Sn,[f.xh]:Sn,[f.Ce]:Sn,[f.qu]:Sn,[f.hI]:Sn,[f.kE]:Sn,[f.GV]:Sn,[f.Mg]:Sn,[f.BA]:Cn,[f.hE]:Sn,[f.Nc]:Sn,[f.Os]:Cn,[f.yR]:Cn,[f.Q7]:Sn},[f.BA]:{[f.dW]:Sn,[f.Nc]:Sn,[f.xh]:Sn,[f.Ce]:Sn,[f.qu]:Sn,[f.hI]:Sn,[f.kE]:Sn,[f.GV]:Sn,[f.Mg]:Sn,[f.Os]:Cn,[f.hE]:Cn,[f.yR]:Cn,[f.Q7]:Sn},[f.dW]:{},[f.t]:{},[f.hE]:{},[f.Nc]:{},[f.xh]:{},[f.Ce]:{},[f.qu]:{},[f.Mg]:{},[f.hI]:{},[f.kE]:{},[f.GV]:{},[f.Q7]:{}};function kn(e){const{parentType:t,childType:n,parentDepth:r}=e;if(!t||!n||"number"!==typeof r)return!1;const o=(Zn[t]||{})[n];return"number"===typeof o&&r<=o}const Mn="DROP_TOP",Dn="DROP_RIGHT",En="DROP_BOTTOM",Rn="DROP_LEFT",Tn=20,_n=20;let In,On={};function Pn(e,t){const{depth:n,parentComponent:r,component:o,orientation:i,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===o.id)return null;const l=kn({parentType:o.type,parentDepth:n,childType:s.type}),d=r&&r.type,u=kn({parentType:d,parentDepth:n+(d===f.gn||d===f.yR?0:-1),childType:s.type});if(!l&&!u)return null;const c=(o.children||[]).length>0,p="row"===i?"vertical":"horizontal",h="row"===i?"horizontal":"vertical";if(a&&l&&!u)return"vertical"===p?c?Dn:Rn:c?En:Mn;const g=t.ref.getBoundingClientRect(),m=e.getClientOffset()||On[o.id];if(!m||!g)return null;On[o.id]=m;const v=Math.abs(m.y-g.top),b=Math.abs(m.y-g.bottom),y=Math.abs(m.x-g.left),x=Math.abs(m.x-g.right);if(!a&&[v,b,y,x].every((e=>e>_n)))return null;if(u&&!l){if("vertical"===h){const e=g.left+(g.right-g.left)/2;return m.x<e?Rn:Dn}const e=g.top+(g.bottom-g.top)/2;return m.y<e?Mn:En}if(u&&l){if("vertical"===h){if(y<Tn)return Rn;if(x<Tn)return Dn}else{if(v<Tn)return Mn;if(b<Tn)return En}return"vertical"===p?c?Dn:Rn:c?En:Mn}return null}const zn=120,Fn=50;const Nn=yn()((function(e,t,n){var r,o,i;if(!n.mounted)return;const a=Pn(t,n);!function(e){const t="SCROLL_TOP"===e&&!In&&0!==document.documentElement.scrollTop,n=In&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?In=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(In),void(In=null);let e=document.documentElement.scrollTop-zn;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),Fn):n&&(clearInterval(In),In=null)}((null==n||null==(r=n.props)||null==(o=r.component)?void 0:o.type)===f.U0?"SCROLL_TOP":null),a?(null==n||null==(i=n.props)||i.onHover(),n.setState((()=>({dropIndicator:a})))):n.setState((()=>({dropIndicator:null})))}),100);var $n=n(973830);function Ln(e,t,n){var r,o,i,a;if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const s=Pn(t,n),{parentComponent:l,component:u,index:c,onDrop:p,orientation:h}=n.props,g=t.getItem(),m=t.getDifferenceFromInitialOffset(),v="row"===h&&(s===Mn||s===En)||"column"===h&&(s===Rn||s===Dn)?"sibling":"child",b={source:{id:g.parentId,type:g.parentType,index:g.index},dragging:{id:g.id,type:g.type,meta:g.meta},destination:{pos:m}};if("child"===v)b.destination={id:u.id,type:u.type,index:u.children.length,pos:m};else{let e=l&&g.parentId===l.id&&g.index<c?c-1:c;s!==En&&s!==Dn||(e+=1),b.destination={id:l.id,type:l.type,index:e,pos:m}}if("float"===(null==g||null==(r=g.meta)?void 0:r.layoutType)&&void 0===(null==g||null==(o=g.meta)||null==(i=o.pos)?void 0:i.x)){var y;const e=n.ref.getBoundingClientRect(),t=n.ref.parentNode.getBoundingClientRect();null!=(y=b.dragging.meta)&&y.pos||(b.dragging.meta.pos={}),b.dragging.meta.pos.x=e.x-t.x,b.dragging.meta.pos.y=e.y-t.y}const x=[f.hI,f.kE,f.GV],{present:C,dispatch:w,mobilePresent:S}=g;if(C&&S&&x.includes(null==g?void 0:g.type)&&"float"!==(null==g||null==(a=g.meta)?void 0:a.layoutType)){const e=(0,$n.Z)(b,C),t=(0,$n.Z)(b,S);if(e||t)return w((0,rt.Dz)((0,d.t)("There is not enough space for this component. Try decreasing its width, or increasing the destination width.")));null==g||null==g.filterDropAction||g.filterDropAction(g)}return p(b),On={},b}const Bn="DRAG_DROPPABLE",An=[Bn,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:r={},filterDropAction:o=(()=>{}),present:i,mobilePresent:a,dispatch:s}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:r.id,parentType:r.type,filterDropAction:o,present:i,mobilePresent:a,dispatch:s}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],jn=[Bn,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&Nn(e,t,n)},drop(e,t,n){const r=t.getDropResult();if("ADD_TOAST"!==(null==r?void 0:r.type))return r&&r.destination||!n.mounted?void 0:Ln(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],Hn={children:l().func,className:l().string,component:It.cP,parentComponent:It.cP,depth:l().number.isRequired,disableDragDrop:l().bool,orientation:l().oneOf(["row","column"]),index:l().number.isRequired,style:l().object,onDrop:l().func,onHover:l().func,editMode:l().bool,useEmptyDragPreview:l().bool,isDragging:l().bool,isDraggingOver:l().bool,isDraggingOverShallow:l().bool,droppableRef:l().func,dragSourceRef:l().func,dragPreviewRef:l().func,layoutMode:l().string},qn={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},onHover(){},orientation:"row",useEmptyDragPreview:!1,isDragging:!1,isDraggingOver:!1,isDraggingOverShallow:!1,droppableRef(){},dragSourceRef(){},dragPreviewRef(){},layoutMode:i.kB.PC},Un=y.iK.div`
  ${({theme:e,isMode:t,layout_type:n,style:r})=>x.iv`
    position: relative;
    width: ${t?"gird"!==n?"auto":"100%":"auto"}; // 移动端行列布局一行多个
    min-height: ${t&&r?r.minHeight:"auto"};
    &.dragdroppable--dragging {
      opacity: 0.2;
    }

    &.dragdroppable-row {
      width: 100%;
    }

    &.dragdroppable-column .resizable-container span div {
      z-index: 10;
    }

    & {
      .drop-indicator {
        display: block;
        background-color: ${e.colors.primary.base};
        position: absolute;
        z-index: 10;
      }

      .drop-indicator--top {
        top: 0;
        left: 0;
        height: ${e.gridUnit}px;
        width: 100%;
        min-width: ${4*e.gridUnit}px;
      }

      .drop-indicator--bottom {
        top: 100%;
        left: 0;
        height: ${e.gridUnit}px;
        width: 100%;
        min-width: ${4*e.gridUnit}px;
      }

      .drop-indicator--right {
        top: 0;
        left: 100%;
        height: 100%;
        width: ${e.gridUnit}px;
        min-height: ${4*e.gridUnit}px;
      }

      .drop-indicator--left {
        top: 0;
        left: 0;
        height: 100%;
        width: ${e.gridUnit}px;
        min-height: ${4*e.gridUnit}px;
      }
    }
  `};
`;class Vn extends a.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){var t,n;this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((vn||((vn=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),vn),{captureDraggingState:!0}):this.props.dragPreviewRef(e),null==(t=(n=this.props).droppableRef)||t.call(n,e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:r,disableDragDrop:o,isDragging:a,isDraggingOver:s,style:l,editMode:d,layout_type:u,layoutMode:c}=this.props,{dropIndicator:p}=this.state,h=s&&p&&!o?{className:b()("drop-indicator",p===Mn&&"drop-indicator--top",p===En&&"drop-indicator--bottom",p===Rn&&"drop-indicator--left",p===Dn&&"drop-indicator--right")}:null,f=d?{dragSourceRef:r,dropIndicatorProps:h}:{};return(0,x.tZ)(Un,{style:l,ref:this.setRef,"data-test":"dragdroppable-object",className:b()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",a&&"dragdroppable--dragging",t),isMode:c===i.kB.MOBILE,layout_type:u},e(f))}}Vn.propTypes=Hn,Vn.defaultProps=qn;const Wn=(0,o.$j)((function({dashboardState:e,dashboardInfo:t}){var n;return{layout_type:null==t||null==(n=t.metadata)?void 0:n.layout_type,layoutMode:e.layoutMode}}))((0,hn.DragSource)(...An)((0,hn.DropTarget)(...jn)(Vn))),{DirectoryTree:Gn}=nn.Z,Kn={fetchAllSlices:l().func.isRequired,isLoading:l().bool.isRequired,slices:l().objectOf(It.Rw).isRequired,lastUpdated:l().number.isRequired,errorMessage:l().string,userId:l().string.isRequired,selectedSliceIds:l().arrayOf(l().number),editMode:l().bool,filterboxMigrationState:nt.Qi,dashboardId:l().number},Yn={selectedSliceIds:[],editMode:!1,errorMessage:"",filterboxMigrationState:nt.Qi.NOOP},Xn=((0,d.t)("Chart Name"),(0,d.t)("viz type"),(0,d.t)("dataset"),(0,d.t)("recent"),y.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${({theme:e})=>3*e.gridUnit}px;
  padding-top: ${({theme:e})=>4*e.gridUnit}px;
`,(0,y.iK)(de.Ph)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  min-width: 150px;
`,y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    justify-content: space-evenly;
    padding-right: ${2*e.gridUnit}px;
  `}
`,(0,y.iK)(se.Z)`
  ${({theme:e})=>x.iv`
    height: auto;
    & > .anticon + span {
      margin-left: 0;
    }
    & > [role='img']:first-of-type {
      margin-right: ${e.gridUnit}px;
      padding-bottom: 1px;
      line-height: 0;
    }
  `}
`,y.iK.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 0;
  .create-new-chart-btn {
    height: 30px;
    width: 130px;
    background: #f5f9ff;
    border-radius: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #5d9cec;
    font-size: 14px;
    cursor: pointer;
  }
  .sort-box {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-left: 5px;
    height: 30px;
    .anticon {
      cursor: pointer;
    }
  }
`),Qn=y.iK.div`
  flex-grow: 1;
  min-height: 0;
`;class Jn extends a.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,r)=>n[e]<r[e]?-1*t:n[e]>r[e]?1*t:0}constructor(e){super(e),this.handleChange=Lt()((e=>{this.searchUpdated(e),this.getChartTree(e)}),500),this.state={searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds),treeData:[],slices:[]},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSelect=this.handleSelect.bind(this),this.getChartTree=this.getChartTree.bind(this),this.onLoadData=this.onLoadData.bind(this),this.params=(0,ye.VW)()}componentDidMount(){this.getChartTree()}UNSAFE_componentWillReceiveProps(e){const t={};e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}searchUpdated(e){this.setState((t=>({searchTerm:e})))}handleSelect(e){this.setState((t=>({sortBy:e})));const{userId:t,filterboxMigrationState:n}=this.props}getChartTree(e){ee.Z.get({endpoint:"api/v2/chart/group/"+(e?"?name="+e:"")}).then((e=>{if(200==e.json.meta.code||201==e.json.meta.code){const t=[],n=this.forEach_children(e.json.meta.data,0,t);this.setState({treeData:n});const{userId:r,filterboxMigrationState:o}=this.props;this.slicesRequest=this.props.fetchAllSlices(t)}}))}forEach_children(e=[],t=0,n){const r=[];return e.forEach((e=>{let o={};Object.hasOwnProperty.call(e,"slice_id")?(o=At()(e),n.push(At()(e)),o.key="slice_"+e.slice_id,o.isLeaf=!0,o.zids=t):(o.title=e.name,o.key="group_"+e.group_id,o.isLeaf=!1,e.children.length>0?o.children=this.forEach_children(At()(e.children),t+1,n):o.children=[],e.slices.length>0&&(o.slices=this.forEach_children(At()(e.slices),t+1,n))),(o.isLeaf||o.children.length||o.slices)&&r.push(o)})),r}onLoadData(e,{expanded:t,node:n}){const{treeData:r}=this.state,{key:o,children:i=[],slices:a=[]}=n;if(!t||!a.length)return;const s=i.concat(a),l=this.updateTreeData(At()(r),o,s);this.setState({treeData:l})}updateTreeData(e,t,n){const r=e=>(e.forEach((e=>{e.key==t?(e.children=n,delete e.slices):e.children&&e.children.length>0&&(e.children=r(At()(e.children)))})),e);return r(e)}rowRenderer(e){const{selectedSliceIdsSet:t}=this.state,n=t.has(e.slice_id),r=f.dW,o=Be.Jd,i={height:25,width:242-24*e.zids},a={chartId:e.slice_id,sliceName:e.slice_name};return(0,x.tZ)(Wn,{key:e.key,component:{type:r,id:o,meta:a},parentComponent:{id:Be.D0,type:f.F0},depth:0,disableDragDrop:n,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{display:"inline-block"}},(({dragSourceRef:t})=>(0,x.tZ)(pn,{innerRef:t,style:i,sliceName:e.slice_name,isSelected:n,component:{type:r,id:o,meta:a},setSliceDetails:e=>this.props.setSliceDetails(e)})))}render(){const{treeData:e}=this.state,t=window.location.href.indexOf("control=")>-1;return(0,x.tZ)("div",{css:x.iv`
          height: 100%;
          display: flex;
          flex-direction: column;
          // padding: 0 24px;
        `},(0,x.tZ)($e.II,{placeholder:(0,d.t)("Filter your charts"),className:"search-input",onChange:e=>this.handleChange(e.target.value),onKeyPress:this.handleKeyPress,"data-test":"dashboard-charts-filter-search-input",style:{border:"none",borderBottom:"1px solid #DCDFE6",borderRadius:"0",outline:"none",marginTop:"10px"},prefix:(0,x.tZ)(ae.Z.Search,{style:{color:"#DCDFE6",marginRight:"4px"}})}),t&&(0,x.tZ)("div",{css:x.iv`
              display: flex;
              justify-content: flex-end;
              padding: 0px 15px;
            `},(0,x.tZ)(se.Z,{onClick:()=>{var e,t;null==(e=window)||null==(t=e.parent)||t.postMessage({openId:"",appId:"",data:{actions:[{actionsName:"opentab",target:"dashboard"}]}},"*")}},(0,d.t)("Reuse Kanban"))),(0,x.tZ)(Xn,null,(0,x.tZ)("div",{className:"create-new-chart-btn",onClick:()=>(0,ye.C3)(`/chart/add?dashboard_id=${this.props.dashboardId}`,this.params)},(0,x.tZ)(ae.Z.PlusSmall,null),(0,x.tZ)("span",null,(0,d.t)("Create new chart")))),this.props.isLoading&&(0,x.tZ)(p.Z,null),!this.props.isLoading&&this.state.treeData.length>0&&(0,x.tZ)(Qn,null,(0,x.tZ)(tn,null,(({height:t,width:n})=>(0,x.tZ)(Gn,{multiple:!0,onExpand:this.onLoadData,treeData:e,selectable:!1,titleRender:e=>(0,x.tZ)("span",null,e.isLeaf?this.rowRenderer(e):e.title)})))),this.props.errorMessage&&(0,x.tZ)("div",{css:x.iv`
              padding: 16px;
            `},this.props.errorMessage))}}Jn.propTypes=Kn,Jn.defaultProps=Yn;const er=Jn;const tr=(0,o.$j)((function({sliceEntities:e,dashboardInfo:t,dashboardState:n},r){return{height:r.height,userId:t.userId,dashboardId:t.id,selectedSliceIds:n.sliceIds,slices:e.slices,isLoading:e.isLoading,errorMessage:e.errorMessage,lastUpdated:e.lastUpdated,editMode:n.editMode,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,r.DE)({fetchAllSlices:Nt.To,fetchSortedSlices:Nt.Fv,fetchFilteredSlices:Nt.uC,setSliceDetails:Nt.t4},e)}))(er),nr={metadata:{name:(0,d.t)("Plain Text"),description:"TextComponent description",iconName:"text-width",text:"New Text"},loadComponent:()=>n.e(55716).then(n.bind(n,555716))},rr=({registryKeys:e,registry:t})=>()=>e.map((e=>t[e])),or=({registryKeys:e,registry:t})=>n=>{e=e.filter((e=>e!==n)),delete t[n]},ir=({registry:e})=>t=>e[t],ar=(e=[])=>{const t={registry:{},registryKeys:[]},n=(({registryKeys:e,registry:t})=>(n,r)=>{e.push(n),t[n]={key:n,metadata:r.metadata,Component:a.lazy(r.loadComponent)}})(t);return e.forEach((({key:e,item:t})=>{n(e,t)})),{set:n,get:ir(t),delete:or(t),getAll:rr(t)}},sr=ar([{key:"Text",item:nr}]),lr={id:l().string.isRequired,type:l().string.isRequired,label:l().string.isRequired,className:l().string},dr=y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: center;
    padding: ${2*e.gridUnit}px;
    // background: ${e.colors.grayscale.light5};
    background: rgb(245, 245, 250);
    margin-top: 15px;
    border-radius: 5px;
    cursor: move;
    color: #101010;
    &:not(.static):hover {
      background: ${e.colors.grayscale.light4};
    }
  `}
`,ur=y.iK.div`
  ${({theme:e})=>x.iv`
    position: relative;
    // background: ${e.colors.grayscale.light4};
    width: ${6*e.gridUnit}px;
    height: ${6*e.gridUnit}px;
    margin-right: ${4*e.gridUnit}px;
    // border: 1px solid ${e.colors.grayscale.light5};
    display: flex;
    align-items: center;
    justify-content: center;
    // color: ${e.colors.text.label};
    color: #101010;
    font-size: ${e.typography.sizes.xxl}px;

    &.fa-window-restore {
      font-size: ${e.typography.sizes.l}px;
    }

    &.fa-area-chart {
      font-size: ${e.typography.sizes.xl}px;
    }

    &.divider-placeholder:after {
      content: '';
      height: 2px;
      width: 100%;
      background-color: #101010;
    }
  `}
`;class cr extends a.PureComponent{render(){const{label:e,id:t,type:n,className:r,meta:o}=this.props,i=()=>{let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(-300px)"}),400))},a=()=>{let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(0px)"}),300))};return(0,x.tZ)(Wn,{component:{type:n,id:t,meta:o},parentComponent:{id:Be.D0,type:f.F0},index:0,depth:0,editMode:!0},(({dragSourceRef:t})=>(0,x.tZ)(dr,{ref:t,"data-test":"new-component",onDragEnd:a,onDragStart:i},(0,x.tZ)(ur,{className:b()("new-component-placeholder",r)}),e)))}}function pr(){return(0,x.tZ)(cr,{id:Be.Nb,type:f.BA,label:(0,d.t)("Column"),className:"fa fa-long-arrow-down"})}function hr(){return(0,x.tZ)(cr,{id:Be.ES,type:f.hE,label:(0,d.t)("Divider"),className:"divider-placeholder"})}function fr(){return(0,x.tZ)(cr,{id:Be.Z1,type:f.Nc,label:(0,d.t)("Header"),className:"fa fa-header"})}function gr(){return(0,x.tZ)(cr,{id:Be.vD,type:f.Os,label:(0,d.t)("Row"),className:"fa fa-long-arrow-right"})}function mr(){return(0,x.tZ)(cr,{id:Be.NN,type:f.yR,label:(0,d.t)("Tabs"),className:"fa fa-window-restore"})}function vr(){return(0,x.tZ)(cr,{id:Be.C3,type:f.xh,label:(0,d.t)("Text"),className:"fa fa-font"})}cr.propTypes=lr,cr.defaultProps={className:null};const br=({componentKey:e,metadata:t,...n})=>(0,x.tZ)(cr,{id:Be.gR,type:f.t,label:t.name,meta:{metadata:t,componentKey:e,...n},className:`fa fa-${t.iconName}`});function yr(){return(0,x.tZ)(cr,{id:Be.x4,type:f.Ce,label:(0,d.t)("Image Upload"),className:"fa fa-upload"})}function xr(){return(0,x.tZ)(cr,{id:Be.Xf,type:f.qu,label:(0,d.t)("Rect Box"),className:"fa-regular fa-square"})}function Cr(){return(0,x.tZ)(cr,{id:Be.Dp,type:f.Mg,label:(0,d.t)("Arrow"),className:"fa fa-arrow-right"})}function wr(){return(0,x.tZ)(cr,{id:Be.Wf,type:f.Q7,label:(0,d.t)("Web Component"),className:"fa-brands fa-internet-explorer"})}const Sr=()=>{const e="grid"===(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type}));return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(mr,null),!e&&(0,x.tZ)(gr,null),!e&&(0,x.tZ)(pr,null),(0,x.tZ)(fr,null),(0,x.tZ)(vr,null),(0,x.tZ)(hr,null),(0,x.tZ)(yr,null),(0,x.tZ)(xr,null),(0,x.tZ)(Cr,null),(0,x.tZ)(wr,null),sr.getAll().map((({key:e,metadata:t})=>(0,x.tZ)(br,{metadata:t,componentKey:e,key:e}))))};var Zr=n(653014),kr=n(454076),Mr=n(152794),Dr=n(189734),Er=n.n(Dr),Rr=n(618446),Tr=n.n(Rr),_r=n(944908),Ir=n.n(_r),Or=n(668122),Pr=n(957902),zr=n(774069);const Fr=(e,t=!1)=>(n,r=!1)=>{const o=r||t;if(!n&&e)return o?e:{"data-test":e};if(n&&!e)return o?n:{"data-test":n};if(!n&&!e)return o?"":{"data-test":""};const i=`${e}__${n}`;return o?i:{"data-test":i}};var Nr=n(10916);const $r=[];function Lr(){return(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||$r}))}function Br(){const e=Lr();return(0,a.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}function Ar(){return(0,o.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function jr(){const e=Ar();return(0,a.useMemo)((()=>Object.values(e).some((e=>e.type===f.gn))),[e])}function Hr(){const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=Ar();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>{var n;return(null==(n=e[t])?void 0:n.type)===f.gn}))}}();return n=>{var r;return(0,Nr.nY)(n)||"chartsInScope"in n&&(null==(r=n.chartsInScope)?void 0:r.some((n=>{const r=t(n);return 0===(null==r?void 0:r.length)||(null==r?void 0:r.every((t=>e.includes(t))))})))}}var qr=n(727034),Ur=n(822068);const Vr="FILTER",Wr=y.iK.div`
  ${({isDragging:e,theme:t})=>`\n    opacity: ${e?.3:1};\n    cursor: ${e?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${t.gridUnit}px;\n  `}
`,Gr=(0,y.iK)(ae.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${({isDragging:e,theme:t})=>`\n    font-size: ${t.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${e?"grabbing":"grab"};\n    padding-left: ${t.gridUnit}px;\n  `}
`;var Kr={name:"82a6rk",styles:"flex:1"};const Yr=({index:e,onRearrange:t,filterIds:n,children:r})=>{const o=(0,a.useRef)(null),[{isDragging:i},s]=(0,qr.c)({item:{filterIds:n,type:Vr,index:e},collect:e=>({isDragging:e.isDragging()})}),[,l]=(0,Ur.L)({accept:Vr,hover:(n,r)=>{var i;if(!o.current)return;const a=n.index,s=e;if(a===s)return;const l=null==(i=o.current)?void 0:i.getBoundingClientRect(),d=(l.bottom-l.top)/2,u=r.getClientOffset().y-l.top;a<s&&u<d||a>s&&u>d||(t(a,s),n.index=s)}});return s(l(o)),(0,x.tZ)(Wr,{ref:o,isDragging:i},(0,x.tZ)(Gr,{isDragging:i,alt:"Move icon",className:"dragIcon",viewBox:"4 4 16 16"}),(0,x.tZ)("div",{css:Kr},r))};const Xr=y.iK.div`
  ${({theme:e})=>`\n      display: flex;\n      align-items: center;\n      padding: ${2*e.gridUnit}px;\n      width: 100%;\n      border-radius: ${e.borderRadius}px;\n      &.active {\n        color: ${e.colors.grayscale.dark1};\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colors.secondary.light4};\n        span, .anticon {\n          color: ${e.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${e.colors.primary.light1};\n        span, .anticon {\n          color: ${e.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${e.colors.error.base};\n      }\n  `}
`,Qr=(0,y.iK)(ae.Z.Trash)`
  color: ${({theme:e})=>e.colors.grayscale.light3};
`,Jr=(0,y.iK)(ae.Z.Warning)`
  color: ${({theme:e})=>e.colors.error.base};
  &.anticon {
    margin-left: auto;
  }
`,eo=y.iK.div`
  height: 100%;
  overflow-y: auto;
`;var to={name:"7whenc",styles:"display:flex;width:100%"},no={name:"1vr7vmn",styles:"align-items:center;display:flex"},ro={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},oo={name:"an0ls6",styles:"align-self:flex-start;margin-left:auto"};const io=(0,a.forwardRef)((({getFilterTitle:e,onChange:t,onRemove:n,restoreFilter:r,onRearrange:o,currentFilterId:i,removedFilters:a,filters:s,erroredFilters:l=[]},u)=>(0,x.tZ)(eo,{"data-test":"filter-title-container",ref:u},(()=>{const u=[];return s.forEach(((s,c)=>{u.push((0,x.tZ)(Yr,{key:c,onRearrange:o,index:c,filterIds:[s]},(o=>{const s=!!a[o],u=l.includes(o),c=i===o,p=[];return u&&p.push("errored"),c&&p.push("active"),(0,x.tZ)(Xr,{role:"tab",key:`filter-title-tab-${o}`,onClick:()=>t(o),className:p.join(" ")},(0,x.tZ)("div",{css:to},(0,x.tZ)("div",{css:no},s?(0,d.t)("(Removed)"):e(o)),!a[o]&&u&&(0,x.tZ)(Jr,{className:"warning"}),s&&(0,x.tZ)("span",{css:ro,role:"button","data-test":"undo-button",tabIndex:0,onClick:e=>{e.preventDefault(),r(o)}},(0,d.t)("Undo?"))),(0,x.tZ)("div",{css:oo},s?null:(0,x.tZ)(Qr,{onClick:e=>{e.stopPropagation(),n(o)},alt:"RemoveFilter"})))})(s)))})),u})()))),ao=io,so=y.iK.div`
  ${({theme:e})=>`\n  cursor: pointer;\n  margin: ${4*e.gridUnit}px;\n  color: ${e.colors.primary.base};\n  &:hover {\n    color: ${e.colors.primary.dark1};\n  }\n`}
`,lo=y.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,uo=[{label:(0,d.t)("Filter"),type:Nr.BE.NATIVE_FILTER},{label:(0,d.t)("Divider"),type:Nr.BE.DIVIDER}],co=({getFilterTitle:e,onChange:t,onAdd:n,onRemove:r,onRearrange:o,restoreFilter:i,currentFilterId:s,filters:l,removedFilters:u,erroredFilters:c})=>{const p=(0,a.useRef)(null),h=(0,y.Fg)(),f=(0,x.tZ)(ge.$t,{mode:"horizontal"},uo.map((e=>(0,x.tZ)(ge.$t.Item,{onClick:()=>{return t=e.type,n(t),void setTimeout((()=>{var e;const t=document.getElementById("native-filters-tabs");if(t){const e=t.getElementsByClassName("ant-tabs-nav-list")[0];e.scrollTop=e.scrollHeight}null==p||null==(e=p.current)||null==e.scroll||e.scroll({top:p.current.scrollHeight,behavior:"smooth"})}),0);var t}},e.label))));return(0,x.tZ)(lo,null,(0,x.tZ)(de.Gj,{overlay:f,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,x.tZ)(so,null,(0,x.tZ)("div",{"data-test":"new-dropdown-icon",className:"fa fa-plus"})," ",(0,x.tZ)("span",null,(0,d.t)("Add filters and dividers")))),(0,x.tZ)("div",{css:(0,x.iv)({height:"100%",overflowY:"auto",marginLeft:3*h.gridUnit},"","")},(0,x.tZ)(ao,{ref:p,filters:l,currentFilterId:s,removedFilters:u,getFilterTitle:e,erroredFilters:c,onChange:t,onRemove:r,onRearrange:o,restoreFilter:i})))},po=y.iK.div`
  display: flex;
  height: 100%;
`,ho=y.iK.div`
  flex-grow: 3;
  margin-left: ${({theme:e})=>-1*e.gridUnit-1};
`,fo=y.iK.div`
  min-width: 270px;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
`,go=({getFilterTitle:e,onChange:t,onRemove:n,onRearrange:r,restoreFilter:o,onAdd:i,erroredFilters:a,children:s,currentFilterId:l,filters:d,removedFilters:u,fromModule:c})=>(0,x.tZ)(po,null,"filter-chart"!==c&&"filter-edit-chart"!==c&&(0,x.tZ)(fo,null,(0,x.tZ)(co,{currentFilterId:l,filters:d,removedFilters:u,erroredFilters:a,getFilterTitle:e,onChange:t,onAdd:e=>i(e),onRearrange:r,onRemove:e=>n(e),restoreFilter:o})),(0,x.tZ)(ho,null,s));var mo=n(409882),vo=n(311064),bo=n(616355),yo=n(554434),xo=n(88889),Co=n(918010),wo=n(5364),So=n(843700),Zo=n(634275),ko=n(171262),Mo=n(101090),Do=n(361890),Eo=n(677997);const Ro=(e,t,n=((...e)=>JSON.stringify([...e])))=>(...r)=>{const o=n(...r);if(t.has(o))return t.get(o);const i=e(...r);return t.set(o,i),i};var To=n(578676),_o=n(301510);const Io=y.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${({theme:e})=>10*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit+2}px;

  .checkbox {
    margin-bottom: ${({theme:e,checked:t})=>t?e.gridUnit:0}px;
  }

  & > div {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }
`,Oo=y.iK.div`
  margin-left: ${({theme:e})=>6*e.gridUnit}px;
`,Po=e=>{const{checked:t,disabled:n,title:r,tooltip:o,children:i,onChange:s=(()=>{}),initialValue:l=!1}=e,[d,u]=(0,a.useState)(l);return(0,a.useEffect)((()=>{void 0!==t&&u(t)}),[t]),(0,x.tZ)(Io,{checked:d},(0,x.tZ)(de.r4,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&u(n),s(n)}},(0,x.tZ)(a.Fragment,null,r,"\xa0",o&&(0,x.tZ)(mo.V,{placement:"top",tooltip:o}))),d&&(0,x.tZ)(Oo,null,i))};var zo=n(355786),Fo=n(428615),No=n(998286),$o=n(340892);const Lo=new Map,Bo=Ro(ee.Z.get,Lo,(({endpoint:e})=>e||""));function Ao({allowClear:e=!1,filterValues:t=(()=>!0),form:n,formField:r="column",filterId:o,datasetId:i,value:s,onChange:l,mode:u}){var c;const[p,h]=(0,a.useState)(),{addDangerToast:f}=(0,sn.e1)(),g=(0,a.useCallback)((()=>{n.setFields([{name:["filters",o,r],touched:!1,value:null}])}),[n,o,r]),m=(0,a.useMemo)((()=>(0,zo.Z)(p).filter(t).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[p,t]),v=null==(c=n.getFieldValue("filters"))?void 0:c[o].filterType,b=(0,a.useMemo)((()=>null==p?void 0:p.find((e=>e.column_name===s))),[p,s]);return(0,a.useEffect)((()=>{b&&!(0,$o.ZW)(v,b)&&g()}),[b,v,g]),(0,Fo.S)(i,(e=>{null!=e&&g(),null!=i&&Bo({endpoint:`/api/v1/dataset/${i}`}).then((({json:{result:e}})=>{const t=Array.isArray(s)?s:[s];e.columns.some((e=>null==t?void 0:t.includes(e.column_name)))||g(),h(e.columns)}),(async e=>{const{error:t,message:n}=await(0,No.O$)(e);let r=n||t||(0,d.t)("An error has occurred");"Forbidden"===n&&(r=(0,d.t)("You do not have permission to edit this dashboard")),f(r)}))})),(0,x.tZ)(de.Ph,{mode:u,value:"multiple"===u?s||[]:s,ariaLabel:(0,d.t)("Column select"),onChange:l,options:m,placeholder:(0,d.t)("Select a column"),notFoundContent:(0,d.t)("No compatible columns found"),showSearch:!0,allowClear:e})}var jo=n(115926),Ho=n.n(jo);const qo=new Map,Uo=Ro(ee.Z.get,qo,(({endpoint:e})=>e||"")),Vo=({onChange:e,value:t})=>{const n=(0,a.useCallback)((({error:e,message:t})=>{let n=t||e||(0,d.t)("An error has occurred");return"Forbidden"===t&&(n=(0,d.t)("You do not have permission to edit this dashboard")),n}),[]);return(0,x.tZ)(de.qb,{ariaLabel:(0,d.t)("Dataset"),value:t,options:async(e,t,r)=>{const o="table_name",i=Ho().encode({filters:[{col:o,opr:"ct",value:e}],page:t,page_size:r,order_column:o,order_direction:"asc"});return Uo({endpoint:`/api/v1/dataset/?q=${i}`}).then((e=>({data:e.json.result.map($o.Vd),totalCount:e.json.count}))).catch((async e=>{const t=n(await(0,No.O$)(e));throw new Error(t)}))},onChange:e,notFoundContent:(0,d.t)("No compatible datasets found")})},Wo=e=>(0,a.useMemo)((()=>(0,x.tZ)(Vo,e)),[]);var Go=n(888274);const Ko=({hasDefaultValue:e,filterId:t,hasDataset:n,form:r,setDataMask:o,formData:i,enableNoResults:a})=>{var s,l,u;const c=(r.getFieldValue("filters")||{})[t],h=null==c?void 0:c.defaultValueQueriesData,f=n&&null===h,g=null==c||null==(s=c.defaultDataMask)||null==(l=s.filterState)?void 0:l.value,m=e&&(null===g||void 0===g);return f?(0,x.tZ)(p.Z,{position:"inline-centered"}):(0,x.tZ)(Go.Z,{height:32,width:"filter_time"===(null==c?void 0:c.filterType)?350:250,appSection:bo.Tr.FILTER_CONFIG_MODAL,behaviors:[bo.cg.NATIVE_FILTER],formData:i,queriesData:n?null==c?void 0:c.defaultValueQueriesData:[{data:[{}]}],chartType:null==c?void 0:c.filterType,hooks:{setDataMask:o},enableNoResults:a,filterState:{...null==c||null==(u=c.defaultDataMask)?void 0:u.filterState,validateMessage:m&&(0,d.t)("Value is required"),validateStatus:m&&"error"}})};var Yo,Xo=n(765013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(Yo||(Yo={}));var Qo=n(734041);const Jo=function(e){var t;const{onChange:n=(()=>{}),node:r,selectValue:o,defaultValue:i,pathToFormValue:s=[],datasetColumns:l=[],tableName:d="",forceUpdate:u=(()=>{}),multiple:c=""}=e;return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("span",{style:{marginRight:10}},d),(0,x.tZ)(Qo.Z,{key:`scope_${null==r||null==(t=r.meta)?void 0:t.chartId}`,value:o,mode:c,options:l,maxTagCount:4,onChange:n,defaultValue:i,style:{minWidth:"120px"}}))},ei=({type:e,meta:t},n)=>{var r,o;return(e===f.gn||e===f.dW||e===f.U0)&&(!n||n[null==t?void 0:t.chartId])&&(!n||"filter_box"!==(null==(r=n[null==t?void 0:t.chartId])||null==(o=r.form_data)?void 0:o.viz_type))},ti=(e,t,n,r,o,i,a)=>{var s;let l=t;if(e&&t&&ei(e,r)&&e.type!==f.U0&&null!=o&&null!=o.includes&&o.includes(e.id)){var u;const n=a((e=>{var t,n,r,o,i,a,s,l,d,u;return null!=(t=null!=(n=null!=(r=null!=(o=null!=(i=null==e||null==(a=e.meta)?void 0:a.sliceNameOverride)?i:null==e||null==(s=e.meta)?void 0:s.sliceName)?o:null==e||null==(l=e.meta)?void 0:l.text)?r:null==e||null==(d=e.meta)?void 0:d.defaultText)?n:null==e||null==(u=e.id)||null==u.toString?void 0:u.toString())?t:""})(e),e,null==i||null==i.includes?void 0:i.includes(null==(u=e.meta)?void 0:u.chartId),(0,d.t)("This chart might be incompatible with the filter (datasets don't match)")),r={key:e.id,title:n,children:[]};t.children.push(r),l=r}null==e||null==(s=e.children)||null==s.forEach||s.forEach((e=>{const t=null==n?void 0:n[e];t?ti(t,l,n,r,o,i,a):be.Z.warn(`Unable to find item with id: ${e} in the dashboard layout. This may indicate you have invalid references in your dashboard and the references to id: ${e} should be removed.`)}))},ni=(e,t,n,r,o,i)=>{r.forEach((r=>{var a,s,l,d,u,c;ni(e,t,n,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!ei(e[n.parents[n.parents.length-1]]))).map((({id:e})=>e))]})(t,r),o,i);const p=["table","pivot_table_v2"].includes(null==(a=n[null==(l=t[r])||null==(d=l.meta)?void 0:d.chartId])||null==(s=a.form_data)?void 0:s.viz_type);(null==(u=t[r])?void 0:u.type)!==f.dW||o.includes(null==(c=t[r])?void 0:c.meta.chartId)||e.includes(r)||i&&!p||e.push(r)}))},ri=(e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===f.dW})).map((e=>{var n;return[Be._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>ei(t[e])))}));n.sort(((e,t)=>e.length-t.length));const r=n.map((e=>e[n[0].length-1])),o=[];return Object.entries(t).forEach((([t,n])=>{var i;const a=n.parents||[];n.type===f.dW&&null!=(i=[Be._4,...a])&&i.find((n=>((t,n)=>r.includes(t)&&!e.includes(n))(n,t)))&&o.push(n.meta.chartId)})),{rootPath:[...new Set(r)],excluded:o}},oi=(e,t=[])=>({rootPath:[Be._4],excluded:e?[e,...t]:t}),ii=(e,t)=>!e||e.rootPath[0]===Be._4&&!e.excluded.filter((e=>e!==t)).length;const ai=e=>{var t;const{formScope:n,initialScope:r,forceUpdate:i,updateFormValues:s,chartId:l,initiallyExcludedCharts:u=[],handSelectColumn:c=(()=>{}),formScopeBindDatasetAndColumn:p=[],pathToFormValue:h=[],filterselectmode:g,filterType:m,scopeBindDatasetAndColumn:v}=e,[b,y]=(0,a.useState)([Be._4]),C="dynamic_column"===m,w=(0,o.v9)((e=>e)),{charts:S,nativeFilters:Z}=w;let k=!1;const{filters:M={}}=Z||{};Object.keys(M).forEach((e=>{var t;"select_tree"===(null==(t=M[e])?void 0:t.filterType)&&h[1]===e&&(k=!0)}));const D=(null==Z?void 0:Z.datasetScopeInfo)||[],{treeData:E,layout:R}=function(e,t=[],n=(e=>e),r){const i=(0,o.v9)((({dashboardLayout:{present:e}})=>e)),s="dynamic_column"===r,l=(0,o.v9)((({charts:e})=>{if(s){const n={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var t;const o=e[r];["table","pivot_table_v2"].includes(null==o||null==(t=o.form_data)?void 0:t.viz_type)&&(n[r]=o)}return n}return e})),u=((0,o.v9)((e=>e)),{children:[],key:Be._4,type:f.U0,title:s?(0,d.t)("All table"):(0,d.t)("All panels")}),c=(0,a.useMemo)((()=>Object.values(i).reduce(((t,n)=>{const{id:r,parents:o=[],type:i,meta:a}=n;return i===f.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...o,r])]:t}),[])),[i,e]);return(0,a.useMemo)((()=>{ti(i[Be._4],u,i,l,c,t,n)}),[i,u,l,t,n]),{treeData:[u],layout:i}}(l,u,((e,t,r,o)=>{var s,l,d,u;const{meta:{chartId:f}}=t,[m,b]=(0,a.useState)(null),y=null==(s=S[f])||null==(l=s.form_data)?void 0:l.datasource.split("__")[0],w=(null==(d=p.filter((e=>e.nodeId===t.id)))?void 0:d[0])||{},Z=[];(0,a.useEffect)((()=>{C?(Z.push(...((e,t,n)=>{const r=[];if(e.tableColumnChoose&&Array.isArray(e.tableColumnChoose)&&e.tableColumnChoose.length>0)e.tableColumnChoose.forEach((e=>{r.push(e.value)}));else{var o;const e=(null==(o=t.filter((e=>e.nodeId===n)))?void 0:o[0])||{};e.tableColumnChoose&&e.tableColumnChoose.forEach((e=>{r.push(e.value)}))}return r})(w,v,t.id)),b(Z)):b(w.tableColumnChoose)}),[w.tableColumnChoose]);const M=(null==(u=D.filter((e=>`${null==e?void 0:e.id}`===y)))?void 0:u[0])||{},E=((null==M?void 0:M.columns)||[]).map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,result:M,node:t}))),R=(0,x.tZ)("div",{onMouseDown:e=>(e.preventDefault(),e.stopPropagation(),!1),onClick:e=>(e.preventDefault(),e.stopPropagation(),!1),style:{display:"inline-flex",marginLeft:10}},(0,x.tZ)(Jo,{node:t,multiple:C?"multiple":"",onChange:(e,t)=>{var n,r,o,i,a;b(e);const s=Array.isArray(t)?E[0]:t,l=null==s||null==(n=s.node)?void 0:n.id,d=null==s||null==(r=s.node)||null==(o=r.meta)?void 0:o.chartId,u=null==s||null==(i=s.result)?void 0:i.id,p=null==s||null==(a=s.result)?void 0:a.table_name;let f=[];C&&Array.isArray(t)&&(f=t.map((e=>({label:e.label,value:e.value}))));const g={nodeId:l,nodeTreeId:d,tableIdChoose:u,tableNameChoose:p,tableColumnChoose:C?f:e,scopeFilterId:h[1]};c(g)},selectValue:m,defaultValue:C?Z:w.tableColumnChoose,pathToFormValue:h,datasetColumns:E,tableName:C?"":M.table_name,forceUpdate:i}));let T=(0,x.tZ)(a.Fragment,null,(0,x.tZ)("span",null,e),!(null!=n&&n.excluded.includes(t.meta.chartId))&&"TAB"!==(null==t?void 0:t.type)&&!k&&R);return r&&(T=(0,x.tZ)(a.Fragment,null,T,"\xa0",(0,x.tZ)(ce.u,{title:o},(0,x.tZ)(ae.Z.Info,{iconSize:"m"})))),g||(T=(0,x.tZ)("span",null,e)),T}),m),[T,_]=(0,a.useState)(!0),I=(e,t)=>{var n;i();const r=ri(e,R);void 0!==l&&(r.excluded=[...new Set([...r.excluded,l])]),s({scope:r});const o=(null==t||null==(n=t.node)?void 0:n.key)||"";if(p.map((e=>e.nodeId)).filter((e=>e===o)).length>0&&c({nodeId:o},{type:"remove"}),C&&null!=t&&t.checked){const e=null==v?void 0:v.filter((e=>e.nodeId===o))[0];c(e)}if(o.startsWith("TAB-")){var a;const e=(null==w||null==(a=w.dashboardLayout)?void 0:a.present)||{};let n=[];const r=null==w?void 0:w.dashboardFilters,i=t=>{const{children:r,type:o}=t;"CHART"!==o||r.length?r.length&&r.forEach((t=>i(null==e?void 0:e[t]))):n.push(t)};i(null==e?void 0:e[o]);n.filter((e=>!r[e.meta.chartId]&&e.parents.includes(o))).map((e=>{var t;return{nodeId:null==e?void 0:e.id,nodeTreeId:null==e||null==(t=e.meta)?void 0:t.chartId,tableIdChoose:0,tableNameChoose:"",tableColumnChoose:""}})),t.checked}};(0,a.useEffect)((()=>{!r.excluded.length&&C&&I([],null)}),[]);const O=(0,a.useMemo)((()=>((e,t,n,r)=>{const o=[];return ni(o,t,n,[...e.rootPath],[...e.excluded],r),[...new Set(o)]})({...n||r},R,S,C)),[n,r,R]);return(0,x.tZ)(de.mp,{checkable:!0,selectable:!1,onExpand:e=>{y(e),_(!1)},expandedKeys:b,autoExpandParent:T,onCheck:I,checkedKeys:O,treeData:C?null==(t=E[0])?void 0:t.children:E})},si=y.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,li=(0,y.iK)(de.qz.Item)`
  margin-bottom: 0;
`,di=e=>{var t,n,r;const{pathToFormValue:i=[],formScopingType:s,formFilterScope:l,forceUpdate:u,filterScope:c,updateFormValues:p,chartId:h,initiallyExcludedCharts:f,handSelectColumn:g,formFilterScopeBindDatasetAndColumn:m=[],filterselectmode:v,filterType:b,scopeBindDatasetAndColumn:y,fitd:C}=e,w=(0,o.v9)((e=>e)),S=(null==w||null==(t=w.nativeFilters)||null==(n=t.filters)||null==(r=n[null==i?void 0:i[1]])?void 0:r.scopeBindDatasetAndColumn)||m,[Z]=(0,a.useState)(c||oi(h,f)),[k]=(0,a.useState)(Yo.specific),[M,D]=(0,a.useState)(!!c),E=(0,a.useCallback)((e=>{p(e),D(!0)}),[p]),R=(0,a.useCallback)((()=>{if(c||M)return;const e=oi(h,f);p({scope:e,scoping:ii(e,h)?Yo.all:Yo.specific})}),[h,c,M,f,p]);return(0,Xo.d)(R),(0,x.tZ)(si,null,C,(0,x.tZ)(de.ZT.Text,{type:"secondary"},(null!=s?s:k)===Yo.specific?(0,d.t)("Only selected panels will be affected by this filter"):(0,d.t)("All panels with this column will be affected by this filter")),(0,x.tZ)(ai,{updateFormValues:E,initialScope:Z,formScope:l,pathToFormValue:i,formScopeBindDatasetAndColumn:m,forceUpdate:u,chartId:h,initiallyExcludedCharts:f,handSelectColumn:g,filterselectmode:v,filterType:b,scopeBindDatasetAndColumn:y}),(0,x.tZ)(li,{name:[...i,"scope"],hidden:!0,initialValue:Z}),(0,x.tZ)(li,{name:[...i,"scopeBindDatasetAndColumn"],hidden:!0,initialValue:S}))};var ui=n(837687);const ci=(0,y.iK)(Re.xJ)`
  margin-bottom: 0;
`;const pi=y.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,hi=({onClick:e})=>(0,x.tZ)(pi,null,(0,x.tZ)("p",null,(0,d.t)("You have removed this filter.")),(0,x.tZ)("div",null,(0,x.tZ)(se.Z,{"data-test":"restore-filter-button",buttonStyle:"primary",onClick:e},(0,d.t)("Restore Filter")))),fi=(e,t)=>{var n;const r=(0,$o.NW)(),o=(e.getFieldValue("filters")||{})[t];(0,a.useEffect)((()=>{(0,$o.aX)(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),r()}),[e,null==o?void 0:o.filterType,null==o?void 0:o.column,null==o||null==(n=o.dataset)?void 0:n.value,null==o?void 0:o.scopeBindDatasetAndColumn,null==o?void 0:o.filterselectmode,JSON.stringify(null==o?void 0:o.adhoc_filters),null==o?void 0:o.time_range,r,t])},gi=y.iK.div`
  display: flex;
  flex-direction: column;
`,mi=y.iK.div`
  ${({theme:e})=>`\n    display: inline-flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    color: ${e.colors.primary.base};\n    &:hover {\n      color: ${e.colors.primary.dark1};\n    }\n  `}
`,vi=(0,y.iK)(ae.Z.Trash)`
  ${({theme:e})=>`\n    cursor: pointer;\n    margin-left: ${2*e.gridUnit}px;\n    color: ${e.colors.grayscale.base};\n    &:hover {\n      color: ${e.colors.grayscale.dark1};\n    }\n  `}
`,bi=y.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${e.gridUnit}px;\n  `}
`,yi=y.iK.div`
  text-transform: uppercase;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,xi=({availableFilters:e,selection:t,onChange:n,onDelete:r})=>{let o=e.find((e=>e.value===t)),i=e;return o||(o={label:(0,d.t)("(deleted or invalid type)"),value:t},i=[o,...i]),(0,x.tZ)(bi,null,(0,x.tZ)(de.Ph,{ariaLabel:(0,d.t)("Limit type"),labelInValue:!0,options:i,onChange:e=>n(t,e.value),value:o}),(0,x.tZ)(vi,{iconSize:"xl",onClick:()=>r(t)}))},Ci=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n})=>{const[r,o]=(0,a.useState)(t),i=e=>{o(e),n(e)},s=(e,t)=>{const n=r.findIndex((t=>t===e)),o=[...r];o[n]=t,i(o)},l=e=>{const t=[...r];t.splice(r.indexOf(e),1),i(t)};return 0===e.length?(0,x.tZ)("span",null,(0,d.t)("No available filters.")):(0,x.tZ)(a.Fragment,null,r.map((t=>(0,x.tZ)(xi,{key:t,selection:t,availableFilters:e.filter((e=>e.value===t||!r.includes(e.value))),onChange:s,onDelete:l}))),e.length>r.length&&(0,x.tZ)(mi,{onClick:()=>{const t=e.find((e=>!r.includes(e.value)));if(t){const e=[...r];e.push(t.value),i(e)}}},(0,x.tZ)(ae.Z.PlusSmall,null),(0,d.t)("Add filter")))},wi=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n,getDependencySuggestion:r})=>{const o=e.length>0,i=t.length>0;return(0,x.tZ)(gi,null,(0,x.tZ)(Po,{title:(0,d.t)("Values are dependent on other filters"),initialValue:i,onChange:e=>{const t=[];e&&!i&&o&&t.push(r()),n(t)},tooltip:(0,d.t)("Values selected in other filters will affect the filter options to only show relevant values")},i&&(0,x.tZ)(yi,null,(0,d.t)("Values dependent on")),(0,x.tZ)(Ci,{availableFilters:e,dependencies:t,onDependenciesChange:n,getDependencySuggestion:r})))},Si=y.iK.div`
  display: flex;
  flex-direction: column;
`,Zi=y.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${e.gridUnit}px;\n  `}
`,ki=y.iK.div`
  text-transform: uppercase;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,Mi=({availableFilters:e,selection:t,onChange:n})=>{let r=e.find((e=>e.value===t)),o=e;return r||(r={label:(0,d.t)("(deleted or invalid type)"),value:t},o=[r,...o]),(0,x.tZ)(Zi,null,(0,x.tZ)(de.Ph,{ariaLabel:(0,d.t)("Limit type"),labelInValue:!0,options:o,onChange:e=>n(e.value),value:r}))},Di=({availableFilters:e=[],dependencyFilterId:t,onDependencyChange:n})=>{const r=e.length>0,o=!!t;return(0,x.tZ)(Si,null,(0,x.tZ)(Po,{title:(0,d.t)("Display by time granularity depends on other time granularity filter"),initialValue:o,onChange:t=>{let i;t&&!o&&r&&(i=e[0].value),n(i)},tooltip:(0,d.t)("Values selected in other time granularity filters will affect the filter's time granularity to only show relevant values")},o&&(0,x.tZ)(ki,null,(0,d.t)("Time granularity dependent on")),(0,x.tZ)(Mi,{selection:t,availableFilters:e,onChange:n})))},Ei=(0,y.iK)(ko.ZP.TabPane)`
  padding: ${({theme:e})=>4*e.gridUnit}px 0px;
`,Ri=y.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,Ti=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,_i=["enableEmptyFilter","defaultToFirstItem","multiSelect","searchAllOptions","inverseSelection"],Ii=(0,y.iK)(Re.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Oi=(0,y.iK)(Re.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
    width: 212px; // 解决下拉树 过滤器有默认值 默认值 input 的长度问题
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Pi=(0,y.iK)(Re.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
    width: 212px; // 解决下拉树 过滤器有默认值 默认值 input 的长度问题
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,zi=y.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`,Fi=(0,y.iK)(Re.xJ)`
  margin-bottom: 0;
`,Ni=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,$i=(0,y.iK)(ae.Z.Refresh)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  color: ${({theme:e})=>e.colors.primary.base};
`,Li=(0,y.iK)(So.Z)`
  border-left: 0;
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${({theme:e})=>2*e.gridUnit}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,Bi=(0,y.iK)(ko.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,Ai=y.iK.span`
  color: ${({theme:e})=>e.colors.error.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  margin-left: ${({theme:e})=>e.gridUnit-1}px;
  &:before {
    content: '*';
  }
`,ji=y.iK.div`
  ${({theme:e})=>`\n    width: 49%;\n    font-size: ${e.typography.sizes.s}px;\n    color: ${e.colors.grayscale.light1};\n    margin:\n      ${2*-e.gridUnit}px\n      0px\n      ${4*e.gridUnit}px\n      ${4*e.gridUnit}px;\n  `}
`,Hi=y.iK.div`
  ${({theme:e})=>"\n    display: flex;\n    align-items: center;\n    padding: 0px 15px;\n    .text-title {\n      margin-bottom: 0px;\n      margin-right: 10px ;\n    }\n    .ant-form-item{\n      margin-bottom: 0px !important;\n    }\n  "}
`,qi={configuration:{key:"configuration",name:(0,d.t)("Settings")},scoping:{key:"scoping",name:(0,d.t)("Scoping")}},Ui={configuration:{key:"configuration",name:(0,d.t)("Filter Configuration")},settings:{key:"settings",name:(0,d.t)("Filter Settings")}},Vi=["filter_select","filter_range","filter_textinput","filter_tab","select_tree"],Wi={[(0,d.t)("Select filter")]:(0,d.t)("Value"),[(0,d.t)("Range filter")]:(0,d.t)("Numerical range"),[(0,d.t)("Time filter")]:(0,d.t)("Time range"),[(0,d.t)("Time column")]:(0,d.t)("Time column"),[(0,d.t)("Time grain")]:(0,d.t)("Time grain"),[(0,d.t)("Group by")]:(0,d.t)("Group by"),[(0,d.t)("TextInput filter")]:(0,d.t)("TextInput filter"),[(0,d.t)("Tab filter")]:(0,d.t)("Tab"),[(0,d.t)("TextList Select filter")]:(0,d.t)("TextList select"),[(0,d.t)("Select tree")]:(0,d.t)("Select tree")},Gi=new Map,Ki=Ro(ee.Z.get,Gi,(({endpoint:e})=>e||"")),Yi=(e,t)=>{var n,r,i,s,l,c,h,f,g,m,v,b,y,C,w,S,Z,k,M,D,E,R,T,_;const{filterId:I,filterToEdit:O,removedFilters:P,form:z,getAvailableFilters:F,activeFilterPanelKeys:N,restoreFilter:$,handleActiveFilterPanelChange:L,setErroredFilters:B,validateDependencies:A,getDependencySuggestion:j,isActive:H,fromModule:q,initSelectValueFilter:U,addNewFilterId:V}=e,W=!!P[I],[G,K]=(0,a.useState)(""),[Y,X]=(0,a.useState)([]),[Q,J]=(0,a.useState)(qi.configuration.key),[ee,te]=(0,a.useState)(null),ne=(0,$o.NW)(H),[re,ie]=(0,a.useState)(),ae=(0,a.useMemo)((()=>({})),[]),se=z.getFieldValue("filters"),ue=null==se?void 0:se[I],pe=ue||ee||ae,he=(null==O?void 0:O.filterselectmode)||!1,ge=(null==pe?void 0:pe.dependencies)||(null==O?void 0:O.cascadeParentIds),me=(null==pe?void 0:pe.dependencyWithTimeGrain)||(null==O?void 0:O.cascadeTimeGrainFilterId),ve=(0,vo.Z)().items,be=Object.entries(ve).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(bo.cg.NATIVE_FILTER)})).map((([e])=>e)),ye=(0,o.v9)((({datasources:e})=>e)),xe=(0,o.v9)((({charts:e})=>e)),Ce=(0,a.useMemo)((()=>Object.values(ye).some((e=>(0,$o.Ns)(e)))),[ye]),we=(0,a.useMemo)((()=>{const e=Object.values(ye).find((e=>{var t;return e.id===(null==pe||null==(t=pe.dataset)?void 0:t.value)}));return!e||(0,$o.Ns)(e)}),[null==pe||null==(n=pe.dataset)?void 0:n.value,ye]),Se=!(null==(r=ve[null==pe?void 0:pe.filterType])||null==(i=r.value)||!i.datasourceCount),Ze=null!=(s=null!=(l=null==pe||null==(c=pe.dataset)?void 0:c.value)?l:null==O||null==(h=O.targets[0])?void 0:h.datasetId)?s:(0,$o.o9)(ye,xe),{controlItems:ke={},mainControlItems:Me={}}=pe?function({datasetId:e,disabled:t,forceUpdate:n,form:r,filterId:o,filterType:i,filterToEdit:s,formFilter:l,removed:u}){var c;const p=(0,ui.Z)(),h=null!=(c=(0,$o.VE)(p.get(i)))?c:[],f={},g={};return h.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((t=>{var i,c,p,h,f,m,v,b,y;const C=null!=(i=null==s||null==(c=s.controlValues)?void 0:c[t.name])?i:null==t||null==(p=t.config)?void 0:p.default,w=null==s||null==(h=s.targets[0])||null==(f=h.column)?void 0:f.name,S=(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ci,{name:["filters",o,"requiredFirst",t.name],hidden:!0,initialValue:(null==t||null==(m=t.config)?void 0:m.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,x.tZ)(Ii,{name:["filters",o,"column"],initialValue:w,label:(0,x.tZ)(zi,null,(null==(v=t.config)?void 0:v.label)||(0,d.t)("Column")),rules:[{required:(null==(b=t.config)?void 0:b.required)&&!u,message:(0,d.t)("Column is required")}],"data-test":"field-input"},(0,x.tZ)(Ao,{mode:("select_tree"===(null==l?void 0:l.filterType)||(null==(y=t.config)?void 0:y.multiple))&&"multiple",form:r,filterId:o,datasetId:e,filterValues:e=>(0,$o.ZW)((null==l?void 0:l.filterType)||"",e),onChange:()=>{(0,$o.aX)(r,o,{defaultDataMask:null}),n()}})));g[t.name]={element:S,checked:C}})),h.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var i,u,c,p;const h=null!=(i=null==s||null==(u=s.controlValues)?void 0:u[e.name])?i:null==e||null==(c=e.config)?void 0:c.default,g=(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ci,{name:["filters",o,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(p=e.config)?void 0:p.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,x.tZ)(ce.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&t&&(0,d.t)('Populate "Default value" to enable this control')},(0,x.tZ)(Oi,{key:e.name,name:["filters",o,"controlValues",e.name],initialValue:h,valuePropName:"checked",colon:!1},(0,x.tZ)(de.r4,{disabled:e.config.affectsDataMask&&t,onChange:({target:{checked:t}})=>{e.config.requiredFirst&&(0,$o.aX)(r,o,{requiredFirst:{...null==l?void 0:l.requiredFirst,[e.name]:t}}),e.config.resetConfig&&(0,$o.aX)(r,o,{defaultDataMask:null}),n()}},e.config.label,"\xa0",e.config.description&&(0,x.tZ)(mo.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));f[e.name]={element:g,checked:h}})),{controlItems:f,mainControlItems:g}}({datasetId:Ze,disabled:!1,forceUpdate:ne,form:z,filterId:I,filterType:null==pe?void 0:pe.filterType,filterToEdit:O,formFilter:pe,removed:W}):{},De=!!Me.groupby,Ee=!(null==(g=(null!=(f=ve[null==pe?void 0:pe.filterType])?f:{}).value)||!g.enableNoResults),Re=De&&!(null==Y||!Y.length),Te=!Se||Ze&&((null==pe?void 0:pe.column)||!De),_e=Vi.includes(null==pe?void 0:pe.filterType),Ie=va.includes(null==pe?void 0:pe.filterType),Oe=null==(m=null==pe?void 0:pe.isDataDirty)||m,Pe=e=>{(0,$o.aX)(z,I,e),K(""),ne()};let ze={};ge&&ge.length>0&&se&&ge.forEach((e=>{var t,n;const r=null==(t=se[e])||null==(n=t.defaultDataMask)?void 0:n.extraFormData;ze=(0,_o.on)(ze,r)}));const Fe=JSON.stringify(ze),Ne=(0,a.useCallback)(((e=!1)=>{var t,n;if(!Se||null==pe||null==(t=pe.dataset)||!t.value)return void ne();const r=(0,_o.zi)({datasetId:null==pe||null==(n=pe.dataset)?void 0:n.value,groupby:null==pe?void 0:pe.column,...pe});r.extra_form_data=ze,Pe({defaultValueQueriesData:null,isDataDirty:!1}),(0,ln.getChartDataRequest)({formData:r,force:e,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,oe.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)Pe({defaultValueQueriesData:[n]});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Eo.YJ)(n).then((e=>{Pe({defaultValueQueriesData:e})})).catch((e=>{K(e.message||e.error||(0,d.t)("Check configuration"))}))}}else Pe({defaultValueQueriesData:t.result})})).catch((e=>{e.json().then((t=>{(e=>{(0,$o.aX)(z,I,{defaultValueQueriesData:null}),K(e),ne()})(t.message||e.statusText||(0,d.t)("Check configuration"))}))}))}),[I,ne,z,pe,Se,Fe]);(0,a.useEffect)((()=>Ne()),[Fe]);const Le=(0,_o.zi)({datasetId:Ze,groupby:De?null==pe?void 0:pe.column:void 0,...pe});Le.extra_form_data=ze;const[Be,Ae,je,He]=((e,t)=>{var n,r;const o=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),i=!(null==e||null==(r=e.controlValues)||!r.defaultToFirstItem),[s,l]=(0,a.useState)(!1),[u,c]=(0,a.useState)(o),[p,h]=(0,a.useState)(""),f=(e=!1)=>{const t=o&&!i;c(t),l(!!t||e)};return(0,a.useEffect)((()=>{var t,n;f(!i&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[i,o]),(0,a.useEffect)((()=>{var e,n;f(!i&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,a.useEffect)((()=>{let e="";i?e=(0,d.t)('Default value set automatically when "Select first filter value by default" is checked'):u?e=(0,d.t)('Default value must be set when "Filter value is required" is checked'):s&&(e=(0,d.t)('Default value must be set when "Filter has default value" is checked')),h(e)}),[s,u,i]),[s,u,p,f]})(pe,O),qe=!Ze||re||(null==pe||null==(v=pe.dataset)?void 0:v.label),Ue=(0,a.useCallback)((()=>{z.setFields([{name:"changed",value:!0}])}),[z]),Ve=(0,a.useCallback)((e=>{(0,$o.aX)(z,I,e),Ue()}),[I,z,Ue]),We=!(null==pe||!pe.adhoc_filters)||!(null==pe||!pe.time_range)||!(null==O||null==(b=O.adhoc_filters)||!b.length)||!(null==O||!O.time_range),Ge=void 0!==(null==pe||null==(y=pe.controlValues)?void 0:y.enableSingleValue)||void 0!==(null==O||null==(C=O.controlValues)?void 0:C.enableSingleValue);let Ke=null==O||null==(w=O.controlValues)?void 0:w.enableSingleValue;void 0!==(null==pe||null==(S=pe.controlValues)?void 0:S.enableSingleMaxValue)&&({enableSingleValue:Ke}=pe.controlValues);const Ye="boolean"===typeof(null==pe||null==(Z=pe.controlValues)?void 0:Z.sortAscending)||"boolean"===typeof(null==O||null==(k=O.controlValues)?void 0:k.sortAscending);let Xe=null==O||null==(M=O.controlValues)?void 0:M.sortAscending;"boolean"===typeof(null==pe||null==(D=pe.controlValues)?void 0:D.sortAscending)&&(Xe=pe.controlValues.sortAscending);const Qe=!Se||!Oe&&Te||!Me.groupby,Je=e=>{var t;const n=null==(t=z.getFieldValue("filters"))?void 0:t[I].controlValues;(0,$o.aX)(z,I,{controlValues:{...n,sortAscending:e}}),ne()},et=e=>{var t;const n=null==(t=z.getFieldValue("filters"))?void 0:t[I].controlValues;(0,$o.aX)(z,I,{controlValues:{...n,enableSingleValue:e}}),ne()},tt=()=>setTimeout((()=>z.validateFields([["filters",I,"adhoc_filters"],["filters",I,"time_range"]])),0),nt=(null==pe?void 0:pe.time_range)&&"No filter"!==pe.time_range,ot=(null==pe||null==(E=pe.adhoc_filters)?void 0:E.length)>0,it=null==pe||null==(R=pe.controlValues)?void 0:R.defaultToFirstItem,at=(null==pe?void 0:pe.filterType)===(null==O?void 0:O.filterType)?null==O?void 0:O.defaultDataMask:null,st="filter-chart"===q||"filter-edit-chart"===q,lt=void 0!==(null==pe?void 0:pe.timeGranularity)||void 0!==(null==O?void 0:O.timeGranularity),dt=e=>{(0,$o.aX)(z,I,{timeGranularity:e}),ne()},ut=()=>nt||ot?Promise.resolve():Promise.reject(new Error((0,d.t)("Pre-filter is required"))),ct=F(I,va),pt=F(I,ba);(0,a.useEffect)((()=>{Ze&&Ki({endpoint:`/api/v1/dataset/${Ze}`}).then((e=>{var t,n,r;X(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const o=null==(r=e.json)?void 0:r.result;o.type=o.datasource_type,o.filter_select=!0,ie(o)})).catch((e=>{(0,rt.Gb)(e.message)}))}),[Ze]),(0,a.useEffect)((()=>{U&&V&&((0,$o.aX)(z,V,{filterType:U,defaultDataMask:null,column:null}),ne()),st&&V&&((0,$o.aX)(z,V,{addFromModule:q}),ne())}),[U,V,q]),(0,a.useImperativeHandle)(t,(()=>({changeTab(e){J(e)}}))),fi(z,I),(0,a.useEffect)((()=>{Se&&Te&&Be&&Oe&&Ne()}),[Se,Te,Be,Oe,Ne,qe]);const ht=(0,a.useMemo)((()=>{var e;const t=[];return void 0===(null==pe||null==(e=pe.dataset)?void 0:e.value)?[]:(Object.values(xe).forEach((e=>{var n,r,o;const i=null==(n=e.form_data)?void 0:n.datasource;void 0!==i&&(null==(r=ye[i])?void 0:r.id)!==(null==pe||null==(o=pe.dataset)?void 0:o.value)&&t.push(e.id)})),t)}),[JSON.stringify(xe),null==pe||null==(T=pe.dataset)?void 0:T.value,JSON.stringify(ye)]);if((0,a.useEffect)((()=>{W&&te(ue)}),[W]),(0,a.useEffect)((()=>{ee&&!W&&((0,$o.aX)(z,I,ee),te(null))}),[ue,I,z,W,ee]),W)return(0,x.tZ)(hi,{onClick:()=>$(I)});const ft=(0,x.tZ)(Hi,null,(0,x.tZ)("span",{className:"text-title"},(0,d.t)("Filtering mode")),(0,x.tZ)(Ii,{name:["filters",I,"filterselectmode"],initialValue:he},(0,x.tZ)(le.Y.Group,{onChange:e=>{(0,$o.aX)(z,I,{filterselectmode:e.target.value}),ne()},defaultValue:he,value:he},(0,x.tZ)(le.Y,{value:!1},(0,d.t)("Dataset"),(0,x.tZ)(ce.u,{title:(0,d.t)("Filter based on the dimensions of the system built-in dataset")},(0,x.tZ)(yo.default,null))),(0,x.tZ)(le.Y,{value:!0},(0,d.t)("Specify chart fields"),(0,x.tZ)(ce.u,{title:(0,d.t)("Filter based on a custom field dimension specified in the dataset")},(0,x.tZ)(yo.default,null))))));return(0,x.tZ)(Bi,{activeKey:Q,onChange:e=>J(e),centered:!0},(0,x.tZ)(Ei,{tab:qi.configuration.name,key:qi.configuration.key,forceRender:!0},(0,x.tZ)(Ri,null,(0,x.tZ)(Ii,{name:["filters",I,"type"],hidden:!0,initialValue:Nr.BE.NATIVE_FILTER},(0,x.tZ)($e.II,null)),st&&(0,x.tZ)(Ii,{name:["filters",I,"addFromModule"],hidden:!0,initialValue:q},(0,x.tZ)($e.II,null)),(0,x.tZ)(Ii,{name:["filters",I,"name"],label:(0,x.tZ)(zi,null,(0,d.t)("Filter name")),initialValue:null==O?void 0:O.name,rules:[{required:!W,message:(0,d.t)("Name is required")}]},(0,x.tZ)($e.II,ma("name-input"))),(0,x.tZ)(Ii,fe()({name:["filters",I,"filterType"],rules:[{required:!W,message:(0,d.t)("Name is required")}],initialValue:(null==O?void 0:O.filterType)||"filter_select",label:(0,x.tZ)(zi,null,(0,d.t)("Filter Type"))},ma("filter-type")),(0,x.tZ)(de.Ph,{ariaLabel:(0,d.t)("Filter type"),disabled:st,options:be.map((e=>{var t,n,r;const o=null==(t=ve[e])?void 0:t.value.name,i=o?Wi[o]:void 0,a=1===(null==(n=$o.Qc[e])?void 0:n.length)&&(null==(r=$o.Qc[e])?void 0:r.includes(xo.Z.TEMPORAL))&&!Ce;return{value:e,label:i||o,customLabel:a?(0,x.tZ)(ce.u,{title:(0,d.t)("Datasets do not contain a temporal column")},i||o):void 0,disabled:a}})),onChange:e=>{(0,$o.aX)(z,I,{filterType:e,defaultDataMask:null,column:null}),ne()}}))),"filter_time"===(null==pe?void 0:pe.filterType)&&(0,x.tZ)(ji,null,(0,d.t)("Dashboard time range filters apply to temporal columns defined in\n          the filter section of each chart. Add temporal columns to the chart\n          filters to have this dashboard filter impact those charts.")),Se&&(0,x.tZ)(Ti,null,qe?(0,x.tZ)(Ii,fe()({name:["filters",I,"dataset"],label:(0,x.tZ)(zi,null,(0,d.t)("Dataset")),initialValue:re?{label:re.table_name,value:re.id}:void 0,rules:[{required:!W,message:(0,d.t)("Dataset is required")}]},ma("datasource-input")),(0,x.tZ)(Wo,{onChange:e=>{e.value!==Ze&&(0,$o.aX)(z,I,{dataset:e,defaultDataMask:null,column:null}),ne()}})):(0,x.tZ)(Ii,{label:(0,x.tZ)(zi,null,(0,d.t)("Dataset"))},(0,x.tZ)(p.Z,{position:"inline-centered"})),Se&&Object.keys(Me).map((e=>Me[e].element))),(0,x.tZ)(Li,{defaultActiveKey:N,onChange:e=>{L(e)},expandIconPosition:"right",key:`native-filter-config-${I}`},"filter_time"===(null==pe?void 0:pe.filterType)&&(0,x.tZ)(So.Z.Panel,{forceRender:!0,header:Ui.configuration.name,key:`${I}-${Ui.configuration.key}`},pt.length>0&&(0,x.tZ)(Oi,{name:["filters",I,"dependencyWithTimeGrain"],initialValue:me},(0,x.tZ)(Di,{availableFilters:pt,dependencyFilterId:me,onDependencyChange:e=>{(0,$o.aX)(z,I,{dependencyWithTimeGrain:e}),ne(),Ue()}})),(0,x.tZ)(Oi,{name:["filters",I,"timeGranularity"],initialValue:null==O?void 0:O.timeGranularity},(0,x.tZ)(Po,{initialValue:lt,title:(0,d.t)("Time grain"),onChange:e=>{dt(e?Co.iF.Date:void 0),Ue()}},(0,x.tZ)(de.Ph,{allowClear:!0,ariaLabel:(0,d.t)("Time grain"),options:[{value:Co.iF.Year,label:(0,d.t)("Year")},{value:Co.iF.Quarter,label:(0,d.t)("Quarter")},{value:Co.iF.Month,label:(0,d.t)("Month")},{value:Co.iF.Week,label:(0,d.t)("Week")},{value:Co.iF.Date,label:(0,d.t)("Date")},{value:Co.iF.Hour,label:(0,d.t)("Hour")},{value:Co.iF.Minute,label:(0,d.t)("Minute")},{value:Co.iF.Second,label:(0,d.t)("Second")}],value:(null==pe?void 0:pe.timeGranularity)||(null==O?void 0:O.timeGranularity),onChange:e=>{void 0!==e&&(dt(e),Ue())}})))),"filter_time"!==(null==pe?void 0:pe.filterType)&&"filter_textinput"!==(null==pe?void 0:pe.filterType)&&(0,x.tZ)(So.Z.Panel,{forceRender:!0,header:Ui.configuration.name,key:`${I}-${Ui.configuration.key}`},Ie&&ct.length>0&&(0,x.tZ)(Oi,{name:["filters",I,"dependencies"],initialValue:ge},(0,x.tZ)(wi,{availableFilters:ct,dependencies:ge,onDependenciesChange:e=>{(0,$o.aX)(z,I,{dependencies:e}),ne(),A(),Ue()},getDependencySuggestion:()=>j(I)})),Se&&_e&&(0,x.tZ)(Fi,{name:["filters",I,"preFilter"]},(0,x.tZ)(Po,{initialValue:We,title:(0,d.t)("Pre-filter available values"),onChange:e=>{Ue(),e&&tt()}},(0,x.tZ)(Pi,{name:["filters",I,"adhoc_filters"],initialValue:null==O?void 0:O.adhoc_filters,required:!0,rules:[{validator:ut}]},(0,x.tZ)(Do.Z,{columns:(null==re||null==(_=re.columns)?void 0:_.filter((e=>e.filterable)))||[],savedMetrics:(null==re?void 0:re.metrics)||[],datasource:re,onChange:e=>{(0,$o.aX)(z,I,{adhoc_filters:e}),ne(),tt()},label:(0,x.tZ)("span",null,(0,x.tZ)(zi,null,(0,d.t)("Pre-filter")),!nt&&(0,x.tZ)(Ai,null))})),we&&(0,x.tZ)(Oi,{name:["filters",I,"time_range"],label:(0,x.tZ)(zi,null,(0,d.t)("Time range")),initialValue:(null==O?void 0:O.time_range)||wo.vM,required:!ot,rules:[{validator:ut}]},(0,x.tZ)(Mo.ZP,{name:"time_range",onChange:e=>{(0,$o.aX)(z,I,{time_range:e}),ne(),tt()}})),nt&&(0,x.tZ)(Oi,{name:["filters",I,"granularity_sqla"],label:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(zi,null,(0,d.t)("Time column")),"\xa0",(0,x.tZ)(mo.V,{placement:"top",tooltip:(0,d.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==O?void 0:O.granularity_sqla},(0,x.tZ)(Ao,{allowClear:!0,form:z,formField:"granularity_sqla",filterId:I,filterValues:e=>!!e.is_dttm,datasetId:Ze,onChange:e=>{(0,$o.aX)(z,I,{granularity_sqla:e}),ne()}})))),"filter_range"!==(null==pe?void 0:pe.filterType)?(0,x.tZ)(Fi,{name:["filters",I,"sortFilter"]},(0,x.tZ)(Po,{initialValue:Ye,title:(0,d.t)("Sort filter values"),onChange:e=>{Je(e||void 0),Ue()}},(0,x.tZ)(Oi,{name:["filters",I,"controlValues","sortAscending"],initialValue:Xe,label:(0,x.tZ)(zi,null,(0,d.t)("Sort type"))},(0,x.tZ)(le.Y.Group,{onChange:e=>{Je(e.target.value)}},(0,x.tZ)(le.Y,{value:!0},(0,d.t)("Sort ascending")),(0,x.tZ)(le.Y,{value:!1},(0,d.t)("Sort descending")))),Re&&(0,x.tZ)(Pi,{name:["filters",I,"sortMetric"],initialValue:null==O?void 0:O.sortMetric,label:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(zi,null,(0,d.t)("Sort Metric")),"\xa0",(0,x.tZ)(mo.V,{placement:"top",tooltip:(0,d.t)("If a metric is specified, sorting will be done based on the metric value")})),"data-test":"field-input"},(0,x.tZ)(de.Ph,{allowClear:!0,ariaLabel:(0,d.t)("Sort metric"),name:"sortMetric",options:Y.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:e=>{void 0!==e&&((0,$o.aX)(z,I,{sortMetric:e}),ne())}})))):(0,x.tZ)(Fi,{name:["filters",I,"rangeFilter"]},(0,x.tZ)(Po,{initialValue:Ge,title:(0,d.t)("Single Value"),onChange:e=>{et(e?To.c.Exact:void 0),Ue()}},(0,x.tZ)(Oi,{name:["filters",I,"controlValues","enableSingleValue"],initialValue:Ke,label:(0,x.tZ)(zi,null,(0,d.t)("Single value type"))},(0,x.tZ)(le.Y.Group,{onChange:e=>et(e.target.value)},(0,x.tZ)(le.Y,{value:To.c.Minimum},(0,d.t)("Minimum")),(0,x.tZ)(le.Y,{value:To.c.Exact},(0,d.t)("Exact")),(0,x.tZ)(le.Y,{value:To.c.Maximum},(0,d.t)("Maximum"))))))),(0,x.tZ)(So.Z.Panel,{forceRender:!0,header:Ui.settings.name,key:`${I}-${Ui.settings.key}`},(0,x.tZ)(Ii,{name:["filters",I,"description"],initialValue:null==O?void 0:O.description,label:(0,x.tZ)(zi,null,(0,d.t)("Description"))},(0,x.tZ)($e.Kx,null)),(0,x.tZ)(Fi,{name:["filters",I,"defaultValueQueriesData"],hidden:!0,initialValue:null}),"filter_textinput"!==(null==pe?void 0:pe.filterType)&&(0,x.tZ)(Fi,{name:["filters",I,"defaultValue"]},(0,x.tZ)(Po,{checked:Be,disabled:Ae||it,initialValue:Be,title:(0,d.t)("Filter has default value"),tooltip:je,onChange:e=>{He(e),e||(0,$o.aX)(z,I,{defaultDataMask:null}),Ue()}},!W&&(0,x.tZ)(Pi,{name:["filters",I,"defaultDataMask"],initialValue:at,"data-test":"default-input",label:(0,x.tZ)(zi,null,(0,d.t)("Default Value")),required:Be,rules:[{validator:()=>{var e,t;if(null!=pe&&null!=(e=pe.defaultDataMask)&&null!=(t=e.filterState)&&t.value){const e=z.getFieldsError();return B((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return B((e=>e.includes(I)?e:[...e,I])),Promise.reject(new Error((0,d.t)("Default value is required")))}}]},G?(0,x.tZ)(Zo.Z,{title:(0,d.t)("Cannot load filter"),body:G,level:"error"}):Qe?(0,x.tZ)(Ni,null,(0,x.tZ)(Ko,{setDataMask:e=>{var t,n;Tr()(null==at||null==(t=at.filterState)?void 0:t.value,null==e||null==(n=e.filterState)?void 0:n.value)||Ue(),(0,$o.aX)(z,I,{defaultDataMask:e}),z.validateFields([["filters",I,"defaultDataMask"]]),ne()},hasDefaultValue:Be,filterId:I,hasDataset:Se,form:z,formData:Le,enableNoResults:Ee}),Se&&Ze&&(0,x.tZ)(ce.u,{title:(0,d.t)("Refresh the default values")},(0,x.tZ)($i,{onClick:()=>Ne(!0)}))):(0,d.t)('Fill all required fields to enable "Default Value"')))),Object.keys(ke).sort(((e,t)=>_i.indexOf(e)-_i.indexOf(t))).map((e=>ke[e].element))))),(0,x.tZ)(Ei,{tab:qi.scoping.name,key:qi.scoping.key,forceRender:!0},(0,x.tZ)(di,{updateFormValues:Ve,pathToFormValue:["filters",I],forceUpdate:ne,filterScope:null==O?void 0:O.scope,formFilterScope:null==pe?void 0:pe.scope,formFilterScopeBindDatasetAndColumn:null==pe?void 0:pe.scopeBindDatasetAndColumn,formScopingType:null==pe?void 0:pe.scoping,filterselectmode:null==ue?void 0:ue.filterselectmode,initiallyExcludedCharts:ht,handSelectColumn:(e,t)=>{var n,r;const o=(null==(n=z.getFieldValue("filters"))||null==(r=n[I])?void 0:r.scopeBindDatasetAndColumn)||[];if("remove"===(null==t?void 0:t.type)){const t=o.filter((t=>t.nodeId!==e.nodeId));return void Ve({scopeBindDatasetAndColumn:t})}const i=At()(o);(o.map((e=>null==e?void 0:e.nodeTreeId))||[]).includes(null==e?void 0:e.nodeTreeId)?i.forEach((t=>{(null==t?void 0:t.nodeTreeId)===(null==e?void 0:e.nodeTreeId)&&(t.tableColumnChoose=e.tableColumnChoose)})):i.push(e),Ve({scopeBindDatasetAndColumn:i})},fitd:ft})))},Xi=a.memo((0,a.forwardRef)(Yi)),Qi=y.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,Ji=(0,y.iK)(Re.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,ea=((0,y.iK)(Re.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,(0,y.iK)(Re.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,y.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`),ta=y.iK.div`
  ${()=>"padding: 0;"}
`,na={[(0,d.t)("Dynamic Column")]:(0,d.t)("Dynamic Column")},ra=e=>{const{filterId:t,filterToEdit:n,removedFilters:r,form:i,restoreFilter:s,isActive:l,fromModule:u,filterType:c,addNewFilterId:p}=e,h=!!r[t],[f,g]=(0,a.useState)(null),m=(0,$o.NW)(l),v=i.getFieldValue("filters"),b=null==v?void 0:v[t],y=(0,a.useMemo)((()=>{}),[]),C=b||f||y,w=(0,vo.Z)().items,S=Object.entries(w).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(bo.cg.NATIVE_FILTER)})).map((([e])=>e)),Z=(0,o.v9)((({datasources:e})=>e)),k=(0,a.useMemo)((()=>Object.values(Z).some((e=>(0,$o.Ns)(e)))),[Z]),M=(0,a.useCallback)((()=>{i.setFields([{name:"changed",value:!0}])}),[i]),D=(0,a.useCallback)((e=>{(0,$o.aX)(i,t,e),M()}),[t,i,M]),E="filter-chart"===u||"filter-edit-chart"===u;(0,a.useEffect)((()=>{c&&p&&((0,$o.aX)(i,p,{filterType:c,defaultDataMask:null,column:null}),m()),E&&p&&((0,$o.aX)(i,p,{addFromModule:u}),m())}),[c,p,u]),fi(i,t),(0,a.useEffect)((()=>{h&&g(b)}),[h]),(0,a.useEffect)((()=>{f&&!h&&((0,$o.aX)(i,t,f),g(null))}),[b,t,i,h,f]);const R=["filters",t],T="dynamic_column"===c,_=(0,o.v9)((e=>e)),I=(0,o.v9)((({dashboardLayout:{present:e}})=>e)),O=[];if(T&&_.charts){var P;const e=(null==_||null==(P=_.nativeFilters)?void 0:P.datasetScopeInfo)||[];for(const t in _.charts){var z;const n=[],r=_.charts[t];if(["table","pivot_table_v2"].includes(null==r||null==(z=r.form_data)?void 0:z.viz_type)){var F,N,$,L;const o=null==(F=r.form_data)?void 0:F.datasource.split("__")[0],i=(null==(N=e.filter((e=>`${null==e?void 0:e.id}`===o)))?void 0:N[0])||{},a="pivot_table_v2"==(null==r||null==($=r.form_data)?void 0:$.viz_type)?r.latestQueryFormData.groupbyRows:null==(L=r.latestQueryFormData)?void 0:L.groupby;null==a||a.forEach((e=>{const t=null==i?void 0:i.columns.find((t=>t.column_name==e));n.push({label:t.verbose_name||t.column_name,value:t.column_name})}));const s=Object.values(I).filter((e=>{var n;return`${null==(n=e.meta)?void 0:n.chartId}`===t})),l=i.id,d=i.table_name;O.push({nodeId:s[0].id,nodeTreeId:t,tableIdChoose:l,tableNameChoose:d,tableColumnChoose:n,scopeFilterId:R[1]})}}}return h?(0,x.tZ)(hi,{onClick:()=>s(t)}):(0,x.tZ)(ta,null,(0,x.tZ)(Qi,null,(0,x.tZ)(Ji,{name:["filters",t,"type"],hidden:!0,initialValue:Nr.BE.NATIVE_FILTER},(0,x.tZ)($e.II,null)),E&&(0,x.tZ)(Ji,{name:["filters",t,"addFromModule"],hidden:!0,initialValue:u},(0,x.tZ)($e.II,null)),(0,x.tZ)(Ji,{name:["filters",t,"name"],label:(0,x.tZ)(ea,null,(0,d.t)("Filter name")),initialValue:null==n?void 0:n.name,rules:[{required:!h,message:(0,d.t)("Name is required")}]},(0,x.tZ)($e.II,ma("name-input"))),(0,x.tZ)(Ji,fe()({name:["filters",t,"filterType"],rules:[{required:!h,message:(0,d.t)("Name is required")}],initialValue:(null==n?void 0:n.filterType)||"filter_select",label:(0,x.tZ)(ea,null,(0,d.t)("Filter Type"))},ma("filter-type")),(0,x.tZ)(de.Ph,{ariaLabel:(0,d.t)("Filter type"),disabled:!0,options:S.map((e=>{var t,n,r;const o=null==(t=w[e])?void 0:t.value.name,i=o?na[o]:void 0,a=1===(null==(n=$o.Qc[e])?void 0:n.length)&&(null==(r=$o.Qc[e])?void 0:r.includes(xo.Z.TEMPORAL))&&!k;return{value:e,label:i||o,customLabel:a?(0,x.tZ)(ce.u,{title:(0,d.t)("Datasets do not contain a temporal column")},i||o):void 0,disabled:a}}))}))),(0,x.tZ)(di,{updateFormValues:D,pathToFormValue:R,forceUpdate:m,filterScope:null==n?void 0:n.scope,formFilterScope:null==C?void 0:C.scope,formFilterScopeBindDatasetAndColumn:null==C?void 0:C.scopeBindDatasetAndColumn,scopeBindDatasetAndColumn:O,formScopingType:null==C?void 0:C.scoping,filterselectmode:!0,initiallyExcludedCharts:[],handSelectColumn:(e,n)=>{var r,o;const a=(null==(r=i.getFieldValue("filters"))||null==(o=r[t])?void 0:o.scopeBindDatasetAndColumn)||[];if("remove"===(null==n?void 0:n.type)){const t=a.filter((t=>t.nodeId!=e.nodeId));return void D({scopeBindDatasetAndColumn:t})}const s=At()(a);Array.from(new Set(a.map((e=>Number(null==e?void 0:e.nodeTreeId)))||[])).includes(Number(null==e?void 0:e.nodeTreeId))?s.forEach((t=>{(null==t?void 0:t.nodeTreeId)==(null==e?void 0:e.nodeTreeId)&&(t.tableColumnChoose=e.tableColumnChoose)})):s.push(e),D({scopeBindDatasetAndColumn:s})},filterType:c}))},oa=a.memo((0,a.forwardRef)(ra));var ia={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},aa={name:"zjik7",styles:"display:flex"};function sa({title:e,onConfirm:t,onDismiss:n,children:r}){return(0,x.tZ)(Ee.Z,{closable:!1,type:"warning",key:"alert",message:e,css:ia,description:r,action:(0,x.tZ)("div",{css:aa},(0,x.tZ)(se.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:n},(0,d.t)("Keep editing")),(0,x.tZ)(se.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:t},(0,d.t)("Yes, cancel")))})}const la=({canSave:e=!0,onCancel:t,handleSave:n,onDismiss:r,onConfirmCancel:o,saveAlertVisible:i})=>i?(0,x.tZ)(sa,{key:"cancel-confirm",title:(0,d.t)("There are unsaved changes."),onConfirm:o,onDismiss:r},(0,d.t)("Are you sure you want to cancel?")):(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{key:"cancel",buttonStyle:"secondary","data-test":"native-filter-modal-cancel-button",onClick:t},(0,d.t)("Cancel")),(0,x.tZ)(se.Z,{disabled:!e,key:"submit",buttonStyle:"primary",onClick:n,"data-test":"native-filter-modal-save-button"},(0,d.t)("Save")));var da=n(741427);var ua=n(392242);const ca=y.iK.div`
  ${({theme:e})=>`\n    padding: ${4*e.gridUnit}px;\n  `}
`,pa=({componentId:e,divider:t})=>(0,x.tZ)(ca,null,(0,x.tZ)(Re.xJ,{initialValue:t?t.title:"",label:(0,d.t)("Title"),name:["filters",e,"title"],rules:[{required:!0,message:(0,d.t)("Title is required"),whitespace:!0}]},(0,x.tZ)($e.II,null)),(0,x.tZ)(Re.xJ,{initialValue:t?t.description:"",label:(0,d.t)("Description"),name:["filters",e,"description"]},(0,x.tZ)($e.Kx,{rows:4})),(0,x.tZ)(Re.xJ,{hidden:!0,name:["filters",e,"type"],initialValue:Nr.BE.DIVIDER})),ha=(0,y.iK)(zr.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,fa=y.iK.div`
  display: flex;
  height: 500px;
  flex-direction: row;
  .filters-list {
    width: ${({theme:e})=>50*e.gridUnit}px;
    overflow: auto;
  }
`,ga=(0,y.iK)(de.qz)`
  width: 100%;
`,ma=Fr("filters-config-modal"),va=["filter_select"],ba=["filter_timegrain"],ya=[],xa={},Ca={filters:{}};function wa(e,t){const{isOpen:n,initialFilterId:r,createNewOnOpen:o,onSave:i,onCancel:s,fromModule:l,initSelectValueFilter:u,callBackFilterId:c}=e,[p]=de.qz.useForm();(0,a.useImperativeHandle)(t,(()=>({deleteFilterByFilterid:e=>{W(e)}})));const h=(0,a.useRef)(),f=Lr(),g=Br(),[m,v]=(0,a.useState)(u),[b,y]=(0,a.useState)(""),[C,w]=(0,a.useState)(ya),[S,k]=(0,a.useState)(xa),[M,D]=(0,a.useState)(!1),E=(0,a.useMemo)((()=>Ir()([...(0,ua.QN)(f),...C]).filter((e=>{var t;return!S[e]||(null==(t=S[e])?void 0:t.isPending)}))),[f,C,S]),R=null!=r?r:E[0],[T,_]=(0,a.useState)(R),[I,O]=(0,a.useState)(ya),[P,z]=(0,a.useState)(Ca),F=C.filter((e=>!S[e])),N=(0,a.useCallback)((e=>{const t=S[e];null!=t&&t.isPending&&clearTimeout(t.timerId),k((t=>({...t,[e]:null})))}),[S]),$=(0,a.useMemo)((()=>Object.keys(g)),[g]),[L,B]=(0,a.useState)($),[A,j]=(0,a.useState)([R]),H=e=>[`${e}-${Ui.configuration.key}`,`${e}-${Ui.settings.key}`],[q,U]=(0,a.useState)(H(R)),V=(0,a.useCallback)((e=>{const t=(0,ua.W6)(e);w([...C,t]),_(t),D(!1),B([...L,t]),U(H(t)),y(t),null==c||c(t)}),[C,L,_,B,w]);((e,t,n)=>{const r=(0,da.D)(e);(0,a.useEffect)((()=>{n&&e&&!r&&t(Nr.BE.NATIVE_FILTER)}),[n,e,r,t])})(n,V,o),((e,t,n,r)=>{(0,a.useEffect)((()=>{const o=e[t];if(o&&!o.isPending){const o=n.flat().find((n=>!e[n]&&n!==t));o&&r(o)}}),[t,e,n,r])})(S,T,L,_);const W=(0,ua.EJ)(k,B,D),G=(e=!1)=>{w(ya),_(R),k(xa),D(!1),z(Ca),O(ya),E.length>0&&U(H(E[0])),e||B($),j([R]),p.resetFields(["filters"]),p.setFieldsValue({changed:!1})},K=(0,a.useCallback)((e=>{const t=P.filters[e],n=g[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||(0,d.t)("[untitled]")}),[g,P.filters]),Y=(0,a.useCallback)(((e,t=va)=>{var n;if(S[e])return!1;const r=(null==(n=p.getFieldValue("filters"))?void 0:n[e])||g[e];return r&&"filterType"in r&&t.includes(r.filterType)}),[g,p,S]),X=(0,a.useCallback)(((e,t)=>E.filter((t=>t!==e)).filter((e=>Y(e,t))).map((e=>({label:K(e),value:e})))),[Y,E,K]),Q=(0,a.useCallback)((()=>{const e=p.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!t.includes(n)&&t.push(n)})),!t.length&&I.length>0?O(ya):t.length>0&&!Tr()(Er()(I),Er()(t))&&O(t)}),[p,I]),J=async()=>{const e=await(0,ua.G$)(p,T,_);Q(),e?((e=>{Object.keys(g).forEach((e=>{const t=g[e];if(!("cascadeParentIds"in t))return;const{cascadeParentIds:n}=t;n&&(t.cascadeParentIds=n.filter((e=>Y(e))))}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{const n=t[e];if(!("dependencies"in n))return;const{dependencies:r}=n;r&&(n.dependencies=r.filter((e=>Y(e))))}))})(e),(0,ua.GA)(g,L,S,i,e)(),G(!0)):h.current.changeTab("configuration")},ee=()=>{G(),s()},te=()=>{const e=p.getFieldValue("changed"),t=L.length!==$.length||L.some(((e,t)=>e!==$[t]));F.length>0||p.isFieldsTouched()||e||t?D(!0):ee()},ne=(0,a.useCallback)((()=>{const e=new Map,t=p.getFieldValue("filters");return t&&Object.keys(t).forEach((n=>{const r=t[n],o=g[n];let i=[];r&&"dependencies"in r?i=[...r.dependencies]:null!=o&&o.cascadeParentIds&&(i=[...o.cascadeParentIds]),e.set(n,i)})),e}),[g,p]),re=(0,a.useCallback)((()=>{const e=ne();E.filter((e=>!S[e])).forEach((t=>{const n={name:["filters",t,"dependencies"],errors:(0,ua.uh)(e,t)?[(0,d.t)("Cyclic dependency detected")]:[]};p.setFields([n])})),Q()}),[ne,E,p,Q,S]),oe=(0,a.useCallback)((e=>{const t=ne(),n=L.filter((t=>t!==e&&Y(t))),r=n.find((n=>{const r=t.get(e)||[];return r.push(n),!(0,ua.uh)(t,e)||(r.pop(),!1)}));return r||n[0]}),[ne,Y,L]),ie=(0,a.useMemo)((()=>Lt()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),r=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||r)&&z(t),D(!1),Q()}),Or.M)),[Q]);(0,a.useEffect)((()=>{Z()(S)||O((e=>e.filter((e=>!S[e]))))}),[S]),(0,a.useEffect)((()=>{A.includes(T)||j([...A,T])}),[T]);const ae=(0,a.useCallback)((e=>U(e)),[U]),se=(0,a.useMemo)((()=>L.map((e=>{if(!A.includes(e))return null;const t=e.startsWith(ua.Ky),n=T===e;return(0,x.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:n?"":"none"}},t?(0,x.tZ)(pa,{componentId:e,divider:g[e]}):"dynamic_column"==m?(0,x.tZ)(oa,{ref:h,form:p,filterId:e,filterToEdit:g[e],removedFilters:S,restoreFilter:N,key:e,isActive:n,fromModule:l,filterType:m,addNewFilterId:b}):(0,x.tZ)(Xi,{ref:h,form:p,filterId:e,filterToEdit:g[e],removedFilters:S,restoreFilter:N,getAvailableFilters:X,key:e,activeFilterPanelKeys:q,handleActiveFilterPanelChange:ae,isActive:n,setErroredFilters:O,validateDependencies:re,getDependencySuggestion:oe,fromModule:l,initSelectValueFilter:m,addNewFilterId:b}))}))),[A,L,T,g,p,S,N,X,q,re,oe,ae]);return(0,x.tZ)(ha,{visible:n,maskClosable:!1,title:(0,d.t)("Add and edit filters"),width:"50%",destroyOnClose:!0,onCancel:te,onOk:J,centered:!0,"data-test":"filter-modal",footer:(0,x.tZ)(la,{onDismiss:()=>D(!1),onCancel:te,handleSave:J,canSave:!I.length,saveAlertVisible:M,onConfirmCancel:ee})},(0,x.tZ)(Pr.Z,null,(0,x.tZ)(fa,null,(0,x.tZ)(ga,{form:p,onValuesChange:ie,layout:"vertical"},(0,x.tZ)(go,{erroredFilters:I,onRemove:W,onAdd:V,onChange:e=>{v(g[e].filterType),_(e),U(H(e))},getFilterTitle:K,currentFilterId:T,removedFilters:S,restoreFilter:N,onRearrange:(e,t)=>{const n=[...L],r=n.splice(e,1)[0];n.splice(t,0,r),B(n)},filters:L,fromModule:l},se)))))}const Sa=a.memo((0,a.forwardRef)(wa));var Za;function ka(){return ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ka.apply(this,arguments)}const Ma=function(e){return a.createElement("svg",ka({width:22,height:22,viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},e),Za||(Za=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd",strokeLinejoin:"round"},a.createElement("path",{d:"M1 8.895h20v11.052C21 20.53 20.529 21 19.947 21H2.053A1.053 1.053 0 011 19.947V8.895zM1 3.632c0-.582.471-1.053 1.053-1.053h17.894c.582 0 1.053.471 1.053 1.053v5.263H1V3.632z"}),a.createElement("path",{strokeLinecap:"round",d:"M6.789 1v4.211M15.211 1v4.211M13.105 16.789h3.158M5.737 16.789h3.158M13.105 12.579h3.158M5.737 12.579h3.158"}))))};var Da;function Ea(){return Ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ea.apply(this,arguments)}const Ra=function(e){return a.createElement("svg",Ea({width:22,height:22,viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},e),Da||(Da=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd"},a.createElement("path",{strokeLinecap:"round",d:"M1 1.256h20M1 20.744h20M3 17.154v3.59"}),a.createElement("path",{strokeLinejoin:"round",d:"M5 13.051H1v4.103h4zM13 8.949H9v4.102h4zM21 4.846h-4V8.95h4z"}),a.createElement("path",{strokeLinecap:"round",d:"M19 8.949v11.795M3 4.846v.513M3 8.949v.513M10.5 4.846v.513M11 13.051v7.693"}))))};var Ta;function _a(){return _a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_a.apply(this,arguments)}const Ia=function(e){return a.createElement("svg",_a({width:22,height:22,viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},e),Ta||(Ta=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd"},a.createElement("path",{d:"M5.691 5c0 1.105.885 2 1.976 2 1.09 0 1.975-.895 1.975-2s-.884-2-1.975-2C6.576 3 5.69 3.895 5.69 5zM14.58 11c0 1.105.885 2 1.976 2 1.09 0 1.975-.895 1.975-2s-.885-2-1.975-2c-1.091 0-1.976.895-1.976 2zM5.691 17c0 1.105.885 2 1.976 2 1.09 0 1.975-.895 1.975-2s-.884-2-1.975-2c-1.091 0-1.976.895-1.976 2z",strokeLinejoin:"round"}),a.createElement("path",{strokeLinecap:"round",d:"M1.247 17h4.444M9.642 17H21M1.247 5h4.444M9.642 5H21"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M1.247 1v20"}),a.createElement("path",{strokeLinecap:"round",d:"M1.247 11H14.58M18.531 11H21"}))))};var Oa;function Pa(){return Pa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pa.apply(this,arguments)}const za=function(e){return a.createElement("svg",Pa({width:22,height:22,viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},e),Oa||(Oa=a.createElement("g",{transform:"translate(1 1)",fill:"none",fillRule:"evenodd"},a.createElement("rect",{stroke:"currentColor",strokeLinejoin:"round",width:20,height:20,rx:1}),a.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M6.5 5h10M6.5 10h10M6.5 15h10"}),a.createElement("path",{d:"M3.5 6a1 1 0 100-2 1 1 0 000 2zM3.5 11a1 1 0 100-2 1 1 0 000 2zM3.5 16a1 1 0 100-2 1 1 0 000 2z",fill:"currentColor"}))))};var Fa;function Na(){return Na=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Na.apply(this,arguments)}const $a=function(e){return a.createElement("svg",Na({width:22,height:22,viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},e),Fa||(Fa=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd"},a.createElement("path",{d:"M4 21a3 3 0 003-3V1H1v17a3 3 0 003 3z"}),a.createElement("path",{d:"M4 21a3 3 0 003-3v-7.243M4 21a3 3 0 01-3-3V1h6v9.757M4 21h17v-6h-9.757m-9.364 5.121a3 3 0 004.242 0L11.243 15M7 10.757l9.507-9.507.236-.25 4.25 4.25-9.75 9.75",strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.121 20.121L20.993 5.25 16.743 1 7 10.757M11.243 15H21v6H5.25"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.243 15H21v6H5.25"}),a.createElement("path",{d:"M4 21a3 3 0 003-3V1H1v17a3 3 0 003 3z",strokeLinecap:"round",strokeLinejoin:"round"}))))};var La;function Ba(){return Ba=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ba.apply(this,arguments)}const Aa=function(e){return a.createElement("svg",Ba({width:19,height:22,viewBox:"0 0 19 22",xmlns:"http://www.w3.org/2000/svg"},e),La||(La=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd",strokeLinecap:"round"},a.createElement("path",{d:"M12 1H2a1 1 0 00-1 1v18a1 1 0 001 1h14a1 1 0 001-1V9.002",strokeLinejoin:"round"}),a.createElement("path",{d:"M4 8h4M4 13h6"}),a.createElement("path",{strokeLinejoin:"round",d:"M18 2l-5.998 5.998"}))))};var ja;function Ha(){return Ha=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ha.apply(this,arguments)}const qa=function(e){return a.createElement("svg",Ha({width:20,height:14,viewBox:"0 0 20 14",xmlns:"http://www.w3.org/2000/svg"},e),ja||(ja=a.createElement("path",{d:"M17.88 0c-.964 0-1.776.683-2.032 1.623h-3.812C11.776.683 10.964 0 10.004 0 9.04 0 8.228.683 7.972 1.623H.6c-.332 0-.6.286-.6.64 0 .355.268.64.6.64h7.368c.26.94 1.072 1.623 2.032 1.623.964 0 1.776-.683 2.032-1.622h3.812c.26.94 1.072 1.622 2.032 1.622 1.172 0 2.12-1.012 2.12-2.263C20 1.012 19.052 0 17.88 0zM10 3.245c-.508 0-.92-.44-.92-.982s.412-.982.92-.982.92.44.92.982-.412.982-.92.982zm7.88 0c-.508 0-.92-.44-.92-.982s.412-.982.92-.982.92.44.92.982-.412.982-.92.982zm1.52 7.851h-7.368c-.26-.94-1.072-1.622-2.032-1.622-.964 0-1.776.683-2.032 1.622H4.196c-.26-.94-1.072-1.622-2.032-1.622-1.088 0-1.98.87-2.104 1.994a.657.657 0 00-.056.269c0 .098.02.188.056.269C.18 13.129 1.072 14 2.16 14c.964 0 1.776-.683 2.032-1.623h3.772c.26.94 1.072 1.623 2.032 1.623.964 0 1.776-.683 2.032-1.623H19.4c.332 0 .6-.286.6-.64 0-.355-.268-.64-.6-.64zM2.16 12.72c-.508 0-.92-.44-.92-.982s.412-.982.92-.982.92.44.92.982-.412.982-.92.982zm7.84 0c-.508 0-.92-.44-.92-.982s.412-.982.92-.982.92.44.92.982-.412.982-.92.982z",fill:"currentColor",fillRule:"nonzero"})))};var Ua;function Va(){return Va=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Va.apply(this,arguments)}const Wa=function(e){return a.createElement("svg",Va({width:22,height:20,viewBox:"0 0 22 20",xmlns:"http://www.w3.org/2000/svg"},e),Ua||(Ua=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd"},a.createElement("path",{strokeLinecap:"round",d:"M1 1.273h20M1 10h5.5M1 18.727h5.5"}),a.createElement("path",{d:"M14.75 16c2.347 0 4.25-2.076 4.25-4.636s-1.903-4.637-4.25-4.637-4.25 2.076-4.25 4.637c0 2.56 1.903 4.636 4.25 4.636z"}),a.createElement("path",{strokeLinecap:"round",d:"M17.5 14.909l3.5 3.846"}))))};var Ga;function Ka(){return Ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ka.apply(this,arguments)}const Ya=function(e){return a.createElement("svg",Ka({width:22,height:20,viewBox:"0 0 22 20",xmlns:"http://www.w3.org/2000/svg"},e),Ga||(Ga=a.createElement("g",{stroke:"currentColor",fill:"none",fillRule:"evenodd",strokeLinejoin:"round"},a.createElement("path",{strokeLinecap:"round",d:"M8.895 1h4.21v4.164H21v4.163H1V5.164h7.895z"}),a.createElement("path",{d:"M2.579 18.74H19.42V9.372H2.58z"}),a.createElement("path",{strokeLinecap:"round",d:"M6.789 18.686v-3.114M11 18.687v-3.123M15.211 18.686v-3.114M4.684 18.74h12.632"}))))};var Xa;function Qa(){return Qa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Qa.apply(this,arguments)}const Ja=function(e){return a.createElement("svg",Qa({width:24,height:24,viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},e),Xa||(Xa=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",fill:"currentColor",d:"M201.244 336.564v570.944h87.86V336.564h-87.86zm263.521 0v570.944h87.803V336.564h-87.803zm351.324 0h-87.803v570.944h87.803V336.564zm-614.845-219.62v131.76h87.86v-131.76h-87.86zm263.521 0v131.76h87.803v-131.76h-87.803zm263.521 0v131.76h87.803v-131.76h-87.803z"})))},es=((0,kr.cz)(),y.iK.div`
  padding: 10px;

  .reset-margin {
    margin: 5px 5px !important;
    width: 45%;
  }

  .item {
    display: flex;
    flex-wrap: wrap;
  }

  .box-item {
    width: 100%;
    display: inline-flex;
    align-items: center;
    line-height: 1.5715;
    height: 36px;
    text-transform: uppercase;
    -webkit-transition: all 0.3s;
    transition: all 0.3s;
    box-shadow: none;
    border-width: 0;
    border-style: none;
    border-color: transparent;
    border-radius: 4px;
    color: #333;
    background-color: #e9f6f9;

    &:hover {
      background-color: #5d9cec !important;
      color: #fff !important;

      span.anticon {
        color: #fff !important;
      }
    }

    .filter-icon {
      width: 40px;
      text-align: center;
      line-height: 1;
      position: relative;
      font-size: 14px;
    }

    .filter-label {
      padding-right: 4px;
      text-align: left;
      white-space: pre;
      text-overflow: ellipsis;
      font-size: 13px;
    }
  }

  .dragdroppable-row {
    width: 45% !important;
    margin: 5px !important;
    cursor: move;
  }
`),ts="#ECEEFB",ns="#E3F0FF",rs="#E9FFFA",os="#EBF0FC",is={[(0,d.t)("Time filter component")]:[{name:(0,d.t)("Time range"),type:"filter_time",filter_id:Be.Qq,filter_type:"filter_time",source_type:f.hI,bgColor:ts,icon:(0,x.tZ)(Zr.Z,{component:Ma,style:{color:"#6A79DF"}})},{name:(0,d.t)("Time column"),type:"filter_timecolumn",filter_id:Be.Qq,filter_type:"filter_timecolumn",source_type:f.hI,bgColor:ts,icon:(0,x.tZ)(Zr.Z,{component:Ra,style:{color:"#6A79DF"}})},{name:(0,d.t)("Time granularity"),type:"filter_timegrain",filter_id:Be.Qq,filter_type:"filter_timegrain",source_type:f.hI,bgColor:ts,icon:(0,x.tZ)(Zr.Z,{component:Ia,style:{color:"#6A79DF"}})}],[(0,d.t)("Text filter component")]:[{name:(0,d.t)("Text select"),type:"filter_select",filter_id:Be.Qq,filter_type:"filter_select",source_type:f.hI,bgColor:ns,icon:(0,x.tZ)(Zr.Z,{component:za,style:{color:"#4688D6"}})},{name:(0,d.t)("Text search"),type:"filter_textinput",filter_id:Be.Qq,filter_type:"filter_textinput",source_type:f.hI,bgColor:ns,icon:(0,x.tZ)(Zr.Z,{component:Aa,style:{color:"#4688D6"}})},{name:(0,d.t)("Dropdown tree"),type:"select_tree",filter_id:Be.Qq,filter_type:"select_tree",source_type:f.hI,bgColor:ns,icon:(0,x.tZ)(Zr.Z,{component:$a,style:{color:"#4688D6"}})}],[(0,d.t)("Digital filter components")]:[{name:(0,d.t)("Numeric range"),type:"filter_range",filter_id:Be.Qq,filter_type:"filter_range",source_type:f.hI,bgColor:rs,icon:(0,x.tZ)(Zr.Z,{component:qa,style:{color:"#65C9B2"}})}],[(0,d.t)("Button")]:[{name:(0,d.t)("Query button"),type:"submit_btn",filter_id:Be.LX,filter_type:f.kE,source_type:f.kE,bgColor:os,icon:(0,x.tZ)(Zr.Z,{component:Wa,style:{color:"#5277D1"}})},{name:(0,d.t)("Clear button"),type:"clear_btn",filter_id:Be.LX,filter_type:f.GV,source_type:f.GV,bgColor:os,icon:(0,x.tZ)(Zr.Z,{component:Ya,style:{color:"#5277D1"}})}],[(0,d.t)("Table filter component")]:[{name:(0,d.t)("Dynamic column"),type:"dynamic_column",filter_id:Be.Qq,filter_type:"dynamic_column",source_type:f.hI,bgColor:rs,icon:(0,x.tZ)(Zr.Z,{component:Ja,style:{color:"#4688D6"}})}]},as=e=>{const{label:t,className:n}=e,[r,s]=(0,a.useState)(!1),[l,d]=(0,a.useState)(""),[u,c]=(0,a.useState)({}),[p,h]=(0,a.useState)(""),{id:g,parentId:m,deleteComponent:v,updateComponents:b,component:y}=u,{meta:C={}}=y||{},w=((0,a.useContext)(hD),(0,o.I0)()),S=(0,o.v9)((e=>e.dashboardLayout.present)),Z=(0,o.v9)((e=>e.mobileDashboardLayout.present)),k=(0,o.v9)((e=>e.dashboardState)),{layoutMode:M}=k||{},D=(0,o.v9)((e=>e.dashboardState.layoutMode)),E=e=>{c(e)},R=()=>{let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(-300px)"}),400))},T=()=>{let e={};document.getElementById("StyledComponentPanel")&&(e=document.getElementById("StyledComponentPanel"),setTimeout((()=>{e.style.transform="translateX(0px)"}),300))};return(0,x.tZ)(es,null,Object.keys(is).map((e=>{const t=is[e];return D===i.kB.MOBILE&&"\u6309\u94ae"===e?null:(0,x.tZ)("div",null,(0,x.tZ)("div",null,e),(0,x.tZ)("div",{className:"item"},t.map(((e,t)=>(0,x.tZ)(Wn,{component:{type:e.source_type,id:e.filter_id,meta:{addtype:"addtype",getPropsData:E}},parentComponent:{id:Be.D0,type:f.F0},index:0,depth:0,filterDropAction:t=>{(null==e?void 0:e.filter_type)!==f.kE&&(null==e?void 0:e.filter_type)!==f.GV&&(s(!0),d(null==e?void 0:e.type))},present:S,mobilePresent:Z,dispatch:w,editMode:!0},(({dragSourceRef:t})=>(0,x.tZ)("div",{ref:t,onDragEnd:T,onDragStart:R,"data-test":"new-filters",className:"box-item",style:{backgroundColor:e.bgColor}},(0,x.tZ)("div",{className:"filter-icon"},e.icon),(0,x.tZ)("div",{className:"filter-label"},e.name))))))))})),r&&l&&(0,x.tZ)(Sa,{isOpen:r,onSave:async e=>{w(await(0,Mr.RY)(e)),s(!1),d("");const t=(()=>{let e=0;if(Object.keys(null!=Z?Z:{}).length)for(let t in Z)t.indexOf("FILTER_SELECT")>=0&&(e+=1);return e})();null==b||b({[g]:{...y,meta:{...C,filterId:p,order:t}}})},onCancel:()=>{s(!1),d(""),null==v||v(g,m)},callBackFilterId:e=>{h(e)},createNewOnOpen:!0,fromModule:"filter-chart",initSelectValueFilter:l,key:"filters-for-compent"}))};var ss=n(909467),ls=n(166683),ds=n(74401),us=n(771230),cs=n(515746),ps=n(747933),hs=n(432787),fs=n(190484),gs=n(722122),ms=n(295357),vs=n(28991),bs=n(896156),ys=n(428481),xs=n(781253),Cs=n(727678),ws=n(176632),Ss=n(477076),Zs=n(264019),ks=n(580334),Ms=n(75164);function Ds(e,t,n,r){var o=t+n,i=(n-r)/2;if(n>r){if(t>0)return(0,bs.Z)({},e,i);if(t<0&&o<r)return(0,bs.Z)({},e,-i)}else if(t<0||o>r)return(0,bs.Z)({},e,t<0?i:-i);return{}}var Es=a.createContext({previewUrls:new Map,setPreviewUrls:function(){return null},current:null,setCurrent:function(){return null},setShowPreview:function(){return null},setMousePosition:function(){return null},registerImage:null}),Rs=Es.Provider;const Ts=function(e){var t=e.previewPrefixCls,n=void 0===t?"rc-image-preview":t,r=e.children,o=e.icons,i=void 0===o?{}:o,s=(0,a.useState)(new Map),l=(0,ys.Z)(s,2),d=l[0],u=l[1],c=(0,a.useState)(),p=(0,ys.Z)(c,2),h=p[0],f=p[1],g=(0,a.useState)(!1),m=(0,ys.Z)(g,2),v=m[0],b=m[1],y=(0,a.useState)(null),x=(0,ys.Z)(y,2),C=x[0],w=x[1];return a.createElement(Rs,{value:{isPreviewGroup:!0,previewUrls:d,setPreviewUrls:u,current:h,setCurrent:f,setShowPreview:b,setMousePosition:w,registerImage:function(e,t){return u((function(n){return new Map(n).set(e,t)})),function(){u((function(t){var n=new Map(t);return n.delete(e)?n:t}))}}}},r,a.createElement(Ps,{"aria-hidden":!v,visible:v,prefixCls:n,onClose:function(e){e.stopPropagation(),b(!1),w(null)},mousePosition:C,src:d.get(h),icons:i}))};var _s=a.useState,Is=a.useEffect,Os={x:0,y:0};const Ps=function(e){var t=e.prefixCls,n=e.src,r=e.alt,o=e.onClose,i=(e.afterClose,e.visible),s=e.icons,l=void 0===s?{}:s,d=(0,xs.Z)(e,["prefixCls","src","alt","onClose","afterClose","visible","icons"]),u=l.rotateLeft,c=l.rotateRight,p=l.zoomIn,h=l.zoomOut,f=l.close,g=l.left,m=l.right,v=_s(1),y=(0,ys.Z)(v,2),x=y[0],C=y[1],w=_s(0),S=(0,ys.Z)(w,2),Z=S[0],k=S[1],M=function(e){var t=a.useRef(null),n=a.useState(e),r=(0,ys.Z)(n,2),o=r[0],i=r[1],s=a.useRef([]);return a.useEffect((function(){return function(){return t.current&&Ms.Z.cancel(t.current)}}),[]),[o,function(e){null===t.current&&(s.current=[],t.current=(0,Ms.Z)((function(){i((function(e){var n=e;return s.current.forEach((function(e){n=(0,vs.Z)((0,vs.Z)({},n),e)})),t.current=null,n}))}))),s.current.push(e)}]}(Os),D=(0,ys.Z)(M,2),E=D[0],R=D[1],T=a.useRef(),_=a.useRef({originX:0,originY:0,deltaX:0,deltaY:0}),I=a.useState(!1),O=(0,ys.Z)(I,2),P=O[0],z=O[1],F=a.useContext(Es),N=F.previewUrls,$=F.current,L=F.isPreviewGroup,B=F.setCurrent,A=N.size,j=Array.from(N.keys()),H=j.indexOf($),q=L?N.get($):n,U=L&&A>1,V=a.useState({wheelDirection:0}),W=(0,ys.Z)(V,2),G=W[0],K=W[1],Y=function(){C((function(e){return e+1})),R(Os)},X=function(){x>1&&C((function(e){return e-1})),R(Os)},Q=b()((0,bs.Z)({},"".concat(t,"-moving"),P)),J="".concat(t,"-operations-operation"),ee="".concat(t,"-operations-icon"),te=[{icon:f,onClick:o,type:"close"},{icon:p,onClick:Y,type:"zoomIn"},{icon:h,onClick:X,type:"zoomOut",disabled:1===x},{icon:c,onClick:function(){k((function(e){return e+90}))},type:"rotateRight"},{icon:u,onClick:function(){k((function(e){return e-90}))},type:"rotateLeft"}],ne=function(){if(i&&P){var e=T.current.offsetWidth*x,t=T.current.offsetHeight*x,n=(0,Cs.os)(T.current),r=n.left,o=n.top,a=Z%180!==0;z(!1);var s=function(e,t,n,r){var o=(0,Cs.g1)(),i=o.width,a=o.height,s=null;return e<=i&&t<=a?s={x:0,y:0}:(e>i||t>a)&&(s=(0,vs.Z)((0,vs.Z)({},Ds("x",n,e,i)),Ds("y",r,t,a))),s}(a?t:e,a?e:t,r,o);s&&R((0,vs.Z)({},s))}},re=function(e){i&&P&&R({x:e.pageX-_.current.deltaX,y:e.pageY-_.current.deltaY})},oe=function(e){if(i){e.preventDefault();var t=e.deltaY;K({wheelDirection:t})}};return Is((function(){var e=G.wheelDirection;e>0?X():e<0&&Y()}),[G]),Is((function(){var e,t,n=(0,Zs.Z)(window,"mouseup",ne,!1),r=(0,Zs.Z)(window,"mousemove",re,!1),o=(0,Zs.Z)(window,"wheel",oe,{passive:!1});try{window.top!==window.self&&(e=(0,Zs.Z)(window.top,"mouseup",ne,!1),t=(0,Zs.Z)(window.top,"mousemove",re,!1))}catch(e){(0,ks.Kp)(!1,"[rc-image] ".concat(e))}return function(){n.remove(),r.remove(),o.remove(),e&&e.remove(),t&&t.remove()}}),[i,P]),a.createElement(Ss.Z,(0,gs.Z)({},d,{transitionName:"zoom",maskTransitionName:"fade",closable:!1,keyboard:!0,prefixCls:t,onClose:o,afterClose:function(){C(1),k(0),R(Os)},visible:i,wrapClassName:Q}),a.createElement("ul",{className:"".concat(t,"-operations")},te.map((function(e){var n=e.icon,r=e.onClick,o=e.type,i=e.disabled;return a.createElement("li",{className:b()(J,(0,bs.Z)({},"".concat(t,"-operations-operation-disabled"),!!i)),onClick:r,key:o},a.isValidElement(n)?a.cloneElement(n,{className:ee}):n)}))),a.createElement("div",{className:"".concat(t,"-img-wrapper"),style:{transform:"translate3d(".concat(E.x,"px, ").concat(E.y,"px, 0)")}},a.createElement("img",{onMouseDown:function(e){e.preventDefault(),e.stopPropagation(),_.current.deltaX=e.pageX-E.x,_.current.deltaY=e.pageY-E.y,_.current.originX=E.x,_.current.originY=E.y,z(!0)},ref:T,className:"".concat(t,"-img"),src:q,alt:r,style:{transform:"scale3d(".concat(x,", ").concat(x,", 1) rotate(").concat(Z,"deg)")}})),U&&a.createElement("div",{className:b()("".concat(t,"-switch-left"),(0,bs.Z)({},"".concat(t,"-switch-left-disabled"),0===H)),onClick:function(e){e.preventDefault(),e.stopPropagation(),H>0&&B(j[H-1])}},g),U&&a.createElement("div",{className:b()("".concat(t,"-switch-right"),(0,bs.Z)({},"".concat(t,"-switch-right-disabled"),H===A-1)),onClick:function(e){e.preventDefault(),e.stopPropagation(),H<A-1&&B(j[H+1])}},m))};var zs=0,Fs=function(e){var t=e.src,n=e.alt,r=e.onPreviewClose,o=e.prefixCls,i=void 0===o?"rc-image":o,s=e.previewPrefixCls,l=void 0===s?"".concat(i,"-preview"):s,d=e.placeholder,u=e.fallback,c=e.width,p=e.height,h=e.style,f=e.preview,g=void 0===f||f,m=e.className,v=e.onClick,y=e.wrapperClassName,x=e.wrapperStyle,C=e.crossOrigin,w=e.decoding,S=e.loading,Z=e.referrerPolicy,k=e.sizes,M=e.srcSet,D=e.useMap,E=(0,xs.Z)(e,["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","wrapperClassName","wrapperStyle","crossOrigin","decoding","loading","referrerPolicy","sizes","srcSet","useMap"]),R=d&&!0!==d,T="object"===(0,fs.Z)(g)?g:{},_=T.src,I=T.visible,O=void 0===I?void 0:I,P=T.onVisibleChange,z=void 0===P?r:P,F=T.getContainer,N=void 0===F?void 0:F,$=T.mask,L=T.icons,B=null!==_&&void 0!==_?_:t,A=void 0!==O,j=(0,ws.Z)(!!O,{value:O,onChange:z}),H=(0,ys.Z)(j,2),q=H[0],U=H[1],V=(0,a.useState)(R?"loading":"normal"),W=(0,ys.Z)(V,2),G=W[0],K=W[1],Y=(0,a.useState)(null),X=(0,ys.Z)(Y,2),Q=X[0],J=X[1],ee="error"===G,te=a.useContext(Es),ne=te.isPreviewGroup,re=te.setCurrent,oe=te.setShowPreview,ie=te.setMousePosition,ae=te.registerImage,se=a.useState((function(){return zs+=1})),le=(0,ys.Z)(se,1)[0],de=g&&!ee,ue=function(){K("normal")};a.useEffect((function(){if(!ne)return function(){};var e=ae(le,B);return de||e(),e}),[B,de]);var ce=b()(i,y,(0,bs.Z)({},"".concat(i,"-error"),ee)),pe=ee&&u?u:B,he={crossOrigin:C,decoding:w,loading:S,referrerPolicy:Z,sizes:k,srcSet:M,useMap:D,alt:n,className:b()("".concat(i,"-img"),(0,bs.Z)({},"".concat(i,"-img-placeholder"),!0===d),m),style:(0,vs.Z)({height:p},h)};return a.createElement(a.Fragment,null,a.createElement("div",(0,gs.Z)({},E,{className:ce,onClick:g&&!ee?function(e){if(!A){var t=(0,Cs.os)(e.target),n=t.left,r=t.top;ne?(re(le),ie({x:n,y:r})):J({x:n,y:r})}ne?oe(!0):U(!0),v&&v(e)}:v,style:(0,vs.Z)({width:c,height:p},x)}),a.createElement("img",(0,gs.Z)({},he,{ref:function(e){"loading"===G&&(null===e||void 0===e?void 0:e.complete)&&(e.naturalWidth||e.naturalHeight)&&ue()}},ee&&u?{src:u}:{onLoad:ue,onError:function(){K("error")},src:t})),"loading"===G&&a.createElement("div",{"aria-hidden":"true",className:"".concat(i,"-placeholder")},d),$&&de&&a.createElement("div",{className:"".concat(i,"-mask")},$)),!ne&&de&&a.createElement(Ps,{"aria-hidden":!q,visible:q,prefixCls:l,onClose:function(e){e.stopPropagation(),U(!1),A||J(null)},mousePosition:Q,src:pe,alt:n,getContainer:N,icons:L}))};Fs.PreviewGroup=Ts,Fs.displayName="Image";const Ns=Fs;var $s=n(540378);const Ls={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z"}},{tag:"path",attrs:{d:"M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z"}}]},name:"rotate-left",theme:"outlined"};var Bs=n(406445),As=function(e,t){return a.createElement(Bs.Z,(0,vs.Z)((0,vs.Z)({},e),{},{ref:t,icon:Ls}))};As.displayName="RotateLeftOutlined";const js=a.forwardRef(As);const Hs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z"}},{tag:"path",attrs:{d:"M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z"}}]},name:"rotate-right",theme:"outlined"};var qs=function(e,t){return a.createElement(Bs.Z,(0,vs.Z)((0,vs.Z)({},e),{},{ref:t,icon:Hs}))};qs.displayName="RotateRightOutlined";const Us=a.forwardRef(qs);const Vs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-in",theme:"outlined"};var Ws=function(e,t){return a.createElement(Bs.Z,(0,vs.Z)((0,vs.Z)({},e),{},{ref:t,icon:Vs}))};Ws.displayName="ZoomInOutlined";const Gs=a.forwardRef(Ws);const Ks={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-out",theme:"outlined"};var Ys=function(e,t){return a.createElement(Bs.Z,(0,vs.Z)((0,vs.Z)({},e),{},{ref:t,icon:Ks}))};Ys.displayName="ZoomOutOutlined";const Xs=a.forwardRef(Ys);var Qs=n(154549),Js=n(667724),el=n(508812),tl=n(65632),nl=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},rl={rotateLeft:a.createElement(js,null),rotateRight:a.createElement(Us,null),zoomIn:a.createElement(Gs,null),zoomOut:a.createElement(Xs,null),close:a.createElement(Qs.Z,null),left:a.createElement(Js.Z,null),right:a.createElement(el.Z,null)};var ol=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},il=function(e){var t=e.prefixCls,n=e.preview,r=ol(e,["prefixCls","preview"]),o=(0,(0,a.useContext)(tl.E_).getPrefixCls)("image",t),i=(0,a.useContext)(tl.E_).locale,s=(void 0===i?$s.Z:i).Image||$s.Z.Image,l=a.useMemo((function(){return!1===n?n:(0,gs.Z)({mask:a.createElement("div",{className:"".concat(o,"-mask-info")},a.createElement(ms.Z,null),null===s||void 0===s?void 0:s.preview),icons:rl},"object"===(0,fs.Z)(n)?n:null)}),[n,s]);return a.createElement(Ns,(0,gs.Z)({prefixCls:o,preview:l},r))};il.PreviewGroup=function(e){var t=e.previewPrefixCls,n=nl(e,["previewPrefixCls"]),r=(0,a.useContext(tl.E_).getPrefixCls)("image-preview",t);return a.createElement(Ns.PreviewGroup,(0,gs.Z)({previewPrefixCls:r,icons:rl},n))};const al=il;var sl=n(213958),ll=n(624225),dl=n(135855);const ul=({mobileDashboardLayout:e,dashboardInfo:t,nativeFilters:n})=>{const r=null==e?void 0:e.present,o=[],i=[];if(Object.keys(null!=r?r:{}).length){let e=0;for(let t in r)if(t.indexOf("FILTER_SELECT")>=0){var a,s,l;const n=r[t],d=n.parents;e+=1,o.push({currentId:n.id,filterId:null==(a=n.meta)?void 0:a.filterId,order:(null==(s=n.meta)?void 0:s.order)||e,parentsId:d[d.length-1]}),i.push(null==(l=n.meta)?void 0:l.filterId)}}let d={};if(t){const{metadata:e}=t,[n,r,o,i]=[null==e?void 0:e.background_filter_color,null==e?void 0:e.background_filter_image,null==e?void 0:e.background_filter_type,null==e?void 0:e.default_filter_condition_number];d={...d,layoutType:(null==e?void 0:e.layout_type)||"grid",filterBgColor:n,filterBgImage:r,filterBgType:o,defaultFilterConditionNumber:null!=i?i:3}}const u=function(e,t){const n=[];for(let r=0;r<e.length;r++){const o=e[r];for(let e=0;e<t.length;e++){const r=t[e];o.filterId===r.id&&n.push({...o,name:r.name})}}return n}(o,Object.values((null==n?void 0:n.filters)||{}));return{presentItems:cl(o),presentFilterIds:i,presentMenuItems:cl(u),...d}};function cl(e){return null!=e&&e.length?e.sort(((e,t)=>(null==e?void 0:e.order)-(null==t?void 0:t.order))):[]}const pl=[2,4,6,8,10,12,14,16,18,20].map((e=>({value:e,label:e}))),hl=[{value:"normalBrowser",label:"\u901a\u7528\u684c\u9762\u6d4f\u89c8\u5668(1366*658)"},{value:"HDBrowser",label:"\u9ad8\u6e05\u5c4f\u6d4f\u89c8\u5668(1280*610)"},{value:"superHDBrowser",label:"\u8d85\u6e05\u5c4f\u6d4f\u89c8\u5668(1920*970)"},{value:"normal",label:"\u901a\u7528\u684c\u9762(1366*768)"},{value:"HD",label:"\u9ad8\u6e05\u5c4f(1280*720)"},{value:"superHD",label:"\u8d85\u6e05\u5c4f(1920*1080)"},{value:"custom",label:"\u81ea\u5b9a\u4e49"}],fl={modeValue:"auto",sizeKey:"normalBrowser"},gl=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)({normalBrowser:{width:1366,height:658},HDBrowser:{width:1280,height:610},superHDBrowser:{width:1920,height:970},normal:{width:1366,height:768},HD:{width:1280,height:720},superHD:{width:1920,height:1080},custom:{}}),[r,s]=(0,a.useState)(0),[l,u]=(0,a.useState)("color"),[c,p]=(0,a.useState)("color"),[h,f]=(0,a.useState)(""),[g,m]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),[y,C]=(0,a.useState)(""),[w,S]=(0,a.useState)("#ccc"),[Z,k]=(0,a.useState)("rgba(255,255,255,1)"),[M,D]=(0,a.useState)(3),[E,R]=(0,a.useState)("SimHei"),[T,_]=(0,a.useState)(16),[I,O]=(0,a.useState)(400),[P,z]=(0,a.useState)("rgba(0,0,0,8)"),F=((0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),(0,o.v9)((e=>e.dashboardState.viewType)),(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC}))),{mobileDashboardLayout:N}=(0,o.v9)((({mobileDashboardLayout:e})=>({mobileDashboardLayout:e}))),{presentFilterIds:$}=ul({mobileDashboardLayout:N}),L=(0,o.v9)((e=>e.dashboardInfo.metadata)),{backgroundType:B="color",background_filter_type:A="color",backgroundColor:j="rgba(255,255,255,1)",background_filter_color:H="rgba(255,255,255,1)",default_filter_condition_number:q=3,backgroundImage:U="",background_filter_image:V="",fontFamily_Filter_Family:W="SimHei",fontSize_Filter_Size:G=16,fontWeight_Filter_Weight:K=400,textColor_Filter_Color:X="rgba(0,0,0,8)"}=L||{},[J,te]=(0,a.useState)("auto"),[ne,re]=(0,a.useState)("origin"),oe=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardState)||null==(n=t.dashboardConfig_old)?void 0:n.fitConfig})),ie=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),[ae,se]=(0,a.useState)("rowAndColumn"),[le,de]=(0,a.useState)("normalBrowser"),[ue,ce]=(0,a.useState)(null),[pe,he]=(0,a.useState)(null),[fe,ge]=(0,a.useState)(!1),[me,ve]=(0,a.useState)(0),[be,ye]=(0,a.useState)([]),[xe,Ce]=(0,a.useState)(""),[we,Se]=(0,a.useState)(""),[Ze,ke]=(0,a.useState)(!1),[Me,De]=(0,a.useState)([]);(0,a.useEffect)((()=>{se(ie||"rowAndColumn")}),[ie]);const Ee=({key:t,value:n,defaultValue:r})=>{r||(e((0,ss.Pz)({...L,[t]:n})),e((0,ss.if)(!0)))};(0,a.useEffect)((()=>{(()=>{if(F===i.kB.MOBILE){const{default_filter_condition_number:e,background_filter_color:t,background_filter_image:n,background_filter_type:r,fontFamily_Filter_Family:o,fontSize_Filter_Size:i,fontWeight_Filter_Weight:a,textColor_Filter_Color:s}=L;[{key:"defaultFilterConditionNumber",value:3,defaultValue:e},{key:"backgroundFilterColor",value:"rgba(255,255,255,1)",defaultValue:t},{key:"backgroundFilterImage",value:"",defaultValue:n},{key:"backgroundFilterType",value:"color",defaultValue:r},{key:"fontFamilyFilterFamily",value:"SimSun",defaultValue:o},{key:"fontSizeFilterSize",value:16,defaultValue:i},{key:"fontWeightFilterWeight",value:400,defaultValue:a},{key:"textColorFilterColor",value:"rgba(0,0,0,8)",defaultValue:s}].map(Ee)}})()}),[]),(0,a.useEffect)((()=>{const{component_margin:e=2,background_type:t="color",background_color:n="rgba(240,242,245,1)",background_image:o=""}=L||{};r!==e&&s(e),l!==t&&u(t),c!==A&&p(A),w!==n&&S(n),E!==W&&R(W),T!==G&&_(G),I!==K&&O(K),P!==X&&z(X),Z!==H&&k(H),b(o),f(o),C(V),D(q)}),[JSON.stringify(L)]);(0,a.useMemo)((()=>h==v||!h),[h,v]);const Re=(0,a.useMemo)((()=>null==oe?void 0:oe.mode),[oe]);(0,a.useEffect)((()=>{Re!==J&&te(Re)}),[Re]);const Te=(0,a.useMemo)((()=>{var e;return(null==oe||null==(e=oe.size)?void 0:e.sizeKey)||"normalBrowser"}),[oe]);(0,a.useEffect)((()=>{var e,t;(Te!==le&&de(Te),"custom"==Te)&&(ce(null==oe||null==(e=oe.size)?void 0:e.width),he(null==oe||null==(t=oe.size)?void 0:t.height))}),[Te]);(0,a.useEffect)((()=>{const e=/^(?!00)(?:[0-9]{3,4}|10000)$/;if(e.test(ue)&&e.test(pe)){const e={...t};e.custom.width=ue,e.custom.height=pe,n(e),ge(!1),ve((new Date).getTime())}else ge(!0)}),[ue,pe]);const _e=(0,a.useMemo)((()=>(null==oe?void 0:oe.type)||"origin"),[oe]);(0,a.useEffect)((()=>{_e!==ne&&re(_e)}),[_e]);(0,a.useEffect)((()=>{F==i.kB.MOBILE?(te("auto"),de("normalBrowser")):(te(fl.modeValue),de(fl.sizeKey)),ve((new Date).getTime())}),[F]),(0,a.useEffect)((()=>{if(0==me)return;let n={};if("auto"==J&&(n={mode:J,width:"100%",height:"100%"}),"ratio"==J){const{width:e,height:r}=t[le];if(!e||!r)return;n={mode:J,type:ne,size:{width:e,height:r,sizeKey:le}}}const r={...n};e((0,ss.F$)(r))}),[me]);return(0,x.tZ)("div",{css:()=>x.iv`
        .row-style {
          & + .row-style {
            margin-top: 16px;
          }
        }

        .color-set {
          width: 100%;
          height: 32px;
          border: 1px solid #d9d9d9;
          border-radius: 2px;
          display: flex;
          align-items: center;

          .color-cube {
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            border: 1px solid #d9d9d9;
            margin: 0 6px;
          }

          .color-value {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
        }

        .number-error-tip {
          color: red;
          font-size: 10px;
        }
      `},(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Layout")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:t=>{const n=t.target.value;se(n),e((0,ss.Pz)({...L,layoutType:n})),e((0,ss.ky)(n)),e((0,ss.if)(!0))},value:ae},(0,x.tZ)(ps.ZP,{value:"rowAndColumn"},(0,d.t)("Row and column")),(0,x.tZ)(ps.ZP,{value:"grid"},(0,d.t)("Grid"))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:t=>{const n=t.target.value;u(n),e((0,ss.Pz)({...L,backgroundType:n})),e((0,ss.if)(!0))},value:l,style:{marginBottom:"10px"}},(0,x.tZ)(ps.ZP,{value:"color"},(0,d.t)("Color")),(0,x.tZ)(ps.ZP,{value:"image"},(0,d.t)("Picture"))),"color"==l&&(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:w,onChangeComplete:t=>{const{hex:n,rgb:{r,g:o,b:i,a}}=t,s=`rgba(${r},${o},${i},${a})`;S(s),e((0,ss.Pz)({...L,backgroundColor:s})),e((0,ss.if)(!0))},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${w}`}}),(0,x.tZ)("div",{className:"color-value"},w))),"image"==l&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(hs.Z,{maxLength:200,placeholder:(0,d.t)("Enter the image link address or click upload"),value:"noImg"==h?"":h,onInput:e=>{f(e.currentTarget.value||"noImg")},onBlur:()=>{e((0,ss.Pz)({...L,backgroundImage:h})),e((0,ss.if)(!0))}}),(0,x.tZ)("div",{style:{display:"flex",marginTop:"5px"}},v&&"noImg"!==v&&(0,x.tZ)("div",{style:{width:"45%",border:"1px solid #f0f2f5"}},(0,x.tZ)(al,{width:"100%",preview:!0,src:v})),(0,x.tZ)("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",marginLeft:"5px"}},(0,x.tZ)(sl.Z,{customRequest:()=>{},onPreview:async e=>{e.url||e.preview||(e.preview=await(e=>new Promise(((t,n)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e)})))(e.originFileObj)),Ce(e.url||e.preview),ke(!0),Se(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},fileList:[],onChange:t=>{ye(t.fileList);const n=new FormData;n.append("formData",Me[0]),ee.Z.post({endpoint:"/api/v1/file/upload",body:n}).then((t=>{e((0,ss.Pz)({...L,backgroundImage:t.json.result.url})),e((0,ss.if)(!0))})).catch((()=>{Y.ZP.error((0,d.t)("upload failed"))}))},beforeUpload:e=>{const t="image/jpeg"===e.type||"image/png"===e.type;if(!t)return Y.ZP.error((0,d.t)("Only images in JPG/PNG format can be uploaded"));const n=e.size/1024/1024<2;if(!n)return Y.ZP.error((0,d.t)("Image size cannot exceed 2MB"));t&&n&&De([e])},accept:".png, .jpg"},(0,x.tZ)("span",null,(0,x.tZ)(dl.default,null),(0,d.t)("Upload")," .jpg/.png")),v&&"noImg"!==v&&(0,x.tZ)("div",{style:{color:"red",fontSize:"10px",cursor:"pointer"},onClick:()=>{e((0,ss.Pz)({...L,backgroundImage:"noImg"}))}},(0,d.t)("Delete"))))))),F===i.kB.MOBILE&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Filter quantity")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ll.Z,{min:1,placeholder:(0,d.t)("The minimum value is 1"),style:{width:"100%"},value:M,onChange:t=>{D(t),e((0,ss.Pz)({...L,defaultFilterConditionNumber:t})),e((0,ss.if)(!0)),parseInt(t)<=$.length&&e((0,ss.RP)(0))}}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Filter background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:t=>{const n=t.target.value;p(n),e((0,ss.Pz)({...L,backgroundFilterType:n})),e((0,ss.if)(!0))},value:c,style:{marginBottom:"10px"}},(0,x.tZ)(ps.ZP,{value:"color"},(0,d.t)("Color")),(0,x.tZ)(ps.ZP,{value:"image"},(0,d.t)("Picture"))),"color"===c&&(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:Z,onChangeComplete:t=>{const{rgb:{r:n,g:r,b:o,a:i}}=t,a=`rgba(${n},${r},${o},${i})`;k(a),e((0,ss.Pz)({...L,backgroundFilterColor:a})),e((0,ss.if)(!0))},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${Z}`}}),(0,x.tZ)("div",{className:"color-value"},Z))),"image"===c&&(0,x.tZ)(hs.Z,{placeholder:(0,d.t)("Enter the image link address or click upload"),onChange:e=>{m(e.currentTarget.value||"noImg")},defaultValue:y,onBlur:()=>{e((0,ss.Pz)({...L,backgroundFilterImage:g})),e((0,ss.if)(!0))},allowClear:!0}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font style")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"SimSun",style:{width:120},onChange:t=>{const n=t;R(n),e((0,ss.Pz)({...L,fontFamily_Filter:n})),e((0,ss.if)(!0))},value:E,options:[{value:"Microsoft Yahei",label:"\u5fae\u8f6f\u96c5\u9ed1"},{value:"Microsoft JhengHei",label:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{value:"SimHei",label:"\u9ed1\u4f53"},{value:"KaiTi",label:"\u6977\u4f53"},{value:"FangSong",label:"\u4eff\u5b8b"},{value:"SimSun",label:"\u5b8b\u4f53"},{value:"NSimSun",label:"\u65b0\u5b8b\u4f53"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font size")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>_(e.currentTarget.value),value:T,onBlur:t=>{const n=t.target.value;_(n),e((0,ss.Pz)({...L,fontSize_Filter:n})),e((0,ss.if)(!0))},type:"number",min:12,max:24}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font weight")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"500",style:{width:120},onChange:t=>{const n=t;O(n),e((0,ss.Pz)({...L,fontWeight_Filter:n})),e((0,ss.if)(!0))},value:I,options:[{value:100,label:"100"},{value:200,label:"200"},{value:300,label:"300"},{value:400,label:"400"},{value:500,label:"500"},{value:600,label:"600"},{value:700,label:"700"},{value:800,label:"800"},{value:900,label:"900"},{value:"bold",label:"bold"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font color")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:P,onChangeComplete:t=>{const{hex:n,rgb:{r,g:o,b:i,a}}=t,s=`rgba(${r},${o},${i},${a})`;z(s),e((0,ss.Pz)({...L,textColor_Filter:s})),e((0,ss.if)(!0))},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${P}`}}),(0,x.tZ)("div",{className:"color-value"},P||(0,d.t)("Please set the font color"))))))),F===i.kB.PC&&(0,x.tZ)(a.Fragment,null,"grid"===ae&&(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Component gutter")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{value:r,style:{width:"100%"},onChange:t=>{s(t),e((0,ss.Pz)({...L,componentMargin:t})),e((0,ss.if)(!0))},options:pl}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Self adaption")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{te(e.target.value),fl.modeValue=e.target.value,ve((new Date).getTime())},value:J,style:{marginBottom:"10px"}},(0,x.tZ)(ps.ZP,{value:"auto"},(0,d.t)("Automatic")),(0,x.tZ)(ps.ZP,{value:"ratio"},(0,d.t)("Fixed size"))),"ratio"==J&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{style:{marginBottom:"10px"}},(0,x.tZ)(Qo.Z,{style:{width:"100%"},defaultValue:Te||le,onChange:e=>{de(e),fl.sizeKey=e,ve((new Date).getTime())},options:hl})),"custom"==le&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{style:{marginBottom:"10px"}},(0,x.tZ)(ll.Z,{size:"small",style:{width:"70px"},defaultValue:ue,onChange:ce,placeholder:(0,d.t)("Width")}),(0,x.tZ)("span",{style:{padding:"0 5px"}},"x"),(0,x.tZ)(ll.Z,{size:"small",style:{width:"70px"},defaultValue:pe,onChange:he,placeholder:(0,d.t)("Height")})),fe&&(0,x.tZ)("div",{className:"number-error-tip"},(0,d.t)("Please enter an integer between 100 and 10000"))))))))};var ml=n(879686),vl=n(990605),bl=n(974713);const yl={row:"w4UOzNklS0SL5D_77YeA",rowCube:"mWrJBdiGpHChVkE_PdhM",popover:"_3JZcFp1kne3CztGR8x_r"};(0,y.iK)((({id:e,value:t,onClick:n})=>(0,x.tZ)("div",{id:e,onClick:n,className:yl.row},(0,x.tZ)("div",{className:yl.rowCube,style:{background:`${t}`}}),(0,x.tZ)("div",{className:yl.rowValue},t))))``;const xl=(0,y.iK)(ge.v2.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${({theme:e})=>e.gridUnit}px;
    padding-bottom: ${({theme:e})=>e.gridUnit}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.light3};
    }

    &.active {
      font-weight: ${({theme:e})=>e.typography.weights.bold};
      background: ${({theme:e})=>e.colors.grayscale.light2};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var Cl={name:"s5xdrg",styles:"display:flex;align-items:center"};const wl=e=>{const{value:t,options:n,onChange:r,overlayStyle:o,renderButton:i=(e=>e.label),renderOption:a=(e=>(0,x.tZ)("div",{className:e.className},e.label))}=e,s=(0,y.Fg)(),l=n.find((e=>e.value===t));return(0,x.tZ)(de.Gj,{trigger:["click"],overlayStyle:{zIndex:s.zIndex.max,...o},overlay:(0,x.tZ)(ge.v2,{onClick:({key:e})=>r(e)},n.map((e=>(0,x.tZ)(xl,{id:"menu-item",key:e.value,className:b()("dropdown-item",{active:e.value===t})},a(e)))))},(0,x.tZ)("div",{role:"button",css:Cl},l&&i(l),(0,x.tZ)(ae.Z.CaretDown,{iconColor:s.colors.grayscale.base,css:(0,x.iv)({marginTop:.5*s.gridUnit},"","")})))},Sl=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)("color"),[r,s]=(0,a.useState)(""),[l,u]=(0,a.useState)(""),[c,p]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[g,m]=(0,a.useState)(!1),[v,b]=(0,a.useState)(""),[y,C]=(0,a.useState)([]),[w,S]=(0,a.useState)([]),Z=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),k=(0,o.v9)((e=>e.dashboardLayout.present)),M=(0,o.v9)((e=>e.mobileDashboardLayout.present)),D=(0,a.useMemo)((()=>Z==i.kB.MOBILE?M:k),[k,M]),E=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),R=(0,a.useMemo)((()=>(D[E]||e((0,ss.ks)(void 0)),D[E])),[E,D]);(0,a.useEffect)((()=>{if(R){let{meta:{backgroundType:e,backgroundColor:t,bgColor:r,backgroundImage:o}}=R;e=void 0==e?"color":e,p(t||r||"rgba(255,255,255,1)"),s(o||""),u(o||""),n(e)}}),[R]);(0,a.useMemo)((()=>r==l||!r),[r,l]);const T=(t={})=>{Z==i.kB.MOBILE?e((0,bl.WZ)({[R.id]:{...R,meta:{...R.meta,...t}}})):e((0,vl.WZ)({[R.id]:{...R,meta:{...R.meta,...t}}}))};return(0,x.tZ)("div",null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;n(t),T({backgroundType:t})},value:t},(0,x.tZ)(ps.ZP,{value:"color"},(0,d.t)("Color")),(0,x.tZ)(ps.ZP,{value:"image"},(0,d.t)("Picture"))))),"image"==t&&(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24,style:{display:"flex",flexDirection:"column"}},(0,x.tZ)("div",{style:{display:"flex"}},l&&"noImg"!==l&&(0,x.tZ)("div",{style:{width:"45%",border:"1px solid #f0f2f5"}},(0,x.tZ)(al,{width:"100%",preview:!0,src:l})),(0,x.tZ)("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",marginLeft:"5px"}},(0,x.tZ)(sl.Z,{customRequest:()=>{},onPreview:async e=>{e.url||e.preview||(e.preview=await(e=>new Promise(((t,n)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e)})))(e.originFileObj)),f(e.url||e.preview),m(!0),b(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},fileList:[],onChange:e=>{C(e.fileList);const t=new FormData;t.append("formData",w[0]),ee.Z.post({endpoint:"/api/v1/file/upload",body:t}).then((({json:e})=>{var t;T({backgroundImage:null==(t=e.result)?void 0:t.url})})).catch((()=>{Y.ZP.error((0,d.t)("upload failed"))}))},beforeUpload:e=>{const t="image/jpeg"===e.type||"image/png"===e.type;if(!t)return Y.ZP.error((0,d.t)("Only images in JPG/PNG format can be uploaded"));const n=e.size/1024/1024<2;if(!n)return Y.ZP.error((0,d.t)("Image size cannot exceed 2MB"));t&&n&&S([e])},accept:".png, .jpg"},(0,x.tZ)("span",null,(0,x.tZ)(ml.default,null),(0,d.t)("Upload")," .jpg/.png")),l&&"noImg"!==l&&(0,x.tZ)("div",{onClick:()=>{T({backgroundImage:""})},style:{color:"red",fontSize:"10px",cursor:"pointer"}},(0,d.t)("Delete")))),(0,x.tZ)(hs.Z,{placeholder:l||(0,d.t)("Enter the image link address or click upload"),onInput:e=>{s(e.currentTarget.value)},maxLength:200,value:r,onBlur:()=>{T({backgroundImage:r})}}))),"color"==t&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:c,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;p(a),T({backgroundColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${c}`}}),(0,x.tZ)("div",{className:"color-value"},c||(0,d.t)("Please set the background color"))))))))};var Zl=n(400713);const kl=y.iK.div`
  ${({theme:e})=>x.iv`
    display: inline-block;

    &:before {
      content: '';
      width: 1em;
      height: 1em;
      margin-right: ${2*e.gridUnit}px;
      display: inline-block;
      vertical-align: middle;
    }

    &.background--white {
      padding-left: 0;
      background: transparent;

      &:before {
        background: ${e.colors.grayscale.light5};
        border: 1px solid ${e.colors.grayscale.light2};
      }
    }

    /* Create the transparent rect icon */
    &.background--transparent:before {
      background-image: linear-gradient(
          45deg,
          ${e.colors.text.label} 25%,
          transparent 25%
        ),
        linear-gradient(-45deg, ${e.colors.text.label} 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, ${e.colors.text.label} 75%),
        linear-gradient(-45deg, transparent 75%, ${e.colors.text.label} 75%);
      background-size: ${2*e.gridUnit}px ${2*e.gridUnit}px;
      background-position: 0 0, 0 ${e.gridUnit}px,
        ${e.gridUnit}px ${-e.gridUnit}px, ${-e.gridUnit}px 0px;
    }
  `}
`;function Ml(e){const t=(0,d.t)("Background");return(0,x.tZ)(kl,{className:b()("background-style-option",e.className)},`${e.label} ${t}`)}function Dl(e){return(0,x.tZ)(kl,{className:b()("background-style-option",e.className)},e.label)}class El extends a.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,x.tZ)(wl,{id:e,options:Zl.Z,value:t,onChange:n,renderButton:Ml,renderOption:Dl})}}(0,d.t)("solid"),(0,d.t)("dashed"),(0,d.t)("dotted");const Rl=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)(""),[r,s]=(0,a.useState)(""),[l,u]=(0,a.useState)("left"),[c,p]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[g,m]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),y=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),C=(0,o.v9)((e=>e.dashboardLayout.present)),w=(0,o.v9)((e=>e.mobileDashboardLayout.present)),S=(0,a.useMemo)((()=>y==i.kB.MOBILE?w:C),[C,w]),Z=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),k=(0,a.useMemo)((()=>(S[Z]||e((0,ss.ks)(void 0)),S[Z])),[Z,S]);(0,a.useEffect)((()=>{if(k){let{meta:{sliceNameLine:e,fontSize:t,fontFamily:r,fontWeight:o,textColor:i,text:a}}=k;e=void 0==e?"left":e,u(e),n(a),p(t||14),f(r||"SimSun"),m(o||500),b(i||"rgba(0,0,0,1)")}}),[k]);const M=(t={})=>{y==i.kB.MOBILE?e((0,bl.WZ)({[k.id]:{...k,meta:{...k.meta,...t}}})):e((0,vl.WZ)({[k.id]:{...k,meta:{...k.meta,...t}}}))};return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24,style:{fontWeight:"bold"}},(0,d.t)("Text"))),"HEADER"==k.type?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Content")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>n(e.currentTarget.value),value:t,onBlur:e=>{const t=e.target.value;n(t),M({text:t})}})))):null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Alignment")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;u(t),M({sliceNameLine:t})},value:l},(0,x.tZ)(ps.ZP,{value:"left"},(0,d.t)("Left")),(0,x.tZ)(ps.ZP,{value:"center"},(0,d.t)("Middle")),(0,x.tZ)(ps.ZP,{value:"right"},(0,d.t)("Right"))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font style")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"SimSun",style:{width:120},onChange:e=>{const t=e;f(t),M({fontFamily:t})},value:h,options:[{value:"Microsoft Yahei",label:"\u5fae\u8f6f\u96c5\u9ed1"},{value:"Microsoft JhengHei",label:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{value:"SimHei",label:"\u9ed1\u4f53"},{value:"KaiTi",label:"\u6977\u4f53"},{value:"FangSong",label:"\u4eff\u5b8b"},{value:"SimSun",label:"\u5b8b\u4f53"},{value:"NSimSun",label:"\u65b0\u5b8b\u4f53"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font size")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>p(e.currentTarget.value),value:c,onBlur:e=>{const t=e.target.value;p(t),M({fontSize:t})},type:"number"}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font weight")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"500",style:{width:120},onChange:e=>{const t=e;m(t),M({fontWeight:t})},value:g,options:[{value:100,label:"100"},{value:200,label:"200"},{value:300,label:"300"},{value:400,label:"400"},{value:500,label:"500"},{value:600,label:"600"},{value:700,label:"700"},{value:800,label:"800"},{value:900,label:"900"},{value:"bold",label:"bold"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font color")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:v,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;m(a),M({textColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${v}`}}),(0,x.tZ)("div",{className:"color-value"},v||(0,d.t)("Please set the font color")))))))},Tl=((0,d.t)("solid"),(0,d.t)("dashed"),(0,d.t)("dotted"),()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)("left"),[r,s]=(0,a.useState)(""),[l,u]=(0,a.useState)(""),[c,p]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),g=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),m=(0,o.v9)((e=>e.dashboardLayout.present)),v=(0,o.v9)((e=>e.mobileDashboardLayout.present)),b=(0,a.useMemo)((()=>g==i.kB.MOBILE?v:m),[m,v]),y=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),C=(0,a.useMemo)((()=>(b[y]||e((0,ss.ks)(void 0)),b[y])),[y,b]);(0,a.useEffect)((()=>{if(C){let{meta:{sliceNameLine:e,fontSize:t,fontFamily:r,fontWeight:o,textColor:i}}=C;e=void 0==e?"left":e,n(e),s(t||14),u(r||"SimSun"),p(o||500),f(i||"rgba(0,0,0,1)")}}),[C]);const w=(t={})=>{g==i.kB.MOBILE?e((0,bl.WZ)({[C.id]:{...C,meta:{...C.meta,...t}}})):e((0,vl.WZ)({[C.id]:{...C,meta:{...C.meta,...t}}}))};return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24,style:{fontWeight:"bold"}},"\u6587\u672c")),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Alignment")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;n(t),w({sliceNameLine:t})},value:t},(0,x.tZ)(ps.ZP,{value:"left"},(0,d.t)("Left")),(0,x.tZ)(ps.ZP,{value:"center"},(0,d.t)("Middle")),(0,x.tZ)(ps.ZP,{value:"right"},(0,d.t)("Right"))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font style")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"SimSun",style:{width:120},onChange:e=>{const t=e;u(t),w({fontFamily:t})},value:l,options:[{value:"Microsoft Yahei",label:"\u5fae\u8f6f\u96c5\u9ed1"},{value:"Microsoft JhengHei",label:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{value:"SimHei",label:"\u9ed1\u4f53"},{value:"KaiTi",label:"\u6977\u4f53"},{value:"FangSong",label:"\u4eff\u5b8b"},{value:"SimSun",label:"\u5b8b\u4f53"},{value:"NSimSun",label:"\u65b0\u5b8b\u4f53"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font size")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>s(e.currentTarget.value),value:r,onBlur:e=>{const t=e.target.value;s(t),w({fontSize:t})},type:"number"}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font weight")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"500",style:{width:120},onChange:e=>{const t=e;p(t),w({fontWeight:t})},value:c,options:[{value:100,label:"100"},{value:200,label:"200"},{value:300,label:"300"},{value:400,label:"400"},{value:500,label:"500"},{value:600,label:"600"},{value:700,label:"700"},{value:800,label:"800"},{value:900,label:"900"},{value:"bold",label:"bold"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font color")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:h,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;p(a),w({textColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${h}`}}),(0,x.tZ)("div",{className:"color-value"},h||(0,d.t)("Please set the font color")))))))});var _l=n(71577),Il=n(757016),Ol=n(113013),Pl=n(99210),zl=n(432615),Fl=n(619702),Nl=n(609676),$l=n(200078),Ll=n(177874),Bl=n(442582);const Al=e=>e.map((e=>e.children?{...e,title:(0,x.tZ)("span",null,(0,x.tZ)($l.default,{style:{color:"#f7bf5c"}}),e.title),children:Al(e.children)}:{...e,title:(0,x.tZ)("span",null,(0,x.tZ)(Ll.default,{style:{color:"#87abf0"}}),e.title)})),jl=({config:e,onchange:t})=>{var n;const{perms:r,selectList:o}=(0,a.useContext)(ed),i=(n,r,o)=>{const i=[...e.list||[]];i[o][n]=r,t({list:i})},{result:s,error:l,status:u}=(0,Bl.JL)(e.treeValue||"0");return(0,x.tZ)("div",{style:{padding:"0 20px",height:"100%",display:"flex",flexDirection:"column"}},(0,x.tZ)("div",{style:{flex:1}},(0,x.tZ)(us.Z,null,(0,x.tZ)(cs.Z,{span:4,style:{lineHeight:"32px"}},(0,d.t)("Jumo to"),":"),(0,x.tZ)(cs.Z,{span:20},(0,x.tZ)(Fe.Z,{showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,d.t)("search for"),value:e.treeValue,allowClear:!0,onChange:e=>{t({treeValue:e,list:[]})},treeData:Al(r)}))),(0,x.tZ)("div",{style:{display:"flex",justifyContent:"space-between",margin:"10px 0"}},(0,x.tZ)("div",null,(0,x.tZ)(Nl.Z,{checked:e.defineChecked,onChange:e=>{t({defineChecked:e.target.checked})}},(0,d.t)("custom"))),e.defineChecked&&(0,x.tZ)("div",{style:{cursor:"pointer"},onClick:()=>{t({list:[...e.list||[],{sourceId:void 0,targetId:void 0}]})}},(0,x.tZ)(zl.default,{style:{padding:"4px",color:"#4ec886"}}),(0,d.t)("Add"))),e.defineChecked?(0,x.tZ)(us.Z,{gutter:10},(0,x.tZ)(cs.Z,{span:11},(0,x.tZ)("div",{style:{backgroundColor:"#edf9f2",padding:"5px"}},(0,d.t)("Source field"))),(0,x.tZ)(cs.Z,{span:13},(0,x.tZ)("div",{style:{backgroundColor:"#e8f9fe",padding:"5px"}},(0,d.t)("Target field"))),null==e||null==(n=e.list)?void 0:n.map(((n,r)=>(0,x.tZ)(a.Fragment,null,(0,x.tZ)(cs.Z,{span:11},(0,x.tZ)(Qo.Z,{key:r,placeholder:(0,d.t)("Please select the source field"),value:e.list[r].sourceId,options:o,onChange:e=>{i("sourceId",e,r),i("targetId",void 0,r)},style:{width:"100%",margin:"10px 0"}})),(0,x.tZ)(cs.Z,{span:13},(0,x.tZ)("div",{style:{display:"flex"}},(0,x.tZ)(Fe.Z,{showSearch:!0,key:r,style:{width:"100%",margin:"10px 0"},value:e.list[r].targetId,dropdownStyle:{maxHeight:800,overflow:"auto"},placeholder:(0,d.t)("Please select the target field"),allowClear:!0,treeExpandAction:"click",maxTagCount:1,dropdownMatchSelectWidth:!1,onSelect:(e,t)=>{i("targetId",e,r),i("datasetId",t.pid,r)},treeData:s?null==s?void 0:s.map((t=>{const n={};return n.title=t.table_name,n.selectable=!1,n.key=t.id,t.columns&&t.columns.length&&(n.children=t.columns.map((e=>({title:e.verbose_name||e.column_name,type:e.type,key:e.column_name,pid:t.id}))).filter((t=>{const n=e.list[r].sourceId?e.list[r].sourceId.split("&&"):[];return t.type===n[0]||t.title===n[1]}))),n})).filter((e=>{var t;return null==(t=e.children)?void 0:t.length})):[]}),(0,x.tZ)(Fl.default,{style:{lineHeight:"54px",fontSize:"16px"},className:"del-icon",onClick:()=>{t({list:e.list.filter(((e,t)=>r!==t))})}}))))))):null),(0,x.tZ)("div",{style:{height:"35px"}},"\u6253\u5f00\u4f4d\u7f6e"," ",(0,x.tZ)(Qo.Z,{value:e.openType||"1",style:{width:"300px"},onChange:e=>t({openType:e}),options:[{label:"\u65b0\u7a97\u53e3\u6253\u5f00",value:"1"},{label:"\u5f39\u6846\u6253\u5f00",value:"2"}]})))};var Hl=n(318933),ql=n(818397),Ul=n(604942);const Vl=[{type:"paragraph",children:[{text:""}]}],Wl=({value:e=Vl,setValue:t},n)=>{const r=(0,a.useCallback)((e=>(0,x.tZ)(Kl,e)),[]),o=(0,a.useMemo)((()=>Gl((0,Ul.BU)((0,ql.VC)((0,Hl.Jh)())))),[]),i=(0,a.useCallback)(((e,t)=>{const n={type:"mention",character:e,children:[{text:t,bold:!0}]};Hl.YR.insertNodes(o,n),Hl.YR.move(o)}),[o]);return(0,a.useImperativeHandle)(n,(()=>({addNode:i}))),(0,x.tZ)(Ul.mH,{style:{heigt:"100%"},editor:o,initialValue:e,value:e,onChange:e=>{t(e)}},(0,x.tZ)(Ul.CX,{renderElement:r,placeholder:(0,d.t)("Enter webpage link")}))},Gl=e=>{const{isInline:t,isVoid:n,markableVoid:r}=e;return e.isInline=e=>"mention"===e.type||t(e),e.isVoid=e=>"mention"===e.type||n(e),e.markableVoid=e=>"mention"===e.type||r(e),e},Kl=e=>{const{attributes:t,children:n,element:r}=e;return"mention"===r.type?(0,x.tZ)(Yl,e):(0,x.tZ)("p",t,n)},Yl=({attributes:e,children:t,element:n})=>{const r=(0,Ul.vt)(),o=(0,Ul.UE)(),i={padding:"3px 3px 2px",margin:"0 1px",verticalAlign:"baseline",display:"inline-block",borderRadius:"4px",backgroundColor:"#eee",fontSize:"0.9em",boxShadow:r&&o?"0 0 0 2px #B4D5FF":"none"};return n.children[0].bold&&(i.fontWeight="bold"),n.children[0].italic&&(i.fontStyle="italic"),(0,x.tZ)("span",fe()({},e,{contentEditable:!1,"data-cy":`mention-${n.character.replace(" ","-")}`,style:i}),n.character,t)},Xl=(0,a.forwardRef)(Wl),Ql=({config:e,onchange:t})=>{const{selectList:n}=(0,a.useContext)(ed),[r,o]=(0,a.useState)([{type:"paragraph",children:[{text:"This example shows how you might implement a simple "}]}]);(0,a.useEffect)((()=>{const e=JSON.parse(sessionStorage.getItem("initValue"));o(e||[])}),[]);const i=(0,a.useRef)(null);return(0,x.tZ)("div",{style:{padding:"0 20px",height:"100%",display:"flex",flexDirection:"column"}},(0,x.tZ)("div",{style:{display:"flex",flex:1,paddingBottom:"10px"}},(0,x.tZ)("div",{style:{width:"48%",margin:"0 1%",border:"1px #eee solid",overflowY:"auto",maxHeight:"50vh"}},(0,x.tZ)("div",{style:{display:"flex",justifyContent:"space-between",backgroundColor:"#EEF5FF",height:"30px",lineHeight:"26px",padding:"2px 10px"}},(0,d.t)("Optional field")),n.map((e=>(0,x.tZ)("div",{style:{cursor:"pointer",width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",overflow:"hidden"},title:e.label,className:"leftList",onClick:()=>{var t;null==(t=i.current)||t.addNode(e.label,e.value)}},e.label)))),(0,x.tZ)("div",{style:{width:"48%",margin:"0 1%",border:"1px #eee solid"}},(0,x.tZ)("div",{style:{display:"flex",justifyContent:"space-between",backgroundColor:"#EEF5FF",height:"30px",lineHeight:"26px",padding:"2px 10px"}},(0,d.t)("Jumo to")),(0,x.tZ)("div",{style:{padding:"0 10px",height:"calc(100% - 30px)"}},(0,x.tZ)(Xl,{ref:i,style:{height:"100%",backgroundColor:"#fff"},value:e.jumpUrl,setValue:(e=[])=>{t({jumpUrl:e})}})))),(0,x.tZ)("div",{style:{height:"35px"}},"\u6253\u5f00\u4f4d\u7f6e"," ",(0,x.tZ)(Qo.Z,{style:{width:"300px"},value:e.openType||"1",onChange:e=>t({openType:e}),options:[{label:"\u65b0\u7a97\u53e3\u6253\u5f00",value:"1"},{label:"\u5f39\u6846\u6253\u5f00",value:"2"}]})))},Jl=e=>{const[t,n]=(0,a.useState)(e.jumpSetData||[]),[r,o]=(0,a.useState)(0),[i,s]=(0,a.useState)(!0),{tableType:l}=(0,a.useContext)(ed),u=()=>{s(!1),setTimeout((()=>{s(!0)}),10)},c=(0,a.useCallback)((e=>{n((n=>{const o=[...n];return o[r].config={...t[r].config,...e},o}))}),[t,r]);return(0,x.tZ)(Il.Z,fe()({title:(0,d.t)("Jump settings"),width:"50%",okText:(0,d.t)("Confirm"),cancelText:(0,d.t)("Cancel")},e,{onOk:()=>{e.onOk&&e.onOk(t)}}),(0,x.tZ)(us.Z,{className:"jumpSet",style:{minHeight:"40vh",maxHeight:"60vh",overflowY:"auto"}},(0,x.tZ)(cs.Z,{span:6,style:{border:"1px #eee solid"}},(0,x.tZ)("div",{style:{display:"flex",justifyContent:"space-between",backgroundColor:"#EEF5FF",height:"30px",lineHeight:"26px",padding:"2px 10px"}},(0,x.tZ)("div",null,(0,d.t)("Add jump")),(0,x.tZ)(Ol.Z,{overlay:(0,x.tZ)(Pl.Z,{onClick:({key:e})=>{"1"===e?n((e=>[...e,{type:1,tableType:l,name:(0,d.t)("Analysis template"),custom:!0,id:Date.now(),config:{list:[],openType:"1"}}])):(u(),n((e=>[...e,{type:2,tableType:l,name:(0,d.t)("Web link"),id:Date.now(),config:{openType:"1"}}]))),o(t.length)}},(0,x.tZ)(Pl.Z.Item,{key:"1"},(0,d.t)("Analysis template")),(0,x.tZ)(Pl.Z.Item,{key:"2"},(0,d.t)("Web link")))},(0,x.tZ)("a",{onClick:e=>e.preventDefault()},(0,x.tZ)(zl.default,{style:{padding:"4px",color:"#4ec886"}})))),(0,x.tZ)("div",null,t.map(((e,i)=>(0,x.tZ)("div",{key:i,onClick:()=>{u(),o(i)},className:"leftList",style:{backgroundColor:r===i?"#f2f4f7":""}},(0,x.tZ)("span",null,(0,d.t)(e.name)),(0,x.tZ)(Fl.default,{className:"del-icon",onClick:e=>{e.stopPropagation(),i<r&&(u(),o(r>0?r-1:0)),i===r&&(u(),o(r===t.length-1?r-1:r)),n(t.filter(((e,t)=>i!==t)))}})))))),(0,x.tZ)(cs.Z,{span:18},t[r]?(0,x.tZ)(a.Fragment,null,1===t[r].type?(0,x.tZ)(jl,{config:t[r].config,onchange:c}):(0,x.tZ)(a.Fragment,null,i&&(0,x.tZ)(Ql,{config:t[r].config,onchange:c}))):null)))};n(619755);const ed=a.createContext(null),td=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)(""),[r,s]=(0,a.useState)(""),[l,u]=(0,a.useState)(!0),[c,p]=(0,a.useState)("left"),[h,f]=(0,a.useState)(""),[g,m]=(0,a.useState)(16),[v,b]=(0,a.useState)(600),[y,C]=(0,a.useState)(),[w,S]=(0,a.useState)(!1),[Z,k]=(0,a.useState)(!1),[M,D]=(0,a.useState)([]),[E,R]=(0,a.useState)([]),[T,_]=(0,a.useState)([]),[I,O]=(0,a.useState)(""),[P,z]=(0,a.useState)(!1),[F,N]=(0,a.useState)(""),[$,L]=(0,a.useState)(""),[B,A]=(0,a.useState)(""),[j,H]=(0,a.useState)(""),[q,U]=(0,a.useState)(""),V=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),W=((0,o.v9)((e=>e)),(0,o.v9)((e=>e.dashboardLayout.present))),G=(0,o.v9)((e=>e.mobileDashboardLayout.present)),K=(0,a.useMemo)((()=>V==i.kB.MOBILE?G:W),[W,G]),Y=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),X=(0,o.v9)((e=>e.charts)),J=(0,o.v9)((e=>e.datasources)),te=(0,a.useMemo)((()=>(K[Y]||e((0,ss.ks)(void 0)),K[Y])),[Y,K]);(0,a.useEffect)((()=>{if(te){let{meta:{sliceName:e,sliceNameOverride:t,showSliceName:r,sliceNameLine:o,bgColor:i,displayed:a,fontFamily:l,fontSize:d,fontWeight:c,textColor:h,sliceJumpType:g,sliceJumpSetData:v,chartId:y,titleFontFamily:x,titleSize:w,titleFontWeight:Z,titleColor:k}}=te;if(n(t||e),s(t||e),r=void 0==r||r,o=void 0==o?"left":o,g=void 0!=g&&g,v=void 0==v?[]:v,u(r),p(o),S(g),D(v),X[y]){const e=X[y].form_data.datasource,t=J[e];if(t&&t.columns&&Array.isArray(t.columns)){U(X[y].form_data.viz_type);const e=((e,t)=>{const n=[];if("pie"===t.viz_type){const e=t.groupby.map((e=>({label:e,value:`${e}&&${e}`})));n.push(...e)}else if("line"===t.viz_type){const t=e.map((e=>({label:e.column_name,value:`${e.type}&&${e.column_name}`})));n.push(...t)}else if("echarts_timeseries_bar"===t.viz_type){const e=t.metrics.map((e=>({label:e.label,value:`${e.expressionType}&&${e.label}`})));e.push(...t.groupby.map((e=>({label:e,value:`${e}&&${e}`})))),e.push({label:t.x_axis,value:`${t.x_axis}&&${t.x_axis}`}),n.push(...e)}else{const t=e.map((e=>({label:e.column_name,value:`${e.type}&&${e.column_name}`})));n.push(...t)}return n})(t.columns,X[y].form_data);_(e||[])}}a=void 0!=a&&a,O(i||"rgba(192,192,192,10)"),z(a),N(l||"SimHei"),L(d||12),A(c||400),H(h||"rgba(0,0,0,1)"),f(x||"inherit"),m(w||16),b(Z||400),C(k||"rgba(0,0,0,0.8)")}}),[te]);const ne=(t={})=>{V==i.kB.MOBILE?e((0,bl.WZ)({[te.id]:{...te,meta:{...te.meta,...t}}})):e((0,vl.WZ)({[te.id]:{...te,meta:{...te.meta,...t}}}))};(0,a.useEffect)((()=>{ee.Z.get({endpoint:"/api/v2/dashboard/group/"}).then((e=>{const{json:{meta:{code:t,data:n=[]}}}=e;if(200==t&&Array.isArray(n)){function r(e){return e.map((e=>{const t={...e};return t.title=e.name,t.key=e.group_id,t.selectable=!1,t.children=[...r(e.children),...e.dashboards.map((e=>({...e,title:e.dashboard_title,key:e.dashboard_id})))],t}))}const o=r(n);R(o)}}))}),[]);return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24,style:{fontWeight:"bold"}},(0,d.t)("Title"))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Title name")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{defaultValue:t,onInput:e=>s(e.currentTarget.value),value:r,placeholder:t,onBlur:e=>{const n=e.target.value;s(n),ne({sliceNameOverride:n||t})}}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Show title")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;u(t),ne({showSliceName:t})},value:l},(0,x.tZ)(ps.ZP,{value:!0},(0,d.t)("Yes")),(0,x.tZ)(ps.ZP,{value:!1},(0,d.t)("No"))))),l&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Alignment")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;p(t),ne({sliceNameLine:t})},value:c},(0,x.tZ)(ps.ZP,{value:"left"},(0,d.t)("Left")),(0,x.tZ)(ps.ZP,{value:"center"},(0,d.t)("Middle"))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font style")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"SimSun",style:{width:120},onChange:e=>{const t=e;f(t),ne({titleFontFamily:t})},value:h,options:[{value:"Microsoft Yahei",label:"\u5fae\u8f6f\u96c5\u9ed1"},{value:"Microsoft JhengHei",label:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{value:"SimHei",label:"\u9ed1\u4f53"},{value:"KaiTi",label:"\u6977\u4f53"},{value:"FangSong",label:"\u4eff\u5b8b"},{value:"SimSun",label:"\u5b8b\u4f53"},{value:"NSimSun",label:"\u65b0\u5b8b\u4f53"},{value:"inherit",label:"\u8ddf\u968f\u7cfb\u7edf"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font size")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>m(e.currentTarget.value),value:g,onBlur:e=>{const t=e.target.value;m(t),ne({titleSize:t})},type:"number"}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font weight")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"500",style:{width:120},onChange:e=>{const t=e;b(t),ne({titleFontWeight:t})},value:v,options:[{value:100,label:"100"},{value:200,label:"200"},{value:300,label:"300"},{value:400,label:"400"},{value:500,label:"500"},{value:600,label:"600"},{value:700,label:"700"},{value:800,label:"800"},{value:900,label:"900"},{value:"bold",label:"bold"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font color")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:y,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;C(a),ne({titleColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${y}`}}),(0,x.tZ)("div",{className:"color-value"},y||(0,d.t)("Please set the font color"))))))),"PC"===V&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:24,style:{fontWeight:"bold"}},(0,d.t)("Sample size"))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Is it displayed")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;z(t),ne({displayed:t})},value:P},(0,x.tZ)(ps.ZP,{value:!0},(0,d.t)("Yes")),(0,x.tZ)(ps.ZP,{value:!1},(0,d.t)("No"))))),P&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:I,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;O(a),ne({bgColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${I}`}}),(0,x.tZ)("div",{className:"color-value"},I||(0,d.t)("Please set the color")))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font style")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"SimSun",style:{width:120},onChange:e=>{const t=e;N(t),ne({fontFamily:t})},value:F,options:[{value:"Microsoft Yahei",label:"\u5fae\u8f6f\u96c5\u9ed1"},{value:"Microsoft JhengHei",label:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{value:"SimHei",label:"\u9ed1\u4f53"},{value:"KaiTi",label:"\u6977\u4f53"},{value:"FangSong",label:"\u4eff\u5b8b"},{value:"SimSun",label:"\u5b8b\u4f53"},{value:"NSimSun",label:"\u65b0\u5b8b\u4f53"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font size")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(hs.Z,{onInput:e=>L(e.currentTarget.value),value:$,onBlur:e=>{const t=e.target.value;L(t),ne({fontSize:t})},type:"number"}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font weight")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Qo.Z,{defaultValue:"500",style:{width:120},onChange:e=>{const t=e;A(t),ne({fontWeight:t})},value:B,options:[{value:100,label:"100"},{value:200,label:"200"},{value:300,label:"300"},{value:400,label:"400"},{value:500,label:"500"},{value:600,label:"600"},{value:700,label:"700"},{value:800,label:"800"},{value:900,label:"900"},{value:"bold",label:"bold"}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Font color")),(0,x.tZ)(cs.Z,{span:16,style:{display:"flex"}},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:j,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;H(a),ne({textColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${j}`}}),(0,x.tZ)("div",{className:"color-value"},j||(0,d.t)("Please set the font color")))))))),(0,x.tZ)(us.Z,null,(0,x.tZ)(cs.Z,{span:8},(0,d.t)("Enable jump")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;S(t),ne({sliceJumpType:t})},value:w},(0,x.tZ)(ps.ZP,{value:!0},(0,d.t)("Yes")),(0,x.tZ)(ps.ZP,{value:!1},(0,d.t)("No")))),(0,x.tZ)(cs.Z,{span:16,offset:8},w&&(0,x.tZ)(_l.Z,{type:"link",onClick:()=>k(!Z)},(0,d.t)("Jump settings")))),Z&&(0,x.tZ)(ed.Provider,{value:{perms:E,selectList:T,tableType:q}},(0,x.tZ)(Jl,{title:(0,d.t)("Jump settings"),visible:Z,jumpModal:Z,jumpSetData:M,selectList:T,setJumpModal:k,perms:E,onOk:e=>{ne({sliceJumpSetData:e}),k(!1)},onCancel:()=>k(!1)})))},nd=()=>{var e;const t=(0,o.I0)(),[n,r]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),[u,c]=(0,a.useState)(""),[p,h]=(0,a.useState)(1),[f,g]=(0,a.useState)(),m=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),v=(0,o.v9)((e=>e.dashboardLayout.present)),b=(0,o.v9)((e=>e.mobileDashboardLayout.present)),y=(0,a.useMemo)((()=>m==i.kB.MOBILE?b:v),[v,b]),C=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),w=(0,a.useMemo)((()=>(y[C]||t((0,ss.ks)(void 0)),y[C])),[C,y]);(0,a.useEffect)((()=>{if(w){let{meta:{bgColor:e,lineColor:t,lineType:n,lineSize:o,radius:i}}=w;r(e),l(t),c(n||"solid"),h(o),g(i)}}),[w]);const S=(e={})=>{m==i.kB.MOBILE?t((0,bl.WZ)({[w.id]:{...w,meta:{...w.meta,...e}}})):t((0,vl.WZ)({[w.id]:{...w,meta:{...w.meta,...e}}}))};return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:n,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:o,b:i,a}}=e,s=`rgba(${n},${o},${i},${a})`;r(s),S({bgColor:s})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${n}`}}),(0,x.tZ)("div",{className:"color-value"},n||(0,d.t)("Please set the color")))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border type")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{defaultValue:"solid",style:{width:120},onChange:e=>{const t=e;c(t),S({lineType:t})},value:u,options:[{value:"solid",label:(0,d.t)("solid")},{value:"dashed",label:(0,d.t)("dashed")},{value:"dotted",label:(0,d.t)("dotted")}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border size")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{style:{width:120},onChange:e=>{const t=e;h(t),S({lineSize:t})},value:p,options:[{value:0,label:0},{value:1,label:1},{value:2,label:2},{value:3,label:3},{value:4,label:4},{value:5,label:5}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border color")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:s,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;l(a),S({lineColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${s}`}}),(0,x.tZ)("div",{className:"color-value"},s||(0,d.t)("Please set the color")))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Round radius")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(hs.Z,{style:{width:"60px"},suffix:"\xb0",onChange:e=>{let t=e.target.value;t<0?t=0:t>50&&(t=50),S({radiusBox:t})},value:null==w||null==(e=w.meta)?void 0:e.radiusBox}))))},rd=()=>{var e;const t=(0,o.I0)(),[n,r]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),[u,c]=(0,a.useState)(""),[p,h]=(0,a.useState)(1),f=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),g=(0,o.v9)((e=>e.dashboardLayout.present)),m=(0,o.v9)((e=>e.mobileDashboardLayout.present)),v=(0,a.useMemo)((()=>f==i.kB.MOBILE?m:g),[g,m]),b=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),y=(0,a.useMemo)((()=>(v[b]||t((0,ss.ks)(void 0)),v[b])),[b,v]);(0,a.useEffect)((()=>{if(y){let{meta:{bgColor:e,lineColor:t,lineType:n,lineSize:o}}=y;r(e),l(t),c(n||"solid"),h(o||1)}}),[y]);const C=(e={})=>{f==i.kB.MOBILE?t((0,bl.WZ)({[y.id]:{...y,meta:{...y.meta,...e}}})):t((0,vl.WZ)({[y.id]:{...y,meta:{...y.meta,...e}}}))};return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Background")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:n,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:o,b:i,a}}=e,s=`rgba(${n},${o},${i},${a})`;r(s),C({bgColor:s})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${n}`}}),(0,x.tZ)("div",{className:"color-value"},n||(0,d.t)("Please set the color")))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border type")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{defaultValue:"solid",style:{width:120},onChange:e=>{const t=e;c(t),C({lineType:t})},value:u,options:[{value:"solid",label:(0,d.t)("solid")},{value:"dashed",label:(0,d.t)("dashed")},{value:"dotted",label:(0,d.t)("dotted")}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border size")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{style:{width:120},onChange:e=>{const t=e;h(t),C({lineSize:t})},value:p,options:[{value:0,label:0},{value:1,label:1},{value:2,label:2},{value:3,label:3},{value:4,label:4},{value:5,label:5}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Border color")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:s,onChangeComplete:e=>{const{hex:t,rgb:{r:n,g:r,b:o,a:i}}=e,a=`rgba(${n},${r},${o},${i})`;l(a),C({lineColor:a})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${s}`}}),(0,x.tZ)("div",{className:"color-value"},s||(0,d.t)("Please set the color")))))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Round radius")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(hs.Z,{style:{width:"60px"},placeholder:(0,d.t)("Round radius"),suffix:"\xb0",onChange:e=>{const t=e.target.value;C({rotate:t})},value:(null==y||null==(e=y.meta)?void 0:e.rotate)||0}))))},od=()=>{const e=(0,o.I0)(),t=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),n=(0,o.v9)((e=>e.dashboardLayout.present)),r=(0,o.v9)((e=>e.mobileDashboardLayout.present)),s=(0,a.useMemo)((()=>t==i.kB.MOBILE?r:n),[n,r]),l=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),u=(0,a.useMemo)((()=>(s[l]||e((0,ss.ks)(void 0)),s[l])),[l,s]),[c,p]=(0,a.useState)(u.meta.layoutFilterType||i.Bp.VERTICAL);(0,a.useEffect)((()=>{l&&u&&p(u.meta.layoutFilterType||i.Bp.VERTICAL)}),[l]);const h=(n={})=>{t==i.kB.MOBILE?e((0,bl.WZ)({[u.id]:{...u,meta:{...u.meta,...n}}})):e((0,vl.WZ)({[u.id]:{...u,meta:{...u.meta,...n}}}))};return(0,x.tZ)("div",null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Opacity")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(El,{id:`${u.id}-background`,value:u.meta.background||Be.HE,onChange:e=>{h({background:e})}}))),t==i.kB.PC&&(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Layout")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{const t=e.target.value;p(t),h({layoutFilterType:t})},value:c},(0,x.tZ)(ps.ZP,{value:i.Bp.VERTICAL},(0,d.t)("Vertical")),(0,x.tZ)(ps.ZP,{value:i.Bp.HORIZONTAL},(0,d.t)("Horizontal"))))))},id=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)(""),[r,s]=(0,a.useState)(""),[l,u]=(0,a.useState)(""),c=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),p=(0,o.v9)((e=>e.dashboardLayout.present)),h=(0,o.v9)((e=>e.mobileDashboardLayout.present)),f=(0,a.useMemo)((()=>c==i.kB.MOBILE?h:p),[p,h]),g=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),m=(0,a.useMemo)((()=>(f[g]||e((0,ss.ks)(void 0)),f[g])),[g,f]);(0,a.useEffect)((()=>{if(m){let{meta:{lineColor:e,lineType:t,lineSize:r}}=m;n(e),s(t||"solid"),u(r||1)}}),[m]);const v=(t={})=>{c==i.kB.MOBILE?e((0,bl.WZ)({[m.id]:{...m,meta:{...m.meta,...t}}})):e((0,vl.WZ)({[m.id]:{...m,meta:{...m.meta,...t}}}))};return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Divider type")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{defaultValue:"solid",style:{width:120},onChange:e=>{const t=e;s(t),v({lineType:t})},value:r,options:[{value:"solid",label:(0,d.t)("solid")},{value:"dashed",label:(0,d.t)("dashed")},{value:"dotted",label:(0,d.t)("dotted")}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Divider size")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(hs.Z,{style:{width:120},onChange:e=>{const t=e.target.value;u(t),v({lineSize:t})},value:parseInt(l,10),min:1,type:"number"}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Divider color")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Q.Z,{content:(0,x.tZ)(ds.xS,{color:t,onChangeComplete:e=>{const{hex:t,rgb:{r,g:o,b:i,a}}=e,s=`rgba(${r},${o},${i},${a})`;n(s),v({lineColor:s})},presetColors:[],disableAlpha:!1}),trigger:"click",placement:"bottom"},(0,x.tZ)("div",{className:"color-set"},(0,x.tZ)("div",{className:"color-cube",style:{background:`${t}`}}),(0,x.tZ)("div",{className:"color-value"},t||(0,d.t)("Please set the color")))))))},ad=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)(""),r=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),s=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),l=(0,o.v9)((e=>e.dashboardLayout.present)),u=(0,o.v9)((e=>e.mobileDashboardLayout.present)),c=(0,a.useMemo)((()=>r==i.kB.MOBILE?u:l),[l,u]),p=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),h=(0,a.useMemo)((()=>(c[p]||e((0,ss.ks)(void 0)),c[p])),[p,c]),f=(t={})=>{r==i.kB.MOBILE?e((0,bl.WZ)({[h.id]:{...h,meta:{...h.meta,...t}}})):e((0,vl.WZ)({[h.id]:{...h,meta:{...h.meta,...t}}}))};return(0,a.useEffect)((()=>{if(h){let{meta:{marginBtnTop:e}}=h;n(e)}}),[h]),(0,x.tZ)("div",null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Opacity")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(El,{id:`${h.id}-background`,value:h.meta.background||Be.HE,onChange:e=>{f({background:e})}}))),"grid"!==s&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Height")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(Qo.Z,{style:{width:120},onChange:e=>{f({btnHeight:e})},value:h.meta.btnHeight||32,options:[{value:16,label:16},{value:24,label:24},{value:32,label:32},{value:36,label:36},{value:40,label:40},{value:48,label:48}]}))),(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Distance to top")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(hs.Z,{style:{width:120},onChange:e=>{var t;const n=null==e||null==(t=e.target)?void 0:t.value;f({marginBtnTop:n})},value:t}),"px"))))},sd={[i.kB.PC]:vl.WZ,[i.kB.MOBILE]:bl.WZ},ld=()=>{const e=(0,o.I0)(),[t,n]=(0,a.useState)(null),r=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),s=(0,o.v9)((e=>e.dashboardLayout.present)),l=(0,o.v9)((e=>e.mobileDashboardLayout.present)),u=(0,a.useMemo)((()=>r==i.kB.PC?s:l),[s,l]),c=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),p=(0,a.useMemo)((()=>(u[c]||e((0,ss.ks)(void 0)),u[c])),[c,u]);(0,a.useEffect)((()=>{if(p){var e;const{frameSrc:t}=null!=(e=null==p?void 0:p.meta)?e:{};n(t||null)}}),[p]);return(0,x.tZ)(us.Z,{className:"row-style"},(0,x.tZ)(cs.Z,{span:8,style:{fontWeight:"bold"}},(0,d.t)("Hyperlink")),(0,x.tZ)(cs.Z,{span:16},(0,x.tZ)(hs.Z,{allowClear:!0,value:t,placeholder:(0,d.t)("Enter hyperlink please"),onChange:t=>{const o=t.target.value;n(o),((t={})=>{e(sd[r]({[p.id]:{...p,meta:{...p.meta,...t}}}))})({frameSrc:o})}})))},dd=()=>{const e=(0,o.I0)(),t=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),n=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),r=(0,o.v9)((e=>e.dashboardLayout.present)),s=(0,o.v9)((e=>e.mobileDashboardLayout.present)),l=(0,a.useMemo)((()=>t==i.kB.MOBILE?s:r),[r,s]),u=(0,a.useMemo)((()=>(l[n]||e((0,ss.ks)(void 0)),l[n])),[n,l]);return(0,x.tZ)("div",{css:()=>x.iv`
        position: relative;
        height: 100%;
        .row-style {
          display: flex;
          align-items: center;
          margin-bottom: 26px;
          margin-top: -10px;
        }
        .color-set {
          width: 100%;
          height: 36px;
          border: 1px solid #d9d9d9;
          border-radius: 2px;
          display: flex;
          align-items: center;
          .color-cube {
            width: 20px;
            height: 20px;
            border: 1px solid #d9d9d9;
            margin: 0 10px;
          }
        }
        .disable-modal {
          width: 100%;
          height: 100%;
          position: absolute;
          top: 0;
          left: 0;
          background: rgba(111, 111, 111, 0.6);
        }
      `},(0,x.tZ)(a.Fragment,null,u?(0,x.tZ)(a.Fragment,null,!["DIVIDER","RECTBOX","ARROW","FILTER_SELECT","FILTER_SEARCH_BTN","FILTER_CLEAR_BTN","WEB_COMPONENT"].includes(u.type)&&(0,x.tZ)(Sl,null),["FILTER_SELECT"].includes(u.type)&&(0,x.tZ)(od,null),["FILTER_SEARCH_BTN","FILTER_CLEAR_BTN"].includes(u.type)&&(0,x.tZ)(ad,null),"HEADER"==u.type&&(0,x.tZ)(Rl,null),"DYNAMIC"==u.type&&(0,x.tZ)(Tl,null),"CHART"==u.type&&(0,x.tZ)(td,null),"RECTBOX"==u.type&&(0,x.tZ)(nd,null),"ARROW"==u.type&&(0,x.tZ)(rd,null),"DIVIDER"==u.type&&(0,x.tZ)(id,null),"WEB_COMPONENT"==u.type&&(0,x.tZ)(ld,null)):(0,x.tZ)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},(0,x.tZ)("img",{style:{width:"64px",height:"52px",marginBottom:"15px"},src:(0,rn.VU)("/static/assets/images/resources.png"),alt:""}),(0,x.tZ)("span",null,(0,d.t)("Select components from the left to set component styles")))))};var ud=n(522102);const cd=(0,J.I)(),pd=e=>e.split(/(?:\s|,)+/).filter((e=>e)),hd=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,fd=({dashboardId:e,onHide:t})=>{var n;const{addInfoToast:r,addDangerToast:o}=(0,sn.e1)(),[i,s]=(0,a.useState)(!0),[l,u]=(0,a.useState)(!1),[c,h]=(0,a.useState)(null),[f,g]=(0,a.useState)(""),m=`/api/v1/dashboard/${e}/embedded`,v=!c||pd(f).join()!==c.allowed_domains.join(),b=(0,a.useCallback)((()=>{u(!0),(0,ud.Z)({method:"POST",endpoint:m})({allowed_domains:pd(f)}).then((({result:e})=>{h(e),g(e.allowed_domains.join(", ")),r((0,d.t)("Changes saved."))}),(()=>{o((0,d.t)((0,d.t)("Sorry, something went wrong. The changes could not be saved.")))})).finally((()=>{u(!1)}))}),[m,f]),y=(0,a.useCallback)((()=>{zr.Z.confirm({title:(0,d.t)("Disable embedding?"),content:(0,d.t)("This will remove your current embed configuration."),okType:"danger",onOk:()=>{u(!0),(0,ud.Z)({method:"DELETE",endpoint:m})({}).then((()=>{h(null),g(""),r((0,d.t)("Embedding deactivated.")),t()}),(()=>{o((0,d.t)("Sorry, something went wrong. Embedding could not be deactivated."))})).finally((()=>{u(!1)}))}})}),[m]);if((0,a.useEffect)((()=>{s(!1),(0,ud.Z)({method:"GET",endpoint:m})({}).catch((e=>{if(404===e.status)return{result:null};throw e})).then((({result:e})=>{s(!0),h(e),g(e?e.allowed_domains.join(", "):"")}))}),[e]),!i)return(0,x.tZ)(p.Z,null);const C=cd.get("embedded.documentation.configuration_details"),w=cd.get("embedded.documentation.description"),S=null!=(n=cd.get("embedded.documentation.url"))?n:"https://www.npmjs.com/package/@superset-ui/embedded-sdk";return(0,x.tZ)(a.Fragment,null,c?C?(0,x.tZ)(C,{embeddedId:c.uuid}):(0,x.tZ)("p",null,(0,d.t)("This dashboard is ready to embed. In your application, pass the following id to the SDK:"),(0,x.tZ)("br",null),(0,x.tZ)("code",null,c.uuid)):(0,x.tZ)("p",null,(0,d.t)("Configure this dashboard to embed it into an external web application.")),(0,x.tZ)("p",null,(0,d.t)("For further instructions, consult the")," ",(0,x.tZ)("a",{href:S,target:"_blank",rel:"noreferrer"},w?w():(0,d.t)("Superset Embedded SDK documentation."))),(0,x.tZ)("h3",null,(0,d.t)("Settings")),(0,x.tZ)(Re.xJ,null,(0,x.tZ)("label",{htmlFor:"allowed-domains"},(0,d.t)("Allowed Domains (comma separated)")," ",(0,x.tZ)(mo.V,{tooltip:(0,d.t)("A list of domain names that can embed this dashboard. Leaving this field empty will allow embedding from any domain.")})),(0,x.tZ)($e.II,{name:"allowed-domains",value:f,placeholder:"superset.example.com",onChange:e=>g(e.target.value)})),(0,x.tZ)(hd,null,c?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{onClick:y,buttonStyle:"secondary",loading:l},(0,d.t)("Deactivate")),(0,x.tZ)(se.Z,{onClick:b,buttonStyle:"primary",disabled:!v,loading:l},(0,d.t)("Save changes"))):(0,x.tZ)(se.Z,{onClick:b,buttonStyle:"primary",loading:l},(0,d.t)("Enable embedding"))))},gd=e=>{const{show:t,onHide:n}=e;return(0,x.tZ)(zr.Z,{show:t,onHide:n,title:(0,d.t)("Embed"),hideFooter:!0},(0,x.tZ)(fd,e))};var md=n(85980);const vd=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,bd=(0,y.iK)(hs.Z)`
  ${()=>x.iv`
    .ant-input-group-addon {
      border: 0 none;
      padding-right: 0;
    }
  `}
`,yd=86400,xd=7*yd,Cd=30*yd,wd=e=>{const t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r]=ze.Z.useForm(),[o,i]=(0,a.useState)(!1),[s,l]=(0,a.useState)(!1),{dashboardId:u,onHide:c,shareUrl:p,setPassword:h,expiry:f=Cd,callBackData:g=(()=>{})}=e,[m,v]=(0,a.useState)(f),b=(0,a.useMemo)((()=>[Cd,xd,yd].includes(m)?m:-1),[m]),y=(e=>{-1===e&&(e=f);const t=e%86400,n=t%3600;return{days:Math.floor(e/86400),hours:Math.floor(t/3600),minutes:Math.floor(n/60),seconds:n%60}})(m);(0,a.useEffect)((()=>{if(p){let e=`${p}?standalone=true`;if(s){const t=window.btoa(h);e=`${p}?standalone=true&copyp=${t}`}null==r||r.setFieldsValue({link:`${e}`})}h&&(null==r||r.setFieldsValue({pass:h}))}),[p,h,s]);const{run:C}=(0,md.Z)((async({pass:e})=>{try{var t;if(!e)return;const{json:n}=await ee.Z.post({endpoint:`/api/v1/dashboard/${u}/share_set_pwd`,jsonPayload:{password:e.replace(/\s/g,"")}});null!=n&&null!=(t=n.result)&&t.password}catch{await(null==r?void 0:r.validateFields(["pass"]))}}),{wait:500}),w=e=>{v(e),-1!==e&&ee.Z.post({endpoint:`/api/v1/dashboard/${u}/share_set_expiry`,jsonPayload:{expiry:e}}).then((e=>{var t;const n=(null==e||null==(t=e.json)?void 0:t.result)||{};n&&g(n)}))},S=y.days?y.days:0,Z=y.hours?y.hours:0,k=y.minutes?y.minutes:0,M=y.seconds?y.seconds:0,D=(e,t)=>{if("number"!==typeof e||isNaN(e))return;let n=0;"days"===t&&(n=24*e*60*60+60*Z*60+60*k+M),"hours"===t&&(n=24*S*60*60+60*e*60+60*k+M),"minutes"===t&&(n=24*S*60*60+60*Z*60+60*e+M),w(n)};return(0,x.tZ)(Re.l0,{form:r,layout:"vertical",autoComplete:"off",name:"share-panel",onValuesChange:C},(0,x.tZ)(Re.xJ,{label:(0,d.t)("Share link"),name:"link"},(0,x.tZ)($e.II,{placeholder:"superset.example.com",ref:t,disabled:!0})),(0,x.tZ)(ze.Z.Item,{label:(0,d.t)("Set password"),name:"pass",rules:[{required:!0,validator:()=>{const e=null==r?void 0:r.getFieldValue("pass");return/(?=.*[0-9])(?=.*[A-Z])(?=.*[a-z])(?=.*[\W_])(?=.*[\S])^[0-9A-Za-z\S]{12,20}$/g.test(e)?Promise.resolve():Promise.reject((0,d.t)("The password must be greater than or equal to 12 to less than or equal to 20 characters, and the password must contain at least uppercase letters, lowercase letters, numbers, special characters, etc."))}}]},(0,x.tZ)(bd,{onDoubleClick:()=>{const e=n.current&&n.current.input;e&&e.select()},ref:n,addonAfter:(0,x.tZ)(se.Z,{onClick:()=>{ee.Z.post({endpoint:`/api/v1/dashboard/${u}/share_reset_pwd`,headers:{"Content-Type":"application/json"}}).then((({json:e})=>{var t;const n=null==e||null==(t=e.result)?void 0:t.password;null==r||r.setFieldsValue({pass:n.replace(/\s/g,"")}),null==r||r.setFieldsValue({link:`${p}?standalone=true&pwd=${n}`})}))}},(0,d.t)("Reset")),allowClear:!0,onChange:e=>{i(e.target.value)},onBlur:()=>{o&&Y.ZP.success((0,d.t)("Manually set password successfully"))}})),(0,x.tZ)(Re.xJ,{label:(0,d.t)("Extraction method"),name:"extractionMethod"},(0,x.tZ)(Nl.Z,{onChange:e=>{l(e.target.checked)}},(0,d.t)("Automatic filling and extraction code for sharing links"))),(0,x.tZ)(Re.xJ,{label:(0,d.t)("Period of validity"),name:"handPeriodValidityLogic"},(0,x.tZ)("div",{style:{display:"flex",alignItems:"center"}},(0,x.tZ)(ps.ZP.Group,{onChange:e=>{w(e.target.value)},value:b},(0,x.tZ)(ps.ZP,{value:Cd},(0,d.t)("30 days")),(0,x.tZ)(ps.ZP,{value:xd},(0,d.t)("7 days")),(0,x.tZ)(ps.ZP,{value:yd},(0,d.t)("1 days")),(0,x.tZ)(ps.ZP,{value:-1},(0,d.t)("Custom"))),-1===b&&(0,x.tZ)("div",null,(0,x.tZ)(ll.Z,{style:{width:60},min:0,max:999999,value:S,onChange:e=>{D(e,"days")}}),(0,d.t)("Days"),(0,x.tZ)(ll.Z,{style:{width:60},min:0,max:23,value:Z,onChange:e=>{D(e,"hours")}}),(0,d.t)("Hours"),(0,x.tZ)(ll.Z,{style:{width:60},min:0,max:59,value:k,onChange:e=>{D(e,"minutes")}}),(0,d.t)("Minutes")))),(0,x.tZ)(vd,null,(0,x.tZ)(se.Z,{buttonStyle:"primary",onClick:(e=1)=>{const{link:t,pass:n}=null==r?void 0:r.getFieldsValue(["link","pass"]),o=`${(0,d.t)("Link")}:${t}\n${(0,d.t)("Password")}:${n}`;if(!navigator.clipboard||!window.isSecureContext){let t=document.createElement("textarea");return t.value=o,t.style.position="absolute",t.style.opacity=0,t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise(((n,r)=>{document.execCommand("copy")?n():r(),t.remove(),e&&c(!1)}))}if(navigator.clipboard.writeText(o),void 0===n)return Y.ZP.error((0,d.t)("Please input password"));e&&c(!1),Y.ZP.success((0,d.t)("Copied successfully"))}},(0,d.t)("Copy Link"))))},Sd=e=>{const{show:t,onHide:n}=e;return(0,x.tZ)(zr.Z,{show:t,onHide:n,title:(0,d.t)("Share template"),hideFooter:!0},(0,x.tZ)(wd,e))};const Zd=(0,n(967913).Z)((()=>n.e(34809).then(n.bind(n,34809)))),kd=()=>{const e=(0,o.v9)((({dashboardState:e})=>e.overwriteConfirmMetadata));return(0,x.tZ)(a.Fragment,null,e&&(0,x.tZ)(Zd,{overwriteConfirmMetadata:e}))},Md=(0,J._)(),Dd={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,addWarningToast:l().func.isRequired,user:l().object,dashboardInfo:l().object.isRequired,dataMask:l().object.isRequired,charts:l().objectOf(It.$6).isRequired,layout:l().object.isRequired,mobileLayout:l().object.isRequired,expandedSlices:l().object,customCss:l().string,colorNamespace:l().string,colorScheme:l().string,setColorScheme:l().func.isRequired,setUnsavedChanges:l().func.isRequired,isStarred:l().bool.isRequired,isPublished:l().bool.isRequired,isLoading:l().bool.isRequired,onSave:l().func.isRequired,onChange:l().func.isRequired,fetchFaveStar:l().func.isRequired,fetchCharts:l().func.isRequired,saveFaveStar:l().func.isRequired,savePublished:l().func.isRequired,updateDashboardTitle:l().func.isRequired,editMode:l().bool.isRequired,setEditMode:l().func.isRequired,showBuilderPane:l().func.isRequired,updateCss:l().func.isRequired,logEvent:l().func.isRequired,hasUnsavedChanges:l().bool.isRequired,maxUndoHistoryExceeded:l().bool.isRequired,lastModifiedTime:l().number.isRequired,onComponentPanelOpen:l().func,componentPanelClosable:l().bool,componentPanelOpen:l().bool,onChangeEmulateType:l().func,emulateRatio:l().object,emulateType:l().string,onRefresh:l().func.isRequired,onUndo:l().func.isRequired,onRedo:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,setMaxUndoHistoryExceeded:l().func.isRequired,maxUndoHistoryToast:l().func.isRequired,refreshFrequency:l().number,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,dashboardInfoChanged:l().func.isRequired,dashboardTitleChanged:l().func.isRequired,layoutMode:l().string.isRequired,setLayoutMode:l().func.isRequired},Ed={colorNamespace:void 0,colorScheme:void 0},Rd=e=>x.iv`
  /* 遮挡左侧菜单的问题
  position: sticky;
  */
  top: 0;
  border-bottom: 1px solid ${e.colors.grayscale.light2};
  white-space: nowrap;
`,Td=e=>x.iv`
  color: ${e.colors.primary.dark2};
`,_d=e=>x.iv`
  display: flex;
  align-items: center;

  .action-schedule-report {
    margin-left: ${2*e.gridUnit}px;
  }

  .undoRedo {
    display: flex;
    margin-right: ${2*e.gridUnit}px;
  }
`,Id=(0,y.iK)(de.C0)`
  padding: 0;
  &:hover {
    background: transparent;
  }
`,Od=e=>x.iv`
  color: ${e.colors.grayscale.light1};
  &:hover {
    color: ${e.colors.grayscale.base};
  }
`,Pd=e=>x.iv`
  color: ${e.colors.grayscale.base};
`,zd=e=>x.iv`
  color: ${e.colors.grayscale.light2};
`,Fd=e=>x.iv`
  min-width: ${17*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`,Nd=e=>x.iv`
  padding-left: 6px;
`,$d=y.iK.div`
  ${({topOffset:e,placement:t})=>x.iv`
    height: calc(100vh - ${e}px);
    width: 320px;
    position: fixed;
    top: ${e}px;
    left: ${"right"==t?"calc(100% - 320px)":"0px"};
    // border-right: 1px solid #ebedf0;
    z-index: 1003;

    .ant-drawer {
      &.ant-drawer-left {
        &.ant-drawer-open {
          .ant-drawer-content-wrapper {
            box-shadow: none;
            border-right: 1px solid #ebedf0;
          }
        }
      }
      .ant-drawer-content-wrapper {
        .ant-drawer-content {
          .ant-drawer-wrapper-body {
            .ant-drawer-header {
              padding: 8px 24px;
              .ant-drawer-title {
                font-weight: bold;
                font-size: 14px;
              }
              .ant-drawer-close {
                padding: 12px;
                font-size: 14px;
              }
            }
            .ant-drawer-body {
              padding: 0 20px;
            }
          }
        }
      }
    }
  `}
`,Ld=y.iK.div`
  display: flex;
  align-items: center;
  height: 42px;

  .header-left-item {
    color: #5d9cec;
    cursor: pointer;
    margin-right: 18px;
    display: flex;
    align-items: center;
    font-size: 14px;
    padding: 2px 4px;
    :hover {
      background: #edeff1;
    }
    .anticon {
      font-size: 20px;
      color: #5d9cec;
    }
  }
`,Bd=y.iK.div`
  display: flex;
  align-items: center;
  color: #101010;
  font-size: 14px;
  font-family: PingFang SC-Regular, PingFang SC;
  img {
    width: 20px;
    height: 20px;
  }
  .right-btn-item {
    display: flex;
    align-items: center;
    cursor: pointer;
    transition: transform 0.3s;
    margin-right: 20px;
    padding: 2px 4px;
    :hover {
      background: #edeff1;
    }
    img {
      margin-right: 4px;
    }
    .anticon {
      font-size: 20px;
    }
  }
  .right-btn-line {
    width: 1px;
    height: 20px;
    background: #dddddd;
  }
  .view-switch {
    width: 100px;
    height: 30px;
    border-radius: 40px;
    background: #f5f6fa;
    display: flex;
    position: relative;
    .switch-item {
      width: 50%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
      cursor: pointer;
    }
    .switch-selected-bg {
      border: 1px solid #b8d3f5;
      border-radius: 40px;
      background: #f5f9ff;
      position: absolute;
      left: 0;
      top: 0;
      z-index: 1;
    }
    .switch-left {
    }
  }
`,Ad={1:{name:(0,d.t)("Charts"),component:(0,x.tZ)(tr,null)},2:{name:(0,d.t)("Layout elements"),component:(0,x.tZ)(Sr,null)},3:{name:(0,d.t)("Filter components"),component:(0,x.tZ)(as,null)},4:{name:(0,d.t)("Dashboard settings"),component:(0,x.tZ)(gl,null),placement:"right"},5:{name:(0,d.t)("Component settings"),component:(0,x.tZ)(dd,null),placement:"right"}};class jd extends a.PureComponent{static discardChanges(){const e=new URL(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){var t,n;super(e),this.showEmbedModal=()=>{this.setState({showingEmbedModal:!0})},this.showingShareModal=async()=>{var e;ee.Z.post({endpoint:`/api/v1/dashboard/${null==(e=this.props)?void 0:e.dashboardInfo.id}/share`,headers:{"Content-Type":"application/json"}}).then((e=>{var t,n;400===(null==(t=e.response)?void 0:t.status)?Y.ZP.error("\u770b\u677f\u5df2\u5206\u4eab"):200===(null==(n=e.response)?void 0:n.status)?(this.setState({showShareModal:!0}),this.handleShare(e.json)):Y.ZP.error("\u63a5\u53e3\u5f02\u5e38")})).catch((e=>{Y.ZP.error("\u63a5\u53e3\u5f02\u5e38")}))},this.hideShareModal=()=>{this.setState({showShareModal:!1})},this.hideEmbedModal=()=>{this.setState({showingEmbedModal:!1})},this.handleShare=e=>{var t,n,r;this.setState({shareUrl:null==(t=e.result)?void 0:t.url,setPassword:null==(n=e.result)?void 0:n.password,expiry:null==(r=e.result)?void 0:r.expiry})},this.ReQRCode=e=>{var t,n;const r={urlParams:function(){const e=function(e){const t=new URLSearchParams;return new URLSearchParams(window.location.search).forEach(((n,r)=>{e.includes(r)||t.append(r,n)})),t}(me.Rv),t=(0,et.De)();return Z()(t)||e.append(me.KD.preselectFilters.name,JSON.stringify(serializeActiveFilterValues((0,et.De)()))),function(e){const t=[];return e.forEach(((e,n)=>t.push([n,e]))),t}(e)}(),dataMask:null==(t=this.props)?void 0:t.dataMask,activeTabs:[]};ee.Z.post({endpoint:`api/v1/dashboard/${null==(n=this.props)?void 0:n.dashboardInfo.id}/permalink?temporary=temporary`,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((t=>{this.setState({qrUrl:t.json.url}),"gotoPcView"===e&&window.open(t.json.url+"&view=true")})).catch((e=>{this.setState({qrUrl:""})}))},this.handleClick=()=>{this.overwriteDashboard("qrcode")},this.handView=()=>{this.togglefullscreen()},this.handPcView=()=>{this.togglefullscreen()},this.handleCopy=()=>{const e=""+(this.state.qrUrl+"&view=true");if(!navigator.clipboard||!window.isSecureContext){let t=document.createElement("textarea");return t.value=`${e} `,t.style.position="absolute",t.style.opacity=0,t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise(((e,n)=>{document.execCommand("copy")?e():n(),t.remove()}))}navigator.clipboard.writeText(`${e}`)},this.handleOnChangeEmulateType=e=>{this.setState({emulateType:e}),this.props.onChangeEmulateType({emulateType:e})},this.handleOnChangeEmulateWidth=e=>{const t={emulateType:"",emulateRatio:{width:parseInt(e.target.value)}};this.setState({emulateType:""}),this.props.onChangeEmulateType(t)},this.handleOnChangeEmulateHeight=e=>{const t={emulateType:"",emulateRatio:{height:parseInt(e.target.value)}};this.setState({emulateType:""}),this.props.onChangeEmulateType(t)},this.togglefullscreen=()=>{const{layoutType:e}=this.props;document.getElementById("dash-tabpan").requestFullscreen({navigationUI:"show"})},this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,emphasizeRedo:!1,showingPropertiesModal:!1,isDropdownVisible:!1,componentPanelOpen:e.componentPanelOpen?1:0,showComponentPropertyPane:void 0,emulateType:e.emulateType,emulateWidth:(null==(t=e.emulateRatio)?void 0:t.width)||350,emulateHeight:(null==(n=e.emulateRatio)?void 0:n.height)||680,isPerm:sessionStorage.getItem("isperm")},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.toggleLayoutMode=this.toggleLayoutMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.setIsDropdownVisible=this.setIsDropdownVisible.bind(this),this.togglefullscreen=this.togglefullscreen.bind(this),this.setViewType=this.setViewType.bind(this)}componentDidMount(){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}if(this.props.emulateType!==e.emulateType){const{emulateType:e}=this.props;this.setState({emulateType:e})}if(this.props.emulateRatio!==e.emulateRatio){const{emulateRatio:e}=this.props;this.setState({emulateWidth:e.width,emulateHeight:e.height})}}UNSAFE_componentWillReceiveProps(e){Be.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>Be.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded()}componentWillUnmount(){Ot(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardInfo.dashboard_title!==e&&(t(e),n())}setIsDropdownVisible(e){this.setState({isDropdownVisible:e})}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(ie.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){var n,r;const{dashboardInfo:o}=this.props,i=(null==(n=o.common)||null==(r=n.conf)?void 0:r.DASHBOARD_AUTO_REFRESH_INTERVALS).find((t=>Number(t[0])===e/1e3));t=i?(0,d.t)(i[1]):M().duration(e,"millisecond").humanize()}this.refreshTimer=function({interval:e=0,periodicRender:t,refreshTimer:n}){return Ot(n),e>0?setInterval(t,e):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:r,charts:o,dashboardInfo:i}=this.props,{metadata:a}=i,s=a.timed_refresh_immune_slices||[],l=Object.values(o).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return r(ie.S,{interval:e,chartCount:l.length}),this.props.addWarningToast((0,d.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===i.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(l,!1,.2*e,i.id):n(l,!0,.2*e,i.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(ie.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode),this.props.cleanUndo()}toggleLayoutMode(e){this.props.setLayoutMode(e.target.value);const t=e.target.value,{dashboardConfig:n={},setDashboadConfig:r}=this.props;r({...n,layoutMode:t})}overwriteDashboard(e,t=(()=>{})){var n,r,o;const{layout:i,mobileLayout:a,colorScheme:s,colorNamespace:l,customCss:u,dashboardInfo:c,refreshFrequency:p,shouldPersistRefreshFrequency:h,lastModifiedTime:f,slug:g,fitConfig:m,floats:v,layoutMode:b}=this.props,y=h?p:null==(n=c.metadata)?void 0:n.refresh_frequency,x=(null==c||null==(r=c.metadata)?void 0:r.color_scheme)||s,C=(null==c||null==(o=c.metadata)?void 0:o.color_namespace)||l,w=Object.fromEntries((0,te.ZP)().getColorMap());i.ROOT_ID.config={floats:v,fitConfig:m};const S={certified_by:c.certified_by,certification_details:c.certification_details,css:u,dashboard_title:c.dashboard_title,last_modified_time:f,owners:c.owners,roles:c.roles,slug:g,third_tags:c.third_tags,metadata:{...null==c?void 0:c.metadata,color_namespace:C,color_scheme:x,positions:i,refresh_frequency:y,shared_label_colors:w},mobile_metadata:{...null==c?void 0:c.mobile_metadata,color_namespace:C,color_scheme:x,positions:a,refresh_frequency:y,shared_label_colors:w},adaptation_equipment:b.toLowerCase()},Z=(0,pe.o)(i).length,k=c.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||Be.Bu;Z>=k?this.props.addDangerToast((0,d.t)("Your dashboard is too large. Please reduce its size before saving it.")):(Z>=.9*k&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(S,c.id,Be.TN,e,t))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}setViewType(e){e&&this.props.setDashboadConfig({...this.props.dashboardConfig,layoutType:e})}get dashboardBasicInfo(){const{created_by:e,created_on:t,changed_by:n,changed_on:r}=this.props.dashboardInfo.changedInfo||{};return{created_by:e,created_on:t,changed_by:n,changed_on:r}}render(){var e,t,n,r,o,s,l,c,p;const{layout:h,mobileLayout:f,expandedSlices:g,customCss:m,colorNamespace:v,dataMask:b,setColorScheme:y,setUnsavedChanges:C,colorScheme:w,onUndo:S,onRedo:Z,undoLength:k,redoLength:M,onChange:D,onSave:E,updateCss:R,editMode:T,isPublished:_,user:I,dashboardInfo:O,hasUnsavedChanges:P,isLoading:z,refreshFrequency:F,shouldPersistRefreshFrequency:N,setRefreshFrequency:$,lastModifiedTime:L,logEvent:B,layoutMode:A,showComponentPropertyPane:j,viewType:H,layoutType:q}=this.props,U=O.dash_edit_perm,V=O.dash_share_perm,W=O.dash_save_perm,G=(null==O||null==(e=O.metadata)?void 0:e.layout_mode)||i.kB.PC,Y=(0,oe.cr)(u.T.EMBEDDED_SUPERSET)&&(0,ue.R)("can_set_embedded","Dashboard",I.roles),J=null==(t=O.common)||null==(n=t.conf)?void 0:n.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,ee=null==(r=O.common)||null==(o=r.conf)?void 0:o.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE,te=Md.get("dashboard.nav.right"),ie=(0,ye.VW)();return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{css:Rd,"data-test":"dashboard-header-container","data-test-id":O.id,className:"dashboard-header-container"},T&&0!==this.state.componentPanelOpen&&"true"!==ie.osp.get("view")&&(0,x.tZ)($d,{topOffset:91,placement:null==(s=Ad[this.state.componentPanelOpen])?void 0:s.placement,id:"StyledComponentPanel"},(0,x.tZ)(X.Z,{title:null==(l=Ad[this.state.componentPanelOpen])?void 0:l.name,placement:"right"==(null==(c=Ad[this.state.componentPanelOpen])?void 0:c.placement)?"right":"left",closable:this.props.componentPanelClosable,mask:!1,onClose:()=>this.setState((()=>({componentPanelOpen:0}))),visible:0!==this.state.componentPanelOpen,getContainer:!1,style:{position:"absolute",width:"320px"}},null==(p=Ad[this.state.componentPanelOpen])?void 0:p.component)),(0,x.tZ)(Pt.u,{editableTitleProps:{title:O.dashboard_title,canEdit:U&&T,onSave:this.handleChangeText,placeholder:(0,d.t)("Add the name of the dashboard"),label:(0,d.t)("Dashboard title"),showTooltip:!1},certificatiedBadgeProps:{certifiedBy:O.certified_by,details:O.certification_details},faveStarProps:{itemId:O.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0},titlePanelAdditionalItems:[!T&&(0,x.tZ)(ls.Z,this.dashboardBasicInfo)],rightPanelAdditionalItems:(0,x.tZ)("div",{className:"button-container"},(0,x.tZ)(a.Fragment,null,"true"!==ie.osp.get("view")&&(0,x.tZ)(Bd,null,!T&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{className:"right-btn-item",onClick:this.forceRefresh},(0,x.tZ)(ae.Z.Reload,null),(0,x.tZ)("span",null,(0,d.t)("Refresh"))),G!==i.kB.MOBILE&&(0,x.tZ)("div",{className:"right-btn-item",onClick:this.togglefullscreen},(0,x.tZ)(ae.Z.FullScreen,null),(0,x.tZ)("span",null,(0,d.t)("Full screen"))),(0,ye.eY)(me.KD.standalone)?null:(0,x.tZ)("div",{className:"right-btn-line",style:{marginRight:"15px"}}),(0,ye.eY)(me.KD.standalone)?null:(0,x.tZ)("div",{css:_d},te&&(0,x.tZ)(te,null),(0,x.tZ)("div",null,(0,x.tZ)(de.Gj,{trigger:["click"],overlay:(0,x.tZ)(wt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,sliceEntities:this.props.sliceEntities,charts:this.props.charts,dashboardId:O.id,dashboardTitle:O.dashboard_title,dashboardInfo:O,dataMask:b,layout:h,mobileLayout:f,expandedSlices:g,customCss:m,colorNamespace:v,colorScheme:w,onSave:E,onChange:D,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:F,shouldPersistRefreshFrequency:N,setRefreshFrequency:$,updateCss:R,editMode:T,hasUnsavedChanges:P,userCanEdit:U,userCanShare:V,userCanSave:W,userCanCurate:Y,isLoading:z,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,shareTo:this.showingShareModal,refreshLimit:J,refreshWarning:ee,lastModifiedTime:L,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible,logEvent:B,isPerm:this.state.isPerm}),getPopupContainer:e=>e.closest(".header-with-actions"),visible:this.state.isDropdownVisible,onVisibleChange:this.setIsDropdownVisible},(0,x.tZ)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",marginRight:"10px"}},(0,x.tZ)(ae.Z.More,null),(0,x.tZ)("span",null,(0,d.t)("More"))))),U&&(0,x.tZ)(se.Z,{buttonStyle:"secondary",onClick:this.toggleEditMode,"data-test":"query-save-button",className:"action-button",css:Td,"aria-label":(0,d.t)("Edit dashboard"),icon:(0,x.tZ)(ne.default,null)},(0,d.t)("Edit dashboard")))),T&&W&&(0,x.tZ)(se.Z,{css:Fd,buttonSize:"small",disabled:!T&&!P,buttonStyle:"primary",onClick:this.overwriteDashboard,"data-test":"header-save-button","aria-label":(0,d.t)("Save")},(0,d.t)("Save"))))),backButtonProps:T&&(0,x.tZ)(se.Z,{css:Nd,buttonStyle:"link",buttonSize:"default",onClick:this.constructor.discardChanges,"data-test":"discard-changes-button","aria-label":(0,d.t)("Discard")},(0,x.tZ)("div",null,(0,x.tZ)(re.default,{title:(0,d.t)("Back to all")}))),additionalActionsMenu:(0,x.tZ)(wt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,sliceEntities:this.props.sliceEntities,charts:this.props.charts,dashboardId:O.id,dashboardTitle:O.dashboard_title,dashboardInfo:O,dataMask:b,layout:h,mobileLayout:f,expandedSlices:g,customCss:m,colorNamespace:v,colorScheme:w,onSave:E,onChange:D,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:F,shouldPersistRefreshFrequency:N,setRefreshFrequency:$,updateCss:R,editMode:T,hasUnsavedChanges:P,userCanEdit:U,userCanShare:V,userCanSave:W,userCanCurate:Y,isLoading:z,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,shareTo:this.showingShareModal,refreshLimit:J,refreshWarning:ee,lastModifiedTime:L,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible,logEvent:B}),subPanelAdditionalItems:"true"!==ie.osp.get("view")&&T&&(0,x.tZ)(Ft,{leftPanelAdditionalItems:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(Ld,null,(0,x.tZ)("div",{className:"header-left-item",onClick:()=>{this.setState((()=>({componentPanelOpen:1})))}},(0,x.tZ)(ae.Z.Chart,null),(0,d.t)("Charts")),(0,x.tZ)("div",{className:"header-left-item",onClick:()=>{this.setState((()=>({componentPanelOpen:2})))}},(0,x.tZ)(ae.Z.LayoutElement,null),(0,d.t)("Layout elements")),(0,x.tZ)("div",{className:"header-left-item",onClick:()=>{this.setState((()=>({componentPanelOpen:3})))}},(0,x.tZ)(ae.Z.FilterCom,null),(0,d.t)("Filter components")))),centerPanelAdditionalItems:A===i.kB.MOBILE&&(0,x.tZ)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},(0,x.tZ)("div",{style:{marginRight:"16px",width:"200px"}},(0,x.tZ)(de.Ph,{size:"small",placeholder:(0,d.t)("Please select a simulation device"),value:this.state.emulateType,onChange:this.handleOnChangeEmulateType,options:[...i.zn.map((e=>({label:e.label,value:e.type})))]})),(0,x.tZ)($e.II,{type:"number",size:"small",value:this.state.emulateWidth.toString(),style:{width:"70px"},onChange:this.handleOnChangeEmulateWidth,disabled:""!==this.state.emulateType}),(0,x.tZ)("span",{style:{padding:"0 5px"}},"x"),(0,x.tZ)($e.II,{type:"number",size:"small",value:this.state.emulateHeight.toString(),style:{width:"70px"},onChange:this.handleOnChangeEmulateHeight,disabled:""!==this.state.emulateType})),rightPanelAdditionalItems:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(Bd,null,W&&(0,x.tZ)("div",{className:"button-container","data-test":"dashboard-edit-actions",style:{position:"relative",display:"flex",alignItems:"center"}},T&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{css:_d,style:{display:"flex",alignItems:"center"}},(0,x.tZ)("div",{className:"undoRedo"},(0,x.tZ)(ce.u,{id:"dashboard-undo-tooltip",title:(0,d.t)("Undo the action")},(0,x.tZ)(Id,{type:"text",disabled:k<1},(0,x.tZ)(ae.Z.Undo,{css:[Od,this.state.emphasizeUndo&&Pd,k<1&&zd,"",""],onClick:k&&S,"data-test":"undo-action",iconSize:"xl"}))),(0,x.tZ)(ce.u,{id:"dashboard-redo-tooltip",title:(0,d.t)("Redo the action")},(0,x.tZ)(Id,{type:"text",disabled:M<1},(0,x.tZ)(ae.Z.Redo,{css:[Od,this.state.emphasizeRedo&&Pd,M<1&&zd,"",""],onClick:M&&Z,"data-test":"redo-action",iconSize:"xl"}))))),(0,x.tZ)("div",{className:"right-btn-item",onClick:this.forceRefresh},(0,x.tZ)(ae.Z.Reload,null),(0,x.tZ)("span",null,(0,d.t)("Refresh"))),this.props.layoutMode===i.kB.MOBILE&&(0,x.tZ)(Q.Z,{content:(0,x.tZ)(a.Fragment,null,this.state.qrUrl&&(0,x.tZ)(K,{id:"qrCode",value:this.state.qrUrl,size:160,fgColor:"#000000",style:{marginLeft:25},imageSettings:{src:"logoUrl",height:100,width:100,excavate:!0}}),(0,x.tZ)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:210}},(0,x.tZ)("div",null,"1.",(0,d.t)("Scanning the QR code can preview the last saved result, and the QR code is valid for 10 minutes.")),(0,x.tZ)("div",null,"2.",(0,d.t)("Only on the public network or the same local area network can mobile scanning be used.")),(0,x.tZ)("a",{onClick:this.ReQRCode},(0,d.t)("Reset QR code")),(0,x.tZ)("a",{style:{marginLeft:"20px"},onClick:this.handleCopy},(0,d.t)("Copy preview link"))))},(0,x.tZ)("div",{className:"right-btn-item"},(0,x.tZ)(ae.Z.FullScreen,null),(0,x.tZ)("span",{onMouseOver:()=>{this.overwriteDashboard("qrcode"),this.state.qrUrl||this.ReQRCode()},onClick:this.handleClick},(0,d.t)("Preview")))),this.props.layoutMode===i.kB.PC&&(0,x.tZ)("div",{className:"right-btn-item"},(0,x.tZ)(ae.Z.FullScreen,null),(0,x.tZ)("span",{onClick:this.handPcView},(0,d.t)("Preview"))),(0,x.tZ)("div",{style:{marginRight:"15px"}},(0,x.tZ)(de.Gj,{trigger:["click"],overlay:(0,x.tZ)(wt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,sliceEntities:this.props.sliceEntities,charts:this.props.charts,dashboardId:O.id,dashboardTitle:O.dashboard_title,dashboardInfo:O,dataMask:b,layout:h,mobileLayout:f,expandedSlices:g,customCss:m,colorNamespace:v,colorScheme:w,onSave:E,onChange:D,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:F,shouldPersistRefreshFrequency:N,setRefreshFrequency:$,updateCss:R,editMode:T,hasUnsavedChanges:P,userCanEdit:U,userCanShare:V,userCanSave:W,userCanCurate:Y,isLoading:z,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,shareTo:this.showingShareModal,refreshLimit:J,refreshWarning:ee,lastModifiedTime:L,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible,logEvent:B}),getPopupContainer:e=>e.closest(".header-with-actions"),visible:this.state.isDropdownVisible,onVisibleChange:this.setIsDropdownVisible},(0,x.tZ)("div",{className:"right-btn-item",style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:"14px"}},(0,x.tZ)(ae.Z.More,null),(0,x.tZ)("span",null,(0,d.t)("More"))))),(0,x.tZ)("div",{className:"header-right-item right-item-line"}),(0,x.tZ)(le.Y.Group,{defaultValue:i.kB.PC,value:A,buttonStyle:"solid",onChange:this.toggleLayoutMode},(0,x.tZ)(le.Y.Button,{value:i.kB.PC},(0,x.tZ)(ae.Z.DesktopOutlined,{iconSize:"l"})),(0,x.tZ)(le.Y.Button,{value:i.kB.MOBILE},(0,x.tZ)(ae.Z.MobileOutlined,{iconSize:"l"})))))))}),showFaveStar:(null==I?void 0:I.userId)&&(null==O?void 0:O.id),showTitlePanelItems:!0}),this.state.showingPropertiesModal&&(0,x.tZ)(_t.Z,{dashboardId:O.id,dashboardInfo:O,dashboardTitle:O.dashboard_title,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;y(e.colorScheme),t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),C(!0),n(e.title)},onlyApply:!0}),(0,x.tZ)(kd,null),(0,x.tZ)(gd,{show:this.state.showingEmbedModal,onHide:this.hideEmbedModal,dashboardId:O.id}),this.state.showShareModal&&(0,x.tZ)(Sd,{show:this.state.showShareModal,onHide:this.hideShareModal,dashboardId:O.id,log1:this.state.log1,token:this.state.token,shareUrl:this.state.shareUrl,setPassword:this.state.setPassword,expiry:this.state.expiry,callBackData:(e={})=>{this.setState({expiry:e.expiry})}}),(0,x.tZ)(x.xB,{styles:x.iv`
              .ant-menu-vertical {
                border-right: none;
              }
            `})))}}jd.propTypes=Dd,jd.defaultProps=Ed;const Hd=jd;function qd(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var Ud=n(641295),Vd=n(797381),Wd=n(161358);const Gd=(0,o.$j)((function({dashboardLayout:e,mobileDashboardLayout:t,dashboardState:n,reports:r,dashboardInfo:o,charts:a,dataMask:s,user:l,sliceEntities:d}){var u,c,p,h;return{dashboardInfo:o,undoLength:e.past.length,redoLength:e.future.length,layout:e.present,mobileLayout:t.present,expandedSlices:n.expandedSlices,refreshFrequency:n.refreshFrequency,shouldPersistRefreshFrequency:!!n.shouldPersistRefreshFrequency,customCss:n.css,colorNamespace:n.colorNamespace,colorScheme:n.colorScheme,charts:a,dataMask:s,user:l,isStarred:!!n.isStarred,isPublished:!!n.isPublished,isLoading:qd(a),hasUnsavedChanges:!!n.hasUnsavedChanges,maxUndoHistoryExceeded:!!n.maxUndoHistoryExceeded,lastModifiedTime:Math.max(n.lastModifiedTime,o.last_modified_time),editMode:!!n.editMode,layoutMode:(null==o||null==(u=o.metadata)?void 0:u.layout_mode)||i.kB.PC,emulateRatio:n.emulateRatio,slug:o.slug,metadata:o.metadata,reports:r,sliceEntities:(null==d?void 0:d.slices)||{},showComponentPropertyPane:n.showComponentPropertyPane,viewType:n.viewType,fitConfig:(null==n||null==(c=n.dashboardConfig_old)?void 0:c.fitConfig)||{mode:"auto"},floats:(null==(p=n.dashboardConfig_old)?void 0:p.floats)||[],layoutType:null==o||null==(h=o.metadata)?void 0:h.layout_type,dashboardConfig:o.metadata}}),(function(e){return(0,r.DE)({addSuccessToast:rt.ws,addDangerToast:rt.Gb,addWarningToast:rt.Dz,onUndo:vl.Ou,onRedo:vl.az,cleanUndo:vl.B6,setEditMode:ss.Mb,showBuilderPane:ss.Jn,setColorScheme:ss.uW,setUnsavedChanges:ss.if,fetchFaveStar:ss.Lb,saveFaveStar:ss.TN,savePublished:ss.dr,fetchCharts:ss.Mn,updateDashboardTitle:vl.A7,updateCss:ss.Sn,onChange:ss.z2,onSave:ss.M8,setMaxUndoHistoryExceeded:ss.uN,maxUndoHistoryToast:ss.Qt,logEvent:Vd.logEvent,setRefreshFrequency:ss.fE,onRefresh:ss.Yy,dashboardInfoChanged:Ud.a8,dashboardTitleChanged:vl.Ww,updateDataMask:w.updateDataMask,fetchUISpecificReport:Wd.Aw,setLayoutMode:ss.YA,setShowComponentPropertyPane:ss.ks,setViewType:ss.ky,setDashboadConfig:ss.Pz},e)}))(Hd),Kd=y.iK.div`
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,Yd=y.iK.span`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Xd=({icon:e,label:t,onClick:n})=>(0,x.tZ)(Kd,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),n(e)}},e,t&&(0,x.tZ)(Yd,null,t));var Qd=n(645433),Jd=n(781395),eu=n(991914),tu=n(616550),nu=n(112515),ru=n(599543),ou=n(340219),iu=n(229147),au=n(138270),su=n(473727),lu=n(67701),du=n(188694),uu=n(732873);const cu=({form:e,scope:t,chartId:n})=>{const r=(0,$o.NW)(),o=e.getFieldValue("scope"),i=e.getFieldValue("scoping");return(0,x.tZ)(di,{updateFormValues:t=>{((e,t)=>{e.setFieldsValue({...t})})(e,{...t})},filterScope:t,chartId:n,formFilterScope:o,forceUpdate:r,formScopingType:i})},pu=({isOpen:e,chartId:t,onClose:n})=>{var r,i;const s=(0,o.I0)(),[l]=de.qz.useForm(),u=(0,o.v9)((({dashboardInfo:e})=>{var t;return null==e||null==(t=e.metadata)?void 0:t.chart_configuration})),c=(0,o.v9)((e=>e.charts)),p=(0,o.v9)((e=>e.dashboardLayout.present)),h=null==u||null==(r=u[t])||null==(i=r.crossFilters)?void 0:i.scope,f=()=>{const e=(0,uu.Q)(l.getFieldValue("scope"),c,p);s((0,Ud.Aw)({...u,[t]:{id:t,crossFilters:{scope:l.getFieldValue("scope"),chartsInScope:e}}})),n()};return(0,x.tZ)(zr.o,{visible:e,maskClosable:!1,title:(0,d.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:n,onOk:f,centered:!0,"data-test":"cross-filter-scoping-modal",footer:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{key:"cancel",buttonStyle:"secondary","data-test":"cross-filter-scoping-modal-cancel-button",onClick:n},(0,d.t)("Cancel")),(0,x.tZ)(se.Z,{key:"submit",buttonStyle:"primary",onClick:f,"data-test":"cross-filter-scoping-modal-save-button"},(0,d.t)("Save")))},(0,x.tZ)(ga,{preserve:!1,form:l,layout:"vertical"},(0,x.tZ)(cu,{form:l,scope:h,chartId:t})))};var hu=n(607739),fu=n.n(hu),gu=n(183482);const mu=y.iK.div`
  width: 100%;
  display: flex;
  align-items: center;
  margin: 10px 0px;
`,vu=[{label:"\u8ba1\u6570",value:"total_count"},{label:"\u5360\u6bd4",value:"total_proportion"}],bu=vu.map((e=>e.value)),yu={first_cate_name:"",second_cate_name:"",third_cate_name:""},xu=(e,t)=>{const[n,r]=(0,a.useState)(),[i,s]=(0,a.useState)([]),[l,u]=(0,a.useState)([]),[c,p]=(0,a.useState)(void 0),[h,f]=(0,a.useState)([]),[g,m]=(0,a.useState)(""),[v,b]=(0,a.useState)([]),[y,C]=(0,a.useState)(yu),[S,Z]=(0,a.useState)(y.third_cate_name),[k,M]=(0,a.useState)([]),[D,E]=(0,a.useState)([]),[R,T]=(0,a.useState)(bu),_=(0,o.v9)((e=>e)),I=(0,o.I0)(),{sliceEntities:O={},charts:P={},datasources:z={},dataMask:F={}}=_,{slices:N={}}=O,$=(null==F?void 0:F[null==n?void 0:n.value])||{},L=Object.values(P).filter((e=>{var t,n;return"pivot_table_v2"===(null==e||null==(t=e.form_data)?void 0:t.viz_type)&&(null==e||null==(n=e.form_data)?void 0:n.enableCrossVariable)})).map((e=>{var t,n,r;const o=N[null==e?void 0:e.id];return{label:null==o?void 0:o.slice_name,value:null==o?void 0:o.slice_id,table_id:null==o||null==(t=o.form_data)||null==(n=t.datasource)||null==(r=n.split("_"))?void 0:r[0]}})),B=(e=[],t)=>e.map((e=>{const n=e[t];return{...e,label:n,value:n}})),A=B(i.filter((e=>"\u662f"===(null==e?void 0:e.is_cross))),"field_code"),j=(e,t)=>{const n=fu()(e,t);return Object.keys(n).map((e=>{var r,o;const i=null==n||null==(r=n[e])||null==(o=r[0])?void 0:o[t];return{label:i,value:i}}))},H=(e,t)=>{null==$||$.ownState};(0,a.useImperativeHandle)(t,(()=>({handleCrossVariableSubmit:()=>{q()}})));const q=()=>{((e,t)=>{const n={...$,ownState:e};I((0,w.updateDataMask)(t,n))})({chooseTable:n,chooseCrossValueList:D,statisticalDimension:y,statisticalIndicators:R},null==n?void 0:n.value)};return(0,x.tZ)("div",{css:()=>[x.iv`
  position: relative;
`],"data-test":"cross-variable-flex"},(0,x.tZ)("div",null,"\u8bf7\u9009\u62e9\u900f\u89c6\u8868"),(0,x.tZ)(De.Z,{options:L,style:{margin:"10px 0px"},onSelect:(e,t)=>{var n;r(t),(async e=>{e&&ee.Z.get({endpoint:`/api/v1/explore/?slice_id=${e}`}).then((e=>{var t,n,r,o,i,a,l;const d=(null==e||null==(t=e.json)||null==(n=t.result)||null==(r=n.dataset)?void 0:r.columns)||[],c=B(d,"column_name");M(c);const p=(null==e||null==(o=e.json)||null==(i=o.result)||null==(a=i.dataset)?void 0:a.categories)||[],h=null==p||null==(l=p[0])?void 0:l.id;if(h){const e={category_id:h};ee.Z.post({endpoint:"api/v1/sqllab/execute/get_columns_values/",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((({json:e=[]})=>{const t=e.map((e=>null==e?void 0:e.field_code)),n=c.filter((e=>!t.includes(null==e?void 0:e.column_name))).map((e=>{const t=null==e?void 0:e.column_name;return{field_code:t,field_name:t,first_cate:"\u5176\u4ed6\u5206\u7ec4",is_cross:"\u5426",second_cate:"\u5176\u4ed6\u5206\u7ec4"}})),r=[...e,...n];s(r);const o=j(r,"first_cate");u(o)})).catch((e=>{}))}}))})(null==t?void 0:t.value);const o=(null==(n=P[null==t?void 0:t.value])?void 0:n.form_data)||{},{groupbyColumns:i=[],groupbyRows:a=[]}=o,l=i.map(((e,t)=>({index:t,value:e}))),d={...yu,third_cate_name:(null==a?void 0:a[0])||""};E(l),C(d),T(bu),p(""),f([]),m(""),b([]),Z("")}}),n&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",null,"\u4ea4\u53c9\u53d8\u91cf",(0,x.tZ)(zl.default,{onClick:()=>{(()=>{var e;if(D.length>=5)return void I((0,rt.Gb)((0,d.t)("at most add 5 fields")));if(D.filter((e=>""===e.value)).length>0)return void I((0,rt.Gb)((0,d.t)("there are unselected cross variables")));const t=D.length?D.map((e=>e.index)):[0],n=Math.max(...t)+1,r=D.map((e=>e.value)),o=A.filter((e=>!r.includes(null==e?void 0:e.value)));E([...D,{index:n,value:null==o||null==(e=o[0])?void 0:e.value}])})()}})),D.map(((e,t)=>(0,x.tZ)(mu,null,(0,x.tZ)(De.Z,{options:A,value:null==e?void 0:e.value,onSelect:(t,n)=>{const r=JSON.parse(JSON.stringify(D));r.forEach((n=>{n.index===e.index&&(n.value=t)})),E(r)},style:{with:"90%"}}),(0,x.tZ)(gu.default,{onClick:()=>{(e=>{if(D.length<=1)return void I((0,rt.Gb)((0,d.t)("must select at least 1 column")));const t=[...D].filter((t=>t.index!==e.index));E(t),H("chooseCrossValueList",t)})(e)}})))),(0,x.tZ)("div",null,"\u7edf\u8ba1\u7ef4\u5ea6"),(0,x.tZ)(mu,null,(0,x.tZ)(De.Z,{options:l,onSelect:(e,t)=>{p(e);const n=j(i.filter((t=>t.first_cate===e)),"second_cate");f(n)}})),(0,x.tZ)(mu,null,(0,x.tZ)(De.Z,{options:h,onSelect:(e,t)=>{m(e);const n=j(i.filter((e=>e.first_cate===c)).filter((t=>t.second_cate===e)),"field_code");b(n)}})),(0,x.tZ)(mu,null,(0,x.tZ)(De.Z,{options:v,onSelect:(e,t)=>{Z(e);const n={...y};n.third_cate_name=e,C(n)}})),(0,x.tZ)("div",null,"\u7edf\u8ba1\u6307\u6807"),(0,x.tZ)(mu,null,(0,x.tZ)(Nl.Z.Group,{value:R,onChange:(e,t)=>{T(e),n&&H("statisticalIndicators",e)}},vu.map((e=>(0,x.tZ)(Nl.Z,{disabled:1===R.length&&e.value===(null==R?void 0:R[0]),value:e.value},e.label)))))))},Cu=(0,a.forwardRef)(xu),wu=e=>{const{isOpen:t,onClose:n}=e,[r]=((0,o.I0)(),de.qz.useForm()),i=(0,a.useRef)(),s=()=>{var e;null==i||null==(e=i.current)||null==e.handleCrossVariableSubmit||e.handleCrossVariableSubmit(),n()};return(0,x.tZ)(zr.o,{visible:t,maskClosable:!1,title:(0,d.t)("Select Cross Variable"),width:"30%",destroyOnClose:!0,onCancel:n,onOk:s,centered:!0,"data-test":"cross-variable-filter-modal",footer:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{key:"cancel",buttonStyle:"secondary","data-test":"cross-variable-filter-modal-cancel-button",onClick:n},(0,d.t)("Cancel")),(0,x.tZ)(se.Z,{key:"submit",buttonStyle:"primary",onClick:s,"data-test":"cross-variable-filter-modal-save-button"},(0,d.t)("Save")))},(0,x.tZ)(ga,{preserve:!1,form:r,layout:"vertical"},(0,x.tZ)(Cu,{ref:i})))},Su=e=>{if((0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB))return e?(0,d.t)("Click to edit %s in a new tab",e):(0,d.t)("Click to edit chart.");const t="MacOS"===(0,kr.fV)(),n=e?(0,d.t)("Click to edit %s.",e):(0,d.t)("Click to edit chart."),r=(0,d.t)("Use %s to open in a new tab.",t?(0,d.t)("\u2318 + click"):(0,d.t)("ctrl + click"));return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",null,n),(0,x.tZ)("div",null,r))};var Zu=n(915423),ku=n(95345),Mu=n(345671),Du=n(151127),Eu=n.n(Du);const Ru=(0,y.iK)(zr.Z)`
  .ant-modal-body {
    overflow: visible;
  }
  i {
    position: absolute;
    top: -${({theme:e})=>5.25*e.gridUnit}px;
    left: ${({theme:e})=>26.75*e.gridUnit}px;
  }
`,Tu=e=>{var t,n;const{isVisible:r,onHideModal:i=(()=>{}),onSavePermission:s=(()=>{}),sliceId:l,dashboardId:u}=e,[c,p]=((0,o.I0)(),(0,a.useState)([])),h=(0,o.v9)((e=>e)),f=(null==h||null==(t=h.sliceEntities)?void 0:t.slices)||{},g=(null==h||null==(n=h.dashboardLayout)?void 0:n.present)||{},m=Object.keys(g).map((e=>{const t=g[e];if("string"===typeof t)return{c:t};{var n,r;const e=f[null==t||null==(n=t.meta)?void 0:n.chartId]||{};return{...t,label:null==t||null==(r=t.meta)?void 0:r.sliceName,value:null==t?void 0:t.id,vizTypes:e.viz_type}}})).filter((e=>"CHART"===e.type&&"filter_box"!==e.vizTypes)),v=()=>{var e,t,n,r;const o=(null==h||null==(e=h.dashboardInfo)?void 0:e.metadata)||{},i=(null==o||null==(t=o.filter_scopes)?void 0:t[l])||(null==h||null==(n=h.dashboardFilters)||null==(r=n[l])?void 0:r.scopes)||{};i&&Object.keys(i).forEach((e=>{let t=i[e]||{};null==t||t.scope;t.scope=[...c]})),s(c)};return(0,x.tZ)(Ru,{show:r,onHide:i,title:(0,d.t)("Select a chart"),footer:(0,x.tZ)("div",{"data-test":"save-modal-footer"},(0,x.tZ)(se.Z,{id:"btn_cancel",buttonSize:"small",onClick:i},(0,d.t)("Cancel")),(0,x.tZ)(se.Z,{id:"btn_modal_save",buttonSize:"small",buttonStyle:"primary",onClick:v,"data-test":"btn-modal-save"},(0,d.t)("Save")))},(0,x.tZ)(Re.l0,{"data-test":"save-modal-body",layout:"vertical"},(0,x.tZ)(Re.xJ,{label:(0,d.t)("Chart List"),"data-test":"save-chart-modal-select-dashboard-form"},(0,x.tZ)(de.Ph,{allowClear:!0,allowNewOptions:!0,ariaLabel:(0,d.t)("Select a chart"),options:m,onChange:(e=[],t)=>{p(e)},mode:"multiple",value:c,placeholder:(0,d.t)("Select a chart")}))))},_u="cross_filter_scoping",Iu="download_as_image",Ou="download_as_pdf",Pu="download_as_ppt",zu="explore_chart",Fu="export_csv",Nu="export_full_csv",$u="force_refresh",Lu="look_ratio",Bu="look_weight",Au="fullscreen",ju="toggle_chart_description",Hu="view_query",qu="view_results",Uu="edit_chart_permission",Vu="set-filter-mapping",Wu="cross-variable-filter",Gu="cross-variable-filter-reset",Ku="share-charts",Yu=(y.iK.div`
  padding: ${({theme:e})=>e.gridUnit/4}px
    ${({theme:e})=>1.5*e.gridUnit}px;

  .dot {
    display: block;

    height: ${({theme:e})=>e.gridUnit}px;
    width: ${({theme:e})=>e.gridUnit}px;
    border-radius: 50%;
    margin: ${({theme:e})=>e.gridUnit/2}px 0;

    background-color: ${({theme:e})=>e.colors.text.label};
  }

  &:hover {
    cursor: pointer;
  }
`,y.iK.div`
  height: auto;
  margin: ${({theme:e})=>e.gridUnit}px 0;
  color: ${({theme:e})=>e.colors.grayscale.base};
  line-height: 21px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`),Xu=e=>`.dashboard-chart-id-${e}`,Qu=(x.iv`
  &&.anticon > .anticon:first-child {
    margin-right: 0;
    vertical-align: 0;
  }
`,({exploreUrl:e,triggerNode:t,modalTitle:n,modalBody:r,explorePerm:o})=>{const[i,s]=(0,a.useState)(!1),l=(0,a.useCallback)((()=>s(!0)),[]),u=(0,a.useCallback)((()=>s(!1)),[]),c=(0,tu.k6)(),p=()=>c.push(e),h=(0,y.Fg)();return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("span",{"data-test":"span-modal-trigger",onClick:l,role:"button",tabIndex:0},t),(0,x.tZ)(zr.Z,{css:x.iv`
            .ant-modal-body {
              display: flex;
              flex-direction: column;
            }
          `,show:i,onHide:u,title:n,footer:(0,x.tZ)(a.Fragment,null,(0,x.tZ)(se.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:p,disabled:o<4},(0,d.t)("Edit chart")),(0,x.tZ)(se.Z,{buttonStyle:"primary",buttonSize:"small",onClick:u},(0,d.t)("Close"))),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*h.gridUnit,minWidth:128*h.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0},r))});class Ju extends a.PureComponent{constructor(e){super(e),this.scrollChange=()=>{this.state.openMenu&&this.setState({openMenu:!1})},this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1,showPermissionModal:!1,showCrossVariableFilteModal:!1,openMenu:!1}}UNSAFE_componentWillReceiveProps(e,t){const n=(0,kr.Od)(e.layoutMode);e.isFullSize!==this.props.isFullSize&&n&&(e.isFullSize?this.setState({openMenu:!1}):setTimeout((()=>{this.setState({openMenu:!1})}),500))}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick({key:e,domEvent:t}){var n,r,o,i,a,s,l,u,c,p,h;const f=this.props.dataMask[this.props.slice.slice_id],{ownState:g={}}=f||{},{viewRatioStatus:m,viewWeight:v}=g;switch(e){case $u:this.refreshChart(),this.props.addSuccessToast((0,d.t)("Data refreshed"));break;case Lu:null==(n=this.props)||null==n.updateDataMask||n.updateDataMask(this.props.slice.slice_id,{...f,ownState:{...g,viewRatioStatus:!m}});break;case Bu:null==(r=this.props)||null==r.updateDataMask||r.updateDataMask(this.props.slice.slice_id,{...f,ownState:{...g,viewWeight:!v}});break;case Wu:this.setState({showCrossVariableFilteModal:!0});break;case Gu:let e=JSON.parse(JSON.stringify(this.props.dataMask[this.props.slice.slice_id]||{}));e.ownState={},null==(o=this.props)||null==o.updateDataMask||o.updateDataMask(this.props.slice.slice_id,e);break;case _u:this.setState({showCrossFilterScopingModal:!0});break;case Ku:(async()=>{try{if(!this.props.formData)throw new Error;await(0,ve.Z)((()=>(0,ye.YE)(this.props.formData))),this.props.addSuccessToast((0,d.t)("Copied to clipboard!"))}catch(e){this.props.addDangerToast((0,d.t)("Sorry, something went wrong. Try again later."))}})();break;case ju:null==(i=(a=this.props).toggleExpandSlice)||i.call(a,this.props.slice.slice_id);break;case zu:null==(s=(l=this.props).logExploreChart)||s.call(l,this.props.slice.slice_id);break;case Fu:null==(u=(c=this.props).exportCSV)||u.call(c,this.props.slice.slice_id);break;case Au:this.props.handleToggleFullSize(),this.scrollChange();break;case Uu:this.handVisiblePermissonModal(!0);break;case Nu:null==(p=(h=this.props).exportFullCSV)||p.call(h,this.props.slice.slice_id);break;case Iu:{var b,y;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Ge.Z)(Xu(this.props.slice.slice_id),this.props.slice.slice_name,!0)(t).then((()=>{e.style.visibility="visible"})),null==(b=(y=this.props).logEvent)||b.call(y,ie.xE,{chartId:this.props.slice.slice_id});break}case Pu:{var x,C;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Xe.Z)(Xu(this.props.slice.slice_id),this.props.slice.slice_name,!0)(t).then((()=>{e.style.visibility="visible"})),null==(x=(C=this.props).logEvent)||x.call(C,ie.Sr,{chartId:this.props.slice.slice_id});break}case Ou:{var w,S;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Ke.Z)(Xu(this.props.slice.slice_id),this.props.slice.slice_name,!0)(t).then((()=>{e.style.visibility="visible"})),null==(w=(S=this.props).logEvent)||w.call(S,ie.oA,{chartId:this.props.slice.slice_id});break}}this.setState({openMenu:!1})}handVisiblePermissonModal(e){this.setState({showPermissionModal:e})}componentDidMount(){const e=document.getElementById("dashboardScroll");e&&e.addEventListener("scroll",this.scrollChange);const t=document.getElementById("gridDash");t&&t.addEventListener("scroll",this.scrollChange)}componentWillUnmount(){const e=document.getElementById("dashboardScroll");e&&e.removeEventListener("scroll",this.scrollChange);const t=document.getElementById("gridDash");t&&t.removeEventListener("scroll",this.scrollChange)}render(){const{dashboardId:e,slice:t,isFullSize:n,cachedDttm:r=[],updatedDttm:o=null,isCached:s=[],crossFiltersEnabled:l,charts:c,dataMask:p={},editMode:h,layoutMode:f}=this.props,{openMenu:g}=this.state,{form_data:m={}}=t||{},{displayWeights:v}=m,b=(0,kr.Od)(f),y=(p[t.slice_id]||{}).ownState||{},{chooseTable:C}=y,w=!!C,S=!!Object.values(c).filter((e=>{var t,n;return"pivot_table_v2"===(null==e||null==(t=e.form_data)?void 0:t.viz_type)&&(null==e||null==(n=e.form_data)?void 0:n.enableCrossVariable)})).map((e=>e.id)).includes(t.slice_id),Z=(0,vo.Z)().items,k=(t.viz_type,Object.entries(Z).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(bo.cg.INTERACTIVE_CHART)})).find((([e])=>e===t.viz_type))),D=(r||[]).map((e=>M().utc(e).fromNow())),E=o?M().utc(o).fromNow():"",R=[...new Set(s.map((e=>e?(0,d.t)("Cached %s",D):E?(0,d.t)("Fetched %s",E):""))||"")],T=R.map(((e,t)=>(0,x.tZ)("div",{key:`tooltip-${t}`,style:{fontSize:12}},"(",R.length>1?(0,d.t)("Query %s: %s",t+1,e):e,")"))),_=n?(0,d.t)("Exit fullscreen"):(0,d.t)("Enter fullscreen"),I=t.perm||0,O=this.props.dataMask[this.props.slice.slice_id],{ownState:P={}}=O||{},{viewRatioStatus:z,viewWeight:F}=P,N=b?{display:"flex",alignItems:"center",height:35}:{},$=(0,x.tZ)("div",{id:"div-bbbbbb",onMouseDown:e=>(e.preventDefault(),!1)},(0,x.tZ)(x.xB,{styles:x.iv`
            #div-bbbbbb {
              box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12),
                0 6px 16px 0 rgba(0, 0, 0, 0.08),
                0 9px 28px 8px rgba(0, 0, 0, 0.05);
            }
            // 覆盖全局的样式
            #div-bbbbbb .ant-menu-item-only-child {
              line-height: 22px !important;
              &:active {
                background: #f5f5f5 !important;
              }
            }

            #div-bbbbbb .ant-menu-submenu-active,
            .ant-menu-item-active {
              color: rgba(0, 0, 0, 0.85) !important;
              background: #f5f5f5 !important;
            }

            .ant-menu-item a:hover {
              color: rgba(0, 0, 0, 0.85) !important;
              background: #f5f5f5 !important;
            }

            .ant-menu-vertical .ant-menu-submenu-title {
              line-height: 22px;
              color: rgba(0, 0, 0, 0.85) !important;
            }

            .ant-menu-submenu-active,
            .ant-menu-item-active {
              background: #f5f5f5 !important;
            }
          `}),(0,x.tZ)(ge.v2,{onClick:this.handleMenuClick,selectable:!1,"data-test":`slice_${t.slice_id}-menu`,style:{borderRadius:5}},["echarts_timeseries_line","echarts_timeseries_bar","mixed_timeseries"].includes(t.viz_type)&&(0,x.tZ)(ge.v2.Item,{key:Lu},z?(0,d.t)("Cancel viewing proportion"):(0,d.t)("View proportion")),["echarts_timeseries_line","echarts_timeseries_bar","pie"].includes(t.viz_type)&&v&&(0,x.tZ)(ge.v2.Item,{key:Bu},F?(0,d.t)("Cancel viewing weighted results"):(0,d.t)("View weighted results")),(0,x.tZ)(ge.v2.Item,{key:$u,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial",...N},"data-test":"refresh-chart-menu-item"},(0,d.t)("Force refresh"),(0,x.tZ)(Yu,{"data-test":"dashboard-slice-refresh-tooltip"},T)),f===i.kB.MOBILE&&window.location.pathname.indexOf("/dashboard/list")>-1?null:(0,x.tZ)(ge.v2.Item,{key:Au},_),(f===i.kB.PC||f===i.kB.MOBILE&&window.location.pathname.indexOf("/dashboard/list")>-1)&&(0,x.tZ)(a.Fragment,null,"filter_box"===this.props.slice.viz_type&&(0,x.tZ)(ge.v2.Item,{key:Vu},(0,x.tZ)(We.Z,{className:"m-r-5",triggerNode:(0,d.t)("Set filter mapping")})),(0,x.tZ)(ge.v2.Divider,null),t.description&&(0,x.tZ)(ge.v2.Item,{key:ju},this.props.isDescriptionExpanded?(0,d.t)("Hide chart description"):(0,d.t)("Show chart description")),this.props.supersetCanExplore&&I>2&&(0,x.tZ)(ge.v2.Item,{key:zu},(0,x.tZ)(su.rU,{to:this.props.exploreUrl},(0,x.tZ)(ce.u,{title:Su(this.props.slice.slice_name)},(0,d.t)("Edit chart")))),this.props.supersetCanExplore&&(0,x.tZ)(ge.v2.Item,{key:Hu},(0,x.tZ)(Ce.Z,{triggerNode:(0,x.tZ)("span",{"data-test":"view-query-menu-item"},(0,d.t)("View query")),modalTitle:(0,d.t)("View query"),modalBody:(0,x.tZ)(Zu.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),this.props.supersetCanExplore&&(0,x.tZ)(ge.v2.Item,{key:qu},(0,x.tZ)(Qu,{exploreUrl:this.props.exploreUrl,triggerNode:(0,x.tZ)("span",{"data-test":"view-query-menu-item"},(0,d.t)("View as table")),explorePerm:I,modalTitle:(0,d.t)("Chart Data: %s",t.slice_name),modalBody:(0,x.tZ)(ku.Tg,{queryFormData:this.props.formData,queryForce:!1,dataSize:20,isRequest:!0,isVisible:!0})})),this.props.supersetCanExplore&&(0,x.tZ)(ge.v2.Item,{key:Ku},(0,d.t)("Copy permalink to clipboard")),(0,oe.cr)(u.T.DRILL_TO_DETAIL)&&(0,x.tZ)(Mu.p,{chartId:t.slice_id,formData:this.props.formData}),(t.description||this.props.supersetCanExplore)&&(0,x.tZ)(ge.v2.Divider,null),(0,oe.cr)(u.T.DASHBOARD_CROSS_FILTERS)&&k&&l&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ge.v2.Item,{key:_u},(0,d.t)("Cross-filter scoping")),(0,x.tZ)(ge.v2.Divider,null)),S&&!w&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ge.v2.Item,{key:Wu},(0,d.t)("Cross Variable")),(0,x.tZ)(ge.v2.Divider,null)),S&&w&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(ge.v2.Item,{key:Gu},(0,d.t)("Reset")),(0,x.tZ)(ge.v2.Divider,null)),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&I>1&&(0,x.tZ)(ge.v2.SubMenu,{title:(0,d.t)("Download")},(0,x.tZ)(tt.Z,{position:"dashbord-chart-single",selectorString:Xu(this.props.slice.slice_id),viz_type:this.props.slice.viz_type,downLoadTitle:this.props.slice.slice_name,slice:this.props.slice})),!1)));return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(pu,{chartId:t.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),this.state.showCrossVariableFilteModal&&(0,x.tZ)(wu,{isOpen:this.state.showCrossVariableFilteModal,onClose:()=>{this.setState({showCrossVariableFilteModal:!1})}}),!h&&(0,x.tZ)("div",{css:()=>`\n            width:${b?"25px":"30px"};\n            height: ${b?"auto":"30px"};\n            background: ${b?"":"#5d9cec"} ;\n            overflow: hidden;\n            padding:${b?"0px":"4px 0 0 4px"};\n            position: absolute;\n            right:${b?"-8px":"-16px"};\n            top: 0;\n            z-index: 999;\n        `},(0,x.tZ)(du.$i,{overlay:$,trigger:["click"],placement:n?"bottomRight":"bottomLeft",visible:g,onVisibleChange:e=>{this.setState({openMenu:e})}},(0,x.tZ)("span",{id:`slice_${t.slice_id}-controls`,role:"button","aria-label":"More Options"},b?(0,x.tZ)(lu.default,{style:{transform:"rotate(90deg)",fontSize:14}}):(0,x.tZ)(ae.Z.CaretMore,{style:{color:"#fff",fontSize:"30px",marginLeft:"1px"}})))),this.state.showPermissionModal&&(0,x.tZ)(Tu,{isVisible:this.state.showPermissionModal,onHideModal:()=>{this.handVisiblePermissonModal(!1)},sliceId:t.slice_id,dashboardId:e,onSavePermission:()=>{this.handVisiblePermissonModal(!1)}}))}}const ec=(0,tu.EN)((0,o.$j)((function(e){var t,n,r;return{charts:(null==e?void 0:e.charts)||{},dataMask:(null==e?void 0:e.dataMask)||{},editMode:null==e||null==(t=e.dashboardState)?void 0:t.editMode,layoutMode:(null==(n=e.dashboardInfo)||null==(r=n.metadata)?void 0:r.layout_mode)||i.kB.PC}}),(function(e){return(0,r.DE)({updateDataMask:w.updateDataMask},e)}))(Ju));var tc=n(187185),nc=n.n(tc),rc=n(976697);const oc=y.iK.div`
  ${({theme:e})=>x.iv`
    display: inline-block;
    color: ${e.colors.grayscale.light5};
    background: ${e.colors.grayscale.base};
    border-radius: 1em;
    vertical-align: text-top;
    padding: ${e.gridUnit}px ${2*e.gridUnit}px;
    font-size: ${e.typography.sizes.m}px;
    font-weight: ${e.typography.weights.bold};
    min-width: 1em;
    min-height: 1em;
    line-height: 1em;
    vertical-align: middle;
    white-space: nowrap;

    &.filter-magrin-style {
      margin-right: 15px;
    }

    svg {
      position: relative;
      top: -2px;
      color: ${e.colors.grayscale.light5};
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
    }

    &:hover {
      cursor: pointer;
      background: ${e.colors.grayscale.dark1};
    }

    &.has-cross-filters {
      display: none; // 隐藏图标
      background: ${e.colors.primary.base};
      &:hover {
        background: ${e.colors.primary.dark1};
      }
    }

    &.has-incompatible-filters {
      color: ${e.colors.grayscale.dark2};
      background: ${e.colors.alert.base};
      &:hover {
        background: ${e.colors.alert.dark1};
      }
      svg {
        color: ${e.colors.grayscale.dark2};
      }
    }

    &.filters-inactive {
      display: none; // 隐藏图标
      color: ${e.colors.grayscale.light5};
      background: ${e.colors.grayscale.light1};
      padding: ${e.gridUnit}px;
      text-align: center;
      height: 22px;
      width: 22px;

      &:hover {
        background: ${e.colors.grayscale.base};
      }
    }
  `}
`,ic=y.iK.span`
  position: relative;
  margin-right: ${({theme:e})=>e.gridUnit}px;
  font-weight: ${({bold:e,theme:t})=>e?t.typography.weights.bold:"auto"};
  color: ${({color:e,theme:t})=>e||t.colors.grayscale.light5};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,ac=y.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${({theme:e})=>5*e.gridUnit}px;
`,sc=y.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,lc=y.iK.div`
  margin: 0 -${({theme:e})=>4*e.gridUnit}px;
`,dc=y.iK.div`
  padding-left: ${({theme:e})=>6*e.gridUnit}px;
  margin: -${({theme:e})=>3*e.gridUnit}px 0;
`,uc=y.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,cc=y.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${({theme:e})=>e.colors.grayscale.light5};
`,pc=y.iK.div`
  ${({theme:e})=>`\n  padding-top: ${3*e.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${e.colors.grayscale.light5};\n  `}
`;n(714670);const hc=(0,d.t)("Please apply filter changes"),fc=e=>null===e||void 0===e?"":"string"===typeof e||"number"===typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"===typeof e?JSON.stringify(e):(0,d.t)("Unknown value"),gc=({filterSetFilterValues:e,dataMaskSelected:t})=>e.find((({dataMask:e={}})=>{const n=Object.entries(t);return n.every((([t,r])=>{var o;const i=(0,ru.JB)(r.filterState,null==e||null==(o=e[t])?void 0:o.filterState,{ignoreUndefined:!0,ignoreNull:!0}),a=n.length===Object.keys(null!=e?e:{}).length;return i&&a}))})),mc=({indicator:{column:e,name:t,value:n,path:r=[]},onClick:o=(()=>{}),text:i})=>{const s=fc(n);return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(sc,{onClick:()=>o([...r,`LABEL-${e}`])},(0,x.tZ)(ic,{bold:!0},(0,x.tZ)(ac,null,(0,x.tZ)(ae.Z.SearchOutlined,{iconSize:"m",css:x.iv`
                span {
                  vertical-align: 0;
                }
              `})),t,s?": ":""),(0,x.tZ)(cc,null,s)),i&&(0,x.tZ)(pc,null,i))};const vc={name:"1gca25q",styles:"span{line-height:0;}"},bc=({appliedCrossFilterIndicators:e=[],appliedIndicators:t=[],incompatibleIndicators:n=[],unsetIndicators:r=[],onHighlightFilterSource:i,children:s})=>{const[l,u]=(0,a.useState)(!1),c=(0,y.Fg)(),p=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,a.useEffect)((()=>{l&&window.addEventListener("resize",(()=>u(!1)),{once:!0})}),[l]),(0,a.useEffect)((()=>{u(!1)}),[p]);const h=()=>{const r=[];return e.length&&r.push("appliedCrossFilters"),t.length&&r.push("applied"),n.length&&r.push("incompatible"),r.length?r:["unset"]},[f,g]=(0,a.useState)((()=>[...h()]));const m=e=>`${e.column} - ${e.name}`,v=(0,x.tZ)(uc,null,(0,x.tZ)(x.xB,{styles:(0,x.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",c.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;width:260px;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",c.colors.grayscale.dark2,"cc;border-left-color:",c.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",c.colors.grayscale.dark2,"cc;border-right-color:",c.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",c.colors.grayscale.dark2,"cc;border-right-color:",c.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",c.colors.grayscale.dark2,"cc;border-left-color:",c.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",c.colors.grayscale.light4,";z-index:999;}}","")}),(0,x.tZ)(lc,null,(0,x.tZ)(So.Z,{ghost:!0,light:!0,activeKey:f,onChange:function(e){g("string"===typeof e?[e]:e)}},e.length?(0,x.tZ)(So.Z.Panel,{key:"appliedCrossFilters",header:(0,x.tZ)(ic,{bold:!0,color:c.colors.primary.light1},(0,x.tZ)(ae.Z.CursorTarget,{css:(0,x.iv)({fill:c.colors.primary.light1},"",""),iconSize:"xl"}),(0,d.t)("Applied Cross Filters (%d)",e.length))},(0,x.tZ)(dc,{css:(0,x.iv)({paddingBottom:3*c.gridUnit},"","")},e.map((e=>(0,x.tZ)(mc,{key:m(e),indicator:e,onClick:i}))))):null,t.length?(0,x.tZ)(So.Z.Panel,{key:"applied",header:(0,x.tZ)(ic,{bold:!0,color:c.colors.success.base},(0,x.tZ)(ae.Z.CheckCircleFilled,{css:vc,iconSize:"m"})," ",(0,d.t)("Applied Filters (%d)",t.length))},(0,x.tZ)(dc,{css:(0,x.iv)({paddingBottom:3*c.gridUnit},"","")},t.map((e=>(0,x.tZ)(mc,{key:m(e),indicator:e,onClick:i}))))):null,n.length?(0,x.tZ)(So.Z.Panel,{key:"incompatible",header:(0,x.tZ)(ic,{bold:!0,color:c.colors.alert.base},(0,x.tZ)(ae.Z.ExclamationCircleFilled,{css:vc,iconSize:"m"})," ",(0,d.t)("Incompatible Filters (%d)",n.length))},(0,x.tZ)(dc,{css:(0,x.iv)({paddingBottom:3*c.gridUnit},"","")},n.map((e=>(0,x.tZ)(mc,{key:m(e),indicator:e,onClick:i}))))):null,r.length?(0,x.tZ)(So.Z.Panel,{key:"unset",header:(0,x.tZ)(ic,{bold:!0,color:c.colors.grayscale.light1},(0,x.tZ)(ae.Z.MinusCircleFilled,{css:vc,iconSize:"m"})," ",(0,d.t)("Unset Filters (%d)",r.length)),disabled:!r.length},(0,x.tZ)(dc,{css:(0,x.iv)({paddingBottom:3*c.gridUnit},"","")},r.map((e=>(0,x.tZ)(mc,{key:m(e),indicator:e,onClick:i}))))):null)));return(0,x.tZ)(rc.ZP,{overlayClassName:"filterStatusPopover",content:v,visible:l,onVisibleChange:function(e){u(e),e&&g(h())},placement:"bottomRight",trigger:"click",getPopupContainer:e=>e.parentElement||document.body},s)};var yc,xc=n(310581);!function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(yc||(yc={}));const Cc=new Set(Object.values(nt.i2)),wc=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,zo.Z)(null==e?void 0:e.value).join(", "):null,Sc=(e,t,n)=>{const r=t.columns[e],o=Array.isArray(r)?r:[r];if(null==r||t.isDateFilter&&r===wo.vM||0===o.length)return[];if(t.isDateFilter&&Cc.has(e)){const t=((e===nt.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,[t,n])=>({...e,[t]:n})),{});return o.map((e=>t[e]||e))}return o},Zc=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},kc=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>(0,xc.Z)(e.column))))},Mc={},Dc={},Ec=(e,t,n,r)=>{const o=Zc(r),i=kc(r),a=Object.values(t).filter((t=>t.chartId!==e)),s=Object.entries(n).filter((([e])=>a.find((t=>t.datasourceId===e)))).map((([,e])=>e)),l=Dc[e];if(Mc[e]&&(0,ru.JB)(null==l?void 0:l.appliedColumns,o)&&(0,ru.JB)(null==l?void 0:l.rejectedColumns,i)&&(0,ru.JB)(null==l?void 0:l.matchingFilters,a)&&(0,ru.JB)(null==l?void 0:l.matchingDatasources,s))return Mc[e];const d=a.reduce(((t,r)=>t.concat(((e,t,n,r,o)=>{const i=(e,t)=>r.has(e)&&t.columns[e]?yc.Applied:o.has(e)?yc.Incompatible:yc.Unset;return Object.keys(t.columns).filter((n=>(0,et.up)({filterScope:t.scopes[n]}).includes(e))).map((e=>({column:e,name:t.labels[e]||e,value:Sc(e,t,n),status:i(e,t),path:t.directPathToFilter})))})(e,r,n[r.datasourceId]||{},o,i))),[]);return d.sort(((e,t)=>e.name.localeCompare(t.name))),Mc[e]=d,Dc[e]={appliedColumns:o,rejectedColumns:i,matchingFilters:a,matchingDatasources:s},d},Rc={},Tc={},_c={},Ic=[],Oc=({chartId:e,showMoreIcon:t})=>{var n,r;const s=(0,o.I0)(),l=(0,o.v9)((e=>e.datasources)),d=(0,o.v9)((e=>e.dashboardFilters)),c=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),p=(0,o.v9)((e=>e.dashboardInfo)),h=(0,o.v9)((e=>e.charts)),f=(0,o.v9)((e=>e.dashboardLayout.present)),g=(0,o.v9)((e=>e.dataMask)),[m,v]=(0,a.useState)(Ic),[y,C]=(0,a.useState)(Ic),w=(0,a.useCallback)((e=>{s((0,ss.E2)(e))}),[s]),S=(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC})),Z=(0,kr.Od)(S),k=h[e],M=(0,da.D)(k),D=null==M?void 0:M.chartStatus,E=(0,da.D)(d),R=(0,da.D)(l),T=(null==k?void 0:k.chartStatus)&&["rendered","success"].includes(k.chartStatus);(0,a.useEffect)((()=>{if(!T&&y.length>0)C(Ic);else if("success"!==D){var t,n,r,o,i,a,s,u;(null==k||null==(t=k.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==M||null==(r=M.queriesResponse)||null==(o=r[0])?void 0:o.rejected_filters)&&(null==k||null==(i=k.queriesResponse)||null==(a=i[0])?void 0:a.applied_filters)===(null==M||null==(s=M.queriesResponse)||null==(u=s[0])?void 0:u.applied_filters)&&d===E&&l===R||C(Ec(e,d,l,k))}}),[k,e,d,y.length,l,null==M?void 0:M.queriesResponse,D,E,R,T]);const _=(0,da.D)(c),I=(0,da.D)(f),O=(0,da.D)(g),P=(0,da.D)(null==(n=p.metadata)?void 0:n.chart_configuration);(0,a.useEffect)((()=>{if(!T&&m.length>0)v(Ic);else if("success"!==D){var t,n,r,o,i,a,s,l,d,h;if((null==k||null==(t=k.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)!==(null==M||null==(r=M.queriesResponse)||null==(o=r[0])?void 0:o.rejected_filters)||(null==k||null==(i=k.queriesResponse)||null==(a=i[0])?void 0:a.applied_filters)!==(null==M||null==(s=M.queriesResponse)||null==(l=s[0])?void 0:l.applied_filters)||c!==_||f!==I||g!==O||P!==(null==(d=p.metadata)?void 0:d.chart_configuration))v(((e,t,n,r,o,i=_c)=>{const a=Zc(r),s=kc(r),l=Tc[n];if(Rc[n]&&(0,ru.JB)(null==l?void 0:l.appliedColumns,a)&&(0,ru.JB)(null==l?void 0:l.rejectedColumns,s)&&(null==l?void 0:l.nativeFilters)===e&&(null==l?void 0:l.dashboardLayout)===o&&(null==l?void 0:l.chartConfiguration)===i&&(null==l?void 0:l.dataMask)===t)return Rc[n];const d=({label:e,column:t,type:n=Nr.gT.NativeFilters})=>{const r=null!==e;return n===Nr.gT.CrossFilters&&r?yc.CrossFilterApplied:!t&&r?yc.Applied:t&&s.has(t)?yc.Incompatible:t&&a.has(t)&&r?yc.Applied:yc.Unset};let c=[];(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)&&(c=e&&Object.values(e).filter((e=>{var t;return e.type===Nr.BE.NATIVE_FILTER&&(null==(t=e.chartsInScope)?void 0:t.includes(n))})).map((e=>{var n,r,o,i;let a=null==(n=e.targets)||null==(r=n[0])||null==(o=r.column)?void 0:o.name;const s=null==(i=t[e.id])?void 0:i.filterState;let l=wc(s),u=d({label:l,column:a});var c;return"select_tree"===(null==e?void 0:e.filterType)&&(Array.isArray(a)&&a.length>0&&(a=a[a.length-1]),l=null==s||null==(c=s.value)?void 0:c.map((e=>null==e?void 0:e.title)).join(","),u=l?yc.Applied:yc.Unset),{column:a,name:e.name,path:[e.id],status:u,value:l}})));let p=[];if((0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)){const e=Object.values(o);p=Object.values(i).filter((e=>{var t,r;return null==(t=e.crossFilters)||null==(r=t.chartsInScope)?void 0:r.includes(n)})).map((n=>{var r,o,i;const a=null==(r=t[n.id])?void 0:r.filterState,s=wc(a),l=null==a?void 0:a.filters,u=l&&Object.keys(l)[0],c=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n.id}));return{column:u,name:null==c||null==(o=c.meta)?void 0:o.sliceName,path:[...null!=(i=null==c?void 0:c.parents)?i:[],null==c?void 0:c.id],status:d({label:s,type:Nr.gT.CrossFilters}),value:s}})).filter((e=>e.status===yc.CrossFilterApplied))}const h=p.concat(c);return Rc[n]=h,Tc[n]={nativeFilters:e,dashboardLayout:o,chartConfiguration:i,dataMask:t,appliedColumns:a,rejectedColumns:s},h})(c,g,e,k,f,null==(h=p.metadata)?void 0:h.chart_configuration))}}),[k,e,null==(r=p.metadata)?void 0:r.chart_configuration,g,c,m.length,f,null==M?void 0:M.queriesResponse,P,D,I,O,_,T]);const z=(0,a.useMemo)((()=>nc()((e=>{const t=[yc.Applied,yc.Unset,yc.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...y,...m]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==yc.Applied||t.status!==yc.Applied)))),[y,m]),F=(0,a.useMemo)((()=>z.filter((e=>e.status===yc.CrossFilterApplied))),[z]),N=(0,a.useMemo)((()=>z.filter((e=>e.status===yc.Applied))),[z]),$=(0,a.useMemo)((()=>z.filter((e=>e.status===yc.Unset))),[z]),L=(0,a.useMemo)((()=>z.filter((e=>e.status===yc.Incompatible))),[z]);if(!F.length&&!N.length&&!L.length&&!$.length)return null;const B=!F.length&&!N.filter((e=>e.value)).length&&!L.length;return(0,x.tZ)(bc,{appliedCrossFilterIndicators:F,appliedIndicators:N,unsetIndicators:$,incompatibleIndicators:L,onHighlightFilterSource:w},Z?(0,x.tZ)("div",{style:{fontWeight:400,display:N.length>0?"block":"none",marginRight:t?25:0}},(0,x.tZ)(ae.Z.Filter,{iconSize:"m"}),!B&&(0,x.tZ)("span",{"data-test":"applied-filter-count",style:{fontSize:12}},N.length+F.length),L.length?(0,x.tZ)(a.Fragment,null," ",(0,x.tZ)(ae.Z.AlertSolid,{iconSize:"m",style:{color:"#FCC700"}}),(0,x.tZ)("span",{"data-test":"incompatible-filter-count",style:{fontSize:12,marginLeft:2}},L.length)):null):(0,x.tZ)(oc,{className:b()("filter-counts","filter-magrin-style",!!L.length&&"has-incompatible-filters",!!F.length&&"has-cross-filters",B&&"filters-inactive")},(0,x.tZ)(ae.Z.Filter,{iconSize:"m"}),!B&&(0,x.tZ)("span",{"data-test":"applied-filter-count"},N.length+F.length),L.length?(0,x.tZ)(a.Fragment,null," ",(0,x.tZ)(ae.Z.AlertSolid,null),(0,x.tZ)("span",{"data-test":"incompatible-filter-count"},L.length)):null))},Pc=a.memo(Oc);var zc=n(925550),Fc=n(637936);const Nc=(0,d.t)("Annotation layers are still loading."),$c=(0,d.t)("One ore more annotation layers failed loading."),Lc=(0,y.iK)(ae.Z.CursorTarget)`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.base};
  height: 22px;
  width: 22px;
`,Bc=y.iK.div`
  ${({theme:e,isFullSize:t,ismobile:n})=>x.iv`
    font-size: ${e.typography.sizes.l}px;
    font-weight: ${e.typography.weights.bold};
    margin-bottom: ${e.gridUnit}px;
    display: flex;
    max-width: 100%;
    align-items: flex-start;
    // min-height: 0;    // 看板中筛选器名称会出现重叠的情况，
    position: relative;

    & > .header-title {
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      flex-grow: 1;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;

      & > span.ant-tooltip-open {
        display: inline;
      }
    }

    & > .header-controls {
      display: flex;
      position: absolute;
      // top: -2px;
      top: ${n?"0px":"-16px"}; // 判断pc端 移动端
      align-items: center;
      /* right: ${t?0:"-50px"}; */
      right: 0px; // 解决屏幕闪动得问题
      width: ${n?"200px":""};
      justify-content: ${n?"flex-end":"flex-start"};

      & > * {
        margin-left: ${n?0:5*e.gridUnit}px;
      }

      // 移动端才设置全局样式
      ${n&&"\n        .ant-breadcrumb-link{\n          margin-right: 0px !important;\n          height: 20px !important;\n          font-size: 12px !important;\n          line-height: unset !important;\n          white-space: nowrap !important;\n          overflow: hidden !important;\n          text-overflow: ellipsis !important;\n        }\n      "}
    }

    .dropdown.btn-group {
      pointer-events: none;
      vertical-align: top;
      & > * {
        pointer-events: auto;
      }
    }

    .dropdown-toggle.btn.btn-default {
      background: none;
      border: none;
      box-shadow: none;
    }

    .dropdown-menu.dropdown-menu-right {
      top: ${5*e.gridUnit}px;
    }

    .divider {
      margin: ${e.gridUnit}px 0;
    }

    .refresh-tooltip {
      display: block;
      height: ${4*e.gridUnit}px;
      margin: ${e.gridUnit}px 0;
      color: ${e.colors.text.label};
    }
  `}
`,Ac=({innerRef:e=null,forceRefresh:t=(()=>({})),updateSliceName:n=(()=>({})),toggleExpandSlice:r=(()=>({})),logExploreChart:s=(()=>({})),logEvent:l,exportCSV:u=(()=>({})),editMode:c=!1,annotationQuery:p={},annotationError:h={},cachedDttm:f=null,updatedDttm:g=null,isCached:m=[],isExpanded:v=!1,sliceName:b="",supersetCanExplore:y=!1,supersetCanShare:C=!1,supersetCanCSV:S=!1,sliceCanEdit:Z=!1,exportFullCSV:k,slice:M,componentId:D,dashboardId:E,addSuccessToast:R,addDangerToast:T,handleToggleFullSize:_,isFullSize:I,chartStatus:O,formData:P,width:z,height:F,component:N,showSliceName:$})=>{const L=(0,o.I0)(),B=(0,iu.fG)(),A=(0,a.useContext)(Fc.DashboardPageIdContext),[j,H]=(0,a.useState)(null),q=(0,a.useRef)(null),U=(0,o.v9)((e=>{var t,n;return null==(t=e.dataMask[null==M?void 0:M.slice_id])||null==(n=t.filterState)?void 0:n.value})),V=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),W=(0,o.v9)((e=>e.dataMask[null==M?void 0:M.slice_id])),G=(0,o.v9)((({dashboardInfo:e})=>e.crossFiltersEnabled)),K=(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC})),Y=(0,kr.Od)(K),X=(0,a.useMemo)((()=>({value:U,name:(0,d.t)("Emitted values")})),[U]),Q=!c&&y;(0,a.useEffect)((()=>{const e=q.current;Q?H(Su(b)):e&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight)?H(null!=b?b:null):H(null)}),[b,z,F,Q]);const J=(0,a.useMemo)((()=>$||void 0==$?{}:{height:"0"}),[$]),ee=`/explore/?dashboard_page_id=${A}&slice_id=${M.slice_id}`,te=!M.perm||M.perm>2,ne=!c&&(0,kr.ve)();let re={};Y&&(re={width:120,overflow:"hidden",textOverflow:"ellipsis",textAlign:"end"});const oe=(0,a.useMemo)((()=>{const{titleFontFamily:e,titleSize:t,titleFontWeight:n,titleColor:r,sliceNameLine:o}=N.meta;return{fontSize:`${t||16}px`,fontFamily:e||"inherit",fontWeight:n||400,color:r||"rgba(0,0,0,0.8)",textAlign:o||"left"}}),[N.meta]),ie=!B.hideChartControls&&V==D;return(0,x.tZ)(Bc,{"data-test":"slice-header",ref:e,style:{...J},ismobile:Y},(0,x.tZ)("div",{className:"header-title",ref:q,style:{display:""+(0==J.height?"none":""),...oe}},ne?(0,x.tZ)("div",{className:"header-title"},b):(0,x.tZ)(au.Z,{title:b||(c?"---":""),canEdit:c,onSaveTitle:n,showTooltip:!1,headerTooltip:j,url:Q&&te?ee:void 0,textColor:oe.color}),!!Object.values(p).length&&(0,x.tZ)(ce.u,{id:"annotations-loading-tooltip",placement:"top",title:Nc},(0,x.tZ)("i",{role:"img","aria-label":Nc,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,x.tZ)(ce.u,{id:"annotation-errors-tooltip",placement:"top",title:$c},(0,x.tZ)("i",{role:"img","aria-label":$c,className:"fa fa-exclamation-circle danger"}))),I&&!Y&&(0,x.tZ)("div",{onClick:_,style:{padding:"3px",background:"rgba(255,255,255,0.5)",position:"absolute",top:"0px",right:"0px",cursor:"pointer"}},(0,x.tZ)(ae.Z.FullscreenExitOutlined,{style:{fontSize:22,marginRight:"30px"}})),!c&&(0,x.tZ)("div",{className:"header-controls"},(0,x.tZ)(a.Fragment,null,U&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(zc.Z,{style:re},U.map(((e,t)=>(0,x.tZ)(zc.g,{onClick:()=>{((e,t)=>{const n=At()(W),r=(null==n?void 0:n.extraFormData)||{},o=((null==r?void 0:r.filters)||[]).filter(((e,n)=>n<=t)),i={},a=[];o.map((e=>{i[`${e.col}`]=e.val,a.push(e.val)})),n.extraFormData.filters=o,n.filterState.selectedFilters=i,n.filterState.value=a,L((0,w.updateDataMask)(null==M?void 0:M.slice_id,n))})(0,t)}},e)))),(0,x.tZ)(ce.u,{placement:"top",title:(0,x.tZ)(mc,{indicator:X,text:(0,d.t)("Click to clear emitted filters")})},(0,x.tZ)(Lc,{style:Y?{marginRight:10,fontSize:18,marginTop:4}:{},onClick:()=>L((0,w.clearDataMask)(null==M?void 0:M.slice_id))}))),!B.hideChartControls&&(0,x.tZ)(Pc,{chartId:M.slice_id,showMoreIcon:ie}),!B.hideChartControls&&V==D&&(0,x.tZ)("div",{onClick:e=>e.stopPropagation()},(0,x.tZ)(ec,{slice:M,isCached:m,isExpanded:v,cachedDttm:f,updatedDttm:g,toggleExpandSlice:r,forceRefresh:t,logExploreChart:s,logEvent:l,exportCSV:u,exportFullCSV:k,supersetCanExplore:y,supersetCanShare:C,supersetCanCSV:S,sliceCanEdit:Z,componentId:D,dashboardId:E,addSuccessToast:R,addDangerToast:T,handleToggleFullSize:_,isFullSize:I,isDescriptionExpanded:v,chartStatus:O,formData:P,exploreUrl:ee,crossFiltersEnabled:G})))))},jc={height:l().number.isRequired};function Hc({height:e}){return(0,x.tZ)("div",{className:"missing-chart-container",style:{height:e+20}},(0,x.tZ)("div",{className:"missing-chart-body"},(0,d.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,x.tZ)("br",null),(0,x.tZ)("br",null),(0,d.t)("Delete this container and save to remove this message.")))}Hc.propTypes=jc;var qc=n(820194);const Uc={id:l().number.isRequired,componentId:l().string.isRequired,dashboardId:l().number.isRequired,width:l().number.isRequired,height:l().number.isRequired,updateSliceName:l().func.isRequired,isComponentVisible:l().bool,handleToggleFullSize:l().func.isRequired,setControlValue:l().func,chart:It.$6.isRequired,formData:l().object.isRequired,labelColors:l().object,sharedLabelColors:l().object,datasource:l().object,slice:It.Rw.isRequired,sliceName:l().string.isRequired,timeout:l().number.isRequired,maxRows:l().number.isRequired,filterboxMigrationState:l().oneOf(Object.keys(nt.Qi).map((e=>nt.Qi[e]))),filters:l().object.isRequired,refreshChart:l().func.isRequired,logEvent:l().func.isRequired,toggleExpandSlice:l().func.isRequired,changeFilter:l().func.isRequired,setFocusedFilterField:l().func.isRequired,unsetFocusedFilterField:l().func.isRequired,editMode:l().bool.isRequired,isExpanded:l().bool.isRequired,isCached:l().bool,supersetCanExplore:l().bool.isRequired,supersetCanShare:l().bool.isRequired,supersetCanCSV:l().bool.isRequired,sliceCanEdit:l().bool.isRequired,addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,ownState:l().object,filterState:l().object,postTransformProps:l().func,datasetsStatus:l().oneOf(["loading","error","complete"]),isInView:l().bool,emitCrossFilters:l().bool},Vc=Object.keys(Uc).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),Wc=new Set(["filter_box"]),Gc=y.iK.div`
  /* overflow: hidden; */
  position: relative;

  &.dashboard-chart--overflowable {
    overflow: visible;
  }
`,Kc=y.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,Yc=y.iK.div`
  display: flex;
  flex-direction: column;
  max-height: 100%;
`;class Xc extends a.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(ie.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.onExploreChart=async e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;try{const e=window.localStorage.getItem("last_tab_id"),n=e?String(Number.parseInt(e,10)+1):void 0,r=await(0,ou.nv)(this.props.datasource.id,this.props.datasource.type,this.props.formData,this.props.slice.slice_id,n),o=(0,nu.y8)(null,{[me.KD.formDataKey.name]:r,[me.KD.sliceId.name]:this.props.slice.slice_id});(0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB)||t?window.open(o,"_blank","noreferrer"):this.props.history.push(o)}catch(e){be.Z.error(e),this.props.addDangerToast((0,d.t)("An error occurred while opening Explore"))}},this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this),this.getChartHeight=this.getChartHeight.bind(this),this.getDescriptionHeight=this.getDescriptionHeight.bind(this)}shouldComponentUpdate(e,t){var n,r,o,i,a,s,l,d,u;if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!Tr()(e.datasource,this.props.datasource))return!0;if((null==(n=this.props)||null==(r=n.chart)?void 0:r.chartStatus)!==(null==e||null==(o=e.chart)?void 0:o.chartStatus)&&"loading"===(null==(i=this.props)||null==(a=i.chart)?void 0:a.chartStatus))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height&&e.width===this.state.width&&e.height===this.state.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<Vc.length;t+=1){const n=Vc[t];if(!(0,ru.JB)(e[n],this.props[n]))return!0}}else if((null==(s=e.formData)?void 0:s.color_scheme)!==(null==(l=this.props.formData)?void 0:l.color_scheme)||!(0,ru.JB)(null==(d=e.formData)?void 0:d.label_colors,null==(u=this.props.formData)?void 0:u.label_colors))return!0;return this.props.cacheBusterProp!==e.cacheBusterProp}componentDidMount(){if(this.props.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}getDescriptionHeight(){return this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0}getChartHeight(){const e=this.getHeaderHeight();return Math.max(this.state.height-e-this.state.descriptionHeight,20)}getHeaderHeight(){if(this.headerRef){const e=getComputedStyle(this.headerRef).getPropertyValue("margin-bottom"),t=parseInt(e,10)||0;return this.headerRef.offsetHeight+t}return 22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e={}){this.props.logEvent(ie.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e=!1){this.props.logEvent(ie.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,nu.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv",force:!0,ownState:this.props.ownState})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(ie.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){const{id:e,componentId:t,dashboardId:n,chart:r,slice:o,datasource:i,isExpanded:a,editMode:s,filters:l,formData:d,labelColors:u,sharedLabelColors:c,updateSliceName:p,sliceName:h,toggleExpandSlice:f,timeout:g,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,addSuccessToast:w,addDangerToast:S,ownState:Z,filterState:k,handleToggleFullSize:M,isFullSize:D,setControlValue:E,filterboxMigrationState:R,postTransformProps:T,datasetsStatus:_,isInView:I,emitCrossFilters:O,logEvent:P,showSliceName:z,component:F}=this.props,{width:N}=this.state;if(!r||!o)return(0,x.tZ)(Hc,{height:this.getChartHeight()});const{queriesResponse:$,chartUpdateEndTime:L,chartStatus:B}=r,A="loading"===B,j="filter_box"===o.viz_type&&[nt.Qi.REVIEWING,nt.Qi.CONVERTED].includes(R),H=(null==$?void 0:$.map((({is_cached:e})=>e)))||[],q=(null==$?void 0:$.map((({cached_dttm:e})=>e)))||[],U=Wc.has(o.viz_type),V=(0,et.Z3)(e)?function({activeFilters:e={},filterId:t}){return Object.entries(e).reduce(((e,n)=>{const[r,{values:o}]=n,{chartId:i,column:a}=(0,qc._)(r);return i===t?{...e,[a]:o}:e}),{})}({activeFilters:l,filterId:e}):{};return(0,x.tZ)(Yc,{className:"chart-slice","data-test":"chart-grid-component","data-test-chart-id":e,"data-test-viz-type":o.viz_type,"data-test-chart-name":o.slice_name},(0,x.tZ)(Ac,{innerRef:this.setHeaderRef,slice:o,isExpanded:a,isCached:H,cachedDttm:q,updatedDttm:L,toggleExpandSlice:f,forceRefresh:this.forceRefresh,editMode:s,annotationQuery:r.annotationQuery,logExploreChart:this.logExploreChart,logEvent:P,onExploreChart:this.onExploreChart,exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:p,sliceName:h,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,componentId:t,dashboardId:n,filters:l,addSuccessToast:w,addDangerToast:S,handleToggleFullSize:M,isFullSize:D,chartStatus:r.chartStatus,formData:d,width:N,height:this.getHeaderHeight(),component:F,showSliceName:z}),a&&o.description_markeddown&&(0,x.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:o.description_markeddown}}),(0,x.tZ)(Gc,{className:b()("dashboard-chart",U&&"dashboard-chart--overflowable")},(A||j)&&(0,x.tZ)(Kc,{className:b()(j&&"is-deactivated"),style:{width:N,height:this.getChartHeight()}}),(0,x.tZ)(an.Z,{width:N,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:r.annotationData,chartAlert:r.chartAlert,chartId:e,chartStatus:B,datasource:i,dashboardId:n,initialValues:V,formData:d,labelColors:u,sharedLabelColors:c,ownState:Z,filterState:k,queriesResponse:r.queriesResponse,timeout:g,triggerQuery:r.triggerQuery,vizType:o.viz_type,setControlValue:E,isDeactivatedViz:j,filterboxMigrationState:R,postTransformProps:T,datasetsStatus:_,isInView:I,emitCrossFilters:O})))}}Xc.propTypes=Uc,Xc.defaultProps={isCached:!1,isComponentVisible:!0};const Qc=(0,tu.EN)(Xc);var Jc=n(409531);const ep={};const tp=(0,o.$j)((function(e,t){var n,r,o,i,a;const{charts:s,dashboardInfo:l,dashboardState:d,dataMask:u,datasources:c,sliceEntities:p,nativeFilters:h,common:f}=e,{id:g,extraControls:m,setControlValue:v}=t,b=s[g]||ep,y=b&&b.form_data&&c[b.form_data.datasource]||Jc.tw,{colorScheme:x,colorNamespace:C,datasetsStatus:w}=d,S=(null==l||null==(n=l.metadata)?void 0:n.label_colors)||{},Z=(null==l||null==(r=l.metadata)?void 0:r.shared_label_colors)||{},k=(0,eu.Z)({chart:b,chartConfiguration:null==(o=l.metadata)?void 0:o.chart_configuration,charts:s,filters:(0,et._f)(g),colorScheme:x,colorNamespace:C,sliceId:g,nativeFilters:null==h?void 0:h.filters,allSliceIds:d.sliceIds,dataMask:u,extraControls:m,labelColors:S,sharedLabelColors:Z});return k.dashboardId=l.id,t.onDataChange(k),{chart:b,datasource:y,labelColors:S,sharedLabelColors:Z,slice:p.slices[g],timeout:l.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,et.De)()||ep,formData:k,editMode:d.editMode,isExpanded:!!d.expandedSlices[g],supersetCanExplore:!!l.superset_can_explore,supersetCanShare:!!l.superset_can_share,supersetCanCSV:!!l.superset_can_csv,sliceCanEdit:!!l.slice_can_edit,ownState:null==(i=u[g])?void 0:i.ownState,filterState:null==(a=u[g])?void 0:a.filterState,maxRows:f.conf.SQL_MAX_ROW,setControlValue:v,filterboxMigrationState:d.filterboxMigrationState,datasetsStatus:w,emitCrossFilters:!!l.crossFiltersEnabled}}),(function(e){return(0,r.DE)({updateComponents:vl.WZ,addSuccessToast:rt.ws,addDangerToast:rt.Gb,toggleExpandSlice:ss.WL,changeFilter:Jd.M6,setFocusedFilterField:ss.GH,unsetFocusedFilterField:ss.oY,refreshChart:ln.refreshChart,logEvent:Vd.logEvent},e)}))(Qc);var np=n(929119);const rp={right:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},op={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},ip={widthAndHeight:op,widthOnly:{...op,bottomRight:!1,bottom:!1},heightOnly:{...op,bottomRight:!1,right:!1},notAdjustable:{...op,bottomRight:!1,bottom:!1,right:!1}},ap=Number.MAX_VALUE,sp={id:l().string.isRequired,children:l().node,adjustableWidth:l().bool,adjustableHeight:l().bool,gutterWidth:l().number,widthStep:l().number,heightStep:l().number,widthMultiple:l().number,heightMultiple:l().number,minWidthMultiple:l().number,maxWidthMultiple:l().number,minHeightMultiple:l().number,maxHeightMultiple:l().number,staticHeight:l().number,staticHeightMultiple:l().number,staticWidth:l().number,staticWidthMultiple:l().number,onResizeStop:l().func,onResize:l().func,onResizeStart:l().func,editMode:l().bool.isRequired,layoutMode:l().string,iSpace:l().bool},lp={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:Be.es,widthStep:Be.cd,heightStep:Be.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:ap,minHeightMultiple:1,maxHeightMultiple:ap,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null,layoutMode:i.kB.PC,iSpace:!1},dp=[Be.cd,Be.cd],up={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"},cp=(0,y.iK)(np.e)`
  ${({theme:e})=>x.iv`
    &.resizable-container {
      background-color: transparent;
      position: relative;

      /* re-resizable sets an empty div to 100% width and height, which doesn't
      play well with many 100% height containers we need */

      & ~ div {
        width: auto !important;
        height: auto !important;
      }
    }

    &.resizable-container--resizing {
      /* after ensures border visibility on top of any children */

      &:after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        box-shadow: inset 0 0 0 2px ${e.colors.primary.base};
      }

      & > span .resize-handle {
        border-color: ${e.colors.primary.base};
      }
    }

    .resize-handle {
      opacity: 0;
      z-index: 10;

      &--bottom-right {
        position: absolute;
        border-right: 1px solid ${e.colors.text.label};
        border-bottom: 1px solid ${e.colors.text.label};
        right: ${4*e.gridUnit}px;
        bottom: ${4*e.gridUnit}px;
        width: ${2*e.gridUnit}px;
        height: ${2*e.gridUnit}px;
      }

      &--right {
        width: ${e.gridUnit/2}px;
        height: ${5*e.gridUnit}px;
        right: ${e.gridUnit}px;
        top: 50%;
        transform: translate(0, -50%);
        position: absolute;
        border-left: 1px solid ${e.colors.text.label};
        border-right: 1px solid ${e.colors.text.label};
      }

      &--bottom {
        height: ${e.gridUnit/2}px;
        width: ${5*e.gridUnit}px;
        bottom: ${e.gridUnit}px;
        left: 50%;
        transform: translate(-50%);
        position: absolute;
        border-top: 1px solid ${e.colors.text.label};
        border-bottom: 1px solid ${e.colors.text.label};
      }
    }
  `}

  &.resizable-container:hover .resize-handle,
  &.resizable-container--resizing .resize-handle {
    opacity: 1;
  }

  .dragdroppable-column & .resizable-container-handle--right {
    /* override the default because the inner column's handle's mouse target is very small */
    right: 0 !important;
  }

  & .resizable-container-handle--bottom {
    bottom: 0 !important;
  }
`;class pp extends a.PureComponent{constructor(e){super(e),this.state={isResizing:!1,gutterWidth:"PC"===e.layoutMode?Be.es:Be.Pj},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:r,onResizeStart:o}=this.props;o&&o({id:r,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:r,id:o}=this.props;r&&r({id:o,direction:t,ref:n})}handleResizeStop(e,t,n,r){const{id:o,onResizeStop:i,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:u,adjustableWidth:c}=this.props,{gutterWidth:p}=this.state;if(i){const e=l+Math.round(r.width/(a+p)),t=d+Math.round(r.height/s);i({id:o,widthMultiple:c?e:null,heightMultiple:u?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:r,heightStep:o,widthMultiple:a,heightMultiple:s,staticHeight:l,staticHeightMultiple:d,staticWidth:u,staticWidthMultiple:c,minWidthMultiple:p,maxWidthMultiple:h,minHeightMultiple:f,maxHeightMultiple:g,editMode:m,viewType:v,layoutMode:y,iSpace:C,isFullSize:w}=this.props,{gutterWidth:S}=this.state,Z={width:t?(r+S)*a-S:c&&c*r||u||void 0,height:n?o*s:d&&d*o||l||void 0};if("grid"==v){const{id:e}=this.props,t=document.querySelector(`#${e}`);t&&(Z.height=t.offsetHeight)}let k=ip.notAdjustable;m&&(t&&n?k=ip.widthAndHeight:t?k=ip.widthOnly:n&&(k=ip.heightOnly));const{isResizing:M}=this.state,D=m&&"grid"!==v&&y===i.kB.MOBILE,E=y===i.kB.MOBILE?8:0,R=C?6:0;return(0,x.tZ)(cp,{style:D?w?{}:{zIndex:2}:{},enable:m&&k,grid:dp,minWidth:t?p*(r+S)-S:void 0,minHeight:n?f*o:void 0,maxWidth:t?Math.max(Z.width,Math.min(ap,h*(r+S)-S))-E+R:void 0,maxHeight:n?Math.max(Z.height,Math.min(ap,g*o)):void 0,size:Z,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:rp,className:b()("resizable-container",M&&"resizable-container--resizing"),handleClasses:up},e)}}pp.propTypes=sp,pp.defaultProps=lp;const hp=pp;function fp(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),r=e.split("-")[0];if(t[r.toLowerCase()]=e,!Be.Ep.includes(r))break}}return t}const gp=e=>{const t=(0,o.v9)((e=>e.nativeFilters)),n=((e,t)=>{if(!e.focusedFilterField)return null;const{chartId:n,column:r}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[r]}})((0,o.v9)((e=>e.dashboardState)),(0,o.v9)((e=>e.dashboardFilters))),r=(null==t?void 0:t.focusedFilterId)||(null==t?void 0:t.hoveredFilterId);if(!n&&!r)return{};const i={};var a,s;if(r){if(null!=(a=t.filters[r])&&null!=(s=a.chartsInScope)&&s.includes(e))return i}else if(e===(null==n?void 0:n.chartId)||(0,et.up)({filterScope:null==n?void 0:n.scope}).includes(e))return i;return i},mp=y.iK.div`
  ${({theme:e})=>x.iv`
    position: relative;
    outline: none;

    &.with-popover-menu--focused:after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 2px solid ${e.colors.primary.base};
      pointer-events: none;
    }

    .dashboard-component-tabs li &.with-popover-menu--focused:after {
      top: ${-3*e.gridUnit}px;
      left: ${-2*e.gridUnit}px;
      width: calc(100% + ${4*e.gridUnit}px);
      height: calc(100% + ${7*e.gridUnit}px);
    }
  `}
`,vp=y.iK.div`
  ${({theme:e,isWrap:t})=>x.iv`
    position: absolute;
    flex-wrap: nowrap;
    left: 1px;
    /* top: -42px; */
    top: 0px; // 解决网格布局被遮挡问题 理论上是判断是网格编辑状态editGrid = true才处理成0 但是不影响
    height: ${10*e.gridUnit}px;
    padding: 0 ${4*e.gridUnit}px;
    background: ${e.colors.grayscale.light5};
    box-shadow: 0 1px 2px 1px
      ${(0,C.Zf)(e.colors.grayscale.dark2,parseFloat(e.opacity.mediumLight)/100)};
    font-size: ${e.typography.sizes.m}px;
    cursor: default;
    z-index: 3000;

    &,
    .menu-item {
      display: flex;
      flex-direction: row;
      align-items: center;
      flex-wrap: ${t?"wrap":"nowrap"};
    }

    /* vertical spacer after each menu item */
    .menu-item:not(:last-child):after {
      content: '';
      width: 1px;
      height: 100%;
      background: ${e.colors.grayscale.light2};
      margin: 0 ${4*e.gridUnit}px;
    }
  `}
`;class bp extends a.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:r}=this.props,o=n(e,this.container);r||!o||this.state.isFocused?!o&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1,e)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0,e))}render(){var e;const{children:t,menuItems:n,editMode:r,style:o,isWrap:i}=this.props,{isFocused:a}=this.state;return(0,x.tZ)(mp,{ref:this.setRef,onClick:this.handleClick,role:"none",className:b()("with-popover-menu",r&&a&&"with-popover-menu--focused"),style:o},t,r&&a&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,x.tZ)(vp,{isWrap:i},n.map(((e,t)=>(0,x.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}bp.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};var yp=n(786276),xp=n(973935);const Cp=y.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${({theme:e})=>e.typography.sizes.m};
  }

  .hover-menu--left {
    width: ${({theme:e})=>6*e.gridUnit}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${({theme:e})=>-7*e.gridUnit}px;
    padding: ${({theme:e})=>2*e.gridUnit}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }

  .hover-menu--top {
    //height: ${({theme:e})=>6*e.gridUnit}px;
    //top: ${({theme:e})=>-6*e.gridUnit}px;
    top: 0;
    right: 0;
    //left: 50%;
    transform: translate(-50%);
    //padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }
`;class wp extends a.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,x.tZ)(Cp,{className:"hover-menu-container"},(0,x.tZ)("div",{ref:e,className:b()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}wp.defaultProps={position:"left",innerRef:null,children:null};const Sp=e=>[{key:"box-icon-delete",type:"delete",size:"xxl"}],Zp=y.iK.div`
  ${({theme:e})=>x.iv`
    & {
      width: 35px;
      height: 35px;
      padding: 8px 0 0 9px;
      cursor: pointer;
      position: relative;
      background: ${e.colors.primary.base};
      color: #ffffff;
      transition: background ease 0.35s;
    }
    &:hover,
    &:active {
      background: var(--adm-color-primary);
    }
    &::after {
      background: #ffffff;
      display: block;
      content: '';
      position: absolute;
    }
    &.mobile::after {
      width: 23px;
      height: 1px;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%) scaleY(0.5);
    }
    &.pc::after {
      height: 23px;
      width: 1px;
      top: 50%;
      right: 0;
      transform: translateY(-50%) scaleX(0.5);
    }
  `}
`,kp=y.iK.div`
  ${({activeColor:e,theme:t})=>x.iv`
    & {
      cursor: pointer;
      color: ${e};
      transition: color ease 0.35s;
      .anticon {
        font-size: 16px;
        margin-right: 6px;
      }
    }
    &:hover,
    &:active {
      color: ${t.colors.primary.base};
    }
    &:not(:last-child) {
      margin-bottom: 10px;
    }
  `}
`,Mp=y.iK.div`
  position: absolute;
  inset: 0;
  width: 120px;
  background: #ffff;
  overflow: hidden;
  height: 110px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,Dp=e=>{const{buttons:t=Sp(),onEdit:n,onMore:r,onDelete:o,onTop:i,onBottom:s,onFixed:l,trigger:d="click",float:u}=e,{toolmode:c="hover",isFocused:p}=e,[h,f]=a.useState(""),[g,m]=a.useState(!1),v=(0,y.Fg)();a.useEffect((()=>{f(u?"fixed":"")}),[u]);const b=(e,t)=>{switch(e.stopPropagation(),m(!1),t){case"edit":null==n||n();break;case"delete":null==o||o();break;case"more":m(!g),null==r||r();break;case"top":null==i||i();break;case"bottom":null==s||s()}},C=e=>Object.keys(null!=e?e:[]).length?(0,x.tZ)(Mp,null,null==e?void 0:e.map((e=>(0,x.tZ)(kp,{key:e.key,activeColor:h===e.type?v.colors.primary.base:null,onClick:t=>"fixed"===e.type?((e,t)=>{e.stopPropagation(),(0,xp.unstable_batchedUpdates)((()=>{f(h?"":t),m(!1)})),null==l||l(Boolean(h))})(t,e.type):b(t,e.type)},(0,x.tZ)("div",{style:{display:"flex"}},(0,x.tZ)("div",{style:{width:22}},h===e.type||"fixed"!==e.type?e.icon:null)," ",e.name))))):null,w=(0,x.tZ)(a.Fragment,null,t.map((e=>"more"===e.type?(0,x.tZ)(Q.Z,{onVisibleChange:m,key:e.key,placement:"right",content:()=>C(null==e?void 0:e.children),trigger:d,visible:g},(0,x.tZ)(Zp,{onClick:t=>b(t,e.type)},(0,x.tZ)(ae.Z.CaretMore,{iconSize:e.size}))):(0,x.tZ)(Zp,{key:e.key,onClick:t=>b(t,e.type),className:"mobile"},"edit"===e.type&&(0,x.tZ)(ae.Z.CaretEdit,{iconSize:e.size}),"delete"===e.type&&(0,x.tZ)(ae.Z.CaretDelete,{iconSize:e.size})))));return"click"===c?p?(0,x.tZ)("div",{style:{position:"absolute",right:0,top:0,zIndex:3}},w):null:(0,x.tZ)(wp,{position:"top"},w)};var Ep=n(224350),Rp=n.n(Ep),Tp=n(763105),_p=n.n(Tp);const Ip=()=>(0,o.v9)((e=>e.nativeFilters.filterSets||{})),Op=()=>{const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,o.v9)((e=>e.nativeFilters.filters));return(0,a.useMemo)((()=>Object.entries(t).reduce(((t,[n,r])=>({...t,[n]:{...r,preselect:null==e?void 0:e[n]}})),{})),[t,e])},Pp=()=>{const e=(0,o.v9)((e=>e.dataMask));return(0,a.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(ua.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},zp=(x.iv`
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  width: 100%;
  display: flex;
  align-items: center;
  font-size: 14px;
  min-height: 30px;
  background: #f5f6fa;
  margin-bottom: 15px;
  over-flow: hidden;
  .filter-name {
    padding: 8px 0;
    background: #f5f6fa;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    width: 100px;
  }
  .filter-content {
    flex: 1;
    background: #fff;
    padding: 8px 16px;
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
  }
`,x.iv`
  display: flex;
  align-item: center;
  margin-bottom: 15px;
  height: 32px;
  .input-label {
    width: 100px;
    text-align: right;
    height: 32px;
    line-height: 32px;
  }
`,x.iv`
  width: 100%;
  margin-bottom: 15px;
`,x.iv`
  height: 30px;
  border: 1px solid #d9d9d9;
  width: 100%;
  margin-bottom: 15px;
  border-radius: 2px;
  display: flex;
  align-items: center;
  .color-view {
    width: 20px;
    height: 20px;
    border: 1px solid #dddddd;
    border-radius: 2px;
    margin-left: 10px;
  }
`,(0,y.iK)(Q.Z)`
  .popovercss {
    padding-bottom: 0 !important;
  }
`,(0,y.iK)(Q.Z)`
  .popovercss {
    padding: 12px 0 !important;
    z-index: 999 !important;
  }
`),Fp=x.iv`
  p {
    display: flex;
    align-items: center;
    cursor: pointer;
    color: #666666;
    margin-bottom: 0;
    padding: 6px 10px;
    font-family: PingFang SC-Regular, PingFang SC;
    font-size: 14px;
    :hover {
      background: #f5f9ff;
      color: #101010;
    }
    .anticon {
      margin-top: 4px;
    }
  }
`,Np=({chartId:e,handleToggleFullSize:t,component:n})=>{const r=(0,o.I0)(),s=(0,o.v9)((e=>e.dashboardState.editMode)),l=((0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type}))),d=(0,o.v9)((e=>{var t;return(null==(t=e.dashboardState.dashboardConfig_old)?void 0:t.floats)||[]})),[u,c]=((0,o.v9)((e=>e.dashboardLayout.present)),(0,a.useState)(!1)),[p,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),m=(0,a.useMemo)((()=>!("grid"!=l||!s)),[s,l]),v=(0,a.useMemo)((()=>{var e,t;return null==(e=n.meta)||null==(t=e.gridLayoutConf)?void 0:t.isFloat}),[n]),b=((0,a.useMemo)((()=>m?null:(0,x.tZ)(a.Fragment,null,(0,x.tZ)("p",{onClick:t},(0,x.tZ)(ae.Z.Fangda,null),"\u653e\u5927"),(0,x.tZ)("p",{onClick:()=>c(!0)},(0,x.tZ)(ae.Z.FilterIcon,null),"\u67e5\u770b\u8fc7\u6ee4\u6761\u4ef6"),(0,x.tZ)("p",null,(0,x.tZ)(ae.Z.ViewDetail,null),"\u67e5\u770b\u660e\u7ec6"),(0,x.tZ)("p",null,(0,x.tZ)(ae.Z.ShareIcon,null),"\u5206\u4eab"),(0,x.tZ)("p",null,(0,x.tZ)(ae.Z.DownloadIcon,null),"\u5bfc\u51fa"))),[m]),(0,a.useCallback)((()=>{const e=n.id,t=[...d];for(let n=0;n<t.length;++n)if(t[n]==e&&t.length>1&&n==t.length-1)r((0,rt.Gb)("\u5f53\u524d\u5df2\u5728\u9876\u90e8\uff0c\u4e0d\u53ef\u7f6e\u9876"));else if(t[n]==e&&t.length>1&&n<t.length-1){const e=t[n];t.splice(n,1),t.push(e),r((0,ss.tu)(t)),r((0,rt.ws)("\u7f6e\u9876\u6210\u529f"));break}}),[n,d])),y=(0,a.useCallback)((()=>{const e=n.id,t=[...d];for(let n=0;n<t.length;++n)if(t[n]==e&&t.length>1&&0==n)r((0,rt.Gb)("\u5f53\u524d\u5df2\u5728\u5e95\u90e8\uff0c\u4e0d\u53ef\u7f6e\u5e95"));else if(t[n]==e&&t.length>1&&n>0){const e=t[n];t.splice(n,1),t.unshift(e),r((0,ss.tu)(t)),r((0,rt.ws)("\u7f6e\u5e95\u6210\u529f"));break}}),[n,d]),C=(0,a.useCallback)((()=>{const e=n.id,t=[...d];for(let n=0;n<t.length;++n)if(t[n]==e&&t.length>1&&n==t.length-1)r((0,rt.Gb)("\u5f53\u524d\u5df2\u5728\u9876\u90e8\uff0c\u4e0d\u53ef\u518d\u5f80\u4e0a\u4e00\u5c42"));else if(t[n]==e&&t.length>1&&n<t.length-1){const e=t[n],o=t[n+1];t.splice(n,1,o),t.splice(n+1,1,e),r((0,ss.tu)(t)),r((0,rt.ws)("\u5f80\u4e0a\u4e00\u5c42\u6210\u529f"));break}}),[n,d]),w=(0,a.useCallback)((()=>{const e=n.id,t=[...d];for(let n=0;n<t.length;++n)if(t[n].id==e&&t.length>1&&0==n)r((0,rt.Gb)("\u5f53\u524d\u5df2\u5728\u5e95\u90e8\uff0c\u4e0d\u53ef\u5f80\u4e0b\u4e00\u5c42"));else if(t[n]==e&&t.length>1&&n>0){const e=t[n],o=t[n-1];t[n]=o,t[n-1]=e,r((0,ss.tu)(t)),r((0,rt.ws)("\u5f80\u4e0b\u4e00\u5c42\u6210\u529f"));break}}),[n,d]),S=((0,a.useCallback)((()=>{const e=n.parents.length,t=n.parents[e-1],o=n.id;if(o&&t){r((0,vl.v7)(o,t));const e=[...d];for(let t=0;t<e.length;++t)if(e[t].id==o){e.splice(t,1),r((0,ss.tu)(e));break}}}),[n]),e=>{r((0,vl.Dx)(e));const t=[...d],{id:n,isFloat:o}=e;let i=null,a=-1;for(let e=0;e<t.length;++e)if(t[e]==n){i=t[e],a=e;break}o&&!i&&(t.push(n),r((0,ss.tu)(t))),!o&&i&&a>-1&&(t.splice(a,1),r((0,ss.tu)(t))),setTimeout((()=>{document.querySelector("#dashBlank").click()}))}),Z=(0,a.useMemo)((()=>m?(0,x.tZ)(a.Fragment,null,v?(0,x.tZ)("p",{onClick:()=>S({id:n.id,isFloat:!1})},(0,x.tZ)(ae.Z.Gou,null),"\u5173\u95ed\u60ac\u6d6e"):(0,x.tZ)("p",{onClick:()=>S({id:n.id,isFloat:!0})},"\u5f00\u542f\u60ac\u6d6e"),v&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)("p",{onClick:b},(0,x.tZ)(ae.Z.Zhiding,null),"\u7f6e\u9876"),(0,x.tZ)("p",{onClick:y},(0,x.tZ)(ae.Z.Zhidi,null),"\u7f6e\u5e95"),(0,x.tZ)("p",{onClick:C},(0,x.tZ)(ae.Z.Upone,null),"\u5f80\u4e0a\u4e00\u5c42"),(0,x.tZ)("p",{onClick:w},(0,x.tZ)(ae.Z.Downone,null),"\u5f80\u4e0b\u4e00\u5c42"))):null),[m,n]);return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(zp,{placement:"rightTop",overlayClassName:"popovercss",content:(0,x.tZ)("div",{css:Fp},Z),trigger:"click"},(0,x.tZ)(ae.Z.CaretMore,{iconSize:"xxl"})))},$p=x.iv`
  position: absolute;
  top: 0;
  /* right: -30px; */
  right: 0px;
  background: #5d9cec;
  /* width: 35px; */
  z-index: 999;
  padding-top: 8px;
  padding-left: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  .anticon {
    /* margin-left: 2px; */
    color: white;
    cursor: pointer;
    /* font-size: 24px; */
    /* margin-bottom: 6px; */
  }
`,Lp=e=>{var t,n;const{component:r,handleToggleFullSize:i,onEdit:s}=e,l=(0,o.I0)(),[d,u]=(0,a.useState)(!1),c=r.meta.chartId,p=((0,o.v9)((e=>e)),(0,o.v9)((e=>e.dashboardInfo.id)),(0,o.v9)((e=>e.charts))),h=((0,o.v9)((e=>e.dashboardState.editMode)),p[c],null==(t=p[c])?void 0:t.queriesResponse),f=(null==h||h.map((({is_cached:e})=>e)),(0,o.v9)((e=>e.datasources)),null==(n=p[c])||n.form_data,(0,o.v9)((e=>{var t;return(null==(t=e.dashboardState.dashboardConfig_old)?void 0:t.floats)||[]}))),g=(0,a.useCallback)((()=>{const e=r.parents.length,t=r.parents[e-1],n=r.id;if(n&&t){l((0,vl.v7)(n,t));const e=[...f];for(let t=0;t<e.length;++t)if(e[t].id==n){e.splice(t,1),l(setDashboardFloatComponents(e));break}}}),[r,f]);return(0,x.tZ)("div",{css:$p},s&&(0,x.tZ)(ae.Z.CaretEdit,{iconSize:"xxl",onClick:s}),(0,x.tZ)(ae.Z.CaretDelete,{iconSize:"xxl",onClick:g}),(0,x.tZ)(Np,{component:r,chartId:c,handleToggleFullSize:i}))},Bp={position:"fixed",zIndex:3e3,left:0,top:0},Ap=e=>{var t,n;const{id:r,parentId:s,component:l,parentComponent:d,index:u,depth:c,availableColumnCount:p,columnWidth:h,onResizeStart:g,onResize:m,onResizeStop:v,isComponentVisible:y,dashboardId:C,fullSizeChartId:w,getComponentById:S=(()=>{}),deleteComponent:Z,updateComponents:k,handleComponentDrop:M,setFullSizeChartId:D,isInView:E}=e,{chartId:R}=l.meta,T=w===R,_=gp(R),I=(0,o.v9)((e=>e.dashboardState)),[O,P]=(0,a.useState)({}),[z,F]=(0,a.useState)(),[N,$]=(0,a.useState)(),[L,B]=(0,a.useState)(!1),[A,j]=(0,a.useState)(0),H=(0,a.useMemo)((()=>{var e;return null!=(e=null==I?void 0:I.directPathToChild)?e:[]}),[I]),q=(0,a.useMemo)((()=>{var e;return null!=(e=null==I?void 0:I.directPathLastUpdated)?e:0}),[I]),U=(0,a.useMemo)((()=>fp(H)),[H]);(0,a.useEffect)((()=>{const{label:e,chart:t}=U;q!==A&&l.id===t&&(j(q),F(l.id),$(e))}),[l,A,q,U]),(0,a.useEffect)((()=>{let e;return z&&(e=setTimeout((()=>{F(void 0),$(void 0)}),2e3)),()=>{e&&clearTimeout(e)}}),[z]);const V=(0,a.useMemo)((()=>{var e,t,n;const r=null==(e=S(null==d||null==(n=d.parents)?void 0:n.find((e=>e.startsWith(f.BA)))))||null==(t=e.meta)?void 0:t.width;let o=l.meta.width||Be.cx;var i;(null==d?void 0:d.type)===f.BA?o=(null==d||null==(i=d.meta)?void 0:i.width)||Be.cx:r&&o>r&&(o=r);return o}),[l,S,null==d||null==(t=d.meta)?void 0:t.width,null==d?void 0:d.parents,null==d?void 0:d.type]),W=(0,o.I0)(),G=(0,a.useContext)(Fc.DashboardPageIdContext),K=window.location.origin+`/explore/?dashboard_page_id=${G}&slice_id=${l.meta.chartId}`,Y=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane));(0,a.useEffect)((()=>{W({type:"SET_FORM_DATA_META",meta:l.meta,key:R})}),[l.meta]);const X=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),Q=(0,o.v9)((e=>e.dashboardState.isFulling)),J=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),ee=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.layout_mode})),te=ee===i.kB.MOBILE?Be.Pj:Be.es,ne=(0,a.useMemo)((()=>"grid"==X?!e.editMode:e.editMode),[e,X]),re=(0,a.useMemo)((()=>!("grid"!=X||Q||!e.editMode)),[e,X]),{chartWidth:oe,chartHeight:ie}=(0,a.useMemo)((()=>{let e=0,t=0;if(T)e=window.innerWidth-32,t=window.innerHeight-32;else if(e=Math.floor(V*h+(V-1)*te-32),t=Math.floor(l.meta.height*Be.cd-32),"grid"==X){var n,r,o,i;const c=null==(n=document.querySelector(`#${l.id}`))?void 0:n.clientWidth,p=null==(r=document.querySelector(`#${l.id}`))?void 0:r.clientHeight;var a,s,d,u;if(Number(c))e=c-30;else e=(null==(a=l.meta.gridLayoutConf)||null==(s=a.style)?void 0:s.width)-30;if(Number(p))t=p-25;else t=(null==(d=l.meta.gridLayoutConf)||null==(u=d.style)?void 0:u.height)-30;t=(null==(o=l.meta.gridLayoutConf)||null==(i=o.style)?void 0:i.height)-30}return{chartWidth:e,chartHeight:t}}),[h,l,T,V,e]),ae=(0,a.useCallback)((e=>{k({[l.id]:{...l,meta:{...l.meta,layoutType:"float"===l.meta.layoutType&&e?"grid":"float"}}})}),[k,r,l]),se=(0,a.useCallback)((()=>{var e;k({[l.id]:{...l,meta:{...l.meta,pos:{...l.meta.pos,index:((null==(e=l.meta.pos)?void 0:e.index)||100)+1}}}})}),[k,r,l]),le=(0,a.useCallback)((()=>{var e;k({[l.id]:{...l,meta:{...l.meta,pos:{...l.meta.pos,index:((null==(e=l.meta.pos)?void 0:e.index)||100)-1}}}})}),[k,r,l]),de=(0,a.useCallback)((()=>{Z(r,s)}),[Z,r,s]),ue=(0,a.useCallback)((e=>{k({[l.id]:{...l,meta:{...l.meta,sliceNameOverride:e}}})}),[l,k]),ce=(0,a.useCallback)((()=>{D(T?null:R)}),[R,T,D]),pe=(0,a.useCallback)(((e,t)=>{P((n=>({...n,[e]:t})))}),[]);var he,fe;(_.zIndex=`${null==(n=l.meta.pos)?void 0:n.index}`,"float"===l.meta.layoutType&&l.meta.pos)&&(_.position="absolute",_.left=`${(null==(he=l.meta.pos)?void 0:he.x)||0}px`,_.top=`${(null==(fe=l.meta.pos)?void 0:fe.y)||0}px`);const ge=e=>{"grid"==X&&e.stopPropagation(),W(Q?(0,ss.ks)(null):(0,ss.ks)(l.id))},me=(0,a.useMemo)((()=>{const{backgroundColor:e="rgba(255,255,255,1)",backgroundImage:t,backgroundType:n}=l.meta;return"color"!=n&&n?{backgroundColor:"rgba(255,255,255,1)",backgroundImage:`url(${t})`,backgroundSize:"cover",backgroundPosition:"center center"}:{background:`${e}`}}),[l]),ve=(0,a.useMemo)((()=>({})),[l,Y]),be=e=>{B(!!e)},ye=(0,a.useMemo)((()=>l.meta.displayed||!1),[l]),xe=(0,a.useMemo)((()=>{const{bgColor:e,displayed:t,fontFamily:n,fontSize:r,fontWeight:o,textColor:i}=l.meta;return{background:e||"rgba(225,225,225,1)",fontFamily:n||"SimHei",fontSize:`${r||12}px`,fontWeight:o||400,color:i||"rgba(127,127,127,1)"}}),[l]),[Ce,we]=(0,a.useState)("\u6682\u65e0\u6837\u672c"),[Se,Ze]=(0,a.useState)({}),ke=Se,Me=[],[De,Ee]=null!=ke&&ke.datasource?ke.datasource.split("__"):["",""];(0,a.useEffect)((()=>{if(e.layoutMode===i.kB.PC){var t;const e=null!=(t=(0,yp.w)(ke,Me))?t:{};null!=ke&&ke.extra_form_data&&(0,ln.getDatasourceSamples)(Ee,De,!1,e).then((e=>{we(e.total_count)}))}}),[null==ke?void 0:ke.extra_form_data]);return(0,x.tZ)(Wn,{component:l,parentComponent:d,orientation:(null==d?void 0:d.type)===f.Os?"column":"row",index:u,depth:c,onDrop:M,disableDragDrop:"grid"===X||!ne,editMode:ne,style:_},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,x.tZ)(bp,{isFocused:L,onChangeFocus:be,editMode:ne,isWrap:ne&&ee===i.kB.MOBILE},(0,x.tZ)(hp,{id:l.id,adjustableWidth:(null==d?void 0:d.type)===f.Os,adjustableHeight:!0,widthStep:h,widthMultiple:V,heightStep:Be.cd,heightMultiple:l.meta.height,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:p+V,onResizeStart:g,onResize:m,onResizeStop:v,editMode:"grid"!==X&&ne,viewType:X,layoutMode:ee,isFullSize:T,iSpace:d.children.length>1&&(0,kr.Od)(ee)},(0,x.tZ)("div",{ref:n,"data-test":"dashboard-component-chart-holder",className:b()("dashboard-component","dashboard-component-chart-holder",`dashboard-chart-id-${R}`,z?"fade-in":"fade-out"),onClick:ge,style:{...me,...L?ve:{},...T?Bp:{}}},e.layoutMode===i.kB.PC&&(0,x.tZ)("div",null,(0,x.tZ)("div",{key:l.meta.chartId,style:{display:ye?"block":"none",padding:"0 8px",borderRadius:"10px",position:"absolute",right:"6px",bottom:"6px",...xe}},"*\u6837\u672c\u91cf:",Ce)),!ne&&(0,x.tZ)(Qd.Z,{id:l.id,scrollIntoView:z===l.id}),!!z&&(0,x.tZ)("style",null,`label[for=${N}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n                  }`),re&&l.id==J&&(0,x.tZ)(Lp,{component:l,handleToggleFullSize:ce}),(0,x.tZ)(tp,{componentId:l.id,id:l.meta.chartId,dashboardId:C,width:oe,height:ie,sliceName:l.meta.sliceNameOverride||l.meta.sliceName||"",updateSliceName:ue,isComponentVisible:y,handleToggleFullSize:ce,isFullSize:T,setControlValue:pe,extraControls:O,isInView:E,showSliceName:l.meta.showSliceName,component:l,viewType:X,onDataChange:e=>{(0,ru.JB)(null==e?void 0:e.extra_form_data,null==ke?void 0:ke.extra_form_data)||Ze(e)}}),ne&&!Q&&L&&(0,x.tZ)(Dp,{float:"float"===l.meta.layoutType,onTop:se,onBottom:le,onDelete:de,onFixed:ae,onEdit:()=>{var e;return null!=(e=window)&&e.top?window.top.open(K):window.open(K)},isFocused:L,toolmode:"click"})),t&&(0,x.tZ)("div",t)))))},jp=({onDelete:e})=>(0,x.tZ)(Xd,{onClick:e,icon:(0,x.tZ)(ae.Z.Trash,{iconSize:"xl"})}),Hp={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired},qp=y.iK.div`
  ${({theme:e})=>x.iv`
    div[draggable='true'] & {
      cursor: move;
    }

    .info-class {
      text-align: center;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.3);
      font-size: 12px;
      color: #9ea6b2;
    }

    .main-frame {
      height: 100%;
      width: 100%;

      .frame-mask {
        display: flex;
        opacity: 0.5;
        position: absolute;
        top: 0px;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;

        &.edit-mask {
          left: 0px;
          background-color: #5c5e61;
          height: 100% !important;
          width: 100% !important;

          .edit-mask-text {
            font-size: 18px;
            font-weight: bold;
            color: lawngreen;
          }
        }
      }
    }
  `}
`;class Up extends a.PureComponent{constructor(e){super(e),this.handleDeleteComponent=()=>{const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)},this.handleResizeStart=e=>{const{onResizeStart:t}=this.props;t(e)},this.handleChangeFocus=(e,t)=>{var n;const{setShowComponentPropertyPane:r,dashboardInfo:o,component:i}=this.props;"grid"===(null==o||null==(n=o.metadata)?void 0:n.layout_type)&&t.stopPropagation(),this.setState((()=>({isFocused:Boolean(e)}))),e&&(null==r||r(i.id))},this.state={isFocused:!1}}render(){var e;const{component:t,parentComponent:n,index:r,depth:o,availableColumnCount:i,columnWidth:a,onResize:s,onResizeStop:l,handleComponentDrop:u,editMode:c,dashboardState:p,dashboardInfo:h}=this.props,{isFocused:g}=this.state,m=n.type===f.BA?n.meta.width||Be.cx:t.meta.width||Be.cx,v=null==h||null==(e=h.metadata)?void 0:e.layout_type,b=null==p?void 0:p.dashboardComponentTarget;return(0,x.tZ)(Wn,{component:t,parentComponent:n,orientation:(null==n?void 0:n.type)===f.Os?"column":"row",index:r,depth:o,onDrop:u,disableDragDrop:g,editMode:c},(({dropIndicatorProps:e,dragSourceRef:r})=>{var o;return(0,x.tZ)(bp,{isFocused:g,editMode:c,onChangeFocus:this.handleChangeFocus},(0,x.tZ)(qp,{"data-test":"dashboard-web-component",id:t.id},(0,x.tZ)(hp,{id:t.id,adjustableWidth:(null==n?void 0:n.type)===f.Os,adjustableHeight:!0,widthStep:a,widthMultiple:m,heightStep:Be.cd,heightMultiple:t.meta.height,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:i+m,onResizeStart:this.handleResizeStart,onResize:s,onResizeStop:l,editMode:(!g||"grid"===v)&&c},(0,x.tZ)("div",{ref:r,className:"dashboard-component dashboard-component-chart-holder","data-test":"dashboard-component-chart-holder"},!c&&"grid"===v&&t.id==b&&(0,x.tZ)(Lp,{component:t,handleToggleFullSize:()=>{}}),c&&(0,x.tZ)(wp,{position:"left"},(0,x.tZ)(jp,{onDelete:this.handleDeleteComponent})),c&&(0,x.tZ)(Dp,{float:!1,buttons:[{key:"box-icon-delete",type:"delete",size:"xxl"}],onDelete:this.handleDeleteComponent,isFocused:g,toolmode:"click"}),null!=t&&null!=(o=t.meta)&&o.frameSrc?(0,x.tZ)("div",{className:"main-frame"},(0,x.tZ)("iframe",{id:"iframe-"+t.id,title:"iframe",src:t.meta.frameSrc,scrolling:"auto",frameborder:"0",className:"main-frame"}),c&&(0,x.tZ)("div",{className:"frame-mask edit-mask"},(0,x.tZ)("span",{style:{opacity:1}},(0,x.tZ)("span",{className:"edit-mask-text"},(0,d.t)("Editing status is inoperable. Internal page"))))):(0,x.tZ)("div",{className:"info-class"},(0,d.t)("Please click to add web page information"))))),e&&(0,x.tZ)("div",e))}))}}Up.propTypes=Hp,Up.defaultProps={};const Vp=Up;var Wp=n(178186);(0,d.t)("Edit"),(0,d.t)("Preview");a.PureComponent;const Gp={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,logEvent:l().func.isRequired,addDangerToast:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired,htmlSanitization:l().bool,htmlSchemaOverrides:l().object},Kp="# \u2728Header 1\n## \u2728Header 2\n### \u2728Header 3\n\n<br />\n\nClick here to learn more about [markdown formatting](https://bit.ly/1dQOfRK)",Yp=(0,d.t)("This markdown component has an error."),Xp=y.iK.div`
  ${({theme:e})=>x.iv`
    &.dashboard-markdown {
      overflow: hidden;

      h4,
      h5,
      h6 {
        font-weight: ${e.typography.weights.normal};
      }

      h5 {
        color: ${e.colors.grayscale.base};
      }

      h6 {
        font-size: ${e.typography.sizes.s}px;
      }

      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
      }

      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`;class Qp extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",fontSize:"12",undoLength:e.undoLength,redoLength:e.redoLength,chartHolderBorder:{outline:""}},this.renderStartTime=ie.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleChangeFontSize=this.handleChangeFontSize.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleLayoutDownComponent=this.handleLayoutDownComponent.bind(this),this.handleLayoutUpComponent=this.handleLayoutUpComponent.bind(this),this.handleLayoutTypeComponent=this.handleLayoutTypeComponent.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this),this.settingButtonClick=this.settingButtonClick.bind(this),this.focusHighlightStyles={}}componentDidMount(){this.props.logEvent(ie.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:ie.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:r,markdownSource:o,undoLength:i,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==i||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==r||s.meta.code===o?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&we.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,d.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}handleChangeFontSize(e){const t={...this.state,fontSize:e};this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleLayoutTypeComponent(){const{updateComponents:e,component:t}=this.props;e({[t.id]:{...t,meta:{...t.meta,layoutType:"float"===t.meta.layoutType?"grid":"float"}}})}handleLayoutUpComponent(){var e;const{updateComponents:t,component:n}=this.props;t({[n.id]:{...n,meta:{...n.meta,pos:{...n.meta.pos,index:((null==(e=n.meta.pos)?void 0:e.index)||100)+1}}}})}handleLayoutDownComponent(){var e;const{updateComponents:t,component:n}=this.props;t({[n.id]:{...n,meta:{...n.meta,pos:{...n.meta.pos,index:((null==(e=n.meta.pos)?void 0:e.index)||100)-1}}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:r}=this.props,o="edit"===t;r(e),n&&o&&this.updateMarkdownContent()}renderEditMode(){return(0,x.tZ)(we.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"===typeof this.state.markdownSource?this.state.markdownSource:Kp,readOnly:!1,onLoad:this.setEditor,"data-test":"editor"})}renderPreviewMode(){const{hasError:e}=this.state;return(0,x.tZ)(Wp.Z,{source:e?Yp:this.state.markdownSource||Kp,htmlSanitization:this.props.htmlSanitization,htmlSchemaOverrides:this.props.htmlSchemaOverrides})}settingButtonClick(e){var t;const{component:n,selectedId:r,setSelectedId:o}=this.props,{dashboardInfo:i}=this.props;null==i||null==(t=i.metadata)||t.layout_type;setTimeout((()=>{o(n.id)}),100)}get chartHolderBackground(){const{backgroundType:e,backgroundColor:t,backgroundImage:n}=this.props.component.meta;return"color"!=e&&e?{backgroundColor:"rgba(255,255,255,1)",backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center center"}:{background:`${t}`}}render(){var e,t,n;const{isFocused:r,editorMode:o}=this.state,{component:i,parentComponent:a,index:s,depth:l,availableColumnCount:d,columnWidth:u,onResize:c,onResizeStop:p,handleComponentDrop:h,fullSizeChartId:g,layoutMode:m}=this.props,v=g===(null==i?void 0:i.id),{dashboardInfo:y,dashboardState:C}=this.props,w=null==y||null==(e=y.metadata)?void 0:e.layout_type,S=null==C?void 0:C.dashboardComponentTarget;let Z=this.props.editMode,k=this.props.isEdit;"grid"==w&&(Z=!1,k=!!this.props.editMode||k);const M=(null==a?void 0:a.type)===f.BA?(null==a||null==(t=a.meta)?void 0:t.width)||Be.cx:i.meta.width||Be.cx,D="edit"===o;this.focusHighlightStyles=Object.assign({},this.focusHighlightStyles,{zIndex:`${(null==(n=i.meta.pos)?void 0:n.index)||100}`,position:"relative",left:0,top:0}),"float"===i.meta.layoutType&&i.meta.pos&&(this.focusHighlightStyles=Object.assign({},this.focusHighlightStyles,{position:"absolute",left:`${i.meta.pos.x}px`,top:`${i.meta.pos.y}px`}));const E=()=>{var e,t;const n=null==(e=document.querySelector(`#${i.id}`))?void 0:e.clientWidth,r=null==(t=document.querySelector(`#${i.id}`))?void 0:t.clientHeight;return Number(n)&&Number(r)?{width:n+"px",height:r+"px"}:{}};return(0,x.tZ)(Wn,{component:i,parentComponent:a,orientation:(null==a?void 0:a.type)===f.Os?"column":"row",index:s,depth:l,onDrop:h,disableDragDrop:r||("grid"===w?Z:!Z),editMode:Z,style:this.focusHighlightStyles},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,x.tZ)(bp,{onChangeFocus:this.handleChangeFocus,editMode:k},(0,x.tZ)(Xp,{"data-test":"dashboard-markdown-editor",className:b()("dashboard-markdown",D&&"dashboard-markdown--editing"),id:i.id,style:"grid"===w?{...E()}:{}},(0,x.tZ)(hp,{id:i.id,adjustableWidth:(null==a?void 0:a.type)===f.Os,adjustableHeight:!0,viewType:w,widthStep:u,widthMultiple:M,heightStep:Be.cd,heightMultiple:i.meta.height,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:d+M,onResizeStart:this.handleResizeStart,onResize:c,onResizeStop:p,editMode:(!r||"grid"===w)&&Z,layoutMode:m,isFullSize:v},(0,x.tZ)("div",{ref:t,className:"dashboard-component dashboard-component-chart-holder","data-test":"dashboard-component-chart-holder",onClick:this.settingButtonClick,style:{...this.chartHolderBackground,...this.state.chartHolderBorder,...E()}},k&&"grid"===w&&i.id==S&&(0,x.tZ)(Lp,{component:i,handleToggleFullSize:()=>{}}),k&&"grid"!==w&&(0,x.tZ)(Dp,{float:"float"===i.meta.layoutType,onTop:this.handleLayoutUpComponent,onBottom:this.handleLayoutDownComponent,onDelete:this.handleDeleteComponent,onFixed:this.handleLayoutTypeComponent,isFocused:"edit"===o,toolmode:"click"}),k&&D?this.renderEditMode():this.renderPreviewMode()))),e&&(0,x.tZ)("div",e))))}}Qp.propTypes=Gp,Qp.defaultProps={};const Jp=(0,o.$j)((function(e){var t,n;return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length,htmlSanitization:e.common.conf.HTML_SANITIZATION,htmlSchemaOverrides:e.common.conf.HTML_SANITIZATION_SCHEMA_EXTENSIONS,viewType:e.dashboardState.viewType,selectedId:e.dashboardState.showComponentPropertyPane,layoutMode:null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode}}),(function(e){return{setSelectedId:t=>e((0,ss.ks)(t))}}))(Qp),eh=y.iK.div`
  ${({theme:e,position:t})=>x.iv`
    height: ${5*e.gridUnit}px;
    overflow: hidden;
    cursor: move;
    ${"top"===t&&x.iv`
      transform: rotate(90deg);
    `}
    & path {
      fill: ${e.colors.grayscale.base};
    }
  `}
`;function th({position:e="left",innerRef:t=null}){return(0,x.tZ)(eh,{ref:t,position:e},(0,x.tZ)(ae.Z.Drag,null))}var nh=n(272673);const rh={id:l().string,parentId:l().string,depth:l().number,index:l().number,renderHoverMenu:l().bool,renderTabContent:l().bool,onChangeTab:l().func,component:It.cP.isRequired,parentComponent:It.cP.isRequired,createComponent:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,logEvent:l().func.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,dashboardId:l().number.isRequired,isComponentVisible:l().bool};class oh extends a.PureComponent{render(){const{component:e}=this.props,t=e?_k[e.type]:null;return t?(0,x.tZ)(t,this.props):null}}oh.propTypes=rh,oh.defaultProps={isComponentVisible:!0};const ih=(0,o.$j)((function({mobileDashboardLayout:e,dashboardState:t,dashboardInfo:n},r){const o=e.present,{id:a,parentId:s}=r,l=o[a],d={component:l,getComponentById:e=>o[e],parentComponent:o[s],editMode:t.editMode,layoutMode:i.kB.MOBILE,filters:(0,et.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId,dashboardState:t,dashboardInfo:n};if(l){const e=l.type;if(e===f.Os||e===f.BA){const{occupiedWidth:t,minimumWidth:n}=(0,nh.Z)({id:a,components:o});e===f.Os&&(d.occupiedColumnCount=t),e===f.BA&&(d.minColumnWidth=n)}}return d}),(function(e){return(0,r.DE)({addDangerToast:rt.Gb,createComponent:bl.LM,deleteComponent:bl.v7,updateComponents:bl.WZ,handleComponentDrop:bl._p,setDirectPathToChild:ss.E2,setFullSizeChartId:ss.zL,setActiveTabs:ss.$_,logEvent:Vd.logEvent,setShowComponentPropertyPane:ss.ks},e)}))(oh),ah={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,layoutMode:i.kB,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,minColumnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired},sh=y.iK.div`
  ${({theme:e})=>x.iv`
    &.grid-column {
      width: 100%;
      position: relative;

      & > :not(.hover-menu):not(:last-child) {
        margin-bottom: ${4*e.gridUnit}px;
      }
    }

    .dashboard--editing &:after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
      border: 1px dashed ${e.colors.grayscale.light2};
    }
    .dashboard--editing .resizable-container--resizing:hover > &:after,
    .dashboard--editing .hover-menu:hover + &:after {
      border: 1px dashed ${e.colors.primary.base};
      z-index: 2;
    }
  `}
`,lh=e=>x.iv`
  min-height: ${25*e.gridUnit}px;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${e.colors.text.label};
`;class dh extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){const{setShowComponentPropertyPane:t,component:n}=this.props;this.setState((()=>({isFocused:Boolean(e)}))),e&&(null==t||t(n.id))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:o,minColumnWidth:a,depth:s,onResizeStart:l,onResize:u,onResizeStop:c,handleComponentDrop:p,editMode:h,layoutMode:f,onChangeTab:g,isComponentVisible:m}=this.props,v=f===i.kB.MOBILE?ih:Pk,y=e.children||[],C=Zl.Z.find((t=>t.value===(e.meta.background||Be.HE)));return(0,x.tZ)(Wn,{component:e,parentComponent:t,orientation:"column",index:n,depth:s,onDrop:p,editMode:h},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,x.tZ)(hp,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:o,widthMultiple:e.meta.width,minWidthMultiple:a,maxWidthMultiple:r+(e.meta.width||0),onResizeStart:l,onResize:u,onResizeStop:c,editMode:h},(0,x.tZ)(bp,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,editMode:h},h&&(0,x.tZ)(Dp,{float:!1,buttons:[{key:"box-icon-delete",type:"delete",size:"xxl"}],onDelete:this.handleDeleteComponent,isFocused:this.state.isFocused,toolmode:"click"}),(0,x.tZ)(sh,{className:b()("grid-column",C.className)},0===y.length?(0,x.tZ)("div",{css:lh},(0,d.t)("Empty column")):y.map(((t,n)=>(0,x.tZ)(v,{key:t,id:t,parentId:e.id,depth:s+1,index:n,availableColumnCount:e.meta.width,columnWidth:o,onResizeStart:l,onResize:u,onResizeStop:c,isComponentVisible:m,onChangeTab:g}))),t&&(0,x.tZ)("div",t))))))}}dh.propTypes=ah,dh.defaultProps={};const uh=dh,ch={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,depth:l().number.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired},ph=y.iK.div`
  ${({theme:e,dividerStyle:t})=>x.iv`
    width: 100%;
    padding: ${2*e.gridUnit}px 0; /* this is padding not margin to enable a larger mouse target */
    background-color: transparent;
    &:after {
      content: '';
      height: 1px;
      width: 100%;
      border-bottom: ${t.borderBottom};
      display: block;
    }

    div[draggable='true'] & {
      cursor: move;
    }

    .dashboard-component-tabs & {
      padding-left: ${4*e.gridUnit}px;
      padding-right: ${4*e.gridUnit}px;
    }
  `}
`;class hh extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}settingButtonClick(e){var t;const{setShowComponentPropertyPane:n,dashboardInfo:r,component:o}=this.props;"grid"===(null==r||null==(t=r.metadata)?void 0:t.layout_type)&&e.stopPropagation(),n(o.id)}handleChangeFocus(e){const{setShowComponentPropertyPane:t,component:n}=this.props;this.setState((()=>({isFocused:Boolean(e)}))),e&&(null==t||t(n.id))}get dividerStyle(){const{lineSize:e,lineType:t,lineColor:n}=this.props.component.meta;return{borderBottom:`${e||1}px ${t||"solid"} ${n||"#E0E0E0"}`}}render(){var e;const{component:t,depth:n,parentComponent:r,index:o,handleComponentDrop:i}=this.props,{dashboardState:a,dashboardInfo:s}=this.props,l=null==s||null==(e=s.metadata)?void 0:e.layout_type,d=null==a?void 0:a.dashboardComponentTarget;let u=this.props.editMode;return"grid"==l&&(u=!1),(0,x.tZ)(Wn,{component:t,parentComponent:r,orientation:"row",index:o,depth:n,onDrop:i,editMode:u},(({dropIndicatorProps:e,dragSourceRef:n})=>(0,x.tZ)("div",{ref:n,onClick:e=>{this.settingButtonClick(e)}},(0,x.tZ)(bp,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,editMode:u},!u&&"grid"===l&&t.id==d&&(0,x.tZ)(Lp,{component:t,handleToggleFullSize:()=>{}}),u&&(0,x.tZ)(wp,{position:"left"},(0,x.tZ)(jp,{onDelete:this.handleDeleteComponent})),u&&(0,x.tZ)(Dp,{float:!1,buttons:[{key:"box-icon-delete",type:"delete",size:"xxl"}],onDelete:this.handleDeleteComponent,isFocused:this.state.isFocused,toolmode:"click"}),(0,x.tZ)(ph,{dividerStyle:this.dividerStyle,className:"dashboard-component dashboard-component-divider"}),e&&(0,x.tZ)("div",e)))))}}hh.propTypes=ch;const fh=(0,o.$j)((function(e){var t,n;return{selectedId:e.dashboardState.showComponentPropertyPane,layoutType:null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type}}),(function(e){return{setSelectedId:t=>e(setShowComponentPropertyPane(t))}}))(hh);var gh=n(879271);const mh={id:l().string.isRequired,dashboardId:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,depth:l().number.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,isEdit:l().bool.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired},vh=y.iK.div`
  ${({theme:e})=>x.iv`
    font-weight: ${e.typography.weights.bold};
    width: 100%;
    padding: ${4*e.gridUnit}px 0;

    &.header-small {
      font-size: ${e.typography.sizes.l}px;
    }

    &.header-medium {
      font-size: ${e.typography.sizes.xl}px;
    }

    &.header-large {
      font-size: ${e.typography.sizes.xxl}px;
    }

    .dashboard--editing .dashboard-grid & {
      &:after {
        border: 1px dashed transparent;
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
        pointer-events: none;
      }

      &:hover:after {
        border: 1px dashed ${e.colors.primary.base};
        z-index: 2;
      }
    }

    .dashboard--editing .dragdroppable-row & {
      cursor: move;
    }

    /**
   * grids add margin between items, so don't double pad within columns
   * we'll not worry about double padding on top as it can serve as a visual separator
   */
    .grid-column > :not(:last-child) & {
      margin-bottom: ${-4*e.gridUnit}px;
    }

    .background--white &,
    &.background--white,
    .dashboard-component-tabs & {
      padding-left: ${4*e.gridUnit}px;
      padding-right: ${4*e.gridUnit}px;
    }
  `}
`;class bh extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleLayoutDownComponent=this.handleLayoutDownComponent.bind(this),this.handleLayoutUpComponent=this.handleLayoutUpComponent.bind(this),this.handleLayoutTypeComponent=this.handleLayoutTypeComponent.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeText=this.handleUpdateMeta.bind(this,"text"),this.settingButtonClick=this.settingButtonClick.bind(this),this.focusHighlightStyles={}}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleLayoutTypeComponent(){const{updateComponents:e,component:t}=this.props;e({[t.id]:{...t,meta:{...t.meta,layoutType:"float"===t.meta.layoutType?"grid":"float"}}})}handleLayoutUpComponent(){var e;const{updateComponents:t,component:n}=this.props;t({[n.id]:{...n,meta:{...n.meta,pos:{...n.meta.pos,index:((null==(e=n.meta.pos)?void 0:e.index)||100)+1}}}})}handleLayoutDownComponent(){var e;const{updateComponents:t,component:n}=this.props;t({[n.id]:{...n,meta:{...n.meta,pos:{...n.meta.pos,index:((null==(e=n.meta.pos)?void 0:e.index)||100)-1}}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}settingButtonClick(e){var t;const{component:n,selectedId:r,setSelectedId:o}=this.props,{setShowComponentPropertyPane:i,dashboardInfo:a}=this.props;"grid"===(null==a||null==(t=a.metadata)?void 0:t.layout_type)&&e.stopPropagation(),o(n.id)}get headerBackground(){const{backgroundType:e,backgroundColor:t,bgColor:n,backgroundImage:r}=this.props.component.meta;return"color"!=e&&e?{backgroundColor:"rgba(255,255,255,1)",backgroundImage:`url(${r})`,backgroundSize:"cover",backgroundPosition:"center center"}:{background:`${t||n}`}}get headerTextStyle(){const{fontSize:e,fontFamily:t,fontWeight:n,textColor:r,sliceNameLine:o}=this.props.component.meta;return{fontSize:`${e||14}px`,fontFamily:t||"SimSun",fontWeight:n||500,color:r||"rgba(0,0,0,1)",textAlign:o||"left"}}render(){var e,t;const{isFocused:n}=this.state,{dashboardId:r,component:o,depth:i,parentComponent:a,index:s,handleComponentDrop:l,isEdit:d}=this.props;let u=this.props.editMode;const{dashboardState:c,dashboardInfo:p}=this.props,h=null==p||null==(e=p.metadata)?void 0:e.layout_type,f=null==c?void 0:c.dashboardComponentTarget;"grid"==h&&(u=!this.props.editMode);const g=gh.Z.find((e=>e.value===(o.meta.headerSize||Be.u_))),m=Zl.Z.find((e=>e.value===(o.meta.background||Be.HE)));return this.focusHighlightStyles=Object.assign({},this.focusHighlightStyles,{zIndex:`${(null==(t=o.meta.pos)?void 0:t.index)||100}`,position:"relative",left:0,top:0}),"float"===o.meta.layoutType&&o.meta.pos&&(this.focusHighlightStyles=Object.assign({},this.focusHighlightStyles,{position:"absolute",left:`${o.meta.pos.x}px`,top:`${o.meta.pos.y}px`})),(0,x.tZ)(Wn,{component:o,parentComponent:a,orientation:"row",index:s,depth:i,onDrop:l,disableDragDrop:n||("grid"===h?u:!u),editMode:u,style:this.focusHighlightStyles},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,x.tZ)("div",{ref:t,onClick:this.settingButtonClick,style:{...this.headerBackground,textAlign:this.headerTextStyle.textAlign}},d&&i<=2&&(0,x.tZ)(wp,{position:"left"},(0,x.tZ)(th,{position:"left"})),(0,x.tZ)(bp,{onChangeFocus:this.handleChangeFocus,menuItems:[],editMode:u},(0,x.tZ)(vh,{className:b()("dashboard-component","dashboard-component-header",g.className,m.className)},d&&(0,x.tZ)(Dp,{float:"float"===o.meta.layoutType,onTop:this.handleLayoutUpComponent,onBottom:this.handleLayoutDownComponent,onDelete:this.handleDeleteComponent,onFixed:this.handleLayoutTypeComponent,isFocused:n,toolmode:"click"}),!u&&"grid"===h&&o.id==f&&(0,x.tZ)(Lp,{component:o,handleToggleFullSize:()=>{}}),(0,x.tZ)(au.Z,{style:{...this.headerTextStyle},title:o.meta.text,canEdit:d,onSaveTitle:this.handleChangeText,showTooltip:!1}),!d&&(0,x.tZ)(Qd.Z,{id:o.id,dashboardId:r}))),e&&(0,x.tZ)("div",e))))}}bh.propTypes=mh,bh.defaultProps={};const yh=(0,o.$j)((function(e){return{selectedId:e.dashboardState.showComponentPropertyPane}}),(function(e){return{setSelectedId:t=>e((0,ss.ks)(t))}}))(bh);var xh=n(71894);const Ch={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,layoutMode:i.kB,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,occupiedColumnCount:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired},wh=y.iK.div`
  ${({theme:e,ismobile:t})=>x.iv`
    position: relative;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: flex-start;
    width: 100%;
    height: fit-content;
    //min-height: ${25*e.gridUnit}px;

    & > :not(:last-child):not(.hover-menu) {
      margin-right: ${t?e.gridUnit:4*e.gridUnit}px;
    }

    &.grid-row--empty {
      min-height: ${25*e.gridUnit}px;
    }
  `}
`,Sh=e=>x.iv`
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${e.colors.text.label};
`;class Zh extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1,isInView:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.containerRef=a.createRef(),this.observerEnabler=null,this.observerDisabler=null}componentDidMount(){if((0,u.c)(u.T.DASHBOARD_VIRTUALIZATION)&&!(0,xh.b)()){this.observerEnabler=new IntersectionObserver((([e])=>{e.isIntersecting&&!this.state.isInView&&this.setState({isInView:!0})}),{rootMargin:"100% 0px"}),this.observerDisabler=new IntersectionObserver((([e])=>{!e.isIntersecting&&this.state.isInView&&this.setState({isInView:!1})}),{rootMargin:"400% 0px"});const e=this.containerRef.current;e&&(this.observerEnabler.observe(e),this.observerDisabler.observe(e))}}componentWillUnmount(){var e,t;null==(e=this.observerEnabler)||e.disconnect(),null==(t=this.observerDisabler)||t.disconnect()}handleChangeFocus(e){const{setShowComponentPropertyPane:t,component:n}=this.props;this.setState((()=>({isFocused:Boolean(e)}))),e&&(null==t||t(n.id))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:o,occupiedColumnCount:s,depth:l,onResizeStart:u,onResize:c,onResizeStop:p,handleComponentDrop:h,editMode:f,layoutMode:g,onChangeTab:m,isComponentVisible:v}=this.props,y=g===i.kB.MOBILE?ih:Pk,C=e.children||[],w=Zl.Z.find((t=>t.value===(e.meta.background||Be.HE))),S=(0,kr.Od)(g);return(0,x.tZ)(Wn,{component:e,parentComponent:t,orientation:"row",index:n,depth:l,onDrop:h,editMode:f},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,x.tZ)(a.Fragment,null,f&&g!==i.kB.MOBILE&&(0,x.tZ)(wp,{innerRef:n,position:"left"},(0,x.tZ)(jp,{onDelete:this.handleDeleteComponent})),(0,x.tZ)(wh,{className:b()("grid-row",0===C.length&&"grid-row--empty",w.className),"data-test":`grid-row-${w.className}`,ref:this.containerRef,ismobile:S},0===C.length?(0,x.tZ)("div",{css:Sh},(0,d.t)("Empty row")):C.map(((t,n)=>(0,x.tZ)(y,{key:t,id:t,parentId:e.id,depth:l+1,index:n,availableColumnCount:r-s,columnWidth:o,onResizeStart:u,onResize:c,onResizeStop:p,isComponentVisible:v,onChangeTab:m,isInView:this.state.isInView}))),t&&(0,x.tZ)("div",t)))))}}Zh.propTypes=Ch;const kh=Zh;var Mh=n(94301);const Dh=function(e){return a.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),a.createElement("g",{id:"MoreOutline-MoreOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},a.createElement("g",{id:"MoreOutline-\u7f16\u7ec4"},a.createElement("rect",{id:"MoreOutline-\u77e9\u5f62",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),a.createElement("path",{d:"M12,21 C13.6568542,21 15,22.3431458 15,24 C15,25.6568542 13.6568542,27 12,27 C10.3431458,27 9,25.6568542 9,24 C9,22.3431458 10.3431458,21 12,21 Z M24,21 C25.6568542,21 27,22.3431458 27,24 C27,25.6568542 25.6568542,27 24,27 C22.3431458,27 21,25.6568542 21,24 C21,22.3431458 22.3431458,21 24,21 Z M36,21 C37.6568542,21 39,22.3431458 39,24 C39,25.6568542 37.6568542,27 36,27 C34.3431458,27 33,25.6568542 33,24 C33,22.3431458 34.3431458,21 36,21 Z",id:"MoreOutline-\u5f62\u72b6\u7ed3\u5408",fill:"currentColor",fillRule:"nonzero"}))))};var Eh=n(867e3);const Rh={filterButtonMore:"VQnbN8_X2bPmexV2SVH1",gridContent:"DRcj58YjZCma5P2S1e5n"};var Th=n(981945);const _h=function(e){return a.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),a.createElement("g",{id:"FilterOutline-FilterOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},a.createElement("g",{id:"FilterOutline-\u7f16\u7ec4"},a.createElement("rect",{id:"FilterOutline-\u77e9\u5f62",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),a.createElement("path",{d:"M38,4 C40.209139,4 42,5.76907707 42,7.95134424 L42,10.9773332 C42,11.5050389 41.7864467,12.0082085 41.4113229,12.3772068 L30,22.7810491 L30,37.3492129 C30,38.7371734 29.2628047,40.0233629 28.057983,40.7374627 L21.0289915,43.7181542 C20.081831,44.2795378 18.8533105,43.9761435 18.2850141,43.0405042 C18.0985157,42.7334543 18,42.3821079 18,42.0240293 L18,22.7810491 L6.7196312,12.4950865 C6.26364602,12.119721 6,11.5636728 6,10.9773332 L6,7.95134424 C6,5.76907707 7.790861,4 10,4 L38,4 Z M38,6.96350818 L10,6.96350818 C9.48716416,6.96350818 9.06449284,7.3448526 9.00672773,7.83614169 L9,7.95134424 L9,10.3374937 C9,10.450388 9.04770634,10.5580256 9.13134834,10.6338487 L20.8686517,21.2739462 C20.9522937,21.3497694 21,21.4574069 21,21.5703012 L21,39.7002583 C21,39.9211722 21.1790861,40.1002583 21.4,40.1002583 C21.4482784,40.1002583 21.496158,40.0915183 21.5413228,40.0744612 L26.5144958,38.1962754 L26.5144958,38.1962754 C26.7780505,38.0400661 26.9520986,37.7743552 26.9914926,37.477912 L27,37.3492129 L27,21.5702904 C27,21.4574024 27.047701,21.3497702 27.1313349,21.2739476 L38.8686651,10.6328595 C38.952299,10.5570368 39,10.4494047 39,10.3365167 L39,7.95134424 L39,7.95134424 C39,7.4447465 38.6139598,7.02721653 38.1166211,6.97015407 L38,6.96350818 Z M42,36.0229179 L42,38.186426 C42,38.4073399 41.8209139,38.586426 41.6,38.586426 L34.4,38.586426 C34.1790861,38.586426 34,38.4073399 34,38.186426 L34,36.0229179 C34,35.802004 34.1790861,35.6229179 34.4,35.6229179 L41.6,35.6229179 C41.8209139,35.6229179 42,35.802004 42,36.0229179 Z M42,30.0959015 L42,32.2594097 C42,32.4803236 41.8209139,32.6594097 41.6,32.6594097 L34.4,32.6594097 C34.1790861,32.6594097 34,32.4803236 34,32.2594097 L34,30.0959015 C34,29.8749876 34.1790861,29.6959015 34.4,29.6959015 L41.6,29.6959015 C41.8209139,29.6959015 42,29.8749876 42,30.0959015 Z M42,24.1688851 L42,26.3323933 C42,26.5533072 41.8209139,26.7323933 41.6,26.7323933 L34.4,26.7323933 C34.1790861,26.7323933 34,26.5533072 34,26.3323933 L34,24.1688851 C34,23.9479712 34.1790861,23.7688851 34.4,23.7688851 L41.6,23.7688851 C41.8209139,23.7688851 42,23.9479712 42,24.1688851 Z",id:"FilterOutline-\u5f62\u72b6",fill:"currentColor",fillRule:"nonzero"}))))};var Ih=n(708509);const Oh=e=>{let t=0;const n=()=>e[t++](n);n()};const Ph={box:"xz9YBp_koauFPXMuAtJw",left:"Qdg88gr6oDl9SgOeenyw",menu:"oAG0Z0fIy_Iz0IMMb6N6",right:"caqtFIYC1zQnYmVQUyCY",tabTitle:"USX2PF8TYiEGpk2_YeB8",tabSpan:"Ov4dX6J5OhIbRLwjXRzy",content:"hChCxvVnoIUcjNlO0IXH",popContent:"LuAGLJnI18gh_lL6eBZ2",popHeader:"s4iNlKuIrNxhoXucTKAo",popHeaderBr:"feoKrUZZik1Aso4Asee6",popFooter:"ajCoj1M8Pc_hKgkqPz47"},zh=e=>{const{children:t,scrollHeight:n,tabHeaderStyle:r,showMore:i,button:s,defaultButton:l,allButton:d,editMode:u,filterRowIds:c,contentStyle:p,mainStyle:h,num:f=3,renderGridLayoutSecondary:g}=e,[m,v]=(0,a.useState)(!1),b=(0,o.v9)((e=>e.dashboardState.mobileFilterType)),[y,C]=(0,a.useState)(""),w=(0,o.I0)(),S=()=>v(!1);return(0,x.tZ)("div",{className:`${Ph.mobileFilter} mobile-filter-main`,style:p},Array.isArray(s)&&s.length&&Array.isArray(l)&&l.length?(0,x.tZ)("header",{className:Ph.box,style:{...r}},(0,x.tZ)("div",{className:Ph.left},(0,x.tZ)(Th.mQ,{onChange:C,activeKey:y,style:"vertical"===b?{display:"none"}:{}},s.map((e=>(0,x.tZ)(Th.mQ.Tab,{title:e,key:e.key})))),(0,x.tZ)(Th.mQ,{activeKey:y,style:"horizontal"===b?{display:"none"}:{}},l.map((e=>(0,x.tZ)(Th.mQ.Tab,{title:e,key:e.key}))))),i&&(null==c?void 0:c.length)>f?(0,x.tZ)("div",{className:Ph.right,onClick:e=>{null==e||e.stopPropagation(),v(!0),w((0,ss.ys)("vertical"))}},(0,x.tZ)(_h,null)):null):null,(0,x.tZ)("main",{className:Ph.content,style:n?{height:n,...h}:{...h}},t),(0,x.tZ)("div",{style:{display:"none"}},null==g?void 0:g({elements:d})),(0,x.tZ)(Ih.Z,{closeOnMaskClick:!1,position:"right",visible:m,onMaskClick:()=>{S(),setTimeout((()=>{w((0,ss.ys)("horizontal"))}),450)},afterClose:()=>{},afterShow:()=>{}},(0,x.tZ)("div",{className:Ph.popContent},(0,x.tZ)("div",{className:`${Ph.popHeader} ${u?"":Ph.popHeaderBr}`},d),(0,x.tZ)("div",{className:Ph.popFooter},(0,x.tZ)(Th.zx,{onClick:()=>{Oh([e=>{w((0,ss.rE)({confirm:!1,reset:!0})),setTimeout(e,0)},()=>w((0,ss.rE)({confirm:!1,reset:!1}))])},size:"small",block:!0,style:{marginLeft:6,marginRight:6}},"\u91cd\u7f6e"),(0,x.tZ)(Th.zx,{onClick:()=>{w((0,ss.rE)({confirm:!0,reset:!1})),S()},size:"small",block:!0,color:"primary",style:{marginLeft:6,marginRight:6}},"\u786e\u5b9a")))))};function Fh(e,t){for(var n=e.length,r=0;r<n;++r)if(t(e[r],r))return!0;return!1}function Nh(e,t){for(var n=e.length,r=0;r<n;++r)if(t(e[r],r))return e[r];return null}function $h(e){var t=e;if("undefined"===typeof t){if("undefined"===typeof navigator||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}function Lh(e,t){try{return new RegExp(e,"g").exec(t)}catch(e){return null}}function Bh(){if("undefined"===typeof navigator||!navigator||!navigator.userAgentData)return!1;var e=navigator.userAgentData,t=e.brands||e.uaList;return!(!t||!t.length)}function Ah(e){return e.replace(/_/g,".")}function jh(e,t){var n=null,r="-1";return Fh(e,(function(e){var o=Lh("("+e.test+")((?:\\/|\\s|:)([0-9|\\.|_]+))?",t);return!(!o||e.brand)&&(n=e,r=o[3]||"-1",e.versionAlias?r=e.versionAlias:e.versionTest&&(r=function(e,t){var n=Lh("("+e+")((?:\\/|\\s|:)([0-9|\\.|_]+))",t);return n?n[3]:""}(e.versionTest.toLowerCase(),t)||r),r=Ah(r),!0)})),{preset:n,version:r}}function Hh(e,t){var n={brand:"",version:"-1"};return Fh(e,(function(e){var r=qh(t,e);return!!r&&(n.brand=e.id,n.version=e.versionAlias||r.version,"-1"!==n.version)})),n}function qh(e,t){return Nh(e,(function(e){var n=e.brand;return Lh(""+t.test,n.toLowerCase())}))}var Uh=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],Vh=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],Wh=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],Gh=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],Kh=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function Yh(e){return!!jh(Gh,e).preset}function Xh(e){var t=navigator.userAgentData,n=(t.uaList||t.brands).slice(),r=e&&e.fullVersionList,o=t.mobile||!1,i=n[0],a=(e&&e.platform||t.platform||navigator.platform).toLowerCase(),s={name:i.brand,version:i.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!Hh(Gh,n).brand||Yh($h())},l={name:"unknown",version:"-1",majorVersion:-1};s.webkit=!s.chromium&&Fh(Wh,(function(e){return qh(n,e)}));var d=Hh(Vh,n);if(s.chromium=!!d.brand,s.chromiumVersion=d.version,!s.chromium){var u=Hh(Wh,n);s.webkit=!!u.brand,s.webkitVersion=u.version}var c=Nh(Kh,(function(e){return new RegExp(""+e.test,"g").exec(a)}));if(l.name=c?c.id:"",e&&(l.version=e.platformVersion),r&&r.length){var p=Hh(Uh,r);s.name=p.brand||s.name,s.version=p.version||s.version}else{var h=Hh(Uh,n);s.name=h.brand||s.name,s.version=h.brand&&e?e.uaFullVersion:h.version}return s.webkit&&(l.name=o?"ios":"mac"),"ios"===l.name&&s.webview&&(s.version="-1"),l.version=Ah(l.version),s.version=Ah(s.version),l.majorVersion=parseInt(l.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:l,isMobile:o,isHints:!0}}function Qh(e){return"undefined"===typeof e&&Bh()?Xh():function(e){var t=$h(e),n=!!/mobi/g.exec(t),r={name:"unknown",version:"-1",majorVersion:-1,webview:Yh(t),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},o={name:"unknown",version:"-1",majorVersion:-1},i=jh(Uh,t),a=i.preset,s=i.version,l=jh(Kh,t),d=l.preset,u=l.version,c=jh(Vh,t);if(r.chromium=!!c.preset,r.chromiumVersion=c.version,!r.chromium){var p=jh(Wh,t);r.webkit=!!p.preset,r.webkitVersion=p.version}return d&&(o.name=d.id,o.version=u,o.majorVersion=parseInt(u,10)),a&&(r.name=a.id,r.version=s,r.webview&&"ios"===o.name&&"safari"!==r.name&&(r.webview=!1)),r.majorVersion=parseInt(r.version,10),{browser:r,os:o,isMobile:n,isHints:!1}}(e)}const Jh=Qh;function ef(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.map((function(t){return t.split(" ").map((function(t){return t?""+e+t:""})).join(" ")})).join(" ")}function tf(e,t){return function(n){n&&(e[t]=n)}}function nf(e,t,n){return function(r){r&&(e[t][n]=r)}}var rf="function",of="object",af="string",sf="number",lf="undefined",df=typeof window!==lf,uf=typeof document!==lf&&document,cf=[{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:'\\"',close:'\\"'},{open:"\\'",close:"\\'"}],pf=1e-7,hf={cm:function(e){return 96*e/2.54},mm:function(e){return 96*e/254},in:function(e){return 96*e},pt:function(e){return 96*e/72},pc:function(e){return 96*e/6},"%":function(e,t){return e*t/100},vw:function(e,t){return void 0===t&&(t=window.innerWidth),e/100*t},vh:function(e,t){return void 0===t&&(t=window.innerHeight),e/100*t},vmax:function(e,t){return void 0===t&&(t=Math.max(window.innerWidth,window.innerHeight)),e/100*t},vmin:function(e,t){return void 0===t&&(t=Math.min(window.innerWidth,window.innerHeight)),e/100*t}};function ff(e,t,n,r){return(e*r+t*n)/(n+r)}function gf(e){return typeof e===lf}function mf(e){return e&&typeof e===of}function vf(e){return Array.isArray(e)}function bf(e){return typeof e===af}function yf(e){return typeof e===sf}function xf(e){return typeof e===rf}function Cf(e,t,n,r,o){return wf(e,t,n)?n:function(e,t,n,r,o){for(var i,a=function(n){var a=t[n].trim();if(a===e.close&&!wf(e,t,n))return{value:n};var s=n,l=Tf(o,(function(e){return e.open===a}));if(l&&(s=Cf(l,t,n,r,o)),-1===s)return i=n,"break";i=n=s},s=n;s<r;++s){var l=a(s);if(s=i,"object"===typeof l)return l.value;if("break"===l)break}return-1}(e,t,n+1,r,o)}function wf(e,t,n){if(!e.ignore)return null;var r=t.slice(Math.max(n-3,0),n+3).join("");return new RegExp(e.ignore).exec(r)}function Sf(e,t){var n=bf(t)?{separator:t}:t,r=n.separator,o=void 0===r?",":r,i=n.isSeparateFirst,a=n.isSeparateOnlyOpenClose,s=n.isSeparateOpenClose,l=void 0===s?a:s,d=n.openCloseCharacters,u=void 0===d?cf:d,c=u.map((function(e){var t=e.open,n=e.close;return t===n?t:t+"|"+n})).join("|"),p=new RegExp("(\\s*"+o+"\\s*|"+c+"|\\s+)","g"),h=e.split(p).filter((function(e){return e&&"undefined"!==e})),f=h.length,g=[],m=[];function v(){return!!m.length&&(g.push(m.join("")),m=[],!0)}for(var b,y=function(t){var n=h[t].trim(),r=t,s=Tf(u,(function(e){return e.open===n})),d=Tf(u,(function(e){return e.close===n}));if(s){if(-1!==(r=Cf(s,h,t,f,u))&&l)return v()&&i?(b=t,"break"):(g.push(h.slice(t,r+1).join("")),t=r,i?(b=t,"break"):(b=t,"continue"))}else{if(d&&!wf(d,h,t)){var c=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}(u);return c.splice(u.indexOf(d),1),{value:Sf(e,{separator:o,isSeparateFirst:i,isSeparateOnlyOpenClose:a,isSeparateOpenClose:l,openCloseCharacters:c})}}if(function(e,t){return(""===t||" "==t)&&(""===e||" "==e)||e===t}(n,o)&&!a)return v(),i?(b=t,"break"):(b=t,"continue")}-1===r&&(r=f-1),m.push(h.slice(t,r+1).join("")),b=t=r},x=0;x<f;++x){var C=y(x);if(x=b,"object"===typeof C)return C.value;if("break"===C)break}return m.length&&g.push(m.join("")),g}function Zf(e){return Sf(e,"")}function kf(e){return Sf(e,",")}function Mf(e){var t=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(e);return!t||t.length<4?{}:{prefix:t[1],value:t[2],suffix:t[3]}}function Df(e){var t=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(e);if(!t)return{prefix:"",unit:"",value:NaN};var n=t[1],r=t[2];return{prefix:n,unit:t[3],value:parseFloat(r)}}function Ef(){return Date.now?Date.now():(new Date).getTime()}function Rf(e,t,n){void 0===n&&(n=-1);for(var r=e.length,o=0;o<r;++o)if(t(e[o],o,e))return o;return n}function Tf(e,t,n){var r=Rf(e,t);return r>-1?e[r]:n}var _f=function(){var e=Ef(),t=df&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame);return t?t.bind(window):function(t){var n=Ef();return setTimeout((function(){t(n-e)}),1e3/60)}}(),If=function(){var e=df&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame);return e?e.bind(window):function(e){clearTimeout(e)}}();function Of(e){return Object.keys(e)}function Pf(e,t){var n=Df(e),r=n.value,o=n.unit;if(mf(t)){var i=t[o];if(i){if(xf(i))return i(r);if(hf[o])return hf[o](r,i)}}else if("%"===o)return r*t/100;return hf[o]?hf[o](r):r}function zf(e,t,n){return Math.max(t,Math.min(e,n))}function Ff(e,t,n,r){return void 0===r&&(r=e[0]/e[1]),[[jf(t[0],pf),jf(t[0]/r,pf)],[jf(t[1]*r,pf),jf(t[1],pf)]].filter((function(e){return e.every((function(e,r){var o=t[r],i=jf(o,pf);return n?e<=o||e<=i:e>=o||e>=i}))}))[0]||e}function Nf(e,t,n,r){if(!r)return e.map((function(e,r){return zf(e,t[r],n[r])}));var o=e[0],i=e[1],a=!0===r?o/i:r,s=Ff(e,t,!1,a),l=s[0],d=s[1],u=Ff(e,n,!0,a),c=u[0],p=u[1];return o<l||i<d?(o=l,i=d):(o>c||i>p)&&(o=c,i=p),[o,i]}function $f(e){for(var t=e.length,n=0,r=t-1;r>=0;--r)n+=e[r];return t?n/t:0}function Lf(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=Math.atan2(r,n);return o>=0?o:o+2*Math.PI}function Bf(e){var t=function(e){return[0,1].map((function(t){return $f(e.map((function(e){return e[t]})))}))}(e),n=Lf(t,e[0]),r=Lf(t,e[1]);return n<r&&r-n<Math.PI||n>r&&r-n<-Math.PI?1:-1}function Af(e,t){return Math.sqrt(Math.pow((t?t[0]:0)-e[0],2)+Math.pow((t?t[1]:0)-e[1],2))}function jf(e,t){if(!t)return e;var n=1/t;return Math.round(e/t)/n}function Hf(e,t){return e.forEach((function(n,r){e[r]=jf(e[r],t)})),e}function qf(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function Uf(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function Vf(e,t){if(e.classList)e.classList.remove(t);else{var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}function Wf(e,t,n,r){e.addEventListener(t,n,r)}function Gf(e,t,n,r){e.removeEventListener(t,n,r)}function Kf(e){return(null===e||void 0===e?void 0:e.ownerDocument)||uf}function Yf(e){return Kf(e).documentElement}function Xf(e){return Kf(e).body}function Qf(e){var t;return(null===(t=null===e||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||window}function Jf(e){return e&&"postMessage"in e&&"blur"in e&&"self"in e}function eg(e){return mf(e)&&e.nodeName&&e.nodeType&&"ownerDocument"in e}function tg(e,t,n,r,o,i){for(var a=0;a<o;++a){var s=n+a*o,l=r+a*o;e[s]+=e[l]*i,t[s]+=t[l]*i}}function ng(e,t,n,r,o){for(var i=0;i<o;++i){var a=n+i*o,s=r+i*o,l=e[a],d=t[a];e[a]=e[s],e[s]=l,t[a]=t[s],t[s]=d}}function rg(e,t,n,r,o){for(var i=0;i<r;++i){var a=n+i*r;e[a]/=o,t[a]/=o}}function og(e,t,n){void 0===n&&(n=Math.sqrt(e.length));for(var r=e.slice(),o=0;o<n;++o)r[o*n+t-1]=0,r[(t-1)*n+o]=0;return r[(t-1)*(n+1)]=1,r}function ig(e,t){void 0===t&&(t=Math.sqrt(e.length));for(var n=e.slice(),r=Sg(t),o=0;o<t;++o){var i=t*o+o;if(!jf(n[i],pf))for(var a=o+1;a<t;++a)if(n[t*o+a]){ng(n,r,o,a,t);break}if(!jf(n[i],pf))return[];rg(n,r,o,t,n[i]);for(a=0;a<t;++a){var s=a,l=n[a+o*t];jf(l,pf)&&o!==a&&tg(n,r,s,o,t,-l)}}return r}function ag(e,t){void 0===t&&(t=Math.sqrt(e.length));for(var n=[],r=e[t*t-1],o=0;o<t-1;++o)n[o]=e[t*(t-1)+o]/r;return n[t-1]=0,n}function sg(e,t){for(var n=e.slice(),r=e.length;r<t-1;++r)n[r]=0;return n[t-1]=1,n}function lg(e,t,n){if(void 0===t&&(t=Math.sqrt(e.length)),t===n)return e;for(var r=Sg(n),o=Math.min(t,n),i=0;i<o-1;++i){for(var a=0;a<o-1;++a)r[i*n+a]=e[i*t+a];r[(i+1)*n-1]=e[(i+1)*t-1],r[(n-1)*n+i]=e[(t-1)*t+i]}return r[n*n-1]=e[t*t-1],r}function dg(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Sg(e);return t.forEach((function(t){r=ug(r,t,e)})),r}function ug(e,t,n){void 0===n&&(n=Math.sqrt(e.length));var r=[],o=e.length/n,i=t.length/o;if(!o)return t;if(!i)return e;for(var a=0;a<n;++a)for(var s=0;s<i;++s){r[s*n+a]=0;for(var l=0;l<o;++l)r[s*n+a]+=e[l*n+a]*t[s*o+l]}return r}function cg(e,t){for(var n=Math.min(e.length,t.length),r=e.slice(),o=0;o<n;++o)r[o]=r[o]+t[o];return r}function pg(e,t){for(var n=Math.min(e.length,t.length),r=e.slice(),o=0;o<n;++o)r[o]=r[o]-t[o];return r}function hg(e,t){return void 0===t&&(t=9===e.length),t?[e[0],e[1],e[3],e[4],e[6],e[7]]:e}function fg(e,t,n){void 0===n&&(n=t.length);var r=ug(e,t,n),o=r[n-1];return r.map((function(e){return e/o}))}function gg(e,t){return ug(e,[1,0,0,0,0,Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1],4)}function mg(e,t){return ug(e,[Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1],4)}function vg(e,t){return ug(e,wg(t,4))}function bg(e,t){var n=t[0],r=void 0===n?1:n,o=t[1],i=void 0===o?1:o,a=t[2];return ug(e,[r,0,0,0,0,i,0,0,0,0,void 0===a?1:a,0,0,0,0,1],4)}function yg(e,t){return fg(wg(t,3),sg(e,3))}function xg(e,t){var n=t[0],r=void 0===n?0:n,o=t[1],i=void 0===o?0:o,a=t[2];return ug(e,[1,0,0,0,0,1,0,0,0,0,1,0,r,i,void 0===a?0:a,1],4)}function Cg(e,t){return ug(e,t,4)}function wg(e,t){var n=Math.cos(e),r=Math.sin(e),o=Sg(t);return o[0]=n,o[1]=r,o[t]=-r,o[t+1]=n,o}function Sg(e){for(var t=e*e,n=[],r=0;r<t;++r)n[r]=r%(e+1)?0:1;return n}function Zg(e,t){for(var n=Sg(t),r=Math.min(e.length,t-1),o=0;o<r;++o)n[(t+1)*o]=e[o];return n}function kg(e,t){for(var n=Sg(t),r=Math.min(e.length,t-1),o=0;o<r;++o)n[t*(t-1)+o]=e[o];return n}function Mg(e,t,n,r,o,i,a,s){var l=e[0],d=e[1],u=t[0],c=t[1],p=n[0],h=n[1],f=r[0],g=r[1],m=o[0],v=o[1],b=i[0],y=i[1],x=a[0],C=a[1],w=s[0],S=s[1],Z=ig([l,0,u,0,p,0,f,0,d,0,c,0,h,0,g,0,1,0,1,0,1,0,1,0,0,l,0,u,0,p,0,f,0,d,0,c,0,h,0,g,0,1,0,1,0,1,0,1,-m*l,-v*l,-b*u,-y*u,-x*p,-C*p,-w*f,-S*f,-m*d,-v*d,-b*c,-y*c,-x*h,-C*h,-w*g,-S*g],8);if(!Z.length)return[];var k=ug(Z,[m,v,b,y,x,C,w,S],8);return k[8]=1,lg(function(e,t){void 0===t&&(t=Math.sqrt(e.length));for(var n=[],r=0;r<t;++r)for(var o=0;o<t;++o)n[o*t+r]=e[t*r+o];return n}(k),3,4)}var Dg=function(){return Dg=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Dg.apply(this,arguments)};function Eg(e,t){return void 0===t&&(t=0),Rg(Tg(e,t))}function Rg(e){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e.forEach((function(e){var n=e.matrixFunction,r=e.functionValue;n&&(t=n(t,r))})),t}function Tg(e,t){return void 0===t&&(t=0),(vf(e)?e:Zf(e)).map((function(e){var n=Mf(e),r=n.prefix,o=n.value,i=null,a=r,s="";if("translate"===r||"translateX"===r||"translate3d"===r){var l=mf(t)?Dg(Dg({},t),{"o%":t["%"]}):{"%":t,"o%":t},d=kf(o).map((function(e,n){return l["%"]=0===n&&"x%"in l?t["x%"]:1===n&&"y%"in l?t["y%"]:t["o%"],Pf(e,l)})),u=d[0],c=d[1],p=void 0===c?0:c,h=d[2];i=xg,s=[u,p,void 0===h?0:h]}else if("translateY"===r){i=xg,s=[0,p=Pf(o,mf(t)?Dg({"%":t["y%"]},t):{"%":t}),0]}else if("translateZ"===r){i=xg,s=[0,0,parseFloat(o)]}else if("scale"===r||"scale3d"===r){var f=kf(o).map((function(e){return parseFloat(e)})),g=f[0],m=f[1],v=void 0===m?g:m,b=f[2];i=bg,s=[g,v,void 0===b?1:b]}else if("scaleX"===r){i=bg,s=[g=parseFloat(o),1,1]}else if("scaleY"===r){i=bg,s=[1,v=parseFloat(o),1]}else if("scaleZ"===r){i=bg,s=[1,1,parseFloat(o)]}else if("rotate"===r||"rotateZ"===r||"rotateX"===r||"rotateY"===r){var y=Df(o),x=y.unit,C=y.value;"rotate"===r||"rotateZ"===r?(a="rotateZ",i=vg):"rotateX"===r?i=gg:"rotateY"===r&&(i=mg),s="rad"===x?C:C*Math.PI/180}else if("matrix3d"===r)i=Cg,s=kf(o).map((function(e){return parseFloat(e)}));else if("matrix"===r){var w=kf(o).map((function(e){return parseFloat(e)}));i=Cg,s=[w[0],w[1],0,0,w[2],w[3],0,0,0,0,1,0,w[4],w[5],0,1]}else a="";return{name:r,functionName:a,value:o,matrixFunction:i,functionValue:s}}))}var _g=function(){function e(){this.keys=[],this.values=[]}var t=e.prototype;return t.get=function(e){return this.values[this.keys.indexOf(e)]},t.set=function(e,t){var n=this.keys,r=this.values,o=n.indexOf(e),i=-1===o?n.length:o;n[i]=e,r[i]=t},e}(),Ig=function(){function e(){this.object={}}var t=e.prototype;return t.get=function(e){return this.object[e]},t.set=function(e,t){this.object[e]=t},e}(),Og="function"===typeof Map,Pg=function(){function e(){}var t=e.prototype;return t.connect=function(e,t){this.prev=e,this.next=t,e&&(e.next=this),t&&(t.prev=this)},t.disconnect=function(){var e=this.prev,t=this.next;e&&(e.next=t),t&&(t.prev=e)},t.getIndex=function(){for(var e=this,t=-1;e;)e=e.prev,++t;return t},e}();var zg=function(){function e(e,t,n,r,o,i,a,s){this.prevList=e,this.list=t,this.added=n,this.removed=r,this.changed=o,this.maintained=i,this.changedBeforeAdded=a,this.fixed=s}var t=e.prototype;return Object.defineProperty(t,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),t.caculateOrdered=function(){var e=function(e,t){var n=[],r=[];return e.forEach((function(e){var t=e[0],o=e[1],i=new Pg;n[t]=i,r[o]=i})),n.forEach((function(e,t){e.connect(n[t-1])})),e.filter((function(e,n){return!t[n]})).map((function(e,t){var o=e[0],i=e[1];if(o===i)return[0,0];var a=n[o],s=r[i-1],l=a.getIndex();return a.disconnect(),s?a.connect(s,s.next):a.connect(void 0,n[0]),[l,a.getIndex()]}))}(this.changedBeforeAdded,this.fixed),t=this.changed,n=[];this.cacheOrdered=e.filter((function(e,r){var o=e[0],i=e[1],a=t[r],s=a[0],l=a[1];if(o!==i)return n.push([s,l]),!0})),this.cachePureChanged=n},e}();function Fg(e,t,n){var r=Og?Map:n?Ig:_g,o=n||function(e){return e},i=[],a=[],s=[],l=e.map(o),d=t.map(o),u=new r,c=new r,p=[],h=[],f={},g=[],m=0,v=0;return l.forEach((function(e,t){u.set(e,t)})),d.forEach((function(e,t){c.set(e,t)})),l.forEach((function(e,t){var n=c.get(e);"undefined"===typeof n?(++v,a.push(t)):f[n]=v})),d.forEach((function(e,t){var n=u.get(e);"undefined"===typeof n?(i.push(t),++m):(s.push([n,t]),v=f[t]||0,p.push([n-v,t-m]),h.push(t===n),n!==t&&g.push([n,t]))})),a.reverse(),new zg(e,t,i,a,g,s,p,h)}var Ng=function(){function e(e,t){void 0===e&&(e=[]),this.findKeyCallback=t,this.list=[].slice.call(e)}return e.prototype.update=function(e){var t=[].slice.call(e),n=Fg(this.list,t,this.findKeyCallback);return this.list=t,n},e}();var $g=function(e,t){return $g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},$g(e,t)};var Lg,Bg="function"===typeof Map?void 0:(Lg=0,function(e){return e.__DIFF_KEY__||(e.__DIFF_KEY__=++Lg)}),Ag=function(e){function t(t){return void 0===t&&(t=[]),e.call(this,t,Bg)||this}return function(e,t){function n(){this.constructor=e}$g(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Ng);const jg=Ag;var Hg=function(){return Hg=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Hg.apply(this,arguments)};var qg=function(){function e(){this._events={}}var t=e.prototype;return t.on=function(e,t){if(mf(e))for(var n in e)this.on(n,e[n]);else this._addEvent(e,t,{});return this},t.off=function(e,t){if(e)if(mf(e))for(var n in e)this.off(n);else if(t){var r=this._events[e];if(r){var o=Rf(r,(function(e){return e.listener===t}));o>-1&&r.splice(o,1)}}else this._events[e]=[];else this._events={};return this},t.once=function(e,t){var n=this;return t&&this._addEvent(e,t,{once:!0}),new Promise((function(t){n._addEvent(e,t,{once:!0})}))},t.emit=function(e,t){var n=this;void 0===t&&(t={});var r=this._events[e];if(!e||!r)return!0;var o=!1;return t.eventType=e,t.stop=function(){o=!0},t.currentTarget=this,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}(r).forEach((function(r){r.listener(t),r.once&&n.off(e,r.listener)})),!o},t.trigger=function(e,t){return void 0===t&&(t={}),this.emit(e,t)},t._addEvent=function(e,t,n){var r=this._events;r[e]=r[e]||[],r[e].push(Hg({listener:t},n))},e}();const Ug=qg;var Vg=function(e,t){return Vg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Vg(e,t)};var Wg=function(){return Wg=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Wg.apply(this,arguments)};function Gg(e){var t=e.container;return t===document.body?[t.scrollLeft||document.documentElement.scrollLeft,t.scrollTop||document.documentElement.scrollTop]:[t.scrollLeft,t.scrollTop]}function Kg(e,t){return e.addEventListener("scroll",t),function(){e.removeEventListener("scroll",t)}}function Yg(e){return e?bf(e)?document.querySelector(e):xf(e)?e():e instanceof Element?e:"current"in e?e.current:"value"in e?e.value:void 0:null}var Xg=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._startRect=null,t._startPos=[],t._prevTime=0,t._timer=0,t._prevScrollPos=[0,0],t._isWait=!1,t._flag=!1,t._currentOptions=null,t._lock=!1,t._unregister=null,t._onScroll=function(){var e=t._currentOptions;!t._lock&&e&&t.emit("scrollDrag",{next:function(n){t.checkScroll({container:e.container,inputEvent:n})}})},t}!function(e,t){function n(){this.constructor=e}Vg(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e);var n=t.prototype;return n.dragStart=function(e,t){var n=Yg(t.container);if(n){var r=0,o=0,i=0,a=0;if(n===document.body)i=window.innerWidth,a=window.innerHeight;else{var s=n.getBoundingClientRect();r=s.top,o=s.left,i=s.width,a=s.height}this._flag=!0,this._startPos=[e.clientX,e.clientY],this._startRect={top:r,left:o,width:i,height:a},this._prevScrollPos=this._getScrollPosition([0,0],t),this._currentOptions=t,this._registerScrollEvent(t)}else this._flag=!1},n.drag=function(e,t){if(clearTimeout(this._timer),this._flag){var n=e.clientX,r=e.clientY,o=t.threshold,i=void 0===o?0:o,a=this._startRect,s=this._startPos;this._currentOptions=t;var l=[0,0];return a.top>r-i?(s[1]>a.top||r<s[1])&&(l[1]=-1):a.top+a.height<r+i&&(s[1]<a.top+a.height||r>s[1])&&(l[1]=1),a.left>n-i?(s[0]>a.left||n<s[0])&&(l[0]=-1):a.left+a.width<n+i&&(s[0]<a.left+a.width||n>s[0])&&(l[0]=1),!(!l[0]&&!l[1])&&this._continueDrag(Wg(Wg({},t),{direction:l,inputEvent:e,isDrag:!0}))}},n.checkScroll=function(e){var t=this;if(this._isWait)return!1;var n=e.prevScrollPos,r=void 0===n?this._prevScrollPos:n,o=e.direction,i=e.throttleTime,a=void 0===i?0:i,s=e.inputEvent,l=e.isDrag,d=this._getScrollPosition(o||[0,0],e),u=d[0]-r[0],c=d[1]-r[1],p=o||[u?Math.abs(u)/u:0,c?Math.abs(c)/c:0];return this._prevScrollPos=d,this._lock=!1,!(!u&&!c)&&(this.emit("move",{offsetX:p[0]?u:0,offsetY:p[1]?c:0,inputEvent:s}),a&&l&&(clearTimeout(this._timer),this._timer=window.setTimeout((function(){t._continueDrag(e)}),a)),!0)},n.dragEnd=function(){this._flag=!1,this._lock=!1,clearTimeout(this._timer),this._unregisterScrollEvent()},n._getScrollPosition=function(e,t){var n=t.container,r=t.getScrollPosition;return(void 0===r?Gg:r)({container:Yg(n),direction:e})},n._continueDrag=function(e){var t,n=this,r=e.container,o=e.direction,i=e.throttleTime,a=e.useScroll,s=e.isDrag,l=e.inputEvent;if(!(!this._flag||s&&this._isWait)){var d=Ef(),u=Math.max(i+this._prevTime-d,0);if(u>0)return clearTimeout(this._timer),this._timer=window.setTimeout((function(){n._continueDrag(e)}),u),!1;this._prevTime=d;var c=this._getScrollPosition(o,e);this._prevScrollPos=c,s&&(this._isWait=!0),a||(this._lock=!0);var p={container:Yg(r),direction:o,inputEvent:l};return null===(t=e.requestScroll)||void 0===t||t.call(e,p),this.emit("scroll",p),this._isWait=!1,a||this.checkScroll(Wg(Wg({},e),{prevScrollPos:c,direction:o,inputEvent:l}))}},n._registerScrollEvent=function(e){this._unregisterScrollEvent();var t=e.checkScrollEvent;if(t){var n=!0===t?Kg:t,r=Yg(e.container);!0!==t||r!==document.body&&r!==document.documentElement?this._unregister=n(r,this._onScroll):this._unregister=Kg(window,this._onScroll)}},n._unregisterScrollEvent=function(){var e;null===(e=this._unregister)||void 0===e||e.call(this),this._unregister=null},t}(Ug);const Qg=Xg;function Jg(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}function em(e){return jf(e,pf)}function tm(e){return e.length<3?0:Math.abs(function(e){for(var t=0,n=e.length-1;n>=0;--n)t+=e[n];return t}(e.map((function(t,n){var r=e[n+1]||e[0];return t[0]*r[1]-r[0]*t[1]}))))/2}function nm(e,t){var n=t.width,r=t.height,o=t.left,i=t.top,a=rm(e),s=a.minX,l=a.minY,d=a.maxX,u=a.maxY,c=n/(d-s),p=r/(u-l);return e.map((function(e){return[o+(e[0]-s)*c,i+(e[1]-l)*p]}))}function rm(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));return{minX:Math.min.apply(Math,t),minY:Math.min.apply(Math,n),maxX:Math.max.apply(Math,t),maxY:Math.max.apply(Math,n)}}function om(e,t,n){var r=e[0],o=e[1],i=rm(t),a=i.minX,s=i.maxX,l=[[a,o],[s,o]],d=im(l[0],l[1]),u=lm(t),c=[];if(u.forEach((function(t){var n,r=im(t[0],t[1]),i=t[0];(n=r,d.every((function(e,t){return 0===em(e-n[t])})))?c.push({pos:e,line:t,type:"line"}):sm(am(d,r),[l,t]).forEach((function(e){t.some((function(t){return r=e,!em((n=t)[0]-r[0])&&!em(n[1]-r[1]);var n,r}))?c.push({pos:e,line:t,type:"point"}):0!==em(i[1]-o)&&c.push({pos:e,line:t,type:"intersection"})}))})),!n&&Tf(c,(function(e){return e[0]===r})))return!0;var p=0,h={};return c.forEach((function(e){var t=e.pos,n=e.type,i=e.line;if(!(t[0]>r))if("intersection"===n)++p;else{if("line"===n)return;if("point"===n){var a=Tf(i,(function(e){return e[1]!==o})),s=h[t[0]],l=a[1]>o?1:-1;s?s!==l&&++p:h[t[0]]=l}}})),p%2===1}function im(e,t){var n=e[0],r=e[1],o=t[0]-n,i=t[1]-r;Math.abs(o)<pf&&(o=0),Math.abs(i)<pf&&(i=0);var a=0,s=0,l=0;return o?i?(s=1,l=-(a=-i/o)*n-r):(s=1,l=-r):i&&(a=-1,l=n),[a,s,l]}function am(e,t){var n=e[0],r=e[1],o=e[2],i=t[0],a=t[1],s=t[2],l=0===n&&0===i,d=0===r&&0===a,u=[];if(l&&d)return[];if(l){var c=-o/r;return c!==-s/a?[]:[[-1/0,c],[1/0,c]]}if(d){var p=-o/n;return p!==-s/i?[]:[[p,-1/0],[p,1/0]]}if(0===n)u=[[h=-(a*(f=-o/r)+s)/i,f]];else if(0===i){u=[[h=-(r*(f=-s/a)+o)/n,f]]}else if(0===r){u=[[h=-o/n,f=-(i*h+s)/a]]}else if(0===a){u=[[h=-s/i,f=-(n*h+o)/r]]}else{var h,f;u=[[h=(r*s-a*o)/(a*n-r*i),f=-(n*h+o)/r]]}return u.map((function(e){return[e[0],e[1]]}))}function sm(e,t){var n=t.map((function(e){return[0,1].map((function(t){return[Math.min(e[0][t],e[1][t]),Math.max(e[0][t],e[1][t])]}))})),r=[];if(2===e.length){var o=e[0],i=o[0],a=o[1];if(em(i-e[1][0])){if(!em(a-e[1][1])){var s=Math.max.apply(Math,n.map((function(e){return e[0][0]}))),l=Math.min.apply(Math,n.map((function(e){return e[0][1]})));if(em(s-l)>0)return[];r=[[s,a],[l,a]]}}else{var d=Math.max.apply(Math,n.map((function(e){return e[1][0]}))),u=Math.min.apply(Math,n.map((function(e){return e[1][1]})));if(em(d-u)>0)return[];r=[[i,d],[i,u]]}}return r.length||(r=e.filter((function(e){var t=e[0],r=e[1];return n.every((function(e){return 0<=em(t-e[0][0])&&0<=em(e[0][1]-t)&&0<=em(r-e[1][0])&&0<=em(e[1][1]-r)}))}))),r.map((function(e){return[em(e[0]),em(e[1])]}))}function lm(e){return Jg(e.slice(1),[e[0]]).map((function(t,n){return[e[n],t]}))}function dm(e,t){var n=e.slice(),r=t.slice();-1===Bf(n)&&n.reverse(),-1===Bf(r)&&r.reverse();var o=lm(n),i=lm(r),a=o.map((function(e){return im(e[0],e[1])})),s=i.map((function(e){return im(e[0],e[1])})),l=[];a.forEach((function(e,t){var n=o[t],a=[];s.forEach((function(r,o){var s=sm(am(e,r),[n,i[o]]);a.push.apply(a,s.map((function(e){return{index1:t,index2:o,pos:e,type:"intersection"}})))})),a.sort((function(e,t){return Af(n[0],e.pos)-Af(n[0],t.pos)})),l.push.apply(l,a),om(n[1],r)&&l.push({index1:t,index2:-1,pos:n[1],type:"inside"})})),i.forEach((function(e,t){if(om(e[1],n)){var r=!1,o=Rf(l,(function(e){return e.index2===t?(r=!0,!1):!!r}));-1===o&&(r=!1,o=Rf(l,(function(e){var n=e.index1,o=e.index2;return-1===n&&o+1===t?(r=!0,!1):!!r}))),-1===o?l.push({index1:-1,index2:t,pos:e[1],type:"inside"}):l.splice(o,0,{index1:-1,index2:t,pos:e[1],type:"inside"})}}));var d={};return l.filter((function(e){var t=e.pos,n=t[0]+"x"+t[1];return!d[n]&&(d[n]=!0,!0)}))}function um(e,t){var n=function(e,t){return dm(e,t).map((function(e){return e.pos}))}(e,t);return tm(n)}var cm=function(e,t){return cm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},cm(e,t)};var pm=function(){return pm=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},pm.apply(this,arguments)};function hm(e){return 180*(t=[e[0].clientX,e[0].clientY],n=[e[1].clientX,e[1].clientY],r=n[0]-t[0],o=n[1]-t[1],((i=Math.atan2(o,r))>=0?i:i+2*Math.PI)/Math.PI);var t,n,r,o,i}function fm(e){return e?e.touches?function(e){for(var t=Math.min(e.length,2),n=[],r=0;r<t;++r)n.push(vm(e[r]));return n}(e.touches):[vm(e)]:[]}function gm(e,t,n){var r=n.length,o=bm(e,r),i=o.clientX,a=o.clientY,s=o.originalClientX,l=o.originalClientY,d=bm(t,r),u=d.clientX,c=d.clientY,p=bm(n,r);return{clientX:s,clientY:l,deltaX:i-u,deltaY:a-c,distX:i-p.clientX,distY:a-p.clientY}}function mm(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}function vm(e){return{clientX:e.clientX,clientY:e.clientY}}function bm(e,t){void 0===t&&(t=e.length);for(var n={clientX:0,clientY:0,originalClientX:0,originalClientY:0},r=0;r<t;++r){var o=e[r];n.originalClientX+="originalClientX"in o?o.originalClientX:o.clientX,n.originalClientY+="originalClientY"in o?o.originalClientY:o.clientY,n.clientX+=o.clientX,n.clientY+=o.clientY}return t?{clientX:n.clientX/t,clientY:n.clientY/t,originalClientX:n.originalClientX/t,originalClientY:n.originalClientY/t}:n}var ym=function(){function e(e){this.prevClients=[],this.startClients=[],this.movement=0,this.length=0,this.startClients=e,this.prevClients=e,this.length=e.length}return e.prototype.getAngle=function(e){return void 0===e&&(e=this.prevClients),hm(e)},e.prototype.getRotation=function(e){return void 0===e&&(e=this.prevClients),hm(e)-hm(this.startClients)},e.prototype.getPosition=function(e,t){void 0===e&&(e=this.prevClients);var n=gm(e||this.prevClients,this.prevClients,this.startClients),r=n.deltaX,o=n.deltaY;return this.movement+=Math.sqrt(r*r+o*o),this.prevClients=e,n},e.prototype.getPositions=function(e){void 0===e&&(e=this.prevClients);var t=this.prevClients;return this.startClients.map((function(n,r){return gm([e[r]],[t[r]],[n])}))},e.prototype.getMovement=function(e){var t=this.movement;if(!e)return t;var n=bm(e,this.length),r=bm(this.prevClients,this.length),o=n.clientX-r.clientX,i=n.clientY-r.clientY;return Math.sqrt(o*o+i*i)+t},e.prototype.getDistance=function(e){return void 0===e&&(e=this.prevClients),mm(e)},e.prototype.getScale=function(e){return void 0===e&&(e=this.prevClients),mm(e)/mm(this.startClients)},e.prototype.move=function(e,t){this.startClients.forEach((function(n){n.clientX-=e,n.clientY-=t})),this.prevClients.forEach((function(n){n.clientX-=e,n.clientY-=t}))},e}(),xm=["textarea","input"],Cm=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;r.options={},r.flag=!1,r.pinchFlag=!1,r.data={},r.isDrag=!1,r.isPinch=!1,r.clientStores=[],r.targets=[],r.prevTime=0,r.doubleFlag=!1,r._useMouse=!1,r._useTouch=!1,r._useDrag=!1,r._dragFlag=!1,r._isTrusted=!1,r._isMouseEvent=!1,r._isSecondaryButton=!1,r._preventMouseEvent=!1,r._prevInputEvent=null,r._isDragAPI=!1,r._isIdle=!0,r._window=window,r.onDragStart=function(e,t){if(void 0===t&&(t=!0),r.flag||!1!==e.cancelable){var n=e.type.indexOf("drag")>=-1;if(!r.flag||!n){r._isDragAPI=!0;var o=r.options,i=o.container,a=o.pinchOutside,s=o.preventWheelClick,l=o.preventRightClick,d=o.preventDefault,u=o.checkInput,c=o.dragFocusedInput,p=o.preventClickEventOnDragStart,h=o.preventClickEventOnDrag,f=o.preventClickEventByCondition,g=r._useTouch,m=!r.flag;if(r._isSecondaryButton=3===e.which||2===e.button,s&&(2===e.which||1===e.button)||l&&(3===e.which||2===e.button))return r.stop(),!1;if(m){var v=r._window.document.activeElement,b=e.target;if(b){var y=b.tagName.toLowerCase(),x=xm.indexOf(y)>-1,C=b.isContentEditable;if(x||C){if(u||!c&&v===b)return!1;if(v&&(v===b||C&&v.isContentEditable&&v.contains(b))){if(!c)return!1;b.blur()}}else if((d||"touchstart"===e.type)&&v){var w=v.tagName.toLowerCase();(v.isContentEditable||xm.indexOf(w)>-1)&&v.blur()}(p||h||f)&&Wf(r._window,"click",r._onClick,!0)}r.clientStores=[new ym(fm(e))],r._isIdle=!1,r.flag=!0,r.isDrag=!1,r._isTrusted=t,r._dragFlag=!0,r._prevInputEvent=e,r.data={},r.doubleFlag=Ef()-r.prevTime<200,r._isMouseEvent=function(e){return e&&(e.type.indexOf("mouse")>-1||"button"in e)}(e),!r._isMouseEvent&&r._preventMouseEvent&&(r._preventMouseEvent=!1),!1===(r._preventMouseEvent||r.emit("dragStart",pm(pm({data:r.data,datas:r.data,inputEvent:e,isMouseEvent:r._isMouseEvent,isSecondaryButton:r._isSecondaryButton,isTrusted:t,isDouble:r.doubleFlag},r.getCurrentStore().getPosition()),{preventDefault:function(){e.preventDefault()},preventDrag:function(){r._dragFlag=!1}})))&&r.stop(),r._isMouseEvent&&r.flag&&d&&e.preventDefault()}if(!r.flag)return!1;var S=0;if(m?(r._attchDragEvent(),g&&a&&(S=setTimeout((function(){Wf(i,"touchstart",r.onDragStart,{passive:!1})})))):g&&a&&Gf(i,"touchstart",r.onDragStart),r.flag&&function(e){return e.touches&&e.touches.length>=2}(e)){if(clearTimeout(S),m&&e.touches.length!==e.changedTouches.length)return;r.pinchFlag||r.onPinchStart(e)}}}},r.onDrag=function(e,t){if(r.flag){var n=r.options.preventDefault;!r._isMouseEvent&&n&&e.preventDefault(),r._prevInputEvent=e;var o=fm(e),i=r.moveClients(o,e,!1);if(r._dragFlag){if(r.pinchFlag||i.deltaX||i.deltaY)if(!1===(r._preventMouseEvent||r.emit("drag",pm(pm({},i),{isScroll:!!t,inputEvent:e}))))return void r.stop();r.pinchFlag&&r.onPinch(e,o)}r.getCurrentStore().getPosition(o,!0)}},r.onDragEnd=function(e){if(r.flag){var t=r.options,n=t.pinchOutside,o=t.container,i=t.preventClickEventOnDrag,a=t.preventClickEventOnDragStart,s=t.preventClickEventByCondition,l=r.isDrag;(i||a||s)&&requestAnimationFrame((function(){r._allowClickEvent()})),s||a||!i||l||r._allowClickEvent(),r._useTouch&&n&&Gf(o,"touchstart",r.onDragStart),r.pinchFlag&&r.onPinchEnd(e);var d=(null===e||void 0===e?void 0:e.touches)?fm(e):[];0!==d.length&&r.options.keepDragging?r._addStore(new ym(d)):r.flag=!1;var u=r._getPosition(),c=Ef(),p=!l&&r.doubleFlag;r._prevInputEvent=null,r.prevTime=l||p?0:c,r.flag||(r._dettachDragEvent(),r._preventMouseEvent||r.emit("dragEnd",pm({data:r.data,datas:r.data,isDouble:p,isDrag:l,isClick:!l,isMouseEvent:r._isMouseEvent,isSecondaryButton:r._isSecondaryButton,inputEvent:e,isTrusted:r._isTrusted},u)),r.clientStores=[],r._isMouseEvent||(r._preventMouseEvent=!0,requestAnimationFrame((function(){requestAnimationFrame((function(){r._preventMouseEvent=!1}))}))),r._isIdle=!0)}},r.onBlur=function(){r.onDragEnd()},r._allowClickEvent=function(){Gf(r._window,"click",r._onClick,!0)},r._onClick=function(e){r._allowClickEvent(),r._preventMouseEvent=!1;var t=r.options.preventClickEventByCondition;(null===t||void 0===t?void 0:t(e))||(e.stopPropagation(),e.preventDefault())},r._onContextMenu=function(e){r.options.preventRightClick?r.onDragEnd(e):e.preventDefault()},r._passCallback=function(){};var o=[].concat(t),i=o[0];r._window=Jf(i)?i:Qf(i),r.options=pm({checkInput:!1,container:i&&!("document"in i)?Qf(i):i,preventRightClick:!0,preventWheelClick:!0,preventClickEventOnDragStart:!1,preventClickEventOnDrag:!1,preventClickEventByCondition:null,preventDefault:!0,checkWindowBlur:!1,keepDragging:!1,pinchThreshold:0,events:["touch","mouse"]},n);var a=r.options,s=a.container,l=a.events,d=a.checkWindowBlur;if(r._useDrag=l.indexOf("drag")>-1,r._useTouch=l.indexOf("touch")>-1,r._useMouse=l.indexOf("mouse")>-1,r.targets=o,r._useDrag&&o.forEach((function(e){Wf(e,"dragstart",r.onDragStart)})),r._useMouse&&(o.forEach((function(e){Wf(e,"mousedown",r.onDragStart),Wf(e,"mousemove",r._passCallback)})),Wf(s,"contextmenu",r._onContextMenu)),d&&Wf(Qf(),"blur",r.onBlur),r._useTouch){var u={passive:!1};o.forEach((function(e){Wf(e,"touchstart",r.onDragStart,u),Wf(e,"touchmove",r._passCallback,u)}))}return r}return function(e,t){function n(){this.constructor=e}cm(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.stop=function(){this.isDrag=!1,this.data={},this.clientStores=[],this.pinchFlag=!1,this.doubleFlag=!1,this.prevTime=0,this.flag=!1,this._isIdle=!0,this._allowClickEvent(),this._dettachDragEvent(),this._isDragAPI=!1},t.prototype.getMovement=function(e){return this.getCurrentStore().getMovement(e)+this.clientStores.slice(1).reduce((function(e,t){return e+t.movement}),0)},t.prototype.isDragging=function(){return this.isDrag},t.prototype.isIdle=function(){return this._isIdle},t.prototype.isFlag=function(){return this.flag},t.prototype.isPinchFlag=function(){return this.pinchFlag},t.prototype.isDoubleFlag=function(){return this.doubleFlag},t.prototype.isPinching=function(){return this.isPinch},t.prototype.scrollBy=function(e,t,n,r){void 0===r&&(r=!0),this.flag&&(this.clientStores[0].move(e,t),r&&this.onDrag(n,!0))},t.prototype.move=function(e,t){var n=e[0],r=e[1],o=this.getCurrentStore().prevClients;return this.moveClients(o.map((function(e){var t=e.clientX,o=e.clientY;return{clientX:t+n,clientY:o+r,originalClientX:t,originalClientY:o}})),t,!0)},t.prototype.triggerDragStart=function(e){this.onDragStart(e,!1)},t.prototype.setEventData=function(e){var t=this.data;for(var n in e)t[n]=e[n];return this},t.prototype.setEventDatas=function(e){return this.setEventData(e)},t.prototype.getCurrentEvent=function(e){return void 0===e&&(e=this._prevInputEvent),pm(pm({data:this.data,datas:this.data},this._getPosition()),{movement:this.getMovement(),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:e})},t.prototype.getEventData=function(){return this.data},t.prototype.getEventDatas=function(){return this.data},t.prototype.unset=function(){var e=this,t=this.targets,n=this.options.container;this.off(),Gf(this._window,"blur",this.onBlur),this._useDrag&&t.forEach((function(t){Gf(t,"dragstart",e.onDragStart)})),this._useMouse&&(t.forEach((function(t){Gf(t,"mousedown",e.onDragStart)})),Gf(n,"contextmenu",this._onContextMenu)),this._useTouch&&(t.forEach((function(t){Gf(t,"touchstart",e.onDragStart)})),Gf(n,"touchstart",this.onDragStart)),this._prevInputEvent=null,this._allowClickEvent(),this._dettachDragEvent()},t.prototype.onPinchStart=function(e){var t=this,n=this.options.pinchThreshold;if(!(this.isDrag&&this.getMovement()>n)){var r=new ym(fm(e));this.pinchFlag=!0,this._addStore(r),!1===this.emit("pinchStart",pm(pm({data:this.data,datas:this.data,angle:r.getAngle(),touches:this.getCurrentStore().getPositions()},r.getPosition()),{inputEvent:e,isTrusted:this._isTrusted,preventDefault:function(){e.preventDefault()},preventDrag:function(){t._dragFlag=!1}}))&&(this.pinchFlag=!1)}},t.prototype.onPinch=function(e,t){if(this.flag&&this.pinchFlag&&!(t.length<2)){var n=this.getCurrentStore();this.isPinch=!0,this.emit("pinch",pm(pm({data:this.data,datas:this.data,movement:this.getMovement(t),angle:n.getAngle(t),rotation:n.getRotation(t),touches:n.getPositions(t),scale:n.getScale(t),distance:n.getDistance(t)},n.getPosition(t)),{inputEvent:e,isTrusted:this._isTrusted}))}},t.prototype.onPinchEnd=function(e){if(this.pinchFlag){var t=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var n=this.getCurrentStore();this.emit("pinchEnd",pm(pm({data:this.data,datas:this.data,isPinch:t,touches:n.getPositions()},n.getPosition()),{inputEvent:e}))}},t.prototype.getCurrentStore=function(){return this.clientStores[0]},t.prototype.moveClients=function(e,t,n){var r=this._getPosition(e,n),o=this.isDrag;(r.deltaX||r.deltaY)&&(this.isDrag=!0);var i=!1;return!o&&this.isDrag&&(i=!0),pm(pm({data:this.data,datas:this.data},r),{movement:this.getMovement(e),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,isMouseEvent:this._isMouseEvent,isSecondaryButton:this._isSecondaryButton,inputEvent:t,isTrusted:this._isTrusted,isFirstDrag:i})},t.prototype._addStore=function(e){this.clientStores.splice(0,0,e)},t.prototype._getPosition=function(e,t){var n=this.getCurrentStore().getPosition(e,t),r=this.clientStores.slice(1).reduce((function(e,t){var n=t.getPosition();return e.distX+=n.distX,e.distY+=n.distY,e}),n),o=r.distX,i=r.distY;return pm(pm({},n),{distX:o,distY:i})},t.prototype._attchDragEvent=function(){var e=this._window,t=this.options.container,n={passive:!1};this._isDragAPI&&(Wf(t,"dragover",this.onDrag,n),Wf(e,"dragend",this.onDragEnd)),this._useMouse&&(Wf(t,"mousemove",this.onDrag),Wf(e,"mouseup",this.onDragEnd)),this._useTouch&&(Wf(t,"touchmove",this.onDrag,n),Wf(e,"touchend",this.onDragEnd,n),Wf(e,"touchcancel",this.onDragEnd,n))},t.prototype._dettachDragEvent=function(){var e=this._window,t=this.options.container;this._isDragAPI&&(Gf(t,"dragover",this.onDrag),Gf(e,"dragend",this.onDragEnd)),this._useMouse&&(Gf(t,"mousemove",this.onDrag),Gf(e,"mouseup",this.onDragEnd)),this._useTouch&&(Gf(t,"touchstart",this.onDragStart),Gf(t,"touchmove",this.onDrag),Gf(e,"touchend",this.onDragEnd),Gf(e,"touchcancel",this.onDragEnd))},t}(Ug);var wm=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0};function Sm(e,t,n,r,o){var i=Kf(r),a=i.createElement("style");return a.setAttribute("type","text/css"),a.setAttribute("data-styled-id",e),a.setAttribute("data-styled-count","1"),n.nonce&&a.setAttribute("nonce",n.nonce),a.innerHTML=function(e,t,n){return n.original?t:t.replace(/([^};{\s}][^};{]*|^\s*){/gm,(function(t,n){var r=n.trim();return(r?kf(r):[""]).map((function(t){var n=t.trim();return 0===n.indexOf("@")?n:n.indexOf(":global")>-1?n.replace(/\:global/g,""):n.indexOf(":host")>-1?"".concat(n.replace(/\:host/g,".".concat(e))):n?".".concat(e," ").concat(n):".".concat(e)})).join(", ")+" {"}))}(e,t,n),(o||i.head||i.body).appendChild(a),a}const Zm=function(e){var t="rCS"+wm(e).toString(36);return{className:t,inject:function(n,r){void 0===r&&(r={});var o=function(e){if(e&&e.getRootNode){var t=e.getRootNode();if(11===t.nodeType)return t}}(n),i=(o||n.ownerDocument||document).querySelector('style[data-styled-id="'.concat(t,'"]'));if(i){var a=parseFloat(i.getAttribute("data-styled-count"))||0;i.setAttribute("data-styled-count","".concat(a+1))}else i=Sm(t,e,r,n,o);return{destroy:function(){var e,t=parseFloat(i.getAttribute("data-styled-count"))||0;t<=1?(i.remove?i.remove():null===(e=i.parentNode)||void 0===e||e.removeChild(i),i=null):i.setAttribute("data-styled-count","".concat(t-1))}}}}};var km=function(e,t){return km=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},km(e,t)};function Mm(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}km(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Dm=function(){return Dm=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Dm.apply(this,arguments)};function Em(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}a.Component;function Rm(e,t){var n=Zm(t),r=n.className;return(0,a.forwardRef)((function(t,o){var i=t.className,s=void 0===i?"":i,l=(t.cspNonce,Em(t,["className","cspNonce"])),d=(0,a.useRef)();return(0,a.useImperativeHandle)(o,(function(){return d.current}),[]),(0,a.useEffect)((function(){var e=n.inject(d.current,{nonce:t.cspNonce});return function(){e.destroy()}}),[]),(0,a.createElement)(e,Dm({ref:d,"data-styled-id":r,className:"".concat(s," ").concat(r)},l))}))}var Tm=function(e,t){return Tm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Tm(e,t)};function _m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Tm(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Im=function(){return Im=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Im.apply(this,arguments)};function Om(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function Pm(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function zm(e,t){return Im({events:[],props:[],name:e},t)}var Fm=["n","w","s","e"],Nm=["n","w","s","e","nw","ne","sw","se"];var $m,Lm,Bm=Jh(),Am=Bm.browser.webkit,jm=Am&&($m="undefined"===typeof window?{userAgent:""}:window.navigator,!!(Lm=/applewebkit\/([^\s]+)/g.exec($m.userAgent.toLowerCase()))&&parseFloat(Lm[1])<605),Hm=Bm.browser.name,qm=parseInt(Bm.browser.version,10),Um="chrome"===Hm,Vm=Bm.browser.chromium,Wm=parseInt(Bm.browser.chromiumVersion,10)||0,Gm=Um&&qm>=109||Vm&&Wm>=109,Km="firefox"===Hm,Ym=parseInt(Bm.browser.webkitVersion,10)>=612||qm>=15,Xm="moveable-",Qm=Nm.map((function(e){var t="",n="",r="center",o="center",i="calc(var(--moveable-control-padding, 20) * -1px)";return e.indexOf("n")>-1&&(t="top: ".concat(i,";"),o="bottom"),e.indexOf("s")>-1&&(t="top: 0px;",o="top"),e.indexOf("w")>-1&&(n="left: ".concat(i,";"),r="right"),e.indexOf("e")>-1&&(n="left: 0px;",r="left"),'.around-control[data-direction*="'.concat(e,'"] {\n        ').concat(n).concat(t,"\n        transform-origin: ").concat(r," ").concat(o,";\n    }")})).join("\n"),Jm="\n{\nposition: absolute;\nwidth: 1px;\nheight: 1px;\nleft: 0;\ntop: 0;\nz-index: 3000;\n--moveable-color: #4af;\n--zoom: 1;\n--zoompx: 1px;\n--moveable-line-padding: 0;\n--moveable-control-padding: 0;\nwill-change: transform;\noutline: 1px solid transparent;\n}\n.control-box {\nz-index: 0;\n}\n.line, .control {\nposition: absolute;\nleft: 0;\ntop: 0;\nwill-change: transform;\n}\n.control {\nwidth: 14px;\nheight: 14px;\nborder-radius: 50%;\nborder: 2px solid #fff;\nbox-sizing: border-box;\nbackground: #4af;\nbackground: var(--moveable-color);\nmargin-top: -7px;\nmargin-left: -7px;\nborder: 2px solid #fff;\nz-index: 10;\n}\n.around-control {\nposition: absolute;\nwill-change: transform;\nwidth: calc(var(--moveable-control-padding, 20) * 1px);\nheight: calc(var(--moveable-control-padding, 20) * 1px);\nleft: calc(var(--moveable-control-padding, 20) * -0.5px);\ntop: calc(var(--moveable-control-padding, 20) * -0.5px);\nbox-sizing: border-box;\nbackground: transparent;\nz-index: 8;\ncursor: alias;\ntransform-origin: center center;\n}\n".concat(Qm,"\n.padding {\nposition: absolute;\ntop: 0px;\nleft: 0px;\nwidth: 100px;\nheight: 100px;\ntransform-origin: 0 0;\n}\n.line {\nwidth: 1px;\nheight: 1px;\nbackground: #4af;\nbackground: var(--moveable-color);\ntransform-origin: 0px 50%;\n}\n.line.edge {\nz-index: 1;\nbackground: transparent;\n}\n.line.dashed {\nbox-sizing: border-box;\nbackground: transparent;\n}\n.line.dashed.horizontal {\nborder-top: 1px dashed #4af;\nborder-top-color: #4af;\nborder-top-color: var(--moveable-color);\n}\n.line.dashed.vertical {\nborder-left: 1px dashed #4af;\nborder-left-color: #4af;\nborder-left-color: var(--moveable-color);\n}\n.line.vertical {\ntransform: translateX(-50%);\n}\n.line.horizontal {\ntransform: translateY(-50%);\n}\n.line.vertical.bold {\nwidth: 2px;\n}\n.line.horizontal.bold {\nheight: 2px;\n}\n\n.control.origin {\nborder-color: #f55;\nbackground: #fff;\nwidth: 12px;\nheight: 12px;\nmargin-top: -6px;\nmargin-left: -6px;\npointer-events: none;\n}\n").concat([0,15,30,45,60,75,90,105,120,135,150,165].map((function(e){return'\n.direction[data-rotation="'.concat(e,'"], :global .view-control-rotation').concat(e," {\n").concat(function(e){var t=function(e,t){return'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(32*e,'px" height="').concat(32*e,'px" viewBox="0 0 32 32" ><path d="M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z" stroke-linejoin="round" stroke-width="1.2" fill="black" stroke="white" style="transform:rotate(').concat(t,'deg);transform-origin: 16px 16px"></path></svg>')}(1,e),n=45*Math.round(e/45)%180,r="ns-resize";return 135===n?r="nwse-resize":45===n?r="nesw-resize":90===n&&(r="ew-resize"),"cursor:".concat(r,";cursor: url('").concat(t,"') 16 16, ").concat(r,";")}(e),"\n}\n")})).join("\n"),'\n\n.line.direction:before {\ncontent: "";\nposition: absolute;\nwidth: 100%;\nheight: calc(var(--moveable-line-padding, 0) * 1px);\nbottom: 0;\nleft: 0;\n}\n.group {\nz-index: -1;\n}\n.area {\nposition: absolute;\n}\n.area-pieces {\nposition: absolute;\ntop: 0;\nleft: 0;\ndisplay: none;\n}\n.area.avoid, .area.pass {\npointer-events: none;\n}\n.area.avoid+.area-pieces {\ndisplay: block;\n}\n.area-piece {\nposition: absolute;\n}\n\n').concat(jm?':global svg *:before {\ncontent:"";\ntransform-origin: inherit;\n}':"","\n"),ev=[[0,1,2],[1,0,3],[2,0,3],[3,1,2]],tv=1e-4,nv=1e-7,rv=1e-9,ov=Math.pow(10,10),iv=-ov,av={n:[0,-1],e:[1,0],s:[0,1],w:[-1,0],nw:[-1,-1],ne:[1,-1],sw:[-1,1],se:[1,1]},sv={n:[0,1],e:[1,3],s:[3,2],w:[2,0],nw:[0],ne:[1],sw:[2],se:[3]},lv={n:0,s:180,w:270,e:90,nw:315,ne:45,sw:225,se:135},dv=["isMoveableElement","updateRect","updateTarget","destroy","dragStart","isInside","hitTest","setState","getRect","request","isDragging","getManager","forceUpdate","waitToChangeTarget","updateSelectors","getTargets","stopDrag","getControlBoxElement","getMoveables","getDragElement"];function uv(e,t,n,r,o,i){var a,s;void 0===i&&(i="draggable");var l=null!==(s=null===(a=t.gestos[i])||void 0===a?void 0:a.move(n,e.inputEvent))&&void 0!==s?s:{},d=l.originalDatas||l.datas,u=d[i]||(d[i]={});return Im(Im({},o?mx(t,l):l),{isPinch:!!r,parentEvent:!0,datas:u,originalDatas:e.originalDatas})}var cv=function(){function e(e){var t;void 0===e&&(e="draggable"),this.ableName=e,this.prevX=0,this.prevY=0,this.startX=0,this.startY=0,this.isDrag=!1,this.isFlag=!1,this.datas={draggable:{}},this.datas=((t={})[e]={},t)}return e.prototype.dragStart=function(e,t){this.isDrag=!1,this.isFlag=!1;var n=t.originalDatas;return this.datas=n,n[this.ableName]||(n[this.ableName]={}),Im(Im({},this.move(e,t.inputEvent)),{type:"dragstart"})},e.prototype.drag=function(e,t){return this.move([e[0]-this.prevX,e[1]-this.prevY],t)},e.prototype.move=function(e,t){var n,r,o=!1;if(this.isFlag){var i=this.isDrag;n=this.prevX+e[0],r=this.prevY+e[1],(e[0]||e[1])&&(this.isDrag=!0),!i&&this.isDrag&&(o=!0)}else this.prevX=e[0],this.prevY=e[1],this.startX=e[0],this.startY=e[1],n=e[0],r=e[1],this.isFlag=!0;return this.prevX=n,this.prevY=r,{type:"drag",clientX:n,clientY:r,inputEvent:t,isFirstDrag:o,isDrag:this.isDrag,distX:n-this.startX,distY:r-this.startY,deltaX:e[0],deltaY:e[1],datas:this.datas[this.ableName],originalDatas:this.datas,parentEvent:!0,parentGesto:this}},e}();function pv(e,t,n,r){var o=16===e.length?4:3,i=Om($y(e,n,r,o),4),a=Om(i[0],2),s=a[0],l=a[1],d=Om(i[1],2),u=d[0],c=d[1],p=Om(i[2],2),h=p[0],f=p[1],g=Om(i[3],2),m=g[0],v=g[1],b=Om(Ny(e,t,o),2),y=b[0],x=b[1],C=Math.min(s,u,h,m),w=Math.min(l,c,f,v),S=Math.max(s,u,h,m);return s=s-C||0,{left:C,top:w,right:S,bottom:Math.max(l,c,f,v),origin:[y=y-C||0,x=x-w||0],pos1:[s,l=l-w||0],pos2:[u=u-C||0,c=c-w||0],pos3:[h=h-C||0,f=f-w||0],pos4:[m=m-C||0,v=v-w||0],direction:_x(e[0]*e[o+1])}}function hv(e,t){var n=t.clientX,r=t.clientY,o=t.datas,i=e.state,a=i.moveableClientRect,s=i.rootMatrix,l=i.is3d,d=i.pos1,u=Om(pg(gx(s,[n-a.left,r-a.top],l?4:3),d),2),c=Om(xv({datas:o,distX:u[0],distY:u[1]}),2);return[c[0],c[1]]}function fv(e,t){var n=t.datas,r=e.state,o=r.allMatrix,i=r.beforeMatrix,a=r.is3d,s=r.left,l=r.top,d=r.origin,u=r.offsetMatrix,c=r.targetMatrix,p=r.transformOrigin,h=a?4:3;n.is3d=a,n.matrix=o,n.targetMatrix=c,n.beforeMatrix=i,n.offsetMatrix=u,n.transformOrigin=p,n.inverseMatrix=ig(o,h),n.inverseBeforeMatrix=ig(i,h),n.absoluteOrigin=sg(cg([s,l],d),h),n.startDragBeforeDist=fg(n.inverseBeforeMatrix,n.absoluteOrigin,h),n.startDragDist=fg(n.inverseMatrix,n.absoluteOrigin,h)}function gv(e,t,n){var r=t.datas,o=t.originalDatas.beforeRenderable,i=r.transformIndex,a=o.nextTransforms,s=a.length,l=o.nextTransformAppendedIndexes,d=-1;-1===i?("translate"===n?d=0:"rotate"===n&&(d=Rf(a,(function(e){return e.match(/scale\(/g)}))),-1===d&&(d=a.length),r.transformIndex=d):d=Tf(l,(function(e){return e.index===i&&e.functionName===n}))?i:i+l.filter((function(e){return e.index<i})).length;var u=function(e,t,n){var r,o=Tg(e,{"x%":function(e){return e/100*t.offsetWidth},"y%":function(e){return e/100*t.offsetHeight}}),i=e.slice(0,n<0?void 0:n),a=e.slice(0,n<0?void 0:n+1),s=e[n]||"",l=n<0?[]:e.slice(n),d=n<0?[]:e.slice(n+1),u=o.slice(0,n<0?void 0:n),c=o.slice(0,n<0?void 0:n+1),p=null!==(r=o[n])&&void 0!==r?r:Tg([""])[0],h=n<0?[]:o.slice(n),f=n<0?[]:o.slice(n+1),g=p?[p]:[],m=Rg(u),v=Rg(c),b=Rg(h),y=Rg(f),x=ug(m,b,4);return{transforms:e,beforeFunctionMatrix:m,beforeFunctionMatrix2:v,targetFunctionMatrix:Rg(g),afterFunctionMatrix:b,afterFunctionMatrix2:y,allFunctionMatrix:x,beforeFunctions:u,beforeFunctions2:c,targetFunction:g[0],afterFunctions:h,afterFunctions2:f,beforeFunctionTexts:i,beforeFunctionTexts2:a,targetFunctionText:s,afterFunctionTexts:l,afterFunctionTexts2:d}}(a,e.state,d),c=u.targetFunction,p="rotate"===n?"rotateZ":n;r.beforeFunctionTexts=u.beforeFunctionTexts,r.afterFunctionTexts=u.afterFunctionTexts,r.beforeTransform=u.beforeFunctionMatrix,r.beforeTransform2=u.beforeFunctionMatrix2,r.targetTansform=u.targetFunctionMatrix,r.afterTransform=u.afterFunctionMatrix,r.afterTransform2=u.afterFunctionMatrix2,r.targetAllTransform=u.allFunctionMatrix,c.functionName===p?(r.afterFunctionTexts.splice(0,1),r.isAppendTransform=!1):s>d&&(r.isAppendTransform=!0,o.nextTransformAppendedIndexes=Pm(Pm([],Om(l),!1),[{functionName:n,index:d,isAppend:!0}],!1))}function mv(e,t,n){return"".concat(e.beforeFunctionTexts.join(" ")," ").concat(e.isAppendTransform?n:t," ").concat(e.afterFunctionTexts.join(" "))}function vv(e){var t=e.datas,n=Om(yv({datas:t,distX:e.distX,distY:e.distY}),2);return fg(bv(t,function(e,t){for(var n=Sg(t),r=0;r<t-1;++r)n[t*(t-1)+r]=e[r]||0;return n}([n[0],n[1]],4)),sg([0,0,0],4),4)}function bv(e,t,n){var r=e.beforeTransform,o=e.afterTransform,i=e.beforeTransform2,a=e.afterTransform2,s=e.targetAllTransform,l=n?ug(s,t,4):ug(t,s,4),d=ug(ig(n?i:r,4),l,4);return ug(d,ig(n?a:o,4),4)}function yv(e){var t=e.datas,n=e.distX,r=e.distY,o=t.inverseBeforeMatrix,i=t.is3d,a=t.startDragBeforeDist,s=i?4:3;return pg(fg(o,cg(t.absoluteOrigin,[n,r]),s),a)}function xv(e,t){var n=e.datas,r=e.distX,o=e.distY,i=n.inverseBeforeMatrix,a=n.inverseMatrix,s=n.is3d,l=n.startDragBeforeDist,d=n.startDragDist,u=s?4:3;return pg(fg(t?i:a,cg(n.absoluteOrigin,[r,o]),u),t?l:d)}function Cv(e){var t=[];return e[1]>=0&&(e[0]>=0&&t.push(3),e[0]<=0&&t.push(2)),e[1]<=0&&(e[0]>=0&&t.push(1),e[0]<=0&&t.push(0)),t}function wv(e,t){var n=(t[0]+1)/2,r=(t[1]+1)/2,o=[ff(e[0][0],e[1][0],n,1-n),ff(e[0][1],e[1][1],n,1-n)],i=[ff(e[2][0],e[3][0],n,1-n),ff(e[2][1],e[3][1],n,1-n)];return[ff(o[0],i[0],r,1-r),ff(o[1],i[1],r,1-r)]}function Sv(e,t,n,r){return ug(e,ky(t,r,n),r)}function Zv(e,t){var n=Ev(t);return{setTransform:function(r,o){void 0===o&&(o=-1),n.startTransforms=vf(r)?r:Zf(r),Mv(e,t,o)},setTransformIndex:function(n){Mv(e,t,n)}}}function kv(e,t,n){Mv(e,t,Rf(Ev(t).startTransforms,(function(e){return 0===e.indexOf("".concat(n,"("))})))}function Mv(e,t,n){var r=Ev(t),o=t.datas;if(o.transformIndex=n,-1!==n){var i=r.startTransforms[n];if(i){var a=e.state,s=Tg([i],{"x%":function(e){return e/100*a.offsetWidth},"y%":function(e){return e/100*a.offsetHeight}});o.startValue=s[0].functionValue}}}function Dv(e,t){Ev(e).nextTransforms=Zf(t)}function Ev(e){return e.originalDatas.beforeRenderable}function Rv(e){return e.originalDatas.beforeRenderable.nextTransforms}function Tv(e){return(Rv(e)||[]).join(" ")}function _v(e){return Ev(e).nextStyle}function Iv(e,t,n,r,o){Dv(o,t);var i=Bb.drag(e,uv(o,e.state,n,r,!1)),a=i?i.transform:t;return Im(Im({transform:t,drag:i},rx({transform:a},o)),{afterTransform:a})}function Ov(e,t,n,r,o,i){var a=function(e,t,n,r){var o,i=e.transformOrigin,a=e.offsetMatrix,s=e.is3d?4:3;if(bf(n)){var l=t.beforeTransform,d=t.afterTransform;o=lg(r?Eg(n):ug(ug(l,Eg([n]),4),d,4),4,s)}else o=n;return Sv(a,o,i,s)}(e.state,o,t,i),s=function(e,t,n,r){void 0===r&&(r=e.state.allMatrix);var o=e.state,i=o.width,a=o.height,s=o.is3d?4:3,l=[i/2*(1+t[0])+n[0],a/2*(1+t[1])+n[1]];return Ny(r,l,s)}(e,n,r,a);return s}function Pv(e,t,n,r,o,i,a){var s=Ov(e,t,n,o,i,a),l=e.state,d=l.left,u=l.top,c=e.props.groupable,p=c?d:0,h=c?u:0,f=pg(r,s);return pg(f,[p,h])}function zv(e,t,n,r,o,i){var a=e.props.groupable,s=e.state,l=s.transformOrigin,d=s.offsetMatrix,u=s.is3d,c=s.width,p=s.height,h=s.left,f=s.top,g=i.fixedDirection,m=i.nextTargetMatrix||s.targetMatrix,v=u?4:3,b=function(e,t,n,r,o,i){return void 0===r&&(r=t),void 0===o&&(o=n),void 0===i&&(i=[0,0]),e?e.map((function(e,a){var s=Df(e),l=s.value,d=s.unit,u=a?o:r,c=a?n:t;return"%"===e||isNaN(l)?c*(u?i[a]/u:0):"%"!==d?l:c*l/100})):i}(o,t,n,c,p,l),y=a?h:0,x=a?f:0,C=function(e,t,n,r,o,i){var a=wv($y(t,n,r,o),i);return[e[0]-a[0],e[1]-a[1]]}(r,Sv(d,m,b,v),t,n,v,g);return pg(C,[y,x])}function Fv(e){if(e&&e.getRootNode){var t=e.getRootNode();if(11===t.nodeType)return t}}function Nv(e){var t=e("scale"),n=e("rotate"),r=e("translate"),o=[];return r&&"0px"!==r&&"none"!==r&&o.push("translate(".concat(r.split(/\s+/).join(","),")")),n&&"1"!==n&&"none"!==n&&o.push("rotate(".concat(n,")")),t&&"1"!==t&&"none"!==t&&o.push("scale(".concat(t.split(/\s+/).join(","),")")),o}function $v(e,t,n){for(var r,o,i,a,s,l=e,d=[],u=Yf(e)||Xf(e),c=!n&&e===t||e===u,p=c,h=!1,f=3,g=!1,m=Ry(t,t,!0).offsetParent,v=1;l&&!p;){p=c;var b=Hv(l),y=b("position"),x=Ey(l),C="fixed"===y,w=Nv(b),S=(a=Zy(x),void 0===(s=void 0)&&(s=6===a.length),s?[a[0],a[1],0,a[2],a[3],0,a[4],a[5],1]:a),Z=void 0,k=!1,M=!1,D=0,E=0,R=0,T=0,_={hasTransform:!1,fixedContainer:null};C&&(g=!0,m=(_=Oy(l)).fixedContainer);var I=S.length;h||16!==I&&!w.length||(h=!0,f=4,Iy(d),i&&(i=lg(i,3,4))),h&&9===I&&(S=lg(S,3,4));var O=Ty(l,e),P=O.tagName,z=O.hasOffset,F=O.isSVG,N=O.origin,$=O.targetOrigin,L=Om(O.offset,2),B=L[0],A=L[1];"svg"===P&&i&&(d.push({type:"target",target:l,matrix:Fy(l,f)}),d.push({type:"offset",target:l,matrix:Sg(f)}));var j=parseFloat(b("zoom"))||1;if(C)Z=_.fixedContainer,k=!0;else{var H=Ry(l,t,!1,!0,b),q=H.offsetZoom;if(Z=H.offsetParent,k=H.isEnd,M=H.isStatic,v*=q,(H.isCustomElement||1!==q)&&M)B-=Z.offsetLeft,A-=Z.offsetTop;else if(Km||Gm){if(H.parentSlotElement){for(var U=Z,V=0,W=0;U&&Fv(U);)V+=U.offsetLeft,W+=U.offsetTop,U=U.offsetParent;B-=V,A-=W}}}if(!Am||Ym||!z||F||!M||"relative"!==y&&"static"!==y||(B-=Z.offsetLeft,A-=Z.offsetTop,c=c||k),C)z&&_.hasTransform&&(R=Z.clientLeft,T=Z.clientTop);else if(z&&m!==Z&&(D=Z.clientLeft,E=Z.clientTop),z&&Z===u){var G=_y(l,!1);B+=G[0],A+=G[1]}if(d.push({type:"target",target:l,matrix:ky(S,f,N)}),w.length&&(d.push({type:"offset",target:l,matrix:Sg(f)}),d.push({type:"target",target:l,matrix:ky(Eg(w),f,N)})),z){var K=l===e,Y=K?0:l.scrollLeft,X=K?0:l.scrollTop;d.push({type:"offset",target:l,matrix:kg([B-Y+D-R,A-X+E-T],f)})}else d.push({type:"offset",target:l,origin:N});if(1!==j&&d.push({type:"zoom",target:l,matrix:ky(Zg([j,j],f),f,[0,0])}),i||(i=S),r||(r=N),o||(o=$),p||C)break;l=Z,c=k,n&&l!==u||(p=c)}return i||(i=Sg(f)),r||(r=[0,0]),o||(o=[0,0]),{zoom:v,offsetContainer:m,matrixes:d,targetMatrix:i,transformOrigin:r,targetOrigin:o,is3d:h,hasFixed:g}}var Lv=null,Bv=null,Av=null;function jv(e){e?(window.Map&&(Lv=new Map,Bv=new Map),Av=[]):(Lv=null,Av=null,Bv=null)}function Hv(e){var t=null===Lv||void 0===Lv?void 0:Lv.get(e);if(!t){var n=Qf(e).getComputedStyle(e);if(!Lv)return function(e){return n[e]};t={style:n,cached:{}},Lv.set(e,t)}var r=t.cached,o=t.style;return function(e){return e in r||(r[e]=o[e]),r[e]}}function qv(e,t,n){var r=n.originalDatas;r.groupable=r.groupable||{};var o=r.groupable;o.childDatas=o.childDatas||[];var i=o.childDatas;return e.moveables.map((function(e,r){return i[r]=i[r]||{},i[r][t]=i[r][t]||{},Im(Im({},n),{isRequestChild:!0,datas:i[r][t],originalDatas:i[r]})}))}function Uv(e,t,n,r,o,i,a){var s=!!n.match(/Start$/g),l=!!n.match(/End$/g),d=o.isPinch,u=o.datas,c=qv(e,t.name,o),p=e.moveables,h=c.map((function(e,o){var c=p[o],h=c.state,f=h.gestos,g=e;if(s)g=new cv(a).dragStart(r,e);else{if(f[a]||(f[a]=u.childGestos[o]),!f[a])return;g=uv(e,h,r,d,i,a)}var m=t[n](c,Im(Im({},g),{parentFlag:!0}));return l&&(f[a]=null),m}));return s&&(u.childGestos=p.map((function(e){return e.state.gestos[a]}))),h}function Vv(e,t,n,r,o,i){void 0===o&&(o=function(e,t){return t});var a=!!n.match(/End$/g),s=qv(e,t.name,r),l=e.moveables;return s.map((function(e,r){var s,d=l[r];s=o(d,e);var u=t[n](d,Im(Im({},s),{parentFlag:!0}));return u&&i&&i(d,e,u,r),a&&(d.state.gestos={}),u}))}function Wv(e,t,n,r){var o=n.fixedDirection,i=n.fixedPosition,a=wv(r.datas.startPositions||ex(t.state),o),s=Om(fg(wg(-e.rotation/180*Math.PI,3),[a[0]-i[0],a[1]-i[1],1],3),2),l=s[0],d=s[1];return r.datas.originalX=l,r.datas.originalY=d,r}function Gv(e,t,n,r){var o=e.getState(),i=o.renderPoses,a=o.rotation,s=o.direction,l=Uy(e.props,t).zoom,d=py(a/Math.PI*180),u={},c=e.renderState;c.renderDirectionMap||(c.renderDirectionMap={});var p=c.renderDirectionMap;n.forEach((function(e){var t=e.dir;u[t]=!0}));var h=_x(s);return n.map((function(e){var n=e.data,o=e.classNames,s=e.dir,c=sv[s];if(!c||!u[s])return null;p[s]=!0;var f=(jf(d,15)+h*lv[s]+720)%180,g={};return Of(n).forEach((function(e){g["data-".concat(e)]=n[e]})),r.createElement("div",Im({className:wy.apply(void 0,Pm(["control","direction",s,t],Om(o),!1)),"data-rotation":f,"data-direction":s},g,{key:"direction-".concat(s),style:qy.apply(void 0,Pm([a,l],Om(c.map((function(e){return i[e]}))),!1))}))}))}function Kv(e,t,n,r){var o=Uy(e.props,n),i=o.renderDirections,a=void 0===i?t:i,s=o.displayAroundControls;if(!a)return[];var l=!0===a?Nm:a;return Pm(Pm([],Om(s?eb(e,r,n,l):[]),!1),Om(Gv(e,n,l.map((function(e){return{data:{},classNames:[],dir:e}})),r)),!1)}function Yv(e,t,n,r,o,i){for(var a=[],s=6;s<arguments.length;s++)a[s-6]=arguments[s];var l=Lf(n,r),d=t?jf(l/Math.PI*180,15)%180:-1;return e.createElement("div",{key:"line-".concat(i),className:wy.apply(void 0,Pm(["line","direction",t?"edge":"",t],Om(a),!1)),"data-rotation":d,"data-line-key":i,"data-direction":t,style:Hy(n,r,o,l)})}function Xv(e,t,n,r,o){return(!0===n?Fm:n).map((function(n,i){var a=Om(sv[n],2),s=a[0],l=a[1];if(null!=l)return Yv(e,n,r[s],r[l],o,"".concat(t,"Edge").concat(i),t)})).filter(Boolean)}function Qv(e){return function(t,n){var r=Uy(t.props,e).edge;return r&&(!0===r||r.length)?Pm(Pm([],Om(Xv(n,e,r,t.getState().renderPoses,t.props.zoom)),!1),Om(function(e,t,n){return Kv(e,["nw","ne","sw","se"],t,n)}(t,e,n)),!1):Jv(t,e,n)}}function Jv(e,t,n){return Kv(e,Nm,t,n)}function eb(e,t,n,r){var o=e.renderState;o.renderDirectionMap||(o.renderDirectionMap={});var i=e.getState(),a=i.renderPoses,s=i.rotation,l=i.direction,d=o.renderDirectionMap,u=e.props.zoom,c=_x(l),p=s/Math.PI*180;return(r||Of(d)).map((function(e){var r=sv[e];if(!r)return null;var o=(jf(p,15)+c*lv[e]+720)%180,i=["around-control"];return n&&i.push("direction",n),t.createElement("div",{className:wy.apply(void 0,Pm([],Om(i),!1)),"data-rotation":o,"data-direction":e,key:"direction-around-".concat(e),style:qy.apply(void 0,Pm([s,u],Om(r.map((function(e){return a[e]}))),!1))})}))}function tb(e,t,n){var r=e||{},o=r.position,i=void 0===o?"client":o,a=r.left,s=void 0===a?-1/0:a,l=r.top,d=void 0===l?-1/0:l,u=r.right,c=void 0===u?1/0:u,p=r.bottom,h={position:i,left:s,top:d,right:c,bottom:void 0===p?1/0:p};return{vertical:rb(h,t,!0),horizontal:rb(h,n,!1)}}function nb(e,t){var n=e.state,r=n.containerClientRect,o=r.clientHeight,i=r.clientWidth,a=r.clientLeft,s=r.clientTop,l=n.snapOffset,d=l.left,u=l.top,c=l.right,p=l.bottom,h=t||e.props.bounds||{},f="css"===(h.position||"client"),g=h.left,m=void 0===g?-1/0:g,v=h.top,b=void 0===v?-1/0:v,y=h.right,x=void 0===y?f?-1/0:1/0:y,C=h.bottom,w=void 0===C?f?-1/0:1/0:C;return f&&(x=i+c-d-x,w=o+p-u-w),{left:m+d-a,right:x+d-a,top:b+u-s,bottom:w+u-s}}function rb(e,t,n){var r=e[n?"left":"top"],o=e[n?"right":"bottom"],i=Math.min.apply(Math,Pm([],Om(t),!1)),a=Math.max.apply(Math,Pm([],Om(t),!1)),s=[];return r+1>i&&s.push({direction:"start",isBound:!0,offset:i-r,pos:r}),o-1<a&&s.push({direction:"end",isBound:!0,offset:a-o,pos:o}),s.length||s.push({isBound:!1,offset:0,pos:0}),s.sort((function(e,t){return Ix(t.offset)-Ix(e.offset)}))}function ob(e,t,n){return(n?e.map((function(e){return yg(e,n)})):e).some((function(e){return e[0]<t.left&&Ix(e[0]-t.left)>.1||e[0]>t.right&&Ix(e[0]-t.right)>.1||e[1]<t.top&&Ix(e[1]-t.top)>.1||e[1]>t.bottom&&Ix(e[1]-t.bottom)>.1}))}function ib(e,t,n,r,o){if(!e.props.bounds)return[];var i=o*Math.PI/180,a=nb(e),s=a.left,l=a.top,d=a.right,u=a.bottom,c=s-r[0],p=d-r[0],h=l-r[1],f=u-r[1],g={left:c,top:h,right:p,bottom:f};if(!ob(n,g,0))return[];var m=[];return[[c,0],[p,0],[h,1],[f,1]].forEach((function(e){var r=Om(e,2),o=r[0],a=r[1];n.forEach((function(e){var n=Lf([0,0],e);m.push.apply(m,Pm([],Om(function(e,t,n){var r=Ay(e),o=Math.sqrt(r*r-t*t)||0;return[o,-o].sort((function(t,r){return Ix(t-e[n?0:1])-Ix(r-e[n?0:1])})).map((function(e){return Lf([0,0],n?[e,t]:[t,e])}))}(e,o,a).map((function(e){return i+e-n})).filter((function(e){return!ob(t,g,e)})).map((function(e){return jf(180*e/Math.PI,nv)}))),!1))}))})),m}var ab=["left","right","center"],sb=["top","bottom","middle"],lb={left:"start",right:"end",center:"center",top:"start",bottom:"end",middle:"center"},db={start:"left",end:"right",center:"center"},ub={start:"top",end:"bottom",center:"middle"};function cb(e,t){var n=e.props,r=n.snappable,o=n.bounds,i=n.innerBounds,a=n.verticalGuidelines,s=n.horizontalGuidelines,l=n.snapGridWidth,d=n.snapGridHeight,u=e.state,c=u.guidelines,p=u.enableSnap;return!(!r||!p||t&&!0!==r&&r.indexOf(t)<0)&&!!(l||d||o||i||c&&c.length||a&&a.length||s&&s.length)}function pb(e){return!1===e?{}:!0!==e&&e?e:{left:!0,right:!0,top:!0,bottom:!0}}function hb(e,t){var n=function(e,t){var n=pb(e),r={};for(var o in n)o in t&&n[o]&&(r[o]=t[o]);return r}(e,t),r=sb.filter((function(e){return e in n})),o=ab.filter((function(e){return e in n}));return{horizontalNames:r,verticalNames:o,horizontal:r.map((function(e){return n[e]})),vertical:o.map((function(e){return n[e]}))}}function fb(e,t,n,r,o,i){void 0===r&&(r=[]),void 0===o&&(o=[]);var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e.length-1,r=0;r<n;++r){var o=e[r];if(!gf(o))return o}return e[n]}(i,e.props.snapThreshold,5);return gb(e.state.guidelines,t,n,r,o,a)}function gb(e,t,n,r,o,i){return{vertical:yb(e,"vertical",t,i,r),horizontal:yb(e,"horizontal",n,i,o)}}function mb(e){var t="";return-1===e||"top"===e||"left"===e?t="start":0===e||"center"===e||"middle"===e?t="center":1!==e&&"right"!==e&&"bottom"!==e||(t="end"),t}function vb(e,t,n){var r=hb(e.props.snapDirections,t),o=fb(e,r.vertical,r.horizontal,r.verticalNames.map((function(e){return mb(e)})),r.horizontalNames.map((function(e){return mb(e)})),n),i=mb(r.horizontalNames[o.horizontal.index]),a=mb(r.verticalNames[o.vertical.index]);return{vertical:Im(Im({},o.vertical),{direction:a}),horizontal:Im(Im({},o.horizontal),{direction:i})}}function bb(e){var t=e.isSnap;if(!t)return{isSnap:!1,offset:0,dist:-1,pos:0,guideline:null};var n=e.posInfos[0],r=n.guidelineInfos[0],o=r.offset,i=r.dist,a=r.guideline;return{isSnap:t,offset:o,dist:i,pos:n.pos,guideline:a}}function yb(e,t,n,r,o){var i,a;if(void 0===o&&(o=[]),!e||!e.length)return{isSnap:!1,index:-1,direction:"",posInfos:[]};var s="vertical"===t?0:1,l=n.map((function(n,i){var a=o[i]||"",l=e.map((function(e){var t=e.pos,r=n-t[s];return{offset:r,dist:Ix(r),guideline:e,direction:a}})).filter((function(e){var n=e.guideline,o=e.dist;return!(n.type!==t||o>r)})).sort((function(e,t){return e.dist-t.dist}));return{pos:n,index:i,guidelineInfos:l,direction:a}})).filter((function(e){return e.guidelineInfos.length>0})).sort((function(e,t){return e.guidelineInfos[0].dist-t.guidelineInfos[0].dist})),d=l.length>0;return{isSnap:d,index:d?l[0].index:-1,direction:null!==(a=null===(i=l[0])||void 0===i?void 0:i.direction)&&void 0!==a?a:"",posInfos:l}}function xb(e,t,n,r){void 0===r&&(r=1);var o=[];n[0]&&n[1]?o=[n,[-n[0],n[1]],[n[0],-n[1]]]:n[0]||n[1]?e.props.keepRatio?o.push([-1,-1],[-1,1],[1,-1],[1,1],n):(o.push.apply(o,Pm([],Om(function(e,t){return Cv(t).map((function(t){return e[t]}))}([[-1,-1],[1,-1],[-1,-1],[1,1]],n)),!1)),o.length>1&&o.push([(o[0][0]+o[1][0])/2,(o[0][1]+o[1][1])/2])):[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e,t,n){var r=n[t+1]||n[0];o.push(e),o.push([(e[0]+r[0])/2,(e[1]+r[1])/2])}));var i=o.map((function(e){return wv(t,e)})),a=fb(e,i.map((function(e){return e[0]})),i.map((function(e){return e[1]})),o.map((function(e){return mb(e[0])})),o.map((function(e){return mb(e[1])})),r),s=mb(o.map((function(e){return e[0]}))[a.vertical.index]),l=mb(o.map((function(e){return e[1]}))[a.horizontal.index]);return{vertical:Im(Im({},a.vertical),{direction:s}),horizontal:Im(Im({},a.horizontal),{direction:l})}}function Cb(e,t){var n=Ix(e.offset),r=Ix(t.offset);return e.isBound&&t.isBound?r-n:e.isBound?-1:t.isBound?1:e.isSnap&&t.isSnap?r-n:e.isSnap?-1:t.isSnap||n<nv?1:r<nv?-1:n-r}function wb(e,t){return e.slice().sort((function(e,n){var r=e.sign[t],o=n.sign[t],i=e.offset[t],a=n.offset[t];return r?o?Cb({isBound:e.isBound,isSnap:e.isSnap,offset:i},{isBound:n.isBound,isSnap:n.isSnap,offset:a}):-1:1}))[0]}function Sb(e,t){var n=$f([t[0][0],t[1][0]]),r=$f([t[0][1],t[1][1]]);return{vertical:n<=e[0],horizontal:r<=e[1]}}function Zb(e,t){var n,r,o=Om(t,2),i=o[0],a=o[1],s=a[0]-i[0],l=a[1]-i[1];if(Ix(s)<nv&&(s=0),Ix(l)<nv&&(l=0),s)if(l){n=l/s*(e[0]-i[0])+i[1],r=e[1]}else n=i[1],r=e[1];else n=i[0],r=e[0];return n-r}function kb(e,t,n,r){return void 0===r&&(r=nv),e.every((function(e){var o=Zb(e,t);return o<=0===n||Ix(o)<=r}))}function Mb(e,t,n,r,o){return void 0===o&&(o=0),r&&t-o<=e||!r&&e<=n+o?{isBound:!0,offset:r?t-e:n-e}:{isBound:!1,offset:0}}function Db(e,t,n,r,o,i){var a,s,l=Om(t,2),d=l[0],u=l[1],c=e[0],p=n[0],h=n[1],f=yx(h[1]-p[1]),g=u,m=d,v=-d/u;return yx(h[0]-p[0])?f||i&&!g?{isBound:!1,offset:0}:m?Mb((p[1]-c[1])/v+c[0],p[0],h[0],r,o):{isBound:s=Ix(a=p[1]-c[1])<=(o||0),offset:s?a:0}:i&&!m?{isBound:!1,offset:0}:g?Mb(v*(p[0]-c[0])+c[1],p[1],h[1],r,o):{isBound:s=Ix(a=p[0]-c[0])<=(o||0),offset:s?a:0}}function Eb(e,t,n){return t.map((function(t){var r=function(e,t){var n=t.line,r=t.centerSign,o=t.verticalSign,i=t.horizontalSign,a=t.lineConstants,s=e.props.innerBounds;if(!s)return{isAllBound:!1,isBound:!1,isVerticalBound:!1,isHorizontalBound:!1,offset:[0,0]};var l=s.left,d=s.top,u=s.width,c=s.height,p=[[l,d],[l,d+c]],h=[[l,d],[l+u,d]],f=[[l+u,d],[l+u,d+c]],g=[[l,d+c],[l+u,d+c]];if(kb([[l,d],[l+u,d],[l,d+c],[l+u,d+c]],n,r))return{isAllBound:!1,isBound:!1,isVerticalBound:!1,isHorizontalBound:!1,offset:[0,0]};var m=Db(n,a,h,o),v=Db(n,a,g,o),b=Db(n,a,p,i),y=Db(n,a,f,i),x=m.isBound&&v.isBound,C=m.isBound||v.isBound,w=b.isBound&&y.isBound,S=b.isBound||y.isBound,Z=fx(m.offset,v.offset),k=fx(b.offset,y.offset),M=[0,0],D=!1,E=!1;return Ix(k)<Ix(Z)?(M=[Z,0],D=C,E=x):(M=[0,k],D=S,E=w),{isAllBound:E,isVerticalBound:C,isHorizontalBound:S,isBound:D,offset:M}}(e,t),o=r.isBound,i=r.offset,a=r.isVerticalBound,s=r.isHorizontalBound,l=t.multiple,d=xv({datas:n,distX:i[0],distY:i[1]}).map((function(e,t){return e*(l[t]?2/l[t]:0)}));return{sign:l,isBound:o,isVerticalBound:a,isHorizontalBound:s,isSnap:!1,offset:d}}))}function Rb(e,t,n){var r,o=Eb(e,Tb(e,t,[0,0],!1).map((function(e){return Im(Im({},e),{multiple:e.multiple.map((function(e){return 2*Ix(e)}))})})),n),i=wb(o,0),a=wb(o,1),s=0,l=0,d=i.isVerticalBound||a.isVerticalBound,u=i.isHorizontalBound||a.isHorizontalBound;return(d||u)&&(r=Om(function(e,t){var n=e.datas,r=e.distX,o=e.distY,i=n.beforeMatrix,a=n.matrix,s=n.is3d,l=n.startDragBeforeDist,d=n.startDragDist,u=n.absoluteOrigin,c=s?4:3;return pg(fg(t?i:a,cg(t?l:d,[r,o]),c),u)}({datas:n,distX:-i.offset[0],distY:-a.offset[1]}),2),s=r[0],l=r[1]),{vertical:{isBound:d,offset:s},horizontal:{isBound:u,offset:l}}}function Tb(e,t,n,r){var o=e.state,i=$y(o.allMatrix,100,100,o.is3d?4:3),a=wv(i,[0,0]);return function(e,t){var n=[],r=e[0],o=e[1];return r&&o?n.push([[0,2*o],e,[-r,o]],[[2*r,0],e,[r,-o]]):r?(n.push([[2*r,0],[r,1],[r,-1]]),t&&n.push([[0,-1],[r,-1],[-r,-1]],[[0,1],[r,1],[-r,1]])):o?(n.push([[0,2*o],[1,o],[-1,o]]),t&&n.push([[-1,0],[-1,o],[-1,-o]],[[1,0],[1,o],[1,-o]])):n.push([[-1,0],[-1,-1],[-1,1]],[[1,0],[1,-1],[1,1]],[[0,-1],[-1,-1],[1,-1]],[[0,1],[-1,1],[1,1]]),n}(n,r).map((function(e){var n=Om(e,3),r=n[0],o=n[1],s=n[2],l=[wv(i,o),wv(i,s)],d=function(e){var t=Om(e,2),n=t[0],r=t[1],o=r[0]-n[0],i=r[1]-n[1];Math.abs(o)<pf&&(o=0),Math.abs(i)<pf&&(i=0);var a=0,s=0,l=0;return o?i?(s=1,l=(a=-i/o)*n[0]-n[1]):(s=1,l=-n[1]):(a=-1,l=n[0]),[a,s,l].map((function(e){return jf(e,pf)}))}(l),u=Sb(a,l),c=u.vertical,p=u.horizontal;return{multiple:r,centerSign:Zb(a,l)<=0,verticalSign:c,horizontalSign:p,lineConstants:d,line:[wv(t,o),wv(t,s)]}}))}function _b(e,t,n,r){var o=r?e.map((function(e){return yg(e,r)})):e;return[[o[0],o[1]],[o[1],o[3]],[o[3],o[2]],[o[2],o[0]]].some((function(e){var r=Zb(n,e)<=0;return!kb(t,e,r)}))}function Ib(e,t,n,r,o){var i=e.props.innerBounds,a=o*Math.PI/180;if(!i)return[];var s=i.left,l=i.top,d=i.width,u=i.height,c=s-r[0],p=s+d-r[0],h=l-r[1],f=l+u-r[1],g=[[c,h],[p,h],[c,f],[p,f]],m=wv(n,[0,0]);if(!_b(n,g,m,0))return[];var v=[],b=g.map((function(e){return[Ay(e),Lf([0,0],e)]}));return[[n[0],n[1]],[n[1],n[3]],[n[3],n[2]],[n[2],n[0]]].forEach((function(e){var n=Lf([0,0],function(e){var t=Om(e,2),n=t[0],r=t[1],o=r[0]-n[0],i=r[1]-n[1];if(!o)return[n[0],0];if(!i)return[0,n[1]];var a=i/o,s=-a*n[0]+n[1];return[-s/(a+1/a),s/(a*a+1)]}(e)),r=function(e){var t=Om(e,2),n=t[0],r=t[1],o=r[0]-n[0],i=r[1]-n[1];if(!o)return Ix(n[0]);if(!i)return Ix(n[1]);var a=i/o;return Ix((-a*n[0]+n[1])/Math.sqrt(Math.pow(a,2)+1))}(e);v.push.apply(v,Pm([],Om(b.filter((function(e){var t=Om(e,1)[0];return t&&r<=t})).map((function(e){var t=Om(e,2),o=t[0],i=t[1],s=Math.acos(o?r/o:0);return[a+(i+s)-n,a+(i-s)-n]})).reduce((function(e,t){return e.push.apply(e,Pm([],Om(t),!1)),e}),[]).filter((function(e){return!_b(t,g,m,e)})).map((function(e){return jf(180*e/Math.PI,nv)}))),!1))})),v}function Ob(e,t,n,r,o){var i=function(e,t,n,r){var o=t[0]-e[0],i=t[1]-e[1];if(Ix(o)<pf&&(o=0),Ix(i)<pf&&(i=0),!o)return r?[0,0]:[0,n];if(!i)return r?[n,0]:[0,0];var a=i/o,s=e[1]-a*e[0];return r?[n,a*(t[0]+n)+s-t[1]]:[(t[1]+n-s)/a-t[0],n]}(e,t,n,r);if(!i)return{isOutside:!1,offset:[0,0]};var a=Af(e,t),s=Af(i,e),l=Af(i,t),d=s>a||l>a,u=Om(xv({datas:o,distX:i[0],distY:i[1]}),2);return{offset:[u[0],u[1]],isOutside:d}}function Pb(e,t){return e.isBound?e.offset:t.isSnap?bb(t).offset:0}function zb(e,t,n,r,o,i){if(!cb(e,"draggable"))return[{isSnap:!1,isBound:!1,offset:0},{isSnap:!1,isBound:!1,offset:0}];var a=Jy(i.absolutePoses,[t,n]),s=Ly(a),l=s.left,d=s.right,u=s.top,c=s.bottom,p={horizontal:a.map((function(e){return e[1]})),vertical:a.map((function(e){return e[0]}))},h=Fb(e,o,hb(pb(e.props.snapDirections),{left:l,right:d,top:u,bottom:c,center:(l+d)/2,middle:(u+c)/2}),p),f=h.vertical,g=h.horizontal,m=Rb(e,a,i),v=m.vertical,b=m.horizontal,y=f.isSnap,x=g.isSnap,C=f.isBound||v.isBound,w=g.isBound||b.isBound,S=Om(function(e,t,n,r,o){var i=Om(t,2),a=i[0],s=i[1],l=Om(n,2),d=l[0],u=l[1],c=Om(r,2),p=c[0],h=c[1],f=Om(o,2),g=f[0],m=f[1],v=-g,b=-m;if(e&&a&&s){v=0,b=0;var y=[];if(d&&u?y.push([0,m],[g,0]):d?y.push([g,0]):u?y.push([0,m]):p&&h?y.push([0,m],[g,0]):p?y.push([g,0]):h&&y.push([0,m]),y.length){y.sort((function(e,t){return Ay(pg([a,s],e))-Ay(pg([a,s],t))}));var x=y[0];if(x[0]&&Ix(a)>pf)v=-x[0],b=s*Ix(a+v)/Ix(a)-s;else if(x[1]&&Ix(s)>pf){var C=s;b=-x[1],v=a*Ix(s+b)/Ix(C)-a}if(e&&u&&d)if(Ix(v)>pf&&Ix(v)<Ix(g))v*=w=Ix(g)/Ix(v),b*=w;else if(Ix(b)>pf&&Ix(b)<Ix(m)){var w;v*=w=Ix(m)/Ix(b),b*=w}else v=fx(-g,v),b=fx(-m,b)}}else v=a||d?-g:0,b=s||u?-m:0;return[v,b]}(r,[t,n],[C,w],[y,x],[fx(f.offset,v.offset),fx(g.offset,b.offset)]),2);return[{isBound:C,isSnap:y,offset:S[0]},{isBound:w,isSnap:x,offset:S[1]}]}function Fb(e,t,n,r){void 0===r&&(r=n);var o=tb(nb(e),r.vertical,r.horizontal),i=o.horizontal,a=o.vertical,s=t?{horizontal:{isSnap:!1,index:-1},vertical:{isSnap:!1,index:-1}}:fb(e,n.vertical,n.horizontal),l=s.horizontal,d=s.vertical,u=Pb(i[0],l),c=Pb(a[0],d),p=Ix(u),h=Ix(c);return{horizontal:{isBound:i[0].isBound,isSnap:l.isSnap,snapIndex:l.index,offset:u,dist:p,bounds:i,snap:l},vertical:{isBound:a[0].isBound,isSnap:d.isSnap,snapIndex:d.index,offset:c,dist:h,bounds:a,snap:d}}}function Nb(e,t,n,r,o){var i=tb(t,n,r),a=i.horizontal,s=i.vertical,l=gb(e,n,r,[],[],o),d=l.horizontal,u=l.vertical,c=Pb(a[0],d),p=Pb(s[0],u),h=Ix(c),f=Ix(p);return{horizontal:{isBound:a[0].isBound,isSnap:d.isSnap,snapIndex:d.index,offset:c,dist:h,bounds:a,snap:d},vertical:{isBound:s[0].isBound,isSnap:u.isSnap,snapIndex:u.index,offset:p,dist:f,bounds:s,snap:u}}}function $b(e,t,n,r,o,i){return n.map((function(n){var a=Om(n,2),s=a[0],l=a[1],d=wv(t,s),u=wv(t,l),c=r?function(e,t,n,r){var o=function(e,t,n){var r=nb(e),o=r.left,i=r.top,a=r.right,s=r.bottom,l=Om(n,2),d=l[0],u=l[1],c=Om(pg(n,t),2),p=c[0],h=c[1];Ix(p)<nv&&(p=0),Ix(h)<nv&&(h=0);var f=h>0,g=p>0,m={isBound:!1,offset:0,pos:0},v={isBound:!1,offset:0,pos:0};if(0===p&&0===h)return{vertical:m,horizontal:v};if(0===p)f?s<u&&(v.pos=s,v.offset=u-s):i>u&&(v.pos=i,v.offset=u-i);else if(0===h)g?a<d&&(m.pos=a,m.offset=d-a):o>d&&(m.pos=o,m.offset=d-o);else{var b=h/p,y=n[1]-b*d,x=0,C=0,w=!1;g&&a<=d?(x=b*a+y,C=a,w=!0):!g&&d<=o&&(x=b*o+y,C=o,w=!0),w&&(x<i||x>s)&&(w=!1),w||(f&&s<=u?(C=((x=s)-y)/b,w=!0):!f&&u<=i&&(C=((x=i)-y)/b,w=!0)),w&&(m.isBound=!0,m.pos=C,m.offset=d-C,v.isBound=!0,v.pos=x,v.offset=u-x)}return{vertical:m,horizontal:v}}(e,t,n),i=o.horizontal,a=o.vertical,s=r?{horizontal:{isSnap:!1},vertical:{isSnap:!1}}:function(e,t,n){var r=Om(n,2),o=r[0],i=r[1],a=Om(t,2),s=a[0],l=a[1],d=Om(pg(n,t),2),u=d[0],c=d[1],p=c>0,h=u>0;u=yx(u),c=yx(c);var f={isSnap:!1,offset:0,pos:0},g={isSnap:!1,offset:0,pos:0};if(0===u&&0===c)return{vertical:f,horizontal:g};var m=fb(e,u?[o]:[],c?[i]:[]),v=m.vertical,b=m.horizontal;v.posInfos.filter((function(e){var t=e.pos;return h?t>=s:t<=s})),b.posInfos.filter((function(e){var t=e.pos;return p?t>=l:t<=l})),v.isSnap=v.posInfos.length>0,b.isSnap=b.posInfos.length>0;var y=bb(v),x=y.isSnap,C=y.guideline,w=bb(b),S=w.isSnap,Z=w.guideline,k=S?Z.pos[1]:0,M=x?C.pos[0]:0;if(0===u)S&&(g.isSnap=!0,g.pos=Z.pos[1],g.offset=i-g.pos);else if(0===c)x&&(f.isSnap=!0,f.pos=M,f.offset=o-M);else{var D=c/u,E=n[1]-D*o,R=0,T=0,_=!1;x?(R=D*(T=M)+E,_=!0):S&&(T=((R=k)-E)/D,_=!0),_&&(f.isSnap=!0,f.pos=T,f.offset=o-T,g.isSnap=!0,g.pos=R,g.offset=i-R)}return{vertical:f,horizontal:g}}(e,t,n),l=s.horizontal,d=s.vertical,u=Lb(i,l),c=Lb(a,d),p=Ix(u),h=Ix(c);return{horizontal:{isBound:i.isBound,isSnap:l.isSnap,offset:u,dist:p},vertical:{isBound:a.isBound,isSnap:d.isSnap,offset:c,dist:h}}}(e,d,u,o):Fb(e,o,{vertical:[u[0]],horizontal:[u[1]]}),p=c.horizontal,h=p.offset,f=p.isBound,g=p.isSnap,m=c.vertical,v=m.offset,b=m.isBound,y=m.isSnap,x=pg(l,s);if(!v&&!h)return{isBound:b||f,isSnap:y||g,sign:x,offset:[0,0]};var C=function(e,t,n,r){var o=Lf(e,t)/Math.PI*180,i=n.vertical,a=i.isBound,s=i.isSnap,l=i.dist,d=n.horizontal,u=d.isBound,c=d.isSnap,p=o%180,h=p<3||p>177,f=p>87&&p<93;return d.dist<l&&(a||s&&!f&&(!r||!h))?"vertical":!u&&(!c||h||r&&f)?"":"horizontal"}(d,u,c,r);if(!C)return{sign:x,isBound:!1,isSnap:!1,offset:[0,0]};var w="vertical"===C,S=[0,0];return S=(S=r||1!==Ix(l[0])||1!==Ix(l[1])||s[0]===l[0]||s[1]===l[1]?Ob(d,u,-(w?v:h),w,i).offset:xv({datas:i,distX:-v,distY:-h})).map((function(e,t){return e*(x[t]?2/x[t]:0)})),{sign:x,isBound:w?b:f,isSnap:w?y:g,offset:S}}))}function Lb(e,t){return e.isBound?e.offset:t.isSnap?t.offset:0}var Bb={name:"draggable",props:["draggable","throttleDrag","throttleDragRotate","hideThrottleDragRotateLine","startDragRotate","edgeDraggable"],events:["dragStart","drag","dragEnd","dragGroupStart","dragGroup","dragGroupEnd"],requestStyle:function(){return["left","top","right","bottom"]},requestChildStyle:function(){return["left","top","right","bottom"]},render:function(e,t){var n=e.props,r=n.hideThrottleDragRotateLine,o=n.throttleDragRotate,i=n.zoom,a=e.getState(),s=a.dragInfo,l=a.beforeOrigin;if(r||!o||!s)return[];var d=s.dist;if(!d[0]&&!d[1])return[];var u=Ay(d),c=Lf(d,[0,0]);return[t.createElement("div",{className:wy("line","horizontal","dragline","dashed"),key:"dragRotateGuideline",style:{width:"".concat(u,"px"),transform:"translate(".concat(l[0],"px, ").concat(l[1],"px) rotate(").concat(c,"rad) scaleY(").concat(i,")")}})]},dragStart:function(e,t){var n=t.datas,r=t.parentEvent,o=t.parentGesto,i=e.state,a=i.gestos,s=i.style;if(a.draggable)return!1;a.draggable=o||e.targetGesto,n.datas={},n.left=parseFloat(s.left||"")||0,n.top=parseFloat(s.top||"")||0,n.bottom=parseFloat(s.bottom||"")||0,n.right=parseFloat(s.right||"")||0,n.startValue=[0,0],fv(e,t),kv(e,t,"translate"),function(e,t){t.absolutePoses=ex(e.state)}(e,n),n.prevDist=[0,0],n.prevBeforeDist=[0,0],n.isDrag=!1,n.deltaOffset=[0,0];var l=ix(e,t,Im({set:function(e){n.startValue=e}},Zv(e,t)));return!1!==(r||lx(e,"onDragStart",l))?(n.isDrag=!0,e.state.dragInfo={startRect:e.getRect(),dist:[0,0]}):(a.draggable=null,n.isPinch=!1),!!n.isDrag&&l},drag:function(e,t){if(t){gv(e,t,"translate");var n=t.datas,r=t.parentEvent,o=t.parentFlag,i=t.isPinch,a=t.deltaOffset,s=t.useSnap,l=t.isRequest,d=t.distX,u=t.distY,c=n.isDrag,p=n.prevDist,h=n.prevBeforeDist,f=n.startValue;if(c){a&&(d+=a[0],u+=a[1]);var g=e.props,m=g.parentMoveable,v=r?0:g.throttleDrag||0,b=r?0:g.throttleDragRotate||0,y=0,x=!1,C=!1,w=!1,S=!1;if(!r&&b>0&&(d||u)){var Z=g.startDragRotate||0,k=jf(Z+180*Lf([0,0],[d,u])/Math.PI,b)-Z,M=u*Math.abs(Math.cos((k-90)/180*Math.PI)),D=Ay([d*Math.abs(Math.cos(k/180*Math.PI)),M]);y=k*Math.PI/180,d=D*Math.cos(y),u=D*Math.sin(y)}if(!i&&!r&&!o){var E=Om(zb(e,d,u,b,!s&&l||a,n),2),R=E[0],T=E[1];x=R.isSnap,C=R.isBound,w=T.isSnap,S=T.isBound,d+=R.offset,u+=T.offset}var _=cg(yv({datas:n,distX:d,distY:u}),f),I=cg(vv({datas:n,distX:d,distY:u}),f);Hf(I,nv),Hf(_,nv),b||(x||C||(I[0]=jf(I[0],v),_[0]=jf(_[0],v)),w||S||(I[1]=jf(I[1],v),_[1]=jf(_[1],v)));var O=pg(_,f),P=pg(I,f),z=pg(P,p),F=pg(O,h);n.prevDist=P,n.prevBeforeDist=O,n.passDelta=z,n.passDist=P;var N=n.left+O[0],$=n.top+O[1],L=n.right-O[0],B=n.bottom-O[1],A=mv(n,"translate(".concat(I[0],"px, ").concat(I[1],"px)"),"translate(".concat(P[0],"px, ").concat(P[1],"px)"));if(Dv(t,A),e.state.dragInfo.dist=r?[0,0]:P,r||m||!z.every((function(e){return!e}))||!F.some((function(e){return!e}))){var j=e.state,H=j.width,q=j.height,U=ix(e,t,Im({transform:A,dist:P,delta:z,translate:I,beforeDist:O,beforeDelta:F,beforeTranslate:_,left:N,top:$,right:L,bottom:B,width:H,height:q,isPinch:i},rx({transform:A},t)));return!r&&lx(e,"onDrag",U),U}}}},dragAfter:function(e,t){var n=t.datas,r=n.deltaOffset;return!(!r[0]&&!r[1])&&(n.deltaOffset=[0,0],this.drag(e,Im(Im({},t),{deltaOffset:r})))},dragEnd:function(e,t){var n=t.parentEvent,r=t.datas;if(e.state.dragInfo=null,r.isDrag){r.isDrag=!1;var o=ax(e,t,{});return!n&&lx(e,"onDragEnd",o),o}},dragGroupStart:function(e,t){var n=t.datas,r=t.clientX,o=t.clientY,i=this.dragStart(e,t);if(!i)return!1;var a=Uv(e,this,"dragStart",[r||0,o||0],t,!1,"draggable"),s=lx(e,"onDragGroupStart",Im(Im({},i),{targets:e.props.targets,events:a}));return n.isDrag=!1!==s,!!n.isDrag&&i},dragGroup:function(e,t){if(t.datas.isDrag){var n=this.drag(e,t),r=Uv(e,this,"drag",t.datas.passDelta,t,!1,"draggable");if(n){var o=Im({targets:e.props.targets,events:r},n);return lx(e,"onDragGroup",o),o}}},dragGroupEnd:function(e,t){var n=t.isDrag;if(t.datas.isDrag){this.dragEnd(e,t);var r=Uv(e,this,"dragEnd",[0,0],t,!1,"draggable");return lx(e,"onDragGroupEnd",ax(e,t,{targets:e.props.targets,events:r})),n}},request:function(e){var t={},n=e.getRect(),r=0,o=0,i=!1;return{isControl:!1,requestStart:function(e){return i=e.useSnap,{datas:t,useSnap:i}},request:function(e){return"x"in e?r=e.x-n.left:"deltaX"in e&&(r+=e.deltaX),"y"in e?o=e.y-n.top:"deltaY"in e&&(o+=e.deltaY),{datas:t,distX:r,distY:o,useSnap:i}},requestEnd:function(){return{datas:t,isDrag:!0,useSnap:i}}}},unset:function(e){e.state.gestos.draggable=null,e.state.dragInfo=null}};function Ab(e,t){return{fixedPosition:wv(e,t),fixedDirection:t,fixedOffset:[0,0]}}function jb(e,t){var n=e.allMatrix,r=e.is3d,o=e.width,i=e.height,a=r?4:3,s=function(e,t,n){return[t?e[0]/(t/2)-1:0,n?e[1]/(n/2)-1:0]}(t,o,i);return{fixedPosition:Ny(n,t,a),fixedDirection:s,fixedOffset:[o?0:t[0],i?0:t[1]]}}var Hb=Cx("resizable"),qb={name:"resizable",ableGroup:"size",canPinch:!0,props:["resizable","throttleResize","renderDirections","displayAroundControls","keepRatio","resizeFormat","keepRatioFinally","edge","checkResizableError"],events:["resizeStart","beforeResize","resize","resizeEnd","resizeGroupStart","beforeResizeGroup","resizeGroup","resizeGroupEnd"],render:Qv("resizable"),dragControlCondition:Hb,viewClassName:xx("resizable"),dragControlStart:function(e,t){var n,r=t.inputEvent,o=t.isPinch,i=t.isGroup,a=t.parentDirection,s=t.parentGesto,l=t.datas,d=t.parentFixedDirection,u=t.parentEvent,c=Xy(a,o,r,l),p=e.state,h=p.target,f=p.width,g=p.height,m=p.gestos;if(!c||!h)return!1;if(m.resizable)return!1;m.resizable=s||e.controlGesto,!o&&fv(e,t),l.datas={},l.direction=c,l.startOffsetWidth=f,l.startOffsetHeight=g,l.prevWidth=0,l.prevHeight=0,l.minSize=[0,0],l.startWidth=p.inlineCSSWidth||p.cssWidth,l.startHeight=p.inlineCSSHeight||p.cssHeight,l.maxSize=[1/0,1/0],i||(l.minSize=[p.minOffsetWidth,p.minOffsetHeight],l.maxSize=[p.maxOffsetWidth,p.maxOffsetHeight]);var v=e.props.transformOrigin||"% %";function b(e){l.ratio=e&&isFinite(e)?e:0}function y(e){var t=Ab(l.startPositions,e);l.fixedDirection=t.fixedDirection,l.fixedPosition=t.fixedPosition,l.fixedOffset=t.fixedOffset}function x(t){var n=jb(e.state,t);l.fixedDirection=n.fixedDirection,l.fixedPosition=n.fixedPosition,l.fixedOffset=n.fixedOffset}function C(e){l.minSize=[Pf("".concat(e[0]),0)||0,Pf("".concat(e[1]),0)||0]}function w(e){var t=[e[0]||1/0,e[1]||1/0];yf(t[0])&&!isFinite(t[0])||(t[0]=Pf("".concat(t[0]),0)||1/0),yf(t[1])&&!isFinite(t[1])||(t[1]=Pf("".concat(t[1]),0)||1/0),l.maxSize=t}l.transformOrigin=v&&bf(v)?v.split(" "):v,l.startOffsetMatrix=p.offsetMatrix,l.startTransformOrigin=p.transformOrigin,l.isWidth=null!==(n=null===t||void 0===t?void 0:t.parentIsWidth)&&void 0!==n?n:!c[0]&&!c[1]||c[0]||!c[1],l.startPositions=ex(e.state),b(f/g),y(d||[-c[0],-c[1]]),l.setFixedDirection=y,l.setFixedPosition=x,l.setMin=C,l.setMax=w;var S=ix(e,t,{direction:c,startRatio:l.ratio,set:function(e){var t=Om(e,2),n=t[0],r=t[1];l.startWidth=n,l.startHeight=r},setMin:C,setMax:w,setRatio:b,setFixedDirection:y,setFixedPosition:x,setOrigin:function(e){l.transformOrigin=e},dragStart:Bb.dragStart(e,(new cv).dragStart([0,0],t))}),Z=u||lx(e,"onResizeStart",S);return l.startFixedDirection=l.fixedDirection,l.startFixedPosition=l.fixedPosition,!1!==Z&&(l.isResize=!0,e.state.snapRenderInfo={request:t.isRequest,direction:c}),!!l.isResize&&S},dragControl:function(e,t){var n,r=t.datas,o=t.parentFlag,i=t.isPinch,a=t.parentKeepRatio,s=t.dragClient,l=t.parentDist,d=t.useSnap,u=t.isRequest,c=t.isGroup,p=t.parentEvent,h=t.resolveMatrix,f=r.isResize,g=r.transformOrigin,m=r.startWidth,v=r.startHeight,b=r.prevWidth,y=r.prevHeight,x=r.minSize,C=r.maxSize,w=r.ratio,S=r.startOffsetWidth,Z=r.startOffsetHeight,k=r.isWidth;if(f){if(h){var M=e.state.is3d,D=r.startOffsetMatrix,E=r.startTransformOrigin,R=M?4:3,T=Eg(Rv(t)),_=Math.sqrt(T.length);R!==_&&(T=lg(T,_,R));var I=Sv(D,T,E,R),O=$y(I,S,Z,R);r.startPositions=O,r.nextTargetMatrix=T,r.nextAllMatrix=I}var P=Uy(e.props,"resizable"),z=P.resizeFormat,F=P.throttleResize,N=void 0===F?o?0:1:F,$=P.parentMoveable,L=P.keepRatioFinally,B=r.direction,A=B,j=0,H=0;B[0]||B[1]||(A=[1,1]);var q=w&&(null!=a?a:P.keepRatio)||!1,U=Om(oe(),2),V=U[0],W=U[1];p||(r.setFixedDirection(r.fixedDirection),lx(e,"onBeforeResize",ix(e,t,{startFixedDirection:r.startFixedDirection,startFixedPosition:r.startFixedPosition,setFixedDirection:function(e){var t;return r.setFixedDirection(e),t=Om(oe(),2),V=t[0],W=t[1],[V,W]},setFixedPosition:function(e){var t;return r.setFixedPosition(e),t=Om(oe(),2),V=t[0],W=t[1],[V,W]},boundingWidth:V,boundingHeight:W,setSize:function(e){var t;t=Om(e,2),V=t[0],W=t[1]}},!0)));var G=s;s||(G=!o&&i?function(e,t){return wv(ex(e.state),t)}(e,[0,0]):r.fixedPosition);var K=[0,0];if(i||(K=function(e,t,n,r,o,i,a){if(!cb(e,"resizable"))return[0,0];var s=a.fixedDirection,l=a.nextAllMatrix,d=e.state,u=d.allMatrix,c=d.is3d;return cy(e,(function(e,r){return ly(l||u,t+e,n+r,s,o,c)}),t,n,r,o,i,a)}(e,V,W,B,G,!d&&u,r)),l&&(!l[0]&&(K[0]=0),!l[1]&&(K[1]=0)),q){A[0]&&A[1]&&K[0]&&K[1]&&(Ix(K[0])>Ix(K[1])?K[1]=0:K[0]=0);var Y=!K[0]&&!K[1];Y&&ie(),A[0]&&!A[1]||K[0]&&!K[1]||Y&&k?(V+=K[0],W=V/w):(!A[0]&&A[1]||!K[0]&&K[1]||Y&&!k)&&(W+=K[1],V=W*w)}else V+=K[0],W+=K[1],V=Math.max(0,V),W=Math.max(0,W);n=Om(Nf([V,W],x,C,!!q&&w),2),V=n[0],W=n[1],ie(),q&&(c||L)&&(k?W=V/w:V=W*w);var X=[(j=V-S)-b,(H=W-Z)-y];r.prevWidth=j,r.prevHeight=H;var Q=zv(e,V,W,G,g,r);if($||!X.every((function(e){return!e}))||!Q.every((function(e){return!e}))){var J=Bb.drag(e,uv(t,e.state,Q,!!i,!1,"draggable")),ee=J.transform,te=m+j,ne=v+H,re=ix(e,t,Im({width:te,height:ne,offsetWidth:Math.round(V),offsetHeight:Math.round(W),startRatio:w,boundingWidth:V,boundingHeight:W,direction:B,dist:[j,H],delta:X,isPinch:!!i,drag:J},ox({style:{width:"".concat(te,"px"),height:"".concat(ne,"px")},transform:ee},J,t)));return!p&&lx(e,"onResize",re),re}}function oe(){var e=r.fixedDirection,n=Mx(A,q,r,t);j=n.distWidth,H=n.distHeight;var o=A[0]-e[0]||q?Math.max(S+j,nv):S,i=A[1]-e[1]||q?Math.max(Z+H,nv):Z;return q&&S&&Z&&(k?i=o/w:o=i*w),[o,i]}function ie(){var e;z&&(e=Om(z([V,W]),2),V=e[0],W=e[1]),V=jf(V,N),W=jf(W,N)}},dragControlAfter:function(e,t){var n=t.datas,r=n.isResize,o=n.startOffsetWidth,i=n.startOffsetHeight,a=n.prevWidth,s=n.prevHeight;if(r&&!1!==e.props.checkResizableError){var l=e.state,d=l.width-(o+a),u=l.height-(i+s),c=Ix(d)>3,p=Ix(u)>3;return c&&(n.startWidth+=d,n.startOffsetWidth+=d,n.prevWidth+=d),p&&(n.startHeight+=u,n.startOffsetHeight+=u,n.prevHeight+=u),c||p?this.dragControl(e,t):void 0}},dragControlEnd:function(e,t){var n=t.datas,r=t.parentEvent;if(n.isResize){n.isResize=!1;var o=ax(e,t,{});return!r&&lx(e,"onResizeEnd",o),o}},dragGroupControlCondition:Hb,dragGroupControlStart:function(e,t){var n=t.datas,r=this.dragControlStart(e,Im(Im({},t),{isGroup:!0}));if(!r)return!1;var o=qv(e,"resizable",t),i=n.startOffsetWidth,a=n.startOffsetHeight;function s(){var e=n.minSize;o.forEach((function(t){var n=t.datas,r=n.minSize,o=n.startOffsetWidth,s=n.startOffsetHeight,l=i*(o?r[0]/o:0),d=a*(s?r[1]/s:0);e[0]=Math.max(e[0],l),e[1]=Math.max(e[1],d)}))}function l(){var e=n.maxSize;o.forEach((function(t){var n=t.datas,r=n.maxSize,o=n.startOffsetWidth,s=n.startOffsetHeight,l=i*(o?r[0]/o:0),d=a*(s?r[1]/s:0);e[0]=Math.min(e[0],l),e[1]=Math.min(e[1],d)}))}var d=Vv(e,this,"dragControlStart",t,(function(t,r){return Wv(e,t,n,r)}));s(),l();var u=function(t){r.setFixedDirection(t),d.forEach((function(r,i){r.setFixedDirection(t),Wv(e,r.moveable,n,o[i])}))};n.setFixedDirection=u;var c=Im(Im({},r),{targets:e.props.targets,events:d.map((function(e){return Im(Im({},e),{setMin:function(t){e.setMin(t),s()},setMax:function(t){e.setMax(t),l()}})})),setFixedDirection:u,setMin:function(e){r.setMin(e),s()},setMax:function(e){r.setMax(e),l()}}),p=lx(e,"onResizeGroupStart",c);return n.isResize=!1!==p,!!n.isResize&&r},dragGroupControl:function(e,t){var n=t.datas;if(n.isResize){var r=Uy(e.props,"resizable");sx(e,"onBeforeResize",(function(n){lx(e,"onBeforeResizeGroup",ix(e,t,Im(Im({},n),{targets:r.targets}),!0))}));var o=this.dragControl(e,Im(Im({},t),{isGroup:!0}));if(o){var i=o.boundingWidth,a=o.boundingHeight,s=o.dist,l=r.keepRatio,d=[i/(i-s[0]),a/(a-s[1])],u=n.fixedPosition,c=Vv(e,this,"dragControl",t,(function(t,n){var r=Om(fg(wg(e.rotation/180*Math.PI,3),[n.datas.originalX*d[0],n.datas.originalY*d[1],1],3),2),o=r[0],i=r[1];return Im(Im({},n),{parentDist:null,parentScale:d,dragClient:cg(u,[o,i]),parentKeepRatio:l})})),p=Im({targets:r.targets,events:c},o);return lx(e,"onResizeGroup",p),p}}},dragGroupControlEnd:function(e,t){var n=t.isDrag;if(t.datas.isResize){this.dragControlEnd(e,t);var r=Vv(e,this,"dragControlEnd",t);return lx(e,"onResizeGroupEnd",ax(e,t,{targets:e.props.targets,events:r})),n}},request:function(e){var t={},n=0,r=0,o=!1,i=e.getRect();return{isControl:!0,requestStart:function(e){var n;return o=e.useSnap,{datas:t,parentDirection:e.direction||[1,1],parentIsWidth:null===(n=null===e||void 0===e?void 0:e.horizontal)||void 0===n||n,useSnap:o}},request:function(e){return"offsetWidth"in e?n=e.offsetWidth-i.offsetWidth:"deltaWidth"in e&&(n+=e.deltaWidth),"offsetHeight"in e?r=e.offsetHeight-i.offsetHeight:"deltaHeight"in e&&(r+=e.deltaHeight),{datas:t,parentDist:[n,r],parentKeepRatio:e.keepRatio,useSnap:o}},requestEnd:function(){return{datas:t,isDrag:!0,useSnap:o}}}},unset:function(e){e.state.gestos.resizable=null}};function Ub(e,t,n,r,o){var i=e.props.groupable,a=e.state,s=a.is3d?4:3,l=t.origin,d=Ny(e.state.rootMatrix,pg([l[0],l[1]],i?[0,0]:[a.left,a.top]),s),u=cg([o.left,o.top],d);t.startAbsoluteOrigin=u,t.prevDeg=Lf(u,[n,r])/Math.PI*180,t.defaultDeg=t.prevDeg,t.prevSnapDeg=0,t.loop=0,t.startDist=Af(u,[n,r])}function Vb(e,t,n){var r=n.defaultDeg,o=n.prevDeg,i=o%360,a=Math.floor(o/360);i<0&&(i+=360),i>e&&i>270&&e<90?++a:i<e&&i<90&&e>270&&--a;var s=t*(360*a+e-r);return n.prevDeg=r+s,s}function Wb(e,t,n,r){return Vb(Lf(r.startAbsoluteOrigin,[e,t])/Math.PI*180,n,r)}function Gb(e,t,n,r,o,i){var a=e.props.throttleRotate,s=void 0===a?0:a,l=n.prevSnapDeg,d=0,u=!1;if(i){var c=function(e,t,n,r){var o,i=e.props,a=null!==(o=i[yy])&&void 0!==o?o:5,s=i[xy];if(cb(e,"rotatable")){var l=t.pos1,d=t.pos2,u=t.pos3,c=t.pos4,p=t.origin,h=n*Math.PI/180,f=[l,d,u,c].map((function(e){return pg(e,p)})),g=f.map((function(e){return yg(e,h)})),m=Pm(Pm([],Om(ib(e,f,g,p,n)),!1),Om(Ib(e,f,g,p,n)),!1);m.sort((function(e,t){return Ix(e-n)-Ix(t-n)}));var v=m.length>0;if(v)return{isSnap:v,dist:v?m[0]:n}}if((null===s||void 0===s?void 0:s.length)&&a){var b=s.slice().sort((function(e,t){return fy(e,r)-fy(t,r)}))[0];if(fy(b,r)<=a)return{isSnap:!0,dist:n+hy(r,b)-r}}return{isSnap:!1,dist:n}}(e,t,r,o+r);u=c.isSnap,d=o+c.dist}u||(d=jf(o+r,s));var p=d-o;return n.prevSnapDeg=p,[p-l,p,d]}function Kb(e,t,n){var r=Om(t,4),o=r[0],i=r[1],a=r[2],s=r[3];if("none"===e)return[];if(vf(e))return e.map((function(e){return Kb(e,[o,i,a,s],n)[0]}));var l=Om((e||"top").split("-"),2),d=l[0],u=l[1],c=[o,i];"left"===d?c=[a,o]:"right"===d?c=[i,s]:"bottom"===d&&(c=[s,a]);var p=[(c[0][0]+c[1][0])/2,(c[0][1]+c[1][1])/2],h=Wy(c,n);if(u){var f="top"===u||"left"===u,g="bottom"===d||"left"===d;p=c[f&&!g||!f&&g?0:1]}return[[p,h]]}function Yb(e,t){if(t.isRequest)return"rotatable"===t.requestAble;var n=t.inputEvent.target;if(qf(n,wy("rotation-control"))||e.props.rotateAroundControls&&qf(n,wy("around-control"))||qf(n,wy("control"))&&qf(n,wy("rotatable")))return!0;var r=e.props.rotationTarget;return!!r&&Sx(r,!0).some((function(e){return!!e&&(n===e||n.contains(e))}))}var Xb={name:"rotatable",canPinch:!0,props:["rotatable","rotationPosition","throttleRotate","renderDirections","rotationTarget","rotateAroundControls","edge","resolveAblesWithRotatable","displayAroundControls"],events:["rotateStart","beforeRotate","rotate","rotateEnd","rotateGroupStart","beforeRotateGroup","rotateGroup","rotateGroupEnd"],css:[".rotation {\nposition: absolute;\nheight: 40px;\nwidth: 1px;\ntransform-origin: 50% 100%;\nheight: calc(40px * var(--zoom));\ntop: auto;\nleft: 0;\nbottom: 100%;\nwill-change: transform;\n}\n.rotation .rotation-line {\ndisplay: block;\nwidth: 100%;\nheight: 100%;\ntransform-origin: 50% 50%;\n}\n.rotation .rotation-control {\nborder-color: #4af;\nborder-color: var(--moveable-color);\nbackground:#fff;\ncursor: alias;\n}\n:global .view-rotation-dragging, .rotatable.direction.control {\ncursor: alias;\n}\n.rotatable.direction.control.move {\ncursor: move;\n}\n"],viewClassName:function(e){return e.isDragging("rotatable")?wy("view-rotation-dragging"):""},render:function(e,t){var n=Uy(e.props,"rotatable"),r=n.rotatable,o=n.rotationPosition,i=n.zoom,a=n.renderDirections,s=n.rotateAroundControls,l=n.resolveAblesWithRotatable,d=e.getState(),u=d.renderPoses,c=d.direction;if(!r)return null;var p=Kb(o,u,c),h=[];if(p.forEach((function(e,n){var r=Om(e,2),o=r[0],a=r[1];h.push(t.createElement("div",{key:"rotation".concat(n),className:wy("rotation"),style:{transform:"translate(-50%) translate(".concat(o[0],"px, ").concat(o[1],"px) rotate(").concat(a,"rad)")}},t.createElement("div",{className:wy("line rotation-line"),style:{transform:"scaleX(".concat(i,")")}}),t.createElement("div",{className:wy("control rotation-control"),style:{transform:"translate(0.5px) scale(".concat(i,")")}})))})),a){var f=Of(l||{}),g={};f.forEach((function(e){l[e].forEach((function(t){g[t]=e}))}));var m=[];vf(a)&&(m=a.map((function(e){var t=g[e];return{data:t?{resolve:t}:{},classNames:t?["move"]:[],dir:e}}))),h.push.apply(h,Pm([],Om(Gv(e,"rotatable",m,t)),!1))}return s&&h.push.apply(h,Pm([],Om(eb(e,t)),!1)),h},dragControlCondition:Yb,dragControlStart:function(e,t){var n,r,o=t.datas,i=t.clientX,a=t.clientY,s=t.parentRotate,l=t.parentFlag,d=t.isPinch,u=t.isRequest,c=e.state,p=c.target,h=c.left,f=c.top,g=c.direction,m=c.beforeDirection,v=c.targetTransform,b=c.moveableClientRect,y=c.offsetMatrix,x=c.targetMatrix,C=c.allMatrix,w=c.width,S=c.height;if(!u&&!p)return!1;var Z=e.getRect();o.rect=Z,o.transform=v,o.left=h,o.top=f;var k=function(t){var n=jb(e.state,t);o.fixedDirection=n.fixedDirection,o.fixedOffset=n.fixedOffset,o.fixedPosition=n.fixedPosition,N&&N.setFixedPosition(t)},M=function(t){var n=function(e,t){var n=e.allMatrix,r=e.is3d,o=e.width,i=e.height,a=r?4:3;return{fixedPosition:Ny(n,[o/2*(1+t[0]),i/2*(1+t[1])],a),fixedDirection:t,fixedOffset:[0,0]}}(e.state,t);o.fixedDirection=n.fixedDirection,o.fixedOffset=n.fixedOffset,o.fixedPosition=n.fixedPosition,N&&N.setFixedDirection(t)},D=i,E=a;if(u||d||l){var R=s||0;o.beforeInfo={origin:Z.beforeOrigin,prevDeg:R,defaultDeg:R,prevSnapDeg:0,startDist:0},o.afterInfo=Im(Im({},o.beforeInfo),{origin:Z.origin}),o.absoluteInfo=Im(Im({},o.beforeInfo),{origin:Z.origin,startValue:R})}else{var T=null===(r=t.inputEvent)||void 0===r?void 0:r.target;if(T){var _=T.getAttribute("data-direction")||"",I=av[_];if(I){o.isControl=!0,o.isAroundControl=qf(T,wy("around-control")),o.controlDirection=I;var O=T.getAttribute("data-resolve");O&&(o.resolveAble=O);var P=function(e,t,n){var r=16===e.length?4:3,o=t.map((function(t){return Ny(e,t,r)})),i=n.left,a=n.top;return o.map((function(e){return[e[0]+i,e[1]+a]}))}(c.rootMatrix,c.renderPoses,b);n=Om(wv(P,I),2),D=n[0],E=n[1]}}o.beforeInfo={origin:Z.beforeOrigin},o.afterInfo={origin:Z.origin},o.absoluteInfo={origin:Z.origin,startValue:Z.rotation};var z=k;k=function(t){var n=c.is3d?4:3,r=Om(cg(ag(x,n),t),2),i=r[0],a=r[1],s=fg(y,sg([i,a],n)),l=fg(C,sg([t[0],t[1]],n));z(t);var d=c.posDelta;o.beforeInfo.origin=pg(s,d),o.afterInfo.origin=pg(l,d),o.absoluteInfo.origin=pg(l,d),Ub(e,o.beforeInfo,D,E,b),Ub(e,o.afterInfo,D,E,b),Ub(e,o.absoluteInfo,D,E,b)},M=function(e){var t=wv([[0,0],[w,0],[0,S],[w,S]],e);k(t)}}o.startClientX=D,o.startClientY=E,o.direction=g,o.beforeDirection=m,o.startValue=0,o.datas={},kv(e,t,"rotate");var F=!1,N=!1;o.isControl&&o.resolveAble&&("resizable"===o.resolveAble&&(N=qb.dragControlStart(e,Im(Im({},new cv("resizable").dragStart([0,0],t)),{parentPosition:o.controlPosition,parentFixedPosition:o.fixedPosition}))));N||(F=Bb.dragStart(e,(new cv).dragStart([0,0],t))),k(function(e){var t=e.props,n=t.groupable,r=t.svgOrigin,o=e.getState(),i=o.offsetWidth,a=o.offsetHeight,s=o.svg,l=o.transformOrigin;if(!n&&s&&r)return Ex(r,i,a);return l}(e));var $=ix(e,t,Im(Im({set:function(e){o.startValue=e*Math.PI/180},setFixedDirection:M,setFixedPosition:k},Zv(e,t)),{dragStart:F,resizeStart:N})),L=lx(e,"onRotateStart",$);return o.isRotate=!1!==L,c.snapRenderInfo={request:t.isRequest},!!o.isRotate&&$},dragControl:function(e,t){var n,r,o,i=t.datas,a=t.clientDistX,s=t.clientDistY,l=t.parentRotate,d=t.parentFlag,u=t.isPinch,c=t.groupDelta,p=t.resolveMatrix,h=i.beforeDirection,f=i.beforeInfo,g=i.afterInfo,m=i.absoluteInfo,v=i.isRotate,b=i.startValue,y=i.rect,x=i.startClientX,C=i.startClientY;if(v){gv(e,t,"rotate");var w,S,Z,k,M,D,E,R,T,_=function(e){return pv(e.datas.beforeTransform,[50,50],100,100).direction}(t),I=h*_,O=e.props.parentMoveable,P=180/Math.PI*b,z=m.startValue,F=!1,N=x+a,$=C+s;if(!d&&"parentDist"in t){var L=t.parentDist;S=L,M=L,R=L}else u||d?(S=Vb(l,h,f),M=Vb(l,I,g),R=Vb(l,I,m)):(S=Wb(N,$,h,f),M=Wb(N,$,I,g),R=Wb(N,$,I,m),F=!0);if(lx(e,"onBeforeRotate",ix(e,t,{beforeRotation:Z=P+S,rotation:D=P+M,absoluteRotation:T=z+R,setRotation:function(e){S=M=e-P,R=M}},!0)),w=(n=Om(Gb(e,y,f,S,P,F),3))[0],S=n[1],Z=n[2],k=(r=Om(Gb(e,y,g,M,P,F),3))[0],M=r[1],D=r[2],E=(o=Om(Gb(e,y,m,R,z,F),3))[0],R=o[1],T=o[2],E||k||w||O||p){var B=mv(i,"rotate(".concat(D,"deg)"),"rotate(".concat(M,"deg)"));p&&(i.fixedPosition=Ov(e,i.targetAllTransform,i.fixedDirection,i.fixedOffset,i));var A=function(e,t,n){var r=n.fixedDirection,o=n.fixedPosition,i=n.fixedOffset;return Pv(e,"rotate(".concat(t,"deg)"),r,o,i,n)}(e,M,i),j=pg(cg(c||[0,0],A),i.prevInverseDist||[0,0]);i.prevInverseDist=A,i.requestValue=null;var H=Iv(e,B,j,u,t),q=H,U=Af([N,$],m.startAbsoluteOrigin)-m.startDist,V=void 0;if("resizable"===i.resolveAble){var W=qb.dragControl(e,Im(Im({},uv(t,e.state,[t.deltaX,t.deltaY],!!u,!1,"resizable")),{resolveMatrix:!0,parentDistance:U}));W&&(V=W,q=ox(q,W,t))}var G=ix(e,t,Im(Im({delta:k,dist:M,rotate:D,rotation:D,beforeDist:S,beforeDelta:w,beforeRotate:Z,beforeRotation:Z,absoluteDist:R,absoluteDelta:E,absoluteRotate:T,absoluteRotation:T,isPinch:!!u,resize:V},H),q));return lx(e,"onRotate",G),G}}},dragControlEnd:function(e,t){var n=t.datas;if(n.isRotate){n.isRotate=!1;var r=ax(e,t,{});return lx(e,"onRotateEnd",r),r}},dragGroupControlCondition:Yb,dragGroupControlStart:function(e,t){var n=t.datas,r=e.state,o=r.left,i=r.top,a=r.beforeOrigin,s=this.dragControlStart(e,t);if(!s)return!1;s.set(n.beforeDirection*e.rotation);var l=Vv(e,this,"dragControlStart",t,(function(e,t){var n=e.state,r=n.left,s=n.top,l=n.beforeOrigin,d=cg(pg([r,s],[o,i]),pg(l,a));return t.datas.startGroupClient=d,t.datas.groupClient=d,Im(Im({},t),{parentRotate:0})})),d=lx(e,"onRotateGroupStart",Im(Im({},s),{targets:e.props.targets,events:l}));return n.isRotate=!1!==d,!!n.isRotate&&s},dragGroupControl:function(e,t){var n=t.datas;if(n.isRotate){sx(e,"onBeforeRotate",(function(n){lx(e,"onBeforeRotateGroup",ix(e,t,Im(Im({},n),{targets:e.props.targets}),!0))}));var r=this.dragControl(e,t);if(r){var o=n.beforeDirection,i=r.beforeDist,a=i/180*Math.PI,s=Vv(e,this,"dragControl",t,(function(e,t){var n=t.datas.startGroupClient,r=Om(t.datas.groupClient,2),s=r[0],l=r[1],d=Om(yg(n,a*o),2),u=d[0],c=d[1],p=[u-s,c-l];return t.datas.groupClient=[u,c],Im(Im({},t),{parentRotate:i,groupDelta:p})}));e.rotation=o*r.beforeRotation;var l=Im({targets:e.props.targets,events:s,set:function(t){e.rotation=t},setGroupRotation:function(t){e.rotation=t}},r);return lx(e,"onRotateGroup",l),l}}},dragGroupControlEnd:function(e,t){var n=t.isDrag;if(t.datas.isRotate){this.dragControlEnd(e,t);var r=Vv(e,this,"dragControlEnd",t);return lx(e,"onRotateGroupEnd",ax(e,t,{targets:e.props.targets,events:r})),n}},request:function(e){var t={},n=0,r=e.getRotation();return{isControl:!0,requestStart:function(){return{datas:t}},request:function(e){return"deltaRotate"in e?n+=e.deltaRotate:"rotate"in e&&(n=e.rotate-r),{datas:t,parentDist:n}},requestEnd:function(){return{datas:t,isDrag:!0}}}}};function Qb(e,t){return function(e,t){var n,r=e.direction,o=e.classNames,i=e.size,a=e.pos,s=e.zoom,l=e.key,d="horizontal"===r,u=d?"Y":"X";return t.createElement("div",{key:l,className:o.join(" "),style:(n={},n[d?"width":"height"]="".concat(i),n.transform="translate(".concat(a[0],", ").concat(a[1],") translate").concat(u,"(-50%) scale").concat(u,"(").concat(s,")"),n)})}(Im(Im({},e),{classNames:Pm([wy("line","guideline",e.direction)],Om(e.classNames),!1).filter((function(e){return e})),size:e.size||"".concat(e.sizeValue,"px"),pos:e.pos||e.posValue.map((function(e){return"".concat(jf(e,.1),"px")}))}),t)}function Jb(e,t,n,r,o,i,a,s){var l=e.props.zoom;return n.map((function(e,n){var d=e.type,u=e.pos,c=[0,0];return c[a]=r,c[a?0:1]=-o+u,Qb({key:"".concat(t,"TargetGuideline").concat(n),classNames:[wy("target","bold",d)],posValue:c,sizeValue:i,zoom:l,direction:t},s)}))}function ey(e,t,n,r,o,i){var a=e.props,s=a.zoom,l=a.isDisplayInnerSnapDigit,d="horizontal"===t?db:ub,u=o[d.start],c=o[d.end];return n.filter((function(e){var t=e.hide,n=e.elementRect;if(t)return!1;if(l&&n){var r=n.rect;if(r[d.start]<=u&&c<=r[d.end])return!1}return!0})).map((function(e,n){var o=e.pos,a=e.size,l=e.element,d=e.className,u=[-r[0]+o[0],-r[1]+o[1]];return Qb({key:"".concat(t,"-default-guideline-").concat(n),classNames:l?[wy("bold"),d]:[wy("normal"),d],direction:t,posValue:u,sizeValue:a,zoom:s},i)}))}function ty(e,t,n,r,o,i,a,s){var l,d=e.props,u=d.snapDigit,c=void 0===u?0:u,p=d.isDisplaySnapDigit,h=void 0===p||p,f=d.snapDistFormat,g=void 0===f?function(e,t){return e}:f,m=d.zoom,v="horizontal"===t?"X":"Y",b="vertical"===t?"height":"width",y=Math.abs(o),x=h?parseFloat(y.toFixed(c)):0;return s.createElement("div",{key:"".concat(t,"-").concat(n,"-guideline-").concat(r),className:wy("guideline-group",t),style:(l={left:"".concat(i[0],"px"),top:"".concat(i[1],"px")},l[b]="".concat(y,"px"),l)},Qb({direction:t,classNames:[wy(n),a],size:"100%",posValue:[0,0],sizeValue:y,zoom:m},s),s.createElement("div",{className:wy("size-value","gap"),style:{transform:"translate".concat(v,"(-50%) scale(").concat(m,")")}},x>0?g(x,t):""))}function ny(e,t,n,r,o){var i=e.props.isDisplayInnerSnapDigit,a=[];return["vertical","horizontal"].forEach((function(s){var l=t.filter((function(e){return e.type===s})),d="vertical"===s?1:0,u=d?0:1,c=function(e,t,n,r){var o="vertical"===e?0:1,i="vertical"===e?1:0,a=o?db:ub,s=n[a.start],l=n[a.end];return px(t,(function(e){return e.pos[o]})).map((function(t){var n=[],d=[];return t.forEach((function(t){var u,c,p=t.element,h=t.elementRect.rect;if(h[a.end]<s)n.push(t);else if(l<h[a.start])d.push(t);else if(h[a.start]<=s&&l<=h[a.end]&&r){var f=t.pos,g={element:p,rect:Im(Im({},h),(u={},u[a.end]=h[a.start],u))},m={element:p,rect:Im(Im({},h),(c={},c[a.start]=h[a.end],c))},v=[0,0],b=[0,0];v[o]=f[o],v[i]=f[i],b[o]=f[o],b[i]=f[i]+t.size,n.push({type:e,pos:v,size:0,elementRect:g,direction:"",elementDirection:"end"}),d.push({type:e,pos:b,size:0,elementRect:m,direction:"",elementDirection:"start"})}})),n.sort((function(e,t){return t.pos[i]-e.pos[i]})),d.sort((function(e,t){return e.pos[i]-t.pos[i]})),{total:t,start:n,end:d,inner:[]}}))}(s,l,r,i),p=d?ub:db,h=d?db:ub,f=r[p.start],g=r[p.end];c.forEach((function(t){var i=t.total,l=t.start,c=t.end,m=t.inner,v=n[u]+i[0].pos[u]-r[h.start],b=r;l.forEach((function(t){var r=t.elementRect.rect,i=b[p.start]-r[p.end];if(i>0){var l=[0,0];l[d]=n[d]+b[p.start]-f-i,l[u]=v,a.push(ty(e,s,"dashed",a.length,i,l,t.className,o))}b=r})),b=r,c.forEach((function(t){var r=t.elementRect.rect,i=r[p.start]-b[p.end];if(i>0){var l=[0,0];l[d]=n[d]+b[p.end]-f,l[u]=v,a.push(ty(e,s,"dashed",a.length,i,l,t.className,o))}b=r})),m.forEach((function(t){var r=t.elementRect.rect,i=f-r[p.start],l=r[p.end]-g,c=[0,0],h=[0,0];c[d]=n[d]-i,c[u]=v,h[d]=n[d]+g-f,h[u]=v,a.push(ty(e,s,"dashed",a.length,i,c,t.className,o)),a.push(ty(e,s,"dashed",a.length,l,h,t.className,o))}))}))})),a}function ry(e){var t=e.state,n=t.containerClientRect,r=t.hasFixed,o=n.overflow,i=n.scrollHeight,a=n.scrollWidth,s=n.clientHeight,l=n.clientWidth,d=n.clientLeft,u=n.clientTop,c=e.props,p=c.snapGap,h=void 0===p||p,f=c.verticalGuidelines,g=c.horizontalGuidelines,m=c.snapThreshold,v=void 0===m?5:m,b=c.snapGridWidth,y=void 0===b?0:b,x=c.snapGridHeight,C=void 0===x?0:x,w=c.maxSnapElementGuidelineDistance,S=void 0===w?1/0:w,Z=c.isDisplayGridGuidelines,k=Ly(ex(e.state)),M=k.top,D=k.left,E=k.bottom,R=k.right,T={top:M,left:D,bottom:E,right:R,center:(D+R)/2,middle:(M+E)/2},_=function(e){var t=e.state,n=e.props.elementGuidelines,r=void 0===n?[]:n;if(!r.length)return t.elementRects=[],[];var o=(t.elementRects||[]).filter((function(e){return!e.refresh})),i=r.map((function(e){return mf(e)&&"element"in e?Im(Im({},e),{element:wx(e.element,!0)}):{element:wx(e,!0)}})).filter((function(e){return e.element})),a=function(e,t){return Fg(e,t,Bg)}(o.map((function(e){return e.element})),i.map((function(e){return e.element}))),s=a.maintained,l=a.added,d=[];s.forEach((function(e){var t=Om(e,2),n=t[0],r=t[1];d[r]=o[n]})),function(e,t){if(!t.length)return[];var n=e.props.groupable,r=e.state,o=r.containerClientRect,i=r.rootMatrix,a=r.is3d,s=r.offsetDelta,l=a?4:3,d=Om(function(e,t,n){var r=Ny(e,[t.clientLeft,t.clientTop],n);return[t.left+r[0],t.top+r[1]]}(i,o,l),2),u=d[0],c=d[1],p=n?0:s[0],h=n?0:s[1];return t.map((function(e){var t=e.element.getBoundingClientRect(),n=t.left-u-p,r=t.top-c-h,o=r+t.height,a=n+t.width,s=Om(gx(i,[n,r],l),2),d=s[0],f=s[1],g=Om(gx(i,[a,o],l),2),m=g[0],v=g[1];return Im(Im({},e),{rect:{left:d,right:m,top:f,bottom:v,center:(d+m)/2,middle:(f+v)/2}})}))}(e,l.map((function(e){return i[e]}))).map((function(e,t){d[l[t]]=e})),t.elementRects=d;var u=pb(e.props.elementSnapDirections),c=[];return d.forEach((function(e){var t=e.element,n=e.top,r=void 0===n?u.top:n,o=e.left,i=void 0===o?u.left:o,a=e.right,s=void 0===a?u.right:a,l=e.bottom,d=void 0===l?u.bottom:l,p=e.center,h=void 0===p?u.center:p,f=e.middle,g=void 0===f?u.middle:f,m=e.className,v=e.rect,b=hb({top:r,right:s,left:i,bottom:d,center:h,middle:g},v),y=b.horizontal,x=b.vertical,C=b.horizontalNames,w=b.verticalNames,S=v.top,Z=v.left,k=v.right-Z,M=v.bottom-S,D=[k,M];x.forEach((function(n,r){c.push({type:"vertical",element:t,pos:[jf(n,.1),S],size:M,sizes:D,className:m,elementRect:e,elementDirection:lb[w[r]]||w[r],direction:""})})),y.forEach((function(n,r){c.push({type:"horizontal",element:t,pos:[Z,jf(n,.1)],size:k,sizes:D,className:m,elementRect:e,elementDirection:lb[C[r]]||C[r],direction:""})}))})),c}(e),I=Pm([],Om(_),!1);h&&I.push.apply(I,Pm([],Om(function(e,t,n){var r=e.props,o=r.maxSnapElementGuidelineDistance,i=void 0===o?1/0:o,a=r.maxSnapElementGapDistance,s=void 0===a?1/0:a,l=e.state.elementRects,d=[];return[["vertical",db,ub],["horizontal",ub,db]].forEach((function(e){var r=Om(e,3),o=r[0],a=r[1],u=r[2],c=t[a.start],p=t[a.end],h=t[a.center],f=t[u.start],g=t[u.end];function m(e){var t=e.rect;return t[a.end]<c+n?c-t[a.end]:p-n<t[a.start]?t[a.start]-p:-1}var v=l.filter((function(e){var t=e.rect;return!(t[u.start]>g||t[u.end]<f)&&m(e)>0})).sort((function(e,t){return m(e)-m(t)})),b=[];v.forEach((function(e){v.forEach((function(t){if(e!==t){var n=e.rect,r=t.rect,o=n[u.start],i=n[u.end],a=r[u.start];o>r[u.end]||a>i||b.push([e,t])}}))})),b.forEach((function(e){var r=Om(e,2),l=r[0],u=r[1],f=l.rect,g=u.rect,m=f[a.start],v=f[a.end],b=g[a.start],y=g[a.end],x=0,C=0,w=!1,S=!1,Z=!1;if(v<=c&&p<=b){if(S=!0,Ix((C=v+(x=(b-v-(p-c))/2)+(p-c)/2)-h)>n)return}else if(v<b&&y<c+n){if(w=!0,Ix((C=y+(x=b-v))-c)>n)return}else{if(!(v<b&&p-n<m))return;if(Z=!0,Ix((C=m-(x=b-v))-p)>n)return}x&&oy(t,g,o,i)&&(x>s||d.push({type:o,pos:"vertical"===o?[C,0]:[0,C],element:u.element,size:0,className:u.className,isStart:w,isCenter:S,isEnd:Z,gap:x,hide:!0,gapRects:[l,u],direction:"",elementDirection:""}))}))})),d}(e,T,v)),!1));var O=Im({},t.snapOffset||{left:0,top:0,bottom:0,right:0});if(I.push.apply(I,Pm([],Om(function(e,t,n,r,o,i,a,s){void 0===o&&(o=0);void 0===i&&(i=0);var l=[],d=a.left,u=a.top;if(t)for(var c=0;c<=r;c+=t)l.push({type:"horizontal",pos:[d,jf(c-i+u,.1)],className:wy("grid-guideline"),size:n,hide:!s,direction:""});if(e)for(c=0;c<=n;c+=e)l.push({type:"vertical",pos:[jf(c-o+d,.1),u],className:wy("grid-guideline"),size:r,hide:!s,direction:""});return l}(y,C,o?a:l,o?i:s,d,u,O,Z)),!1)),r){var P=n.left,z=n.top;O.left+=P,O.top+=z,O.right+=P,O.bottom+=z}return I.push.apply(I,Pm([],Om(ay(g||!1,f||!1,o?a:l,o?i:s,d,u,O)),!1)),I=I.filter((function(e){var t=e.element,n=e.elementRect,r=e.type;if(!t||!n)return!0;var o=n.rect;return oy(T,o,r,S)})),I}function oy(e,t,n,r){return"horizontal"===n?Ix(e.right-t.left)<=r||Ix(e.left-t.right)<=r||e.left<=t.right&&t.left<=e.right:"vertical"!==n||(Ix(e.bottom-t.top)<=r||Ix(e.top-t.bottom)<=r||e.top<=t.bottom&&t.top<=e.bottom)}function iy(e,t){return e?e.map((function(e){var n=mf(e)?e:{pos:e},r=n.pos;return yf(r)?n:Im(Im({},n),{pos:Pf(r,t)})})):[]}function ay(e,t,n,r,o,i,a){void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a={left:0,top:0,right:0,bottom:0});var s=[],l=a.left,d=a.top,u=a.bottom,c=n+a.right-l,p=r+u-d;return iy(e,p).forEach((function(e){s.push({type:"horizontal",pos:[l,jf(e.pos-i+d,.1)],size:c,className:e.className,direction:""})})),iy(t,c).forEach((function(e){s.push({type:"vertical",pos:[jf(e.pos-o+l,.1),d],size:p,className:e.className,direction:""})})),s}function sy(e){var t=e.state,n=t.container,r=e.props.snapContainer||n;if(t.snapContainer===r&&t.guidelines&&t.guidelines.length)return!1;var o=t.containerClientRect,i={left:0,top:0,bottom:0,right:0};if(n!==r){var a=wx(r,!0);if(a){var s=Yy(a),l=Zx(t,[s.left-o.left,s.top-o.top]),d=Zx(t,[s.right-o.right,s.bottom-o.bottom]);i.left=jf(l[0],1e-5),i.top=jf(l[1],1e-5),i.right=jf(d[0],1e-5),i.bottom=jf(d[1],1e-5)}}return t.snapContainer=r,t.snapOffset=i,t.guidelines=ry(e),t.enableSnap=!0,!0}function ly(e,t,n,r,o,i){var a=$y(e,t,n,i?4:3);return Jy(a,pg(o,wv(a,r)))}function dy(e){return e?e/Ix(e):0}function uy(e,t,n,r,o,i){var a=function(e,t,n){var r=[];if(n)1!==Ix(t[0])||1!==Ix(t[1])?r.push([t,[-1,-1]],[t,[-1,1]],[t,[1,-1]],[t,[1,1]]):r.push([t,[e[0],-e[1]]],[t,[-e[0],e[1]]]),r.push([t,e]);else if(e[0]&&e[1]||!e[0]&&!e[1]){var o=e[0]?e:[1,1];[1,-1].forEach((function(e){[1,-1].forEach((function(n){var i=[e*o[0],n*o[1]];t[0]===i[0]&&t[1]===i[1]||r.push([t,i])}))}))}else e[0]?(1===Ix(t[0])?[1]:[1,-1]).forEach((function(n){r.push([[t[0],-1],[n*e[0],-1]],[[t[0],0],[n*e[0],0]],[[t[0],1],[n*e[0],1]])})):e[1]&&(1===Ix(t[1])?[1]:[1,-1]).forEach((function(n){r.push([[-1,t[1]],[-1,n*e[1]]],[[0,t[1]],[0,n*e[1]]],[[1,t[1]],[1,n*e[1]]])}));return r}(n,i.fixedDirection,r),s=Tb(e,t,n,r),l=Pm(Pm([],Om($b(e,t,a,r,o,i)),!1),Om(Eb(e,s,i)),!1),d=wb(l,0),u=wb(l,1);return{width:{isBound:d.isBound,offset:d.offset[0]},height:{isBound:u.isBound,offset:u.offset[1]}}}function cy(e,t,n,r,o,i,a,s){for(var l=ex(e.state),d=e.props.keepRatio,u=0,c=0,p=0;p<2;++p){var h=uy(e,t(u,c),o,d,a,s),f=h.width,g=h.height,m=f.isBound,v=g.isBound,b=f.offset,y=g.offset;if(1===p&&(m||(b=0),v||(y=0)),0===p&&a&&!m&&!v)return[0,0];if(d){var x=Ix(b)*(n?1/n:1),C=Ix(y)*(r?1/r:1);(m&&v?x<C:v||!m&&x<C)?b=n*y/r:y=r*b/n}u+=b,c+=y}if(!d&&o[0]&&o[1]){var w=function(e,t,n,r,o){var i=[-n[0],-n[1]],a=e.state,s=a.width,l=a.height,d=e.props.bounds,u=1/0,c=1/0;if(d){var p=[[n[0],-n[1]],[-n[0],n[1]]],h=d.left,f=void 0===h?-1/0:h,g=d.top,m=void 0===g?-1/0:g,v=d.right,b=void 0===v?1/0:v,y=d.bottom,x=void 0===y?1/0:y;p.forEach((function(e){var n=e[0]!==i[0],a=e[1]!==i[1],d=wv(t,e),p=360*Lf(r,d)/Math.PI;if(a){var h=d.slice();(Ix(p-360)<2||Ix(p-180)<2)&&(h[1]=r[1]);var g=Ob(r,h,(r[1]<d[1]?x:m)-d[1],!1,o),v=Om(g.offset,2)[1],y=g.isOutside;isNaN(v)||(c=l+(y?1:-1)*Ix(v))}if(n){h=d.slice(),(Ix(p-90)<2||Ix(p-270)<2)&&(h[0]=r[0]);var C=Ob(r,h,(r[0]<d[0]?b:f)-d[0],!0,o),w=Om(C.offset,1)[0],S=C.isOutside;isNaN(w)||(u=s+(S?1:-1)*Ix(w))}}))}return{maxWidth:u,maxHeight:c}}(e,l,o,i,s),S=w.maxWidth,Z=w.maxHeight,k=Om(function(e,t,n,r,o,i,a,s,l){var d=wv(t,a),u=Fb(e,s,{vertical:[d[0]],horizontal:[d[1]]}),c=u.horizontal.offset,p=u.vertical.offset;if(jf(p,tv)||jf(c,tv)){var h=Om(xv({datas:l,distX:-p,distY:-c}),2),f=h[0],g=h[1];return[Math.min(o||1/0,n+a[0]*f)-n,Math.min(i||1/0,r+a[1]*g)-r]}return[0,0]}(e,t(u,c).map((function(e){return e.map((function(e){return jf(e,tv)}))})),n+u,r+c,S,Z,o,a,s),2);u+=b=k[0],c+=y=k[1]}return[u,c]}function py(e){return e<0&&(e=e%360+360),e%=360}function hy(e,t){t=py(t);var n=Math.floor(e/360),r=360*n+360-t,o=360*n+t;return Ix(e-r)<Ix(e-o)?r:o}function fy(e,t){e=py(e),t=py(t);var n=py(e-t);return Math.min(n,360-n)}function gy(e,t,n,r,o){if(!cb(e,"scalable"))return[0,0];var i=o.startOffsetWidth,a=o.startOffsetHeight,s=o.fixedPosition,l=o.fixedDirection,d=o.is3d,u=cy(e,(function(e,n){return ly(function(e,t){var n=e.transformOrigin,r=e.offsetMatrix,o=e.is3d,i=e.targetMatrix,a=o?4:3;return Sv(r,ug(e.targetAllTransform||i,Zg(t,a),a),n,a)}(o,cg(t,[e/i,n/a])),i,a,l,s,d)}),i,a,n,s,r,o);return[u[0]/i,u[1]/a]}function my(e){var t=[];return e.forEach((function(e){e.guidelineInfos.forEach((function(n){var r=n.guideline;Tf(t,(function(e){return e.guideline===r}))||(r.direction="",t.push({guideline:r,posInfo:e}))}))})),t.map((function(e){var t=e.guideline,n=e.posInfo;return Im(Im({},t),{direction:n.direction})}))}function vy(e,t,n,r,o,i){var a=tb(nb(e,i),t,n),s=a.vertical,l=a.horizontal,d={left:!1,top:!1,right:!1,bottom:!1};s.forEach((function(e){e.isBound&&("start"===e.direction&&(d.left=!0),"end"===e.direction&&(d.right=!0),r.push({type:"bounds",pos:e.pos}))})),l.forEach((function(e){e.isBound&&("start"===e.direction&&(d.top=!0),"end"===e.direction&&(d.bottom=!0),o.push({type:"bounds",pos:e.pos}))}));var u=function(e){var t=e.props.innerBounds,n={left:!1,top:!1,right:!1,bottom:!1};if(!t)return{boundMap:n,vertical:[],horizontal:[]};var r=e.getRect(),o=[r.pos1,r.pos2,r.pos3,r.pos4],i=wv(o,[0,0]),a=t.left,s=t.top,l=t.width,d=t.height,u=[[a,s],[a,s+d]],c=[[a,s],[a+l,s]],p=[[a+l,s],[a+l,s+d]],h=[[a,s+d],[a+l,s+d]],f=Tb(e,o,[0,0],!1),g=[],m=[];return f.forEach((function(e){var t=e.line,r=e.lineConstants,o=Sb(i,t),f=o.horizontal,v=o.vertical,b=Db(t,r,c,v,1,!0),y=Db(t,r,h,v,1,!0),x=Db(t,r,u,f,1,!0),C=Db(t,r,p,f,1,!0);b.isBound&&!n.top&&(g.push(s),n.top=!0),y.isBound&&!n.bottom&&(g.push(s+d),n.bottom=!0),x.isBound&&!n.left&&(m.push(a),n.left=!0),C.isBound&&!n.right&&(m.push(a+l),n.right=!0)})),{boundMap:n,horizontal:g,vertical:m}}(e),c=u.boundMap,p=u.vertical,h=u.horizontal;return p.forEach((function(e){Rf(r,(function(t){var n=t.type,r=t.pos;return"bounds"===n&&r===e}))>=0||r.push({type:"bounds",pos:e})})),h.forEach((function(e){Rf(o,(function(t){var n=t.type,r=t.pos;return"bounds"===n&&r===e}))>=0||o.push({type:"bounds",pos:e})})),{boundMap:d,innerBoundMap:c}}var by=Cx("",["resizable","scalable"]),yy="snapRotationThreshold",xy="snapRotationDegrees",Cy={name:"snappable",dragRelation:"strong",props:["snappable","snapContainer","snapDirections","elementSnapDirections","snapGap","snapGridWidth","snapGridHeight","isDisplaySnapDigit","isDisplayInnerSnapDigit","isDisplayGridGuidelines","snapDigit","snapThreshold","snapRenderThreshold",yy,xy,"horizontalGuidelines","verticalGuidelines","elementGuidelines","bounds","innerBounds","snapDistFormat","maxSnapElementGuidelineDistance","maxSnapElementGapDistance"],events:["snap","bound"],css:[":host {\n--bounds-color: #d66;\n}\n.guideline {\npointer-events: none;\nz-index: 2;\n}\n.guideline.bounds {\nbackground: #d66;\nbackground: var(--bounds-color);\n}\n.guideline-group {\nposition: absolute;\ntop: 0;\nleft: 0;\n}\n.guideline-group .size-value {\nposition: absolute;\ncolor: #f55;\nfont-size: 12px;\nfont-size: calc(12px * var(--zoom));\nfont-weight: bold;\n}\n.guideline-group.horizontal .size-value {\ntransform-origin: 50% 100%;\ntransform: translateX(-50%);\nleft: 50%;\nbottom: 5px;\nbottom: calc(2px + 3px * var(--zoom));\n}\n.guideline-group.vertical .size-value {\ntransform-origin: 0% 50%;\ntop: 50%;\ntransform: translateY(-50%);\nleft: 5px;\nleft: calc(2px + 3px * var(--zoom));\n}\n.guideline.gap {\nbackground: #f55;\n}\n.size-value.gap {\ncolor: #f55;\n}\n"],render:function(e,t){var n=e.state,r=n.top,o=n.left,i=n.pos1,a=n.pos2,s=n.pos3,l=n.pos4,d=n.snapRenderInfo,u=e.props.snapRenderThreshold,c=void 0===u?1:u;if(!d||!d.render||!cb(e,""))return Tx(e,"boundMap",{left:!1,top:!1,right:!1,bottom:!1},(function(e){return JSON.stringify(e)})),Tx(e,"innerBoundMap",{left:!1,top:!1,right:!1,bottom:!1},(function(e){return JSON.stringify(e)})),[];n.guidelines=ry(e);var p=Math.min(i[0],a[0],s[0],l[0]),h=Math.min(i[1],a[1],s[1],l[1]),f=d.externalPoses||[],g=ex(e.state),m=[],v=[],b=[],y=[],x=[],C=Ly(g),w=C.width,S=C.height,Z=C.top,k=C.left,M=C.bottom,D=C.right,E={left:k,right:D,top:Z,bottom:M,center:(k+D)/2,middle:(Z+M)/2},R=f.length>0,T=R?Ly(f):{};if(!d.request){if(d.direction&&x.push(xb(e,g,d.direction,c)),d.snap){var _=Ly(g);d.center&&(_.middle=(_.top+_.bottom)/2,_.center=(_.left+_.right)/2),x.push(vb(e,_,c))}R&&(d.center&&(T.middle=(T.top+T.bottom)/2,T.center=(T.left+T.right)/2),x.push(vb(e,T,c))),x.forEach((function(e){var t=e.vertical.posInfos,n=e.horizontal.posInfos;m.push.apply(m,Pm([],Om(t.filter((function(e){return e.guidelineInfos.some((function(e){return!e.guideline.hide}))})).map((function(e){return{type:"snap",pos:e.pos}}))),!1)),v.push.apply(v,Pm([],Om(n.filter((function(e){return e.guidelineInfos.some((function(e){return!e.guideline.hide}))})).map((function(e){return{type:"snap",pos:e.pos}}))),!1)),b.push.apply(b,Pm([],Om(my(t)),!1)),y.push.apply(y,Pm([],Om(my(n)),!1))}))}var I=vy(e,[k,D],[Z,M],m,v),O=I.boundMap,P=I.innerBoundMap;R&&vy(e,[T.left,T.right],[T.top,T.bottom],m,v,d.externalBounds);var z=Pm(Pm([],Om(b),!1),Om(y),!1),F=z.filter((function(e){return e.element&&!e.gapRects})),N=z.filter((function(e){return e.gapRects})).sort((function(e,t){return e.gap-t.gap}));lx(e,"onSnap",{guidelines:z.filter((function(e){return!e.element})),elements:F,gaps:N},!0);var $=Tx(e,"boundMap",O,(function(e){return JSON.stringify(e)}),{left:!1,top:!1,right:!1,bottom:!1}),L=Tx(e,"innerBoundMap",P,(function(e){return JSON.stringify(e)}),{left:!1,top:!1,right:!1,bottom:!1});return O!==$&&P!==L||lx(e,"onBound",{bounds:O,innerBounds:P},!0),Pm(Pm(Pm(Pm(Pm(Pm([],Om(ny(e,F,[p,h],E,t)),!1),Om(function(e,t,n,r,o){var i=[];return["horizontal","vertical"].forEach((function(a){var s=t.filter((function(e){return e.type===a})).slice(0,1),l="vertical"===a?0:1,d=l?0:1,u=l?ub:db,c=l?db:ub,p=r[u.start],h=r[u.end],f=r[c.start],g=r[c.end];s.forEach((function(t){var r=t.gap,a=t.gapRects,s=Math.max.apply(Math,Pm([f],Om(a.map((function(e){return e.rect[c.start]}))),!1)),m=Math.min.apply(Math,Pm([g],Om(a.map((function(e){return e.rect[c.end]}))),!1)),v=(s+m)/2;s!==m&&v!==(f+g)/2&&a.forEach((function(t){var a=t.rect,s=t.className,c=[n[0],n[1]];if(a[u.end]<p)c[l]+=a[u.end]-p;else{if(!(h<a[u.start]))return;c[l]+=a[u.start]-p-r}c[d]+=v-f,i.push(ty(e,l?"vertical":"horizontal","gap",i.length,r,c,s,o))}))}))})),i}(e,N,[p,h],E,t)),!1),Om(ey(e,"horizontal",y,[o,r],E,t)),!1),Om(ey(e,"vertical",b,[o,r],E,t)),!1),Om(Jb(e,"horizontal",v,p,r,w,0,t)),!1),Om(Jb(e,"vertical",m,h,o,S,1,t)),!1)},dragStart:function(e,t){e.state.snapRenderInfo={request:t.isRequest,snap:!0,center:!0},sy(e)},drag:function(e){var t=e.state;sy(e)||(t.guidelines=ry(e)),t.snapRenderInfo&&(t.snapRenderInfo.render=!0)},pinchStart:function(e){this.unset(e)},dragEnd:function(e){this.unset(e)},dragControlCondition:function(e,t){return!(!by(e,t)&&!Yb(e,t))||(!t.isRequest&&t.inputEvent?qf(t.inputEvent.target,wy("snap-control")):void 0)},dragControlStart:function(e){e.state.snapRenderInfo=null,sy(e)},dragControl:function(e){this.drag(e)},dragControlEnd:function(e){this.unset(e)},dragGroupStart:function(e,t){this.dragStart(e,t)},dragGroup:function(e){this.drag(e)},dragGroupEnd:function(e){this.unset(e)},dragGroupControlStart:function(e){e.state.snapRenderInfo=null,sy(e)},dragGroupControl:function(e){this.drag(e)},dragGroupControlEnd:function(e){this.unset(e)},unset:function(e){var t=e.state;t.enableSnap=!1,t.guidelines=[],t.snapRenderInfo=null,t.elementRects=[]}};function wy(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ef.apply(void 0,Pm([Xm],Om(e),!1))}function Sy(e){e()}function Zy(e){return e&&"none"!==e?mf(e)?e:Eg(e):[1,0,0,1,0,0]}function ky(e,t,n){return dg(t,kg(n,t),e,kg(n.map((function(e){return-e})),t))}function My(e){return Dy(dx(e,":before").transformOrigin).map((function(t,n){var r=Df(t),o=r.value,i=r.unit;return o*function(e,t,n){return"%"===t?zy(e.ownerSVGElement)[n?"width":"height"]/100:1}(e,i,0===n)}))}function Dy(e){return e?e.split(" "):["0","0"]}function Ey(e){var t=Hv(e)("transform");if(t&&"none"!==t)return t;if("transform"in e){var n=e.transform.baseVal;if(!n)return"";var r=n.length;if(!r)return"";for(var o=[],i=function(e){var t=n[e].matrix;o.push("matrix(".concat(["a","b","c","d","e","f"].map((function(e){return t[e]})).join(", "),")"))},a=0;a<r;++a)i(a);return o.join(" ")}return""}function Ry(e,t,n,r,o){var i,a,s,l,d=Yf(e)||Xf(e),u=!1;if(!e||n)s=e;else{var c=null===(i=null===e||void 0===e?void 0:e.assignedSlot)||void 0===i?void 0:i.parentElement,p=e.parentElement;c?(u=!0,l=p,s=c):s=p}for(var h=!1,f=e===t||s===t,g="relative",m=1,v=parseFloat(null===o||void 0===o?void 0:o("zoom"))||1,b=null===o||void 0===o?void 0:o("position");s&&s!==d;){t===s&&(f=!0);var y=Hv(s),x=s.tagName.toLowerCase(),C=Ey(s),w=y("willChange"),S=parseFloat(y("zoom"))||1;if(g=y("position"),r&&1!==S){m=S;break}if(!n&&r&&1!==v&&b&&"absolute"!==b||"svg"===x||"static"!==g||C&&"none"!==C||"transform"===w)break;var Z=null===(a=null===e||void 0===e?void 0:e.assignedSlot)||void 0===a?void 0:a.parentNode,k=s.parentNode;Z&&(u=!0,l=k);var M=k;if(M&&11===M.nodeType){h=!0,g=Hv(s=M.host)("position");break}s=M,g="relative"}return{offsetZoom:m,hasSlot:u,parentSlotElement:l,isCustomElement:h,isStatic:"static"===g,isEnd:f||!s||s===d,offsetParent:s||d}}function Ty(e,t){var n,r,o,i=e.tagName.toLowerCase(),a=e.offsetLeft,s=e.offsetTop,l=Hv(e),d=gf(a),u=!d;return u||"svg"===i?o=(r=Dy(l("transformOrigin")).map((function(e){return parseFloat(e)}))).slice():(o=(r=jm?My(e):Dy(l("transformOrigin")).map((function(e){return parseFloat(e)}))).slice(),u=!0,n=Om(function(e,t,n){if(!e.getBBox||!n&&"g"===e.tagName.toLowerCase())return[0,0,0,0];var r=e.getBBox(),o=zy(e.ownerSVGElement),i=r.x-o.x,a=r.y-o.y;return[i,a,t[0]-i,t[1]-a]}(e,r,e===t&&"g"===t.tagName.toLowerCase()),4),a=n[0],s=n[1],r[0]=n[2],r[1]=n[3]),{tagName:i,isSVG:d,hasOffset:u,offset:[a||0,s||0],origin:r,targetOrigin:o}}function _y(e,t){var n=Hv(e),r=Hv(Xf(e)),o=r("position");if(!t&&(!o||"static"===o))return[0,0];var i=parseInt(r("marginLeft"),10),a=parseInt(r("marginTop"),10);return"absolute"===n("position")&&("auto"===n("top")&&"auto"===n("bottom")||(a=0),"auto"===n("left")&&"auto"===n("right")||(i=0)),[i,a]}function Iy(e){e.forEach((function(e){var t=e.matrix;t&&(e.matrix=lg(t,3,4))}))}function Oy(e){for(var t=e.parentElement,n=!1,r=Xf(e);t;){var o=dx(t).transform;if(o&&"none"!==o){n=!0;break}if(t===r)break;t=t.parentElement}return{fixedContainer:t||r,hasTransform:n}}function Py(e,t){return void 0===t&&(t=e.length>9),"".concat(t?"matrix3d":"matrix","(").concat(hg(e,!t).join(","),")")}function zy(e){var t=e.clientWidth,n=e.clientHeight;if(!e)return{x:0,y:0,width:0,height:0,clientWidth:t,clientHeight:n};var r=e.viewBox,o=r&&r.baseVal||{x:0,y:0,width:0,height:0};return{x:o.x,y:o.y,width:o.width||t,height:o.height||n,clientWidth:t,clientHeight:n}}function Fy(e,t){var n,r=zy(e),o=r.width,i=r.height,a=r.clientWidth,s=r.clientHeight,l=a/o,d=s/i,u=e.preserveAspectRatio.baseVal,c=u.align,p=u.meetOrSlice,h=[0,0],f=[l,d],g=[0,0];if(1!==c){var m=(c-2)%3,v=Math.floor((c-2)/3);h[0]=o*m/2,h[1]=i*v/2;var b=2===p?Math.max(d,l):Math.min(l,d);f[0]=b,f[1]=b,g[0]=(a-o)/2*m,g[1]=(s-i)/2*v}var y=Zg(f,t);return n=Om(g,2),y[t*(t-1)]=n[0],y[t*(t-1)+1]=n[1],ky(y,t,h)}function Ny(e,t,n){return fg(e,sg(t,n),n)}function $y(e,t,n,r){return[[0,0],[t,0],[0,n],[t,n]].map((function(t){return Ny(e,t,r)}))}function Ly(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]})),r=Math.min.apply(Math,Pm([],Om(t),!1)),o=Math.min.apply(Math,Pm([],Om(n),!1)),i=Math.max.apply(Math,Pm([],Om(t),!1)),a=Math.max.apply(Math,Pm([],Om(n),!1));return{left:r,top:o,right:i,bottom:a,width:i-r,height:a-o}}function By(e,t,n,r){return Ly($y(e,t,n,r))}function Ay(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function jy(e,t){return Ay([t[0]-e[0],t[1]-e[1]])}function Hy(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=Lf(e,t));var o=jy(e,t);return{transform:"translateY(-50%) translate(".concat(e[0],"px, ").concat(e[1],"px) rotate(").concat(r,"rad) scaleY(").concat(n,")"),width:"".concat(o,"px")}}function qy(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=n.length,i=n.reduce((function(e,t){return e+t[0]}),0)/o,a=n.reduce((function(e,t){return e+t[1]}),0)/o;return{transform:"translateZ(0px) translate(".concat(i,"px, ").concat(a,"px) rotate(").concat(e,"rad) scale(").concat(t,")")}}function Uy(e,t){var n=e[t];return mf(n)?Im(Im({},e),n):e}function Vy(e){var t=e&&!gf(e.offsetWidth),n=0,r=0,o=0,i=0,a=0,s=0,l=0,d=0,u=0,c=0,p=0,h=0,f=1/0,g=1/0,m=1/0,v=1/0,b=0,y=0,x=!1;if(e)if(t||"svg"===e.tagName.toLowerCase()){var C=Hv(e),w=e.style,S="border-box"===C("boxSizing"),Z=parseFloat(C("borderLeftWidth"))||0,k=parseFloat(C("borderRightWidth"))||0,M=parseFloat(C("borderTopWidth"))||0,D=parseFloat(C("borderBottomWidth"))||0,E=(parseFloat(C("paddingLeft"))||0)+(parseFloat(C("paddingRight"))||0),R=(parseFloat(C("paddingTop"))||0)+(parseFloat(C("paddingBottom"))||0),T=E+(Z+k),_=R+(M+D),I=C("position"),O=0,P=0;if("clientLeft"in e){var z=null;if("absolute"===I)z=Ry(e,Xf(e)).offsetParent;else z=e.parentElement;if(z){var F=Hv(z);O=parseFloat(F("width")),P=parseFloat(F("height"))}}u=Math.max(E,Pf(C("minWidth"),O)||0),c=Math.max(R,Pf(C("minHeight"),P)||0),f=Pf(C("maxWidth"),O),g=Pf(C("maxHeight"),P),isNaN(f)&&(f=1/0),isNaN(g)&&(g=1/0),b=Pf(w.width,0)||0,y=Pf(w.height,0)||0,a=parseFloat(C("width"))||0,s=parseFloat(C("height"))||0,n=l=Ix(a-b)<1?zf(u,b||a,f):a,r=d=Ix(s-y)<1?zf(c,y||s,g):s,o=l,i=d,S?(m=f,v=g,p=u,h=c,l=n-T,d=r-_):(m=f+T,v=g+_,p=u+T,h=c+_,n=l+T,r=d+_),o=l+E,i=d+R}else{var N=e.getBBox();x=!0,a=n=N.width,s=r=N.height,l=n,d=r,o=n,i=r}return{svg:x,offsetWidth:n,offsetHeight:r,clientWidth:o,clientHeight:i,contentWidth:l,contentHeight:d,inlineCSSWidth:b,inlineCSSHeight:y,cssWidth:a,cssHeight:s,minWidth:u,minHeight:c,maxWidth:f,maxHeight:g,minOffsetWidth:p,minOffsetHeight:h,maxOffsetWidth:m,maxOffsetHeight:v}}function Wy(e,t){return Lf(t>0?e[0]:e[1],t>0?e[1]:e[0])}function Gy(e,t){var n=e===Xf(e)||e===Yf(e),r={clientLeft:e.clientLeft,clientTop:e.clientTop,clientWidth:e.clientWidth,clientHeight:e.clientHeight,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,overflow:!1};return n&&(r.clientHeight=Math.max(t.height,r.clientHeight),r.scrollHeight=Math.max(t.height,r.scrollHeight)),r.overflow="visible"!==Hv(e)("overflow"),Im(Im({},t),r)}function Ky(e,t,n,r){var o=e.left,i=e.right,a=e.top,s=e.bottom,l=t.top,d=t.left,u={left:d+o,top:l+a,right:d+i,bottom:l+s,width:i-o,height:s-a};return n&&r?Gy(n,u):u}function Yy(e,t){var n=0,r=0,o=0,i=0;if(e){var a=e.getBoundingClientRect();n=a.left,r=a.top,o=a.width,i=a.height}var s={left:n,top:r,width:o,height:i,right:n+o,bottom:r+i};return e&&t?Gy(e,s):s}function Xy(e,t,n,r){var o;if(e)o=e;else if(t)o=[0,0];else{o=Qy(n.target,r)}return o}function Qy(e,t){if(e){var n=e.getAttribute("data-rotation")||"",r=e.getAttribute("data-direction");if(t.deg=n,r){var o=[0,0];return r.indexOf("w")>-1&&(o[0]=-1),r.indexOf("e")>-1&&(o[0]=1),r.indexOf("n")>-1&&(o[1]=-1),r.indexOf("s")>-1&&(o[1]=1),o}}}function Jy(e,t){return[cg(t,e[0]),cg(t,e[1]),cg(t,e[2]),cg(t,e[3])]}function ex(e){var t=e.left,n=e.top;return Jy([e.pos1,e.pos2,e.pos3,e.pos4],[t,n])}function tx(e,t){e[t?"controlAbles":"targetAbles"].forEach((function(t){t.unset&&t.unset(e)}))}function nx(e,t){var n=t?"controlGesto":"targetGesto",r=e[n];!1===(null===r||void 0===r?void 0:r.isIdle())&&tx(e,t),null===r||void 0===r||r.unset(),e[n]=null}function rx(e,t){if(t){var n=Ev(t);n.nextStyle=Im(Im({},n.nextStyle),e)}return{style:e,cssText:Of(e).map((function(t){return"".concat((n=t,r="-",void 0===r&&(r="-"),n.replace(/([a-z])([A-Z])/g,(function(e,t,n){return""+t+r+n.toLowerCase()}))),": ").concat(e[t],";");var n,r})).join("")}}function ox(e,t,n){var r=t.afterTransform||t.transform;return Im(Im({},rx(Im(Im(Im({},e.style),t.style),{transform:r}),n)),{afterTransform:r,transform:e.transform})}function ix(e,t,n,r){var o=t.datas;o.datas||(o.datas={});var i=Im(Im({},n),{target:e.state.target,clientX:t.clientX,clientY:t.clientY,inputEvent:t.inputEvent,currentTarget:e,moveable:e,datas:o.datas,isRequest:t.isRequest,isRequestChild:t.isRequestChild,isFirstDrag:!!t.isFirstDrag,isTrusted:!1!==t.isTrusted,stopAble:function(){o.isEventStart=!1},stopDrag:function(){var e;null===(e=t.stop)||void 0===e||e.call(t)}});return o.isStartEvent?r||(o.lastEvent=i):o.isStartEvent=!0,i}function ax(e,t,n){var r=t.datas,o="isDrag"in n?n.isDrag:t.isDrag;return r.datas||(r.datas={}),Im(Im({isDrag:o},n),{moveable:e,target:e.state.target,clientX:t.clientX,clientY:t.clientY,inputEvent:t.inputEvent,currentTarget:e,lastEvent:r.lastEvent,isDouble:t.isDouble,datas:r.datas,isFirstDrag:!!t.isFirstDrag})}function sx(e,t,n){e._emitter.on(t,n)}function lx(e,t,n,r,o){return e.triggerEvent(t,n,r,o)}function dx(e,t){return Qf(e).getComputedStyle(e,t)}function ux(e,t,n){var r={},o={};return e.filter((function(e){var i=e.name;if(r[i]||!t.some((function(t){return e[t]})))return!1;if(!n&&e.ableGroup){if(o[e.ableGroup])return!1;o[e.ableGroup]=!0}return r[i]=!0,!0}))}function cx(e,t){return e===t||null==e&&null==t}function px(e,t){var n=[],r=[];return e.forEach((function(o,i){var a=t(o,i,e),s=r.indexOf(a),l=n[s]||[];-1===s&&(r.push(a),n.push(l)),l.push(o)})),n}function hx(e){return e.reduce((function(e,t){return e.concat(t)}),[])}function fx(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.sort((function(e,t){return Ix(t)-Ix(e)})),e[0]}function gx(e,t,n){return fg(ig(e,n),sg(t,n),n)}function mx(e,t){var n,r=e.is3d?4:3;return n=Om(gx(e.rootMatrix,[t.distX,t.distY],r),2),t.distX=n[0],t.distY=n[1],t}function vx(e,t,n,r){if(!n[0]&&!n[1])return t;var o=Ny(e,[dy(n[0]),0],r),i=Ny(e,[0,dy(n[1])],r);return cg(t,Ny(e,[n[0]/Ay(o),n[1]/Ay(i)],r))}function bx(e,t,n){return n?"".concat(e/t*100,"%"):"".concat(e,"px")}function yx(e){return Ix(e)<=nv?0:e}function xx(e){return function(t){if(!t.isDragging(e))return"";var n=function(e,t){var n,r=e.targetGesto,o=e.controlGesto;return(null===r||void 0===r?void 0:r.isFlag())&&(n=r.getEventData()[t]),!n&&(null===o||void 0===o?void 0:o.isFlag())&&(n=o.getEventData()[t]),n||{}}(t,e),r=n.deg;return r?wy("view-control-rotation".concat(r)):""}}function Cx(e,t){return void 0===t&&(t=[e]),function(n,r){if(r.isRequest)return!!t.some((function(e){return r.requestAble===e}))&&r.parentDirection;var o=r.inputEvent.target;return qf(o,wy("direction"))&&(!e||qf(o,wy(e)))}}function wx(e,t){return e?eg(e)?e:bf(e)?t?document.querySelector(e):e:xf(e)?e():Jf(e)?e:"current"in e?e.current:e:null}function Sx(e,t){return e?((n=e)&&mf(n)&&!eg(n)&&(vf(n)||"length"in n)?[].slice.call(e):[e]).reduce((function(e,n){return bf(n)&&t?Pm(Pm([],Om(e),!1),Om([].slice.call(document.querySelectorAll(n))),!1):(vf(n)?e.push(Sx(n,t)):e.push(wx(n,t)),e)}),[]):[];var n}function Zx(e,t){var n=e.rootMatrix,r=e.is3d,o=ig(n,r?4:3);return r||(o=lg(o,3,4)),o[12]=0,o[13]=0,o[14]=0,function(e,t){var n=fg(e,[t[0],t[1]||0,t[2]||0,1],4),r=n[3]||1;return[n[0]/r,n[1]/r,n[2]/r]}(o,t)}function kx(e,t,n,r,o){var i=Om(e,2),a=i[0],s=i[1],l=0,d=0;if(o&&a&&s){var u=Lf([0,0],t),c=Lf([0,0],r),p=Ay(t),h=Math.cos(u-c)*p;if(r[0])if(r[1]){var f=r[0]*a,g=r[1]*s,m=Math.atan2(f+t[0],g+t[1]),v=Math.atan2(f,g);m<0&&(m+=2*Math.PI),v<0&&(v+=2*Math.PI);var b=0;(b=Ix(m-v)<Math.PI/2||Ix(m-v)>Math.PI/2*3?m-v:m-(v+=Math.PI))>2*Math.PI?b-=2*Math.PI:b>Math.PI?b=2*Math.PI-b:b<-Math.PI&&(b=-2*Math.PI-b);var y=Ay([f+t[0],g+t[1]])*Math.cos(b);l=y*Math.sin(v)-f,d=y*Math.cos(v)-g,r[0]<0&&(l*=-1),r[1]<0&&(d*=-1)}else d=(l=h)/n;else l=(d=h)*n}else l=r[0]*t[0],d=r[1]*t[1];return[l,d]}function Mx(e,t,n,r){var o,i=n.ratio,a=n.startOffsetWidth,s=n.startOffsetHeight,l=0,d=0,u=r.distX,c=r.distY,p=r.pinchScale,h=r.parentDistance,f=r.parentDist,g=r.parentScale,m=n.fixedDirection,v=[0,1].map((function(t){return Ix(e[t]-m[t])})),b=[0,1].map((function(e){var t=v[e];return 0!==t&&(t=2/t),t}));if(f)l=f[0],d=f[1],t&&(l?d||(d=l/i):l=d*i);else if(yf(p))l=(p-1)*a,d=(p-1)*s;else if(g)l=(g[0]-1)*a,d=(g[1]-1)*s;else if(h){var y=a*v[0],x=s*v[1],C=Ay([y,x]);l=h/C*y*b[0],d=h/C*x*b[1]}else{var w=xv({datas:n,distX:u,distY:c});w=b.map((function(e,t){return w[t]*e})),l=(o=Om(kx([a,s],w,i,e,t),2))[0],d=o[1]}return{distWidth:l,distHeight:d}}function Dx(e,t){if(t){if("left"===e)return{x:"0%",y:"50%"};if("top"===e)return{x:"50%",y:"50%"};if("center"===e)return{x:"50%",y:"50%"};if("right"===e)return{x:"100%",y:"50%"};if("bottom"===e)return{x:"50%",y:"100%"};var n=Om(e.split(" "),2),r=n[0],o=n[1],i=Dx(r||""),a=Dx(o||""),s=Im(Im({},i),a),l={x:"50%",y:"50%"};return s.x&&(l.x=s.x),s.y&&(l.y=s.y),s.value&&(s.x&&!s.y&&(l.y=s.value),!s.x&&s.y&&(l.x=s.value)),l}return"left"===e?{x:"0%"}:"right"===e?{x:"100%"}:"top"===e?{y:"0%"}:"bottom"===e?{y:"100%"}:e?"center"===e?{value:"50%"}:{value:e}:{}}function Ex(e,t,n){var r=Dx(e,!0),o=r.x,i=r.y;return[Pf(o,t)||0,Pf(i,n)||0]}function Rx(e,t){return e.length===t.length&&e.every((function(e,n){var r=t[n],o=vf(e),i=vf(r);return o&&i?Rx(e,r):!o&&!i&&e===r}))}function Tx(e,t,n,r,o){var i=e._store,a=i[t];if(!(t in i)){if(null==o)return i[t]=n,n;i[t]=o,a=o}return a===n||r(a)===r(n)?a:(i[t]=n,n)}function _x(e){return e>=0?1:-1}function Ix(e){return Math.abs(e)}function Ox(e,t){return function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t}(e).map((function(e){return t(e)}))}function Px(e){return yf(e)?{top:e,left:e,right:e,bottom:e}:{left:e.left||0,top:e.top||0,right:e.right||0,bottom:e.bottom||0}}var zx=zm("pinchable",{props:["pinchable"],events:["pinchStart","pinch","pinchEnd","pinchGroupStart","pinchGroup","pinchGroupEnd"],dragStart:function(){return!0},pinchStart:function(e,t){var n=t.datas,r=t.targets,o=t.angle,i=t.originalDatas,a=e.props,s=a.pinchable,l=a.ables;if(!s)return!1;var d="onPinch".concat(r?"Group":"","Start"),u="drag".concat(r?"Group":"","ControlStart"),c=(!0===s?e.controlAbles:l.filter((function(e){return s.indexOf(e.name)>-1}))).filter((function(e){return e.canPinch&&e[u]})),p=ix(e,t,{});r&&(p.targets=r);var h=lx(e,d,p);n.isPinch=!1!==h,n.ables=c;var f=n.isPinch;return!!f&&(c.forEach((function(n){if(i[n.name]=i[n.name]||{},n[u]){var r=Im(Im({},t),{datas:i[n.name],parentRotate:o,isPinch:!0});n[u](e,r)}})),e.state.snapRenderInfo={request:t.isRequest,direction:[0,0]},f)},pinch:function(e,t){var n=t.datas,r=t.scale,o=t.distance,i=t.originalDatas,a=t.inputEvent,s=t.targets,l=t.angle;if(n.isPinch){var d=o*(1-1/r),u=ix(e,t,{});s&&(u.targets=s);var c="onPinch".concat(s?"Group":"");lx(e,c,u);var p=n.ables,h="drag".concat(s?"Group":"","Control");return p.forEach((function(n){n[h]&&n[h](e,Im(Im({},t),{datas:i[n.name],inputEvent:a,resolveMatrix:!0,pinchScale:r,parentDistance:d,parentRotate:l,isPinch:!0}))})),u}},pinchEnd:function(e,t){var n=t.datas,r=t.isPinch,o=t.inputEvent,i=t.targets,a=t.originalDatas;if(n.isPinch){var s="onPinch".concat(i?"Group":"","End"),l=ax(e,t,{isDrag:r});i&&(l.targets=i),lx(e,s,l);var d=n.ables,u="drag".concat(i?"Group":"","ControlEnd");return d.forEach((function(n){n[u]&&n[u](e,Im(Im({},t),{isDrag:r,datas:a[n.name],inputEvent:o,isPinch:!0}))})),r}},pinchGroupStart:function(e,t){return this.pinchStart(e,Im(Im({},t),{targets:e.props.targets}))},pinchGroup:function(e,t){return this.pinch(e,Im(Im({},t),{targets:e.props.targets}))},pinchGroupEnd:function(e,t){return this.pinchEnd(e,Im(Im({},t),{targets:e.props.targets}))}}),Fx=Cx("scalable"),Nx={name:"scalable",ableGroup:"size",canPinch:!0,props:["scalable","throttleScale","renderDirections","keepRatio","edge","displayAroundControls"],events:["scaleStart","beforeScale","scale","scaleEnd","scaleGroupStart","beforeScaleGroup","scaleGroup","scaleGroupEnd"],render:Qv("scalable"),dragControlCondition:Fx,viewClassName:xx("scalable"),dragControlStart:function(e,t){var n=t.datas,r=t.isPinch,o=t.inputEvent,i=Xy(t.parentDirection,r,o,n),a=e.state,s=a.width,l=a.height,d=a.targetTransform,u=a.target,c=a.pos1,p=a.pos2,h=a.pos4;if(!i||!u)return!1;r||fv(e,t),n.datas={},n.transform=d,n.prevDist=[1,1],n.direction=i,n.startOffsetWidth=s,n.startOffsetHeight=l,n.startValue=[1,1];var f=!i[0]&&!i[1]||i[0]||!i[1];function g(e){n.ratio=e&&isFinite(e)?e:0}function m(e){var t=Ab(n.startPositions,e);n.fixedDirection=t.fixedDirection,n.fixedPosition=t.fixedPosition,n.fixedOffset=t.fixedOffset}kv(e,t,"scale"),n.isWidth=f,n.startPositions=ex(e.state),n.setFixedDirection=m,g(Af(c,p)/Af(p,h)),m([-i[0],-i[1]]);var v=function(e){n.minScaleSize=e},b=function(e){n.maxScaleSize=e};v([-1/0,-1/0]),b([1/0,1/0]);var y=ix(e,t,Im(Im({direction:i,set:function(e){n.startValue=e},setRatio:g,setFixedDirection:m,setMinScaleSize:v,setMaxScaleSize:b},Zv(e,t)),{dragStart:Bb.dragStart(e,(new cv).dragStart([0,0],t))})),x=lx(e,"onScaleStart",y);return n.startFixedDirection=n.fixedDirection,!1!==x&&(n.isScale=!0,e.state.snapRenderInfo={request:t.isRequest,direction:i}),!!n.isScale&&y},dragControl:function(e,t){gv(e,t,"scale");var n=t.datas,r=t.parentKeepRatio,o=t.parentFlag,i=t.isPinch,a=t.dragClient,s=t.isRequest,l=t.useSnap,d=t.resolveMatrix,u=n.prevDist,c=n.direction,p=n.startOffsetWidth,h=n.startOffsetHeight,f=n.isScale,g=n.startValue,m=n.isWidth,v=n.ratio;if(!f)return!1;var b=e.props,y=b.throttleScale,x=b.parentMoveable,C=c;c[0]||c[1]||(C=[1,1]);var w=v&&(null!=r?r:b.keepRatio)||!1,S=e.state,Z=[g[0],g[1]];function k(){var e=Mx(C,w,n,t),r=e.distWidth,o=e.distHeight,i=p?(p+r)/p:1,a=h?(h+o)/h:1;g[0]||(Z[0]=r/p),g[1]||(Z[1]=o/h);var s=(C[0]||w?i:1)*Z[0],l=(C[1]||w?a:1)*Z[1];return 0===s&&(s=_x(u[0])*rv),0===l&&(l=_x(u[1])*rv),[s,l]}var M=k();if(!i&&e.props.groupable){var D=(S.snapRenderInfo||{}).direction;vf(D)&&(D[0]||D[1])&&(S.snapRenderInfo={direction:c,request:t.isRequest})}lx(e,"onBeforeScale",ix(e,t,{scale:M,setFixedDirection:function(e){return n.setFixedDirection(e),M=k()},startFixedDirection:n.startFixedDirection,setScale:function(e){M=e}},!0));var E,R,T=[M[0]/Z[0],M[1]/Z[1]],_=a,I=[0,0],O=!a&&!o&&i;if(O||d?_=Ov(e,n.targetAllTransform,[0,0],[0,0],n):a||(_=n.fixedPosition),i||(I=gy(e,T,c,!l&&s,n)),w){C[0]&&C[1]&&I[0]&&I[1]&&(Math.abs(I[0]*p)>Math.abs(I[1]*h)?I[1]=0:I[0]=0);var P=!I[0]&&!I[1];if(P&&(m?T[0]=jf(T[0]*Z[0],y)/Z[0]:T[1]=jf(T[1]*Z[1],y)/Z[1]),C[0]&&!C[1]||I[0]&&!I[1]||P&&m){T[0]+=I[0];var z=p*T[0]*Z[0]/v;T[1]=z/h/Z[1]}else if(!C[0]&&C[1]||!I[0]&&I[1]||P&&!m){T[1]+=I[1];var F=h*T[1]*Z[1]*v;T[0]=F/p/Z[0]}}else T[0]+=I[0],T[1]+=I[1],I[0]||(T[0]=jf(T[0]*Z[0],y)/Z[0]),I[1]||(T[1]=jf(T[1]*Z[1],y)/Z[1]);0===T[0]&&(T[0]=_x(u[0])*rv),0===T[1]&&(T[1]=_x(u[1])*rv),E=T,R=[Z[0],Z[1]],M=[E[0]*R[0],E[1]*R[1]];var N=[p,h],$=[p*M[0],h*M[1]];$=Nf($,n.minScaleSize,n.maxScaleSize,!!w&&v),M=Ox(2,(function(e){return N[e]?$[e]/N[e]:$[e]})),T=Ox(2,(function(e){return M[e]/Z[e]}));var L=Ox(2,(function(e){return u[e]?T[e]/u[e]:T[e]})),B="scale(".concat(T.join(", "),")"),A="scale(".concat(M.join(", "),")"),j=mv(n,A,B),H=!g[0]||!g[1],q=function(e,t,n,r,o,i,a){return Pv(e,t,n,r,o,i,a)}(e,H?A:B,n.fixedDirection,_,n.fixedOffset,n,H),U=O?q:pg(q,n.prevInverseDist||[0,0]);if(n.prevDist=T,n.prevInverseDist=q,M[0]===u[0]&&M[1]===u[1]&&U.every((function(e){return!e}))&&!x&&!O)return!1;var V=ix(e,t,Im({offsetWidth:p,offsetHeight:h,direction:c,scale:M,dist:T,delta:L,isPinch:!!i},Iv(e,j,U,i,t)));return lx(e,"onScale",V),V},dragControlEnd:function(e,t){var n=t.datas;if(!n.isScale)return!1;n.isScale=!1;var r=ax(e,t,{});return lx(e,"onScaleEnd",r),r},dragGroupControlCondition:Fx,dragGroupControlStart:function(e,t){var n=t.datas,r=this.dragControlStart(e,t);if(!r)return!1;var o=qv(e,"resizable",t);n.moveableScale=e.scale;var i=Vv(e,this,"dragControlStart",t,(function(t,r){return Wv(e,t,n,r)})),a=function(t){r.setFixedDirection(t),i.forEach((function(r,i){r.setFixedDirection(t),Wv(e,r.moveable,n,o[i])}))};n.setFixedDirection=a;var s=Im(Im({},r),{targets:e.props.targets,events:i,setFixedDirection:a}),l=lx(e,"onScaleGroupStart",s);return n.isScale=!1!==l,!!n.isScale&&s},dragGroupControl:function(e,t){var n=t.datas;if(n.isScale){sx(e,"onBeforeScale",(function(n){lx(e,"onBeforeScaleGroup",ix(e,t,Im(Im({},n),{targets:e.props.targets}),!0))}));var r=this.dragControl(e,t);if(r){var o=r.dist,i=n.moveableScale;e.scale=[o[0]*i[0],o[1]*i[1]];var a=e.props.keepRatio,s=n.fixedPosition,l=Vv(e,this,"dragControl",t,(function(t,n){var r=Om(fg(wg(e.rotation/180*Math.PI,3),[n.datas.originalX*o[0],n.datas.originalY*o[1],1],3),2),i=r[0],l=r[1];return Im(Im({},n),{parentDist:null,parentScale:o,parentKeepRatio:a,dragClient:cg(s,[i,l])})})),d=Im({targets:e.props.targets,events:l},r);return lx(e,"onScaleGroup",d),d}}},dragGroupControlEnd:function(e,t){var n=t.isDrag;if(t.datas.isScale){this.dragControlEnd(e,t);var r=Vv(e,this,"dragControlEnd",t);return lx(e,"onScaleGroupEnd",ax(e,t,{targets:e.props.targets,events:r})),n}},request:function(){var e={},t=0,n=0,r=!1;return{isControl:!0,requestStart:function(t){return r=t.useSnap,{datas:e,parentDirection:t.direction||[1,1],useSnap:r}},request:function(o){return t+=o.deltaWidth,n+=o.deltaHeight,{datas:e,parentDist:[t,n],parentKeepRatio:o.keepRatio,useSnap:r}},requestEnd:function(){return{datas:e,isDrag:!0,useSnap:r}}}}};function $x(e,t){return e.map((function(e,n){return ff(e,t[n],1,2)}))}function Lx(e,t,n){var r=Lf(e,t),o=Lf(e,n)-r;return o>=0?o:o+2*Math.PI}var Bx={name:"warpable",ableGroup:"size",props:["warpable","renderDirections","edge","displayAroundControls"],events:["warpStart","warp","warpEnd"],viewClassName:xx("warpable"),render:function(e,t){var n=e.props,r=n.resizable,o=n.scalable,i=n.warpable,a=n.zoom;if(r||o||!i)return[];var s=e.state,l=s.pos1,d=s.pos2,u=s.pos3,c=s.pos4,p=$x(l,d),h=$x(d,l),f=$x(l,u),g=$x(u,l),m=$x(u,c),v=$x(c,u),b=$x(d,c),y=$x(c,d);return Pm([t.createElement("div",{className:wy("line"),key:"middeLine1",style:Hy(p,m,a)}),t.createElement("div",{className:wy("line"),key:"middeLine2",style:Hy(h,v,a)}),t.createElement("div",{className:wy("line"),key:"middeLine3",style:Hy(f,b,a)}),t.createElement("div",{className:wy("line"),key:"middeLine4",style:Hy(g,y,a)})],Om(Jv(e,"warpable",t)),!1)},dragControlCondition:function(e,t){if(t.isRequest)return!1;var n=t.inputEvent.target;return qf(n,wy("direction"))&&qf(n,wy("warpable"))},dragControlStart:function(e,t){var n=t.datas,r=t.inputEvent,o=e.props.target,i=Qy(r.target,n);if(!i||!o)return!1;var a=e.state,s=a.transformOrigin,l=a.is3d,d=a.targetTransform,u=a.targetMatrix,c=a.width,p=a.height,h=a.left,f=a.top;return n.datas={},n.targetTransform=d,n.warpTargetMatrix=l?u:lg(u,3,4),n.targetInverseMatrix=og(ig(n.warpTargetMatrix,4),3,4),n.direction=i,n.left=h,n.top=f,n.poses=[[0,0],[c,0],[0,p],[c,p]].map((function(e){return pg(e,s)})),n.nextPoses=n.poses.map((function(e){var t=Om(e,2),r=t[0],o=t[1];return fg(n.warpTargetMatrix,[r,o,0,1],4)})),n.startValue=Sg(4),n.prevMatrix=Sg(4),n.absolutePoses=ex(a),n.posIndexes=Cv(i),fv(e,t),kv(e,t,"matrix3d"),a.snapRenderInfo={request:t.isRequest,direction:i},!1!==lx(e,"onWarpStart",ix(e,t,Im({set:function(e){n.startValue=e}},Zv(e,t))))&&(n.isWarp=!0),n.isWarp},dragControl:function(e,t){var n=t.datas,r=t.isRequest,o=t.distX,i=t.distY,a=n.targetInverseMatrix,s=n.prevMatrix,l=n.isWarp,d=n.startValue,u=n.poses,c=n.posIndexes,p=n.absolutePoses;if(!l)return!1;if(gv(e,t,"matrix3d"),cb(e,"warpable")){var h=c.map((function(e){return p[e]}));h.length>1&&h.push([(h[0][0]+h[1][0])/2,(h[0][1]+h[1][1])/2]);var f=Fb(e,r,{horizontal:h.map((function(e){return e[1]+i})),vertical:h.map((function(e){return e[0]+o}))}),g=f.horizontal,m=f.vertical;i-=g.offset,o-=m.offset}var v=xv({datas:n,distX:o,distY:i},!0),b=n.nextPoses.slice();if(c.forEach((function(e){b[e]=cg(b[e],v)})),!ev.every((function(e){return t=e.map((function(e){return u[e]})),n=e.map((function(e){return b[e]})),r=Lx(t[0],t[1],t[2]),o=Lx(n[0],n[1],n[2]),i=Math.PI,!(r>=i&&o<=i||r<=i&&o>=i);var t,n,r,o,i})))return!1;var y=Mg(u[0],u[2],u[1],u[3],b[0],b[2],b[1],b[3]);if(!y.length)return!1;var x=bv(n,ug(a,y,4),!0),C=ug(ig(s,4),x,4);n.prevMatrix=x;var w=ug(d,x,4),S=mv(n,"matrix3d(".concat(w.join(", "),")"),"matrix3d(".concat(x.join(", "),")"));return Dv(t,S),lx(e,"onWarp",ix(e,t,Im({delta:C,matrix:w,dist:x,multiply:ug,transform:S},rx({transform:S},t)))),!0},dragControlEnd:function(e,t){var n=t.datas,r=t.isDrag;return!!n.isWarp&&(n.isWarp=!1,lx(e,"onWarpEnd",ax(e,t,{})),r)}},Ax=wy("area-pieces"),jx=wy("area-piece"),Hx=wy("avoid"),qx=wy("view-dragging");function Ux(e){var t=e.areaElement;if(t){var n=e.state,r=n.width,o=n.height;Vf(t,Hx),t.style.cssText+="left: 0px; top: 0px; width: ".concat(r,"px; height: ").concat(o,"px")}}function Vx(e){return e.createElement("div",{key:"area_pieces",className:Ax},e.createElement("div",{className:jx}),e.createElement("div",{className:jx}),e.createElement("div",{className:jx}),e.createElement("div",{className:jx}))}var Wx={name:"dragArea",props:["dragArea","passDragArea"],events:["click","clickGroup"],render:function(e,t){var n=e.props,r=n.target,o=n.dragArea,i=n.groupable,a=n.passDragArea,s=e.getState(),l=s.width,d=s.height,u=s.renderPoses,c=a?wy("area","pass"):wy("area");if(i)return[t.createElement("div",{key:"area",ref:tf(e,"areaElement"),className:c}),Vx(t)];if(!r||!o)return[];var p=Mg([0,0],[l,0],[0,d],[l,d],u[0],u[1],u[2],u[3]),h=p.length?Py(p,!0):"none";return[t.createElement("div",{key:"area",ref:tf(e,"areaElement"),className:c,style:{top:"0px",left:"0px",width:"".concat(l,"px"),height:"".concat(d,"px"),transformOrigin:"0 0",transform:h}}),Vx(t)]},dragStart:function(e,t){var n=t.datas,r=t.clientX,o=t.clientY;if(!t.inputEvent)return!1;n.isDragArea=!1;var i=e.areaElement,a=e.state,s=a.moveableClientRect,l=a.renderPoses,d=a.rootMatrix,u=a.is3d,c=s.left,p=s.top,h=Ly(l),f=h.left,g=h.top,m=h.width,v=h.height,b=Om(gx(d,[r-c,o-p],u?4:3),2),y=b[0],x=b[1],C=[{left:f,top:g,width:m,height:(x-=g)-10},{left:f,top:g,width:(y-=f)-10,height:v},{left:f,top:g+x+10,width:m,height:v-x-10},{left:f+y+10,top:g,width:m-y-10,height:v}],w=[].slice.call(i.nextElementSibling.children);C.forEach((function(e,t){w[t].style.cssText="left: ".concat(e.left,"px;top: ").concat(e.top,"px; width: ").concat(e.width,"px; height: ").concat(e.height,"px;")})),Uf(i,Hx),a.disableNativeEvent=!0},drag:function(e,t){var n=t.datas,r=t.inputEvent;if(this.enableNativeEvent(e),!r)return!1;n.isDragArea||(n.isDragArea=!0,Ux(e))},dragEnd:function(e,t){this.enableNativeEvent(e);var n=t.inputEvent,r=t.datas;if(!n)return!1;r.isDragArea||Ux(e)},dragGroupStart:function(e,t){return this.dragStart(e,t)},dragGroup:function(e,t){return this.drag(e,t)},dragGroupEnd:function(e,t){return this.dragEnd(e,t)},unset:function(e){Ux(e),e.state.disableNativeEvent=!1},enableNativeEvent:function(e){var t=e.state;t.disableNativeEvent&&_f((function(){t.disableNativeEvent=!1}))}},Gx=zm("origin",{props:["origin","svgOrigin"],render:function(e,t){var n,r=e.props,o=r.zoom,i=r.svgOrigin,a=r.groupable,s=e.getState(),l=s.beforeOrigin,d=s.rotation,u=s.svg,c=s.allMatrix,p=s.is3d,h=s.left,f=s.top,g=s.offsetWidth,m=s.offsetHeight;if(!a&&u&&i){var v=Om(Ex(i,g,m),2);n=qy(d,o,pg(Ny(c,[v[0],v[1]],p?4:3),[h,f]))}else n=qy(d,o,l);return[t.createElement("div",{className:wy("control","origin"),style:n,key:"beforeOrigin"})]}});function Kx(e){var t=e.scrollContainer;return[t.scrollLeft,t.scrollTop]}var Yx={name:"scrollable",canPinch:!0,props:["scrollable","scrollContainer","scrollThreshold","scrollThrottleTime","getScrollPosition","scrollOptions"],events:["scroll","scrollGroup"],dragRelation:"strong",dragStart:function(e,t){var n=e.props,r=n.scrollContainer,o=void 0===r?e.getContainer():r,i=n.scrollOptions,a=new Qg,s=wx(o,!0);t.datas.dragScroll=a,e.state.dragScroll=a;var l=t.isControl?"controlGesto":"targetGesto",d=t.targets;a.on("scroll",(function(n){var r=n.container,o=n.direction,i=ix(e,t,{scrollContainer:r,direction:o}),a=d?"onScrollGroup":"onScroll";d&&(i.targets=d),lx(e,a,i)})).on("move",(function(t){var n=t.offsetX,r=t.offsetY,o=t.inputEvent;e[l].scrollBy(n,r,o.inputEvent,!0)})).on("scrollDrag",(function(t){(0,t.next)(e[l].getCurrentEvent())})),a.dragStart(t,Im({container:s},i))},checkScroll:function(e,t){var n=t.datas.dragScroll;if(n){var r=e.props,o=r.scrollContainer,i=void 0===o?e.getContainer():o,a=r.scrollThreshold,s=void 0===a?0:a,l=r.scrollThrottleTime,d=void 0===l?0:l,u=r.getScrollPosition,c=void 0===u?Kx:u,p=r.scrollOptions;return n.drag(t,Im({container:i,threshold:s,throttleTime:d,getScrollPosition:function(e){return c({scrollContainer:e.container,direction:e.direction})}},p)),!0}},drag:function(e,t){return this.checkScroll(e,t)},dragEnd:function(e,t){t.datas.dragScroll.dragEnd(),t.datas.dragScroll=null},dragControlStart:function(e,t){return this.dragStart(e,Im(Im({},t),{isControl:!0}))},dragControl:function(e,t){return this.drag(e,t)},dragControlEnd:function(e,t){return this.dragEnd(e,t)},dragGroupStart:function(e,t){return this.dragStart(e,Im(Im({},t),{targets:e.props.targets}))},dragGroup:function(e,t){return this.drag(e,Im(Im({},t),{targets:e.props.targets}))},dragGroupEnd:function(e,t){return this.dragEnd(e,Im(Im({},t),{targets:e.props.targets}))},dragGroupControlStart:function(e,t){return this.dragStart(e,Im(Im({},t),{targets:e.props.targets,isControl:!0}))},dragGroupControl:function(e,t){return this.drag(e,Im(Im({},t),{targets:e.props.targets}))},dragGroupControEnd:function(e,t){return this.dragEnd(e,Im(Im({},t),{targets:e.props.targets}))},unset:function(e){var t,n=e.state;null===(t=n.dragScroll)||void 0===t||t.dragEnd(),n.dragScroll=null}},Xx={name:"",props:["target","dragTargetSelf","dragTarget","dragContainer","container","warpSelf","rootContainer","useResizeObserver","useMutationObserver","zoom","dragFocusedInput","transformOrigin","ables","className","pinchThreshold","pinchOutside","triggerAblesSimultaneously","checkInput","cspNonce","translateZ","hideDefaultLines","props","flushSync","stopPropagation","preventClickEventOnDrag","preventClickDefault","viewContainer","persistData","useAccuratePosition","firstRenderState","linePadding","controlPadding","preventDefault","requestStyles"],events:["changeTargets"]},Qx=zm("padding",{props:["padding"],render:function(e,t){var n=e.props;if(n.dragArea)return[];var r=Px(n.padding||{}),o=r.left,i=r.top,a=r.right,s=r.bottom,l=e.getState(),d=l.renderPoses,u=[l.pos1,l.pos2,l.pos3,l.pos4],c=[];return o>0&&c.push([0,2]),i>0&&c.push([0,1]),a>0&&c.push([1,3]),s>0&&c.push([2,3]),c.map((function(e,n){var r=Om(e,2),o=r[0],i=r[1],a=Mg([0,0],[100,0],[0,100],[100,100],u[o],u[i],d[o],d[i]);if(a.length)return t.createElement("div",{key:"padding".concat(n),className:wy("padding"),style:{transform:Py(a,!0)}})}))}}),Jx=["nw","ne","se","sw"];function eC(e,t){var n=e[0]+e[1],r=n>t?t/n:1;return e[0]*=r,e[1]=t-e[1]*r,e}var tC=[1,2,5,6],nC=[0,3,4,7],rC=[1,-1,-1,1],oC=[1,1,-1,-1];function iC(e,t,n,r,o,i,a,s){void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=n),void 0===s&&(s=r);var l=[],d=!1,u=e.filter((function(e){return!e.virtual})),c=u.map((function(e){var u=e.horizontal,c=e.vertical,p=e.pos;if(c&&!d&&(d=!0,l.push("/")),d){var h=Math.max(0,1===c?p[1]-i:s-p[1]);return l.push(bx(h,r,t)),h}h=Math.max(0,1===u?p[0]-o:a-p[0]);return l.push(bx(h,n,t)),h}));return{radiusPoses:u,styles:l,raws:c}}function aC(e){for(var t=[0,0],n=[0,0],r=e.length,o=0;o<r;++o){var i=e[o];i.sub&&(i.horizontal&&(0===t[1]&&(t[0]=o),t[1]=o-t[0]+1,n[0]=o+1),i.vertical&&(0===n[1]&&(n[0]=o),n[1]=o-n[0]+1))}return{horizontalRange:t,verticalRange:n}}function sC(e,t,n,r,o,i,a){var s,l,d,u;void 0===i&&(i=[0,0]),void 0===a&&(a=!1);var c=e.indexOf("/"),p=(c>-1?e.slice(0,c):e).length,h=e.slice(0,p),f=e.slice(p+1),g=h.length,m=f.length,v=m>0,b=Om(h,4),y=b[0],x=void 0===y?"0px":y,C=b[1],w=void 0===C?x:C,S=b[2],Z=void 0===S?x:S,k=b[3],M=void 0===k?w:k,D=Om(f,4),E=D[0],R=void 0===E?x:E,T=D[1],_=void 0===T?v?R:w:T,I=D[2],O=void 0===I?v?R:Z:I,P=D[3],z=void 0===P?v?_:M:P,F=[x,w,Z,M].map((function(e){return Pf(e,t)})),N=[R,_,O,z].map((function(e){return Pf(e,n)})),$=F.slice(),L=N.slice();s=Om(eC([$[0],$[1]],t),2),$[0]=s[0],$[1]=s[1],l=Om(eC([$[3],$[2]],t),2),$[3]=l[0],$[2]=l[1],d=Om(eC([L[0],L[3]],n),2),L[0]=d[0],L[3]=d[1],u=Om(eC([L[1],L[2]],n),2),L[1]=u[0],L[2]=u[1];var B=a?$:$.slice(0,Math.max(i[0],g)),A=a?L:L.slice(0,Math.max(i[1],m));return Pm(Pm([],Om(B.map((function(e,t){var i=Jx[t];return{virtual:t>=g,horizontal:rC[t],vertical:0,pos:[r+e,o+(-1===oC[t]?n:0)],sub:!0,raw:F[t],direction:i}}))),!1),Om(A.map((function(e,n){var i=Jx[n];return{virtual:n>=m,horizontal:0,vertical:oC[n],pos:[r+(-1===rC[n]?t:0),o+e],sub:!0,raw:N[n],direction:i}}))),!1)}var lC=[[0,-1,"n"],[1,0,"e"]],dC=[[-1,-1,"nw"],[0,-1,"n"],[1,-1,"ne"],[1,0,"e"],[1,1,"se"],[0,1,"s"],[-1,1,"sw"],[-1,0,"w"]];function uC(e,t,n){var r=e.props.clipRelative,o=e.state,i=o.width,a=o.height,s=t,l=s.type,d=s.poses,u="rect"===l,c="circle"===l;if("polygon"===l)return n.map((function(e){return"".concat(bx(e[0],i,r)," ").concat(bx(e[1],a,r))}));if(u||"inset"===l){var p=n[1][1],h=n[3][0],f=n[7][0],g=n[5][1];if(u)return[p,h,g,f].map((function(e){return"".concat(e,"px")}));var m=[p,i-h,a-g,f].map((function(e,t){return bx(e,t%2?i:a,r)}));if(n.length>8){var v=Om(pg(n[4],n[0]),2),b=v[0],y=v[1];m.push.apply(m,Pm(["round"],Om(iC(d.slice(8).map((function(e,t){return Im(Im({},e),{pos:n[t]})})),r,b,y,f,p,h,g).styles),!1))}return m}if(c||"ellipse"===l){var x=n[0],C=bx(Ix(n[1][1]-x[1]),c?Math.sqrt((i*i+a*a)/2):a,r);return(m=c?[C]:[bx(Ix(n[2][0]-x[0]),i,r),C]).push("at",bx(x[0],i,r),bx(x[1],a,r)),m}}function cC(e,t,n,r){var o=[r,(r+t)/2,t],i=[e,(e+n)/2,n];return dC.map((function(e){var t=Om(e,3),n=t[0],r=t[1],a=t[2],s=o[n+1],l=i[r+1];return{vertical:Ix(r),horizontal:Ix(n),direction:a,pos:[s,l]}}))}function pC(e){var t=[1/0,-1/0],n=[1/0,-1/0];return e.forEach((function(e){var r=e.pos;t[0]=Math.min(t[0],r[0]),t[1]=Math.max(t[1],r[0]),n[0]=Math.min(n[0],r[1]),n[1]=Math.max(n[1],r[1])})),[Ix(t[1]-t[0]),Ix(n[1]-n[0])]}function hC(e,t,n,r,o){var i,a,s,l,d,u,c,p,h;if(e){var f=o;if(!f){var g=Hv(e),m=g("clipPath");f="none"!==m?m:g("clip")}if(f&&"none"!==f&&"auto"!==f||(f=r)){var v=Mf(f),b=v.prefix,y=void 0===b?f:b,x=v.value,C=void 0===x?"":x,w="circle"===y,S=" ";if("polygon"===y){S=",";var Z=(T=kf(C||"0% 0%, 100% 0%, 100% 100%, 0% 100%")).map((function(e){var r=Om(e.split(" "),2),o=r[0],i=r[1];return{vertical:1,horizontal:1,pos:[Pf(o,t),Pf(i,n)]}})),k=rm(Z.map((function(e){return e.pos})));return{type:y,clipText:f,poses:Z,splitter:S,left:k.minX,right:k.maxX,top:k.minY,bottom:k.maxY}}if(w||"ellipse"===y){var M="",D="",E=0,R=0,T=Zf(C);if(w){var _;_=void 0===(a=(i=Om(T,4))[0])?"50%":a,M=void 0===(s=i[2])?"50%":s,D=void 0===(l=i[3])?"50%":l,E=Pf(_,Math.sqrt((t*t+n*n)/2)),R=E}else{var I,O;I=void 0===(u=(d=Om(T,5))[0])?"50%":u,O=void 0===(c=d[1])?"50%":c,M=void 0===(p=d[3])?"50%":p,D=void 0===(h=d[4])?"50%":h,E=Pf(I,t),R=Pf(O,n)}var P=[Pf(M,t),Pf(D,n)];Z=Pm([{vertical:1,horizontal:1,pos:P,direction:"nesw"}],Om(lC.slice(0,w?1:2).map((function(e){return{vertical:Ix(e[1]),horizontal:e[0],direction:e[2],sub:!0,pos:[P[0]+e[0]*E,P[1]+e[1]*R]}}))),!1);return{type:y,clipText:f,radiusX:E,radiusY:R,left:P[0]-E,top:P[1]-R,right:P[0]+E,bottom:P[1]+R,poses:Z,splitter:S}}if("inset"===y){var z=(T=Zf(C||"0 0 0 0")).indexOf("round"),F=(z>-1?T.slice(0,z):T).length,N=T.slice(F+1),$=Om(T.slice(0,F),4),L=$[0],B=$[1],A=void 0===B?L:B,j=$[2],H=void 0===j?L:j,q=$[3],U=void 0===q?A:q,V=Om([L,H].map((function(e){return Pf(e,n)})),2),W=V[0],G=V[1],K=Om([U,A].map((function(e){return Pf(e,t)})),2),Y=K[0],X=K[1],Q=t-X,J=n-G,ee=sC(N,Q-Y,J-W,Y,W);return{type:"inset",clipText:f,poses:Z=Pm(Pm([],Om(cC(W,Q,J,Y)),!1),Om(ee),!1),top:W,left:Y,right:Q,bottom:J,radius:N,splitter:S}}if("rect"===y){S=",";var te=Om((T=kf(C||"0px, ".concat(t,"px, ").concat(n,"px, 0px"))).map((function(e){return Df(e).value})),4),ne=te[0];return{type:"rect",clipText:f,poses:Z=cC(ne,X=te[1],G=te[2],Y=te[3]),top:ne,right:X,bottom:G,left:Y,values:T,splitter:S}}}}}function fC(e,t){var n=Om(hv(e,t),2),r=n[0],o=n[1],i=t.datas,a=i.clipPath,s=i.clipIndex,l=a,d=l.type,u=l.poses,c=l.splitter,p=u.map((function(e){return e.pos}));if("polygon"===d)p.splice(s,0,[r,o]);else{if("inset"!==d)return;var h=tC.indexOf(s),f=nC.indexOf(s),g=u.length;if(function(e,t,n,r,o,i,a,s,l,d,u){void 0===d&&(d=0),void 0===u&&(u=0);var c=aC(e.slice(n)),p=c.horizontalRange,h=c.verticalRange;if(r>-1)for(var f=1===rC[r]?i-d:s-i,g=p[1];g<=r;++g){var m=1===oC[g]?u:l,v=0;if(r===g?v=i:0===g?v=d+f:-1===rC[g]&&(v=s-(t[n][0]-d)),e.splice(n+g,0,{horizontal:rC[g],vertical:0,pos:[v,m]}),t.splice(n+g,0,[v,m]),0===g)break}else if(o>-1){var b=1===oC[o]?a-u:l-a;if(0===p[1]&&0===h[1]){var y=[d+b,u];e.push({horizontal:rC[0],vertical:0,pos:y}),t.push(y)}var x=h[0];for(g=h[1];g<=o&&(v=1===rC[g]?d:s,m=0,o===g?m=a:0===g?m=u+b:1===oC[g]?m=t[n+x][1]:-1===oC[g]&&(m=l-(t[n+x][1]-u)),e.push({horizontal:0,vertical:oC[g],pos:[v,m]}),t.push([v,m]),0!==g);++g);}}(u,p,8,h,f,r,o,p[4][0],p[4][1],p[0][0],p[0][1]),g===u.length)return}var m=uC(e,a,p),v="".concat(d,"(").concat(m.join(c),")");lx(e,"onClip",ix(e,t,Im({clipEventType:"added",clipType:d,poses:p,clipStyles:m,clipStyle:v,distX:0,distY:0},rx({clipPath:v},t))))}function gC(e,t){var n=t.datas,r=n.clipPath,o=n.clipIndex,i=r,a=i.type,s=i.poses,l=i.splitter,d=s.map((function(e){return e.pos})),u=d.length;if("polygon"===a)s.splice(o,1),d.splice(o,1);else{if("inset"!==a)return;if(o<8)return;if(function(e,t,n,r,o){void 0===o&&(o=t.length);var i=aC(e.slice(r)),a=i.horizontalRange,s=i.verticalRange,l=n-r,d=0;if(0===l)d=o;else if(l>0&&l<a[1])d=a[1]-l;else{if(!(l>=s[0]))return;d=s[0]+s[1]-l}e.splice(n,d),t.splice(n,d)}(s,d,o,8,u),u===s.length)return}var c=uC(e,r,d),p="".concat(a,"(").concat(c.join(l),")");lx(e,"onClip",ix(e,t,Im({clipEventType:"removed",clipType:a,poses:d,clipStyles:c,clipStyle:p,distX:0,distY:0},rx({clipPath:p},t))))}var mC={name:"clippable",props:["clippable","defaultClipPath","customClipPath","keepRatio","clipRelative","clipArea","dragWithClip","clipTargetBounds","clipVerticalGuidelines","clipHorizontalGuidelines","clipSnapThreshold"],events:["clipStart","clip","clipEnd"],css:[".control.clip-control {\nbackground: #6d6;\ncursor: pointer;\n}\n.control.clip-control.clip-radius {\nbackground: #d66;\n}\n.line.clip-line {\nbackground: #6e6;\ncursor: move;\nz-index: 1;\n}\n.clip-area {\nposition: absolute;\ntop: 0;\nleft: 0;\n}\n.clip-ellipse {\nposition: absolute;\ncursor: move;\nborder: 1px solid #6d6;\nborder: var(--zoompx) solid #6d6;\nborder-radius: 50%;\ntransform-origin: 0px 0px;\n}",":host {\n--bounds-color: #d66;\n}",".guideline {\npointer-events: none;\nz-index: 2;\n}",".line.guideline.bounds {\nbackground: #d66;\nbackground: var(--bounds-color);\n}"],render:function(e,t){var n=e.props,r=n.customClipPath,o=n.defaultClipPath,i=n.clipArea,a=n.zoom,s=n.groupable,l=e.getState(),d=l.target,u=l.width,c=l.height,p=l.allMatrix,h=l.is3d,f=l.left,g=l.top,m=l.pos1,v=l.pos2,b=l.pos3,y=l.pos4,x=l.clipPathState,C=l.snapBoundInfos,w=l.rotation;if(!d||s)return[];var S=hC(d,u,c,o||"inset",x||r);if(!S)return[];var Z=h?4:3,k=S.type,M=S.poses.map((function(e){var t=Ny(p,e.pos,Z);return[t[0]-f,t[1]-g]})),D=[],E=[],R="rect"===k,T="inset"===k,_="polygon"===k;if(R||T||_){var I=T?M.slice(0,8):M;E=I.map((function(e,n){var r=0===n?I[I.length-1]:I[n-1],o=Lf(r,e),i=jy(r,e);return t.createElement("div",{key:"clipLine".concat(n),className:wy("line","clip-line","snap-control"),"data-clip-index":n,style:{width:"".concat(i,"px"),transform:"translate(".concat(r[0],"px, ").concat(r[1],"px) rotate(").concat(o,"rad) scaleY(").concat(a,")")}})}))}if(D=M.map((function(e,n){return t.createElement("div",{key:"clipControl".concat(n),className:wy("control","clip-control","snap-control"),"data-clip-index":n,style:{transform:"translate(".concat(e[0],"px, ").concat(e[1],"px) rotate(").concat(w,"rad) scale(").concat(a,")")}})})),T&&D.push.apply(D,Pm([],Om(M.slice(8).map((function(e,n){return t.createElement("div",{key:"clipRadiusControl".concat(n),className:wy("control","clip-control","clip-radius","snap-control"),"data-clip-index":8+n,style:{transform:"translate(".concat(e[0],"px, ").concat(e[1],"px) rotate(").concat(w,"rad) scale(").concat(a,")")}})}))),!1)),"circle"===k||"ellipse"===k){var O=S.left,P=S.top,z=S.radiusX,F=S.radiusY,N=Om(pg(Ny(p,[O,P],Z),Ny(p,[0,0],Z)),2),$=N[0],L=N[1],B="none";if(!i){for(var A=Math.max(10,z/5,F/5),j=[],H=0;H<=A;++H){var q=2*Math.PI/A*H;j.push([z+(z-a)*Math.cos(q),F+(F-a)*Math.sin(q)])}j.push([z,-2]),j.push([-2,-2]),j.push([-2,2*F+2]),j.push([2*z+2,2*F+2]),j.push([2*z+2,-2]),j.push([z,-2]),B="polygon(".concat(j.map((function(e){return"".concat(e[0],"px ").concat(e[1],"px")})).join(", "),")")}D.push(t.createElement("div",{key:"clipEllipse",className:wy("clip-ellipse","snap-control"),style:{width:"".concat(2*z,"px"),height:"".concat(2*F,"px"),clipPath:B,transform:"translate(".concat(-f+$,"px, ").concat(-g+L,"px) ").concat(Py(p))}}))}if(i){var U=Ly(Pm([m,v,b,y],Om(M),!1)),V=U.width,W=U.height,G=U.left,K=U.top;if(_||R||T){j=T?M.slice(0,8):M;D.push(t.createElement("div",{key:"clipArea",className:wy("clip-area","snap-control"),style:{width:"".concat(V,"px"),height:"".concat(W,"px"),transform:"translate(".concat(G,"px, ").concat(K,"px)"),clipPath:"polygon(".concat(j.map((function(e){return"".concat(e[0]-G,"px ").concat(e[1]-K,"px")})).join(", "),")")}}))}}return C&&["vertical","horizontal"].forEach((function(e){var n=C[e],r="horizontal"===e;n.isSnap&&E.push.apply(E,Pm([],Om(n.snap.posInfos.map((function(n,o){var i=n.pos,s=pg(Ny(p,r?[0,i]:[i,0],Z),[f,g]),l=pg(Ny(p,r?[u,i]:[i,c],Z),[f,g]);return Yv(t,"",s,l,a,"clip".concat(e,"snap").concat(o),"guideline")}))),!1)),n.isBound&&E.push.apply(E,Pm([],Om(n.bounds.map((function(n,o){var i=n.pos,s=pg(Ny(p,r?[0,i]:[i,0],Z),[f,g]),l=pg(Ny(p,r?[u,i]:[i,c],Z),[f,g]);return Yv(t,"",s,l,a,"clip".concat(e,"bounds").concat(o),"guideline","bounds","bold")}))),!1))})),Pm(Pm([],Om(D),!1),Om(E),!1)},dragControlCondition:function(e,t){return t.inputEvent&&(t.inputEvent.target.getAttribute("class")||"").indexOf("clip")>-1},dragStart:function(e,t){var n=e.props.dragWithClip;return!(void 0===n||n)&&this.dragControlStart(e,t)},drag:function(e,t){return this.dragControl(e,Im(Im({},t),{isDragTarget:!0}))},dragEnd:function(e,t){return this.dragControlEnd(e,t)},dragControlStart:function(e,t){var n=e.state,r=e.props,o=r.defaultClipPath,i=r.customClipPath,a=n.target,s=n.width,l=n.height,d=t.inputEvent?t.inputEvent.target:null,u=d&&d.getAttribute("class")||"",c=t.datas,p=hC(a,s,l,o||"inset",i);if(!p)return!1;var h=p.clipText;return!1===lx(e,"onClipStart",ix(e,t,{clipType:p.type,clipStyle:h,poses:p.poses.map((function(e){return e.pos}))}))?(c.isClipStart=!1,!1):(c.isControl=u&&u.indexOf("clip-control")>-1,c.isLine=u.indexOf("clip-line")>-1,c.isArea=u.indexOf("clip-area")>-1||u.indexOf("clip-ellipse")>-1,c.clipIndex=d?parseInt(d.getAttribute("data-clip-index"),10):-1,c.clipPath=p,c.isClipStart=!0,n.clipPathState=h,fv(e,t),!0)},dragControl:function(e,t){var n,r,o,i=t.datas,a=t.originalDatas,s=t.isDragTarget;if(!i.isClipStart)return!1;var l=i,d=l.isControl,u=l.isLine,c=l.isArea,p=l.clipIndex,h=l.clipPath;if(!h)return!1;var f=Uy(e.props,"clippable"),g=f.keepRatio,m=0,v=0,b=a.draggable,y=xv(t);s&&b?(n=Om(b.prevBeforeDist,2),m=n[0],v=n[1]):(r=Om(y,2),m=r[0],v=r[1]);var x=[m,v],C=e.state,w=C.width,S=C.height,Z=!c&&!d&&!u,k=h.type,M=h.poses,D=h.splitter,E=M.map((function(e){return e.pos}));Z&&(m=-m,v=-v);var R=!d||"nesw"===M[p].direction,T="inset"===k||"rect"===k,_=M.map((function(){return[0,0]}));if(d&&!R){var I=M[p],O=I.horizontal,P=I.vertical,z=[m*Ix(O),v*Ix(P)];_=function(e,t,n,r,o){var i=e[t],a=i.direction,s=i.sub,l=e.map((function(){return[0,0]})),d=a?a.split(""):[];if(r&&t<8){var u=d.filter((function(e){return"w"===e||"e"===e})),c=d.filter((function(e){return"n"===e||"s"===e})),p=u[0],h=c[0];l[t]=n;var f=Om(pC(e),2),g=f[0],m=f[1],v=g&&m?g/m:0;if(v&&o){var b=e[(t+4)%8].pos,y=[0,0];a.indexOf("w")>-1?y[0]=-1:a.indexOf("e")>-1&&(y[0]=1),a.indexOf("n")>-1?y[1]=-1:a.indexOf("s")>-1&&(y[1]=1);var x=kx([g,m],n,v,y,!0),C=g+x[0],w=m+x[1],S=b[1],Z=b[1],k=b[0],M=b[0];-1===y[0]?k=M-C:1===y[0]?M=k+C:(k-=C/2,M+=C/2),-1===y[1]?S=Z-w:Z=1===y[1]?S+w:(S=Z-w/2)+w;var D=cC(S,M,Z,k);e.forEach((function(e,t){l[t][0]=D[t].pos[0]-e.pos[0],l[t][1]=D[t].pos[1]-e.pos[1]}))}else e.forEach((function(e,t){var r=e.direction;r&&(r.indexOf(p)>-1&&(l[t][0]=n[0]),r.indexOf(h)>-1&&(l[t][1]=n[1]))})),p&&(l[1][0]=n[0]/2,l[5][0]=n[0]/2),h&&(l[3][1]=n[1]/2,l[7][1]=n[1]/2)}else a&&!s?d.forEach((function(t){var r="n"===t||"s"===t;e.forEach((function(e,o){var i=e.direction,a=e.horizontal,s=e.vertical;i&&-1!==i.indexOf(t)&&(l[o]=[r||!a?0:n[0],r&&s?n[1]:0])}))})):l[t]=n;return l}(M,p,z,T,g)}else R&&(_=E.map((function(){return[m,v]})));var F=E.map((function(e,t){return cg(e,_[t])})),N=Pm([],Om(F),!1);C.snapBoundInfos=null;var $="circle"===h.type,L="ellipse"===h.type;if($||L){var B=Ix((ne=Ly(F)).bottom-ne.top),A=Ix(L?ne.right-ne.left:B),j=F[0][1]+B,H=F[0][0]-A,q=F[0][0]+A;$&&(N.push([q,ne.bottom]),_.push([1,0])),N.push([ne.left,j]),_.push([0,1]),N.push([H,ne.bottom]),_.push([1,0])}var U=ay((f.clipHorizontalGuidelines||[]).map((function(e){return Pf("".concat(e),S)})),(f.clipVerticalGuidelines||[]).map((function(e){return Pf("".concat(e),w)})),w,S),V=[],W=[];if($||L)V=[N[4][0],N[2][0]],W=[N[1][1],N[3][1]];else if(T){var G=[N[0],N[2],N[4],N[6]],K=[_[0],_[2],_[4],_[6]];V=G.filter((function(e,t){return K[t][0]})).map((function(e){return e[0]})),W=G.filter((function(e,t){return K[t][1]})).map((function(e){return e[1]}))}else V=N.filter((function(e,t){return _[t][0]})).map((function(e){return e[0]})),W=N.filter((function(e,t){return _[t][1]})).map((function(e){return e[1]}));var Y=[0,0],X=Nb(U,f.clipTargetBounds&&{left:0,top:0,right:w,bottom:S},V,W,5),Q=X.horizontal,J=X.vertical,ee=Q.offset,te=J.offset;if(Q.isBound&&(Y[1]+=ee),J.isBound&&(Y[0]+=te),(L||$)&&0===_[0][0]&&0===_[0][1]){var ne,re=(ne=Ly(F)).bottom-ne.top,oe=L?ne.right-ne.left:re;oe-=J.isBound?Ix(te):0===J.snapIndex?-te:te,re-=Q.isBound?Ix(ee):0===Q.snapIndex?-ee:ee,$&&(oe=re=Cb(J,Q)>0?re:oe);var ie=N[0];N[1][1]=ie[1]-re,N[2][0]=ie[0]+oe,N[3][1]=ie[1]+re,N[4][0]=ie[0]-oe}else if(T&&g&&d){var ae=Om(pC(M),2),se=ae[0],le=ae[1],de=se&&le?se/le:0,ue=M[p].direction||"",ce=N[1][1];j=N[5][1],H=N[7][0],q=N[3][0];Ix(ee)<=Ix(te)?ee=_x(ee)*Ix(te)/de:te=_x(te)*Ix(ee)*de,ue.indexOf("w")>-1?H-=te:ue.indexOf("e")>-1?q-=te:(H+=te/2,q-=te/2),ue.indexOf("n")>-1?ce-=ee:ue.indexOf("s")>-1?j-=ee:(ce+=ee/2,j-=ee/2);var pe=cC(ce,q,j,H);N.forEach((function(e,t){var n;n=Om(pe[t].pos,2),e[0]=n[0],e[1]=n[1]}))}else N.forEach((function(e,t){var n=_[t];n[0]&&(e[0]-=te),n[1]&&(e[1]-=ee)}));var he=uC(e,h,F),fe="".concat(k,"(").concat(he.join(D),")");if(C.clipPathState=fe,$||L)V=[N[4][0],N[2][0]],W=[N[1][1],N[3][1]];else if(T){V=(G=[N[0],N[2],N[4],N[6]]).map((function(e){return e[0]})),W=G.map((function(e){return e[1]}))}else V=N.map((function(e){return e[0]})),W=N.map((function(e){return e[1]}));if(C.snapBoundInfos=Nb(U,f.clipTargetBounds&&{left:0,top:0,right:w,bottom:S},V,W,1),b){var ge=C.is3d,me=C.allMatrix,ve=ge?4:3,be=Y;s&&(be=[x[0]+Y[0]-y[0],x[1]+Y[1]-y[1]]),b.deltaOffset=ug(me,[be[0],be[1],0,0],ve)}return lx(e,"onClip",ix(e,t,Im({clipEventType:"changed",clipType:k,poses:F,clipStyle:fe,clipStyles:he,distX:m,distY:v},rx(((o={})["rect"===k?"clip":"clipPath"]=fe,o),t)))),!0},dragControlEnd:function(e,t){this.unset(e);var n=t.isDrag,r=t.datas,o=t.isDouble,i=r.isLine,a=r.isClipStart,s=r.isControl;return!!a&&(lx(e,"onClipEnd",ax(e,t,{})),o&&(s?gC(e,t):i&&fC(e,t)),o||n)},unset:function(e){e.state.clipPathState="",e.state.snapBoundInfos=null}},vC={name:"originDraggable",props:["originDraggable","originRelative"],events:["dragOriginStart","dragOrigin","dragOriginEnd"],css:[":host[data-able-origindraggable] .control.origin {\npointer-events: auto;\n}"],dragControlCondition:function(e,t){return t.isRequest?"originDraggable"===t.requestAble:qf(t.inputEvent.target,wy("origin"))},dragControlStart:function(e,t){var n=t.datas;fv(e,t);var r=ix(e,t,{dragStart:Bb.dragStart(e,(new cv).dragStart([0,0],t))}),o=lx(e,"onDragOriginStart",r);return n.startOrigin=e.state.transformOrigin,n.startTargetOrigin=e.state.targetOrigin,n.prevOrigin=[0,0],n.isDragOrigin=!0,!1===o?(n.isDragOrigin=!1,!1):r},dragControl:function(e,t){var n=t.datas,r=t.isPinch,o=t.isRequest;if(!n.isDragOrigin)return!1;var i=Om(xv(t),2),a=i[0],s=i[1],l=e.state,d=l.width,u=l.height,c=l.offsetMatrix,p=l.targetMatrix,h=l.is3d,f=e.props.originRelative,g=void 0===f||f,m=h?4:3,v=[a,s];if(o){var b=t.distOrigin;(b[0]||b[1])&&(v=b)}var y=cg(n.startOrigin,v),x=cg(n.startTargetOrigin,v),C=pg(v,n.prevOrigin),w=Sv(c,p,y,m),S=e.getRect(),Z=Ly($y(w,d,u,m)),k=[S.left-Z.left,S.top-Z.top];n.prevOrigin=v;var M=[bx(x[0],d,g),bx(x[1],u,g)].join(" "),D=Bb.drag(e,uv(t,e.state,k,!!r,!1)),E=ix(e,t,Im(Im({width:d,height:u,origin:y,dist:v,delta:C,transformOrigin:M,drag:D},rx({transformOrigin:M,transform:D.transform},t)),{afterTransform:D.transform}));return lx(e,"onDragOrigin",E),E},dragControlEnd:function(e,t){return!!t.datas.isDragOrigin&&(lx(e,"onDragOriginEnd",ax(e,t,{})),!0)},dragGroupControlCondition:function(e,t){return this.dragControlCondition(e,t)},dragGroupControlStart:function(e,t){return!!this.dragControlStart(e,t)},dragGroupControl:function(e,t){var n=this.dragControl(e,t);return!!n&&(e.transformOrigin=n.transformOrigin,!0)},request:function(e){var t={},n=e.getRect(),r=0,o=0,i=n.transformOrigin,a=[0,0];return{isControl:!0,requestStart:function(){return{datas:t}},request:function(e){return"deltaOrigin"in e?(a[0]+=e.deltaOrigin[0],a[1]+=e.deltaOrigin[1]):"origin"in e?(a[0]=e.origin[0]-i[0],a[1]=e.origin[1]-i[1]):("x"in e?r=e.x-n.left:"deltaX"in e&&(r+=e.deltaX),"y"in e?o=e.y-n.top:"deltaY"in e&&(o+=e.deltaY)),{datas:t,distX:r,distY:o,distOrigin:a}},requestEnd:function(){return{datas:t,isDrag:!0}}}}};function bC(e,t,n,r,o){void 0===r&&(r=[0,0]);return sC(e&&"0px"!==e?Zf(e):[],t,n,0,0,r,o)}function yC(e,t,n,r,o){var i=e.state,a=i.width,s=i.height,l=iC(o,e.props.roundRelative,a,s),d=l.raws,u=l.styles,c=function(e,t){return void 0===t&&(t=e.map((function(e){return e.raw}))),{horizontals:e.map((function(e,n){return e.horizontal?t[n]:null})).filter((function(e){return null!=e})),verticals:e.map((function(e,n){return e.vertical?t[n]:null})).filter((function(e){return null!=e}))}}(l.radiusPoses,d),p=c.horizontals,h=c.verticals,f=u.join(" ");i.borderRadiusState=f;var g=ix(e,t,Im({horizontals:p,verticals:h,borderRadius:f,width:a,height:s,delta:r,dist:n},rx({borderRadius:f},t)));return lx(e,"onRound",g),g}function xC(e){var t,n,r=e.getState().style,o=r.borderRadius||"";if(!o&&e.props.groupable){var i=e.moveables[0],a=e.getTargets()[0];a&&((null===i||void 0===i?void 0:i.props.target)===a?(o=null!==(n=null===(t=e.moveables[0])||void 0===t?void 0:t.state.style.borderRadius)&&void 0!==n?n:"",r.borderRadius=o):(o=dx(a).borderRadius,r.borderRadius=o))}return o}var CC={name:"roundable",props:["roundable","roundRelative","minRoundControls","maxRoundControls","roundClickable","roundPadding","isDisplayShadowRoundControls"],events:["roundStart","round","roundEnd","roundGroupStart","roundGroup","roundGroupEnd"],css:[".control.border-radius {\nbackground: #d66;\ncursor: pointer;\nz-index: 3;\n}",".control.border-radius.vertical {\nbackground: #d6d;\nz-index: 2;\n}",".control.border-radius.virtual {\nopacity: 0.5;\nz-index: 1;\n}",":host.round-line-clickable .line.direction {\ncursor: pointer;\n}"],className:function(e){var t=e.props.roundClickable;return!0===t||"line"===t?wy("round-line-clickable"):""},requestStyle:function(){return["borderRadius"]},requestChildStyle:function(){return["borderRadius"]},render:function(e,t){var n=e.getState(),r=n.target,o=n.width,i=n.height,a=n.allMatrix,s=n.is3d,l=n.left,d=n.top,u=n.borderRadiusState,c=e.props,p=c.minRoundControls,h=void 0===p?[0,0]:p,f=c.maxRoundControls,g=void 0===f?[4,4]:f,m=c.zoom,v=c.roundPadding,b=void 0===v?0:v,y=c.isDisplayShadowRoundControls,x=c.groupable;if(!r)return null;var C=u||xC(e),w=s?4:3,S=bC(C,o,i,h,!0);if(!S)return null;var Z=0,k=0,M=x?[0,0]:[l,d];return S.map((function(e,n){var r=e.horizontal,o=e.vertical,i=e.direction||"",s=Pm([],Om(e.pos),!1);k+=Math.abs(r),Z+=Math.abs(o),r&&i.indexOf("n")>-1&&(s[1]-=b),o&&i.indexOf("w")>-1&&(s[0]-=b),r&&i.indexOf("s")>-1&&(s[1]+=b),o&&i.indexOf("e")>-1&&(s[0]+=b);var l=pg(Ny(a,s,w),M),d=e.vertical?Z<=g[1]&&(y||!e.virtual):k<=g[0]&&(y||!e.virtual);return t.createElement("div",{key:"borderRadiusControl".concat(n),className:wy("control","border-radius",e.vertical?"vertical":"",e.virtual?"virtual":""),"data-radius-index":n,style:{display:d?"block":"none",transform:"translate(".concat(l[0],"px, ").concat(l[1],"px) scale(").concat(m,")")}})}))},dragControlCondition:function(e,t){if(!t.inputEvent||t.isRequest)return!1;var n=t.inputEvent.target.getAttribute("class")||"";return n.indexOf("border-radius")>-1||n.indexOf("moveable-line")>-1&&n.indexOf("moveable-direction")>-1},dragGroupControlCondition:function(e,t){return this.dragControlCondition(e,t)},dragControlStart:function(e,t){var n=t.inputEvent,r=t.datas,o=n.target,i=o.getAttribute("class")||"",a=i.indexOf("border-radius")>-1,s=i.indexOf("moveable-line")>-1&&i.indexOf("moveable-direction")>-1,l=a?parseInt(o.getAttribute("data-radius-index"),10):-1,d=-1;if(s){var u=o.getAttribute("data-line-key")||"";u&&(d=parseInt(u.replace(/render-line-/g,""),10),isNaN(d)&&(d=-1))}if(!a&&!s)return!1;var c=ix(e,t,{});if(!1===lx(e,"onRoundStart",c))return!1;r.lineIndex=d,r.controlIndex=l,r.isControl=a,r.isLine=s,fv(e,t);var p=e.props,h=p.roundRelative,f=p.minRoundControls,g=void 0===f?[0,0]:f,m=e.state,v=m.width,b=m.height;r.isRound=!0,r.prevDist=[0,0];var y=bC(xC(e)||"",v,b,g,!0)||[];return r.controlPoses=y,m.borderRadiusState=iC(y,h,v,b).styles.join(" "),c},dragControl:function(e,t){var n=t.datas,r=n.controlPoses;if(!n.isRound||!n.isControl||!r.length)return!1;var o=n.controlIndex,i=Om(xv(t),2),a=i[0],s=i[1],l=[a,s],d=pg(l,n.prevDist),u=e.props.maxRoundControls,c=void 0===u?[4,4]:u,p=e.state,h=p.width,f=p.height,g=r[o],m=g.vertical,v=g.horizontal,b=r.map((function(e){var t=e.horizontal,n=e.vertical,r=[t*v*l[0],n*m*l[1]];if(t){if(1===c[0])return r;if(c[0]<4&&t!==v)return r}else{if(0===c[1])return r[1]=n*v*l[0]/h*f,r;if(m){if(1===c[1])return r;if(c[1]<4&&n!==m)return r}}return[0,0]}));b[o]=l;var y=r.map((function(e,t){return Im(Im({},e),{pos:cg(e.pos,b[t])})}));return o<4?y.slice(0,o+1).forEach((function(e){e.virtual=!1})):y.slice(4,o+1).forEach((function(e){e.virtual=!1})),n.prevDist=[a,s],yC(e,t,l,d,y)},dragControlEnd:function(e,t){var n=e.state;n.borderRadiusState="";var r=t.datas,o=t.isDouble;if(!r.isRound)return!1;var i=r.isControl,a=r.controlIndex,s=r.isLine,l=r.lineIndex,d=r.controlPoses,u=d.filter((function(e){return e.virtual})).length,c=e.props.roundClickable,p=void 0===c||c;if(o&&p){if(!i||!0!==p&&"control"!==p){if(s&&(!0===p||"line"===p)){var h=Om(hv(e,t),2);!function(e,t,n,r){var o=e.filter((function(e){var t=e.virtual;return e.horizontal&&!t})).length,i=e.filter((function(e){var t=e.virtual;return e.vertical&&!t})).length,a=-1;if(0===t&&(0===o?a=0:1===o&&(a=1)),2===t&&(o<=2?a=2:o<=3&&(a=3)),3===t&&(0===i?a=4:i<4&&(a=7)),1===t&&(i<=1?a=5:i<=2&&(a=6)),-1!==a&&e[a].virtual){var s=e[a];!function(e,t){t<4?e.slice(0,t+1).forEach((function(e){e.virtual=!1})):(e[0].virtual&&(e[0].virtual=!1),e.slice(4,t+1).forEach((function(e){e.virtual=!1})))}(e,a),a<4?s.pos[0]=n:s.pos[1]=r}}(d,l,h[0],h[1])}}else!function(e,t){t<4?e.slice(t,4).forEach((function(e){e.virtual=!0})):e.slice(t).forEach((function(e){e.virtual=!0}))}(d,a);u!==d.filter((function(e){return e.virtual})).length&&yC(e,t,[0,0],[0,0],d)}var f=ax(e,t,{});return lx(e,"onRoundEnd",f),n.borderRadiusState="",f},dragGroupControlStart:function(e,t){var n=this.dragControlStart(e,t);if(!n)return!1;var r=e.moveables,o=e.props.targets,i=qv(e,"roundable",t);return lx(e,"onRoundGroupStart",Im({targets:e.props.targets,events:i.map((function(e,t){return Im(Im({},e),{target:o[t],moveable:r[t],currentTarget:r[t]})}))},n)),n},dragGroupControl:function(e,t){var n=this.dragControl(e,t);if(!n)return!1;var r=e.moveables,o=e.props.targets,i=qv(e,"roundable",t),a=Im({targets:e.props.targets,events:i.map((function(e,t){return Im(Im(Im({},e),{target:o[t],moveable:r[t],currentTarget:r[t]}),rx({borderRadius:n.borderRadius},e))}))},n);return lx(e,"onRoundGroup",a),a},dragGroupControlEnd:function(e,t){var n=e.moveables,r=e.props.targets,o=qv(e,"roundable",t);sx(e,"onRound",(function(t){var i=Im({targets:e.props.targets,events:o.map((function(e,o){return Im(Im(Im({},e),{target:r[o],moveable:n[o],currentTarget:n[o]}),rx({borderRadius:t.borderRadius},e))}))},t);lx(e,"onRoundGroup",i)}));var i=this.dragControlEnd(e,t);if(!i)return!1;var a=Im({targets:e.props.targets,events:o.map((function(e,t){var o;return Im(Im({},e),{target:r[t],moveable:n[t],currentTarget:n[t],lastEvent:null===(o=e.datas)||void 0===o?void 0:o.lastEvent})}))},i);return lx(e,"onRoundGroupEnd",a),a},unset:function(e){e.state.borderRadiusState=""}};var wC={isPinch:!0,name:"beforeRenderable",props:[],events:["beforeRenderStart","beforeRender","beforeRenderEnd","beforeRenderGroupStart","beforeRenderGroup","beforeRenderGroupEnd"],dragRelation:"weak",setTransform:function(e,t){var n=e.state,r=n.is3d,o=n.targetMatrix,i=n.inlineTransform,a=r?"matrix3d(".concat(o.join(","),")"):"matrix(".concat(hg(o,!0),")"),s=i&&"none"!==i?i:a;t.datas.startTransforms=function(e,t){var n=Sg(t?4:3);return e==="matrix".concat(t?"3d":"","(").concat(n.join(","),")")||"matrix(1,0,0,1,0,0)"===e}(s,r)?[]:Zf(s)},resetStyle:function(e){var t=e.datas;t.nextStyle={},t.nextTransforms=e.datas.startTransforms,t.nextTransformAppendedIndexes=[]},fillDragStartParams:function(e,t){return ix(e,t,{setTransform:function(e){t.datas.startTransforms=vf(e)?e:Zf(e)},isPinch:!!t.isPinch})},fillDragParams:function(e,t){return ix(e,t,{isPinch:!!t.isPinch})},dragStart:function(e,t){this.setTransform(e,t),this.resetStyle(t),lx(e,"onBeforeRenderStart",this.fillDragStartParams(e,t))},drag:function(e,t){t.datas.startTransforms||this.setTransform(e,t),this.resetStyle(t),lx(e,"onBeforeRender",ix(e,t,{isPinch:!!t.isPinch}))},dragEnd:function(e,t){t.datas.startTransforms||(this.setTransform(e,t),this.resetStyle(t)),lx(e,"onBeforeRenderEnd",ix(e,t,{isPinch:!!t.isPinch,isDrag:t.isDrag}))},dragGroupStart:function(e,t){var n=this;this.dragStart(e,t);var r=qv(e,"beforeRenderable",t),o=e.moveables,i=r.map((function(e,t){var r=o[t];return n.setTransform(r,e),n.resetStyle(e),n.fillDragStartParams(r,e)}));lx(e,"onBeforeRenderGroupStart",ix(e,t,{isPinch:!!t.isPinch,targets:e.props.targets,setTransform:function(){},events:i}))},dragGroup:function(e,t){var n=this;this.drag(e,t);var r=qv(e,"beforeRenderable",t),o=e.moveables,i=r.map((function(e,t){var r=o[t];return n.resetStyle(e),n.fillDragParams(r,e)}));lx(e,"onBeforeRenderGroup",ix(e,t,{isPinch:!!t.isPinch,targets:e.props.targets,events:i}))},dragGroupEnd:function(e,t){this.dragEnd(e,t),lx(e,"onBeforeRenderGroupEnd",ix(e,t,{isPinch:!!t.isPinch,isDrag:t.isDrag,targets:e.props.targets}))},dragControlStart:function(e,t){return this.dragStart(e,t)},dragControl:function(e,t){return this.drag(e,t)},dragControlEnd:function(e,t){return this.dragEnd(e,t)},dragGroupControlStart:function(e,t){return this.dragGroupStart(e,t)},dragGroupControl:function(e,t){return this.dragGroup(e,t)},dragGroupControlEnd:function(e,t){return this.dragGroupEnd(e,t)}},SC={name:"renderable",props:[],events:["renderStart","render","renderEnd","renderGroupStart","renderGroup","renderGroupEnd"],dragRelation:"weak",dragStart:function(e,t){lx(e,"onRenderStart",ix(e,t,{isPinch:!!t.isPinch}))},drag:function(e,t){lx(e,"onRender",this.fillDragParams(e,t))},dragAfter:function(e,t){return this.drag(e,t)},dragEnd:function(e,t){lx(e,"onRenderEnd",this.fillDragEndParams(e,t))},dragGroupStart:function(e,t){lx(e,"onRenderGroupStart",ix(e,t,{isPinch:!!t.isPinch,targets:e.props.targets}))},dragGroup:function(e,t){var n=this,r=qv(e,"beforeRenderable",t),o=e.moveables,i=r.map((function(e,t){var r=o[t];return n.fillDragParams(r,e)}));lx(e,"onRenderGroup",ix(e,t,Im(Im({isPinch:!!t.isPinch,targets:e.props.targets,transform:Tv(t),transformObject:{}},rx(_v(t))),{events:i})))},dragGroupEnd:function(e,t){var n=this,r=qv(e,"beforeRenderable",t),o=e.moveables,i=r.map((function(e,t){var r=o[t];return n.fillDragEndParams(r,e)}));lx(e,"onRenderGroupEnd",ix(e,t,Im({isPinch:!!t.isPinch,isDrag:t.isDrag,targets:e.props.targets,events:i,transformObject:{},transform:Tv(t)},rx(_v(t)))))},dragControlStart:function(e,t){return this.dragStart(e,t)},dragControl:function(e,t){return this.drag(e,t)},dragControlAfter:function(e,t){return this.dragAfter(e,t)},dragControlEnd:function(e,t){return this.dragEnd(e,t)},dragGroupControlStart:function(e,t){return this.dragGroupStart(e,t)},dragGroupControl:function(e,t){return this.dragGroup(e,t)},dragGroupControlEnd:function(e,t){return this.dragGroupEnd(e,t)},fillDragParams:function(e,t){var n={};return Tg(Rv(t)||[]).forEach((function(e){n[e.name]=e.functionValue})),ix(e,t,Im({isPinch:!!t.isPinch,transformObject:n,transform:Tv(t)},rx(_v(t))))},fillDragEndParams:function(e,t){var n={};return Tg(Rv(t)||[]).forEach((function(e){n[e.name]=e.functionValue})),ix(e,t,Im({isPinch:!!t.isPinch,isDrag:t.isDrag,transformObject:n,transform:Tv(t)},rx(_v(t))))}};function ZC(e,t,n,r,o,i,a){i.clientDistX=i.distX,i.clientDistY=i.distY;var s="Start"===o,l="End"===o,d="After"===o,u=e.state.target,c=i.isRequest,p=r.indexOf("Control")>-1;if(!u||s&&p&&!c&&e.areaElement===i.inputEvent.target)return!1;var h=Pm([],Om(t),!1);if(c){var f=i.requestAble;h.some((function(e){return e.name===f}))||h.push.apply(h,Pm([],Om(e.props.ables.filter((function(e){return e.name===f}))),!1))}if(!h.length||h.every((function(e){return e.dragRelation})))return!1;var g,m=i.inputEvent;l&&m&&(g=document.elementFromPoint(i.clientX,i.clientY)||m.target);var v=!1,b=function(){var e;v=!0,null===(e=i.stop)||void 0===e||e.call(i)},y=s&&(!e.targetGesto||!e.controlGesto||!e.targetGesto.isFlag()||!e.controlGesto.isFlag());y&&e.updateRect(o,!0,!1);var x=i.datas,C=p?"controlGesto":"targetGesto",w=e[C],S=function(t,n,r){if(!(n in t)||w!==e[C])return!1;var o=t.name,a=x[o]||(x[o]={});if(s&&(a.isEventStart=!r||!t[r]||t[r](e,i)),!a.isEventStart)return!1;var l=t[n](e,Im(Im({},i),{stop:b,datas:a,originalDatas:x,inputTarget:g}));return e._emitter.off(),s&&!1===l&&(a.isEventStart=!1),l};y&&h.forEach((function(t){t.unset&&t.unset(e)})),S(wC,"drag".concat(r).concat(o));var Z=0,k=0;n.forEach((function(t){if(v)return!1;var n="".concat(t).concat(r).concat(o),a="".concat(t).concat(r,"Condition");""!==o||c||mx(e.state,i);var l=h.filter((function(e){return e[n]})),d=(l=l.filter((function(e,t){return e.name&&l.indexOf(e)===t}))).filter((function(e){return S(e,n,a)})).length;v&&++Z,d&&++k,!v&&s&&l.length&&!d&&(Z+=l.filter((function(e){var t=e.name;return!!x[t].isEventStart&&"strong"!==e.dragRelation})).length?1:0)})),d&&!k||S(SC,"drag".concat(r).concat(o));var M=w!==e[C]||Z===n.length;if((l||v||M)&&(e.state.gestos={},e.moveables&&e.moveables.forEach((function(e){e.state.gestos={}})),h.forEach((function(t){t.unset&&t.unset(e)}))),s&&!M&&!c&&k&&e.props.preventDefault&&(null===i||void 0===i||i.preventDefault()),e.isUnmounted||M)return!1;(!s&&k&&!a||l)&&(e.props.flushSync||Sy)((function(){e.updateRect(l?o:"",!0,!1),e.forceUpdate()}));return s||l||d||!k||a||ZC(e,t,n,r,o+"After",i),!0}function kC(e){return function(t){var n,r=t.inputEvent.target,o=e.areaElement,i=e._dragTarget;return!(!i||(null===(n=e.controlGesto)||void 0===n?void 0:n.isFlag()))&&(r===i||i.contains(r)||r===o||!e.isMoveableElement(r)&&!e.controlBox.contains(r)||qf(r,"moveable-area")||qf(r,"moveable-padding")||qf(r,"moveable-edgeDraggable"))}}function MC(e,t,n){var r=e.controlBox,o=[],i=e.props,a=i.dragArea,s=e.state.target,l=i.dragTarget;return o.push(r),a&&!l||o.push(t),!a&&l&&s&&t!==s&&i.dragTargetSelf&&o.push(s),DC(e,o,"targetAbles",n,{dragStart:kC(e),pinchStart:kC(e)})}function DC(e,t,n,r,o){void 0===o&&(o={});var i="targetAbles"===n,a=e.props,s=a.pinchOutside,l=a.pinchThreshold,d=a.preventClickEventOnDrag,u=a.preventClickDefault,c=a.checkInput,p=a.dragFocusedInput,h=a.preventDefault,f={preventDefault:void 0===h||h,preventRightClick:!0,preventWheelClick:!0,container:wx(a.dragContainer,!0)||Qf(e.getControlBoxElement()),pinchThreshold:l,pinchOutside:s,preventClickEventOnDrag:!!i&&d,preventClickEventOnDragStart:!!i&&u,preventClickEventByCondition:i?null:function(t){return e.controlBox.contains(t.target)},checkInput:!!i&&c,dragFocusedInput:p},g=new Cm(t,f),m="Control"===r;return["drag","pinch"].forEach((function(t){["Start","","End"].forEach((function(i){g.on("".concat(t).concat(i),(function(a){var s,l=a.eventType,d="drag"===t&&a.isPinch;if(!o[l]||o[l](a)){if(!d){var u="drag"===t?[t]:["drag",t],c=Pm([],Om(e[n]),!1);ZC(e,c,u,r,i,a)?(e.props.stopPropagation||"Start"===i&&m)&&(null===(s=null===a||void 0===a?void 0:a.inputEvent)||void 0===s||s.stopPropagation()):a.stop()}}else a.stop()}))}))})),g}var EC=function(){function e(e,t,n){var r=this;this.target=e,this.moveable=t,this.eventName=n,this.ables=[],this._onEvent=function(e){var t=r.eventName,n=r.moveable;n.state.disableNativeEvent||r.ables.forEach((function(r){r[t](n,{inputEvent:e})}))},e.addEventListener(n.toLowerCase(),this._onEvent)}return e.prototype.setAbles=function(e){this.ables=e},e.prototype.destroy=function(){this.target.removeEventListener(this.eventName.toLowerCase(),this._onEvent),this.target=null,this.moveable=null},e}();function RC(e,t,n,r){var o;void 0===n&&(n=t);var i=$v(e,t),a=i.matrixes,s=i.is3d,l=i.targetMatrix,d=i.transformOrigin,u=i.targetOrigin,c=i.offsetContainer,p=i.hasFixed,h=i.zoom,f=function(e,t){if(Av){var n=Tf(Av,(function(n){return n[0][0]==e&&n[0][1]==t}));if(n)return n[1]}var r=$v(e,t,!0);return Av&&Av.push([[e,t],r]),r}(c,n),g=f.matrixes,m=f.is3d,v=f.offsetContainer,b=f.zoom,y=r||m||s,x=y?4:3,C="svg"!==e.tagName.toLowerCase()&&"ownerSVGElement"in e,w=l,S=Sg(x),Z=Sg(x),k=Sg(x),M=Sg(x),D=a.length,E=g.map((function(e){return Im(Im({},e),{matrix:e.matrix?Pm([],Om(e.matrix),!1):void 0})})).reverse();a.reverse(),!s&&y&&(w=lg(w,3,4),Iy(a)),!m&&y&&Iy(E),E.forEach((function(e){Z=ug(Z,e.matrix,x)}));var R=n||Xf(e),T=(null===(o=E[0])||void 0===o?void 0:o.target)||Ry(R,R,!0).offsetParent,_=E.slice(1).reduce((function(e,t){return ug(e,t.matrix,x)}),Sg(x));a.forEach((function(e,t){if(D-2===t&&(k=S.slice()),D-1===t&&(M=S.slice()),!e.matrix){var n=function(e,t,n,r,o){var i,a=e.target,s=e.origin,l=t.matrix,d=Vy(a),u=d.offsetWidth,c=d.offsetHeight,p=n.getBoundingClientRect(),h=[0,0];n===Xf(n)&&(h=_y(a,!0));for(var f=a.getBoundingClientRect(),g=f.left-p.left+n.scrollLeft-(n.clientLeft||0)+h[0],m=f.top-p.top+n.scrollTop-(n.clientTop||0)+h[1],v=f.width,b=f.height,y=dg(r,o,l),x=By(y,u,c,r),C=x.left,w=x.top,S=x.width,Z=x.height,k=Ny(y,s,r),M=pg(k,[C,w]),D=[g+M[0]*v/S,m+M[1]*b/Z],E=[0,0],R=0;++R<10;){var T=ig(o,r);i=Om(pg(Ny(T,D,r),Ny(T,k,r)),2),E[0]=i[0],E[1]=i[1];var _=By(dg(r,o,kg(E,r),l),u,c,r),I=_.left-g,O=_.top-m;if(Ix(I)<2&&Ix(O)<2)break;D[0]-=I,D[1]-=O}return E.map((function(e){return Math.round(e)}))}(e,a[t+1],T,x,ug(_,S,x));e.matrix=kg(n,x)}S=ug(S,e.matrix,x)}));var I=!C&&s;w||(w=Sg(I?4:3));var O=Py(C&&16===w.length?lg(w,4,3):w,I),P=Z;return Z=og(Z,x,x),{hasZoom:1!==h||1!==b,hasFixed:p,matrixes:a,rootMatrix:Z,originalRootMatrix:P,beforeMatrix:k,offsetMatrix:M,allMatrix:S,targetMatrix:w,targetTransform:O,inlineTransform:e.style.transform,transformOrigin:d,targetOrigin:u,is3d:y,offsetContainer:c,offsetRootContainer:v}}function TC(e,t,n,r){void 0===n&&(n=t);var o=0,i=0,a=0,s={},l=Vy(e);if(e&&(o=l.offsetWidth,i=l.offsetHeight),e){var d=RC(e,t,n,r),u=pv(d.allMatrix,d.transformOrigin,o,i);s=Im(Im({},d),u);var c=pv(d.allMatrix,[50,50],100,100);a=Wy([c.pos1,c.pos2],c.direction)}var p=r?4:3;return Im(Im(Im({hasZoom:!1,width:o,height:i,rotation:a},l),{originalRootMatrix:Sg(p),rootMatrix:Sg(p),beforeMatrix:Sg(p),offsetMatrix:Sg(p),allMatrix:Sg(p),targetMatrix:Sg(p),targetTransform:"",inlineTransform:"",transformOrigin:[0,0],targetOrigin:[0,0],is3d:!!r,left:0,top:0,right:0,bottom:0,origin:[0,0],pos1:[0,0],pos2:[0,0],pos3:[0,0],pos4:[0,0],direction:1,hasFixed:!1,offsetContainer:null,offsetRootContainer:null,matrixes:[]}),s)}function _C(e,t,n,r,o,i){void 0===i&&(i=[]);var a=1,s=[0,0],l={left:0,top:0,width:0,height:0,right:0,bottom:0,clientLeft:0,clientTop:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0},d={left:0,top:0,width:0,height:0,right:0,bottom:0,clientLeft:0,clientTop:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0},u={left:0,top:0,width:0,height:0,right:0,bottom:0,clientLeft:0,clientTop:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0},c={left:0,top:0,width:0,height:0,right:0,bottom:0,clientLeft:0,clientTop:0,clientWidth:0,clientHeight:0,scrollWidth:0,scrollHeight:0},p=[0,0],h={},f=TC(t,n,o,!0);if(t){var g=Hv(t);i.forEach((function(e){h[e]=g(e)}));var m=f.is3d?4:3,v=pv(f.offsetMatrix,cg(f.transformOrigin,ag(f.targetMatrix,m)),f.width,f.height);a=v.direction,s=cg(v.origin,[v.left-f.left,v.top-f.top]),c=Yy(f.offsetRootContainer);var b=Ry(r,r,!0).offsetParent||f.offsetRootContainer;if(f.hasZoom){var y=pv(ug(f.originalRootMatrix,f.allMatrix),f.transformOrigin,f.width,f.height),x=pv(f.originalRootMatrix,Dy(Hv(b)("transformOrigin")).map((function(e){return parseFloat(e)})),b.offsetWidth,b.offsetHeight);if(l=Ky(y,c),u=Ky(x,c,b,!0),e){var C=y.left,w=y.top;d=Ky({left:C,top:w,bottom:w,right:w},c)}}else{l=Yy(t),u=function(e){var t=null===Bv||void 0===Bv?void 0:Bv.get(e);if(t)return t;var n=Yy(e,!0);return Bv&&Bv.set(e,n),n}(b),e&&(d=Yy(e));var S=u.left,Z=u.top,k=u.clientLeft,M=u.clientTop,D=[l.left-S,l.top-Z];p=pg(gx(f.rootMatrix,D,4),[k+f.left,M+f.top])}}return Im({targetClientRect:l,containerClientRect:u,moveableClientRect:d,rootContainerClientRect:c,beforeDirection:a,beforeOrigin:s,originalBeforeOrigin:s,target:t,style:h,offsetDelta:p},f)}function IC(e){var t=e.pos1,n=e.pos2,r=e.pos3,o=e.pos4;if(!t||!n||!r||!o)return null;var i=rm([t,n,r,o]),a=[i.minX,i.minY],s=pg(e.origin,a);return t=pg(t,a),n=pg(n,a),r=pg(r,a),o=pg(o,a),Im(Im({},e),{left:e.left,top:e.top,posDelta:a,pos1:t,pos2:n,pos3:r,pos4:o,origin:s,beforeOrigin:s,isPersisted:!0})}var OC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=Im({container:null,gestos:{},renderPoses:[[0,0],[0,0],[0,0],[0,0]],disableNativeEvent:!1,posDelta:[0,0]},_C(null)),t.renderState={},t.enabledAbles=[],t.targetAbles=[],t.controlAbles=[],t.rotation=0,t.scale=[1,1],t.isMoveableMounted=!1,t.isUnmounted=!1,t.events={mouseEnter:null,mouseLeave:null},t._emitter=new Ug,t._prevOriginalDragTarget=null,t._originalDragTarget=null,t._prevDragTarget=null,t._dragTarget=null,t._prevPropTarget=null,t._propTarget=null,t._prevDragArea=!1,t._isPropTargetChanged=!1,t._hasFirstTarget=!1,t._reiszeObserver=null,t._observerId=0,t._mutationObserver=null,t._rootContainer=null,t._viewContainer=null,t._viewClassNames=[],t._store={},t.checkUpdateRect=function(){if(!t.isDragging()){var e=t.props.parentMoveable;e?e.checkUpdateRect():(If(t._observerId),t._observerId=_f((function(){t.isDragging()||t.updateRect()})))}},t._onPreventClick=function(e){e.stopPropagation(),e.preventDefault()},t}return _m(t,e),t.prototype.render=function(){var e=this.props,t=this.getState(),n=e.parentPosition,r=e.className,o=e.target,i=e.zoom,s=e.cspNonce,l=e.translateZ,d=e.cssStyled,u=e.groupable,c=e.linePadding,p=e.controlPadding;this._checkUpdateRootContainer(),this.checkUpdate(),this.updateRenderPoses();var h=Om(n||[0,0],2),f=h[0],g=h[1],m=t.left,v=t.top,b=t.target,y=t.direction,x=t.hasFixed,C=t.offsetDelta,w=e.targets,S=this.isDragging(),Z={};this.getEnabledAbles().forEach((function(e){Z["data-able-".concat(e.name.toLowerCase())]=!0}));var k=this._getAbleClassName(),M=w&&w.length&&(b||u)||o||!this._hasFirstTarget&&this.state.isPersisted,D=this.controlBox||this.props.firstRenderState||this.props.persistData,E=[m-f,v-g];!u&&e.useAccuratePosition&&(E[0]+=C[0],E[1]+=C[1]);var R={position:x?"fixed":"absolute",display:M?"block":"none",visibility:D?"visible":"hidden",transform:"translate3d(".concat(E[0],"px, ").concat(E[1],"px, ").concat(l,")"),"--zoom":i,"--zoompx":"".concat(i,"px")};return c&&(R["--moveable-line-padding"]=c),p&&(R["--moveable-control-padding"]=p),a.createElement(d,Im({cspNonce:s,ref:tf(this,"controlBox"),className:"".concat(wy("control-box",-1===y?"reverse":"",S?"dragging":"")," ").concat(k," ").concat(r)},Z,{onClick:this._onPreventClick,style:R}),this.renderAbles(),this._renderLines())},t.prototype.componentDidMount=function(){this.isMoveableMounted=!0,this.isUnmounted=!1;var e=this.props,t=e.parentMoveable,n=e.container;this._checkUpdateRootContainer(),this._checkUpdateViewContainer(),this._updateTargets(),this._updateNativeEvents(),this._updateEvents(),this.updateCheckInput(),this._updateObserver(this.props),n||t||this.state.isPersisted||(this.updateRect("",!1,!1),this.forceUpdate())},t.prototype.componentDidUpdate=function(e){this._checkUpdateRootContainer(),this._checkUpdateViewContainer(),this._updateNativeEvents(),this._updateTargets(),this._updateEvents(),this.updateCheckInput(),this._updateObserver(e)},t.prototype.componentWillUnmount=function(){var e,t;this.isMoveableMounted=!1,this.isUnmounted=!0,this._emitter.off(),null===(e=this._reiszeObserver)||void 0===e||e.disconnect(),null===(t=this._mutationObserver)||void 0===t||t.disconnect(),this._viewContainer&&this._changeAbleViewClassNames([]),nx(this,!1),nx(this,!0);var n=this.events;for(var r in n){var o=n[r];o&&o.destroy()}},t.prototype.getTargets=function(){var e=this.props.target;return e?[e]:[]},t.prototype.getAble=function(e){return Tf(this.props.ables||[],(function(t){return t.name===e}))},t.prototype.getContainer=function(){var e=this.props,t=e.parentMoveable,n=e.wrapperMoveable;return e.container||n&&n.getContainer()||t&&t.getContainer()||this.controlBox.parentElement},t.prototype.getControlBoxElement=function(){return this.controlBox},t.prototype.getDragElement=function(){return this._dragTarget},t.prototype.isMoveableElement=function(e){var t;return e&&((null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"class"))||"").indexOf(Xm)>-1},t.prototype.dragStart=function(e){var t=this.targetGesto,n=this.controlGesto;return t&&kC(this)({inputEvent:e})?t.isFlag()||t.triggerDragStart(e):n&&this.isMoveableElement(e.target)&&(n.isFlag()||n.triggerDragStart(e)),this},t.prototype.hitTest=function(e){var t,n=this.state,r=n.target,o=n.pos1,i=n.pos2,a=n.pos3,s=n.pos4,l=n.targetClientRect;if(!r)return 0;if(eg(e)){var d=e.getBoundingClientRect();t={left:d.left,top:d.top,width:d.width,height:d.height}}else t=Im({width:0,height:0},e);var u=t.left,c=t.top,p=t.width,h=t.height,f=nm([o,i,s,a],l),g=um(f,[[u,c],[u+p,c],[u+p,c+h],[u,c+h]]),m=tm(f);return g&&m?Math.min(100,g/m*100):0},t.prototype.isInside=function(e,t){var n=this.state,r=n.target,o=n.pos1,i=n.pos2,a=n.pos3,s=n.pos4,l=n.targetClientRect;return!!r&&om([e,t],nm([o,i,s,a],l))},t.prototype.updateRect=function(e,t,n){void 0===n&&(n=!0);var r=this.props,o=!r.parentPosition&&!r.wrapperMoveable;o&&jv(!0);var i=r.parentMoveable,a=this.state.target||r.target,s=this.getContainer(),l=i?i._rootContainer:this._rootContainer,d=_C(this.controlBox,a,s,s,l||s,this._getRequestStyles());if(!a&&this._hasFirstTarget&&r.persistData){var u=IC(r.persistData);for(var c in u)d[c]=u[c]}o&&jv(),this.updateState(d,!i&&n)},t.prototype.isDragging=function(e){var t,n,r=this.targetGesto,o=this.controlGesto;return(null===r||void 0===r?void 0:r.isFlag())?!e||!!(null===(t=r.getEventData()[e])||void 0===t?void 0:t.isEventStart):!!(null===o||void 0===o?void 0:o.isFlag())&&(!e||!!(null===(n=o.getEventData()[e])||void 0===n?void 0:n.isEventStart))},t.prototype.updateTarget=function(e){this.updateRect(e,!0)},t.prototype.getRect=function(){var e=this.state,t=ex(this.state),n=Om(t,4),r=n[0],o=n[1],i=n[2],a=n[3],s=Ly(t),l=e.width,d=e.height,u=s.width,c=s.height,p=s.left,h=s.top,f=[e.left,e.top],g=cg(f,e.origin);return{width:u,height:c,left:p,top:h,pos1:r,pos2:o,pos3:i,pos4:a,offsetWidth:l,offsetHeight:d,beforeOrigin:cg(f,e.beforeOrigin),origin:g,transformOrigin:e.transformOrigin,rotation:this.getRotation()}},t.prototype.getManager=function(){return this},t.prototype.stopDrag=function(e){var t;e&&"target"!==e||(!1===(null===(t=this.targetGesto)||void 0===t?void 0:t.isIdle())&&tx(this,!1),null===t||void 0===t||t.stop());e&&"control"!==e||(!1===(null===(t=this.controlGesto)||void 0===t?void 0:t.isIdle())&&tx(this,!0),null===t||void 0===t||t.stop())},t.prototype.getRotation=function(){var e=this.state;return function(e,t,n){var r=Lf(e,t)/Math.PI*180;return(r=n>=0?r:180-r)>=0?r:360+r}(e.pos1,e.pos2,e.direction)},t.prototype.request=function(e,t,n){void 0===t&&(t={});var r=this,o=r.props,i=o.parentMoveable||o.wrapperMoveable||r,a=i.props.ables,s=o.groupable,l=Tf(a,(function(t){return t.name===e}));if(this.isDragging()||!l||!l.request)return{request:function(){return this},requestEnd:function(){return this}};var d=l.request(r),u=n||t.isInstant,c=d.isControl?"controlAbles":"targetAbles",p="".concat(s?"Group":"").concat(d.isControl?"Control":""),h=Pm([],Om(i[c]),!1),f={request:function(t){return ZC(r,h,["drag"],p,"",Im(Im({},d.request(t)),{requestAble:e,isRequest:!0}),u),f},requestEnd:function(){return ZC(r,h,["drag"],p,"End",Im(Im({},d.requestEnd()),{requestAble:e,isRequest:!0}),u),f}};return ZC(r,h,["drag"],p,"Start",Im(Im({},d.requestStart(t)),{requestAble:e,isRequest:!0}),u),u?f.request(t).requestEnd():f},t.prototype.getMoveables=function(){return[this]},t.prototype.destroy=function(){this.componentWillUnmount()},t.prototype.updateRenderPoses=function(){var e=this.getState(),t=this.props,n=t.padding,r=e.originalBeforeOrigin,o=e.transformOrigin,i=e.allMatrix,a=e.is3d,s=e.pos1,l=e.pos2,d=e.pos3,u=e.pos4,c=e.left,p=e.top,h=e.isPersisted;if(n){var f=Px(n),g=f.left,m=f.top,v=f.bottom,b=f.right,y=a?4:3,x=dg(y,kg((h?o:this.controlBox&&t.groupable?r:cg(r,[c,p])).map((function(e){return-e})),y),i,kg(o,y));e.renderPoses=[vx(x,s,[-g,-m],y),vx(x,l,[b,-m],y),vx(x,d,[-g,v],y),vx(x,u,[b,v],y)]}else e.renderPoses=[s,l,d,u]},t.prototype.checkUpdate=function(){this._isPropTargetChanged=!1;var e=this.props,t=e.target,n=e.container,r=e.parentMoveable,o=this.state,i=o.target,a=o.container;if(i||t){this.updateAbles();var s=!cx(i,t);if(s||!cx(a,n)){var l=n||this.controlBox;l&&this.unsetAbles(),this.updateState({target:t,container:n}),!r&&l&&this.updateRect("End",!1,!1),this._isPropTargetChanged=s}}},t.prototype.waitToChangeTarget=function(){return new Promise((function(){}))},t.prototype.triggerEvent=function(e,t){var n=this.props;if(this._emitter.trigger(e,t),n.parentMoveable&&t.isRequest&&!t.isRequestChild)return n.parentMoveable.triggerEvent(e,t,!0);var r=n[e];return r&&r(t)},t.prototype.useCSS=function(e,t){var n=this.props.customStyledMap,r=e+t;return n[r]||(n[r]=Rm(e,t)),n[r]},t.prototype.getState=function(){var e,t=this.props;(t.target||(null===(e=t.targets)||void 0===e?void 0:e.length))&&(this._hasFirstTarget=!0);var n=this.controlBox,r=t.persistData,o=t.firstRenderState;if(o&&!n)return o;if(!this._hasFirstTarget&&r){var i=IC(r);if(i)return this.updateState(i,!1),this.state}return this.state.isPersisted=!1,this.state},t.prototype.updateSelectors=function(){},t.prototype.unsetAbles=function(){var e=this;this.targetAbles.forEach((function(t){t.unset&&t.unset(e)}))},t.prototype.updateAbles=function(e,t){void 0===e&&(e=this.props.ables),void 0===t&&(t="");var n=this.props.triggerAblesSimultaneously,r=this.getEnabledAbles(e),o="drag".concat(t,"Start"),i="pinch".concat(t,"Start"),a="drag".concat(t,"ControlStart"),s=ux(r,[o,i],n),l=ux(r,[a],n);this.enabledAbles=r,this.targetAbles=s,this.controlAbles=l},t.prototype.updateState=function(e,t){if(t){if(this.isUnmounted)return;this.setState(e)}else{var n=this.state;for(var r in e)n[r]=e[r]}},t.prototype.getEnabledAbles=function(e){void 0===e&&(e=this.props.ables);var t=this.props;return e.filter((function(e){return e&&(e.always&&!1!==t[e.name]||t[e.name])}))},t.prototype.renderAbles=function(){var e,t,n,r,o=this,i=this.props.triggerAblesSimultaneously,s={createElement:a.createElement};return this.renderState={},(e=hx(ux(this.getEnabledAbles(),["render"],i).map((function(e){return(0,e.render)(o,s)||[]}))).filter((function(e){return e})),t=function(e){return e.key},n=[],r={},e.forEach((function(o,i){var a=t(o,i,e),s=r[a];s||(s=[],r[a]=s,n.push(s)),s.push(o)})),n).map((function(e){return e[0]}))},t.prototype.updateCheckInput=function(){this.targetGesto&&(this.targetGesto.options.checkInput=this.props.checkInput)},t.prototype._getRequestStyles=function(){return this.getEnabledAbles().reduce((function(e,t){var n,r,o=null!==(r=null===(n=t.requestStyle)||void 0===n?void 0:n.call(t))&&void 0!==r?r:[];return Pm(Pm([],Om(e),!1),Om(o),!1)}),Pm([],Om(this.props.requestStyles||[]),!1))},t.prototype._updateObserver=function(e){this._updateResizeObserver(e),this._updateMutationObserver(e)},t.prototype._updateEvents=function(){var e=this.controlBox,t=this.targetAbles.length,n=this.controlAbles.length,r=this._dragTarget;(!t&&this.targetGesto||this._isTargetChanged(!0))&&(nx(this,!1),this.updateState({gestos:{}})),n||nx(this,!0),r&&t&&!this.targetGesto&&(this.targetGesto=MC(this,r,"")),!this.controlGesto&&n&&(this.controlGesto=DC(this,e,"controlAbles","Control"))},t.prototype._updateTargets=function(){var e=this.props;this._prevPropTarget=this._propTarget,this._prevDragTarget=this._dragTarget,this._prevOriginalDragTarget=this._originalDragTarget,this._prevDragArea=e.dragArea,this._propTarget=e.target,this._originalDragTarget=e.dragTarget||e.target,this._dragTarget=wx(this._originalDragTarget,!0)},t.prototype._renderLines=function(){var e=this.props,t=e.zoom,n=e.hideDefaultLines,r=e.hideChildMoveableDefaultLines,o=e.parentMoveable;if(n||o&&r)return[];var i=this.getState().renderPoses,s={createElement:a.createElement};return[[0,1],[1,3],[3,2],[2,0]].map((function(e,n){var r=Om(e,2),o=r[0],a=r[1];return Yv(s,"",i[o],i[a],t,"render-line-".concat(n))}))},t.prototype._isTargetChanged=function(e){var t=this.props,n=t.dragTarget||t.target,r=this._prevOriginalDragTarget,o=this._prevDragArea,i=t.dragArea;return!i&&r!==n||(e||i)&&o!==i||this._prevPropTarget!=this._propTarget},t.prototype._updateNativeEvents=function(){var e=this,t=this.props.dragArea?this.areaElement:this.state.target,n=this.events,r=Of(n);if(this._isTargetChanged())for(var o in n){var i=n[o];i&&i.destroy(),n[o]=null}if(t){var a=this.enabledAbles;r.forEach((function(r){var o=ux(a,[r]),i=o.length>0,s=n[r];i?(s||(s=new EC(t,e,r),n[r]=s),s.setAbles(o)):s&&(s.destroy(),n[r]=null)}))}},t.prototype._checkUpdateRootContainer=function(){var e=this.props.rootContainer;!this._rootContainer&&e&&(this._rootContainer=wx(e,!0))},t.prototype._checkUpdateViewContainer=function(){var e=this.props.viewContainer;!this._viewContainer&&e&&(this._viewContainer=wx(e,!0)),this._viewContainer&&this._changeAbleViewClassNames(Pm(Pm([],Om(this._getAbleViewClassNames()),!1),[this.isDragging()?qx:""],!1))},t.prototype._changeAbleViewClassNames=function(e){var t=this._viewContainer,n=px(e.filter(Boolean),(function(e){return e})).map((function(e){return Om(e,1)[0]})),r=this._viewClassNames,o=Fg(r,n),i=o.removed,a=o.added;i.forEach((function(e){Vf(t,r[e])})),a.forEach((function(e){Uf(t,n[e])})),this._viewClassNames=n},t.prototype._getAbleViewClassNames=function(){var e=this;return(this.getEnabledAbles().map((function(t){var n;return(null===(n=t.viewClassName)||void 0===n?void 0:n.call(t,e))||""})).join(" ")+" ".concat(this._getAbleClassName("-view"))).split(/\s+/g)},t.prototype._getAbleClassName=function(e){var t=this;void 0===e&&(e="");var n=this.getEnabledAbles(),r=this.targetGesto,o=this.controlGesto,i=(null===r||void 0===r?void 0:r.isFlag())?r.getEventData():{},a=(null===o||void 0===o?void 0:o.isFlag())?o.getEventData():{};return n.map((function(n){var r,o,s,l=n.name,d=(null===(r=n.className)||void 0===r?void 0:r.call(n,t))||"";return((null===(o=i[l])||void 0===o?void 0:o.isEventStart)||(null===(s=a[l])||void 0===s?void 0:s.isEventStart))&&(d+=" ".concat(wy("".concat(l).concat(e,"-dragging")))),d.trim()})).filter(Boolean).join(" ")},t.prototype._updateResizeObserver=function(e){var t,n=this.props,r=n.target,o=Qf(this.getControlBoxElement());if(o.ResizeObserver&&r&&n.useResizeObserver){if(e.target!==r||!this._reiszeObserver){var i=new o.ResizeObserver(this.checkUpdateRect);i.observe(r,{box:"border-box"}),this._reiszeObserver=i}}else null===(t=this._reiszeObserver)||void 0===t||t.disconnect()},t.prototype._updateMutationObserver=function(e){var t,n=this,r=this.props,o=r.target,i=Qf(this.getControlBoxElement());if(i.MutationObserver&&o&&r.useMutationObserver){if(e.target!==o||!this._mutationObserver){var a=new i.MutationObserver((function(e){var t,r;try{for(var o=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i=o.next();!i.done;i=o.next()){var a=i.value;"attributes"===a.type&&"style"===a.attributeName&&n.checkUpdateRect()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}));a.observe(o,{attributes:!0}),this._mutationObserver=a}}else null===(t=this._mutationObserver)||void 0===t||t.disconnect()},t.defaultProps={dragTargetSelf:!1,target:null,dragTarget:null,container:null,rootContainer:null,origin:!0,parentMoveable:null,wrapperMoveable:null,isWrapperMounted:!1,parentPosition:null,warpSelf:!1,svgOrigin:"",dragContainer:null,useResizeObserver:!1,useMutationObserver:!1,preventDefault:!0,linePadding:0,controlPadding:0,ables:[],pinchThreshold:20,dragArea:!1,passDragArea:!1,transformOrigin:"",className:"",zoom:1,triggerAblesSimultaneously:!1,padding:{},pinchOutside:!0,checkInput:!1,dragFocusedInput:!1,groupable:!1,hideDefaultLines:!1,cspNonce:"",translateZ:0,cssStyled:null,customStyledMap:{},props:{},stopPropagation:!1,preventClickDefault:!1,preventClickEventOnDrag:!0,flushSync:Sy,firstRenderState:null,persistData:null,viewContainer:null,requestStyles:[],useAccuratePosition:!1},t}(a.PureComponent),PC={name:"groupable",props:["defaultGroupRotate","useDefaultGroupRotate","defaultGroupOrigin","groupable","groupableProps","targetGroups","hideChildMoveableDefaultLines"],events:[],render:function(e,t){var n,r=e.props,o=r.targets||[],i=e.getState(),a=i.left,s=i.top,l=i.isPersisted,d=r.zoom||1,u=e.renderGroupRects,c=(null===(n=r.persistData)||void 0===n?void 0:n.children)||[];l?o=c.map((function(){return null})):c=[];var p=Tx(e,"parentPosition",[a,s],(function(e){return e.join(",")})),h=Tx(e,"requestStyles",e.getRequestChildStyles(),(function(e){return e.join(",")}));return e.moveables=e.moveables.slice(0,o.length),Pm(Pm([],Om(o.map((function(n,o){return t.createElement(OC,{key:"moveable"+o,ref:nf(e,"moveables",o),target:n,origin:!1,requestStyles:h,cssStyled:r.cssStyled,customStyledMap:r.customStyledMap,useResizeObserver:r.useResizeObserver,useMutationObserver:r.useMutationObserver,hideChildMoveableDefaultLines:r.hideChildMoveableDefaultLines,parentMoveable:e,parentPosition:[a,s],persistData:c[o],zoom:d})}))),!1),Om(hx(u.map((function(e,n){var r=[e.pos1,e.pos2,e.pos3,e.pos4];return[[0,1],[1,3],[3,2],[2,0]].map((function(e,o){var i=Om(e,2),a=i[0],s=i[1];return Yv(t,"",pg(r[a],p),pg(r[s],p),d,"group-rect-".concat(n,"-").concat(o))}))})))),!1)}},zC=zm("clickable",{props:["clickable"],events:["click","clickGroup"],always:!0,dragRelation:"weak",dragStart:function(){},dragControlStart:function(){},dragGroupStart:function(e,t){t.datas.inputTarget=t.inputEvent&&t.inputEvent.target},dragEnd:function(e,t){var n=e.props.target,r=t.inputEvent,o=t.inputTarget,i=!e.isMoveableElement(o)&&e.controlBox.contains(o);if(r&&o&&!t.isDrag&&!e.isMoveableElement(o)&&!i){var a=n.contains(o);lx(e,"onClick",ix(e,t,{isDouble:t.isDouble,inputTarget:o,isTarget:n===o,moveableTarget:e.props.target,containsTarget:a}))}},dragGroupEnd:function(e,t){var n=t.inputEvent,r=t.inputTarget;if(n&&r&&!t.isDrag&&!e.isMoveableElement(r)&&t.datas.inputTarget!==r){var o=e.props.targets,i=o.indexOf(r),a=i>-1,s=!1;-1===i&&(s=(i=Rf(o,(function(e){return e.contains(r)})))>-1),lx(e,"onClickGroup",ix(e,t,{isDouble:t.isDouble,targets:o,inputTarget:r,targetIndex:i,isTarget:a,containsTarget:s,moveableTarget:o[i]}))}},dragControlEnd:function(e,t){this.dragEnd(e,t)},dragGroupControlEnd:function(e,t){this.dragEnd(e,t)}});function FC(e){var t=e.originalDatas.draggable;return t||(e.originalDatas.draggable={},t=e.originalDatas.draggable),Im(Im({},e),{datas:t})}var NC=zm("edgeDraggable",{css:[".edge.edgeDraggable.line {\ncursor: move;\n}"],render:function(e,t){var n=e.props,r=n.edgeDraggable;return r?Xv(t,"edgeDraggable",r,e.getState().renderPoses,n.zoom):[]},dragCondition:function(e,t){var n,r=e.props,o=null===(n=t.inputEvent)||void 0===n?void 0:n.target;return!(!r.edgeDraggable||!o)&&(!r.draggable&&qf(o,wy("direction"))&&qf(o,wy("edge"))&&qf(o,wy("edgeDraggable")))},dragStart:function(e,t){return Bb.dragStart(e,FC(t))},drag:function(e,t){return Bb.drag(e,FC(t))},dragEnd:function(e,t){return Bb.dragEnd(e,FC(t))},dragGroupCondition:function(e,t){var n,r=e.props,o=null===(n=t.inputEvent)||void 0===n?void 0:n.target;return!(!r.edgeDraggable||!o)&&(!r.draggable&&qf(o,wy("direction"))&&qf(o,wy("line")))},dragGroupStart:function(e,t){return Bb.dragGroupStart(e,FC(t))},dragGroup:function(e,t){return Bb.dragGroup(e,FC(t))},dragGroupEnd:function(e,t){return Bb.dragGroupEnd(e,FC(t))},unset:function(e){return Bb.unset(e)}}),$C={name:"individualGroupable",props:["individualGroupable","individualGroupableProps"],events:[]},LC=[wC,Xx,Cy,zx,Bb,NC,qb,Nx,Bx,Xb,Yx,Qx,Gx,vC,mC,CC,PC,$C,zC,Wx,SC];function BC(e,t){var n=Om(e,3),r=n[0],o=n[1],i=n[2];return(r*t[0]+o*t[1]+i)/Math.sqrt(r*r+o*o)}function AC(e,t){var n=Om(e,2),r=n[0],o=n[1];return-r*t[0]-o*t[1]}function jC(e,t){return Math.max.apply(Math,Pm([],Om(e.map((function(e){var n=Om(e,4),r=n[0],o=n[1],i=n[2],a=n[3];return Math.max(r[t],o[t],i[t],a[t])}))),!1))}function HC(e,t){return Math.min.apply(Math,Pm([],Om(e.map((function(e){var n=Om(e,4),r=n[0],o=n[1],i=n[2],a=n[3];return Math.min(r[t],o[t],i[t],a[t])}))),!1))}function qC(e,t){var n=t.map((function(t){if(vf(t)){var n=qC(e,t),r=n.length;return r>1?n:1===r?n[0]:null}var o=Tf(e,(function(e){return e.manager.props.target===t}));return o?(o.finded=!0,o.manager):null})).filter(Boolean);return 1===n.length&&vf(n[0])?n[0]:n}var UC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.differ=new jg,t.moveables=[],t.transformOrigin="50% 50%",t.renderGroupRects=[],t._targetGroups=[],t._hasFirstTargets=!1,t}return _m(t,e),t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this)},t.prototype.checkUpdate=function(){this._isPropTargetChanged=!1,this.updateAbles()},t.prototype.getTargets=function(){return this.props.targets},t.prototype.updateRect=function(e,t,n){var r;void 0===n&&(n=!0);var o=this.state;if(this.controlBox&&!o.isPersisted){jv(!0),this.moveables.forEach((function(t){t.updateRect(e,!1,!1)}));var i=this.props,a=this.moveables,s=o.target||i.target,l=a.map((function(e){return{finded:!1,manager:e}})),d=this.props.targetGroups||[],u=qC(l,d),c=i.useDefaultGroupRotate;u.push.apply(u,Pm([],Om(l.filter((function(e){return!e.finded})).map((function(e){return e.manager}))),!1));var p=[],h=!t||""!==e&&i.updateGroup,f=i.defaultGroupRotate||0;if(!this._hasFirstTargets){var g=null===(r=i.persistData)||void 0===r?void 0:r.rotation;null!=g&&(f=g)}var m=function e(t,n,r){var o=t.map((function(t){if(vf(t)){var r=e(t,n),o=[r.pos1,r.pos2,r.pos3,r.pos4];return p.push(r),{poses:o,rotation:r.rotation}}return{poses:ex(t.state),rotation:t.getRotation()}})),i=o.map((function(e){return e.rotation})),a=0,s=i[0],l=i.every((function(e){return Math.abs(s-e)<.1}));a=h?!c&&l?s:f:c||r||!l?n:s;var d=o.map((function(e){return e.poses})),u=function(e,t){var n,r,o,i=[0,0],a=[0,0],s=[0,0],l=[0,0],d=0,u=0;if(!e.length)return{pos1:i,pos2:a,pos3:s,pos4:l,minX:0,minY:0,maxX:0,maxY:0,width:d,height:u,rotation:t};var c=jf(t,nv);if(c%90){var p=c/180*Math.PI,h=Math.tan(p),f=-1/h,g=[ov,iv],m=[[0,0],[0,0]],v=[ov,iv],b=[[0,0],[0,0]];e.forEach((function(e){e.forEach((function(e){var t=BC([-h,1,0],e),n=BC([-f,1,0],e);g[0]>t&&(m[0]=e,g[0]=t),g[1]<t&&(m[1]=e,g[1]=t),v[0]>n&&(b[0]=e,v[0]=n),v[1]<n&&(b[1]=e,v[1]=n)}))}));var y=Om(m,2),x=y[0],C=y[1],w=Om(b,2),S=w[0],Z=w[1],k=[-h,1,AC([-h,1],x)],M=[-h,1,AC([-h,1],C)],D=[-f,1,AC([-f,1],S)],E=[-f,1,AC([-f,1],Z)];n=Om([[k,D],[k,E],[M,D],[M,E]].map((function(e){var t=Om(e,2);return am(t[0],t[1])[0]})),4),i=n[0],a=n[1],s=n[2],l=n[3],d=v[1]-v[0],u=g[1]-g[0]}else{var R=HC(e,0),T=HC(e,1),_=jC(e,0),I=jC(e,1);i=[R,T],a=[_,T],s=[R,I],l=[_,I],d=_-R,u=I-T,c%180&&(i=(r=Om([s,i,l,a],4))[0],a=r[1],s=r[2],l=r[3],d=I-T,u=_-R)}c%360>180&&(i=(o=Om([l,s,a,i],4))[0],a=o[1],s=o[2],l=o[3]);var O=rm([i,a,s,l]);return{pos1:i,pos2:a,pos3:s,pos4:l,width:d,height:u,minX:O.minX,minY:O.minY,maxX:O.maxX,maxY:O.maxY,rotation:t}}(d,a);return u}(u,this.rotation,!0);h&&(this.rotation=m.rotation,this.transformOrigin=i.defaultGroupOrigin||"50% 50%",this.scale=[1,1]),this._targetGroups=d,this.renderGroupRects=p;var v,b,y,x,C,w=this.transformOrigin,S=this.rotation,Z=this.scale,k=m.width,M=m.height,D=m.minX,E=m.minY,R=(v=[[0,0],[k,0],[0,M],[k,M]],b=Ex(w,k,M),y=this.rotation/180*Math.PI,x=v.map((function(e){return pg(e,b)})),C=x.map((function(e){return yg(e,y)})),{prev:x,next:C,result:C.map((function(e){return cg(e,b)}))}),T=rm(R.result),_=T.minX,I=T.minY,O=" rotate(".concat(S,"deg)")+" scale(".concat(_x(Z[0]),", ").concat(_x(Z[1]),")"),P="translate(".concat(-_,"px, ").concat(-I,"px)").concat(O);this.controlBox.style.transform="translate3d(".concat(D,"px, ").concat(E,"px, ").concat(this.props.translateZ||0,")"),s.style.cssText+="left:0px;top:0px;"+"transform-origin:".concat(w,";")+"width:".concat(k,"px;height:").concat(M,"px;")+"transform: ".concat(P),o.width=k,o.height=M;var z=this.getContainer(),F=_C(this.controlBox,s,this.controlBox,this.getContainer(),this._rootContainer||z,[]),N=[F.left,F.top],$=Om(ex(F),4),L=$[0],B=$[1],A=$[2],j=$[3],H=rm([L,B,A,j]),q=[H.minX,H.minY],U=_x(Z[0]*Z[1]);F.pos1=pg(L,q),F.pos2=pg(B,q),F.pos3=pg(A,q),F.pos4=pg(j,q),F.left=D-F.left+q[0],F.top=E-F.top+q[1],F.origin=pg(cg(N,F.origin),q),F.beforeOrigin=pg(cg(N,F.beforeOrigin),q),F.originalBeforeOrigin=cg(N,F.originalBeforeOrigin),F.transformOrigin=pg(cg(N,F.transformOrigin),q),s.style.transform="translate(".concat(-_-q[0],"px, ").concat(-I-q[1],"px)")+O,jv(),this.updateState(Im(Im({},F),{posDelta:q,direction:U,beforeDirection:U}),n)}},t.prototype.getRect=function(){return Im(Im({},e.prototype.getRect.call(this)),{children:this.moveables.map((function(e){return e.getRect()}))})},t.prototype.triggerEvent=function(t,n,r){if(r||t.indexOf("Group")>-1)return e.prototype.triggerEvent.call(this,t,n);this._emitter.trigger(t,n)},t.prototype.getRequestChildStyles=function(){return this.getEnabledAbles().reduce((function(e,t){var n,r,o=null!==(r=null===(n=t.requestChildStyle)||void 0===n?void 0:n.call(t))&&void 0!==r?r:[];return Pm(Pm([],Om(e),!1),Om(o),!1)}),[])},t.prototype.getMoveables=function(){return Pm([],Om(this.moveables),!1)},t.prototype.updateAbles=function(){e.prototype.updateAbles.call(this,Pm(Pm([],Om(this.props.ables),!1),[PC],!1),"Group")},t.prototype._updateTargets=function(){e.prototype._updateTargets.call(this),this._originalDragTarget=this.props.dragTarget||this.areaElement,this._dragTarget=wx(this._originalDragTarget,!0)},t.prototype._updateEvents=function(){var e=this.state,t=this.props,n=this._prevDragTarget,r=t.dragTarget||this.areaElement,o=t.targets,i=this.differ.update(o),a=i.added,s=i.changed,l=i.removed,d=a.length||l.length;(d||this._prevOriginalDragTarget!==this._originalDragTarget)&&(nx(this,!1),nx(this,!0),this.updateState({gestos:{}})),n!==r&&(e.target=null),e.target||(e.target=this.areaElement,this.controlBox.style.display="block"),e.target&&(this.targetGesto||(this.targetGesto=MC(this,this._dragTarget,"Group")),this.controlGesto||(this.controlGesto=DC(this,this.controlBox,"controlAbles","GroupControl")));var u=!cx(e.container,t.container);u&&(e.container=t.container),(u||d||this.transformOrigin!==(t.defaultGroupOrigin||"50% 50%")||s.length||o.length&&!Rx(this._targetGroups,t.targetGroups||[]))&&(this.updateRect(),this._hasFirstTargets=!0),this._isPropTargetChanged=!!d},t.prototype._updateObserver=function(){},t.defaultProps=Im(Im({},OC.defaultProps),{transformOrigin:["50%","50%"],groupable:!0,dragArea:!0,keepRatio:!0,targets:[],defaultGroupRotate:0,defaultGroupOrigin:"50% 50%"}),t}(OC),VC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.moveables=[],t}return _m(t,e),t.prototype.render=function(){var e,t=this,n=this.props,r=n.cspNonce,o=n.cssStyled,i=n.persistData,s=n.targets||[],l=s.length,d=this.isUnmounted||!l,u=null!==(e=null===i||void 0===i?void 0:i.children)&&void 0!==e?e:[];return d&&!l&&u.length?s=u.map((function(){return null})):d||(u=[]),a.createElement(o,{cspNonce:r,ref:tf(this,"controlBox"),className:wy("control-box")},s.map((function(e,r){var o,i,s=null!==(i=null===(o=n.individualGroupableProps)||void 0===o?void 0:o.call(n,e,r))&&void 0!==i?i:{};return a.createElement(OC,Im({key:"moveable"+r,ref:nf(t,"moveables",r)},n,s,{target:e,wrapperMoveable:t,isWrapperMounted:t.isMoveableMounted,persistData:u[r]}))})))},t.prototype.componentDidMount=function(){},t.prototype.componentDidUpdate=function(){},t.prototype.getTargets=function(){return this.props.targets},t.prototype.updateRect=function(e,t,n){void 0===n&&(n=!0),jv(!0),this.moveables.forEach((function(r){r.updateRect(e,t,n)})),jv()},t.prototype.getRect=function(){return Im(Im({},e.prototype.getRect.call(this)),{children:this.moveables.map((function(e){return e.getRect()}))})},t.prototype.request=function(e,t,n){void 0===t&&(t={});var r=this.moveables.map((function(n){return n.request(e,Im(Im({},t),{isInstant:!1}),!1)})),o={request:function(e){return r.forEach((function(t){return t.request(e)})),this},requestEnd:function(){return r.forEach((function(e){return e.requestEnd()})),this}};return n||t.isInstant?o.request(t).requestEnd():o},t.prototype.dragStart=function(e){var t=e.target,n=Tf(this.moveables,(function(e){var n=e.getTargets()[0],r=e.getControlBoxElement(),o=e.getDragElement();return!(!n||!o)&&(o===t||o.contains(t)||o!==n&&n===t||n.contains(t)||r===t||r.contains(t))}));return n&&n.dragStart(e),this},t.prototype.hitTest=function(){return 0},t.prototype.isInside=function(){return!1},t.prototype.isDragging=function(){return!1},t.prototype.getDragElement=function(){return null},t.prototype.getMoveables=function(){return Pm([],Om(this.moveables),!1)},t.prototype.updateRenderPoses=function(){},t.prototype.checkUpdate=function(){},t.prototype.triggerEvent=function(){},t.prototype.updateAbles=function(){},t.prototype._updateEvents=function(){},t.prototype._updateObserver=function(){},t}(OC);function WC(e,t){var n=[];return e.forEach((function(e){e&&(bf(e)?t[e]&&n.push.apply(n,Pm([],Om(t[e]),!1)):vf(e)?n.push.apply(n,Pm([],Om(WC(e,t)),!1)):n.push(e))})),n}function GC(e,t){var n=[];return e.forEach((function(e){e&&(bf(e)?t[e]&&n.push.apply(n,Pm([],Om(t[e]),!1)):vf(e)?n.push(GC(e,t)):n.push(e))})),n}function KC(e,t){return e.length!==t.length||e.some((function(e,n){var r=t[n];return!(!e&&!r)&&(e!=r&&(!vf(e)||!vf(r)||KC(e,r)))}))}var YC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refTargets=[],t.selectorMap={},t._differ=new jg,t._elementTargets=[],t._tmpRefTargets=[],t._tmpSelectorMap={},t._onChangeTargets=null,t}var n,r;return _m(t,e),t.makeStyled=function(){var e={};this.getTotalAbles().forEach((function(t){var n=t.css;n&&n.forEach((function(t){e[t]=!0}))}));var t=Of(e).join("\n");this.defaultStyled=Rm("div",function(e,t){return t.replace(/([^}{]*){/gm,(function(t,n){return n.replace(/\.([^{,\s\d.]+)/g,"."+e+"$1")+"{"}))}(Xm,Jm+t))},t.getTotalAbles=function(){return Pm([Xx,PC,$C,Wx],Om(this.defaultAbles),!1)},t.prototype.render=function(){var e,t=this.constructor;t.defaultStyled||t.makeStyled();var n=this.props,r=n.ables,o=n.props,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(n,["ables","props"]),s=Om(this._updateRefs(!0),2),l=s[0],d=s[1],u=WC(l,d),c=u.length>1,p=Pm(Pm([],Om(t.getTotalAbles()),!1),Om(r||[]),!1),h=Im(Im(Im({},i),o||{}),{ables:p,cssStyled:t.defaultStyled,customStyledMap:t.customStyledMap});this._elementTargets=u;var f=null,g=this.moveable,m=i.persistData;if((null===m||void 0===m?void 0:m.children)&&(c=!0),i.individualGroupable)return a.createElement(VC,Im({key:"individual-group",ref:tf(this,"moveable")},h,{target:null,targets:u}));if(c){var v=GC(l,d);if(g&&!g.props.groupable&&!g.props.individualGroupable){var b=g.props.target;b&&u.indexOf(b)>-1&&(f=Im({},g.state))}return a.createElement(UC,Im({key:"group",ref:tf(this,"moveable")},h,null!==(e=i.groupableProps)&&void 0!==e?e:{},{target:null,targets:u,targetGroups:v,firstRenderState:f}))}var y=u[0];if(g&&(g.props.groupable||g.props.individualGroupable)){var x=Tf(g.moveables||[],(function(e){return e.props.target===y}));x&&(f=Im({},x.state))}return a.createElement(OC,Im({key:"single",ref:tf(this,"moveable")},h,{target:y,firstRenderState:f}))},t.prototype.componentDidMount=function(){this._checkChangeTargets()},t.prototype.componentDidUpdate=function(){this._checkChangeTargets()},t.prototype.componentWillUnmount=function(){this.selectorMap={},this.refTargets=[]},t.prototype.getTargets=function(){var e,t;return null!==(t=null===(e=this.moveable)||void 0===e?void 0:e.getTargets())&&void 0!==t?t:[]},t.prototype.updateSelectors=function(){this.selectorMap={},this._updateRefs()},t.prototype.waitToChangeTarget=function(){var e,t=this;return this._onChangeTargets=function(){t._onChangeTargets=null,e()},new Promise((function(t){e=t}))},t.prototype.waitToChangeTargets=function(){return this.waitToChangeTarget()},t.prototype.getManager=function(){return this.moveable},t.prototype.getMoveables=function(){return this.moveable.getMoveables()},t.prototype.getDragElement=function(){return this.moveable.getDragElement()},t.prototype._updateRefs=function(e){var t=this.refTargets,n=Sx(this.props.target||this.props.targets),r="undefined"!==typeof document,o=KC(t,n),i=this.selectorMap,a={};return this.refTargets.forEach((function e(t){bf(t)?i[t]?a[t]=i[t]:r&&(o=!0,a[t]=[].slice.call(document.querySelectorAll(t))):vf(t)&&t.forEach(e)})),this._tmpRefTargets=n,this._tmpSelectorMap=a,[n,a,!e&&o]},t.prototype._checkChangeTargets=function(){var e,t,n;this.refTargets=this._tmpRefTargets,this.selectorMap=this._tmpSelectorMap;var r=this._differ.update(this._elementTargets),o=r.added,i=r.removed;(o.length||i.length)&&(null===(t=(e=this.props).onChangeTargets)||void 0===t||t.call(e,{moveable:this.moveable,targets:this._elementTargets}),null===(n=this._onChangeTargets)||void 0===n||n.call(this));var a=Om(this._updateRefs(),3),s=a[0],l=a[1],d=a[2];this.refTargets=s,this.selectorMap=l,d&&this.forceUpdate()},t.defaultAbles=[],t.customStyledMap={},t.defaultStyled=null,function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);i>3&&a&&Object.defineProperty(t,n,a)}([(n=dv,void 0===r&&(r={}),function(e,t){n.forEach((function(n){var o=r[n]||n;o in e||(e[o]=function(){for(var e,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i=(e=this[t])[n].apply(e,r);return i===this[t]?this:i})}))})],t.prototype,"moveable",void 0),t}(a.PureComponent),XC=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _m(t,e),t.defaultAbles=LC,t}(YC);function QC({size:e,canvasid:t}){const[n]=(0,a.useState)({x:0,y:0}),[r,o]=(0,a.useState)(null),[i,s]=(0,a.useState)(6),[l]=(0,a.useState)("#CCCCCC70"),[d]=(0,a.useState)("#CCCCCC25"),[u]=(0,a.useState)("#CCCCCC70");(0,a.useEffect)((()=>{r&&r.clearRect(0,0,r.canvas.width,r.canvas.height),c()}),[n]);const c=(e=i)=>{var a=document.querySelector(`#${t}`),s=r||a.getContext("2d");o(s);var c=5*e,p=s.canvas.width,h=s.canvas.height;const f=h-n.y,g=p-n.x,m=Math.ceil(f/c);for(let e=0;e<m;e++)s.beginPath(),s.moveTo(0,n.y+c*e),s.lineTo(p,n.y+c*e),s.strokeStyle=0===e?u:e%5===0?l:d,s.stroke();const v=n.y,b=Math.ceil(v/c);for(let e=0;e<b;e++)0!==e&&(s.beginPath(),s.moveTo(0,n.y-c*e),s.lineTo(p,n.y-c*e),s.strokeStyle=0===e?u:e%5===0?l:d,s.stroke());const y=Math.ceil(g/c);for(let e=0;e<y;e++)s.beginPath(),s.moveTo(n.x+c*e,0),s.lineTo(n.x+c*e,h),s.strokeStyle=0===e?u:e%5===0?l:d,s.stroke();const x=n.x,C=Math.ceil(x/c);for(let e=0;e<C;e++)0!==e&&(s.beginPath(),s.moveTo(n.x-c*e,0),s.lineTo(n.x-c*e,h),s.strokeStyle=0===e?u:e%5===0?l:d,s.stroke())};return(0,x.tZ)("canvas",{onMouseDown:e=>null,id:t,width:e.width,height:e.height})}var JC=n(669968),ew=n.n(JC);(0,kr.cz)(),(0,JC.WidthProvider)(JC.Responsive);const tw={CHART:"CHART",HEADER:"HEADER",DIVIDER:"DIVIDER",MARKDOWN:"MARKDOWN",[f.Ce]:f.Ce,[f.t]:f.t,[f.qu]:f.qu,[f.Mg]:f.Mg,[f.Q7]:f.Q7,[f.hI]:f.hI,[f.kE]:f.kE,[f.GV]:f.GV},nw=450,rw={[f.dW]:nw,[f.Nc]:65,[f.hE]:20,[f.xh]:nw,[f.yR]:nw,[f.gn]:400,[f.Ce]:nw,[f.t]:30,[f.qu]:nw,[f.Mg]:nw,[f.Q7]:nw,[f.hI]:80,[f.kE]:40,[f.GV]:40},ow=y.iK.div`
  .react-resizable-handle {
    z-index: 100;
  }
`,iw=100,aw={mode:"ratio",size:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},type:"origin"},sw=e=>{var t;const{width:n=document.documentElement.clientWidth,height:r,dashboardLayout:s,dashboardInfo:l,depth:d,isComponentVisible:u,createComponent:c,handleComponentDrop:p,dashboardId:h,handleMoveGridComponent:g,handleMoveGridComponentItems:m=(()=>{}),deleteComponent:v,undoLength:b,redoLength:y,hasUnsavedChanges:C,onRef:w,gridComponent:S,calcMobileHeight:Z=(e=>{}),presentMenuItems:k,defaultFilterConditionNumber:M,handleChangeTab:D=(()=>{})}=e,E=iw;let R=E/3,T=E/9;const _=null==s?void 0:s.present,I=document.querySelector(".react-grid-layout")||{},O=(0,o.v9)((({dashboardInfo:e})=>{var t;return`${null==e||null==(t=e.metadata)?void 0:t.background_image}`})),P=(0,o.v9)((({dashboardInfo:e})=>{var t;return`${null==e||null==(t=e.metadata)?void 0:t.background_type}`})),z=(0,o.v9)((({dashboardInfo:e})=>{var t;return`${null==e||null==(t=e.metadata)?void 0:t.background_color}`}));(0,a.useImperativeHandle)(w,(()=>({setTarget:ie})));const F=(0,o.I0)(),N=((0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),(0,o.v9)((e=>e.dashboardState.fullSizeChartId))),$=(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC})),L=(0,o.v9)((e=>e.dashboardState)),B=(0,kr.Od)($);let A=B?iw:252,j=B?iw:25;const H=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardState)||null==(n=t.dashboardConfig_old)?void 0:n.floats})),q=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardState)||null==(n=t.dashboardConfig_old)?void 0:n.fitConfig})),U=(B?Be.Pj:Be.es,(0,o.v9)((e=>{var t;return null==e||null==(t=e.dashboardState)?void 0:t.editMode}))),{background_color:V,background_type:W,background_image:G,component_margin:K=2}=(0,o.v9)((({dashboardInfo:e})=>null==e?void 0:e.metadata)),Y=(0,o.v9)((e=>e.dashboardState.showComponentPropertyPane)),X=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),Q=(0,o.v9)((e=>e.dashboardState.isFulling)),[J,ee]=(0,a.useState)([]),[te,ne]=(0,a.useState)([]),re=a.useRef(null),[oe,ie]=(0,a.useState)(""),ae=a.useRef(null),[se,le]=(0,a.useState)(!1),[de,ue]=(0,a.useState)(null==I?void 0:I.clientHeight),[ce,pe]=(0,a.useState)({}),[he,fe]=(0,a.useState)(!1),[ge,me]=(0,a.useState)(),[ve,be]=(0,a.useState)(null),[ye,xe]=(0,a.useState)(1),[Ce,we]=(0,a.useState)(1),[Se,Ze]=(0,a.useState)(0),ke=(0,a.useMemo)((()=>{const{mode:e}=q||{};let t={};return t=e&&"auto"!=e?{...aw,...q}:{mode:"auto",size:{width:n,height:r}},t}),[q]);setTimeout((()=>{const e=document.querySelector(".react-grid-layout")||{};ue(null==e?void 0:e.clientHeight)}),500),(0,a.useEffect)((()=>{ae&&"auto"!==ke.mode&&ae.current.scrollTo(0,0)}),[ae,ke]),(0,a.useEffect)((()=>{const{present:e}=s,t=[],n=[],r=[],o=[];Object.keys(e).map((a=>{const s=e[a].type,l=e[a];if(tw[s]&&l.children&&0===l.children.length){let{meta:{gridLayoutConf:e}}=l;var d,u,c,p,h,f,g,m,v,b,y,x;if(e)if($===i.kB.PC)l.meta.gridLayoutConf={style:{...null==(d=l.meta.gridLayoutConf)?void 0:d.style,width:(null==(u=l.meta.gridLayoutConf)||null==(c=u.style)?void 0:c.width)||400,height:(null==(p=l.meta.gridLayoutConf)||null==(h=p.style)?void 0:h.height)||rw[s],w:(null==(f=l.meta.gridLayoutConf)||null==(g=f.style)?void 0:g.w)||j,h:(null==(m=l.meta.gridLayoutConf)||null==(v=m.style)?void 0:v.h)||rw[s]},isFloat:null==(b=l.meta.gridLayoutConf)?void 0:b.isFloat};else l.meta.gridLayoutConf={style:{...null==(y=l.meta.gridLayoutConf)?void 0:y.style},isFloat:null==(x=l.meta.gridLayoutConf)?void 0:x.isFloat};else l.meta.gridLayoutConf={style:{w:j,h:rw[s],width:400,height:rw[s]},isFloat:!1};l.meta.gridLayoutConf.isFloat?(n.push(l),o.push(l.id)):(t.push(l),r.push(l.id))}}));const a=[],l=new Set([...H,...o]);l.forEach((e=>{if(r.includes(e))l.delete(e);else for(let t=0;t<n.length;++t)if(e==n[t].id){a.push(n[t]);break}})),Z(0),ee(t),ne(a)}),[s,H,ke,ye,K,$]),(0,a.useEffect)((()=>{J.forEach((e=>{var t;if((null==e||null==(t=e.id)||null==t.indexOf?void 0:t.indexOf("FILTER_SELECT"))>-1){const t=document.getElementById(null==e?void 0:e.id);t&&(t.style.zIndex=999)}}))}),[J]);(0,a.useEffect)((()=>{ie(`#${Y}.target`),F((0,ss.IW)(Y))}),[Y]);const Me=(0,a.useMemo)((()=>{let e=[];return J.map((t=>{e.push(`#${t.id}.target`),e.push(`#${t.id}.test`)})),e}),[J]),De=e=>{e.preventDefault();const{nativeEvent:t}=e,{offsetX:n,offsetY:r,layerX:o,layerY:i}=t;be({offsetX:o,offsetY:i}),le(!0)},Ee=e=>{if(se){let{offsetX:t,offsetY:n}=ve;t/=ye;const{dragging:{type:r},destination:{pos:o}}=e;let i=rw[r],a={transform:`translate(${t}px,${n}px)`,w:j,h:rw[r],width:A,height:i,y:n,x:t};B&&(a={transform:`translate(0px,${n}px)`,w:j,h:rw[r],width:A,height:i,y:n,x:0});const s={style:a,isFloat:!1},{meta:l}=e.dragging;l?e.dragging.meta.gridLayoutConf=s:e.dragging.meta={gridLayoutConf:s},c(e),le(!1)}},Re=e=>{const{i:t,w:n,h:r,x:o,y:i}=e;return{id:t,style:{transform:`translate(${o}px,${i}px)`,width:n*ye,height:r,w:n,h:r,x:o,y:i},h:r}},Te=(e,t)=>{if($===i.kB.MOBILE){const t=[];for(let n=0;n<e.length;n++){const{id:r,style:o}=Re(e[n]);t.push({id:r,style:o})}m(t)}else{const{id:e,style:n}=Re(t);g({id:e,style:n})}},_e=(e,t,n)=>Te(e,n),Ie=(e,t,n)=>{Te(e,n)},Oe=(0,a.useMemo)((()=>{document.querySelector("#dashBlank .dragdroppable .react-grid-layout");return Q?{height:document.documentElement.clientHeight,width:document.documentElement.clientWidth}:{width:n,height:r}}),[r,n,Q,X,J,te]);let Pe=(0,a.useMemo)((()=>{const{mode:e,size:t}=ke;if(B){let r="ratio"==e?t.width:n;return xe(r/iw),r}let r="ratio"==e?t.width:Oe.width;const o=r/("ratio"==e?t.height:Oe.height);return xe(r/iw),we(o),r}),[Oe,ke]);const ze=(0,a.useMemo)((()=>{const e=[];te.forEach((t=>{let n=0,r=0;try{n=t.meta.gridLayoutConf.style.height,r=t.meta.gridLayoutConf.style.y}catch(e){}n&&e.push(n+r)}));const t=Math.max(...e,Oe.height),n={height:"auto"==ke.mode?t:ke.size.height,width:"auto"==ke.mode?Oe.width:ke.size.width};return"auto"==ke.mode&&de&&de>n.height?{width:n.width,height:de}:n}),[JSON.stringify(ke),Oe,te,J,de]),Fe=(0,a.useMemo)((()=>de&&de>ze.height?{width:ze.width,height:de}:{width:ze.width,height:ze.height}),[J,ze]),Ne=$===i.kB.MOBILE?ih:Pk,$e=({item:e,index:t})=>(0,x.tZ)(Ne,{key:e.id+1e5*t,id:e.id,parentId:"GRID_ID",depth:t+2,index:10*t}),Le=({item:e,index:t,style:n={}})=>{var r,o,i,a,s,l,d,u,c,p,h,f;const g={x:(null==(r=e.meta)||null==(o=r.gridLayoutConf)||null==(i=o.style)?void 0:i.x)||0,y:(null==(a=e.meta)||null==(s=a.gridLayoutConf)||null==(l=s.style)?void 0:l.y)||0,w:(null==(d=e.meta)||null==(u=d.gridLayoutConf)||null==(c=u.style)?void 0:c.w)||0,h:(null==(p=e.meta)||null==(h=p.gridLayoutConf)||null==(f=h.style)?void 0:f.h)||400};return(0,x.tZ)(ow,{className:"test",id:e.id,key:e.id,style:n,"data-grid":g,"data-test":JSON.stringify(g)},$e({item:e,index:t}))},Ae=({type:e="content",array:t,count:n})=>"filter"===e?t.length?t.slice(0,n).map(((e,t)=>Le({item:e,index:t}))):null:"content"===e?t.map(((e,t)=>Le({item:e,index:t}))):null,je=({type:e,color:t,image:n})=>{const r="#f0f2f5";return`${"color"===e?t:"image"===e&&n&&"noImg"!==n?`url(${n}) center center / cover no-repeat`:r}`},{mobile_metadata:He,metadata:qe}=l;(0,a.useEffect)((()=>{pe({background:je({type:null==qe?void 0:qe.background_filter_type,color:null==qe?void 0:qe.background_filter_color,image:null==qe?void 0:qe.background_filter_image})})}),[null==qe?void 0:qe.background_filter_type,null==qe?void 0:qe.background_filter_color,null==qe?void 0:qe.background_filter_image]);const Ue=({elements:e=null,width:t=Pe})=>N?(0,x.tZ)("div",null,e):(0,x.tZ)(ew(),{width:t,allowOverlap:!1,cols:iw,margin:[K,0],style:{zIndex:1,boxSizing:"border-box"},preventCollision:!1,isBounded:!1,useCSSTransforms:!0,resizeHandles:["e","se","s"],isDraggable:U&&!Q,isResizable:U&&!Q,rowHeight:1,onResizeStop:Ie,onDragStop:_e},e),Ve=(e,t,n,r,o,i)=>{o.preventDefault(),o.stopPropagation()},We=()=>(0,x.tZ)(ew(),{width:n,allowOverlap:!1,cols:E,margin:[K,0],style:{zIndex:1,boxSizing:"border-box"},preventCollision:!1,isBounded:!1,useCSSTransforms:!0,resizeHandles:["e","se","s"],isDraggable:U&&!Q,isResizable:U&&!Q,rowHeight:1,onResizeStop:Ie,onDragStart:Ve,onDragStop:_e},null==S?void 0:S.children.map((e=>{let t=[e];if(e.indexOf("ROW")>-1){const n=null==_?void 0:_[e];t=(null==n?void 0:n.children)||[]}return t.map(((e,t)=>{var n,r,o,a,s,l,c,p,h,f,g,m;const v=(e=>{var t,n,r,o;const i=null==_?void 0:_[e];if(!i)return{calcHeight:0,component:i};null==i||i.type;let a=0,s=400,l=400;if(null!=i&&null!=(t=i.meta)&&t.gridLayoutConf){var d,u,c,p,h,f,g,m,v,b,y,x;i.meta.gridLayoutConf="PC"===$?{style:{...null==(d=i.meta.gridLayoutConf)?void 0:d.style,width:(null==(u=i.meta.gridLayoutConf)||null==(c=u.style)?void 0:c.width)||s,height:(null==(p=i.meta.gridLayoutConf)||null==(h=p.style)?void 0:h.height)||l,w:(null==(f=i.meta.gridLayoutConf)||null==(g=f.style)?void 0:g.w)||R,h:(null==(m=i.meta.gridLayoutConf)||null==(v=m.style)?void 0:v.h)||T},isFloat:null==(b=i.meta.gridLayoutConf)?void 0:b.isFloat}:{style:{...null==(y=i.meta.gridLayoutConf)?void 0:y.style},isFloat:null==(x=i.meta.gridLayoutConf)?void 0:x.isFloat}}else{if(e.indexOf("TABS-")>-1)R=2*s,T=l,s*=2;else if(e.indexOf("TAB-")>-1){var C;const e=null==i||null==(C=i.parents)?void 0:C.filter((e=>e.indexOf("TABS-")>-1));if(null!=e&&e.length){var w,S,Z,k,M,D,E,I;const t=e[0],n=null==_?void 0:_[t];R=null==n||null==(w=n.meta)||null==(S=w.gridLayoutConf)?void 0:S.w,T=null==n||null==(Z=n.meta)||null==(k=Z.gridLayoutConf)?void 0:k.h,s=null==n||null==(M=n.meta)||null==(D=M.gridLayoutConf)?void 0:D.width,l=null==n||null==(E=n.meta)||null==(I=E.gridLayoutConf)?void 0:I.height}}else e.indexOf("CHART-")>-1&&(R=s,T=l);const t=i.meta||{};i.meta=t,i.meta.gridLayoutConf={style:{w:R,h:T,width:s,height:l},isFloat:!1}}return a+=null==(n=i.meta)||null==(r=n.gridLayoutConf)||null==(o=r.style)?void 0:o.height,{calcHeight:a,component:i}})(e).component;if($===i.kB.MOBILE&&"FILTER_SELECT"===(null==v?void 0:v.type))return null;if(!v)return null;let b={};if("TABS"===(null==v?void 0:v.type)||"TAB"===(null==v?void 0:v.type)){var y,C,w;b={width:`${(null==v||null==(y=v.meta)||null==(C=y.gridLayoutConf)||null==(w=C.style)?void 0:w.width)||0}px !important`}}return(0,x.tZ)("div",{className:"pppppppppppppppppp",id:e,key:e,"data-grid":{x:(null==v||null==(n=v.meta)||null==(r=n.gridLayoutConf)||null==(o=r.style)?void 0:o.x)||0,y:(null==v||null==(a=v.meta)||null==(s=a.gridLayoutConf)||null==(l=s.style)?void 0:l.y)||0,w:(null==v||null==(c=v.meta)||null==(p=c.gridLayoutConf)||null==(h=p.style)?void 0:h.w)||E/3,h:(null==v||null==(f=v.meta)||null==(g=f.gridLayoutConf)||null==(m=g.style)?void 0:m.h)||400}},(0,x.tZ)(Pk,{key:e+1e5*t,id:e,parentId:v.id,depth:d+1,index:10*t,isComponentVisible:u,onChangeTab:D}))}))}))),Ge=(0,a.useMemo)((()=>{const e=We();if($===i.kB.MOBILE&&"GRID"===S.type){Object.values((null==s?void 0:s.present)||{}).filter((e=>{var t;return tw[null==e?void 0:e.type]&&0===(null==e||null==(t=e.children)?void 0:t.length)}))}return e}),[JSON.stringify(S),K,Q,$,X,U,n,s]),Ke=(Pe>0&&($===i.kB.MOBILE?((e,t)=>{const n=e.slice();if(n.length){const{menus:e,contents:r}=(e=>{if(e.length){const[r,o]=[[],[]];for(let i=0;i<e.length;i++){const a=e[i];var t,n;if(-1!==a.type.indexOf(f.hI))(null==(t=a.parents)||null==(n=t.filter((e=>-1!==e.indexOf("TAB"))))?void 0:n.length)?o.push(a):r.push(a);else o.push(a)}return{menus:r.length?r.sort(((e,t)=>{var n,r;return(null==(n=e.meta)?void 0:n.order)-(null==(r=t.meta)?void 0:r.order)})):[],contents:o}}return{menus:[],contents:[]}})(n),o=e.length?e.map((e=>e.id)):[],i=Ae({type:"filter",array:e,count:M}),s=(({count:e,array:t})=>{const[n,r]=[t.slice(0,e),[]];for(let e=0;e<n.length;e++){const t=n[e];for(let e=0;e<k.length;e++){const n=k[e];t.id===n.currentId&&r.push(n)}}return r.length?r.map((({filterId:e,parentsId:t,name:n})=>(0,x.tZ)("div",{key:t,className:Rh.filterButtonMore},(0,x.tZ)(Eh.Z,{id:e,name:n,type:"horizontal"}),U?(0,x.tZ)(Dh,{style:{fontSize:16},className:"moreOutLine"}):null))):null})({array:e,count:M}),l=Ae({type:"filter",array:e,count:e.length});let d=Ae({type:"content",array:r});t&&(d=t);const u={display:"flex",flexDirection:"column",height:(0,kr.ve)()?window.innerHeight:L.emulateRatio.height},c={flex:1,zIndex:0,position:"relative"},p=(0,x.tZ)("div",{id:"maskDropFilter",style:{width:"100%"},onDrop:De},(0,x.tZ)(Wn,{onDrop:Ee,component:{children:[],id:"GRID_ID",parents:["ROOT_ID"],type:"GRID"},depth:1,parentComponent:null,index:0,orientation:"column",className:"dash-dragDroppable",editMode:!0,style:{minHeight:`${L.emulateRatio.height}px`}},(()=>l)));return(0,x.tZ)(zh,{tabHeaderStyle:{padding:0,...ce},button:i,defaultButton:s,allButton:p,editMode:U,filterRowIds:o,contentStyle:u,mainStyle:c,num:M,renderGridLayoutSecondary:Ue,showMore:!0},Ue({elements:d}),(e=>e.length?(0,x.tZ)(a.Fragment,null,te.map(((e,t)=>{var n,r,o,i,a,s,l,d,u,c,p,h,f,g;return(0,x.tZ)("div",{className:"target",id:e.id,key:e.id+t,style:{position:"absolute",minHeight:"50px",top:0,left:0,...null==(n=e.meta)||null==(r=n.gridLayoutConf)?void 0:r.style,width:(null==(o=e.meta)||null==(i=o.gridLayoutConf)||null==(a=i.style)?void 0:a.w)*ye+"px",height:(null==(s=e.meta)||null==(l=s.gridLayoutConf)||null==(d=l.style)?void 0:d.height)+"px",transform:`translate(${B?0:(null==(u=e.meta)||null==(c=u.gridLayoutConf)||null==(p=c.style)?void 0:p.x)*ye}px,${null==(h=e.meta)||null==(f=h.gridLayoutConf)||null==(g=f.style)?void 0:g.y}px)`,zIndex:1}},$e({item:e,index:t}))})),(0,x.tZ)(XC,{ref:re,target:U&&!Q?oe:null,individualGroupable:!0,draggable:!Q,throttleDrag:1,rotatable:!1,resizable:!0,useResizeObserver:!0,onDrag:e=>{e.target.style.transform=e.transform},onDragEnd:e=>{const{width:t,height:n,left:r,top:o}=e.moveable.getRect();g({id:e.target.id,style:{transform:e.lastEvent.style.transform,width:t,height:n,w:t/ye,h:n,x:r/ye,y:o}})},onResize:e=>{e.target.style.width=`${e.width}px`,e.target.style.height=`${e.height}px`,e.target.style.transform=e.drag.transform},onResizeEnd:e=>{const{width:t,height:n,left:r,top:o}=e.moveable.getRect();let i={...e.lastEvent.style,width:t,height:n,w:t/ye,h:n,x:r/ye,y:o};g({id:e.target.id,style:i})},onRotate:e=>{e.target.style.transform=e.drag.transform},snappable:!0,snapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},elementSnapDirections:{middle:!0,center:!0,top:!0,left:!0,bottom:!0,right:!0},snapThreshold:10,elementGuidelines:[ae,...Me],bounds:{left:0,top:0,right:0,bottom:0,position:"css"}})):null)(te))}})(J):Ue({elements:J.length?J.map(((e,t)=>Le({item:e,index:t}))):null})),(0,a.useMemo)((()=>Pe>0&&$===i.kB.PC?(0,x.tZ)(a.Fragment,null,te.map(((e,t)=>{var n,r,o,i,s,l,d,u,c,p,h,f,g,m;return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{className:"target",id:e.id,key:e.id+t,style:{position:"absolute",minHeight:"50px",top:0,left:0,...null==(n=e.meta)||null==(r=n.gridLayoutConf)?void 0:r.style,width:(null==(o=e.meta)||null==(i=o.gridLayoutConf)||null==(s=i.style)?void 0:s.w)*ye+"px",height:(null==(l=e.meta)||null==(d=l.gridLayoutConf)||null==(u=d.style)?void 0:u.height)+"px",transform:`translate(${B?0:(null==(c=e.meta)||null==(p=c.gridLayoutConf)||null==(h=p.style)?void 0:h.x)*ye}px,${null==(f=e.meta)||null==(g=f.gridLayoutConf)||null==(m=g.style)?void 0:m.y}px)`,zIndex:1}},(0,x.tZ)(Ne,{key:e.id+1e5*t,id:e.id,parentId:"GRID_ID",depth:t+2,index:10*t})))})),(0,x.tZ)(XC,{ref:re,target:U&&!Q?oe:null,individualGroupable:!0,draggable:!Q,throttleDrag:1,rotatable:!1,resizable:!0,useResizeObserver:!0,onDrag:e=>{e.target.style.transform=e.transform},onDragEnd:e=>{const{width:t,height:n,left:r,top:o}=e.moveable.getRect();g({id:e.target.id,style:{transform:e.lastEvent.style.transform,width:t,height:n,w:t/ye,h:n,x:r/ye,y:o}})},onResize:e=>{e.target.style.width=`${e.width}px`,e.target.style.height=`${e.height}px`,e.target.style.transform=e.drag.transform},onResizeEnd:e=>{const{width:t,height:n,left:r,top:o}=e.moveable.getRect();let i={...e.lastEvent.style,width:t,height:n,w:t/ye,h:n,x:r/ye,y:o};g({id:e.target.id,style:i})},onRotate:e=>{e.target.style.transform=e.drag.transform},snappable:!0,snapDirections:{top:!0,left:!0,bottom:!0,right:!0,center:!0,middle:!0},elementSnapDirections:{middle:!0,center:!0,top:!0,left:!0,bottom:!0,right:!0},snapThreshold:10,elementGuidelines:[ae,...Me],bounds:{left:0,top:0,right:0,bottom:0,position:"css"}})):null),[te,Pe,oe,Q,P,z,O])),Ye=()=>{F((0,ss.ks)(null)),F((0,ss.IW)("none"))};(0,a.useEffect)((()=>{Q&&Ye()}),[Q]),(0,a.useEffect)((()=>{}),[ze]);let Xe={height:`${ze.height}px`,width:`${ze.width}px`,position:"relative",background:`${"color"==W?V||"rgba(255,255,255,1)":`url(${G})`}`,backgroundSize:"100% auto",backgroundPosition:"center center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"};(null==S||null==(t=S.id)?void 0:t.indexOf("TAB-"))>-1&&(Xe.width=Xe.width-10,Xe.height=Xe.height-40,Fe.width=Fe.width-10,Fe.height=Fe.height-40),B&&(Xe={width:"100%",height:"100%",position:"relative",overflow:"hidden"});const Qe=U&&$===i.kB.MOBILE?"100%":`${Fe.height}px`;return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{id:"dashBlank",ref:ae,style:Xe,onDrop:De,onClick:Ye,className:`${$===i.kB.MOBILE?Rh.gridContent:""}`,css:x.iv`
          .dash-dragDroppable {
            /* height: ${ze.height}px;
            width: ${ze.width}px; */
            height: ${Qe};
          }
        `},(0,x.tZ)(Wn,{onDrop:Ee,component:S,depth:d,parentComponent:null,index:0,orientation:"column",className:"dash-dragDroppable",editMode:!0,style:{minHeight:`${L.emulateRatio.height}px`}},(()=>(0,x.tZ)(a.Fragment,null,U&&(0,x.tZ)("div",{style:{width:`${Fe.width}px`,height:`${Fe.height}px`,position:"absolute",left:$===i.kB.PC?"5px":0,zIndex:$===i.kB.MOBILE?"0":"1",overflow:"hidden"}},(0,x.tZ)(QC,{canvasid:`${S.id}Canvasg`,size:$===i.kB.PC?{width:1e4,height:1e4}:{width:Fe.width,height:Fe.height||L.emulateRatio.height}})),Ge,Ke)))))};const lw=(0,o.$j)((function({dashboardState:e,dashboardInfo:t,dashboardGridLayout:n,mobileDashboardLayout:r,nativeFilters:o}){var i;return{editMode:e.editMode,canEdit:t.dash_edit_perm,dashboardId:t.id,dashboardInfo:t,dashboardState:e,dashboardGridLayout:n,dashboardLayout:r,viewType:null==e?void 0:e.viewType,undoLength:r.past.length,redoLength:r.future.length,hasUnsavedChanges:!!e.hasUnsavedChanges,floatComponents:null==e||null==(i=e.dashboardConfig_old)?void 0:i.floats,...ul({mobileDashboardLayout:r,dashboardInfo:t,nativeFilters:o})}}),(function(e){return(0,r.DE)({handleComponentDrop:bl._p,resizeComponent:bl.iO,setDirectPathToChild:ss.E2,setEditMode:ss.Mb,createComponent:bl.LM,updateComponents:bl.WZ,handleMoveGridComponent:bl.Hj,handleMoveGridComponentItems:bl.kh,setViewType:ss.ky,handleResizeGridComponent:bl.Is,deleteComponent:bl.v7},e)}))(sw);var dw=["className","children","debounceTime","ignoreDimensions","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"];function uw(){return uw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uw.apply(this,arguments)}var cw=[],pw={width:"100%",height:"100%"};function hw(e){var t=e.className,n=e.children,r=e.debounceTime,o=void 0===r?300:r,i=e.ignoreDimensions,s=void 0===i?cw:i,l=e.parentSizeStyles,d=void 0===l?pw:l,u=e.enableDebounceLeadingCall,c=void 0===u||u,p=e.resizeObserverPolyfill,h=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,dw),f=(0,a.useRef)(null),g=(0,a.useRef)(0),m=(0,a.useState)({width:0,height:0,top:0,left:0}),v=m[0],b=m[1],y=(0,a.useMemo)((function(){var e=Array.isArray(s)?s:[s];return Lt()((function(t){b((function(n){var r=Object.keys(n).filter((function(e){return n[e]!==t[e]})),o=r.every((function(t){return e.includes(t)}));return o?n:t}))}),o,{leading:c})}),[o,c,s]);return(0,a.useEffect)((function(){var e=new(p||window.ResizeObserver)((function(e){e.forEach((function(e){var t,n=null!=(t=null==e?void 0:e.contentRect)?t:{},r=n.left,o=n.top,i=n.width,a=n.height;g.current=window.requestAnimationFrame((function(){y({width:i,height:a,top:o,left:r})}))}))}));return f.current&&e.observe(f.current),function(){window.cancelAnimationFrame(g.current),e.disconnect(),y.cancel()}}),[y,p]),a.createElement("div",uw({style:d,ref:f,className:t},h),n(uw({},v,{ref:f.current,resize:y})))}hw.propTypes={className:l().string,debounceTime:l().number,enableDebounceLeadingCall:l().bool,ignoreDimensions:l().oneOfType([l().any,l().arrayOf(l().any)]),children:l().func.isRequired};const fw=(0,o.$j)((function({dashboardState:e,dashboardInfo:t,dashboardGridLayout:n,dashboardLayout:r}){var o;return{editMode:e.editMode,canEdit:t.dash_edit_perm,dashboardId:t.id,dashboardInfo:t,dashboardState:e,dashboardGridLayout:n,dashboardLayout:r,viewType:null==e?void 0:e.viewType,undoLength:r.past.length,redoLength:r.future.length,hasUnsavedChanges:!!e.hasUnsavedChanges,floatComponents:null==e||null==(o=e.dashboardConfig_old)?void 0:o.floats}}),(function(e){return(0,r.DE)({handleComponentDrop:vl._p,resizeComponent:vl.iO,setDirectPathToChild:ss.E2,setEditMode:ss.Mb,createComponent:vl.LM,updateComponents:vl.WZ,handleMoveGridComponent:vl.Hj,setViewType:ss.ky,handleResizeGridComponent:vl.Is,deleteComponent:vl.v7,handleGridLayoutZindex:vl.handleGridLayoutZindex},e)}))(sw),gw=y.iK.div`
  ${({width:e,height:t})=>x.iv`
    position: relative;
    width: ${e}px;
    height: ${t}px;
    overflow: scroll;
  `}
`,mw=e=>{const{height:t=400,width:n}=e,r=(0,o.v9)((e=>e.dashboardLayout));return(0,x.tZ)(gw,{height:t,width:n},(0,x.tZ)(hw,null,(({width:t})=>(0,x.tZ)(fw,fe()({},e,{width:t,dashboardLayout:r})))))},vw="RENDER_TAB",bw="RENDER_TAB_CONTENT",yw={dashboardId:l().number.isRequired,id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderType:l().oneOf([vw,bw]).isRequired,onDropOnTab:l().func,onHoverTab:l().func,editMode:l().bool.isRequired,layoutMode:i.kB,canEdit:l().bool.isRequired,width:l().number,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired,setDirectPathToChild:l().func.isRequired,setEditMode:l().func.isRequired},xw={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onHoverTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},Cw=y.iK.div`
  ${()=>x.iv`
    // margin-bottom: 0 !important;
    .grid-row {
      min-height: auto;
    }
    .grid-row:after {
      border: 0 none !important;
    }
  `}
`,ww=y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    flex-direction: column;
    // & > div:not(:last-child):not(.empty-droptarget) {
    //   margin-bottom: ${4*e.gridUnit}px;
    // }
    & > .empty-droptarget {
      width: 100%;
      &.empty-top,
      &.empty-bottom {
        height: 60px;
      }
    }
    & .empty-tab-top,
    & .empty-tab-bottom {
      height: 16px;
    }
    & .fixed-tab-bottom {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 2;
    }
  `}
`,Sw=y.iK.div`
  ${({isHighlighted:e,theme:{gridUnit:t,colors:n}})=>`\n    padding: ${t}px ${2*t}px;\n    margin: ${-t}px ${-2*t}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${e&&`box-shadow: 0 0 ${t}px ${n.primary.light1};`}\n  `}
`,Zw=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),kw=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--top"});class Mw extends a.PureComponent{constructor(e){super(e),this.state={openDrawer:!1,offset:0,transparency:0,initVisible:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleOnHover=this.handleOnHover.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this),this.renderMobileDrawerWrapPopUp=this.renderMobileDrawerWrapPopUp.bind(this),this.renderFilterAndContent=this.renderFilterAndContent.bind(this),this.handleMobileTabsAndContentFilter=this.handleMobileTabsAndContentFilter.bind(this),this.renderFilterHorizontalDefaultMenus=this.renderFilterHorizontalDefaultMenus.bind(this),this.getMobileEmulateRatio=this.getMobileEmulateRatio.bind(this),this.renderTabComponent=this.renderTabComponent.bind(this),this.handleOpenDrawer=this.handleOpenDrawer.bind(this),this.handleCloseDrawer=this.handleCloseDrawer.bind(this)}componentDidMount(){this.handleDashboardDrawerStatus(0)}componentWillUnmount(){this.setState({initVisible:!1}),this.handleDashboardDrawerStatus(0)}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleOnHover(){this.props.onHoverTab()}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleDashboardDrawerStatus(e=0){const{setDashboardDrawerStatus:t}=this.props;t&&t(e)}handleOpenDrawer(){const[e]=this.getMobileEmulateRatio();this.handleDashboardDrawerStatus(1),this.setState({openDrawer:!0,offset:-e,transparency:.55,initVisible:!0})}handleCloseDrawer(){this.setState({openDrawer:!1,offset:0,transparency:0}),this.handleDashboardDrawerStatus(0)}getMobileEmulateRatio(){const{dashboardState:{emulateRatio:{width:e,height:t}}}=this.props;return[e,t]}renderFilterAndContent({type:e="filter",count:t}){var n;const{component:r}=this.props;if(null!=r&&null!=(n=r.children)&&n.length){const{filterRowIds:n,contentRowIds:r}=this.handleMobileTabsAndContentFilter();if("filter"===e){return n.length?n.slice(0,t).map(((e,t)=>this.renderTabComponent({id:e,index:t,isBox:!0}))):[]}if("content"===e){return r.length?r.map(((e,t)=>this.renderTabComponent({id:e,index:t}))):[]}}return[]}handleMobileTabsAndContentFilter(){var e;const{presentMenuItems:t,component:n}=this.props;if(null!=n&&null!=(e=n.children)&&e.length){const e=n.children,r=t.length?t.map((e=>e.parentsId)).filter((t=>-1!==e.indexOf(t))):[],o=r.length?t.map((e=>-1!==r.indexOf(e.parentsId)&&e)).filter(Boolean):[],i=e.filter((e=>-1===r.indexOf(e)));return{filterRows:o,filterRowIds:r,contentRowIds:i,allRowIds:e}}return{filterRows:[],filterRowIds:[],contentRowIds:[],allRowIds:[]}}renderFilterHorizontalDefaultMenus({count:e}){const{editMode:t}=this.props,{filterRows:n}=this.handleMobileTabsAndContentFilter();if(n.length){return n.slice(0,e).map((({filterId:e,parentsId:n,name:r})=>(0,x.tZ)("div",{key:n,className:Rh.filterButtonMore},(0,x.tZ)(Eh.Z,{id:e,name:r,type:"horizontal"}),t?(0,x.tZ)(Dh,{style:{fontSize:16},className:"moreOutLine"}):null)))}return null}renderMobileDrawerWrapPopUp(e){const{editMode:t,depth:n,component:r,parentComponent:o,filterBgColor:i,defaultFilterConditionNumber:a}=this.props,{filterRowIds:s}=this.handleMobileTabsAndContentFilter(),l=this.renderFilterAndContent({count:a}),d=this.renderFilterHorizontalDefaultMenus({count:3}),u=this.renderFilterAndContent({count:s.length}),c=this.renderFilterAndContent({type:"content"}),p=t?(0,x.tZ)(Wn,{component:r,parentComponent:o,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget empty-tab-top",style:{position:"absolute",top:0,left:0,right:0,height:"50%",zIndex:0}},kw):null,h=t?(0,x.tZ)(Wn,{component:r,parentComponent:o,orientation:"column",index:r.children.length,depth:n,onDrop:this.handleDrop,onHover:this.handleOnHover,editMode:!0,className:"empty-droptarget empty-tab-bottom fixed-tab-bottom"},Zw):null;return(0,x.tZ)(zh,{button:l,defaultButton:d,allButton:u,editMode:t,filterRowIds:s,mainStyle:{overflowY:"hidden"},tabHeaderStyle:{background:i},num:a,showMore:!0},p,(0,x.tZ)("div",{style:{position:"relative",zIndex:2}},c),e,h)}renderTabComponent({id:e,index:t,isBox:n}){const{depth:r,component:o,layoutMode:a,availableColumnCount:s,columnWidth:l,onResizeStart:d,onResize:u,onResizeStop:c,isComponentVisible:p}=this.props,h=a===i.kB.MOBILE?ih:Pk,f=(0,x.tZ)(h,{key:e,id:e,parentId:o.id,depth:r,index:t,onDrop:this.handleDrop,onHover:this.handleOnHover,availableColumnCount:s,columnWidth:l,onResizeStart:d,onResize:u,onResizeStop:c,isComponentVisible:p,onChangeTab:this.handleChangeTab});return n?(0,x.tZ)(Cw,{key:e,"data-test":"tab-dashboard-content"},f):f}renderTabContent(){const{component:e,parentComponent:t,depth:n,editMode:r,layoutMode:o,canEdit:s,setEditMode:l,dashboardId:u,layout_type:c,dashboardLayout:p,styleTabsBox:h}=this.props,{contentRowIds:f}=this.handleMobileTabsAndContentFilter(),g=0===f.length,m=(0,kr.Od)(o),v=g&&(0,x.tZ)(Mh.x3,{containerStyle:r?{}:{minHeight:296.84},title:r?(0,d.t)("Drag and drop components to this tab"):(0,d.t)("There are no components added to this tab"),description:s&&(r?(0,x.tZ)("span",null,(0,d.t)("You can")," ",(0,x.tZ)("a",{href:`/chart/add?dashboard_id=${u}`,rel:"noopener noreferrer",target:"_blank"},(0,d.t)("create a new chart"))," ",(0,d.t)("or use existing ones from the panel on the right")):(0,x.tZ)("span",null,(0,d.t)("You can add the components in the")," ",(0,x.tZ)("span",{role:"button",tabIndex:0,onClick:()=>l(!0)},(0,d.t)("edit mode")))),image:"chart.svg"});if("grid"===c){var b;const t=null==e||null==(b=e.parents)?void 0:b.filter((e=>e.indexOf("TABS-")>-1));if(null!=t&&t.length){var y;const n=t[0],r=null==p||null==(y=p.present)?void 0:y[n];e.meta={...e.meta,...(null==r?void 0:r.meta)||{}}}const r=(null==h?void 0:h.width)||100,a=((null==h?void 0:h.height)||400)-56,s=o===i.kB.MOBILE?(0,x.tZ)(lw,{width:r,height:a,gridComponent:e,depth:n}):(0,x.tZ)(mw,{width:r,height:a,gridComponent:e,depth:n});return(0,x.tZ)("div",{className:"dashboard-component-tabs-content"},(0,x.tZ)(ww,{className:"grid-content","data-test":"grid-content"},(0,x.tZ)("div",{"data-test":"tab-component"},s)))}return(0,x.tZ)("div",{className:"dashboard-component-tabs-content"},(0,x.tZ)(ww,{className:"grid-content","data-test":"grid-content"},m?this.renderMobileDrawerWrapPopUp(v):(0,x.tZ)(a.Fragment,null,r&&!e.children.length&&(0,x.tZ)(Wn,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget empty-top"},kw),(0,x.tZ)("div",{"data-test":"tab-component"},e.children.map(((e,t)=>this.renderTabComponent({id:e,index:t}))),v),r&&(0,x.tZ)(Wn,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,onHover:this.handleOnHover,editMode:!0,className:"empty-droptarget empty-bottom"},Zw))))}renderTab(){const{component:e,parentComponent:t,index:n,depth:r,editMode:o,isFocused:i,isHighlighted:a}=this.props;return(0,x.tZ)(Wn,{component:e,parentComponent:t,orientation:"column",index:n,depth:r,onDrop:this.handleDrop,onHover:this.handleOnHover,editMode:o},(({dropIndicatorProps:t,dragSourceRef:r})=>(0,x.tZ)(Sw,{isHighlighted:a,className:"dragdroppable-tab",ref:r},(0,x.tZ)(au.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:o&&i,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:o&&i&&!1}),!o&&(0,x.tZ)(Qd.Z,{id:e.id,dashboardId:this.props.dashboardId,placement:n>=5?"left":"right"}),t&&(0,x.tZ)("div",t))))}render(){const{renderType:e}=this.props;return e===vw?this.renderTab():this.renderTabContent()}}Mw.propTypes=yw,Mw.defaultProps=xw;const Dw=(0,o.$j)((function(e){var t;const{mobileDashboardLayout:n,dashboardInfo:r,nativeFilters:o,dashboardLayout:a,dashboardState:s}=e,l=null==r||null==(t=r.metadata)?void 0:t.layout_type,d=s.layoutMode===i.kB.MOBILE?n:a;return{canEdit:e.dashboardInfo.dash_edit_perm,...ul({mobileDashboardLayout:n,dashboardInfo:r,nativeFilters:o}),layout_type:l,dashboardLayout:d}}),(function(e){return(0,r.DE)({setEditMode:ss.Mb,setDashboardDrawerStatus:ss.RP},e)}))(Mw),Ew="tabChangeMode",Rw={min:1,default:2,step:.5,unit:{value:"s",label:(0,d.t)("second"),scale2MS:1e3},description:(0,d.t)("Interval time")};var Tw;!function(e){e.Manual="manual",e.Automatic="automatic"}(Tw||(Tw={}));Tw.Manual,(0,d.t)("Manual mode"),Tw.Automatic,(0,d.t)("Automatic mode");a.PureComponent;function _w({currentComponent:e,directPathToChild:t=[]}){if(!e||0===t.length||-1===t.indexOf(e.id))return-1;const n=t.findIndex((t=>t===e.id)),r=t[n+1];return e.children.indexOf(r)>=0?e.children.findIndex((e=>e===r)):-1}function Iw(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function Ow(e=[]){if(e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!Be.Ep.includes(n))return e}}return null}const Pw={id:l().string.isRequired,parentId:l().string.isRequired,component:It.cP.isRequired,parentComponent:It.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderTabContent:l().bool,editMode:l().bool.isRequired,layoutMode:i.kB,renderHoverMenu:l().bool,directPathToChild:l().arrayOf(l().string),activeTabs:l().arrayOf(l().string),filterboxMigrationState:l().oneOf(Object.keys(nt.Qi).map((e=>nt.Qi[e]))),logEvent:l().func.isRequired,setActiveTabs:l().func,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,createComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,onChangeTab:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired},zw={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,activeTabs:[],directPathToChild:[],filterboxMigrationState:nt.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},Fw=y.iK.div`
  width: 100%;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};

  .dashboard-component-tabs-content {
    min-height: ${({theme:e})=>12*e.gridUnit}px;
    // > 优化 => 去掉头部头部菜单与内容间距产生的1px差距
    // margin-top: ${({theme:e})=>e.gridUnit/4}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${({theme:e})=>12.5*e.gridUnit}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class Nw extends a.PureComponent{constructor(e){super(e),this.getTabInfo=e=>{var t;let n=Math.max(0,_w({currentComponent:e.component,directPathToChild:e.directPathToChild}));0===n&&null!=(t=e.activeTabs)&&t.length&&e.component.children.forEach(((t,r)=>{0===n&&e.activeTabs.includes(t)&&(n=r)}));const{children:r}=e.component,o=r[n];return{tabIndex:n,activeKey:o}},this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;de.xT.confirm({title:(0,d.t)("Delete dashboard tab?"),content:(0,x.tZ)("span",null,(0,d.t)("Deleting a tab will remove all content within it. You may still reverse this action with the")," ",(0,x.tZ)("b",null,(0,d.t)("undo"))," ",(0,d.t)("button (cmd + z) until you save your changes.")),onOk:()=>{n(e,t.id);const r=t.children.indexOf(e);this.handleDeleteTab(r)},okType:"danger",okText:(0,d.t)("DELETE"),cancelText:(0,d.t)("CANCEL"),icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:r}=this.props;"add"===t?(null==e||null==e.stopPropagation||e.stopPropagation(),r({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:Be.Xk,type:f.gn}})):"remove"===t&&this.showDeleteConfirmModal(e)},this.setTabCarousel=e=>{var t;const{component:n}=this.props,{children:r,meta:o}=n,{mode:i,interval:a}=null!=(t=null==o?void 0:o[Ew])?t:{};this.tabTimerId&&(clearInterval(this.tabTimerId),this.tabTimerId=null),i===Tw.Automatic&&a&&e&&(this.tabTimerId=setInterval((()=>{const e=r.indexOf(this.state.activeKey),t=e>=r.length-1?0:e+1;this.setState({tabIndex:t},(()=>{this.handleClickTab(t)}))}),a*Rw.unit.scale2MS))};const{tabIndex:t,activeKey:n}=this.getTabInfo(e);this.state={tabIndex:t,activeKey:n,isFocused:!1},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeTabChangeMode=this.handleUpdateMeta.bind(this,Ew)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})));const{setShowComponentPropertyPane:t,component:n}=this.props;e&&(null==t||t(n.id))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&!Tr()(r.meta[e],t)&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}componentDidMount(){this.props.setActiveTabs(this.state.activeKey),this.setTabCarousel(!0)}componentWillUnmount(){this.setTabCarousel(!1)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey),e.editMode!==this.props.editMode&&this.setTabCarousel(!0)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,r=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),e.dashboardId!==this.props.dashboardId){const{tabIndex:t,activeKey:n}=this.getTabInfo(e);this.setState((()=>({tabIndex:t,activeKey:n})))}if(e.isComponentVisible){const t=Ow(e.directPathToChild),o=Ow(this.props.directPathToChild);if(t!==o||t===o&&n!==r){const t=_w({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:r[t]})))}}e.editMode&&this.setTabCarousel(!1)}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=Iw(t,e),r=n[n.length-1];this.props.logEvent(ie.Iq,{target_id:r,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.state.tabIndex===e&&this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==f.yR&&this.props.handleComponentDrop(e)}settingButtonClick(e){const{layoutType:t,isFulling:n,setShowComponentPropertyPane:r,component:o}=this.props;"grid"===t&&e.stopPropagation(),n?null==r||r(null):null==r||r(o.id)}render(){const{depth:e,component:t,parentComponent:n,index:r,availableColumnCount:o,columnWidth:a,onResizeStart:s,onResize:l,onResizeStop:d,renderTabContent:u,renderHoverMenu:c,isComponentVisible:p,editMode:h,layoutMode:f,nativeFilters:g,layoutType:m,componentTarget:v}=this.props,b=f===i.kB.MOBILE?ih:Pk,{children:y}=t,{tabIndex:C,activeKey:w,isFocused:S}=this.state;let Z;const k=(null==g?void 0:g.focusedFilterId)||(null==g?void 0:g.hoveredFilterId);var M;k&&(Z=null==(M=g.filters[k])?void 0:M.tabsInScope);let D={};if("grid"===m){var E,R,T,_,I,O;const e=null==(E=document.querySelector(`#${t.id}`))?void 0:E.clientWidth,n=null==(R=document.querySelector(`#${t.id}`))?void 0:R.clientHeight;let r=null==(T=t.meta.gridLayoutConf)||null==(_=T.style)?void 0:_.width,o=null==(I=t.meta.gridLayoutConf)||null==(O=I.style)?void 0:O.height;var P,z,F,N;if(Number(e))r=e;else r=null==(P=t.meta.gridLayoutConf)||null==(z=P.style)?void 0:z.width;if(Number(n))o=n;else o=null==(F=t.meta.gridLayoutConf)||null==(N=F.style)?void 0:N.height;D={width:r,height:o}}return(0,x.tZ)(Wn,{component:t,parentComponent:n,orientation:"row",index:r,depth:e,onDrop:this.handleDrop,editMode:h},(({dropIndicatorProps:r,dragSourceRef:c})=>(0,x.tZ)(bp,{isFocused:f!==i.kB.MOBILE&&this.state.isFocused,onChangeFocus:this.handleChangeFocus,editMode:f!==i.kB.MOBILE&&h},(0,x.tZ)(Fw,{className:"dashboard-component dashboard-component-tabs","data-test":"dashboard-component-tabs",style:D,onMouseEnter:()=>!h&&this.setTabCarousel(!1),onMouseLeave:()=>!h&&this.setTabCarousel(!0),onDoubleClick:e=>{"grid"===m&&this.settingButtonClick(e)},tabIndex:0,onBlur:()=>{f===i.kB.MOBILE&&this.handleChangeFocus(!1)},onFocus:()=>{f===i.kB.MOBILE&&this.handleChangeFocus(!0)}},h&&"grid"===m&&t.id==v&&(0,x.tZ)(Lp,{component:t,handleToggleFullSize:()=>{}}),h&&"grid"!==m&&f!==i.kB.MOBILE&&(0,x.tZ)(Dp,{float:!1,buttons:[{key:"box-icon-delete",type:"delete",size:"xxl"}],onDelete:this.handleDeleteComponent,isFocused:this.state.isFocused,toolmode:"click"}),(0,x.tZ)(ko.cl,{id:t.id,activeKey:w,onChange:e=>{this.handleClickTab(y.indexOf(e))},onEdit:this.handleEdit,"data-test":"nav-list",type:h?"editable-card":"card"},y.map(((n,r)=>{var i;return(0,x.tZ)(ko.cl.TabPane,{key:n,tab:(0,x.tZ)(b,{id:n,parentId:t.id,styleTabsBox:D,depth:e,index:r,renderType:vw,availableColumnCount:o,columnWidth:a,onDropOnTab:this.handleDropOnTab,onHoverTab:()=>this.handleClickTab(r),isFocused:w===n,isHighlighted:w!==n&&(null==(i=Z)?void 0:i.includes(n))})},u&&(0,x.tZ)(b,{id:n,parentId:t.id,styleTabsBox:D,depth:e,index:r,renderType:bw,availableColumnCount:o,columnWidth:a,onResizeStart:s,onResize:l,onResizeStop:d,onDropOnTab:this.handleDropOnTab,isComponentVisible:C===r&&p}))}))),r&&n.id!==Be._4&&(0,x.tZ)("div",r)))))}}Nw.propTypes=Pw,Nw.defaultProps=zw;const $w=(0,o.$j)((function(e){var t,n;return{nativeFilters:e.nativeFilters,activeTabs:e.dashboardState.activeTabs,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState,layoutType:null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type,componentTarget:e.dashboardState.dashboardComponentTarget,isFulling:e.dashboardState.isFulling}}))(Nw);var Lw=n(704851);const Bw=e=>{const t="image/jpeg"===e.type||"image/png"===e.type;t||Y.ZP.error("You can only upload JPG/PNG file!");const n=e.size/1024/1024<2;return n||Y.ZP.error("Image must smaller than 2MB!"),t&&n},Aw=y.iK.div`
  ${({theme:e})=>x.iv`
    &.dashboard-markdown {
      overflow: hidden;
      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
        .ant-upload-picture-card-wrapper {
          width: 100%;
          height: 100%;
        }
        .ant-upload {
          width: 100%;
          height: 100%;
        }
      }
      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`,jw=e=>{var t,n,r,s,l;const{component:d,parentComponent:u,index:c,depth:p,availableColumnCount:h,columnWidth:g,onResize:m,onResizeStop:v,handleComponentDrop:y,deleteComponent:C,id:w,parentId:S,onResizeStart:Z,updateComponents:k,fullSizeChartId:M}=e,D=((0,o.v9)((e=>e)),(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type}))),E=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),R=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.layout_mode})),T=(null==d?void 0:d.meta)||{},_=null==T?void 0:T.height,I=(0,o.v9)((e=>e.dashboardState.viewType)),O=(0,o.v9)((e=>e.dashboardState.ratioX)),P=(0,o.I0)(),[z,F]=(0,a.useState)(!1),[N,$]=(0,a.useState)(null==d||null==(t=d.meta)?void 0:t.code),[L,B]=(0,a.useState)(null),[A,j]=(0,a.useState)("preview"),[H,q]=(0,a.useState)(!1),[U,V]=(0,a.useState)((null==d||null==(n=d.meta)?void 0:n.url)||""),W=(0,a.useMemo)((()=>"grid"==D?!e.editMode:e.editMode),[e,D]),{gridLayoutConf:G={}}=T,{style:K={}}=G;let{height:Y=0,width:X=0}=K;const Q=null==d?void 0:d.id,J=gp(Q),ee=M===Q,te=R===i.kB.MOBILE?Be.Pj:Be.es,ne=e=>{F(!!e)},re=(0,a.useCallback)((()=>{k({[d.id]:{...d,meta:{...d.meta,layoutType:"float"===d.meta.layoutType?"grid":"float"}}})}),[k,w,d]),oe=(0,a.useCallback)((()=>{var e;k({[d.id]:{...d,meta:{...d.meta,pos:{...d.meta.pos,index:((null==(e=d.meta.pos)?void 0:e.index)||100)+1}}}})}),[k,w,d]),ie=(0,a.useCallback)((()=>{var e;k({[d.id]:{...d,meta:{...d.meta,pos:{...d.meta.pos,index:((null==(e=d.meta.pos)?void 0:e.index)||100)-1}}}})}),[k,w,d]),ae=()=>{C(w,S)},se=e=>{Z(e)},le=e=>{"uploading"!==e.file.status?"done"===e.file.status&&((e,t)=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.readAsDataURL(e)})(e.file.originFileObj,(t=>{var n,r,o;q(!1);const i=(null==e||null==(n=e.file)||null==(r=n.response)||null==(o=r.result)?void 0:o.url)||t;V(i),P((0,vl.Iz)({url:i,id:w})),P((0,bl.Iz)({url:i,id:w})),P((0,ss.if)(!0))})):q(!0)},de=(null==u?void 0:u.type)===f.BA?(null==u||null==(r=u.meta)?void 0:r.width)||Be.cx:(null==d||null==(s=d.meta)?void 0:s.width)||Be.cx,ue="edit"===A,ce=(0,x.tZ)("div",null,H?(0,x.tZ)(Lw.default,null):(0,x.tZ)(zl.default,null),(0,x.tZ)("div",{style:{marginTop:8}},"Upload"));var pe,he;(J.zIndex=`${(null==(l=d.meta.pos)?void 0:l.index)||100}`,"float"===d.meta.layoutType&&d.meta.pos)&&(J.position="absolute",J.left=`${(null==(pe=d.meta.pos)?void 0:pe.x)||0}px`,J.top=`${(null==(he=d.meta.pos)?void 0:he.y)||0}px`);const{chartWidth:fe,chartHeight:ge}=(0,a.useMemo)((()=>{let e=0,t=0;if(ee)e=window.innerWidth-2,t=window.innerHeight-2;else if(e=Math.floor(de*g+(de-1)*te-2),t=Math.floor(_*Be.cd-2),"grid"==I){e=X*(O>0?O:1)-30,t=Y-30}return{chartWidth:e,chartHeight:t}}),[g,d,ee,de]),me=e=>{"grid"===D&&e.stopPropagation(),P((0,ss.ks)(d.id))},ve=(0,x.tZ)("img",{src:U,alt:"avatar",style:{width:"100%",height:"100%"},crossOrigin:"anonymous"});return(0,x.tZ)(Wn,{component:d,parentComponent:u,orientation:(null==u?void 0:u.type)===f.Os?"column":"row",index:c,depth:p,onDrop:y,disableDragDrop:"grid"===D?W:!W,editMode:W,style:J},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,x.tZ)(bp,{onChangeFocus:ne,editMode:W},(0,x.tZ)(Aw,{"data-test":"dashboard-markdown-editor",className:b()("dashboard-markdown",ue&&"dashboard-markdown--editing"),id:d.id},(0,x.tZ)(hp,{id:d.id,adjustableWidth:(null==u?void 0:u.type)===f.Os,adjustableHeight:!0,viewType:D,widthStep:g,widthMultiple:de,heightStep:Be.cd,heightMultiple:d.meta.height,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:h+de,onResizeStart:se,onResize:m,onResizeStop:v,editMode:"grid"!==D&&W,layoutMode:R,isFullSize:ee},(0,x.tZ)("div",{ref:n,className:"dashboard-component dashboard-component-chart-holder","data-test":"dashboard-component-chart-holder",onClick:me},!W&&"grid"===D&&d.id==E&&(0,x.tZ)(Lp,{component:d,handleToggleFullSize:()=>{}}),W&&(0,x.tZ)(Dp,{float:"float"===d.meta.layoutType,onTop:oe,onBottom:ie,onDelete:ae,onFixed:re,isFocused:z,toolmode:"click"}),W&&"grid"!==D||!W&&"grid"===D?(0,x.tZ)(sl.Z,{name:"formData",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"/api/v1/file/upload",disabled:!e.editMode,beforeUpload:Bw,onChange:le},U?ve:ce):U?ve:null))),t&&(0,x.tZ)("div",t))))},Hw=y.iK.div`
  ${({theme:e})=>x.iv`
    &.rect-box {
      overflow: hidden;
      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
        .ant-upload-picture-card-wrapper {
          width: 100%;
          height: 100%;
        }
        .ant-upload {
          width: 100%;
          height: 100%;
        }
      }
      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`,qw=e=>{var t,n;const{component:r,parentComponent:s,index:l,depth:u,availableColumnCount:c,columnWidth:p,onResize:h,onResizeStop:g,handleComponentDrop:m,deleteComponent:v,id:y,parentId:C,onResizeStart:w,updateComponents:S,fullSizeChartId:Z}=e,k=(0,o.v9)((e=>e.dashboardState.viewType)),M=(0,o.v9)((e=>e.dashboardState.ratioX)),D=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),E=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),R=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.layout_mode})),T=R===i.kB.MOBILE?Be.Pj:Be.es,_=(0,a.useMemo)((()=>"grid"==D?!e.editMode:e.editMode),[e,D]),I=(null==r?void 0:r.meta)||{},O=null==I?void 0:I.width,P=null==I?void 0:I.height,z=(null==I?void 0:I.lineType)||"solid",F=parseInt((null==I?void 0:I.lineSize)||2,10),N=(null==I?void 0:I.lineColor)||"#000000",$=null==I?void 0:I.radiusBox,{gridLayoutConf:L={}}=I,{style:B={}}=L;let{height:A=0,width:j=0}=B;const H=null==r?void 0:r.id,q=gp(H),U={opacity:1,borderStyle:z,borderWidth:F,borderRadius:($||0)+"px",borderColor:N,padding:0},V=Z===H,W=Zl.Z.find((e=>e.value===(r.meta.background||Be.HE))),G=((0,o.v9)((e=>e)),(0,o.I0)()),[K,Y]=(0,a.useState)(!1),[X,Q]=(0,a.useState)("preview"),J=e=>{Y(!!e)},ee=(0,a.useCallback)((()=>{S({[r.id]:{...r,meta:{...r.meta,layoutType:"float"===r.meta.layoutType?"grid":"float"}}})}),[S,y,r]),te=(0,a.useCallback)((()=>{var e;S({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)+1}}}})}),[S,y,r]),ne=(0,a.useCallback)((()=>{var e;S({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)-1}}}})}),[S,y,r]),re=()=>{v(y,C)},oe=e=>{w(e)},ie=(null==s?void 0:s.type)===f.BA?(null==s||null==(t=s.meta)?void 0:t.width)||Be.cx:O||Be.cx,ae="edit"===X;(0,d.t)("solid"),(0,d.t)("dashed"),(0,d.t)("dotted");var se,le;(q.zIndex=`${(null==(n=r.meta.pos)?void 0:n.index)||100}`,"float"===r.meta.layoutType&&r.meta.pos)&&(q.position="absolute",q.left=`${(null==(se=r.meta.pos)?void 0:se.x)||0}px`,q.top=`${(null==(le=r.meta.pos)?void 0:le.y)||0}px`);const{chartWidth:de,chartHeight:ue}=(0,a.useMemo)((()=>{let e=0,t=0;if(V)e=window.innerWidth-2,t=window.innerHeight-2;else if(e=Math.floor(ie*p+(ie-1)*T-2),t=Math.floor(P*Be.cd-2),"grid"==k){e=j*(M>0?M:1)-30,t=A-30}return{chartWidth:e,chartHeight:t}}),[p,r,V,ie]),ce=e=>{"grid"===D&&e.stopPropagation(),G((0,ss.ks)(r.id))};return(0,x.tZ)(Wn,{component:r,parentComponent:s,orientation:(null==s?void 0:s.type)===f.Os?"column":"row",index:l,depth:u,onDrop:m,disableDragDrop:"grid"===D?_:!_,editMode:_,style:q},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,x.tZ)(bp,{onChangeFocus:J,editMode:_},(0,x.tZ)(Hw,{"data-test":"rect-box",className:b()("rect-box",ae&&"rect-box--editing",W.className),id:r.id},(0,x.tZ)(hp,{id:r.id,adjustableWidth:(null==s?void 0:s.type)===f.Os,adjustableHeight:!0,viewType:D,widthStep:p,widthMultiple:ie,heightStep:Be.cd,heightMultiple:P,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:c+ie,onResizeStart:oe,onResize:h,onResizeStop:g,editMode:"grid"!==D&&_,layoutMode:R,isFullSize:V},(0,x.tZ)("div",{ref:t,className:b()("dashboard-component","dashboard-component-chart-holder",W.className),style:{...U,backgroundColor:r.meta.bgColor,transition:"background-color 100ms linear 0s"},"data-test":"dashboard-component-chart-holder",onClick:ce},!_&&"grid"===D&&r.id==E&&(0,x.tZ)(Lp,{component:r,handleToggleFullSize:()=>{}}),_&&(0,x.tZ)(Dp,{float:"float"===r.meta.layoutType,onTop:te,onBottom:ne,onDelete:re,onFixed:ee,isFocused:K,toolmode:"click"})))),e&&(0,x.tZ)("div",e))))},Uw=e=>{var t,n;const{component:r,parentComponent:i,index:s,depth:l,handleComponentDrop:u,columnWidth:c,availableColumnCount:p,onResizeStart:h,onResizeStop:g,onResize:m,deleteComponent:v,parentId:y,updateComponents:C,id:w}=e,S=(0,o.I0)(),[Z,k]=(0,a.useState)(!1),M=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),D=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),E=(0,o.v9)((e=>e.dashboardState.isFulling)),R=(0,a.useMemo)((()=>"grid"==M?!e.editMode:e.editMode),[e,M]),T=(0,a.useMemo)((()=>!("grid"!=M||E||!e.editMode)),[e,M]),_=(0,a.useMemo)((()=>!("grid"!=M||!e.editMode)||e.isEdit),[e]),{chartId:I}=r.meta,O=gp(I),P=(null==i?void 0:i.type)===f.BA?(null==i||null==(t=i.meta)?void 0:t.width)||Be.cx:r.meta.width||Be.cx,z=(0,a.useCallback)((()=>{C({[r.id]:{...r,meta:{...r.meta,layoutType:"float"===r.meta.layoutType?"grid":"float"}}})}),[C,w,r]),F=(0,a.useCallback)((()=>{var e;C({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)+1}}}})}),[C,w,r]),N=(0,a.useCallback)((()=>{var e;C({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)-1}}}})}),[C,w,r]),$=()=>{v(w,y)},L=Zl.Z.find((e=>e.value===(r.meta.background||Be.HE))),B=e=>{k(e)},{Component:A,...j}=sr.get(r.meta.componentKey),H=(0,o.v9)((({nativeFilters:e,dataMask:t})=>({nativeFilters:e,dataMask:t})));var q,U;(O.zIndex=`${(null==(n=r.meta.pos)?void 0:n.index)||100}`,"float"===r.meta.layoutType&&r.meta.pos)&&(O.position="absolute",O.left=`${(null==(q=r.meta.pos)?void 0:q.x)||0}px`,O.top=`${(null==(U=r.meta.pos)?void 0:U.y)||0}px`);const V=e=>{"grid"==M&&e.stopPropagation(),S((0,ss.ks)(r.id))},W=(0,a.useMemo)((()=>{const{backgroundColor:e="rgba(255,255,255,1)",backgroundImage:t,backgroundType:n}=r.meta;return"color"!=n&&n?{backgroundColor:"rgba(255,255,255,1)",backgroundImage:`url(${t})`,backgroundSize:"cover",backgroundPosition:"center center"}:{background:`${e}`,transition:"background-color 100ms linear 0s"}}),[r]),G=(0,a.useMemo)((()=>{const{fontSize:e,fontFamily:t,fontWeight:n,textColor:o,sliceNameLine:i}=r.meta;return{fontSize:`${e||14}px`,fontFamily:t||"SimSun",fontWeight:n||500,color:o||"rgba(0,0,0,1)",textAlign:i||"left"}}),[r]);return(0,x.tZ)(Wn,{component:r,parentComponent:i,orientation:(null==i?void 0:i.type)===f.Os?"column":"row",index:s,depth:l,onDrop:u,disableDragDrop:"grid"===M||!R,editMode:R,style:O},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,x.tZ)(a.Fragment,null,_&&l<=2&&(0,x.tZ)(wp,{position:"left"},(0,x.tZ)(th,{position:"left"})),(0,x.tZ)(bp,{onChangeFocus:B,menuItems:[],editMode:R},(0,x.tZ)("div",{"data-test":`dashboard-${r.meta.componentKey}`,className:b()("dashboard-component","dashboard-component-header",`dashboard-${r.meta.componentKey}`,null==L?void 0:L.className),id:r.id,onClick:V},T&&r.id==D&&"grid"==M&&(0,x.tZ)(Lp,{component:r,handleToggleFullSize:()=>{}}),_&&(0,x.tZ)(Dp,{float:"float"===r.meta.layoutType,onTop:F,onBottom:N,onDelete:$,onFixed:z,isFocused:Z,toolmode:"click"}),(0,x.tZ)(hp,{id:r.id,adjustableWidth:(null==i?void 0:i.type)===f.Os,widthStep:c,widthMultiple:P,heightStep:Be.cd,adjustableHeight:!1,heightMultiple:r.meta.height,minWidthMultiple:Be.cx,minHeightMultiple:Be.cx,maxWidthMultiple:p+P,onResizeStart:h,onResize:m,onResizeStop:g,editMode:"grid"!==M&&R},(0,x.tZ)("div",{ref:n,style:{...W,...G},className:"dashboard-component","data-test":"dashboard-component-chart-holder"},(0,x.tZ)(a.Suspense,{fallback:(0,x.tZ)("div",null,(0,d.t)("Loading..."))},(0,x.tZ)(A,{multiLine:!0,dashboardData:H,dashboardComponentProps:j,dynamicComponentProps:e}))))),t&&(0,x.tZ)("div",t)))))},Vw=y.iK.div`
  ${({theme:e})=>x.iv`
    &.rect-arrow {
      overflow: hidden;
      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
        .ant-upload-picture-card-wrapper {
          width: 100%;
          height: 100%;
        }
        .ant-upload {
          width: 100%;
          height: 100%;
        }
      }
      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`,Ww=e=>{var t,n,r;const{component:s,parentComponent:l,index:u,depth:c,availableColumnCount:p,columnWidth:h,onResize:g,onResizeStop:m,handleComponentDrop:v,deleteComponent:C,id:w,parentId:S,onResizeStart:Z,updateComponents:k,fullSizeChartId:M}=e,D=(0,o.v9)((e=>e.dashboardState.viewType)),E=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),R=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),T=(0,o.v9)((e=>e.dashboardState.ratioX)),_=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.layout_mode})),I=null==s||null==(t=s.id)?void 0:t.replaceAll("-","").replaceAll("_",""),O="boxuniid"+I,P=(null==s?void 0:s.meta)||{},z=null==P?void 0:P.width,F=null==P?void 0:P.height,N=(null==P?void 0:P.lineType)||"solid",$=parseInt((null==P?void 0:P.lineSize)||2,10),L=(null==P?void 0:P.lineColor)||"#000000",B=(null==P?void 0:P.rotate)||0,A=_===i.kB.MOBILE?Be.Pj:Be.es,j=(0,a.useMemo)((()=>"grid"==E?!e.editMode:e.editMode),[e,E]),{gridLayoutConf:H={}}=P,{style:q={}}=H;let{height:U=0,width:V=0}=q;const W={backgroundColor:"rgb(255,255,255,0)",overflow:"hidden"},G=Zl.Z.find((e=>e.value===(s.meta.background||Be.HE))),K=null==s?void 0:s.id,Y=gp(K),X=M===K,Q=((0,o.v9)((e=>e)),(0,o.I0)()),[J,ee]=(0,a.useState)(!1),[te,ne]=(0,a.useState)(0),[re,oe]=(0,a.useState)(0),[ie,ae]=(0,a.useState)("preview"),se=(0,a.useCallback)((()=>{k({[s.id]:{...s,meta:{...s.meta,layoutType:"float"===s.meta.layoutType?"grid":"float"}}})}),[k,w,s]),le=(0,a.useCallback)((()=>{var e;k({[s.id]:{...s,meta:{...s.meta,pos:{...s.meta.pos,index:((null==(e=s.meta.pos)?void 0:e.index)||100)+1}}}})}),[k,w,s]),de=(0,a.useCallback)((()=>{var e;k({[s.id]:{...s,meta:{...s.meta,pos:{...s.meta.pos,index:((null==(e=s.meta.pos)?void 0:e.index)||100)-1}}}})}),[k,w,s]),ue=e=>{ee(!!e)},ce=()=>{C(w,S)},pe=e=>{Z(e)},he=(null==l?void 0:l.type)===f.BA?(null==l||null==(n=l.meta)?void 0:n.width)||Be.cx:z||Be.cx,fe="edit"===ie,[ge,me]=((0,d.t)("solid"),(0,d.t)("dashed"),(0,d.t)("dotted"),(0,a.useState)(B)),ve=(0,a.useCallback)(Lt()((e=>{me(e)}),100),[]);var be,ye;((0,a.useEffect)((()=>{ve(B)}),[B]),(0,a.useEffect)((()=>{const e=document.getElementById(O);if(e&&e.offsetWidth!==te){const t=e.offsetWidth-32,n=e.offsetHeight-32;t>0&&n>0&&(ne(t),oe(n))}})),(0,a.useEffect)((()=>{if(te<10)return;const e=document.getElementById(I).getContext("2d");"solid"===N||("dashed"===N?e.setLineDash([5,5]):(e.setLineDash([5,5]),e.lineCap="round",e.setLineDash([0,10])));const t=.7*te,n=.2*re;e.beginPath(),e.moveTo(5,n),e.lineTo(t,n),e.lineTo(t,0),e.lineTo(te,.5*re),e.lineTo(t,re),e.lineTo(t,re-n),e.lineTo(5,re-n),e.closePath(),e.lineWidth=$,e.strokeStyle=0===$?"rgb(255,255,255,0)":L,e.stroke()})),Y.zIndex=`${(null==(r=s.meta.pos)?void 0:r.index)||100}`,"float"===s.meta.layoutType&&s.meta.pos)&&(Y.position="absolute",Y.left=`${(null==(be=s.meta.pos)?void 0:be.x)||0}px`,Y.top=`${(null==(ye=s.meta.pos)?void 0:ye.y)||0}px`);let xe=1;const Ce=Math.abs(te*Math.cos(ge))+Math.abs(re*Math.sin(ge)),we=Math.abs(te*Math.sin(ge))+Math.abs(re*Math.cos(ge));xe=Math.min(te/Ce,re/we);const Se=y.iK.div`
    ${({component:e})=>x.iv`
  position: relative;
  .canv{
    -webkit-transform: rotate(${ge}deg) scale(${xe});
 }
  }
  `}
  `,{chartWidth:Ze,chartHeight:ke}=(0,a.useMemo)((()=>{let e=0,t=0;if(X)e=window.innerWidth-2,t=window.innerHeight-2;else if(e=Math.floor(he*h+(he-1)*A-2),t=Math.floor(F*Be.cd-2),"grid"==D){e=V*(T>0?T:1)-30,t=U-30}return{chartWidth:e,chartHeight:t}}),[h,s,X,he]),Me=e=>{"grid"===E&&e.stopPropagation(),Q((0,ss.ks)(s.id))};return(0,x.tZ)(Wn,{component:s,parentComponent:l,orientation:(null==l?void 0:l.type)===f.Os?"column":"row",index:u,depth:c,onDrop:v,disableDragDrop:"grid"===E?j:!j,editMode:j,style:Y},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,x.tZ)(bp,{onChangeFocus:ue,editMode:j,isWrap:j&&_===i.kB.MOBILE},(0,x.tZ)(Vw,{"data-test":"rect-arrow",className:b()("rect-arrow",fe&&"rect-arrow--editing",G.className),id:s.id},(0,x.tZ)(hp,{id:s.id,adjustableWidth:(null==l?void 0:l.type)===f.Os,adjustableHeight:!0,viewType:E,widthStep:h,widthMultiple:he,heightStep:Be.cd,heightMultiple:F,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:p+he,onResizeStart:pe,onResize:g,onResizeStop:m,layoutMode:_,isFullSize:X,editMode:"grid"!==E&&j},(0,x.tZ)("div",{ref:t,style:{...W,backgroundColor:s.meta.bgColor,transition:"background-color 100ms linear 0s"},className:b()("dashboard-component","dashboard-component-chart-holder",G.className),id:O,"data-test":"dashboard-component-chart-holder",onClick:Me},!j&&"grid"===E&&s.id==R&&(0,x.tZ)(Lp,{component:s,handleToggleFullSize:()=>{}}),j&&(0,x.tZ)(Dp,{float:"float"===s.meta.layoutType,onTop:le,onBottom:de,onDelete:ce,onFixed:se,isFocused:J,toolmode:"click"}),(0,x.tZ)(Se,{component:s},(0,x.tZ)("canvas",{id:I,className:"canv",width:te,height:re}))))),e&&(0,x.tZ)("div",e))))},Gw=y.iK.div`
  ${({marginBtnTop:e})=>x.iv`
    margin-top: ${e}px;
    &.search-filter {
      width: 100%;
      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
      }
      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`,Kw=e=>{var t,n;const{component:r,parentComponent:i,index:s,depth:l,availableColumnCount:u,columnWidth:c,onResize:p,onResizeStop:h,handleComponentDrop:g,deleteComponent:m,id:v,parentId:y,onResizeStart:C,updateComponents:S}=e,Z=(0,o.I0)(),k=(0,a.useContext)(hD),M=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),D=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),{dataMaskSelected:E,handleClearAll:R}=k,T=(Pp(),(0,a.useMemo)((()=>"grid"==M?!e.editMode:e.editMode),[e,M])),[_,I]=(0,a.useState)(!1),[O,P]=(0,a.useState)("preview"),{chartId:z}=r.meta,F=r.type,N=(null==r?void 0:r.meta)||{},$=parseInt((null==N?void 0:N.btnHeight)||32,10),L=(null==N?void 0:N.marginBtnTop)||0,B=null==N?void 0:N.width,A=null==N?void 0:N.height,j=Zl.Z.find((e=>e.value===(r.meta.background||Be.HE))),H=gp(z);var q,U;(H.zIndex=`${(null==(t=r.meta.pos)?void 0:t.index)||100}`,"float"===r.meta.layoutType&&r.meta.pos)&&(H.position="absolute",H.left=`${(null==(q=r.meta.pos)?void 0:q.x)||0}px`,H.top=`${(null==(U=r.meta.pos)?void 0:U.y)||0}px`);const V="edit"===O,W=(null==i?void 0:i.type)===f.BA?(null==i||null==(n=i.meta)?void 0:n.width)||Be.cx:B||Be.cx,G=e=>{I(!!e)},K=e=>{C(e)},Y=(0,a.useCallback)((()=>{var e;S({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)+1}}}})}),[S,v,r]),X=(0,a.useCallback)((()=>{var e;S({[r.id]:{...r,meta:{...r.meta,pos:{...r.meta.pos,index:((null==(e=r.meta.pos)?void 0:e.index)||100)-1}}}})}),[S,v,r]),Q=(0,a.useCallback)((()=>{S({[r.id]:{...r,meta:{...r.meta,layoutType:"float"===r.meta.layoutType?"grid":"float"}}})}),[S,v,r]),J=()=>{m(v,y)},ee=()=>{Object.keys(E).forEach((e=>{E[e]&&Z((0,w.updateDataMask)(e,E[e]))}))},te=e=>{"grid"===M&&e.stopPropagation(),Z((0,ss.ks)(r.id))};return(0,x.tZ)(Wn,{component:r,parentComponent:i,orientation:(null==i?void 0:i.type)===f.Os?"column":"row",index:s,depth:l,onDrop:g,disableDragDrop:"grid"===M?T:!T,editMode:T,style:H},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,x.tZ)(bp,{onChangeFocus:G,editMode:T},(0,x.tZ)(Gw,{"data-test":"filter-search",className:b()("filter-search",V&&"filter-search--editing",j.className),id:r.id,marginBtnTop:L},(0,x.tZ)(hp,{id:r.id,adjustableWidth:(null==i?void 0:i.type)===f.Os,adjustableHeight:!0,widthStep:c,widthMultiple:W,heightStep:2,heightMultiple:A,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:u+W,onResizeStart:K,onResize:p,onResizeStop:h,editMode:!_&&("grid"!==M&&T)},(0,x.tZ)("div",{ref:t,className:b()("dashboard-component","dashboard-component-chart-holder",j.className),style:j,"data-test":"dashboard-component-chart-holder",onClick:te},!T&&"grid"===M&&r.id==D&&(0,x.tZ)(Lp,{component:r,handleToggleFullSize:()=>{}}),T&&(0,x.tZ)(Dp,{float:"float"===r.meta.layoutType,onTop:Y,onBottom:X,onDelete:J,onFixed:Q,isFocused:_,toolmode:"click"}),F===f.kE&&(0,x.tZ)(se.Z,{type:"primary",onClick:ee,style:{width:"100%",height:`${$}px`}},(0,d.t)("Query button")),F===f.GV&&(0,x.tZ)(se.Z,{type:"primary",onClick:R,style:{width:"100%",height:`${$}px`}},(0,d.t)("Empty"))))),e&&(0,x.tZ)("div",e))))};var Yw=n(693315),Xw=n(485317),Qw=n(756363),Jw=n(591724);const eS="vlbodcGbVAI1dwfinzXg",tS="IcDQUcT5yRG0x8OEBphC",nS="IT7znFDaYPltqwMqpI33",rS="VfS_l6iGdZvjo0skebAN",oS="omJVKxhxaQIKjXkzUAge",iS="ulU8YYfVwMTvx8IpXa9r",aS="gxXe8mGtdAAIi0082djY";var sS=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lS="html",dS="svg",uS=function(e,t){var n,r,o,i={};if(e===lS)o=document.createElement("div");else{if(e!==dS)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');o=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"===typeof t)for(var a=0,s=Object.entries(t.attributes);a<s.length;a++){var l=s[a],d=l[0],u=l[1];o.setAttribute(d,u)}var c={element:o,elementType:e,setPortalProps:function(e){i=e},getInitialPortalProps:function(){return i},mount:function(t,o){if(o!==r){if(c.unmount(),t!==n&&!function(e,t){if(t===lS)return e instanceof HTMLElement;if(t===dS)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(c.element,o),n=t,r=o}},unmount:function(e){e&&e!==r||n&&r&&(n.replaceChild(r,c.element),n=void 0,r=void 0)}};return c},cS=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return sS(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,r=t.node;return xp.createPortal(a.Children.map(n,(function(t){return a.isValidElement(t)?a.cloneElement(t,e.state.nodeProps):t})),r.element)},t}(a.PureComponent),pS=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=a.createRef(),n.passPropsThroughPortal(),n}return sS(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){var e=this.props.node;e.unmount(this.placeholderNode.current),e.setPortalProps({})},t.prototype.render=function(){return a.createElement("div",{ref:this.placeholderNode})},t}(a.PureComponent),hS=uS.bind(null,lS),fS=(uS.bind(null,dS),n(899612)),gS=n(782607);const mS=(0,a.forwardRef)((({items:e,onOverflowingStateChange:t,dropdownContent:n,dropdownRef:r,dropdownStyle:o={},dropdownTriggerCount:i,dropdownTriggerIcon:s,dropdownTriggerText:l=(0,d.t)("More"),dropdownTriggerTooltip:u=null,style:c},p)=>{const h=(0,y.Fg)(),{ref:f,width:g=0}=(0,fS.NB)(),m=(0,da.D)(g)||0,{current:v}=f,[b,C]=(0,a.useState)([]),[w,S]=(0,a.useState)(!1),[Z,k]=a.useState(-1);let M=(0,a.useRef)(null);r&&(M=r);const[D,E]=(0,a.useState)(!1),R=e=>e.reduce((([e,t],n)=>(e.push({id:n.id,element:a.cloneElement(n.element,{key:n.id})}),t.push(n.id),[e,t])),[[],[]]),[T,_]=(0,a.useMemo)((()=>R(e.slice(0,-1!==Z?Z:e.length))),[e,Z]),[I,O]=(0,a.useMemo)((()=>-1!==Z?R(e.slice(Z)):[[],[]]),[e,Z]);(0,a.useLayoutEffect)((()=>{const t=null==v?void 0:v.children.item(0);if(t){const{children:n}=t,r=Array.from(n);if(b.length!==e.length){if(r.length!==e.length)return void k(-1);C(r.map((e=>e.getBoundingClientRect().width)))}const o=r.findIndex((e=>e.getBoundingClientRect().right>t.getBoundingClientRect().right+1));let i=-1===o&&I.length>0?e.length-I.length:o;if(g>m){const t=null==v?void 0:v.children.item(1),n=(null==t?void 0:t.getBoundingClientRect().right)||0,o=((null==v?void 0:v.getBoundingClientRect().right)||0)-n;let a=0;for(let t=r.length;t<e.length&&(a+=b[t],a<=o);t+=1)i=t+1}k(i)}}),[v,e.length,b,I.length,m,g]),(0,a.useEffect)((()=>{t&&t({notOverflowed:_,overflowed:O})}),[_,t,O]);const P=-1!==Z?e.length-Z:0,z=(0,a.useMemo)((()=>n||P?(0,x.tZ)("div",{css:x.iv`
              display: flex;
              flex-direction: column;
              gap: ${4*h.gridUnit}px;
            `,"data-test":"dropdown-content",style:o,ref:M},n?n(I):I.map((e=>e.element))):null),[n,P,h.gridUnit,o,I]);return(0,a.useLayoutEffect)((()=>{w&&setTimeout((()=>{M.current&&E(M.current.scrollHeight>500)}),100)}),[w]),(0,a.useImperativeHandle)(p,(()=>({...f.current,open:()=>S(!0)})),[f]),(0,a.useEffect)((()=>(document.onscroll=w?()=>S(!1):null,()=>{document.onscroll=null})),[w]),(0,x.tZ)("div",{ref:f,css:x.iv`
          display: flex;
          align-items: center;
        `},(0,x.tZ)("div",{css:x.iv`
            display: flex;
            align-items: center;
            gap: ${4*h.gridUnit}px;
            margin-right: ${4*h.gridUnit}px;
            min-width: 0px;
          `,"data-test":"container",style:c},T.map((e=>e.element))),z&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)(x.xB,{styles:x.iv`
                .ant-popover-inner-content {
                  max-height: ${500}px;
                  overflow: ${D?"auto":"visible"};
                  padding: ${3*h.gridUnit}px ${4*h.gridUnit}px;

                  // Some OS versions only show the scroll when hovering.
                  // These settings will make the scroll always visible.
                  ::-webkit-scrollbar {
                    -webkit-appearance: none;
                    width: 14px;
                  }
                  ::-webkit-scrollbar-thumb {
                    border-radius: 9px;
                    background-color: ${h.colors.grayscale.light1};
                    border: 3px solid transparent;
                    background-clip: content-box;
                  }
                  ::-webkit-scrollbar-track {
                    background-color: ${h.colors.grayscale.light4};
                    border-left: 1px solid ${h.colors.grayscale.light2};
                  }
                }
              `}),(0,x.tZ)(rc.ZP,{content:z,trigger:"click",visible:w,onVisibleChange:e=>S(e),placement:"bottom",destroyTooltipOnHide:!0},(0,x.tZ)(ce.u,{title:u},(0,x.tZ)(se.Z,{buttonStyle:"secondary","data-test":"dropdown-container-btn"},s,l,(0,x.tZ)(gS.Z,{count:null!=i?i:P,color:(null!=i?i:P)>0?h.colors.primary.base:h.colors.grayscale.light1,showZero:!0,css:x.iv`
                      margin-left: ${2*h.gridUnit}px;
                    `}),(0,x.tZ)(ae.Z.DownOutlined,{iconSize:"m",iconColor:h.colors.grayscale.light1,css:x.iv`
                      .anticon {
                        display: flex;
                      }
                    `}))))))})),vS=mS,bS=({filtersOutOfScope:e,renderer:t,hasTopMargin:n,horizontalOverflow:r,forceRender:o=!1})=>(0,x.tZ)(a.Fragment,null,e.map(t));var yS=n(763279);const xS=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),CS=(e,t)=>{var n;const r=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&(null===r||void 0===r)},wS=Fr("filter-bar");var SS=n(428368),ZS=n.n(SS);const kS=Lt()(((e,t)=>{e(t?(0,Mr.qN)(t):(0,Mr.DU)())}),me.oP),MS=Lt()(((e,t)=>{e(t?(0,Mr.$7)(t):(0,Mr.Up)())}),me.oP);const DS=()=>(0,o.v9)((e=>{var t;return{outlinedFilterId:null==(t=fp(e.dashboardState.directPathToChild||[]))?void 0:t.native_filter,lastUpdated:e.dashboardState.directPathLastUpdated}})),ES=y.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,RS=[{data:[{}]}],TS=[bo.cg.NATIVE_FILTER],_S=({dataMaskSelected:e,filter:t,onFilterSelectionChange:n,inView:r=!0,showOverflow:s,parentRef:l,setFilterActive:c,orientation:h=i.Bp.VERTICAL,overflow:f=!1,filterHistoryMode:g})=>{var m,v,b;const{id:y,targets:C,filterType:w,adhoc_filters:S,time_range:Z}=t,k=(0,vo.Z)().get(w),M=function(e,t){const n=(0,o.v9)((t=>{var n,r;return[...null==(n=t.nativeFilters.filters[e])?void 0:n.cascadeParentIds,null==(r=t.nativeFilters.filters[e])?void 0:r.cascadeTimeGrainFilterId].filter(Boolean)}));return(0,a.useMemo)((()=>{let e={};return(0,zo.Z)(n).forEach((n=>{const r=null==t?void 0:t[n];e=(0,_o.on)(e,null==r?void 0:r.extraFormData)})),e}),[t,n])}(y,e),D=(()=>{const e=(0,o.v9)((e=>e.dashboardState.isRefreshing)),t=(0,o.v9)((e=>e.dashboardState.isFiltersRefreshing));return!e&&t})(),[E,R]=(0,a.useState)([]),[T,_]=(0,a.useState)(""),[I,O]=(0,a.useState)({inView:!1}),[P,z]=(0,a.useState)({}),[F,N]=(0,a.useState)(r),$=(0,a.useRef)(null),[L]=C,{datasetId:B,column:A={}}=L,{name:j}=A,H=!!B,[q,U]=(0,a.useState)(H),[V,W]=(0,a.useState)(!1),G=(0,o.I0)(),{outlinedFilterId:K,lastUpdated:Y}=DS(),X=(0,a.useCallback)((()=>{W(!1),U(!1),D&&G((0,ss.YC)())}),[G,D]);(0,a.useEffect)((()=>{!F&&r&&N(!0)}),[r,F,N]),(0,a.useEffect)((()=>{var e;if(!F)return;const n=(0,_o.zi)({...t,datasetId:B,dependencies:M,groupby:j,adhoc_filters:S,time_range:Z}),r=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!V&&(!ZS()(I,n,((e,t,n)=>"url_params"===n||void 0))||!Tr()(P,r)||D)){if(O(n),z(r),!H)return;W(!0),(0,ln.getChartDataRequest)({formData:n,force:!1,requestParams:{dashboardId:0},ownState:r}).then((({response:e,json:t})=>{if((0,oe.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)R([n]),X();else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Eo.YJ)(n).then((e=>{R(e),X()})).catch((e=>{_(e.message||e.error||(0,d.t)("Check configuration")),X()}))}}else R(t.result),_(""),X()})).catch((e=>{_(e.statusText),X()}))}}),[F,M,B,j,X,JSON.stringify(t),H,V,D]),(0,a.useEffect)((()=>{K&&K===t.id&&setTimeout((()=>{var e;null==$||null==(e=$.current)||e.focus()}),f?me.oP:0)}),[$,K,Y,t.id,f]);const Q=(0,a.useCallback)((e=>n(t,e)),[t,n]),J=(0,a.useCallback)((()=>{K!==y&&MS(G,y)}),[G,y,K]),ee=(0,a.useCallback)((()=>{MS(G),K===y&&G((0,ss.E2)([]))}),[G,y,K]),te=(0,a.useCallback)((()=>kS(G,y)),[G,y]),ne=(0,a.useCallback)((()=>kS(G)),[G]),re=(0,a.useMemo)((()=>({setDataMask:Q,setHoveredFilter:te,unsetHoveredFilter:ne,setFocusedFilter:J,unsetFocusedFilter:ee,setFilterActive:c})),[Q,c,te,ne,J,ee]),ie=CS(t,null==(m=t.dataMask)?void 0:m.filterState),ae=(0,a.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState,validateStatus:ie&&"error"}}),[null==(v=t.dataMask)?void 0:v.filterState,ie]),se=(0,a.useMemo)((()=>({filterBarOrientation:h,isOverflowingFilterBar:f})),[h,f]),le=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode})),de=(0,o.v9)((({dashboardInfo:e})=>e.metadata.layout_type)),ue=g?220:"100%";return(0,x.tZ)(ES,{"data-test":"form-item-value",style:le!==i.kB.MOBILE&&"grid"!==de?{width:ue,marginRight:16}:{}},q?(0,x.tZ)(p.Z,{size:le===i.kB.MOBILE?"small":"default",position:"inline-centered"}):(0,x.tZ)(a.Fragment,null,T?(0,x.tZ)(Zo.Z,{title:(0,d.t)("Cannot load filter"),body:T,level:"error"}):(0,x.tZ)(Go.Z,{id:y,height:32,width:"100%",showOverflow:s,formData:{...I,ftId:y,ftName:null==t?void 0:t.name},displaySettings:se,parentRef:l,inputRef:$,queriesData:H?E:RS,chartType:w,behaviors:TS,filterState:ae,ownState:null==(b=t.dataMask)?void 0:b.ownState,enableNoResults:null==k?void 0:k.enableNoResults,isRefreshing:V,hooks:re})))},IS=a.memo(_S),OS=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.text)||(null==e||null==(n=e.meta)?void 0:n.defaultText)||""},PS=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.sliceNameOverride)||(null==e||null==(n=e.meta)?void 0:n.sliceName)||(null==e?void 0:e.id)||""},zS=e=>{const t=(0,o.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,o.v9)((e=>e.charts));return(0,a.useMemo)((()=>Object.values(e)),[e])})();return(0,a.useMemo)((()=>{var r;let o;const i=t[Be._4].children[0];if(i.startsWith("TABS-")&&(o=t[i].children),0===e.scope.rootPath.length)return;if(0===e.scope.excluded.length&&(e.scope.rootPath[0]===Be._4||null!=(r=o)&&r.every((t=>e.scope.rootPath.includes(t)))))return{all:[(0,d.t)("All charts")]};if(0===e.scope.excluded.length&&o)return{tabs:e.scope.rootPath.map((e=>OS(t[e]))).filter(Boolean)};const a=Object.values(t).filter((e=>e.type===f.dW));if(e.scope.rootPath[0]===Be._4)return{charts:n.filter((t=>!e.scope.excluded.includes(t.id))).map((e=>{const t=a.find((t=>t.meta.chartId===e.id));return PS(t)})).filter(Boolean)};if(o){const r=[...e.scope.rootPath],o=a.filter((e=>e.parents.some((e=>r.includes(e)))));e.scope.excluded.forEach((e=>{const t=r.findIndex((t=>{var n;return null==(n=o.find((t=>t.meta.chartId===e)))?void 0:n.parents.includes(t)}));t>-1&&r.splice(t,1)}));const i=n.filter((t=>!e.scope.excluded.includes(t.id))).reduce(((e,t)=>{const n=o.find((e=>e.meta.chartId===t.id&&e.parents.every((e=>!r.includes(e)))));return n&&e.push(n),e}),[]);return{tabs:r.map((e=>OS(t[e]))).filter(Boolean),charts:i.map(PS).filter(Boolean)}}}),[n,e.scope.excluded,e.scope.rootPath,t])},FS=y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    align-items: center;
    margin: ${e.gridUnit}px 0;
    font-size: ${e.typography.sizes.s}px;

    &:first-of-type {
      margin-top: 0;
    }

    &:last-of-type {
      margin-bottom: 0;
    }

    & .ant-tooltip-open {
      display: inline-flex;
    }
  `};
`,NS=y.iK.span`
  ${({theme:e})=>x.iv`
    color: ${e.colors.grayscale.base};
    padding-right: ${4*e.gridUnit}px;
    margin-right: auto;
    text-transform: uppercase;
    white-space: nowrap;
  `};
`,$S=y.iK.div`
  ${({theme:e})=>x.iv`
    color: ${e.colors.grayscale.dark1};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline;
  `};
`,LS=y.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,BS=y.iK.span`
  text-decoration: underline;
  cursor: pointer;
`,AS=y.iK.span`
  ${({theme:e})=>x.iv`
    color: ${e.colors.primary.base};
  `}
`,jS=y.iK.ul`
  ${({theme:e})=>x.iv`
    padding-left: ${3*e.gridUnit}px;
    margin-bottom: 0;
  `};
`,HS=y.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`,qS=y.iK.div`
  min-width: 0;
  display: inline-flex;
  white-space: nowrap;
`,US=y.iK.div`
  display: flex;
  align-items: center;
`,VS=({title:e,children:t,...n})=>(0,x.tZ)(ce.u,fe()({title:e,placement:"bottom",overlayClassName:"filter-card-tooltip"},n),(0,x.tZ)(qS,null,t)),WS=(e,t)=>Array.isArray(e)&&e.length>0?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(HS,null,t,":"),(0,x.tZ)(jS,null,e.map((e=>(0,x.tZ)("li",null,e))))):null,GS=a.memo((({filter:e})=>{const t=zS(e),n=(0,a.useRef)(null),r=(0,a.useRef)(null),[o,i]=(0,yS.ro)(n,r),s=(0,a.useMemo)((()=>0!==o&&t?t.all?(0,x.tZ)("span",null,(0,d.t)("All charts")):(0,x.tZ)("div",null,WS(t.tabs,(0,d.t)("Tabs")),WS(t.charts,(0,d.t)("Chart"))):null),[o,t]);return(0,x.tZ)(FS,null,(0,x.tZ)(NS,null,(0,d.t)("Scope")),(0,x.tZ)(VS,{title:s},(0,x.tZ)($S,{ref:n},t?Object.values(t).flat().map(((e,t)=>(0,x.tZ)("span",{key:e},0===t?e:`, ${e}`))):(0,d.t)("None")),i>0&&(0,x.tZ)(AS,{ref:r},"+",o)))})),KS=({dependency:e,hasSeparator:t})=>{const n=(0,o.I0)(),r=(0,a.useCallback)((()=>{n((0,ss.E2)([e.id]))}),[e.id,n]);return(0,x.tZ)("span",null,t&&(0,x.tZ)("span",null,", "),(0,x.tZ)(BS,{role:"button",onClick:r,tabIndex:0},e.name))},YS=a.memo((({filter:e})=>{const t=(e=>{const t=(0,zo.Z)(e.cascadeParentIds);return(0,o.v9)((e=>0===t.length?[]:t.reduce(((t,n)=>(t.push(e.nativeFilters.filters[n]),t)),[])))})(e),n=(0,a.useRef)(null),r=(0,a.useRef)(null),[i,s]=(0,yS.ro)(n,r),l=(0,y.Fg)(),u=(0,a.useMemo)((()=>i>0&&t?(0,x.tZ)(jS,null,t.map((e=>(0,x.tZ)("li",null,(0,x.tZ)(KS,{dependency:e}))))):null),[i,t]);return Array.isArray(t)&&0!==t.length?(0,x.tZ)(FS,null,(0,x.tZ)(NS,{css:x.iv`
          display: inline-flex;
          align-items: center;
        `},(0,d.t)("Dependent on")," ",(0,x.tZ)(VS,{title:(0,d.t)("Filter only displays values relevant to selections made in other filters.")},(0,x.tZ)(ae.Z.Info,{iconSize:"m",iconColor:l.colors.grayscale.light1,css:x.iv`
              margin-left: ${l.gridUnit}px;
            `}))),(0,x.tZ)(VS,{title:u},(0,x.tZ)($S,{ref:n},t.map(((e,t)=>(0,x.tZ)(KS,{key:e.id,dependency:e,hasSeparator:0!==t})))),s&&(0,x.tZ)(AS,{ref:r},"+",i))):null})),XS=(0,y.iK)(se.Z)`
  padding: 0;
`,QS=({createNewOnOpen:e,dashboardId:t,initialFilterId:n,onClick:r,children:i,fromModule:s,filterType:l})=>{const d=(0,o.I0)(),u=(0,o.v9)((e=>e)),[c,p]=(0,a.useState)(!1),h=(0,a.useRef)([]),f=(0,a.useCallback)((()=>{p(!1)}),[p]);(0,a.useEffect)((()=>{g()}),[null==u?void 0:u.charts]);const g=()=>{Object.keys(u.charts).forEach((e=>{var t,n,r;const o=null==(t=u.charts)?void 0:t[e];if(null!=o&&null!=(n=o.form_data)&&n.viz_type&&"filter_box"!==(null==o||null==(r=o.form_data)?void 0:r.viz_type)){var i,a,s;const e=null==o||null==(i=o.form_data)||null==(a=i.datasource)||null==(s=a.split("__"))?void 0:s[0];h.current.includes(e)||(h.current.push(e),e&&ee.Z.get({endpoint:`/api/v1/dataset/${e}`}).then((e=>{const t=e.json.result;d((0,Mr.iv)(t))})))}}))},m=(0,a.useCallback)((async e=>{d(await(0,Mr.RY)(e)),f()}),[d,f]),v=(0,a.useCallback)((()=>{p(!0),r&&r()}),[p,r]);return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(XS,fe()({},wS("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:v}),i),(0,x.tZ)(Sa,{isOpen:c,onSave:m,onCancel:f,initialFilterId:n,createNewOnOpen:e,key:`filters-for-${t}`,fromModule:s,initSelectValueFilter:l}))},JS=a.memo(QS),eZ=({filter:e,hidePopover:t})=>{const n=(0,y.Fg)(),r=(0,a.useRef)(null),[i]=(0,yS.ro)(r),s=(0,o.v9)((({dashboardInfo:e})=>e.id)),l=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm));return(0,x.tZ)(FS,{css:e=>x.iv`
          margin-bottom: ${3*e.gridUnit}px;
          justify-content: space-between;
        `},(0,x.tZ)(US,null,(0,x.tZ)(ae.Z.FilterSmall,{css:e=>x.iv`
              margin-right: ${e.gridUnit}px;
            `}),(0,x.tZ)(VS,{title:i?e.name:null},(0,x.tZ)(LS,{ref:r},e.name))),l&&(0,x.tZ)(QS,{dashboardId:s,onClick:t,initialFilterId:e.id},(0,x.tZ)(ae.Z.Edit,{iconSize:"l",iconColor:n.colors.grayscale.light1})))},tZ=({filter:e})=>{const t=(0,a.useMemo)((()=>(0,vo.Z)().get(e.filterType)),[e.filterType]);return(0,x.tZ)(FS,null,(0,x.tZ)(NS,null,(0,d.t)("Filter type")),(0,x.tZ)($S,null,null==t?void 0:t.name))},nZ=({filter:e,hidePopover:t})=>(0,x.tZ)("div",null,(0,x.tZ)(eZ,{filter:e,hidePopover:t}),(0,x.tZ)(tZ,{filter:e}),(0,x.tZ)(GS,{filter:e}),(0,x.tZ)(YS,{filter:e})),rZ=({children:e,filter:t,getPopupContainer:n,isVisible:r=!0,placement:o})=>{const[i,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{r||s(!1)}),[r]),(0,x.tZ)(rc.ZP,{placement:o,overlayClassName:"filter-card-popover",mouseEnterDelay:.2,mouseLeaveDelay:.2,onVisibleChange:e=>{s(r&&e)},visible:r&&i,content:(0,x.tZ)(nZ,{filter:t,hidePopover:()=>{s(!1)}}),getPopupContainer:null!=n?n:()=>document.body},e)};var oZ;!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(oZ||(oZ={}));const iZ=(e,t)=>{const n=Ip(),r=Object.values(n),o=(0,a.useMemo)((()=>!!r.find((({name:t})=>t===e))),[r,e]);return t!==e&&o},aZ=y.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,sZ=y.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,lZ=({onCancel:e,editMode:t,onEdit:n,onCreate:r,disabled:o,filterSetName:i})=>{const s=iZ(i),l=!i||s||o;return(0,x.tZ)(a.Fragment,null,t?(0,x.tZ)(sZ,null,(0,x.tZ)(se.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:e,"data-test":"filter-set-cancel-button"},(0,d.t)("Cancel")),(0,x.tZ)(ce.u,{placement:"right",title:!i&&(0,d.t)("Please filter set name")||s&&(0,d.t)("Filter set with this name already exists")||o&&hc},(0,x.tZ)(aZ,{disabled:l},(0,x.tZ)(se.Z,fe()({disabled:l,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:r},wS("create-filter-set-button")),(0,d.t)("Create"))))):(0,x.tZ)(ce.u,{placement:"bottom",title:o&&hc},(0,x.tZ)(aZ,{disabled:o},(0,x.tZ)(se.Z,fe()({disabled:o,buttonStyle:"tertiary",buttonSize:"small",onClick:n},wS("new-filter-set-button")),(0,d.t)("Create new filter set")))))},dZ=y.iK.div`
  display: flex;
  align-items: center;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,uZ=(0,y.iK)(de.Ol)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${({theme:e})=>e.gridUnit}px;
      }
  }
`,cZ=y.iK.div`
  padding-top: ${({theme:e})=>e.gridUnit}px;
  padding-bottom: ${({theme:e})=>e.gridUnit}px;
`,pZ=({dataMask:e,filterSet:t})=>{const n=(0,y.Fg)(),r=Op(),o=Object.values(r).filter(Nr.kI);let i=null!=o?o:[];null!=t&&t.nativeFilters&&(i=Object.values(null==t?void 0:t.nativeFilters).filter(Nr.kI));return(0,x.tZ)(uZ,{ghost:!0,expandIconPosition:"right",defaultActiveKey:t?void 0:["filters"],expandIcon:({isActive:e})=>{const t=n.colors.grayscale.base,r=e?ae.Z.CaretUpOutlined:ae.Z.CaretDownOutlined;return(0,x.tZ)(r,{iconColor:t})}},(0,x.tZ)(de.Ol.Panel,fe()({},wS("collapse-filter-set-description"),{header:(0,x.tZ)(dZ,null,(0,x.tZ)(de.ZT.Text,{type:"secondary"},(0,d.t)("Filters (%d)",i.length))),key:"filters"}),i.map((({id:n,name:o})=>{var i,a,s,l,u;const c=t&&!(0,ru.JB)(null==(i=r[n])?void 0:i.controlValues,null==t||null==(a=t.nativeFilters)||null==(s=a[n])?void 0:s.controlValues,{ignoreUndefined:!0}),p=!Object.keys(r).includes(n);return(0,x.tZ)(de._e,{title:p&&(0,d.t)("This filter doesn't exist in dashboard. It will not be applied.")||c&&(0,d.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:n},(0,x.tZ)(cZ,{"data-test":"filter-info"},(0,x.tZ)(de.ZT.Text,{strong:!0,delete:p,mark:c},o,":\xa0"),(0,x.tZ)(de.ZT.Text,{delete:p,mark:c},fc(null==e||null==(l=e[n])||null==(u=l.filterState)?void 0:u.value)||(0,x.tZ)(de.ZT.Text,{type:"secondary"},(0,d.t)("None")))))}))))},hZ=(0,y.iK)(se.Z)`
  padding: 0;
`,fZ=y.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,gZ=y.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${({theme:e})=>`margin-left: ${2*e.gridUnit}px`};
  }
`,mZ=({editMode:e,setFilterSetName:t,onDelete:n,onEdit:r,filterSetName:o,dataMaskSelected:i,filterSet:s,isApplied:l,onRebuild:u})=>{var c,p;const h=(0,y.Fg)(),f=(0,x.tZ)(ge.v2,null,(0,x.tZ)(ge.v2.Item,{onClick:r},(0,d.t)("Edit")),(0,x.tZ)(ge.v2.Item,{onClick:u},(0,x.tZ)(ce.u,{placement:"right",title:(0,d.t)("Remove invalid filters")},(0,d.t)("Rebuild"))),(0,x.tZ)(ge.v2.Item,{onClick:n,danger:!0},(0,d.t)("Delete")));return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(fZ,null,(0,x.tZ)(de.ZT.Text,{strong:!0,editable:{editing:e,icon:(0,x.tZ)("span",null),onChange:t}},null!=(c=null==s?void 0:s.name)?c:o),(0,x.tZ)(gZ,null,l&&(0,x.tZ)(ae.Z.CheckOutlined,{iconSize:"m",iconColor:h.colors.success.base}),n&&(0,x.tZ)(de.Gj,{overlay:f,placement:"bottomRight",trigger:["click"]},(0,x.tZ)(hZ,fe()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},wS("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,x.tZ)(ae.Z.EllipsisOutlined,{iconSize:"m"}))))),(0,x.tZ)(pZ,{filterSet:s,dataMask:null!=(p=null==s?void 0:s.dataMask)?p:i}))},vZ=y.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${({theme:e})=>27*e.gridUnit}px;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,bZ=y.iK.div`
  ${({theme:e,"data-selected":t,onClick:n})=>`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${e.gridUnit}px;\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    padding: ${2*e.gridUnit}px ${4*e.gridUnit}px;\n    cursor: ${n?"pointer":"auto"};\n    background: ${t?e.colors.primary.light5:"transparent"};\n  `}
`,yZ=(0,d.t)("New filter set"),xZ=({dataMaskSelected:e,onEditFilterSet:t,disabled:n,onFilterSelectionChange:r,tab:i})=>{const s=(0,o.I0)(),[l,d]=(0,a.useState)(yZ),[u,c]=(0,a.useState)(!1),p=Pp(),h=Ip(),f=Object.values(h),g=Op(),m=Object.values(g),[v,b]=(0,a.useState)(null);(0,a.useEffect)((()=>{var t;if(i===oZ.AllFilters)return;if(!f.length)return void b(null);const n=gc({dataMaskSelected:e,filterSetFilterValues:f});b(null!=(t=null==n?void 0:n.id)?t:null)}),[i,e,f]);const y=(e,t)=>{var n,r,o;return!m.find((t=>(null==t?void 0:t.id)===e))||!(0,ru.JB)(null==(n=g[e])?void 0:n.controlValues,null==t||null==(r=t.nativeFilters)||null==(o=r[e])?void 0:o.controlValues,{ignoreUndefined:!0})},C=(e,t)=>{var n;const o=null==t?void 0:t.target;if(o){var i;const e=o.closest(`[data-anchor=${wS("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(i=e.querySelector(".ant-collapse-header"))&&i.contains(o)||null!=o&&o.closest(".ant-dropdown"))return}if(b(e),!e)return;const a=h[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:o}=e;y(o,a)||r({id:o},{extraFormData:t,filterState:n})}))};return(0,x.tZ)(vZ,null,!v&&(0,x.tZ)(bZ,null,(0,x.tZ)(mZ,{dataMaskSelected:e,editMode:u,setFilterSetName:d,filterSetName:l}),(0,x.tZ)(lZ,{filterSetName:l.trim(),disabled:n,onCancel:()=>{c(!1),d(yZ)},editMode:u,onEdit:()=>c(!0),onCreate:()=>{const e={name:l.trim(),nativeFilters:g,dataMask:Object.keys(g).reduce(((e,t)=>({...e,[t]:p[t]})),{})};s((0,Mr.xQ)(e)),c(!1),d(yZ)}})),f.map((r=>(0,x.tZ)(bZ,fe()({},wS("filter-set-wrapper"),{"data-anchor":wS("filter-set-wrapper",!0),"data-selected":r.id===v,onClick:e=>C(r.id,e),key:r.id}),(0,x.tZ)(mZ,{isApplied:r.id===v&&!n,onDelete:()=>{return e=r.id,s((0,Mr.$l)(e)),void(e===v&&b(null));var e},onEdit:()=>{return e=r.id,C(e),void t(e);var e},onRebuild:()=>(e=>{var t;const n=h[e],r=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!y(t,n)})).reduce(((e,t)=>({...e,[t.id]:g[t.id]})),{}),o={...n,nativeFilters:r,dataMask:Object.keys(r).reduce(((e,t)=>{var r;return{...e,[t]:null==(r=n.dataMask)?void 0:r[t]}}),{})};s((0,Mr.ql)(o))})(r.id),dataMaskSelected:e,filterSet:r})))))},CZ=y.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${({theme:e})=>e.gridUnit}px;
  background: ${({theme:e})=>e.colors.primary.light4};
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,wZ=(0,y.iK)(de.ZT.Text)`
  color: ${({theme:e})=>e.colors.primary.dark2};
`,SZ=(0,y.iK)(de.ZT.Text)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  & .anticon {
    padding: ${({theme:e})=>e.gridUnit}px;
  }
`,ZZ=y.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,kZ=({filterSetId:e,onCancel:t,dataMaskSelected:n,disabled:r})=>{const i=Pp(),s=(0,o.I0)(),l=Ip(),u=Op(),c=Object.values(l),[p,h]=(0,a.useState)(l[e].name),f=iZ(p,l[e].name),g=(0,a.useMemo)((()=>gc({dataMaskSelected:n,filterSetFilterValues:c})),[n,c]),m=g&&g.id!==e,v=r||m||f;return(0,x.tZ)(CZ,null,(0,x.tZ)(wZ,{strong:!0},(0,d.t)("Editing filter set:")),(0,x.tZ)(wZ,{editable:{editing:!0,icon:(0,x.tZ)("span",null),onChange:h}},p),(0,x.tZ)(sZ,null,(0,x.tZ)(se.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:t,"data-test":"filter-set-edit-cancel"},(0,d.t)("Cancel")),(0,x.tZ)(de._e,{placement:"right",title:f&&(0,d.t)("Filter set with this name already exists")||m&&(0,d.t)("Filter set already exists")||r&&hc},(0,x.tZ)(ZZ,{disabled:v},(0,x.tZ)(se.Z,fe()({disabled:v,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{s((0,Mr.ql)({id:e,name:p,nativeFilters:u,dataMask:{...i}})),t()}},wS("filter-set-edit-save")),(0,d.t)("Save"))))),m&&(0,x.tZ)(SZ,{mark:!0},(0,x.tZ)(ae.Z.WarningOutlined,{iconSize:"m"}),(0,d.t)('This filter set is identical to: "%s"',null==g?void 0:g.name)))};var MZ=n(121804),DZ=n.n(MZ);const EZ=y.iK.div`
  .ant-btn-group {
    button.ant-btn {
      background-color: ${({theme:e})=>e.colors.primary.dark1};
      border-color: transparent;
      color: ${({theme:e})=>e.colors.grayscale.light5};
      font-size: 12px;
      line-height: 13px;
      outline: none;
      text-transform: uppercase;
      &:first-of-type {
        border-radius: ${({theme:e})=>`${e.gridUnit}px 0 0 ${e.gridUnit}px`};
        margin: 0;
        width: 120px;
      }

      &:disabled {
        background-color: ${({theme:e})=>e.colors.grayscale.light2};
        color: ${({theme:e})=>e.colors.grayscale.base};
      }
      &:nth-child(2) {
        margin: 0;
        border-radius: ${({theme:e})=>`0 ${e.gridUnit}px ${e.gridUnit}px 0`};
        width: ${({theme:e})=>9*e.gridUnit}px;
        &:before,
        &:hover:before {
          border-left: 1px solid ${({theme:e})=>e.colors.grayscale.light5};
          content: '';
          display: block;
          height: ${({theme:e})=>8*e.gridUnit}px;
          margin: 0;
          position: absolute;
          width: ${({theme:e})=>.25*e.gridUnit}px;
        }

        &:disabled:before {
          border-left: 1px solid ${({theme:e})=>e.colors.grayscale.base};
        }
      }
    }
  }
`,{SubMenu:RZ}=ge.v2,TZ=(0,y.iK)((({overlay:e,tooltip:t,placement:n,...r})=>{const o=(t={})=>(0,x.tZ)(EZ,null,(0,x.tZ)(de.Gj.Button,fe()({overlay:e},r,t)));return t?o({buttonsRender:([e,r])=>[(0,x.tZ)(de._e,{placement:n,id:`${DZ()(t)}-tooltip`,title:t},e),r]}):o()}))`
  button.ant-btn:first-of-type {
    display: none;
  }
  > button.ant-btn:nth-child(2) {
    display: inline-flex;
    background-color: transparent !important;
    height: unset;
    padding: 0;
    border: none;
    width: auto !important;

    .anticon {
      line-height: 0;
    }
    &:after {
      box-shadow: none !important;
    }
  }
`,_Z=(0,y.iK)(ge.v2)`
  ${({theme:e})=>`\n    .info {\n      font-size: ${e.typography.sizes.s}px;\n      color: ${e.colors.grayscale.base};\n      padding: ${e.gridUnit}px ${3*e.gridUnit}px ${e.gridUnit}px ${3*e.gridUnit}px;\n    }\n    .ant-dropdown-menu-item-selected {\n      color: ${e.colors.grayscale.dark1};\n      background-color: ${e.colors.primary.light5};\n    }\n  `}
`,IZ=(0,y.iK)(ge.v2.Item)`
  display: flex;
  justify-content: space-between;
  > span {
    width: 100%;
  }
  border-bottom: ${({divider:e,theme:t})=>e?`1px solid ${t.colors.grayscale.light3};`:"none;"};
`,OZ=y.iK.div`
  display: flex;
  justify-content: space-between;
  > span {
    width: 100%;
  }
`,PZ=e=>{const t=(0,y.Fg)(),{icon:n,info:r,menuItems:o,selectedKeys:i,onSelect:s}=e,l=(e,n,r)=>(0,x.tZ)(IZ,{key:n,divider:r},(0,x.tZ)(OZ,null,(0,x.tZ)("span",null,e),(null==i?void 0:i.includes(n))&&(0,x.tZ)(ae.Z.Check,{iconColor:t.colors.primary.base,className:"tick-menu-item",iconSize:"xl"}))),d=(0,a.useMemo)((()=>(0,x.tZ)(_Z,{selectedKeys:i,onSelect:s,selectable:!0},r&&(0,x.tZ)("div",{className:"info","data-test":"dropdown-selectable-info"},r),o.map((e=>{var t;return null!=(t=e.children)&&t.length?(0,x.tZ)(RZ,{title:e.label,key:e.key,"data-test":"dropdown-selectable-icon-submenu"},e.children.map((e=>l(e.label,e.key)))):l(e.label,e.key,e.divider)})))),[r,o]);return(0,x.tZ)(TZ,{overlay:d,trigger:["click"],icon:n})},zZ=y.iK.span`
  display: flex;
  align-items: center;
  justify-content: space-between;

  .enable-cross-filters-text {
    padding-left: ${({theme:e})=>2*e.gridUnit+"px"};
  }
`,FZ=(0,y.iK)(Le.ZP)`
  ${({theme:e})=>`\n  &,\n  svg {\n    display: inline-block;\n    width: ${4*e.gridUnit}px;\n    height: ${4*e.gridUnit}px;\n  }\n`}
`,NZ=()=>{const e=(0,o.I0)(),t=(0,y.Fg)(),n=(0,o.v9)((({dashboardInfo:e})=>e.crossFiltersEnabled)),r=(0,o.v9)((({dashboardInfo:e})=>e.filterBarOrientation)),[s,l]=(0,a.useState)(r),c=(0,u.c)(u.T.DASHBOARD_CROSS_FILTERS),p=!!n&&c,[h,f]=(0,a.useState)(p),g=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),m=g&&(0,u.c)(u.T.HORIZONTAL_FILTER_BAR),v="cross-filters-menu-key",b=(0,a.useCallback)((async t=>{t||e((0,w.clearDataMaskState)()),await e((0,Ud.C6)(t))}),[e,h]),C=(0,a.useCallback)((async t=>{const n=t.key;if(n===v)return f(!h),void b(!h);if(((o=n)===i.Bp.VERTICAL||o===i.Bp.HORIZONTAL)&&n!==r){l(n);try{await e((0,Ud.Mn)(t.key))}catch{l(r)}}var o}),[e,h,r]),S=(0,a.useMemo)((()=>(0,x.tZ)(zZ,null,(0,x.tZ)(FZ,{className:"enable-cross-filters",checked:h,onChange:e=>f(e||!1)})," ",(0,x.tZ)("span",{className:"enable-cross-filters-text"},(0,d.t)("Enable cross-filtering")))),[h]),Z=[];return c&&g&&Z.unshift({key:v,label:S,divider:m}),m&&Z.push({key:"placement",label:(0,d.t)("Orientation of filter bar"),children:[{key:i.Bp.VERTICAL,label:(0,d.t)("Vertical (Left)")},{key:i.Bp.HORIZONTAL,label:(0,d.t)("Horizontal (Top)")}]}),Z.length?(0,x.tZ)(PZ,{onSelect:C,icon:(0,x.tZ)(ae.Z.Gear,{name:"gear",iconColor:t.colors.grayscale.base,"data-test":"filterbar-orientation-icon"}),menuItems:Z,selectedKeys:[s]}):null},$Z=y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    align-items: center;
    flex-direction: row;
    justify-content: space-between;
    margin: 0;
    padding: 0 ${2*e.gridUnit}px ${2*e.gridUnit}px;

    & > span {
      font-size: ${e.typography.sizes.l}px;
      flex-grow: 1;
      font-weight: ${e.typography.weights.bold};
    }

    & > div:first-of-type {
      line-height: 0;
    }

    & > button > span.anticon {
      line-height: 0;
    }
  `}
`,LZ=(0,y.iK)(se.Z)`
  padding: 0;
`,BZ=y.iK.div`
  ${({theme:e})=>`\n    padding: ${3*e.gridUnit}px ${2*e.gridUnit}px ${e.gridUnit}px;\n\n    .ant-dropdown-trigger span {\n      padding-right: ${2*e.gridUnit}px;\n    }\n  `}
`,AZ=y.iK.div`
  ${({theme:e})=>x.iv`
    margin-top: ${2*e.gridUnit}px;

    & button > [role='img']:first-of-type {
      margin-right: ${e.gridUnit}px;
      line-height: 0;
    }

    span[role='img'] {
      padding-bottom: 1px;
    }

    .ant-btn > .anticon + span {
      margin-left: 0;
    }
  `}
`,jZ=({toggleFiltersBar:e})=>{const t=(0,y.Fg)(),n=Op(),r=(0,a.useMemo)((()=>Object.values(n)),[n]),i=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),s=(0,o.v9)((({dashboardInfo:e})=>e.id));return(0,x.tZ)(BZ,null,(0,x.tZ)($Z,null,(0,x.tZ)("span",null,(0,d.t)("Filters")),(0,x.tZ)(NZ,null),(0,x.tZ)(LZ,fe()({},wS("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>e(!1)}),(0,x.tZ)(ae.Z.Expand,{iconColor:t.colors.grayscale.base}))),i&&(0,x.tZ)(AZ,null,(0,x.tZ)(JS,{dashboardId:s,createNewOnOpen:0===r.length},(0,x.tZ)(ae.Z.PlusSmall,null)," ",(0,d.t)("Add/Edit Filters"))))},HZ=a.memo(jZ);const qZ=y.iK.div`
  width: ${({theme:e})=>8*e.gridUnit}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${({width:e})=>e&&`${e}px`||"100%"}; // arbitrary...
  }
`,UZ=y.iK.div`
  width: 100%;
  height: ${({height:e})=>e&&`${e}px`||"100%"};
`,VZ=y.iK.div`
  ${({theme:e,width:t,isFixed:n})=>`\n    & .ant-typography-edit-content {\n      left: 0;\n      margin-top: 0;\n      width: 100%;\n    }\n    position: ${n?"absolute":"relative"};\n    top: 0;\n    left: 0;\n    flex-direction: column;\n    flex-grow: 1;\n    width: ${t&&`${t}px`||"100%"};\n    background: ${e.colors.grayscale.light5};\n    border-right: 1px solid ${e.colors.grayscale.light2};\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    min-height: 100%;\n    display: none;\n    &.open {\n      display: flex;\n    }\n  `}
`,WZ=y.iK.div`
  ${({theme:e,offset:t})=>`\n    position: absolute;\n    top: ${t}px;\n    left: 0;\n    height: 100%;\n    width: ${8*e.gridUnit}px;\n    padding-top: ${2*e.gridUnit}px;\n    display: none;\n    text-align: center;\n    &.open {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: ${2*e.gridUnit}px;\n    }\n    svg {\n      cursor: pointer;\n    }\n  `}
`,GZ=(0,y.iK)(ae.Z.Collapse)`
  ${({theme:e})=>`\n    color: ${e.colors.primary.base};\n    margin-bottom: ${3*e.gridUnit}px;\n  `}
`,KZ=((0,y.iK)(ae.Z.Filter)`
  color: ${({theme:e})=>e.colors.grayscale.base};
`,(0,y.iK)(de.D6)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }

  & > .ant-tabs-nav .ant-tabs-nav-operations {
    display: none;
  }
`),YZ=y.iK.div`
  margin-top: ${({theme:e})=>8*e.gridUnit}px;
`,XZ=y.iK.div`
  padding: ${({theme:e})=>4*e.gridUnit}px;
  // 108px padding to make room for buttons with position: absolute
  // padding-bottom: ${({theme:e})=>27*e.gridUnit}px;
`,QZ=(0,a.createContext)(!1);var JZ={name:"3bexy7",styles:"padding:0px 15px"};const ek=({actions:e,showHeader:t,canEdit:n,dataMaskSelected:r,filtersOpen:i,filterValues:s,height:l,isDisabled:c,isInitialized:h,offset:f,isActionFixed:g,onSelectionChange:m,toggleFiltersBar:v,width:y})=>{const[C,w]=(0,a.useState)(null),S=Ip(),Z=(0,o.v9)((e=>e.charts)),k=Object.values(Z).filter((e=>{var t,n;return"pivot_table_v2"===(null==e||null==(t=e.form_data)?void 0:t.viz_type)&&(null==e||null==(n=e.form_data)?void 0:n.enableCrossVariable)})),M=Object.values(S),[D,E]=(0,a.useState)(oZ.AllFilters),R=s.filter(Nr.kI),[T,_]=(0,a.useState)(!1),I=(0,a.useRef)(),O=(0,a.useCallback)((()=>v(!0)),[v]),P=(0,a.useMemo)((()=>yn()((()=>{clearTimeout(I.current),_(!0),I.current=setTimeout((()=>{_(!1)}),300)}),200)),[]);(0,a.useEffect)((()=>(document.onscroll=P,()=>{document.onscroll=null})),[P]);const z=(0,a.useMemo)((()=>({overflow:"auto",height:l,overscrollBehavior:"contain"})),[l]),F=R.length;let N=null;return k.length>0&&(N=(0,x.tZ)(UZ,{height:300})),(0,x.tZ)(QZ.Provider,{value:T},(0,x.tZ)(qZ,fe()({},wS(),{className:b()({open:i})}),(0,x.tZ)(WZ,fe()({},wS("collapsable"),{className:b()({open:!i}),onClick:O,offset:f}),(0,x.tZ)(GZ,fe()({},wS("expand-button"),{iconSize:"l"}))),(0,x.tZ)(VZ,{className:b()({open:i}),width:0,isFixed:g},t&&(0,x.tZ)(HZ,{toggleFiltersBar:v}),h?(0,oe.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,x.tZ)(KZ,{centered:!0,onChange:E,defaultActiveKey:oZ.AllFilters,activeKey:C?oZ.AllFilters:void 0},(0,x.tZ)(de.D6.TabPane,{tab:(0,d.t)("All filters (%(filterCount)d)",{filterCount:F}),key:oZ.AllFilters,css:z},C&&(0,x.tZ)(kZ,{dataMaskSelected:r,disabled:!c,onCancel:()=>w(null),filterSetId:C}),0===s.length?(0,x.tZ)(YZ,null,(0,x.tZ)(Mh.Tc,{title:(0,d.t)("No filters are currently added"),image:"filter.svg",description:n&&(0,d.t)("Click the button above to add a filter to the dashboard")})):(0,x.tZ)(XZ,null,(0,x.tZ)(Ek,{dataMaskSelected:r,onFilterSelectionChange:m}))),(0,x.tZ)(de.D6.TabPane,{disabled:!!C,tab:(0,d.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:M.length}),key:oZ.FilterSets,css:z},(0,x.tZ)(xZ,{onEditFilterSet:w,disabled:!c,dataMaskSelected:r,tab:D,onFilterSelectionChange:m}))):(0,x.tZ)("div",{css:z,onScroll:P},0===s.length?(0,x.tZ)(YZ,null,(0,x.tZ)(Mh.Tc,{title:(0,d.t)("No filters are currently added"),image:"filter.svg",description:n&&(0,d.t)("Click the button above to add a filter to the dashboard")}),(0,x.tZ)("div",{css:JZ},N)):(0,x.tZ)(XZ,null,(0,x.tZ)(Ek,{dataMaskSelected:r,onFilterSelectionChange:m}),N)):(0,x.tZ)("div",{css:(0,x.iv)({height:l},"","")},(0,x.tZ)(p.Z,null)),e)))},tk=a.memo(ek);var nk;!function(e){e.Right="right",e.Bottom="bottom",e.Left="left"}(nk||(nk={}));const rk=y.iK.div`
  position: absolute;
  right: 0;
`,ok=y.iK.h4`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  overflow-wrap: break-word;
`,ik=(0,y.iK)(ok)`
  font-weight: ${({theme:e})=>e.typography.weights.normal};
  color: ${({theme:e})=>e.colors.grayscale.base};
  max-width: ${({theme:e})=>15*e.gridUnit}px;
  ${yS.B3};
`,ak=(0,y.iK)(ik)`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  max-width: ${({theme:e})=>25*e.gridUnit}px;
  ${yS.B3};
`,sk=(0,y.iK)(ik)`
  max-width: none;
`,lk=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,dk=(0,y.iK)(lk)`
  margin-bottom: unset;
`,uk=(0,y.iK)(lk)`
  width: 100%;
`,ck=(0,y.iK)(Re.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${({theme:e})=>11*e.gridUnit}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,pk=(0,y.iK)(Re.l0)`
  && .ant-form-item-label > label {
    margin-bottom: 0;
    text-transform: none;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,hk=(0,y.iK)(ck)`
  && .ant-form-item-label {
    line-height: 1;
    & > label {
      padding-right: unset;
    }
  }
`,fk=(0,y.iK)(Re.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,gk=(0,y.iK)(Re.xJ)`
  && {
    margin-bottom: 0;
    align-items: center;
  }

  .ant-form-item-label {
    padding-bottom: 0;
    margin-right: ${({theme:e})=>2*e.gridUnit}px;
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }

    & > label::after {
      display: none;
    }
  }

  .ant-form-item-control {
    width: ${({theme:e})=>41*e.gridUnit}px;
  }
`,mk=fk,vk=y.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  display: flex;
`,bk=()=>(0,x.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),yk=({description:e})=>(0,x.tZ)(vk,null,(0,x.tZ)(ce.u,{title:e,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,x.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})}))),xk=({dataMaskSelected:e,filter:t,icon:n,onFilterSelectionChange:r,inView:o,showOverflow:s,parentRef:l,orientation:d=i.Bp.VERTICAL,overflow:u=!1,filterMode:c,filterIdShouldShow:p,filterHistoryMode:h,layoutFilterType:f})=>{var g,m,v;const b=(0,a.useMemo)((()=>hS()),[]),[y,C]=(0,a.useState)(!1),{name:w="<undefined>"}=t,S=CS(t,null==(g=t.dataMask)?void 0:g.filterState),Z=!(null==(m=t.controlValues)||!m.enableEmptyFilter),{FilterControlContainer:k,FormItem:M,FilterControlTitleBox:D,FilterControlTitle:E}=((e,t,n)=>(0,a.useMemo)((()=>e===i.Bp.HORIZONTAL?n?{FilterControlContainer:pk,FormItem:gk,FilterControlTitleBox:dk,FilterControlTitle:ak}:t?{FilterControlContainer:hk,FormItem:mk,FilterControlTitleBox:uk,FilterControlTitle:sk}:{FilterControlContainer:pk,FormItem:gk,FilterControlTitleBox:dk,FilterControlTitle:ik}:{FilterControlContainer:ck,FormItem:fk,FilterControlTitleBox:lk,FilterControlTitle:ok}),[e,t]))(d,u,f),R=(0,a.useMemo)((()=>{var e;return(0,x.tZ)(D,null,(0,x.tZ)(E,{"data-test":"filter-control-name"},w),Z&&(0,x.tZ)(bk,null),(null==(e=t.description)?void 0:e.trim())&&(0,x.tZ)(yk,{description:t.description}),(0,x.tZ)(rk,{"data-test":"filter-icon"},n))}),[D,E,w,Z,t.description,n]),T=(0,a.useContext)(QZ),_=(0,a.useMemo)((()=>d===i.Bp.HORIZONTAL?u?nk.Left:nk.Bottom:nk.Right),[d,u]),I=(0,x.tZ)(M,{label:R,required:null==t||null==(v=t.controlValues)?void 0:v.enableEmptyFilter,validateStatus:S?"error":void 0},(0,x.tZ)(pS,{node:b})),O=c&&(null==t?void 0:t.id)!==p?null:I;return(0,x.tZ)(a.Fragment,null,(0,x.tZ)(cS,{node:b},(0,x.tZ)(IS,{dataMaskSelected:e,filter:t,showOverflow:s,onFilterSelectionChange:r,inView:o,parentRef:l,setFilterActive:C,orientation:d,overflow:u,filterHistoryMode:h})),(0,x.tZ)(k,{layout:d!==i.Bp.HORIZONTAL||u?"vertical":"horizontal"},c?O:(0,x.tZ)(rZ,{filter:t,isVisible:!y&&!T,placement:_},I)))},Ck=a.memo(xk),wk=({title:e,description:t})=>(0,x.tZ)("div",null,(0,x.tZ)("h3",null,e),t?(0,x.tZ)("p",{"data-test":"divider-description"},t):null),Sk=({title:e,description:t})=>{const n=(0,y.Fg)(),[r,o]=(0,yS.cB)();return(0,x.tZ)("div",{css:x.iv`
        display: flex;
        align-items: center;
        height: ${6*n.gridUnit}px;
        border-left: 1px solid ${n.colors.grayscale.light2};
        padding-left: ${4*n.gridUnit}px;

        .filter-item-wrapper:first-child & {
          border-left: none;
          padding-left: 0;
        }
      `},(0,x.tZ)(ce.u,{overlay:o?e:null},(0,x.tZ)("h3",{ref:r,css:x.iv`
            ${yS.B3};
            max-width: ${32.5*n.gridUnit}px;
            font-size: ${n.typography.sizes.m}px;
            font-weight: ${n.typography.weights.normal};
            margin: 0;
            color: ${n.colors.grayscale.dark1};
          `},e)),t?(0,x.tZ)(ce.u,{overlay:t},(0,x.tZ)(ae.Z.BookOutlined,{"data-test":"divider-description-icon",iconSize:"l",iconColor:n.colors.grayscale.base,css:x.iv`
              margin: 0 ${1.5*n.gridUnit}px;
              vertical-align: unset;
              line-height: unset;
            `})):null)},Zk=({title:e,description:t})=>{const n=(0,y.Fg)(),[r,o]=(0,yS.cB)(),[i,a]=(0,yS.cB)();return(0,x.tZ)("div",{css:x.iv`
        border-top: 1px solid ${n.colors.grayscale.light2};
        padding-top: ${4*n.gridUnit}px;
        margin-bottom: ${4*n.gridUnit}px;
      `},(0,x.tZ)(ce.u,{overlay:o?(0,x.tZ)("strong",null,e):null},(0,x.tZ)("h3",{ref:r,css:x.iv`
            ${yS.B3};
            display: block;
            color: ${n.colors.grayscale.dark1};
            font-weight: ${n.typography.weights.normal};
            font-size: ${n.typography.sizes.m}px;
            margin: 0 0 ${n.gridUnit}px 0;
          `},e)),t?(0,x.tZ)(ce.u,{overlay:a?t:null},(0,x.tZ)("p",{ref:i,"data-test":"divider-description",css:x.iv`
              ${yS.B3};
              display: block;
              font-size: ${n.typography.sizes.s}px;
              color: ${n.colors.grayscale.base};
              margin: ${n.gridUnit}px 0 0 0;
            `},t)):null)},kk=({title:e,description:t,orientation:n=i.Bp.VERTICAL,overflow:r=!1})=>n===i.Bp.HORIZONTAL?r?(0,x.tZ)(Zk,{title:e,description:t}):(0,x.tZ)(Sk,{title:e,description:t}):(0,x.tZ)(wk,{title:e,description:t}),Mk=({filtersInScope:e,filtersOutOfScope:t,renderer:n,showCollapsePanel:r,forceRenderOutOfScope:o})=>(0,x.tZ)("div",{css:e=>x.iv`
        width: ${56*e.gridUnit}px;
        padding: ${e.gridUnit}px 0;
      `},e.map(n),r&&(0,x.tZ)(bS,{filtersOutOfScope:t,renderer:n,forceRender:o,horizontalOverflow:!0})),Dk=({dataMaskSelected:e,onFilterSelectionChange:t,filterMode:n,filterIdShouldShow:r,compatibleHistoryMode:s,oldDataFilterList:l,mobileStatus:c,filterHistoryMode:p,layoutFilterType:h})=>{let f=(0,o.v9)((({dashboardInfo:e})=>(0,u.c)(u.T.HORIZONTAL_FILTER_BAR)?e.filterBarOrientation:i.Bp.VERTICAL));h&&(f=h);const{outlinedFilterId:g,lastUpdated:m}=DS(),[v,b]=(0,a.useState)([]),y=(0,a.useRef)(null),{filterControlFactory:C,filtersWithValues:w}=((e,t,n,r,o,i,s)=>{const l=Op();let d=(0,a.useMemo)((()=>Object.values(l)),[l]);if(n){const t=Object.keys(e);d=d.filter((e=>t.includes(e.id)))}r&&(d=d.filter((e=>(o||[]).includes(e.id))));const u=(0,a.useMemo)((()=>d.map((t=>({...t,dataMask:e[t.id]})))),[d,e]),c=(0,a.useCallback)(((r,o,a,l)=>{const d=u[r];return(0,Nr.nY)(d)?(0,x.tZ)(kk,{title:d.title,description:d.description,orientation:o,overflow:a}):(0,x.tZ)(Ck,{dataMaskSelected:e,filter:d,onFilterSelectionChange:t,inView:!1,orientation:o,overflow:a,filterMode:n,filterIdShouldShow:i,filterHistoryMode:s,layoutFilterType:l})}),[u,e,t]);return{filterControlFactory:c,filtersWithValues:u}})(e,t,n,s,l,r,p),S=(0,a.useMemo)((()=>{const e=new Array(w.length);for(let t=0;t<w.length;t+=1)e[t]=hS();return e}),[w.length]),Z=new Set(w.map((e=>e.id))),[k,M]=function(e){const t=jr(),n=Hr();return(0,a.useMemo)((()=>{let r=[];const o=[];return t?e.forEach((e=>{n(e)?r.push(e):o.push(e)})):r=e,[r,o]}),[e,t,n])}(w),D=(0,a.useMemo)((()=>w.some((e=>e.requiredFirst))),[w]),E=jr()&&w.length>0,R=(0,a.useCallback)((({id:e},t)=>{const n=w.findIndex((t=>t.id===e)),r=null!=t?t:e;return(0,x.tZ)(a.Fragment,{key:r},"",(0,x.tZ)(pS,{node:S[n],inView:!0}))}),[w,S]),T=()=>(0,x.tZ)(a.Fragment,null,k.map(R),E&&(0,x.tZ)(bS,{filtersOutOfScope:M,forceRender:D,hasTopMargin:k.length>0,renderer:R})),_=(0,a.useMemo)((()=>k.map(((e,t)=>({id:e.id,element:(0,x.tZ)("div",{className:"filter-item-wrapper",css:x.iv`
              flex-shrink: 0;
              &:not(:first-child) {
                margin-left: 50px;
              }
            `},R(e,t))})))),[k,R]),I=(0,a.useMemo)((()=>k.filter((({id:e})=>null==v?void 0:v.includes(e)))),[k,v]),O=(0,a.useMemo)((()=>I.filter((e=>(0,Nr.S0)(e)))),[I]),P=(0,a.useMemo)((()=>{const e=new Set(M.map((({id:e})=>e))),t=new Set(I.map((({id:e})=>e)));return w.map((n=>e.has(n.id)||t.has(n.id)))}),[M,w,I]);(0,a.useEffect)((()=>{var e;g&&v.includes(g)&&(null==y||null==(e=y.current)||e.open())}),[g,m,y,v]);let z=null;return f===i.Bp.HORIZONTAL&&(z=h?T():(0,x.tZ)("div",{css:e=>x.iv`
          padding: 0 ${4*e.gridUnit}px;
          min-width: 0;
          flex: 1;
        `},(0,x.tZ)(vS,{items:_,dropdownTriggerIcon:(0,x.tZ)(ae.Z.FilterSmall,{css:x.iv`
              && {
                margin-right: -4px;
                display: flex;
              }
            `}),dropdownTriggerText:(0,d.t)("More filters"),dropdownTriggerCount:O.length,dropdownTriggerTooltip:0===O.length?(0,d.t)("No applied filters"):(0,d.t)("Applied filters: %s",O.map((e=>e.name)).join(", ")),dropdownContent:I.length||M.length&&E?()=>(0,x.tZ)(Mk,{filtersInScope:I,filtersOutOfScope:M,renderer:R,showCollapsePanel:E,forceRenderOutOfScope:D}):void 0,ref:y,onOverflowingStateChange:({overflowed:e})=>{(e.length!==v.length||v.reduce(((t,n,r)=>t||n!==e[r]),!1))&&b(e)}}))),(0,x.tZ)(a.Fragment,null,S.filter(((e,t)=>Z.has(w[t].id))).map(((e,t)=>(0,x.tZ)(cS,{node:e,key:w[t].id},C(t,f,P[t],h)))),f===i.Bp.VERTICAL&&T(),z)},Ek=a.memo(Dk),Rk=y.iK.div`
  ${({theme:e})=>x.iv`
    &.select-filter {
      width: 100%;
      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
      }
      .dashboard--editing & {
        cursor: move;
      }
    }
  `}
`,Tk=(y.iK.div`
  ${()=>x.iv`
    & {
      cursor: pointer;
      position: relative;
      z-index: 9;
      margin-top: 12px;
      margin-left: 8px;
      width: 18px;
      height: 18px;
    }
  `}
`,e=>{var t,n,r;const{component:s,parentComponent:l,index:d,depth:u,availableColumnCount:c,columnWidth:p,onResize:h,onResizeStop:g,handleComponentDrop:m,deleteComponent:v,id:y,parentId:C,onResizeStart:S,updateComponents:Z,layoutMode:k}=e,[M,D]=(0,a.useState)(!1),E=(0,o.I0)(),R=(0,a.useContext)(hD),T=(0,a.useRef)(),{dataMaskSelected:_,handleClearAll:I,handleFilterSelectionChange:O,handleClearFilterById:P}=R,z=(Pp(),(0,o.v9)((e=>{var t;return null==e||null==(t=e.nativeFilters)?void 0:t.filters}))),F=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),N=(0,o.v9)((e=>e.dashboardState.dashboardComponentTarget)),$=(0,o.v9)((e=>e.dashboardState.mobileFilterType)),L=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.default_filter_condition_number})),B=((0,o.v9)((({dashboardInfo:e})=>e.id)),(0,o.v9)((e=>e.dashboardLayout.present)),(0,o.v9)((e=>e.mobileDashboardLayout.present))),[A,j]=(0,a.useState)(!1),[H,q]=(0,a.useState)(!1),[U,V]=(0,a.useState)("preview"),{chartId:W}=s.meta,{getPropsData:G}=s.meta,K=(s.type,(null==s?void 0:s.meta)||{}),Y=null==K?void 0:K.filterId,X=(null==K?void 0:K.layoutFilterType)||i.Bp.VERTICAL,Q=null==_?void 0:_[Y],J=null==(t=Br()[Y])?void 0:t.filterType,ee=()=>k===i.kB.MOBILE,te=(0,a.useMemo)((()=>"grid"===F?!e.editMode:e.editMode),[e,F]);let ne=null;if(Q&&O){var re;const e={[Y]:Q};((null==z||null==(re=z[Y])?void 0:re.cascadeParentIds)||[]).forEach((t=>{e[t]=null==_?void 0:_[t]})),ne=(0,x.tZ)(Ek,{mobileStatus:ee(),dataMaskSelected:e,layoutFilterType:X,onFilterSelectionChange:O,filterIdShouldShow:Y,filterMode:!0})}const oe=null==K?void 0:K.width,ie=null==K?void 0:K.height,se=Zl.Z.find((e=>e.value===(s.meta.background||Be.HE))),le=gp(W);var de,ue,ce;(null==G||G(e),null!=(n=s.meta.pos)&&n.index)&&(le.zIndex=`${null==(de=s.meta.pos)?void 0:de.index}`);"float"===s.meta.layoutType&&s.meta.pos&&(le.position="absolute",le.left=`${(null==(ue=s.meta.pos)?void 0:ue.x)||0}px`,le.top=`${(null==(ce=s.meta.pos)?void 0:ce.y)||0}px`);const pe="edit"===U,he=(null==l?void 0:l.type)===f.BA?(null==l||null==(r=l.meta)?void 0:r.width)||Be.cx:oe||Be.cx,fe=e=>{j(!!e)},ge=e=>{S(e)},me=(0,a.useCallback)((()=>{var e;Z({[s.id]:{...s,meta:{...s.meta,pos:{...s.meta.pos,index:((null==(e=s.meta.pos)?void 0:e.index)||100)+1}}}})}),[Z,y,s]),ve=(0,a.useCallback)((()=>{var e;Z({[s.id]:{...s,meta:{...s.meta,pos:{...s.meta.pos,index:((null==(e=s.meta.pos)?void 0:e.index)||100)-1}}}})}),[Z,y,s]),be=(0,a.useCallback)((()=>{Z({[s.id]:{...s,meta:{...s.meta,layoutType:"float"===s.meta.layoutType?"grid":"float"}}})}),[Z,y,s]),ye=()=>{v(y,C),E((0,ss.RP)(0)),E((0,Mr.k_)(Y)),E((0,w.deleteDataMask)(Y)),E((0,Ud.qN)(Y))},xe=()=>{q(!0)},Ce=async e=>{E(await(0,Mr.RY)(e)),q(!1),null==P||P(Y)},we=e=>e.stopPropagation(),Se=e=>{D(!1),ye()},Ze=e=>{D(!1),xe()},ke=e=>{var t;const{len:n,items:r}=(e=>{const t=[];for(let n in e)n.indexOf("FILTER_SELECT")>=0&&t.push(e[n]);return{items:t.length?t.sort(((e,t)=>{var n,r;return(null==(n=e.meta)?void 0:n.order)-(null==(r=t.meta)?void 0:r.order)})):[],len:t.length}})(B),o="horizontal"===$,[i,a]=[1,o?L:n],l=(null==(t=s.meta)?void 0:t.order)||i,d=(null==s?void 0:s.parents)||[],u=d.slice(0,d.length-1);let c=r.filter((e=>{const t=(null==e?void 0:e.parents)||[];let n=!0;return u.forEach(((e,r)=>{e===t[r]&&d.length===t.length||(n=!1)})),n})).slice(0,a);const p=l-1;if(D(!1),e){if(l>=a)return void Il.Z.warning({title:"\u64cd\u4f5c\u63d0\u793a",okText:"\u77e5\u9053\u4e86",content:`\u6700\u540e\u4e00\u4e2a\u8fc7\u6ee4\u5668\u4e0d\u80fd\u5411${o?"\u53f3":"\u4e0b"}\u79fb\u52a8`});[c[p],c[p+1]]=[c[p+1],c[p]]}else{if(l<=i)return void Il.Z.warning({title:"\u64cd\u4f5c\u63d0\u793a",okText:"\u77e5\u9053\u4e86",content:`\u7b2c\u4e00\u4e2a\u8fc7\u6ee4\u5668\u4e0d\u80fd\u5411${o?"\u5de6":"\u4e0a"}\u79fb\u52a8`});[c[p],c[p-1]]=[c[p-1],c[p]]}const h={};for(let e=0;e<c.length;e++){const t=c[e];t&&(h[t.id]={...t,meta:{...t.meta,order:e+1}})}Object.keys(h).length&&Z(h)},Me=e=>{const t=(0,x.tZ)("div",{onClick:Ze,className:`${oS} ${iS} edit`},(0,x.tZ)(ae.Z.CaretEdit,{iconSize:"xl"}),(0,x.tZ)("span",null,"\u7f16\u8f91")),n=(0,x.tZ)("div",{onClick:Se,className:`${oS} ${aS} delete`},(0,x.tZ)(ae.Z.CaretDelete,{iconSize:"xl"}),(0,x.tZ)("span",null,"\u5220\u9664"));return"up"===e?"horizontal"===$?t:n:"down"===e?"horizontal"===$?n:t:void 0},De=(0,x.tZ)(a.Fragment,null,Me("up"),"horizontal"===$?(0,x.tZ)(Th.iz,null):null,(0,x.tZ)("div",{onClick:()=>ke(0),className:`\n        ${oS} \n        ${iS} \n        ${"horizontal"!==$?"arrowUp":"arrowLeft"}`},"horizontal"!==$?(0,x.tZ)(Yw.default,null):(0,x.tZ)(Xw.default,null),(0,x.tZ)("span",null,"horizontal"!==$?"\u4e0a\u79fb":"\u5de6\u79fb")),(0,x.tZ)("div",{onClick:()=>ke(1),className:`\n      ${oS} \n      ${iS}\n      ${"horizontal"!==$?"arrowDown":"arrowRight"}`},"horizontal"!==$?(0,x.tZ)(Qw.default,null):(0,x.tZ)(Jw.default,null),(0,x.tZ)("span",null,"horizontal"!==$?"\u4e0b\u79fb":"\u53f3\u79fb")),"horizontal"===$?(0,x.tZ)(Th.iz,null):null,Me("down"));return(0,x.tZ)(Wn,{component:s,parentComponent:l,orientation:(null==l?void 0:l.type)===f.Os?"column":"row",index:d,depth:u,onDrop:m,disableDragDrop:"grid"===F?e.editMode:!e.editMode,editMode:e.editMode,style:ee()?{width:"100%"}:le},(({dropIndicatorProps:t,dragSourceRef:n})=>{const r=H?(0,x.tZ)(Sa,{ref:T,isOpen:H,onSave:Ce,onCancel:()=>{q(!1)},initialFilterId:Y,key:"filters-for-edit-modal",fromModule:"filter-edit-chart",initSelectValueFilter:J}):null,o="vertical"===$?{borderRadius:8,boxShadow:"0 0 4px rgba(0,0,0,0.1)"}:{display:"flex",height:45};if(k===i.kB.MOBILE)return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{className:`${rS} filter-row`,style:o},Y?ne:"\u52a0\u8f7d\u4e2d...",Y&&(()=>{if(e.editMode){if("vertical"===$)return(0,x.tZ)("div",{className:nS},De);if("horizontal"===$){const e=(0,x.tZ)("div",{className:tS},De);return(0,x.tZ)("div",{className:eS,onClick:we},(0,x.tZ)(rc.ZP,{visible:M,onVisibleChange:D,placement:"bottom",content:e,title:"",trigger:["hover"],zIndex:999},(0,x.tZ)(Dh,{style:{fontSize:16}})))}}return(0,x.tZ)("div",{style:{marginBottom:6}})})()),r);return(0,x.tZ)(bp,{onChangeFocus:fe,editMode:e.editMode},(0,x.tZ)(Rk,{"data-test":"filter-select",className:b()("filter-select",pe&&"filter-select--editing",se.className)},(0,x.tZ)(hp,{id:s.id,adjustableWidth:(null==l?void 0:l.type)===f.Os,adjustableHeight:!0,widthStep:p,widthMultiple:he,heightStep:2,heightMultiple:ie,minWidthMultiple:Be.cx,minHeightMultiple:Be.AA,maxWidthMultiple:c+he,onResizeStart:ge,onResize:h,onResizeStop:g,editMode:!A&&e.editMode},(0,x.tZ)("div",{ref:n,className:b()("dashboard-component","dashboard-component-chart-holder",se.className),style:se,"data-test":"dashboard-component-filter-holder",onClick:e=>{"grid"===F&&e.stopPropagation(),E((0,ss.ks)(s.id))}},!te&&"grid"===F&&s.id==N&&(0,x.tZ)(Lp,{component:s,handleToggleFullSize:()=>{},onEdit:xe}),e.editMode&&(0,x.tZ)(Dp,{float:"float"===s.meta.layoutType,buttons:[{key:"box-icon-edit",type:"edit",size:"xxl"},{key:"box-icon-delete",type:"delete",size:"xxl"}],onTop:me,onBottom:ve,onDelete:ye,onFixed:be,onEdit:xe,isFocused:A,toolmode:"click"}),Y?ne:"\u52a0\u8f7d\u4e2d...",r))),t&&(0,x.tZ)("div",t))}))}),_k={[f.dW]:Ap,[f.xh]:Jp,[f.Ce]:jw,[f.qu]:qw,[f.hI]:Tk,[f.kE]:Kw,[f.GV]:Kw,[f.Mg]:Ww,[f.BA]:uh,[f.hE]:fh,[f.Nc]:yh,[f.Os]:kh,[f.gn]:Dw,[f.yR]:$w,[f.Q7]:Vp,[f.t]:Uw},Ik={id:l().string,parentId:l().string,depth:l().number,index:l().number,renderHoverMenu:l().bool,renderTabContent:l().bool,onChangeTab:l().func,component:It.cP.isRequired,parentComponent:It.cP.isRequired,createComponent:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,logEvent:l().func.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,dashboardId:l().number.isRequired,isComponentVisible:l().bool};class Ok extends a.PureComponent{render(){const{component:e}=this.props,t=e?_k[e.type]:null;return t?(0,x.tZ)(t,this.props):null}}Ok.propTypes=Ik,Ok.defaultProps={isComponentVisible:!0};const Pk=(0,o.$j)((function({dashboardLayout:e,dashboardState:t,dashboardInfo:n},r){const o=e.present,{id:a,parentId:s}=r,l=o[a],d={component:l,getComponentById:e=>o[e],parentComponent:o[s],editMode:t.editMode,filters:(0,et.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId,dashboardState:t,dashboardInfo:n,isEdit:t.editMode,layoutMode:i.kB.PC};if(l){const e=l.type;if(e===f.Os||e===f.BA){const{occupiedWidth:t,minimumWidth:n}=(0,nh.Z)({id:a,components:o});e===f.Os&&(d.occupiedColumnCount=t),e===f.BA&&(d.minColumnWidth=n)}}return d}),(function(e){return(0,r.DE)({addDangerToast:rt.Gb,createComponent:vl.LM,deleteComponent:vl.v7,updateComponents:vl.WZ,handleComponentDrop:vl._p,setDirectPathToChild:ss.E2,setFullSizeChartId:ss.zL,setActiveTabs:ss.$_,logEvent:Vd.logEvent,setShowComponentPropertyPane:ss.ks},e)}))(Ok);var zk=n(890057),Fk=n(8868),Nk=n(906954),$k=n(281788),Lk=n(237731),Bk=n(349484);const Ak=(e,t)=>x.iv`
  position: ${t?"fixed":"relative"};

  && > .filter-clear-all-button {
    color: ${e.colors.grayscale.base};
    margin-left: 0;
    &:hover {
      color: ${e.colors.primary.dark1};
    }

    &[disabled],
    &[disabled]:hover {
      color: ${e.colors.grayscale.light1};
    }
  }
`,jk=(e,t,n)=>x.iv`
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  position: ${n?"fixed":"relative"};
  z-index: 100;

  // filter bar width minus 1px for border
  width: ${t-1}px;
  bottom: 0;

  padding: ${4*e.gridUnit}px;
  padding-top: ${6*e.gridUnit}px;

  background: linear-gradient(
    ${(0,Bk.rgba)(e.colors.grayscale.light5,0)},
    ${e.colors.grayscale.light5} ${e.opacity.mediumLight}
  );

  & > button {
    pointer-events: auto;
  }

  & > .filter-apply-button {
    margin-bottom: ${3*e.gridUnit}px;
  }
`,Hk=e=>x.iv`
  align-items: center;
  margin-left: auto;
  && > .filter-clear-all-button {
    text-transform: capitalize;
    font-weight: ${e.typography.weights.normal};
  }
  & > .filter-apply-button {
    &[disabled],
    &[disabled]:hover {
      color: ${e.colors.grayscale.light1};
      background: ${e.colors.grayscale.light3};
    }
  }
`,qk=({width:e=Jc.I6,onApply:t,onClearAll:n,dataMaskApplied:r,dataMaskSelected:o,isApplyDisabled:s,isFixed:l,filterBarOrientation:u=i.Bp.VERTICAL})=>{const c=(0,a.useMemo)((()=>Object.values(r).some((e=>{var t,n,r;return(0,Lk.Z)(null==(t=o[e.id])||null==(n=t.filterState)?void 0:n.value)||!o[e.id]&&(0,Lk.Z)(null==(r=e.filterState)?void 0:r.value)}))),[r,o]),p=u===i.Bp.VERTICAL;return(0,x.tZ)("div",{css:t=>[Ak(t,l),p?jk(t,e,l):Hk(t)],"data-test":"filterbar-action-buttons"},(0,x.tZ)(se.Z,fe()({disabled:s,buttonStyle:"primary",htmlType:"submit",className:"filter-apply-button",onClick:t},wS("apply-button")),p?(0,d.t)("Apply filters"):(0,d.t)("Apply")),(0,x.tZ)(se.Z,fe()({disabled:!c,buttonStyle:"link",buttonSize:"small",className:"filter-clear-all-button",onClick:n},wS("clear-button")),(0,d.t)("Clear all")))},Uk=y.iK.div`
  ${({theme:e})=>`\n    padding: ${3*e.gridUnit}px ${2*e.gridUnit}px ${3*e.gridUnit}px ${4*e.gridUnit}px;\n    background: ${e.colors.grayscale.light5};\n    box-shadow: inset 0px -2px 2px -1px ${e.colors.grayscale.light2};\n  `}
`,Vk=y.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: flex-start;\n    line-height: 0;\n\n    .loading {\n      margin: ${2*e.gridUnit}px auto ${2*e.gridUnit}px;\n      padding: 0;\n    }\n  `}
`,Wk=y.iK.div`
  ${({theme:e})=>`\n    font-weight: ${e.typography.weights.bold};\n    color: ${e.colors.grayscale.base};\n    font-size: ${e.typography.sizes.s}px;\n  `}
`,Gk=y.iK.div`
  ${({theme:e,hasFilters:t})=>`\n    height: 24px;\n    display: flex;\n    align-items: center;\n    padding: 0 ${4*e.gridUnit}px 0 ${4*e.gridUnit}px;\n    border-right: ${t?`1px solid ${e.colors.grayscale.light2}`:0};\n\n    button {\n      display: flex;\n      align-items: center;\n      > .anticon {\n        height: 24px;\n        padding-right: ${e.gridUnit}px;\n      }\n      > .anticon + span, > .anticon {\n          margin-right: 0;\n          margin-left: 0;\n        }\n    }\n  `}
`,Kk=({actions:e,canEdit:t,dashboardId:n,dataMaskSelected:r,filterValues:i,isInitialized:s,onSelectionChange:l,compatibleHistoryData:u,filterHistoryMode:c})=>{const h=i.length>0,g=(0,o.v9)((e=>e)),{dashboardLayout:m={},nativeFilters:v={}}=g||{},b=m.present||{},y=Object.values(b).filter((e=>(null==e?void 0:e.type)===f.hI)).map((e=>{var t;return null==e||null==(t=e.meta)?void 0:t.filterId})),C=v.filters||{},w=["filter-chart","filter-edit-chart"],S=Object.keys(C).filter((e=>{var t;return!y.includes(e)&&!w.includes(null==C||null==(t=C[e])?void 0:t.addFromModule)}));if(u){return S.length>0?(0,x.tZ)(Uk,null,(0,x.tZ)(Vk,null,(0,x.tZ)(Ek,{dataMaskSelected:r,onFilterSelectionChange:l,compatibleHistoryMode:!0,oldDataFilterList:S,filterHistoryMode:c}),e)):null}return(0,x.tZ)(Uk,wS(),(0,x.tZ)(Vk,null,s?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(NZ,null),t&&(0,x.tZ)(Gk,{hasFilters:h},(0,x.tZ)(JS,{dashboardId:n,createNewOnOpen:0===i.length},(0,x.tZ)(ae.Z.PlusSmall,null)," ",(0,d.t)("Add/Edit Filters"))),!h&&(0,x.tZ)(Wk,{"data-test":"horizontal-filterbar-empty"},(0,d.t)("No filters are currently added to this dashboard.")),h&&(0,x.tZ)(Ek,{dataMaskSelected:r,filterHistoryMode:c,onFilterSelectionChange:l}),e):(0,x.tZ)(p.Z,{position:"inline-centered"})))},Yk=a.memo(Kk),Xk=[me.KD.nativeFilters.name,me.KD.permalinkKey.name],Qk=Lt()((async(e,t,n,r,o)=>{const{location:i}=e,{search:a}=i,s=new URLSearchParams(a),l=new URLSearchParams;let d;s.forEach(((e,t)=>{Xk.includes(t)||l.append(t,e)}));const u=(0,ye.eY)(me.KD.nativeFiltersKey),c=JSON.stringify(r);d=n&&u&&await(0,$k.TZ)(t,c,u,o)?u:await(0,$k.u7)(t,c,o),d&&l.set(me.KD.nativeFiltersKey.name,d),window.location.pathname.includes("/superset/dashboard")&&(e.location.pathname=(0,ye.Zn)(window.location.pathname,""),e.replace({search:l.toString()}))}),Or.M),Jk=(e,t)=>{const{orientation:n=i.Bp.VERTICAL,verticalConfig:r,callBackDataMaskSelected:s,compatibleHistoryData:l,filterHistoryMode:d}=e,u=(0,tu.k6)(),c=Pp(),[p,h]=(0,zk.x)(c),f=(0,o.I0)(),[g,m]=(0,a.useState)(0),v=(0,Nk.z)(),b=Op(),y=(0,da.D)(b),C=Object.values(b),S=C.filter(Nr.kI),k=(0,o.v9)((({dashboardInfo:e})=>null==e?void 0:e.id)),M=(0,da.D)(k),D=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm));(0,a.useImperativeHandle)(t,(()=>({handleFilterSelectionChange:(e,t)=>{E(e,t)},handleAutoApply:()=>{T()},handleClearFilterById:e=>{_(e)},handleClearAll:()=>{I()}})));const E=(0,a.useCallback)(((e,t)=>{h((n=>{var r,o,i;void 0!==(null==(r=t.filterState)?void 0:r.value)&&void 0===(null==(o=p[e.id])||null==(i=o.filterState)?void 0:i.value)&&e.requiredFirst&&f((0,w.updateDataMask)(e.id,t)),n[e.id]={...(0,Fk.H)(e.id),...t}}))}),[p,f,h]);(0,a.useEffect)((()=>{null==s||s(p)}),[p]),(0,a.useEffect)((()=>{if(y&&k===M){const e={};Object.values(b).forEach((t=>{const n=null==y?void 0:y[t.id];if(!n)return;const r=t.filterType,o=t.targets,i=t.defaultDataMask,a=null==n?void 0:n.filterType,s=null==n?void 0:n.targets,l=null==n?void 0:n.defaultDataMask,d=r!==a,u=!Tr()(o,s),c=!Tr()(i,l);(d||u||c)&&(e[t.id]=(0,Fk.H)(t.id))})),Z()(e)||(h((t=>({...t,...e}))),Object.keys(e).forEach((e=>f((0,w.clearDataMask)(e)))))}}),[JSON.stringify(b),JSON.stringify(y),M]);const R=JSON.stringify(c);(0,a.useEffect)((()=>{h((()=>c))}),[R,h]),(0,a.useEffect)((()=>{Qk(u,k,g,c,v)}),[k,R,u,g,v]);const T=(0,a.useCallback)((()=>{const e=Object.keys(p);m(1),e.forEach((e=>{p[e]&&f((0,w.updateDataMask)(e,p[e]))}))}),[p,f]),_=e=>{f((0,w.clearDataMask)(e)),h((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)}))},I=(0,a.useCallback)((()=>{Object.keys(p).forEach((e=>{p[e]&&(f((0,w.clearDataMask)(e)),h((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)})))}))}),[p,f,h]);((e,t)=>{const n=Op(),r=Pp();(0,a.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[r,e,n,t])})(p,h);const O=((e,t,n)=>{const r=Object.values(e),o=Object.values(t);return(0,ru.JB)(xS(e),xS(t),{ignoreUndefined:!0})||r.length!==o.length||n.some((t=>{var n;return CS(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(p,c,S),P=(()=>{const[e,t]=(0,a.useState)(!1),n=Op(),r=(0,a.useContext)(Fc.MigrationContext);let i=(0,o.v9)((e=>e.charts)),s=0;if(!e)if(r===nt.Qi.REVIEWING){i=Rp()(_p()(i,(e=>{var t;return"filter_box"!==(null==(t=e.form_data)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;s=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else s=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,a.useEffect)((()=>{if(e)return;if(Object.values(n).find((({requiredFirst:e})=>e)))return void t(!0);let r;0===s&&(r=setTimeout((()=>{t(!0)}),1e3)),s>0&&void 0!==r&&clearTimeout(r);const o=Object.values(i).filter((({chartStatus:e})=>"loading"!==e)).length;s>0&&o>=s&&t(!0)}),[i,e,s]),e})(),z=(0,x.tZ)(qk,{isFixed:Boolean(null==r?void 0:r.isActionFixed),filterBarOrientation:n,width:null==r?void 0:r.width,onApply:T,onClearAll:I,dataMaskSelected:p,dataMaskApplied:c,isApplyDisabled:O});return n===i.Bp.HORIZONTAL?(0,x.tZ)(Yk,{actions:z,canEdit:D,dashboardId:k,dataMaskSelected:p,filterValues:C,isInitialized:P,filterHistoryMode:d,onSelectionChange:E,compatibleHistoryData:l}):r?(0,x.tZ)(tk,{isActionFixed:r.isActionFixed,actions:z,showHeader:r.showHeader,canEdit:D&&r.canEdit,dataMaskSelected:p,filtersOpen:r.filtersOpen,filterValues:C,isInitialized:P,isDisabled:O,height:r.height,offset:r.offset,onSelectionChange:E,toggleFiltersBar:r.toggleFiltersBar,width:r.width}):null},eM=a.memo((0,a.forwardRef)(Jk)),tM=e=>{const t=e[Be._4],n=null==t?void 0:t.children[0];return n===Be.PV?e[Be._4]:e[n]},nM=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target);var rM=n(281545),oM=n(478718),iM=n.n(oM),aM=n(818172);const sM="x63NTKK985oFeIZAL2fI",lM="oqls5fPaZPYYsPAsM3vF",dM="xPrNmB65abo4WGinRzlD",uM="JBFcYZwW4dLqNgfV7wmi",cM="yCSeLVnfjeUbHGpWeB4T",pM="mF3oyrcfWFtlzHsMX0vA",hM="Nv4ErBfLI4EsDdgQAJ5S",fM="MQEpm4GHiDpOi7oons3b",gM="ysq6C9OL2SH6zEr8VQtX",mM="lUGMz2nHYw6hm3p5lZwK",vM=0,bM="dashboard-grid-mobile-drawer-wrap",yM=y.iK.div`
  overflow: hidden;
  position: relative;
`,xM=y.iK.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  max-height: 100%;
  overflow-x: hidden;
  overflow-y: auto;
  background: rgb(255, 255, 255);
  box-shadow: rgba(0, 0, 0, 0.15) -4px 0px 8px;
  border-top-left-radius: 8px;
  border-bottom-left-radius: 8px;
`,CM=e=>{const{containerHeight:t,containerWidth:n,children:r,offset:i,onClose:s,transparency:l,initVisible:d,editMode:u,ids:c}=e,[p,h]=(0,a.useState)({position:"absolute",zIndex:99,inset:0,overflow:"hidden"}),f=(0,o.I0)();(0,a.useEffect)((()=>{t&&n&&h((0,aM.Uy)((e=>{e.height=t,e.width=n,e.transform=`translateX(${0!==i&&i<n?0:i+n}px)`})))}),[t,n]),(0,a.useEffect)((()=>{h((0,aM.Uy)((e=>{e.background=`rgba(0, 0, 0, ${l})`})))}),[l]),(0,a.useEffect)((()=>{n&&h((0,aM.Uy)((e=>{e.transform=`translateX(${0!==i&&i<n?0:i+n}px)`}))),i?h((0,aM.Uy)((e=>{e.transition="transform .45s ease-in-out 0s, background .75s ease .45s"}))):(setTimeout((()=>{f((0,ss.ys)("horizontal"))}),450),d&&h((0,aM.Uy)((e=>{e.transition="transform .45s ease-out 0s, background 0s ease-out 0s"}))))}),[i]);return(0,x.tZ)("div",{onClick:()=>{null==s||s(),f((0,ss.rE)({confirm:!1,reset:!1}))},className:pM,style:{...p,height:t,display:null!=c&&c.length?"block":"none"}},(0,x.tZ)(xM,{id:"dashboard-mobile-content",style:{width:n-60,height:t},onClick:e=>e.stopPropagation()},(0,x.tZ)("div",{className:hM},(0,x.tZ)("div",{className:`${fM} ${u?"":gM}`},r),(0,x.tZ)("div",{className:mM},(0,x.tZ)(Th.zx,{onClick:()=>{null==s||s(),Oh([e=>{f((0,ss.rE)({confirm:!1,reset:!0})),setTimeout(e,0)},()=>f((0,ss.rE)({confirm:!1,reset:!1}))])},size:"small",block:!0,style:{marginLeft:6,marginRight:6}},"\u91cd\u7f6e"),(0,x.tZ)(Th.zx,{onClick:()=>{f((0,ss.rE)({confirm:!0,reset:!1})),null==s||s()},size:"small",block:!0,color:"primary",style:{marginLeft:6,marginRight:6}},"\u786e\u5b9a")))))},wM=e=>{const{onClose:t,children:n,button:r,defaultButton:i,component:s,containerHeight:l,containerWidth:d,offset:u,transparency:c=vM,initVisible:p,renderDragDroppableUp:h,renderDragDroppableDown:f,onOpen:g,ids:m,num:v,contentStyle:b,containerStyle:y,editMode:C,freeShowMore:w}=e,S=(0,o.I0)(),Z=(0,o.v9)((e=>e.dashboardState.mobileFilterType)),[k,M]=(0,a.useState)(""),D=(null==m?void 0:m.length)>v;return(0,x.tZ)(yM,{key:bM,"data-test":bM,className:cM,style:{height:w?"auto":l,...y}},h,Array.isArray(r)&&r.length?(0,x.tZ)("div",{className:sM,style:{...b}},(0,x.tZ)("div",{className:lM},(0,x.tZ)(Th.mQ,{onChange:M,activeKey:k,style:"vertical"===Z?{display:"none"}:{}},r.map(((e,t)=>(0,x.tZ)(Th.mQ.Tab,{tabIndex:t,title:e,key:e.key})))),Array.isArray(i)&&i.length?(0,x.tZ)(Th.mQ,{activeKey:k,style:"horizontal"===Z?{display:"none"}:{}},i.map((e=>(0,x.tZ)(Th.mQ.Tab,{title:e,key:e.key})))):null),D||w?(0,x.tZ)("div",{className:dM,onClick:e=>{null==e||e.stopPropagation(),null==g||g(),S((0,ss.ys)("vertical")),S((0,ss.rE)({confirm:!1,reset:!1}))}},(0,x.tZ)(_h,null)):null):null,Array.isArray(s)&&s.length?(0,x.tZ)("div",{className:`${uM} dmd-tabs-content`},s.map((e=>(0,x.tZ)("div",{key:e.key,style:{marginTop:4}},e)))):null,(0,x.tZ)(CM,{transparency:c,onClose:t,offset:u,initVisible:p,containerHeight:l,containerWidth:d,editMode:C,ids:m,contentStyle:b},n),f)},SM=(0,kr.cz)(),ZM={depth:l().number.isRequired,editMode:l().bool,layoutMode:i.kB,gridComponent:It.cP,handleComponentDrop:l().func.isRequired,isComponentVisible:l().bool.isRequired,resizeComponent:l().func.isRequired,setDirectPathToChild:l().func.isRequired,setDashboardDrawerStatus:l().func,width:l().number.isRequired,containerHeight:l().number,dashboardId:l().number},kM=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),MM=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--top"}),DM=y.iK.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
`,EM=y.iK.div`
  ${({theme:e})=>x.iv`
    display: flex;
    flex-direction: column;

    /* gutters between rows */
    & > div {
      // div:not(:last-child):not(.empty-droptarget)
      margin-bottom: ${4*e.gridUnit}px;
    }

    & > .empty-droptarget {
      width: 100%;
      height: 100%;
    }

    & .empty-droptarget-box {
      position: absolute;
      inset: 0;
      z-index: 98;
    }

    & > .empty-droptarget:first-child {
      height: ${12*e.gridUnit}px;
      margin-top: ${-6*e.gridUnit}px;
      margin-bottom: ${-6*e.gridUnit}px;
    }

    & > .empty-droptarget:last-child {
      // 处理页面最后一个图表是tab的时候不能拖入行的问题
      height: ${12*e.gridUnit}px;
    }

    & > .empty-droptarget:only-child {
      // height: 80vh;
    }
  `}
`,RM=y.iK.div`
  ${({theme:e})=>x.iv`
    // /* Editing guides */
    &.grid-column-guide {
      position: absolute;
      top: 0;
      min-height: 100%;
      background-color: ${(0,C.Zf)(e.colors.primary.base,parseFloat(e.opacity.light)/100)};
      //pointer-events: none;
      box-shadow: inset 0 0 0 1px
        ${(0,C.Zf)(e.colors.primary.base,parseFloat(e.opacity.mediumHeavy)/100)};
    }
  `};
`,TM=y.iK.div`
  ${()=>x.iv`
    // margin-bottom: 0 !important;
    .grid-row {
      min-height: auto;
    }
    .grid-row:after {
      border: 0 none !important;
    }
  `}
`;class _M extends a.PureComponent{constructor(e){super(e),this.handleCommonStyle=({type:e,color:t,image:n})=>{const r="#f0f2f5";return`${"color"===e?t:"image"===e&&n&&"noImg"!==n?`url(${n}) center center / cover no-repeat`:r}`},this.renderFilterAndContent=({type:e="filter",count:t})=>{var n;const{presentItems:r,gridComponent:o,dashboardState:{mobileFilterType:i}}=this.props;if(null!=o&&null!=(n=o.children)&&n.length){const n=r.length?r.map((e=>e.parentsId)):[],i=o.children;if("filter"===e){const e=this.handleFilterTabsFilters(r);return e.length?e.slice(0,t).filter(Boolean).map(((e,t)=>this.renderCommonDashboardGrid(e.parentsId,t,!0))):[]}if("content"===e){const e=i.filter((e=>!n.includes(e))).filter(Boolean);return e.length?e.map(((e,t)=>this.renderCommonDashboardGrid(e,t))):[]}}return[]},this.renderFilterHorizontalDefaultMenus=({count:e})=>{const{presentMenuItems:t,editMode:n}=this.props,r=this.handleFilterTabsFilters(t);if(null!=r&&r.length){return r.slice(0,e).map((({filterId:e,parentsId:t,name:r})=>(0,x.tZ)("div",{key:t,className:Rh.filterButtonMore},(0,x.tZ)(Eh.Z,{id:e,name:r,type:"horizontal"}),n?(0,x.tZ)(Dh,{style:{fontSize:16},className:"moreOutLine"}):null)))}return null},this.state={isResizing:!1,fullStyle:{},openDrawer:!1,offset:0,transparency:0,initVisible:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this),this.handleOpenDrawer=this.handleOpenDrawer.bind(this),this.handleCloseDrawer=this.handleCloseDrawer.bind(this),this.renderCommonDashboardGrid=this.renderCommonDashboardGrid.bind(this),this.handleFilterTabsFilters=this.handleFilterTabsFilters.bind(this),this.params=(0,ye.VW)()}componentDidMount(){this.handleDashboardDrawerStatus(0),document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement?this.setState({fullStyle:{minHeight:window.screen.height,minWidth:window.screen.width,overflow:"auto"}}):this.setState({fullStyle:{}})}))}componentWillUnmount(){this.setState({initVisible:!1}),this.handleDashboardDrawerStatus(0)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart(){this.setState((()=>({isResizing:!0})))}handleResizeStop({id:e,widthMultiple:t,heightMultiple:n}){this.props.resizeComponent({id:e,width:t,height:n}),this.setState((()=>({isResizing:!1})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleDashboardDrawerStatus(e=0){const{setDashboardDrawerStatus:t}=this.props;t&&t(e)}handleOpenDrawer(){const{width:e}=this.props;this.handleDashboardDrawerStatus(1),this.setState({openDrawer:!0,offset:-e,transparency:.55,initVisible:!0})}handleCloseDrawer(){this.setState({openDrawer:!1,offset:0,transparency:0}),this.handleDashboardDrawerStatus(0)}renderCommonDashboardGrid(e,t,n=!1){const{isComponentVisible:r,depth:o,gridComponent:a,layoutMode:s,width:l}=this.props,d=s===i.kB.MOBILE?ih:Pk,u=s===i.kB.MOBILE?Be.Pj:Be.es,c=(l+u)/SM-u,p=(0,x.tZ)(d,{id:e,parentId:a.id,depth:o+1,index:t,availableColumnCount:SM,columnWidth:c,isComponentVisible:r,onResizeStart:this.handleResizeStart,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab});(0,kr.Od)(s);return n?(0,x.tZ)(TM,{key:e,"data-test":"dashboard-grid-box"},p):p}handleFilterTabsFilters(e){const{mobileDashboardLayout:t}=this.props,n=Object.values((null==t?void 0:t.present)||{});return e.filter((e=>{const{currentId:t}=e||{};let r=!0;return n.forEach((e=>{const{id:n,parents:o=[]}=e||{},i=o.filter((e=>e.indexOf("TAB")>-1)).length;n===t&&i&&(r=!1)})),r}))}renderMobileDrawerWrap({contentStyle:e}){var t,n;const{gridComponent:r,width:o,editMode:i,containerHeight:a,handleComponentDrop:s,defaultFilterConditionNumber:l,depth:d,presentItems:u}=this.props,{offset:c,transparency:p,initVisible:h}=this.state,f=this.handleFilterTabsFilters(u),g=f.length?f.map((e=>null==e?void 0:e.filterId)).filter(Boolean):[],m=i?(0,x.tZ)(Wn,{component:r,depth:d,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-bottom empty-droptarget "+(null!=r&&null!=(t=r.children)&&t.length?"":"empty-droptarget-box"),editMode:!0,style:g.length?{top:45}:{}},MM):null,v=i&&null!=r&&null!=(n=r.children)&&n.length?(0,x.tZ)(Wn,{component:r,depth:d,parentComponent:null,index:r.children.length,orientation:"column",onDrop:s,className:"empty-top empty-droptarget empty-droptarget-box",editMode:!0,style:g.length?{top:21}:{}},kM):null,b=this.renderFilterAndContent({count:l}),y=this.renderFilterHorizontalDefaultMenus({count:l}),C=this.renderFilterAndContent({count:null==u?void 0:u.length}),w={containerHeight:a,containerWidth:o,offset:c,transparency:p,initVisible:h,contentStyle:e,renderDragDroppableUp:v,renderDragDroppableDown:m,button:b,defaultButton:y,component:this.renderFilterAndContent({type:"content"}),num:l,ids:g,onClose:this.handleCloseDrawer,onOpen:this.handleOpenDrawer,editMode:i};return(0,x.tZ)(wM,w,C)}render(){var e,t,n;const{backgroundType:r,backgroundColor:o,backgroundImage:s,gridComponent:l,handleComponentDrop:u,depth:c,width:p,editMode:h,layoutMode:g,canEdit:m,setEditMode:v,dashboardId:b,dashboardInfo:y}=this.props,C=this,w=g===i.kB.MOBILE?Be.Pj:Be.es,S=(p+w)/SM-w,{isResizing:Z}=this.state,k=0===(null==l||null==(e=l.children)?void 0:e.length),M=k&&l.type===f.gn,D=h&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("Drag and drop components and charts to the dashboard"),description:(0,d.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,x.tZ)(a.Fragment,null,(0,x.tZ)("i",{className:"fa fa-plus"}),(0,d.t)("Create a new chart")),buttonAction:()=>{window.open((0,ye.ns)(`/chart/add?dashboard_id=${b}`,this.params),"_blank","noopener noreferrer")},image:"chart.svg"}),E=h?(0,x.tZ)(Mh.XJ,{title:(0,d.t)("Drag and drop components to this tab"),description:(0,d.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,x.tZ)(a.Fragment,null,(0,x.tZ)("i",{className:"fa fa-plus"}),(0,d.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${b}`,"_blank","noopener noreferrer")},image:"chart.svg"}):(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no components added to this tab"),description:m&&(0,d.t)("You can add the components in the edit mode."),buttonText:m&&(0,d.t)("Edit the dashboard"),buttonAction:m&&(()=>{v(!0)}),image:"chart.svg"}),{mobile_metadata:R,metadata:T}=y,_={background:C.handleCommonStyle({type:null==T?void 0:T.background_filter_type,color:null==T?void 0:T.background_filter_color,image:null==T?void 0:T.background_filter_image})};return p<100?null:(0,x.tZ)(a.Fragment,null,k&&(0,x.tZ)(DM,null,M?E:D),(0,x.tZ)("div",{className:`dashboard-grid ${g===i.kB.MOBILE?Rh.tabContentDmd:""}`,ref:this.setGridRef,id:"rowAndColDash",style:{background:C.handleCommonStyle({type:r,color:o,image:s}),backgroundSize:"100% auto",backgroundPosition:"center center",backgroundAttachment:"fixed",...this.state.fullStyle}},(0,x.tZ)(EM,{className:"grid-content","data-test":"grid-content"},g===i.kB.MOBILE?this.renderMobileDrawerWrap({contentStyle:_}):(0,x.tZ)(a.Fragment,null,h&&(0,x.tZ)(Wn,{component:l,depth:c,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},kM),null==l||null==(t=l.children)?void 0:t.map(((e,t)=>C.renderCommonDashboardGrid(e,t,!1))),h&&(null==l||null==(n=l.children)?void 0:n.length)>0&&(0,x.tZ)(Wn,{component:l,depth:c,parentComponent:null,index:l.children.length,orientation:"column",onDrop:u,className:"empty-droptarget",editMode:!0},MM)),Z&&Array(SM).fill(null).map(((e,t)=>(0,x.tZ)(RM,{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*w+t*S+(g===i.kB.MOBILE?0:30),width:S}}))))))}}_M.propTypes=ZM,_M.defaultProps={};const IM=_M;const OM=(0,o.$j)((function(e){var t,n,r;const{dashboardInfo:o,dashboardState:i}=e;return{editMode:i.editMode,dashboardState:i,dashboardInfo:o,canEdit:o.dash_edit_perm,dashboardId:o.id,backgroundType:null==o||null==(t=o.metadata)?void 0:t.background_type,backgroundColor:null==o||null==(n=o.metadata)?void 0:n.background_color,backgroundImage:null==o||null==(r=o.metadata)?void 0:r.background_image}}),(function(e){return(0,r.DE)({handleComponentDrop:vl._p,resizeComponent:vl.iO,setDirectPathToChild:ss.E2,setEditMode:ss.Mb,setShowComponentPropertyPane:ss.ks},e)}))(IM);const PM=(0,o.$j)((function(e,t){var n,r,o,i;const{mobileDashboardLayout:a,dashboardInfo:s,dashboardState:l,nativeFilters:d}=e;return{editMode:l.editMode,dashboardState:l,dashboardInfo:s,canEdit:s.dash_edit_perm,dashboardId:s.id,drawerStatus:l.drawerStatus,mobileFilterChange:l.mobileFilterChange,layoutType:(null==s||null==(n=s.metadata)?void 0:n.layout_type)||"rowAndColumn",backgroundType:null==s||null==(r=s.metadata)?void 0:r.background_type,backgroundColor:null==s||null==(o=s.metadata)?void 0:o.background_color,backgroundImage:null==s||null==(i=s.metadata)?void 0:i.background_image,mobileDashboardLayout:a,...ul({mobileDashboardLayout:a,dashboardInfo:s,nativeFilters:d})}}),(function(e){return(0,r.DE)({handleComponentDrop:bl._p,resizeComponent:bl.iO,setDirectPathToChild:ss.E2,setDashboardDrawerStatus:ss.RP,setEditMode:ss.Mb,setShowComponentPropertyPane:ss.ks},e)}))(IM),zM=()=>x.iv`
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }
  ::-webkit-scrollbar-track {
    background-color: rgba(9, 30, 64, 0);
    border-radius: 5px;
  }
  ::-webkit-scrollbar-thumb {
    border: 2px solid transparent;
    background-clip: padding-box;
    border-radius: 10px;
    background-color: rgba(9, 30, 64, 0.07);
  }
`,FM=({topLevelTabs:e,containerHeight:t,onChangeTab:n})=>{const r=(()=>{const e=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters}));return(0,a.useMemo)((()=>e?Object.values(e).map((e=>iM()(e,["id","scope","type"]))):[]),[JSON.stringify(e)])})(),[s,l]=(0,a.useState)(0),d=(0,o.I0)(),c=(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC})),p=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),h=(0,o.v9)((e=>(c===i.kB.MOBILE?e.mobileDashboardLayout:e.dashboardLayout).present)),f=(0,o.v9)((e=>e.dashboardInfo)),g=(0,o.v9)((e=>e.dashboardState.directPathToChild)),m=(0,o.v9)((e=>e.charts)),[v,b]=(0,a.useState)(0),y=(0,a.useMemo)((()=>{const e=_w({currentComponent:tM(h),directPathToChild:g});return e>-1?e:((e,t)=>Math.max(0,_w({currentComponent:tM(e),directPathToChild:t})))(h,g)}),[h,g]),C=c===i.kB.MOBILE?PM:OM;(0,a.useEffect)((()=>{if(!(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)||0===r.length)return;const e=r.map((e=>{if(e.id.startsWith(ua.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const t=(0,uu.Q)(e.scope,m,h),n=(0,_o.Rz)(h,t);return{filterId:e.id,tabsInScope:Array.from(n),chartsInScope:t}}));d((0,Mr.xk)(e))}),[r,h,d]);const w=(0,a.useCallback)((()=>{const e=f.metadata;if(null!=e&&e.color_scheme){const n={...e},r=null==n?void 0:n.color_scheme,o=(null==n?void 0:n.color_scheme_domain)||[],i=(0,rM.Z)(),a=i.get(r,!0)||void 0,s=(null==a?void 0:a.colors)||[],l=i.defaultKey,u=!!a,c=()=>{ee.Z.put({endpoint:`/api/v1/dashboard/${f.id}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({json_metadata:Eu()(n)})})},p=e=>{d((0,ss.uW)(e))},h=()=>{d((0,Ud.a8)({metadata:n})),c()};if(u)u&&!o.length&&(n.color_scheme_domain=s,h()),u&&o.length&&s.toString()!==o.toString()&&(n.color_scheme_domain=s,n.shared_label_colors={},p(r),h());else{var t;const e=(null==l?void 0:l.toString())||"supersetColors";n.color_scheme=e,n.color_scheme_domain=(null==(t=i.get(l))?void 0:t.colors)||[],n.shared_label_colors={},p(e),h()}}}),[m]);(0,Xo.d)(w);const S=e?e.children:[Be.PV],Z=Math.min(y,S.length-1),k=0===Z?Be.PV:Z.toString();(0,a.useEffect)((()=>{l(window.innerHeight-116),window.onresize=Lt()((()=>{l(window.innerHeight-116)}),1e3)}),[]);const M=e=>{b(e)};return(0,x.tZ)("div",{className:"grid-container","data-test":"grid-container"},(0,x.tZ)(hw,null,(({width:e,height:r})=>(0,x.tZ)(ko.ZP,{id:Be.PV,activeKey:k,renderTabBar:()=>(0,x.tZ)(a.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},S.map(((o,a)=>{let l={width:`${e}px`,minHeight:"500px",height:`${s}px`,overflow:"hidden auto"};return(0,kr.Od)(c)&&(l={width:"100%",minHeight:"1000px",height:`${v}px`,overflow:"hidden"}),(0,x.tZ)(ko.ZP.TabPane,{key:0===a?Be.PV:a.toString()},(0,x.tZ)("div",{id:"dash-tabpan",style:{width:"100%",height:"auto",backgroundColor:"white"}},"grid"===p?(0,x.tZ)("div",{style:l,css:zM,id:"gridDash"},c===i.kB.MOBILE?(0,x.tZ)(lw,{width:e,gridComponent:h[o],calcMobileHeight:M,height:r,depth:Be.Mu+1,isComponentVisible:a===y,onChangeTab:n}):(0,x.tZ)(fw,{width:e,gridComponent:h[o],height:r,depth:Be.Mu+1,isComponentVisible:a===y,onChangeTab:n})):(0,x.tZ)(C,{gridComponent:h[o],depth:Be.Mu+1,width:e,containerHeight:t,layoutMode:c,isComponentVisible:a===y})))}))))))},NM=()=>{const e=(0,a.useContext)(Fc.MigrationContext),[t,n]=(0,a.useState)(!1),r=(0,o.v9)((e=>{var t,n;return(null==(t=(0,ye.eY)(me.KD.showFilters))||t)&&(null==(n=e.dashboardInfo.metadata)?void 0:n.show_native_filters)})),i=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),s=Op(),l=Object.values(s),d=(0,ye.eY)(me.KD.expandFilters),[c,p]=(0,a.useState)(null!=d?d:!!l.length),h=r&&(0,oe.cr)(u.T.DASHBOARD_NATIVE_FILTERS)&&(i||!i&&0!==l.length),f=l.filter((e=>e.requiredFirst)),g=Pp(),m=t||!h||!(h&&f.length&&f.find((({id:e})=>{var t,n;return void 0===(null==(t=g[e])||null==(n=t.filterState)?void 0:n.value)}))),v=(0,a.useCallback)((e=>{p(null!=e?e:!c)}),[c]);return(0,a.useEffect)((()=>{!1===d||0===l.length&&h&&["CONVERTED","REVIEWING","NOOP"].includes(e)?v(!1):v(!0)}),[l.length,e]),(0,a.useEffect)((()=>{m&&n(!0)}),[m]),{showDashboard:m,dashboardFiltersOpen:c,toggleDashboardFiltersOpen:v,nativeFiltersEnabled:h}};var $M=n(339144);const LM=y.iK.div`
  ${({width:e})=>x.iv`
    width: ${e};
    height: 100%;

    .ant-card-head {
      min-height: auto;

      &-title {
        padding: 8px 0;
        font-weight: bold;
        font-size: 14px;
      }
    }
  `}
`,BM=({width:e="320px"})=>{const t=(0,ye.VW)();return(0,x.tZ)(LM,{width:e},"true"!==t.osp.get("view")&&(0,x.tZ)(a.Fragment,null,(0,x.tZ)($M.Z,{title:(0,d.t)("Dashboard settings"),style:{height:"250px"},bodyStyle:{height:"calc(100% - 45px)",overflowY:"auto"}},(0,x.tZ)(gl,null)),(0,x.tZ)($M.Z,{title:(0,d.t)("Component settings"),style:{height:"calc(100% - 250px)"},bodyStyle:{height:"calc(100% - 45px)",overflowY:"auto"}},(0,x.tZ)(dd,null))))},AM=y.iK.div`
  ${({theme:e})=>x.iv`
    position: relative;
    display: flex;
  `}
`,jM=y.iK.div`
  ${({theme:e})=>x.iv`
    display: grid;
    grid-template-columns: auto 1fr;
    grid-template-rows: auto 1fr;
    flex: 1;
    /* Special cases */

    /* A row within a column has inset hover menu */
    .dragdroppable-column .dragdroppable-row .hover-menu--left {
      left: ${-3*e.gridUnit}px;
      background: ${e.colors.grayscale.light5};
      border: 1px solid ${e.colors.grayscale.light2};
    }

    .dashboard-component-tabs {
      position: relative;
    }

    /* A column within a column or tabs has inset hover menu */
    .dragdroppable-column .dragdroppable-column .hover-menu--top,
    .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
      top: ${-3*e.gridUnit}px;
      background: ${e.colors.grayscale.light5};
      border: 1px solid ${e.colors.grayscale.light2};
    }

    /* move Tabs hover menu to top near actual Tabs */
    .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
      top: 0;
      transform: unset;
      background: transparent;
    }

    /* push Chart actions to upper right */
    .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
    .dragdroppable .dashboard-component-header .hover-menu--top {
      // right: ${2*e.gridUnit}px;
      // top: ${2*e.gridUnit}px;
      right: 0;
      top: 0;
      background: transparent;
      border: none;
      transform: unset;
      left: unset;
      display: flex;
      flex-direction: column;
    }
    div:hover > .hover-menu-container .hover-menu,
    .hover-menu-container .hover-menu:hover {
      opacity: 1;
    }

    p {
      margin: 0 0 ${2*e.gridUnit}px 0;
    }

    i.danger {
      color: ${e.colors.error.base};
    }

    i.warning {
      color: ${e.colors.alert.base};
    }
  `}
`,HM=y.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0;
  z-index: 100;
  max-width: 100vw;
`,qM=y.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,UM=y.iK.div`
  ${({theme:e,backgroundImage:t,backgroundColor:n,backgroundType:r})=>x.iv`
    position: relative;

    .grid-container {
      /* background-color: ${n||""};
      background-image: url(${t}); */
      /* background: ${"color"==r?n:`url(${t})`}; */
    }

    &.dashboard {
      position: relative;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      // height: 100%;

      /* drop shadow for top-level tabs only */
      & .dashboard-component-tabs {
        box-shadow: 0 ${e.gridUnit}px ${e.gridUnit}px 0
          ${(0,C.Zf)(e.colors.grayscale.dark2,parseFloat(e.opacity.light)/100)};
        padding-left: ${2*e.gridUnit}px; /* note this is added to tab-level padding, to match header */
      }

      .dropdown-toggle.btn.btn-primary .caret {
        color: ${e.colors.grayscale.light5};
      }

      .background--transparent {
        background-color: transparent;
      }

      .background--white {
        background-color: ${e.colors.grayscale.light5};
      }
    }
    &.dashboard--editing {
      .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed transparent;
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
        pointer-events: none;
      }

      .resizable-container {
        & .dashboard-component-chart-holder {
          .dashboard-chart {
            .chart-container {
              cursor: move;
              opacity: 0.2;
            }

            .slice_container {
              /* disable chart interactions in edit mode */
              pointer-events: none;
            }
          }

          &:hover .dashboard-chart .chart-container {
            opacity: 0.7;
          }
        }

        &:hover,
        &.resizable-container--resizing:hover {
          & > .dashboard-component-chart-holder:after {
            border: 1px dashed ${e.colors.primary.base};
          }
        }
      }

      .resizable-container--resizing:hover > .grid-row:after,
      .hover-menu:hover + .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed ${e.colors.primary.base};
        z-index: 2;
      }

      .grid-row:after,
      .dashboard-component-tabs > .hover-menu + div:after {
        border: 1px dashed ${e.colors.grayscale.light2};
      }

      /* provide hit area in case row contents is edge to edge */
      .dashboard-component-tabs-content {
        .dragdroppable-row {
          padding-top: ${4*e.gridUnit}px;
        }

        & > div:not(:last-child):not(.empty-droptarget) {
          margin-bottom: ${4*e.gridUnit}px;
        }
      }

      .dashboard-component-chart-holder {
        &:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          z-index: 1;
          pointer-events: none;
          border: 1px solid transparent;
        }

        &:hover:after {
          border: 1px dashed ${e.colors.primary.base};
          z-index: 2;
        }
      }

      .contract-trigger:before {
        display: none;
      }
    }

    & .dashboard-component-tabs-content {
      & > div:not(:last-child):not(.empty-droptarget) {
        margin-bottom: ${4*e.gridUnit}px;
      }

      & > .empty-droptarget {
        position: absolute;
        width: 100%;
      }

      & > .empty-droptarget:first-child {
        height: ${4*e.gridUnit}px;
        top: -2px;
        z-index: 10;
      }

      & > .empty-droptarget:last-child {
        height: ${3*e.gridUnit}px;
        bottom: 0;
      }
    }

    .empty-droptarget:first-child .drop-indicator--bottom {
      top: ${6*e.gridUnit}px;
    }
  `}
`,VM=y.iK.div`
  ${({theme:e,editMode:t,marginLeft:n})=>x.iv`
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    height: auto;
    flex: 1;
    z-index: 999;

    .grid-container .dashboard-component-tabs {
      box-shadow: none;
      padding-left: 0;
    }

    .grid-container {
      /* without this, the grid will not get smaller upon toggling the builder panel on */
      width: 0;
      flex: 1;
      position: relative;
      /* padding-top: ${6*e.gridUnit}px; */
      // padding-right: ${2*e.gridUnit}px;
      /* padding-bottom: ${6*e.gridUnit}px; */
      // padding-left: ${n}px;
      padding-left: ${t?8*e.gridUnit:0}px; // 编辑状态和预览界面左侧空白问题
      word-wrap: break-word;
      word-break: break-all;
      /* ${t&&`\n      max-width: calc(100% - ${Jc.XX+16*e.gridUnit}px);\n    `} */

      /* this is the ParentSize wrapper */
      & > div:first-child {
        height: inherit !important;
      }
    }

    .dashboard-builder-sidepane {
      width: ${Jc.XX}px;
      z-index: 1;
    }

    .dashboard-component-chart-holder {
      width: 100%;
      height: 100%;
      background-color: ${e.colors.grayscale.light5};
      position: relative;
      padding: ${4*e.gridUnit}px;
      overflow-y: visible;

      // transitionable traits to show filter relevance
      transition: opacity ${e.transitionTiming}s ease-in-out,
        border-color ${e.transitionTiming}s ease-in-out,
        box-shadow ${e.transitionTiming}s ease-in-out;

      &.fade-in {
        border-radius: ${e.borderRadius}px;
        box-shadow: inset 0 0 0 2px ${e.colors.primary.base},
          0 0 0 3px
            ${(0,C.Zf)(e.colors.primary.base,parseFloat(e.opacity.light)/100)};
      }

      &.fade-out {
        border-radius: ${e.borderRadius}px;
        box-shadow: none;
      }

      & .missing-chart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
        justify-content: center;

        .missing-chart-body {
          font-size: ${e.typography.sizes.s}px;
          position: relative;
          display: flex;
        }
      }
    }
  `}
`,WM=y.iK.div`
  display: flex;
  flex: 1;
  margin-top: 24px;
  margin-right: 32px;
  margin-bottom: 24px;
  margin-left: 32px;
`,GM=y.iK.div`
  ${({emulateRatio:e})=>x.iv`
    width: ${e.width}px;
    margin-right: 30px;

    .header {
      height: 30px;
      background: url('/static/assets/images/mbg0.png');
      background-size: cover;
    }

    .body {
      height: ${e.height}px;
      background: url('/static/assets/images/mbg2.png');
      background-size: contain;
      display: flex;
      padding: 1px;
      overflow-x: hidden;
      overflow-y: auto;
    }

    .footer {
      height: 18px;
      background: url('/static/assets/images/mbg1.png');
      background-size: cover;
      background-position-y: bottom;
    }

    .grid-container {
      // > 设置背景下用外背景1px的显示问题，所以注释掉。
      //margin-top: 1px;
      //margin-bottom: 1px;
      //margin-left: 1px;
      //margin-right: 1px;
      max-width: initial;
    }
  `};
`,KM=e=>{var t,n,r,s;const l=(0,o.I0)(),c=(0,iu.fG)(),h=(0,y.Fg)(),f=(0,o.v9)((e=>e.dashboardLayout.present)),g=(0,o.v9)((e=>e.dashboardState.editMode)),m=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),v=(0,o.v9)((({dashboardState:e})=>e.dashboardIsSaving)),C=(0,o.v9)((e=>e.dashboardState.fullSizeChartId)),w=(0,o.v9)((({dashboardInfo:e})=>(0,oe.cr)(u.T.HORIZONTAL_FILTER_BAR)?e.filterBarOrientation:i.Bp.VERTICAL)),{background_color:S,background_type:Z,background_image:k}=(0,o.v9)((({dashboardInfo:e})=>(null==e?void 0:e.metadata)||{})),M=(0,o.v9)((e=>e.dashboardState.layoutMode||i.kB.PC)),D=(0,o.v9)((e=>e.dashboardState.emulateRatio||{width:350,height:680})),E=(0,o.v9)((e=>{var t,n;return null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_type})),R=(0,o.v9)((e=>e.dashboardState.dashboardShare||!1)),[T,_]=(0,a.useState)(!1),I=(0,a.useCallback)((({pathToTabIndex:e})=>{l((0,ss.E2)(e))}),[l]),O=(0,a.useCallback)((()=>{l((0,vl.g3)());const e=Iw(tM(f),0);l((0,ss.E2)(e))}),[f,l]),P=(0,a.useCallback)((e=>l((0,vl._p)(e))),[l]),z=a.useRef(null),F=f[Be._4],N=null==F?void 0:F.children[0],$=N!==Be.PV?f[N]:void 0,L=(0,ye.eY)(me.KD.standalone),B=L===Be._B.REPORT,A=c.hideTitle||L===Be._B.HIDE_NAV_AND_TITLE||B,{showDashboard:j,dashboardFiltersOpen:H,nativeFiltersEnabled:q}=NM(),U=(0,a.useMemo)((()=>({marginLeft:H||g||!q||w===i.Bp.HORIZONTAL?0:-32})),[H,g,w,q]),V=(0,a.useRef)($);(0,a.useEffect)((()=>{var e,t,n;const r=null==(e=V.current)||null==(t=e.children)?void 0:t.length,o=null==$||null==(n=$.children)?void 0:n.length;if(void 0!==r&&void 0!==o&&o>r){const e=Iw(tM(f),o-1);l((0,ss.E2)(e))}V.current=$}),[$]);const W=(0,a.useCallback)((({dropIndicatorProps:e})=>(0,x.tZ)("div",{style:{minHeight:"10px"}},!1,e&&(0,x.tZ)("div",e),!B&&$&&!c.hideNav&&(0,x.tZ)(bp,{shouldFocus:nM,menuItems:[(0,x.tZ)(Xd,{icon:(0,x.tZ)(ae.Z.FallOutlined,{iconSize:"xl"}),label:(0,d.t)("Collapse tab content"),onClick:O})],editMode:g},(0,x.tZ)(Pk,{id:null==$?void 0:$.id,parentId:Be._4,depth:Be.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:I})))),[q,w,g,I,O,A,B,$,c.hideNav]),G=H||g||!q||w===i.Bp.HORIZONTAL?8*h.gridUnit:0;(0,a.useEffect)((()=>(document.addEventListener("fullscreenchange",(()=>{const e=document.querySelector(".grid-container");document.fullscreenElement?(_(!0),l((0,ss.FU)(!0)),e&&(e.style.paddingLeft="0")):(_(!1),l((0,ss.FU)(!1)),e&&(e.style.paddingLeft=8*h.gridUnit+"px"))})),()=>{(0,ss.FU)(!1)})),[]);const K=(0,a.useMemo)((()=>{if(g){let e={overflowY:"auto",overflowX:"hidden"};return M===i.kB.PC&&"grid"!==E&&(e={}),{position:"fixed",top:"0",left:"0",zIndex:"999",width:"100vw",height:"100vh",background:"#f0f2f5",...e}}return{}}),[g]);let Y={paddingLeft:""+(g?"0":"20px"),overflow:"hidden"};"grid"!==E&&(Y={paddingLeft:""+(g?"0":"20px")}),(0,a.useEffect)((()=>{if(window.location.href.indexOf("superset/embedded/dashboard")>-1){const e=document.querySelector("#main-menu");e&&(e.style.display="none");const t=document.querySelector("#editorHeader");t&&(t.style.display="none")}}),[]);const X=window.self!==window.top&&!g?0:117;return(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{"data-test":"dashboard-builder",style:{...K}},(0,x.tZ)("div",{style:{position:"sticky",top:0,zIndex:1e3,display:""+(C||R?"none":"block")},"data-test":"dashboard-builder-editor-header",id:"editorHeader"},(0,x.tZ)(Gd,{componentPanelOpen:!1,componentPanelClosable:!0})),(0,x.tZ)(eM,{orientation:i.Bp.HORIZONTAL,compatibleHistoryData:!0,filterHistoryMode:!0}),(0,x.tZ)(AM,{style:Y},g&&M!==i.kB.PC?(0,x.tZ)(a.Fragment,null,(0,x.tZ)(WM,null,(0,x.tZ)(GM,{emulateRatio:D},(0,x.tZ)("div",{className:"header"}),(0,x.tZ)("div",{className:"body"},(0,x.tZ)(jM,null,(0,x.tZ)(HM,{ref:z},(0,x.tZ)(Wn,{"data-test":"top-level-tabs",component:F,parentComponent:null,depth:Be.Mu,index:0,orientation:"column",onDrop:P,editMode:g,disableDragDrop:!!$,style:U},W)),(0,x.tZ)(qM,{fullSizeChartId:C},(0,x.tZ)(x.xB,{styles:x.iv`
                            // @z-index-above-dashboard-header (100) + 1 = 101
                            ${C&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
                          `}),!g&&!$&&0===(null==(r=f[Be.PV])||null==(s=r.children)?void 0:s.length)&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no charts added to this dashboard"),description:m&&(0,d.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:m&&(0,d.t)("Edit the dashboard"),buttonAction:()=>l((0,ss.Mb)(!0)),image:"dashboard.svg"}),(0,x.tZ)(UM,{"data-test":"dashboard-content-wrapper",className:b()("dashboard",g&&"dashboard--editing")},(0,x.tZ)(VM,{className:"dashboard-content",editMode:g,marginLeft:G},(0,x.tZ)(FM,{topLevelTabs:$,onChangeTab:I})))),v&&(0,x.tZ)(p.Z,{css:x.iv`
                            && {
                              position: fixed;
                            }
                          `}))),(0,x.tZ)("div",{className:"footer"})))):(0,x.tZ)(jM,{style:"grid"!==E?{height:`calc(100vh - ${window.location.search.includes("?target_id=")?55:X}px)`,overflowY:"auto",overflowX:"hidden"}:{},id:"dashboardScroll"},(0,x.tZ)(HM,{"data-test":"dashboard-builder-header",ref:z},(0,x.tZ)(Wn,{"data-test":"top-level-tabs",component:F,parentComponent:null,depth:Be.Mu,index:0,orientation:"column",onDrop:P,editMode:g,disableDragDrop:!!$,style:U},W)),(0,x.tZ)(qM,{"data-test":"dashboard-builder-content",fullSizeChartId:C},(0,x.tZ)(x.xB,{styles:x.iv`
                    // @z-index-above-dashboard-header (100) + 1 = 101
                    ${C&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
                  `}),!g&&!$&&0===(null==(t=f[Be.PV])||null==(n=t.children)?void 0:n.length)&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no charts added to this dashboard"),description:m&&(0,d.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:m&&(0,d.t)("Edit the dashboard"),buttonAction:()=>l((0,ss.Mb)(!0)),image:"dashboard.svg"}),(0,x.tZ)(UM,{backgroundColor:S,backgroundImage:k,backgroundType:Z,"data-test":"dashboard-content-wrapper",style:{zIndex:9},className:b()("dashboard",g&&"dashboard--editing")},(0,x.tZ)(VM,{className:"dashboard-content",editMode:g,marginLeft:G},j?(0,x.tZ)(FM,{topLevelTabs:$}):(0,x.tZ)(p.Z,null)))),v&&(0,x.tZ)(p.Z,{css:x.iv`
                    && {
                      position: fixed;
                    }
                  `})),g&&!T&&(0,x.tZ)("div",{style:{width:"320px",background:"#f0f2f5"}},(0,x.tZ)("div",{style:{height:"calc(100vh - 90px)",position:"fixed",top:"90px",right:0,zIndex:999}},(0,x.tZ)(BM,{width:"320px"}))))))};var YM=n(156967);const XM=[f.dW,f.xh,f.t,f.Ce,f.qu,f.Mg,f.hI,f.kE,f.GV];function QM(e){return!Object.values(e).some((({type:e})=>e&&XM.includes(e)))}var JM=n(226618);const eD=y.iK.div`
  ${({theme:e,backgroundImage:t,backgroundColor:n})=>x.iv`
    display: grid;
    max-width: 100%;
    grid-template-columns: auto 1fr;
    grid-template-rows: auto 1fr;
    flex: 1;
    background-color: ${n||""};
    background-image: url(${t});
    /* Special cases */

    /* A row within a column has inset hover menu */
    .dragdroppable-column .dragdroppable-row .hover-menu--left {
      left: ${-3*e.gridUnit}px;
      background: ${e.colors.grayscale.light5};
      border: 1px solid ${e.colors.grayscale.light2};
    }

    .dashboard-component-tabs {
      position: relative;
    }

    /* A column within a column or tabs has inset hover menu */
    .dragdroppable-column .dragdroppable-column .hover-menu--top,
    .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
      top: ${-3*e.gridUnit}px;
      background: ${e.colors.grayscale.light5};
      border: 1px solid ${e.colors.grayscale.light2};
    }

    /* move Tabs hover menu to top near actual Tabs */
    .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
      top: 0;
      transform: unset;
      background: transparent;
    }

    /* push Chart actions to upper right */
    .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
    .dragdroppable .dashboard-component-header .hover-menu--top {
      // right: ${2*e.gridUnit}px;
      // top: ${2*e.gridUnit}px;
      right: 0;
      top: 0;
      background: transparent;
      border: none;
      transform: unset;
      left: unset;
      display: flex;
      flex-direction: column;
    }
    div:hover > .hover-menu-container .hover-menu,
    .hover-menu-container .hover-menu:hover {
      opacity: 1;
    }

    p {
      margin: 0 0 ${2*e.gridUnit}px 0;
    }

    i.danger {
      color: ${e.colors.error.base};
    }

    i.warning {
      color: ${e.colors.alert.base};
    }
  `}
`,tD=y.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: relative;
  top: 0;
  z-index: 100;
  max-width: 100%;
  width: ${({width:e})=>e}px;
`,nD=y.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,rD=y.iK.div`
  ${({theme:e})=>x.iv`
    &.dashboard {
      position: relative;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      height: 100%;

      /* drop shadow for top-level tabs only */
      & .dashboard-component-tabs {
        box-shadow: 0 ${e.gridUnit}px ${e.gridUnit}px 0
          ${(0,C.Zf)(e.colors.grayscale.dark2,parseFloat(e.opacity.light)/100)};
        padding-left: ${2*e.gridUnit}px; /* note this is added to tab-level padding, to match header */
      }

      .dropdown-toggle.btn.btn-primary .caret {
        color: ${e.colors.grayscale.light5};
      }

      .background--transparent {
        background-color: transparent;
      }

      .background--white {
        background-color: ${e.colors.grayscale.light5};
      }
    }
    // > 移动端阅览模式下Tab里面图标上下间距要和编辑状态下保持一致，所以特加一个className="dashboard--preview"控制，原来的不受影响
    &.dashboard--preview {
      /* provide hit area in case row contents is edge to edge */
      .dashboard-component-tabs-content {
        background-color: rgba(
          225,
          225,
          225,
          0.3
        ); // 布局元素 tabs 的背景颜色、
        .dragdroppable-row {
          padding-top: ${e.gridUnit}px; // 布局元素 tabs 的内边距 4px、
          // > 移动端阅览模式下禁止用户或误操作触发长按后导致当前拖动组件可编辑
          -webkit-user-select: none;
          -moz-user-select: none;
        }

        & > div:not(:last-child):not(.empty-droptarget) {
          margin-bottom: ${4*e.gridUnit}px;
        }
      }
    }
    &.dashboard--editing {
      .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed transparent;
        content: '';
        position: absolute;
        //width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
      }

      .resizable-container {
        & .dashboard-component-chart-holder {
          .dashboard-chart {
            .chart-container {
              cursor: move;
              opacity: 0.2;
            }

            .slice_container {
              /* disable chart interactions in edit mode */
              //pointer-events: none;
            }
          }

          &:hover .dashboard-chart .chart-container {
            opacity: 0.7;
          }
        }

        &:hover,
        &.resizable-container--resizing:hover {
          & > .dashboard-component-chart-holder:after {
            border: 1px dashed ${e.colors.primary.base};
          }
        }
      }

      .resizable-container--resizing:hover > .grid-row:after,
      .hover-menu:hover + .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed ${e.colors.primary.base};
        z-index: 2;
      }

      .grid-row:after,
      .dashboard-component-tabs > .hover-menu + div:after {
        border: 1px dashed ${e.colors.grayscale.light2};
      }

      /* provide hit area in case row contents is edge to edge */
      .dashboard-component-tabs-content {
        background-color: rgba(
          225,
          225,
          225,
          0.3
        ); // 布局元素 tabs 的背景颜色、
        .dragdroppable-row {
          padding-top: ${e.gridUnit}px; // 布局元素 tabs 的内边距 4px、
          &:last-child {
            padding-bottom: 10px; // 处理tabs最后一个图表不能改变纵向高度
          }
        }

        & > div:not(:last-child):not(.empty-droptarget) {
          margin-bottom: ${4*e.gridUnit}px;
        }
      }

      .dashboard-component-chart-holder {
        &:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          z-index: 1;
          //pointer-events: none;
          border: 1px solid transparent;
        }

        &:hover:after {
          border: 1px dashed ${e.colors.primary.base};
          z-index: 2;
        }
      }

      .contract-trigger:before {
        display: none;
      }
    }

    & .dashboard-component-tabs-content {
      & > div:not(:last-child):not(.empty-droptarget) {
        margin-bottom: ${4*e.gridUnit}px;
      }

      & > .empty-droptarget {
        position: absolute;
        width: 100%;
      }

      & > .empty-droptarget:first-child {
        height: ${4*e.gridUnit}px;
        top: -2px;
        z-index: 10;
      }

      & > .empty-droptarget:last-child {
        height: ${3*e.gridUnit}px;
        bottom: 0;
      }
    }

    .empty-droptarget:first-child .drop-indicator--bottom {
      top: ${6*e.gridUnit}px;
    }
  `}
`,oD=y.iK.div`
  ${({theme:e,editMode:t,marginLeft:n,isMobileGird:r})=>x.iv`
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    height: auto;
    flex: 1;

    .grid-container .dashboard-component-tabs {
      box-shadow: none;
      padding-left: 0;
    }

    .grid-container {
      /* without this, the grid will not get smaller upon toggling the builder panel on */
      width: 0;
      flex: 1;
      position: relative;
      // margin-top: ${6*e.gridUnit}px;
      // margin-right: ${8*e.gridUnit}px;
      // margin-bottom: ${6*e.gridUnit}px;
      // margin-left: ${n}px;

      ${t&&`/*\n        max-width: calc(100% - ${Jc.XX+16*e.gridUnit}px);*/\n      `}

      /* this is the ParentSize wrapper */
      & > div:first-child {
        height: inherit !important;
      }

      .grid-row {
        // flex-flow: wrap;    // 行列，行列模式下 每行可以放置多个图表的换行
      }
    }

    .dashboard-builder-sidepane {
      width: ${Jc.XX}px;
      z-index: 1;
    }

    .dashboard-component-chart-holder {
      // 下面是处理网格移动端的上下左右间距问题 padding 以及margin不会同时存在
      // 并且注意 每个组件如果需要间距  必须给dashboard-component-chart-holder样式才可以
      width: ${r?`calc(100% - ${me.sK}px)`:"100%"};
      height: ${r?`calc(100% - ${me.sK}px)`:"100%"};
      background-color: ${e.colors.grayscale.light5};
      position: relative;
      //padding: ${4*e.gridUnit}px;
      padding: ${r?"0px":2*e.gridUnit+"px"};
      margin: ${r?`${me.sK}px 0px 0px ${me.sK/2}px`:"0px"};
      overflow-y: visible;

      // transitionable traits to show filter relevance
      transition: opacity ${e.transitionTiming}s ease-in-out,
        border-color ${e.transitionTiming}s ease-in-out,
        box-shadow ${e.transitionTiming}s ease-in-out;

      &.fade-in {
        border-radius: ${e.borderRadius}px;
        box-shadow: inset 0 0 0 2px ${e.colors.primary.base},
          0 0 0 3px
            ${(0,C.Zf)(e.colors.primary.base,parseFloat(e.opacity.light)/100)};
      }

      &.fade-out {
        border-radius: ${e.borderRadius}px;
        box-shadow: none;
      }

      & .missing-chart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
        justify-content: center;

        .missing-chart-body {
          font-size: ${e.typography.sizes.s}px;
          position: relative;
          display: flex;
        }
      }
    }
  `}
`,iD=y.iK.div`
  ${({editMode:e})=>x.iv`
    display: flex;
    justify-content: center;
    margin-left: ${e?"320px":"0"};
    margin-right: ${e?"320px":"0"};
    height: ${e?"calc(100% - 90px)":"100%"};
    overflow-y: auto;
  `}
`,aD=y.iK.div`
  display: flex;
  flex: 1;
  height: 100%;
  justify-content: center;
`,sD=y.iK.div`
  ${({emulateRatio:e,editMode:t})=>x.iv`
    width: ${t?`${e.width}px`:"100%"};

    .header {
      background: ${"url(/static/assets/images/mbg0.png)"};
      background-size: cover;
      aspect-ratio: 7.453125;
    }

    .body {
      height: ${t?`${e.height}px`:"100vh"};
      background: ${t?"url('/static/assets/images/mbg2.png')":"none"};
      background-size: contain;
      display: flex;
      padding: 0 ${t?.045714*e.width:0}px;
      overflow-x: hidden;
    }

    .footer {
      background: ${"url(/static/assets/images/mbg1.png)"};
      background-size: cover;
      background-position-y: bottom;
      aspect-ratio: 7.3384615;
      margin-right: 1px;
    }

    .grid-container {
      // > 设置背景下用外背景1px的显示问题，所以注释掉。
      //margin: 1px;
      max-width: initial;
    }
  `};
`,lD=()=>{const e=(0,o.I0)(),t=(0,iu.fG)(),r=(0,y.Fg)(),s=((0,o.v9)((e=>e.nativeFilters.filters)),(0,o.v9)((({dashboardInfo:e})=>{var t;return`${null==e||null==(t=e.metadata)?void 0:t.background_image}`}))),l=(0,o.v9)((({dashboardInfo:e})=>{var t;return`${null==e||null==(t=e.metadata)?void 0:t.background_color}`})),c=(0,o.v9)((e=>e.mobileDashboardLayout.present)),h=(0,o.v9)((e=>e.dashboardState.editMode)),f=(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.layout_mode)||i.kB.PC})),g=(0,o.v9)((e=>e.dashboardState.emulateRatio))||{width:350,height:680},m=(0,o.v9)((e=>e.dashboardState.emulateType))||"",v=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),C=(0,o.v9)((({dashboardState:e})=>e.dashboardIsSaving)),w=(0,o.v9)((e=>e.dashboardState.fullSizeChartId)),S=(0,o.v9)((({dashboardInfo:e})=>(0,oe.cr)(u.T.HORIZONTAL_FILTER_BAR)?e.filterBarOrientation:i.Bp.VERTICAL)),Z=(0,o.v9)((e=>e.dashboardState.dashboardShare||!1)),k=(0,o.v9)((({dashboardInfo:e})=>{var t;return(null==e||null==(t=e.metadata)?void 0:t.layout_type)||"rowAndColumn"})),M="grid"===k&&f===i.kB.MOBILE,{dashboardInfo:D,mobileDashboardLayout:E}=(0,o.v9)((({dashboardInfo:e,mobileDashboardLayout:t})=>({dashboardInfo:e,mobileDashboardLayout:t}))),{presentFilterIds:R}=ul({dashboardInfo:D,mobileDashboardLayout:E}),T=(0,a.useCallback)((({pathToTabIndex:t})=>{e((0,ss.E2)(t))}),[e]),_=(0,a.useCallback)((()=>{e((0,bl.g3)());const t=Iw(tM(c),0);e((0,ss.E2)(t))}),[c,e]),I=(0,a.useCallback)((t=>e((0,bl._p)(t))),[e]),O=a.useRef(null),P=c[Be._4],z=null==P?void 0:P.children[0],F=z!==Be.PV?c[z]:void 0,N=(0,ye.eY)(me.KD.standalone),$=N===Be._B.REPORT,L=t.hideTitle||N===Be._B.HIDE_NAV_AND_TITLE||$,[B,A]=(0,a.useState)(0),j=a.useRef(null),H=a.useRef(null);(0,a.useEffect)((()=>{j.current?H.current&&clearInterval(H.current):H.current=setInterval((()=>{const e=document.querySelector(".dmd-tabs-content");e&&(j.current=e,null==e||e.addEventListener("scroll",(()=>{window.postMessage({type:"share-page-scroll",item:{}},"*")})))}),1e3)}),[j.current]),(0,a.useEffect)((()=>{var e,t;let r;return A((null==(e=O.current)||null==(t=e.getBoundingClientRect())?void 0:t.height)||0),n.g.hasOwnProperty("ResizeObserver")&&O.current&&(r=new ResizeObserver((e=>{A((t=>{var n,r;return(null==e||null==(n=e[0])||null==(r=n.contentRect)?void 0:r.height)||t}))})),r.observe(O.current)),()=>{var e;null==(e=r)||e.disconnect()}}),[]);const{dashboardFiltersOpen:q,toggleDashboardFiltersOpen:U,nativeFiltersEnabled:V}=NM(),[W,G]=function(e){const t=(0,a.useRef)(null),[n,r]=(0,a.useState)(!1),o=e=>{const[t]=e;r(t.intersectionRatio<1)};return(0,a.useEffect)((()=>{const n=new IntersectionObserver(o,e),r=t.current;return r&&n.observe(r),()=>{r&&n.unobserve(r)}}),[t,e]),[t,n]}({threshold:[1]}),K=(0,oe.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET),Y=(Jc.UN,G||N||Jc.Ky,K&&Jc.a7,(0,a.useMemo)((()=>({marginLeft:q||h||!V||S===i.Bp.HORIZONTAL?0:-32})),[q,h,S,V])),X=(0,a.useRef)(F);(0,a.useEffect)((()=>{var t,n,r;const o=null==(t=X.current)||null==(n=t.children)?void 0:n.length,i=null==F||null==(r=F.children)?void 0:r.length;if(void 0!==o&&void 0!==i&&i>o){const t=Iw(tM(c),i-1);e((0,ss.E2)(t))}X.current=F}),[F]);const Q=(0,a.useCallback)((({dropIndicatorProps:e})=>(0,x.tZ)(hw,null,(({width:n})=>(0,x.tZ)("div",null,false,e&&(0,x.tZ)("div",e),!$&&F&&!t.hideNav&&(0,x.tZ)(bp,{shouldFocus:nM,menuItems:[(0,x.tZ)(Xd,{icon:(0,x.tZ)(ae.Z.FallOutlined,{iconSize:"xl"}),label:(0,d.t)("Collapse tab content"),onClick:_})],editMode:h},(0,x.tZ)(ih,{id:null==F?void 0:F.id,parentId:Be._4,depth:Be.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:T})))))),[V,S,h,T,_,L,$,F,t.hideNav,c]),J=q||h||!V||S===i.Bp.HORIZONTAL?8*r.gridUnit:0,ee=(0,a.useMemo)((()=>h?{position:"fixed",top:"0",left:"0",zIndex:"999",width:"100vw",height:"100vh",background:"#f0f2f5"}:{}),[h]),te=R.length?{overflow:"hidden"}:{},ne=h||f!==i.kB.MOBILE?{}:{height:window.innerHeight,overflow:"hidden"},{pathname:re}=window.location;if(!h&&re.indexOf("/dashboard/list")>-1){var ie,se;const t=g.height||window.innerHeight-200;return(0,x.tZ)("div",{"data-test":"mobile-dashboard-builder",style:{...ee,...ne}},(0,x.tZ)(a.Fragment,null,(0,x.tZ)("div",{style:{position:"sticky",top:0,zIndex:1e3,display:""+(w||Z?"none":"block")},"data-test":"dashboard-builder-editor-header"},(0,x.tZ)(Gd,{componentPanelOpen:!1,componentPanelClosable:!0,onComponentPanelOpen:e=>{}})),(0,x.tZ)(iD,{css:x.iv`
              &::-webkit-scrollbar {
                // 隐藏滚动条
                display: none; /* Chrome, Safari, Opera */
              }
            `,editMode:!1},(0,x.tZ)(aD,{editMode:!0},(0,x.tZ)(sD,{emulateRatio:g,editMode:!0},(0,x.tZ)("div",{className:"header"}),(0,x.tZ)("div",{className:"body",style:{position:"relative",overflow:"hidden"},id:JM.H5},(0,x.tZ)(eD,{id:"mobile-body-container",backgroundImage:s,backgroundColor:l,style:{position:"relative",overflow:"hidden"}},(0,x.tZ)(nD,{fullSizeChartId:w},(0,x.tZ)(x.xB,{styles:x.iv`
                          &::-webkit-scrollbar {
                            // 隐藏滚动条
                            display: none; /* Chrome, Safari, Opera */
                          }
                          // @z-index-above-dashboard-header (100) + 1 = 101
                          ${w&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
                        `}),!F&&0===(null==(ie=c[Be.PV])||null==(se=ie.children)?void 0:se.length)&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no charts added to this dashboard"),description:v&&(0,d.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:v&&(0,d.t)("Edit the dashboard"),buttonAction:()=>e((0,ss.Mb)(!0)),image:"dashboard.svg"}),(0,x.tZ)(rD,{"data-test":"dashboard-content-wrapper",className:b()("dashboard",h?"dashboard--editing":"dashboard--preview")},(0,x.tZ)(oD,{className:"dashboard-content",editMode:!0,marginLeft:J,isMobileGird:M},(0,x.tZ)(FM,{containerHeight:t,topLevelTabs:F})))))),(0,x.tZ)("div",{className:"footer"}))))))}return(0,x.tZ)("div",{"data-test":"mobile-dashboard-builder",style:{...ee,...ne}},h&&(0,x.tZ)("div",{style:{position:"sticky",top:0,zIndex:1001}},(0,x.tZ)(Gd,{componentPanelOpen:!0,componentPanelClosable:!1,emulateType:m,emulateRatio:g,onChangeEmulateType:t=>{e((0,ss.$W)(t))}})),(0,x.tZ)(iD,{editMode:h},(0,x.tZ)(aD,{editMode:h},(0,x.tZ)(sD,{emulateRatio:g,editMode:h},h&&(0,x.tZ)("div",{className:"header"}),(0,x.tZ)("div",{className:"body",style:{position:"relative",overflow:"hidden",...ne},id:JM.H5},(0,x.tZ)(hw,{id:"mobile-body-container",parentSizeStyles:{width:"100%",height:"100%",position:"relative",...te,...ne}},(({width:t,height:n})=>{var r,o,i,a;return(0,x.tZ)(eD,{backgroundImage:s,backgroundColor:l},h&&(0,x.tZ)(tD,{ref:O,width:t},(0,x.tZ)(Wn,{"data-test":"top-level-tabs",component:P,parentComponent:null,depth:Be.Mu,index:0,orientation:"column",onDrop:I,editMode:h,disableDragDrop:!!F,style:Y},Q)),(0,x.tZ)(nD,{fullSizeChartId:w},(0,x.tZ)(x.xB,{styles:x.iv`
                          // @z-index-above-dashboard-header (100) + 1 = 101
                          ${w&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
                        `}),!h&&!F&&0===(null==(r=c[Be.PV])||null==(o=r.children)?void 0:o.length)&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no charts added to this dashboard"),description:v&&(0,d.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:v&&(0,d.t)("Edit the dashboard"),buttonAction:()=>e((0,ss.Mb)(!0)),image:"dashboard.svg"}),!h&&!F&&0===(null==(i=c[Be.PV])||null==(a=i.children)?void 0:a.length)&&(0,x.tZ)(Mh.XJ,{title:(0,d.t)("There are no charts added to this dashboard"),description:v&&(0,d.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:v&&(0,d.t)("Edit the dashboard"),buttonAction:()=>e((0,ss.Mb)(!0)),image:"dashboard.svg"}),(0,x.tZ)(rD,{"data-test":"dashboard-content-wrapper",className:b()("dashboard",h?"dashboard--editing":"dashboard--preview")},(0,x.tZ)(oD,{className:"dashboard-content",editMode:h,marginLeft:J,isMobileGird:M},(0,x.tZ)(FM,{containerHeight:n,topLevelTabs:F})))),C&&(0,x.tZ)(p.Z,{css:x.iv`
                          && {
                            position: fixed;
                          }
                        `}))}))),h&&(0,x.tZ)("div",{className:"footer"})))),h&&(0,x.tZ)("div",{style:{width:"320px",background:"#f0f2f5"}},(0,x.tZ)("div",{style:{height:"calc(100vh - 90px)",position:"fixed",top:"90px",right:0,zIndex:999}},(0,x.tZ)(BM,{width:"320px"}))))};var dD=n(912437),uD=n.n(dD);const cD={actions:l().shape({addSliceToDashboard:l().func.isRequired,removeSliceFromDashboard:l().func.isRequired,triggerQuery:l().func.isRequired,logEvent:l().func.isRequired,clearDataMaskState:l().func.isRequired,setLayoutMode:l().func.isRequired}).isRequired,dashboardInfo:It.$X.isRequired,dashboardState:It.DZ.isRequired,charts:l().objectOf(It.$6).isRequired,slices:l().objectOf(It.Rw).isRequired,activeFilters:l().object.isRequired,chartConfiguration:l().object,datasources:l().object.isRequired,ownDataCharts:l().object.isRequired,layout:l().object.isRequired,impressionId:l().string.isRequired,initMessages:l().array,timeout:l().number,userId:l().string},pD="handle-water-mark-todo",hD=a.createContext({});class fD extends a.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",fD.unload):window.removeEventListener("beforeunload",fD.unload)}static unload(){const e=(0,d.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.filterBarRef=a.createRef(null),this.callBackDataMaskSelected=Lt()((e=>{const{layout:t={}}=this.props;JSON.stringify(e)!==JSON.stringify(this.state.dataMaskSelected)&&this.setState({dataMaskSelected:e},(()=>{const e=Object.keys(t).filter((e=>e.indexOf(f.kE)>-1));(null==e?void 0:e.length)<1&&this.handleAutoApply()}))}),500),this.handleClearAll=()=>{var e;null==(e=this.filterBarRef.current)||null==e.handleClearAll||e.handleClearAll()},this.handleAutoApply=()=>{var e;null==(e=this.filterBarRef.current)||null==e.handleAutoApply||e.handleAutoApply()},this.resoveDeepMask=e=>{var t,n,r;if(null==e||!e.id)return;const o=(null==(t=this.props)||null==(n=t.nativeFilters)?void 0:n.filters)||{},i=(null==(r=this.props)?void 0:r.dataMask)||{};Object.keys(o).forEach((t=>{const n=o[t];if(((null==n?void 0:n.cascadeParentIds)||[]).includes(e.id)){var r;const e=i[n.id],t=null==e||null==(r=e.filterState)?void 0:r.value;null!=t&&t.length&&(setTimeout((()=>{const e={fid:n.id,nov:n};window.postMessage({type:"filter-global-change-outter",item:e},"*")})),this.resoveDeepMask(n))}}))},this.handleFilterSelectionChange=(e,t)=>{var n,r,o,i;null==(n=this.filterBarRef.current)||null==n.handleFilterSelectionChange||n.handleFilterSelectionChange(e,t);const a=null==e||null==(r=e.dataMask)||null==(o=r.filterState)?void 0:o.value,s=null==t||null==(i=t.filterState)?void 0:i.value;let l=JSON.stringify(a)===JSON.stringify(s);null===s&&null!=a&&a.length;l||"filter_select"!==e.filterType||this.resoveDeepMask(e)},this.state={dataMaskSelected:{}},this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){var e;null!==new(uD())(navigator.userAgent).phone()&&this.props.actions.setLayoutMode(i.kB.MOBILE);const t=(0,h.Z)(),{dashboardState:n,layout:r}=this.props,o={is_soft_navigation:ie.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:ie.Yd.getTimestamp(),is_empty:QM(r),is_published:n.isPublished,bootstrap_data_length:t.length},a=(0,YM.Z)();a&&(o.target_id=a),this.props.actions.logEvent(ie.Wl,o),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:ie.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts();const s={modalId:pD};null==(e=window)||null==e.waterMark||e.waterMark(s)}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=g(this.props.layout),n=g(e.layout);if(this.props.dashboardInfo.id===e.dashboardInfo.id)if(t.length<n.length){const r=n.filter((e=>-1===t.indexOf(e)));r.forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,r=t,Object.values(n).find((e=>e&&e.type===f.dW&&e.meta&&e.meta.chartId===r))));var n,r}))}else if(t.length>n.length){const e=t.filter((e=>-1===n.indexOf(e)));e.forEach((e=>this.props.actions.removeSliceFromDashboard(e)))}}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:r}=this,{activeFilters:o,ownDataCharts:i,chartConfiguration:a}=this.props;(0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,ru.JB)(r,i,{ignoreUndefined:!0})&&(0,ru.JB)(n,o,{ignoreUndefined:!0})||this.applyFilters(),e?fD.onBeforeUnload(!0):fD.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:ie.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(ie.Ev,{...this.visibilityEventData,duration:ie.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,r=Object.keys(t),o=Object.keys(e),i=new Set(r.concat(o)),a=((e,t)=>{const n=Object.keys(e),r=Object.keys(t),o=(i=n,a=r,[...i.filter((e=>!a.includes(e))),...a.filter((e=>!i.includes(e)))]).filter((n=>e[n]||t[n]));var i,a;return new Set([...n,...r]).forEach((n=>{(0,ru.JB)(e[n],t[n])||o.push(n)})),[...new Set(o)]})(n,this.appliedOwnDataCharts);[...i].forEach((n=>{if(!r.includes(n)&&o.includes(n))a.push(...e[n].scope);else if(o.includes(n)){if((0,ru.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||a.push(...t[n].scope),!(0,ru.JB)(e[n].scope,t[n].scope)){const r=(t[n].scope||[]).concat(e[n].scope||[]);a.push(...r)}}else a.push(...t[n].scope)})),this.refreshCharts([...new Set(a)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){var e,t;const{editMode:n}=this.props.dashboardState,r=(null==(e=this.props.dashboardInfo)||null==(t=e.metadata)?void 0:t.layout_mode)||i.kB.PC,{dataMaskSelected:o}=this.state;return this.context.loading?(0,x.tZ)(p.Z,null):(0,x.tZ)(hD.Provider,{value:{dataMaskSelected:o,handleClearAll:this.handleClearAll,handleFilterSelectionChange:this.handleFilterSelectionChange,handleAutoApply:this.handleAutoApply}},(0,x.tZ)("div",{id:pD},(0,x.tZ)("div",{style:{display:"none"}},(0,x.tZ)(eM,{orientation:i.Bp.VERTICAL,callBackDataMaskSelected:e=>{this.callBackDataMaskSelected(e)},ref:this.filterBarRef,verticalConfig:{canEdit:!0,showHeader:!0,filtersOpen:!1,toggleFiltersBar:!1,width:200,height:100,offset:0,isActionFixed:!0}})),r===i.kB.PC?(0,x.tZ)(KM,{filterBarRef:this.filterBarRef,dataMaskSelected:o}):(0,x.tZ)(lD,{filterBarRef:this.filterBarRef,dataMaskSelected:o})))}}fD.contextType=c.Zn,fD.propTypes=cD,fD.defaultProps={initMessages:[],timeout:60,userId:""};const gD=fD;var mD=n(550810),vD=n(987915);const bD=(0,o.$j)((function(e){var t,n,r,o,a,s;const{datasources:l,sliceEntities:d,charts:u,dataMask:c,dashboardInfo:p,dashboardState:h,dashboardLayout:f,mobileDashboardLayout:g,impressionId:m,nativeFilters:v}=e;return{initMessages:null==(t=p.common)?void 0:t.flash_messages,timeout:null==(n=p.common)||null==(r=n.conf)?void 0:r.SUPERSET_WEBSERVER_TIMEOUT,userId:p.userId,dashboardInfo:p,dashboardState:h,charts:u,datasources:l,activeFilters:{...(0,et.De)(),...(0,vD.g)({chartConfiguration:null==(o=p.metadata)?void 0:o.chart_configuration,nativeFilters:v.filters,dataMask:c,allSliceIds:h.sliceIds})},chartConfiguration:null==(a=p.metadata)?void 0:a.chart_configuration,ownDataCharts:(0,vD.U)(c,"ownState"),slices:d.slices,layout:(null==p||null==(s=p.metadata)?void 0:s.layout_mode)===i.kB.MOBILE?g.present:f.present,impressionId:m,nativeFilters:v,dataMask:c}}),(function(e){return{actions:(0,r.DE)({setDatasources:mD.Fy,clearDataMaskState:w.clearDataMaskState,addSliceToDashboard:ss.Pi,removeSliceFromDashboard:ss.rL,setLayoutMode:ss.YA,triggerQuery:ln.triggerQuery,logEvent:Vd.logEvent,clearDataMask:w.clearDataMask,updateDataMask:w.updateDataMask},e)}}))(gD)}}]);